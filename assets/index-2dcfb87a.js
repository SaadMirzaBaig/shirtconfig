var W3=Object.defineProperty;var j3=(n,e,t)=>e in n?W3(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var h=(n,e,t)=>(j3(n,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=t(s);fetch(s.href,r)}})();/**
 * @license
 * Copyright 2010-2023 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const nh="154",Uh={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},Nh={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},BO=0,TS=1,DO=2,q3=3,X3=0,kE=1,LE=2,ha=3,Es=0,fn=1,wi=2,Y3=2,qi=0,Lc=1,Mf=2,IS=3,RS=4,OO=5,Hh=100,kO=101,LO=102,PS=103,BS=104,FO=200,UO=201,NO=202,zO=203,FE=204,UE=205,GO=206,VO=207,HO=208,QO=209,WO=210,NE=0,pb=1,um=2,Tf=3,If=4,gb=5,mb=6,Xm=7,Ym=0,jO=1,qO=2,Qs=0,dm=1,zE=2,XO=3,GE=4,YO=5,Ab=300,qc=301,Xc=302,mo=303,Rf=304,jf=306,vo=1e3,Wn=1001,wu=1002,Ft=1003,Pf=1004,J3=1004,fu=1005,K3=1005,Dt=1006,Jm=1007,Z3=1007,yo=1008,$3=1008,fi=1009,JO=1010,KO=1011,vb=1012,VE=1013,Pa=1014,sn=1015,xn=1016,HE=1017,QE=1018,Dl=1020,ZO=1021,Ti=1023,yb=1024,$O=1025,Fc=1026,Yc=1027,wl=1028,WE=1029,iu=1030,jE=1031,qE=1033,_g=33776,_y=33777,xy=33778,xg=33779,Ky=35840,DS=35841,Zy=35842,OS=35843,XE=36196,$y=37492,e0=37496,t0=37808,kS=37809,LS=37810,FS=37811,US=37812,NS=37813,zS=37814,GS=37815,VS=37816,HS=37817,QS=37818,WS=37819,jS=37820,qS=37821,wg=36492,ek=36283,XS=36284,YS=36285,JS=36286,fm=2200,YE=2201,tk=2202,Su=2300,Jc=2301,wy=2302,nu=2400,su=2401,pm=2402,bb=2500,JE=2501,ik=0,KE=1,i0=2,Km=3e3,ka=3001,hs=3200,_b=3201,sh=0,nk=1,ur="",Je="srgb",gn="srgb-linear",ZE="display-p3",sk=0,Sg=7680,rk=7681,ok=7682,ak=7683,lk=34055,ck=34056,hk=5386,KS=512,uk=513,dk=514,fk=515,pk=516,gk=517,mk=518,$E=519,Ak=512,vk=513,yk=514,bk=515,_k=516,xk=517,wk=518,Sk=519,gm=35044,xs=35048,ez=35040,tz=35045,iz=35049,nz=35041,sz=35046,rz=35050,oz=35042,az="100",n0="300 es",s0=1035,Ba=2e3,mm=2001;class Fn{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const i=this._listeners;return i[e]!==void 0&&i[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const s=this._listeners[e];if(s!==void 0){const r=s.indexOf(t);r!==-1&&s.splice(r,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const i=this._listeners[e.type];if(i!==void 0){e.target=this;const s=i.slice(0);for(let r=0,o=s.length;r<o;r++)s[r].call(this,e);e.target=null}}}const ms=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let cI=1234567;const pu=Math.PI/180,Bf=180/Math.PI;function Lr(){const n=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(ms[n&255]+ms[n>>8&255]+ms[n>>16&255]+ms[n>>24&255]+"-"+ms[e&255]+ms[e>>8&255]+"-"+ms[e>>16&15|64]+ms[e>>24&255]+"-"+ms[t&63|128]+ms[t>>8&255]+"-"+ms[t>>16&255]+ms[t>>24&255]+ms[i&255]+ms[i>>8&255]+ms[i>>16&255]+ms[i>>24&255]).toLowerCase()}function nn(n,e,t){return Math.max(e,Math.min(t,n))}function eM(n,e){return(n%e+e)%e}function lz(n,e,t,i,s){return i+(n-e)*(s-i)/(t-e)}function cz(n,e,t){return n!==e?(t-n)/(e-n):0}function Cg(n,e,t){return(1-t)*n+t*e}function hz(n,e,t,i){return Cg(n,e,1-Math.exp(-t*i))}function uz(n,e=1){return e-Math.abs(eM(n,e*2)-e)}function dz(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*(3-2*n))}function fz(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*n*(n*(n*6-15)+10))}function pz(n,e){return n+Math.floor(Math.random()*(e-n+1))}function gz(n,e){return n+Math.random()*(e-n)}function mz(n){return n*(.5-Math.random())}function Az(n){n!==void 0&&(cI=n);let e=cI+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function vz(n){return n*pu}function yz(n){return n*Bf}function ZS(n){return(n&n-1)===0&&n!==0}function Ck(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function r0(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}function bz(n,e,t,i,s){const r=Math.cos,o=Math.sin,a=r(t/2),l=o(t/2),c=r((e+i)/2),u=o((e+i)/2),d=r((e-i)/2),f=o((e-i)/2),p=r((i-e)/2),g=o((i-e)/2);switch(s){case"XYX":n.set(a*u,l*d,l*f,a*c);break;case"YZY":n.set(l*f,a*u,l*d,a*c);break;case"ZXZ":n.set(l*d,l*f,a*u,a*c);break;case"XZX":n.set(a*u,l*g,l*p,a*c);break;case"YXY":n.set(l*p,a*u,l*g,a*c);break;case"ZYZ":n.set(l*g,l*p,a*u,a*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+s)}}function Dr(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return n/4294967295;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int32Array:return Math.max(n/2147483647,-1);case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function Ut(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return Math.round(n*4294967295);case Uint16Array:return Math.round(n*65535);case Uint8Array:return Math.round(n*255);case Int32Array:return Math.round(n*2147483647);case Int16Array:return Math.round(n*32767);case Int8Array:return Math.round(n*127);default:throw new Error("Invalid component type.")}}const cs={DEG2RAD:pu,RAD2DEG:Bf,generateUUID:Lr,clamp:nn,euclideanModulo:eM,mapLinear:lz,inverseLerp:cz,lerp:Cg,damp:hz,pingpong:uz,smoothstep:dz,smootherstep:fz,randInt:pz,randFloat:gz,randFloatSpread:mz,seededRandom:Az,degToRad:vz,radToDeg:yz,isPowerOfTwo:ZS,ceilPowerOfTwo:Ck,floorPowerOfTwo:r0,setQuaternionFromProperEuler:bz,normalize:Ut,denormalize:Dr};class te{constructor(e=0,t=0){te.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,s=e.elements;return this.x=s[0]*t+s[3]*i+s[6],this.y=s[1]*t+s[4]*i+s[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(nn(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const i=Math.cos(t),s=Math.sin(t),r=this.x-e.x,o=this.y-e.y;return this.x=r*i-o*s+e.x,this.y=r*s+o*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class It{constructor(e,t,i,s,r,o,a,l,c){It.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,i,s,r,o,a,l,c)}set(e,t,i,s,r,o,a,l,c){const u=this.elements;return u[0]=e,u[1]=s,u[2]=a,u[3]=t,u[4]=r,u[5]=l,u[6]=i,u[7]=o,u[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,s=t.elements,r=this.elements,o=i[0],a=i[3],l=i[6],c=i[1],u=i[4],d=i[7],f=i[2],p=i[5],g=i[8],A=s[0],v=s[3],m=s[6],b=s[1],y=s[4],_=s[7],E=s[2],M=s[5],I=s[8];return r[0]=o*A+a*b+l*E,r[3]=o*v+a*y+l*M,r[6]=o*m+a*_+l*I,r[1]=c*A+u*b+d*E,r[4]=c*v+u*y+d*M,r[7]=c*m+u*_+d*I,r[2]=f*A+p*b+g*E,r[5]=f*v+p*y+g*M,r[8]=f*m+p*_+g*I,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],s=e[2],r=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8];return t*o*u-t*a*c-i*r*u+i*a*l+s*r*c-s*o*l}invert(){const e=this.elements,t=e[0],i=e[1],s=e[2],r=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],d=u*o-a*c,f=a*l-u*r,p=c*r-o*l,g=t*d+i*f+s*p;if(g===0)return this.set(0,0,0,0,0,0,0,0,0);const A=1/g;return e[0]=d*A,e[1]=(s*c-u*i)*A,e[2]=(a*i-s*o)*A,e[3]=f*A,e[4]=(u*t-s*l)*A,e[5]=(s*r-a*t)*A,e[6]=p*A,e[7]=(i*l-c*t)*A,e[8]=(o*t-i*r)*A,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,s,r,o,a){const l=Math.cos(r),c=Math.sin(r);return this.set(i*l,i*c,-i*(l*o+c*a)+o+e,-s*c,s*l,-s*(-c*o+l*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(bx.makeScale(e,t)),this}rotate(e){return this.premultiply(bx.makeRotation(-e)),this}translate(e,t){return this.premultiply(bx.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,i,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,i=e.elements;for(let s=0;s<9;s++)if(t[s]!==i[s])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const bx=new It;function Ek(n){for(let e=n.length-1;e>=0;--e)if(n[e]>=65535)return!0;return!1}const _z={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function Hd(n,e){return new _z[n](e)}function Am(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}const hI={};function Eg(n){n in hI||(hI[n]=!0,console.warn(n))}function ff(n){return n<.04045?n*.0773993808:Math.pow(n*.9478672986+.0521327014,2.4)}function _x(n){return n<.0031308?n*12.92:1.055*Math.pow(n,.41666)-.055}const xz=new It().fromArray([.8224621,.0331941,.0170827,.177538,.9668058,.0723974,-1e-7,1e-7,.9105199]),wz=new It().fromArray([1.2249401,-.0420569,-.0196376,-.2249404,1.0420571,-.0786361,1e-7,0,1.0982735]);function Sz(n){return n.convertSRGBToLinear().applyMatrix3(wz)}function Cz(n){return n.applyMatrix3(xz).convertLinearToSRGB()}const Ez={[gn]:n=>n,[Je]:n=>n.convertSRGBToLinear(),[ZE]:Sz},Mz={[gn]:n=>n,[Je]:n=>n.convertLinearToSRGB(),[ZE]:Cz},io={enabled:!0,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(n){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!n},get workingColorSpace(){return gn},set workingColorSpace(n){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(n,e,t){if(this.enabled===!1||e===t||!e||!t)return n;const i=Ez[e],s=Mz[t];if(i===void 0||s===void 0)throw new Error(`Unsupported color space conversion, "${e}" to "${t}".`);return s(i(n))},fromWorkingColorSpace:function(n,e){return this.convert(n,this.workingColorSpace,e)},toWorkingColorSpace:function(n,e){return this.convert(n,e,this.workingColorSpace)}};let id;class tM{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{id===void 0&&(id=Am("canvas")),id.width=e.width,id.height=e.height;const i=id.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=id}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=Am("canvas");t.width=e.width,t.height=e.height;const i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);const s=i.getImageData(0,0,e.width,e.height),r=s.data;for(let o=0;o<r.length;o++)r[o]=ff(r[o]/255)*255;return i.putImageData(s,0,0),t}else if(e.data){const t=e.data.slice(0);for(let i=0;i<t.length;i++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[i]=Math.floor(ff(t[i]/255)*255):t[i]=ff(t[i]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let Tz=0;class Sl{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:Tz++}),this.uuid=Lr(),this.data=e,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const i={uuid:this.uuid,url:""},s=this.data;if(s!==null){let r;if(Array.isArray(s)){r=[];for(let o=0,a=s.length;o<a;o++)s[o].isDataTexture?r.push(xx(s[o].image)):r.push(xx(s[o]))}else r=xx(s);i.url=r}return t||(e.images[this.uuid]=i),i}}function xx(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?tM.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let Iz=0;class Rt extends Fn{constructor(e=Rt.DEFAULT_IMAGE,t=Rt.DEFAULT_MAPPING,i=Wn,s=Wn,r=Dt,o=yo,a=Ti,l=fi,c=Rt.DEFAULT_ANISOTROPY,u=ur){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Iz++}),this.uuid=Lr(),this.name="",this.source=new Sl(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=i,this.wrapT=s,this.magFilter=r,this.minFilter=o,this.anisotropy=c,this.format=a,this.internalFormat=null,this.type=l,this.offset=new te(0,0),this.repeat=new te(1,1),this.center=new te(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new It,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,typeof u=="string"?this.colorSpace=u:(Eg("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=u===ka?Je:ur),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const i={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==Ab)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case vo:e.x=e.x-Math.floor(e.x);break;case Wn:e.x=e.x<0?0:1;break;case wu:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case vo:e.y=e.y-Math.floor(e.y);break;case Wn:e.y=e.y<0?0:1;break;case wu:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}get encoding(){return Eg("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===Je?ka:Km}set encoding(e){Eg("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=e===ka?Je:ur}}Rt.DEFAULT_IMAGE=null;Rt.DEFAULT_MAPPING=Ab;Rt.DEFAULT_ANISOTROPY=1;class Ke{constructor(e=0,t=0,i=0,s=1){Ke.prototype.isVector4=!0,this.x=e,this.y=t,this.z=i,this.w=s}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,s){return this.x=e,this.y=t,this.z=i,this.w=s,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,i=this.y,s=this.z,r=this.w,o=e.elements;return this.x=o[0]*t+o[4]*i+o[8]*s+o[12]*r,this.y=o[1]*t+o[5]*i+o[9]*s+o[13]*r,this.z=o[2]*t+o[6]*i+o[10]*s+o[14]*r,this.w=o[3]*t+o[7]*i+o[11]*s+o[15]*r,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,s,r;const l=e.elements,c=l[0],u=l[4],d=l[8],f=l[1],p=l[5],g=l[9],A=l[2],v=l[6],m=l[10];if(Math.abs(u-f)<.01&&Math.abs(d-A)<.01&&Math.abs(g-v)<.01){if(Math.abs(u+f)<.1&&Math.abs(d+A)<.1&&Math.abs(g+v)<.1&&Math.abs(c+p+m-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const y=(c+1)/2,_=(p+1)/2,E=(m+1)/2,M=(u+f)/4,I=(d+A)/4,R=(g+v)/4;return y>_&&y>E?y<.01?(i=0,s=.707106781,r=.707106781):(i=Math.sqrt(y),s=M/i,r=I/i):_>E?_<.01?(i=.707106781,s=0,r=.707106781):(s=Math.sqrt(_),i=M/s,r=R/s):E<.01?(i=.707106781,s=.707106781,r=0):(r=Math.sqrt(E),i=I/r,s=R/r),this.set(i,s,r,t),this}let b=Math.sqrt((v-g)*(v-g)+(d-A)*(d-A)+(f-u)*(f-u));return Math.abs(b)<.001&&(b=1),this.x=(v-g)/b,this.y=(d-A)/b,this.z=(f-u)/b,this.w=Math.acos((c+p+m-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class ni extends Fn{constructor(e=1,t=1,i={}){super(),this.isWebGLRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new Ke(0,0,e,t),this.scissorTest=!1,this.viewport=new Ke(0,0,e,t);const s={width:e,height:t,depth:1};i.encoding!==void 0&&(Eg("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),i.colorSpace=i.encoding===ka?Je:ur),this.texture=new Rt(s,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=i.generateMipmaps!==void 0?i.generateMipmaps:!1,this.texture.internalFormat=i.internalFormat!==void 0?i.internalFormat:null,this.texture.minFilter=i.minFilter!==void 0?i.minFilter:Dt,this.depthBuffer=i.depthBuffer!==void 0?i.depthBuffer:!0,this.stencilBuffer=i.stencilBuffer!==void 0?i.stencilBuffer:!1,this.depthTexture=i.depthTexture!==void 0?i.depthTexture:null,this.samples=i.samples!==void 0?i.samples:0}setSize(e,t,i=1){(this.width!==e||this.height!==t||this.depth!==i)&&(this.width=e,this.height=t,this.depth=i,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new Sl(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class xb extends Rt{constructor(e=null,t=1,i=1,s=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:i,depth:s},this.magFilter=Ft,this.minFilter=Ft,this.wrapR=Wn,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Rz extends ni{constructor(e=1,t=1,i=1){super(e,t),this.isWebGLArrayRenderTarget=!0,this.depth=i,this.texture=new xb(null,e,t,i),this.texture.isRenderTargetTexture=!0}}class wb extends Rt{constructor(e=null,t=1,i=1,s=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:i,depth:s},this.magFilter=Ft,this.minFilter=Ft,this.wrapR=Wn,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Pz extends ni{constructor(e=1,t=1,i=1){super(e,t),this.isWebGL3DRenderTarget=!0,this.depth=i,this.texture=new wb(null,e,t,i),this.texture.isRenderTargetTexture=!0}}class Mk extends ni{constructor(e=1,t=1,i=1,s={}){super(e,t,s),this.isWebGLMultipleRenderTargets=!0;const r=this.texture;this.texture=[];for(let o=0;o<i;o++)this.texture[o]=r.clone(),this.texture[o].isRenderTargetTexture=!0}setSize(e,t,i=1){if(this.width!==e||this.height!==t||this.depth!==i){this.width=e,this.height=t,this.depth=i;for(let s=0,r=this.texture.length;s<r;s++)this.texture[s].image.width=e,this.texture[s].image.height=t,this.texture[s].image.depth=i;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.texture.length=0;for(let t=0,i=e.texture.length;t<i;t++)this.texture[t]=e.texture[t].clone(),this.texture[t].isRenderTargetTexture=!0;return this}}class Se{constructor(e=0,t=0,i=0,s=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=s}static slerpFlat(e,t,i,s,r,o,a){let l=i[s+0],c=i[s+1],u=i[s+2],d=i[s+3];const f=r[o+0],p=r[o+1],g=r[o+2],A=r[o+3];if(a===0){e[t+0]=l,e[t+1]=c,e[t+2]=u,e[t+3]=d;return}if(a===1){e[t+0]=f,e[t+1]=p,e[t+2]=g,e[t+3]=A;return}if(d!==A||l!==f||c!==p||u!==g){let v=1-a;const m=l*f+c*p+u*g+d*A,b=m>=0?1:-1,y=1-m*m;if(y>Number.EPSILON){const E=Math.sqrt(y),M=Math.atan2(E,m*b);v=Math.sin(v*M)/E,a=Math.sin(a*M)/E}const _=a*b;if(l=l*v+f*_,c=c*v+p*_,u=u*v+g*_,d=d*v+A*_,v===1-a){const E=1/Math.sqrt(l*l+c*c+u*u+d*d);l*=E,c*=E,u*=E,d*=E}}e[t]=l,e[t+1]=c,e[t+2]=u,e[t+3]=d}static multiplyQuaternionsFlat(e,t,i,s,r,o){const a=i[s],l=i[s+1],c=i[s+2],u=i[s+3],d=r[o],f=r[o+1],p=r[o+2],g=r[o+3];return e[t]=a*g+u*d+l*p-c*f,e[t+1]=l*g+u*f+c*d-a*p,e[t+2]=c*g+u*p+a*f-l*d,e[t+3]=u*g-a*d-l*f-c*p,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,s){return this._x=e,this._y=t,this._z=i,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){const i=e._x,s=e._y,r=e._z,o=e._order,a=Math.cos,l=Math.sin,c=a(i/2),u=a(s/2),d=a(r/2),f=l(i/2),p=l(s/2),g=l(r/2);switch(o){case"XYZ":this._x=f*u*d+c*p*g,this._y=c*p*d-f*u*g,this._z=c*u*g+f*p*d,this._w=c*u*d-f*p*g;break;case"YXZ":this._x=f*u*d+c*p*g,this._y=c*p*d-f*u*g,this._z=c*u*g-f*p*d,this._w=c*u*d+f*p*g;break;case"ZXY":this._x=f*u*d-c*p*g,this._y=c*p*d+f*u*g,this._z=c*u*g+f*p*d,this._w=c*u*d-f*p*g;break;case"ZYX":this._x=f*u*d-c*p*g,this._y=c*p*d+f*u*g,this._z=c*u*g-f*p*d,this._w=c*u*d+f*p*g;break;case"YZX":this._x=f*u*d+c*p*g,this._y=c*p*d+f*u*g,this._z=c*u*g-f*p*d,this._w=c*u*d-f*p*g;break;case"XZY":this._x=f*u*d-c*p*g,this._y=c*p*d-f*u*g,this._z=c*u*g+f*p*d,this._w=c*u*d+f*p*g;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return t!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,s=Math.sin(i);return this._x=e.x*s,this._y=e.y*s,this._z=e.z*s,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],s=t[4],r=t[8],o=t[1],a=t[5],l=t[9],c=t[2],u=t[6],d=t[10],f=i+a+d;if(f>0){const p=.5/Math.sqrt(f+1);this._w=.25/p,this._x=(u-l)*p,this._y=(r-c)*p,this._z=(o-s)*p}else if(i>a&&i>d){const p=2*Math.sqrt(1+i-a-d);this._w=(u-l)/p,this._x=.25*p,this._y=(s+o)/p,this._z=(r+c)/p}else if(a>d){const p=2*Math.sqrt(1+a-i-d);this._w=(r-c)/p,this._x=(s+o)/p,this._y=.25*p,this._z=(l+u)/p}else{const p=2*Math.sqrt(1+d-i-a);this._w=(o-s)/p,this._x=(r+c)/p,this._y=(l+u)/p,this._z=.25*p}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(nn(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(i===0)return this;const s=Math.min(1,t/i);return this.slerp(e,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,s=e._y,r=e._z,o=e._w,a=t._x,l=t._y,c=t._z,u=t._w;return this._x=i*u+o*a+s*c-r*l,this._y=s*u+o*l+r*a-i*c,this._z=r*u+o*c+i*l-s*a,this._w=o*u-i*a-s*l-r*c,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const i=this._x,s=this._y,r=this._z,o=this._w;let a=o*e._w+i*e._x+s*e._y+r*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=i,this._y=s,this._z=r,this;const l=1-a*a;if(l<=Number.EPSILON){const p=1-t;return this._w=p*o+t*this._w,this._x=p*i+t*this._x,this._y=p*s+t*this._y,this._z=p*r+t*this._z,this.normalize(),this._onChangeCallback(),this}const c=Math.sqrt(l),u=Math.atan2(c,a),d=Math.sin((1-t)*u)/c,f=Math.sin(t*u)/c;return this._w=o*d+this._w*f,this._x=i*d+this._x*f,this._y=s*d+this._y*f,this._z=r*d+this._z*f,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){const e=Math.random(),t=Math.sqrt(1-e),i=Math.sqrt(e),s=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(t*Math.cos(s),i*Math.sin(r),i*Math.cos(r),t*Math.sin(s))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class w{constructor(e=0,t=0,i=0){w.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return i===void 0&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(uI.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(uI.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,s=this.z,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6]*s,this.y=r[1]*t+r[4]*i+r[7]*s,this.z=r[2]*t+r[5]*i+r[8]*s,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,s=this.z,r=e.elements,o=1/(r[3]*t+r[7]*i+r[11]*s+r[15]);return this.x=(r[0]*t+r[4]*i+r[8]*s+r[12])*o,this.y=(r[1]*t+r[5]*i+r[9]*s+r[13])*o,this.z=(r[2]*t+r[6]*i+r[10]*s+r[14])*o,this}applyQuaternion(e){const t=this.x,i=this.y,s=this.z,r=e.x,o=e.y,a=e.z,l=e.w,c=l*t+o*s-a*i,u=l*i+a*t-r*s,d=l*s+r*i-o*t,f=-r*t-o*i-a*s;return this.x=c*l+f*-r+u*-a-d*-o,this.y=u*l+f*-o+d*-r-c*-a,this.z=d*l+f*-a+c*-o-u*-r,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,s=this.z,r=e.elements;return this.x=r[0]*t+r[4]*i+r[8]*s,this.y=r[1]*t+r[5]*i+r[9]*s,this.z=r[2]*t+r[6]*i+r[10]*s,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,s=e.y,r=e.z,o=t.x,a=t.y,l=t.z;return this.x=s*l-r*a,this.y=r*o-i*l,this.z=i*a-s*o,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return wx.copy(this).projectOnVector(e),this.sub(wx)}reflect(e){return this.sub(wx.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(nn(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,s=this.z-e.z;return t*t+i*i+s*s}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const s=Math.sin(t)*e;return this.x=s*Math.sin(i),this.y=Math.cos(t)*e,this.z=s*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),s=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=s,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=(Math.random()-.5)*2,t=Math.random()*Math.PI*2,i=Math.sqrt(1-e**2);return this.x=i*Math.cos(t),this.y=i*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const wx=new w,uI=new Se;class Bn{constructor(e=new w(1/0,1/0,1/0),t=new w(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t+=3)this.expandByPoint($a.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,i=e.count;t<i;t++)this.expandByPoint($a.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=$a.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){if(e.updateWorldMatrix(!1,!1),e.boundingBox!==void 0)e.boundingBox===null&&e.computeBoundingBox(),nd.copy(e.boundingBox),nd.applyMatrix4(e.matrixWorld),this.union(nd);else{const s=e.geometry;if(s!==void 0)if(t&&s.attributes!==void 0&&s.attributes.position!==void 0){const r=s.attributes.position;for(let o=0,a=r.count;o<a;o++)$a.fromBufferAttribute(r,o).applyMatrix4(e.matrixWorld),this.expandByPoint($a)}else s.boundingBox===null&&s.computeBoundingBox(),nd.copy(s.boundingBox),nd.applyMatrix4(e.matrixWorld),this.union(nd)}const i=e.children;for(let s=0,r=i.length;s<r;s++)this.expandByObject(i[s],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,$a),$a.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Ip),HA.subVectors(this.max,Ip),sd.subVectors(e.a,Ip),rd.subVectors(e.b,Ip),od.subVectors(e.c,Ip),sc.subVectors(rd,sd),rc.subVectors(od,rd),xh.subVectors(sd,od);let t=[0,-sc.z,sc.y,0,-rc.z,rc.y,0,-xh.z,xh.y,sc.z,0,-sc.x,rc.z,0,-rc.x,xh.z,0,-xh.x,-sc.y,sc.x,0,-rc.y,rc.x,0,-xh.y,xh.x,0];return!Sx(t,sd,rd,od,HA)||(t=[1,0,0,0,1,0,0,0,1],!Sx(t,sd,rd,od,HA))?!1:(QA.crossVectors(sc,rc),t=[QA.x,QA.y,QA.z],Sx(t,sd,rd,od,HA))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,$a).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize($a).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Za[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Za[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Za[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Za[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Za[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Za[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Za[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Za[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Za),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Za=[new w,new w,new w,new w,new w,new w,new w,new w],$a=new w,nd=new Bn,sd=new w,rd=new w,od=new w,sc=new w,rc=new w,xh=new w,Ip=new w,HA=new w,QA=new w,wh=new w;function Sx(n,e,t,i,s){for(let r=0,o=n.length-3;r<=o;r+=3){wh.fromArray(n,r);const a=s.x*Math.abs(wh.x)+s.y*Math.abs(wh.y)+s.z*Math.abs(wh.z),l=e.dot(wh),c=t.dot(wh),u=i.dot(wh);if(Math.max(-Math.max(l,c,u),Math.min(l,c,u))>a)return!1}return!0}const Bz=new Bn,Rp=new w,Cx=new w;class Ys{constructor(e=new w,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const i=this.center;t!==void 0?i.copy(t):Bz.setFromPoints(e).getCenter(i);let s=0;for(let r=0,o=e.length;r<o;r++)s=Math.max(s,i.distanceToSquared(e[r]));return this.radius=Math.sqrt(s),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Rp.subVectors(e,this.center);const t=Rp.lengthSq();if(t>this.radius*this.radius){const i=Math.sqrt(t),s=(i-this.radius)*.5;this.center.addScaledVector(Rp,s/i),this.radius+=s}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(Cx.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Rp.copy(e.center).add(Cx)),this.expandByPoint(Rp.copy(e.center).sub(Cx))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const el=new w,Ex=new w,WA=new w,oc=new w,Mx=new w,jA=new w,Tx=new w;class Qa{constructor(e=new w,t=new w(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,el)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=el.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(el.copy(this.origin).addScaledVector(this.direction,t),el.distanceToSquared(e))}distanceSqToSegment(e,t,i,s){Ex.copy(e).add(t).multiplyScalar(.5),WA.copy(t).sub(e).normalize(),oc.copy(this.origin).sub(Ex);const r=e.distanceTo(t)*.5,o=-this.direction.dot(WA),a=oc.dot(this.direction),l=-oc.dot(WA),c=oc.lengthSq(),u=Math.abs(1-o*o);let d,f,p,g;if(u>0)if(d=o*l-a,f=o*a-l,g=r*u,d>=0)if(f>=-g)if(f<=g){const A=1/u;d*=A,f*=A,p=d*(d+o*f+2*a)+f*(o*d+f+2*l)+c}else f=r,d=Math.max(0,-(o*f+a)),p=-d*d+f*(f+2*l)+c;else f=-r,d=Math.max(0,-(o*f+a)),p=-d*d+f*(f+2*l)+c;else f<=-g?(d=Math.max(0,-(-o*r+a)),f=d>0?-r:Math.min(Math.max(-r,-l),r),p=-d*d+f*(f+2*l)+c):f<=g?(d=0,f=Math.min(Math.max(-r,-l),r),p=f*(f+2*l)+c):(d=Math.max(0,-(o*r+a)),f=d>0?r:Math.min(Math.max(-r,-l),r),p=-d*d+f*(f+2*l)+c);else f=o>0?-r:r,d=Math.max(0,-(o*f+a)),p=-d*d+f*(f+2*l)+c;return i&&i.copy(this.origin).addScaledVector(this.direction,d),s&&s.copy(Ex).addScaledVector(WA,f),p}intersectSphere(e,t){el.subVectors(e.center,this.origin);const i=el.dot(this.direction),s=el.dot(el)-i*i,r=e.radius*e.radius;if(s>r)return null;const o=Math.sqrt(r-s),a=i-o,l=i+o;return l<0?null:a<0?this.at(l,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){const i=this.distanceToPlane(e);return i===null?null:this.at(i,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,s,r,o,a,l;const c=1/this.direction.x,u=1/this.direction.y,d=1/this.direction.z,f=this.origin;return c>=0?(i=(e.min.x-f.x)*c,s=(e.max.x-f.x)*c):(i=(e.max.x-f.x)*c,s=(e.min.x-f.x)*c),u>=0?(r=(e.min.y-f.y)*u,o=(e.max.y-f.y)*u):(r=(e.max.y-f.y)*u,o=(e.min.y-f.y)*u),i>o||r>s||((r>i||isNaN(i))&&(i=r),(o<s||isNaN(s))&&(s=o),d>=0?(a=(e.min.z-f.z)*d,l=(e.max.z-f.z)*d):(a=(e.max.z-f.z)*d,l=(e.min.z-f.z)*d),i>l||a>s)||((a>i||i!==i)&&(i=a),(l<s||s!==s)&&(s=l),s<0)?null:this.at(i>=0?i:s,t)}intersectsBox(e){return this.intersectBox(e,el)!==null}intersectTriangle(e,t,i,s,r){Mx.subVectors(t,e),jA.subVectors(i,e),Tx.crossVectors(Mx,jA);let o=this.direction.dot(Tx),a;if(o>0){if(s)return null;a=1}else if(o<0)a=-1,o=-o;else return null;oc.subVectors(this.origin,e);const l=a*this.direction.dot(jA.crossVectors(oc,jA));if(l<0)return null;const c=a*this.direction.dot(Mx.cross(oc));if(c<0||l+c>o)return null;const u=-a*oc.dot(Tx);return u<0?null:this.at(u/o,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class Ie{constructor(e,t,i,s,r,o,a,l,c,u,d,f,p,g,A,v){Ie.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,i,s,r,o,a,l,c,u,d,f,p,g,A,v)}set(e,t,i,s,r,o,a,l,c,u,d,f,p,g,A,v){const m=this.elements;return m[0]=e,m[4]=t,m[8]=i,m[12]=s,m[1]=r,m[5]=o,m[9]=a,m[13]=l,m[2]=c,m[6]=u,m[10]=d,m[14]=f,m[3]=p,m[7]=g,m[11]=A,m[15]=v,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Ie().fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,i=e.elements,s=1/ad.setFromMatrixColumn(e,0).length(),r=1/ad.setFromMatrixColumn(e,1).length(),o=1/ad.setFromMatrixColumn(e,2).length();return t[0]=i[0]*s,t[1]=i[1]*s,t[2]=i[2]*s,t[3]=0,t[4]=i[4]*r,t[5]=i[5]*r,t[6]=i[6]*r,t[7]=0,t[8]=i[8]*o,t[9]=i[9]*o,t[10]=i[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,i=e.x,s=e.y,r=e.z,o=Math.cos(i),a=Math.sin(i),l=Math.cos(s),c=Math.sin(s),u=Math.cos(r),d=Math.sin(r);if(e.order==="XYZ"){const f=o*u,p=o*d,g=a*u,A=a*d;t[0]=l*u,t[4]=-l*d,t[8]=c,t[1]=p+g*c,t[5]=f-A*c,t[9]=-a*l,t[2]=A-f*c,t[6]=g+p*c,t[10]=o*l}else if(e.order==="YXZ"){const f=l*u,p=l*d,g=c*u,A=c*d;t[0]=f+A*a,t[4]=g*a-p,t[8]=o*c,t[1]=o*d,t[5]=o*u,t[9]=-a,t[2]=p*a-g,t[6]=A+f*a,t[10]=o*l}else if(e.order==="ZXY"){const f=l*u,p=l*d,g=c*u,A=c*d;t[0]=f-A*a,t[4]=-o*d,t[8]=g+p*a,t[1]=p+g*a,t[5]=o*u,t[9]=A-f*a,t[2]=-o*c,t[6]=a,t[10]=o*l}else if(e.order==="ZYX"){const f=o*u,p=o*d,g=a*u,A=a*d;t[0]=l*u,t[4]=g*c-p,t[8]=f*c+A,t[1]=l*d,t[5]=A*c+f,t[9]=p*c-g,t[2]=-c,t[6]=a*l,t[10]=o*l}else if(e.order==="YZX"){const f=o*l,p=o*c,g=a*l,A=a*c;t[0]=l*u,t[4]=A-f*d,t[8]=g*d+p,t[1]=d,t[5]=o*u,t[9]=-a*u,t[2]=-c*u,t[6]=p*d+g,t[10]=f-A*d}else if(e.order==="XZY"){const f=o*l,p=o*c,g=a*l,A=a*c;t[0]=l*u,t[4]=-d,t[8]=c*u,t[1]=f*d+A,t[5]=o*u,t[9]=p*d-g,t[2]=g*d-p,t[6]=a*u,t[10]=A*d+f}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(Dz,e,Oz)}lookAt(e,t,i){const s=this.elements;return br.subVectors(e,t),br.lengthSq()===0&&(br.z=1),br.normalize(),ac.crossVectors(i,br),ac.lengthSq()===0&&(Math.abs(i.z)===1?br.x+=1e-4:br.z+=1e-4,br.normalize(),ac.crossVectors(i,br)),ac.normalize(),qA.crossVectors(br,ac),s[0]=ac.x,s[4]=qA.x,s[8]=br.x,s[1]=ac.y,s[5]=qA.y,s[9]=br.y,s[2]=ac.z,s[6]=qA.z,s[10]=br.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,s=t.elements,r=this.elements,o=i[0],a=i[4],l=i[8],c=i[12],u=i[1],d=i[5],f=i[9],p=i[13],g=i[2],A=i[6],v=i[10],m=i[14],b=i[3],y=i[7],_=i[11],E=i[15],M=s[0],I=s[4],R=s[8],C=s[12],T=s[1],O=s[5],J=s[9],V=s[13],H=s[2],Y=s[6],N=s[10],L=s[14],G=s[3],ee=s[7],$=s[11],j=s[15];return r[0]=o*M+a*T+l*H+c*G,r[4]=o*I+a*O+l*Y+c*ee,r[8]=o*R+a*J+l*N+c*$,r[12]=o*C+a*V+l*L+c*j,r[1]=u*M+d*T+f*H+p*G,r[5]=u*I+d*O+f*Y+p*ee,r[9]=u*R+d*J+f*N+p*$,r[13]=u*C+d*V+f*L+p*j,r[2]=g*M+A*T+v*H+m*G,r[6]=g*I+A*O+v*Y+m*ee,r[10]=g*R+A*J+v*N+m*$,r[14]=g*C+A*V+v*L+m*j,r[3]=b*M+y*T+_*H+E*G,r[7]=b*I+y*O+_*Y+E*ee,r[11]=b*R+y*J+_*N+E*$,r[15]=b*C+y*V+_*L+E*j,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],s=e[8],r=e[12],o=e[1],a=e[5],l=e[9],c=e[13],u=e[2],d=e[6],f=e[10],p=e[14],g=e[3],A=e[7],v=e[11],m=e[15];return g*(+r*l*d-s*c*d-r*a*f+i*c*f+s*a*p-i*l*p)+A*(+t*l*p-t*c*f+r*o*f-s*o*p+s*c*u-r*l*u)+v*(+t*c*d-t*a*p-r*o*d+i*o*p+r*a*u-i*c*u)+m*(-s*a*u-t*l*d+t*a*f+s*o*d-i*o*f+i*l*u)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const s=this.elements;return e.isVector3?(s[12]=e.x,s[13]=e.y,s[14]=e.z):(s[12]=e,s[13]=t,s[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],s=e[2],r=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],d=e[9],f=e[10],p=e[11],g=e[12],A=e[13],v=e[14],m=e[15],b=d*v*c-A*f*c+A*l*p-a*v*p-d*l*m+a*f*m,y=g*f*c-u*v*c-g*l*p+o*v*p+u*l*m-o*f*m,_=u*A*c-g*d*c+g*a*p-o*A*p-u*a*m+o*d*m,E=g*d*l-u*A*l-g*a*f+o*A*f+u*a*v-o*d*v,M=t*b+i*y+s*_+r*E;if(M===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const I=1/M;return e[0]=b*I,e[1]=(A*f*r-d*v*r-A*s*p+i*v*p+d*s*m-i*f*m)*I,e[2]=(a*v*r-A*l*r+A*s*c-i*v*c-a*s*m+i*l*m)*I,e[3]=(d*l*r-a*f*r-d*s*c+i*f*c+a*s*p-i*l*p)*I,e[4]=y*I,e[5]=(u*v*r-g*f*r+g*s*p-t*v*p-u*s*m+t*f*m)*I,e[6]=(g*l*r-o*v*r-g*s*c+t*v*c+o*s*m-t*l*m)*I,e[7]=(o*f*r-u*l*r+u*s*c-t*f*c-o*s*p+t*l*p)*I,e[8]=_*I,e[9]=(g*d*r-u*A*r-g*i*p+t*A*p+u*i*m-t*d*m)*I,e[10]=(o*A*r-g*a*r+g*i*c-t*A*c-o*i*m+t*a*m)*I,e[11]=(u*a*r-o*d*r-u*i*c+t*d*c+o*i*p-t*a*p)*I,e[12]=E*I,e[13]=(u*A*s-g*d*s+g*i*f-t*A*f-u*i*v+t*d*v)*I,e[14]=(g*a*s-o*A*s-g*i*l+t*A*l+o*i*v-t*a*v)*I,e[15]=(o*d*s-u*a*s+u*i*l-t*d*l-o*i*f+t*a*f)*I,this}scale(e){const t=this.elements,i=e.x,s=e.y,r=e.z;return t[0]*=i,t[4]*=s,t[8]*=r,t[1]*=i,t[5]*=s,t[9]*=r,t[2]*=i,t[6]*=s,t[10]*=r,t[3]*=i,t[7]*=s,t[11]*=r,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],s=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,s))}makeTranslation(e,t,i){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),s=Math.sin(t),r=1-i,o=e.x,a=e.y,l=e.z,c=r*o,u=r*a;return this.set(c*o+i,c*a-s*l,c*l+s*a,0,c*a+s*l,u*a+i,u*l-s*o,0,c*l-s*a,u*l+s*o,r*l*l+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,s,r,o){return this.set(1,i,r,0,e,1,o,0,t,s,1,0,0,0,0,1),this}compose(e,t,i){const s=this.elements,r=t._x,o=t._y,a=t._z,l=t._w,c=r+r,u=o+o,d=a+a,f=r*c,p=r*u,g=r*d,A=o*u,v=o*d,m=a*d,b=l*c,y=l*u,_=l*d,E=i.x,M=i.y,I=i.z;return s[0]=(1-(A+m))*E,s[1]=(p+_)*E,s[2]=(g-y)*E,s[3]=0,s[4]=(p-_)*M,s[5]=(1-(f+m))*M,s[6]=(v+b)*M,s[7]=0,s[8]=(g+y)*I,s[9]=(v-b)*I,s[10]=(1-(f+A))*I,s[11]=0,s[12]=e.x,s[13]=e.y,s[14]=e.z,s[15]=1,this}decompose(e,t,i){const s=this.elements;let r=ad.set(s[0],s[1],s[2]).length();const o=ad.set(s[4],s[5],s[6]).length(),a=ad.set(s[8],s[9],s[10]).length();this.determinant()<0&&(r=-r),e.x=s[12],e.y=s[13],e.z=s[14],Ro.copy(this);const c=1/r,u=1/o,d=1/a;return Ro.elements[0]*=c,Ro.elements[1]*=c,Ro.elements[2]*=c,Ro.elements[4]*=u,Ro.elements[5]*=u,Ro.elements[6]*=u,Ro.elements[8]*=d,Ro.elements[9]*=d,Ro.elements[10]*=d,t.setFromRotationMatrix(Ro),i.x=r,i.y=o,i.z=a,this}makePerspective(e,t,i,s,r,o,a=Ba){const l=this.elements,c=2*r/(t-e),u=2*r/(i-s),d=(t+e)/(t-e),f=(i+s)/(i-s);let p,g;if(a===Ba)p=-(o+r)/(o-r),g=-2*o*r/(o-r);else if(a===mm)p=-o/(o-r),g=-o*r/(o-r);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);return l[0]=c,l[4]=0,l[8]=d,l[12]=0,l[1]=0,l[5]=u,l[9]=f,l[13]=0,l[2]=0,l[6]=0,l[10]=p,l[14]=g,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(e,t,i,s,r,o,a=Ba){const l=this.elements,c=1/(t-e),u=1/(i-s),d=1/(o-r),f=(t+e)*c,p=(i+s)*u;let g,A;if(a===Ba)g=(o+r)*d,A=-2*d;else if(a===mm)g=r*d,A=-1*d;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return l[0]=2*c,l[4]=0,l[8]=0,l[12]=-f,l[1]=0,l[5]=2*u,l[9]=0,l[13]=-p,l[2]=0,l[6]=0,l[10]=A,l[14]=-g,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let s=0;s<16;s++)if(t[s]!==i[s])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}const ad=new w,Ro=new Ie,Dz=new w(0,0,0),Oz=new w(1,1,1),ac=new w,qA=new w,br=new w,dI=new Ie,fI=new Se;class pn{constructor(e=0,t=0,i=0,s=pn.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=i,this._order=s}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,s=this._order){return this._x=e,this._y=t,this._z=i,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){const s=e.elements,r=s[0],o=s[4],a=s[8],l=s[1],c=s[5],u=s[9],d=s[2],f=s[6],p=s[10];switch(t){case"XYZ":this._y=Math.asin(nn(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-u,p),this._z=Math.atan2(-o,r)):(this._x=Math.atan2(f,c),this._z=0);break;case"YXZ":this._x=Math.asin(-nn(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(a,p),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-d,r),this._z=0);break;case"ZXY":this._x=Math.asin(nn(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(-d,p),this._z=Math.atan2(-o,c)):(this._y=0,this._z=Math.atan2(l,r));break;case"ZYX":this._y=Math.asin(-nn(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(f,p),this._z=Math.atan2(l,r)):(this._x=0,this._z=Math.atan2(-o,c));break;case"YZX":this._z=Math.asin(nn(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-d,r)):(this._x=0,this._y=Math.atan2(a,p));break;case"XZY":this._z=Math.asin(-nn(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(f,c),this._y=Math.atan2(a,r)):(this._x=Math.atan2(-u,p),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,i===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return dI.makeRotationFromQuaternion(e),this.setFromRotationMatrix(dI,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return fI.setFromEuler(this),this.setFromQuaternion(fI,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}pn.DEFAULT_ORDER="XYZ";class Ss{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let kz=0;const pI=new w,ld=new Se,tl=new Ie,XA=new w,Pp=new w,Lz=new w,Fz=new Se,gI=new w(1,0,0),mI=new w(0,1,0),AI=new w(0,0,1),Uz={type:"added"},vI={type:"removed"};class Me extends Fn{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:kz++}),this.uuid=Lr(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Me.DEFAULT_UP.clone();const e=new w,t=new pn,i=new Se,s=new w(1,1,1);function r(){i.setFromEuler(t,!1)}function o(){t.setFromQuaternion(i,void 0,!1)}t._onChange(r),i._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new Ie},normalMatrix:{value:new It}}),this.matrix=new Ie,this.matrixWorld=new Ie,this.matrixAutoUpdate=Me.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=Me.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new Ss,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return ld.setFromAxisAngle(e,t),this.quaternion.multiply(ld),this}rotateOnWorldAxis(e,t){return ld.setFromAxisAngle(e,t),this.quaternion.premultiply(ld),this}rotateX(e){return this.rotateOnAxis(gI,e)}rotateY(e){return this.rotateOnAxis(mI,e)}rotateZ(e){return this.rotateOnAxis(AI,e)}translateOnAxis(e,t){return pI.copy(e).applyQuaternion(this.quaternion),this.position.add(pI.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(gI,e)}translateY(e){return this.translateOnAxis(mI,e)}translateZ(e){return this.translateOnAxis(AI,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(tl.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?XA.copy(e):XA.set(e,t,i);const s=this.parent;this.updateWorldMatrix(!0,!1),Pp.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?tl.lookAt(Pp,XA,this.up):tl.lookAt(XA,Pp,this.up),this.quaternion.setFromRotationMatrix(tl),s&&(tl.extractRotation(s.matrixWorld),ld.setFromRotationMatrix(tl),this.quaternion.premultiply(ld.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(Uz)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(vI)),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(vI)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),tl.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),tl.multiply(e.parent.matrixWorld)),e.applyMatrix4(tl),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,s=this.children.length;i<s;i++){const o=this.children[i].getObjectByProperty(e,t);if(o!==void 0)return o}}getObjectsByProperty(e,t){let i=[];this[e]===t&&i.push(this);for(let s=0,r=this.children.length;s<r;s++){const o=this.children[s].getObjectsByProperty(e,t);o.length>0&&(i=i.concat(o))}return i}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Pp,e,Lz),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Pp,Fz,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let i=0,s=t.length;i<s;i++)t[i].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let i=0,s=t.length;i<s;i++)t[i].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let i=0,s=t.length;i<s;i++){const r=t[i];(r.matrixWorldAutoUpdate===!0||e===!0)&&r.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const i=this.parent;if(e===!0&&i!==null&&i.matrixWorldAutoUpdate===!0&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){const s=this.children;for(let r=0,o=s.length;r<o;r++){const a=s[r];a.matrixWorldAutoUpdate===!0&&a.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=e===void 0||typeof e=="string",i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const s={};s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.castShadow===!0&&(s.castShadow=!0),this.receiveShadow===!0&&(s.receiveShadow=!0),this.visible===!1&&(s.visible=!1),this.frustumCulled===!1&&(s.frustumCulled=!1),this.renderOrder!==0&&(s.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),s.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(s.instanceColor=this.instanceColor.toJSON()));function r(a,l){return a[l.uuid]===void 0&&(a[l.uuid]=l.toJSON(e)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(s.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=r(e.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const l=a.shapes;if(Array.isArray(l))for(let c=0,u=l.length;c<u;c++){const d=l[c];r(e.shapes,d)}else r(e.shapes,l)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(r(e.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let l=0,c=this.material.length;l<c;l++)a.push(r(e.materials,this.material[l]));s.material=a}else s.material=r(e.materials,this.material);if(this.children.length>0){s.children=[];for(let a=0;a<this.children.length;a++)s.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){s.animations=[];for(let a=0;a<this.animations.length;a++){const l=this.animations[a];s.animations.push(r(e.animations,l))}}if(t){const a=o(e.geometries),l=o(e.materials),c=o(e.textures),u=o(e.images),d=o(e.shapes),f=o(e.skeletons),p=o(e.animations),g=o(e.nodes);a.length>0&&(i.geometries=a),l.length>0&&(i.materials=l),c.length>0&&(i.textures=c),u.length>0&&(i.images=u),d.length>0&&(i.shapes=d),f.length>0&&(i.skeletons=f),p.length>0&&(i.animations=p),g.length>0&&(i.nodes=g)}return i.object=s,i;function o(a){const l=[];for(const c in a){const u=a[c];delete u.metadata,l.push(u)}return l}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations,this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let i=0;i<e.children.length;i++){const s=e.children[i];this.add(s.clone())}return this}}Me.DEFAULT_UP=new w(0,1,0);Me.DEFAULT_MATRIX_AUTO_UPDATE=!0;Me.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Po=new w,il=new w,Ix=new w,nl=new w,cd=new w,hd=new w,yI=new w,Rx=new w,Px=new w,Bx=new w;let YA=!1;class Vs{constructor(e=new w,t=new w,i=new w){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,s){s.subVectors(i,t),Po.subVectors(e,t),s.cross(Po);const r=s.lengthSq();return r>0?s.multiplyScalar(1/Math.sqrt(r)):s.set(0,0,0)}static getBarycoord(e,t,i,s,r){Po.subVectors(s,t),il.subVectors(i,t),Ix.subVectors(e,t);const o=Po.dot(Po),a=Po.dot(il),l=Po.dot(Ix),c=il.dot(il),u=il.dot(Ix),d=o*c-a*a;if(d===0)return r.set(-2,-1,-1);const f=1/d,p=(c*l-a*u)*f,g=(o*u-a*l)*f;return r.set(1-p-g,g,p)}static containsPoint(e,t,i,s){return this.getBarycoord(e,t,i,s,nl),nl.x>=0&&nl.y>=0&&nl.x+nl.y<=1}static getUV(e,t,i,s,r,o,a,l){return YA===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),YA=!0),this.getInterpolation(e,t,i,s,r,o,a,l)}static getInterpolation(e,t,i,s,r,o,a,l){return this.getBarycoord(e,t,i,s,nl),l.setScalar(0),l.addScaledVector(r,nl.x),l.addScaledVector(o,nl.y),l.addScaledVector(a,nl.z),l}static isFrontFacing(e,t,i,s){return Po.subVectors(i,t),il.subVectors(e,t),Po.cross(il).dot(s)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,s){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[s]),this}setFromAttributeAndIndices(e,t,i,s){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,s),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Po.subVectors(this.c,this.b),il.subVectors(this.a,this.b),Po.cross(il).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Vs.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Vs.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,i,s,r){return YA===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),YA=!0),Vs.getInterpolation(e,this.a,this.b,this.c,t,i,s,r)}getInterpolation(e,t,i,s,r){return Vs.getInterpolation(e,this.a,this.b,this.c,t,i,s,r)}containsPoint(e){return Vs.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Vs.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const i=this.a,s=this.b,r=this.c;let o,a;cd.subVectors(s,i),hd.subVectors(r,i),Rx.subVectors(e,i);const l=cd.dot(Rx),c=hd.dot(Rx);if(l<=0&&c<=0)return t.copy(i);Px.subVectors(e,s);const u=cd.dot(Px),d=hd.dot(Px);if(u>=0&&d<=u)return t.copy(s);const f=l*d-u*c;if(f<=0&&l>=0&&u<=0)return o=l/(l-u),t.copy(i).addScaledVector(cd,o);Bx.subVectors(e,r);const p=cd.dot(Bx),g=hd.dot(Bx);if(g>=0&&p<=g)return t.copy(r);const A=p*c-l*g;if(A<=0&&c>=0&&g<=0)return a=c/(c-g),t.copy(i).addScaledVector(hd,a);const v=u*g-p*d;if(v<=0&&d-u>=0&&p-g>=0)return yI.subVectors(r,s),a=(d-u)/(d-u+(p-g)),t.copy(s).addScaledVector(yI,a);const m=1/(v+A+f);return o=A*m,a=f*m,t.copy(i).addScaledVector(cd,o).addScaledVector(hd,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let Nz=0;class Pt extends Fn{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Nz++}),this.uuid=Lr(),this.name="",this.type="Material",this.blending=Lc,this.side=Es,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=FE,this.blendDst=UE,this.blendEquation=Hh,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=Tf,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=$E,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Sg,this.stencilZFail=Sg,this.stencilZPass=Sg,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const i=e[t];if(i===void 0){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const s=this[t];if(s===void 0){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}s&&s.isColor?s.set(i):s&&s.isVector3&&i&&i.isVector3?s.copy(i):this[t]=i}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const i={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(i.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(i.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(i.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==Lc&&(i.blending=this.blending),this.side!==Es&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaHash===!0&&(i.alphaHash=this.alphaHash),this.alphaToCoverage===!0&&(i.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=this.premultipliedAlpha),this.forceSinglePass===!0&&(i.forceSinglePass=this.forceSinglePass),this.wireframe===!0&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=this.flatShading),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function s(r){const o=[];for(const a in r){const l=r[a];delete l.metadata,o.push(l)}return o}if(t){const r=s(e.textures),o=s(e.images);r.length>0&&(i.textures=r),o.length>0&&(i.images=o)}return i}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let i=null;if(t!==null){const s=t.length;i=new Array(s);for(let r=0;r!==s;++r)i[r]=t[r].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}const Tk={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Bo={h:0,s:0,l:0},JA={h:0,s:0,l:0};function Dx(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*6*(2/3-t):n}class _e{constructor(e,t,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,i)}set(e,t,i){if(t===void 0&&i===void 0){const s=e;s&&s.isColor?this.copy(s):typeof s=="number"?this.setHex(s):typeof s=="string"&&this.setStyle(s)}else this.setRGB(e,t,i);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=Je){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,io.toWorkingColorSpace(this,t),this}setRGB(e,t,i,s=io.workingColorSpace){return this.r=e,this.g=t,this.b=i,io.toWorkingColorSpace(this,s),this}setHSL(e,t,i,s=io.workingColorSpace){if(e=eM(e,1),t=nn(t,0,1),i=nn(i,0,1),t===0)this.r=this.g=this.b=i;else{const r=i<=.5?i*(1+t):i+t-i*t,o=2*i-r;this.r=Dx(o,r,e+1/3),this.g=Dx(o,r,e),this.b=Dx(o,r,e-1/3)}return io.toWorkingColorSpace(this,s),this}setStyle(e,t=Je){function i(r){r!==void 0&&parseFloat(r)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let s;if(s=/^(\w+)\(([^\)]*)\)/.exec(e)){let r;const o=s[1],a=s[2];switch(o){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(r[4]),this.setRGB(Math.min(255,parseInt(r[1],10))/255,Math.min(255,parseInt(r[2],10))/255,Math.min(255,parseInt(r[3],10))/255,t);if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(r[4]),this.setRGB(Math.min(100,parseInt(r[1],10))/100,Math.min(100,parseInt(r[2],10))/100,Math.min(100,parseInt(r[3],10))/100,t);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(r[4]),this.setHSL(parseFloat(r[1])/360,parseFloat(r[2])/100,parseFloat(r[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(s=/^\#([A-Fa-f\d]+)$/.exec(e)){const r=s[1],o=r.length;if(o===3)return this.setRGB(parseInt(r.charAt(0),16)/15,parseInt(r.charAt(1),16)/15,parseInt(r.charAt(2),16)/15,t);if(o===6)return this.setHex(parseInt(r,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=Je){const i=Tk[e.toLowerCase()];return i!==void 0?this.setHex(i,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=ff(e.r),this.g=ff(e.g),this.b=ff(e.b),this}copyLinearToSRGB(e){return this.r=_x(e.r),this.g=_x(e.g),this.b=_x(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Je){return io.fromWorkingColorSpace(As.copy(this),e),Math.round(nn(As.r*255,0,255))*65536+Math.round(nn(As.g*255,0,255))*256+Math.round(nn(As.b*255,0,255))}getHexString(e=Je){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=io.workingColorSpace){io.fromWorkingColorSpace(As.copy(this),t);const i=As.r,s=As.g,r=As.b,o=Math.max(i,s,r),a=Math.min(i,s,r);let l,c;const u=(a+o)/2;if(a===o)l=0,c=0;else{const d=o-a;switch(c=u<=.5?d/(o+a):d/(2-o-a),o){case i:l=(s-r)/d+(s<r?6:0);break;case s:l=(r-i)/d+2;break;case r:l=(i-s)/d+4;break}l/=6}return e.h=l,e.s=c,e.l=u,e}getRGB(e,t=io.workingColorSpace){return io.fromWorkingColorSpace(As.copy(this),t),e.r=As.r,e.g=As.g,e.b=As.b,e}getStyle(e=Je){io.fromWorkingColorSpace(As.copy(this),e);const t=As.r,i=As.g,s=As.b;return e!==Je?`color(${e} ${t.toFixed(3)} ${i.toFixed(3)} ${s.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(i*255)},${Math.round(s*255)})`}offsetHSL(e,t,i){return this.getHSL(Bo),Bo.h+=e,Bo.s+=t,Bo.l+=i,this.setHSL(Bo.h,Bo.s,Bo.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(Bo),e.getHSL(JA);const i=Cg(Bo.h,JA.h,t),s=Cg(Bo.s,JA.s,t),r=Cg(Bo.l,JA.l,t);return this.setHSL(i,s,r),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,i=this.g,s=this.b,r=e.elements;return this.r=r[0]*t+r[3]*i+r[6]*s,this.g=r[1]*t+r[4]*i+r[7]*s,this.b=r[2]*t+r[5]*i+r[8]*s,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const As=new _e;_e.NAMES=Tk;class ai extends Pt{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new _e(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Ym,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const yl=zz();function zz(){const n=new ArrayBuffer(4),e=new Float32Array(n),t=new Uint32Array(n),i=new Uint32Array(512),s=new Uint32Array(512);for(let l=0;l<256;++l){const c=l-127;c<-27?(i[l]=0,i[l|256]=32768,s[l]=24,s[l|256]=24):c<-14?(i[l]=1024>>-c-14,i[l|256]=1024>>-c-14|32768,s[l]=-c-1,s[l|256]=-c-1):c<=15?(i[l]=c+15<<10,i[l|256]=c+15<<10|32768,s[l]=13,s[l|256]=13):c<128?(i[l]=31744,i[l|256]=64512,s[l]=24,s[l|256]=24):(i[l]=31744,i[l|256]=64512,s[l]=13,s[l|256]=13)}const r=new Uint32Array(2048),o=new Uint32Array(64),a=new Uint32Array(64);for(let l=1;l<1024;++l){let c=l<<13,u=0;for(;!(c&8388608);)c<<=1,u-=8388608;c&=-8388609,u+=947912704,r[l]=c|u}for(let l=1024;l<2048;++l)r[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)o[l]=l<<23;o[31]=1199570944,o[32]=2147483648;for(let l=33;l<63;++l)o[l]=2147483648+(l-32<<23);o[63]=3347054592;for(let l=1;l<64;++l)l!==32&&(a[l]=1024);return{floatView:e,uint32View:t,baseTable:i,shiftTable:s,mantissaTable:r,exponentTable:o,offsetTable:a}}function ir(n){Math.abs(n)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),n=nn(n,-65504,65504),yl.floatView[0]=n;const e=yl.uint32View[0],t=e>>23&511;return yl.baseTable[t]+((e&8388607)>>yl.shiftTable[t])}function lg(n){const e=n>>10;return yl.uint32View[0]=yl.mantissaTable[yl.offsetTable[e]+(n&1023)]+yl.exponentTable[e],yl.floatView[0]}const ru={toHalfFloat:ir,fromHalfFloat:lg},An=new w,KA=new te;class ot{constructor(e,t,i=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=i,this.usage=gm,this.updateRange={offset:0,count:-1},this.gpuType=sn,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let s=0,r=this.itemSize;s<r;s++)this.array[e+s]=t.array[i+s];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,i=this.count;t<i;t++)KA.fromBufferAttribute(this,t),KA.applyMatrix3(e),this.setXY(t,KA.x,KA.y);else if(this.itemSize===3)for(let t=0,i=this.count;t<i;t++)An.fromBufferAttribute(this,t),An.applyMatrix3(e),this.setXYZ(t,An.x,An.y,An.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)An.fromBufferAttribute(this,t),An.applyMatrix4(e),this.setXYZ(t,An.x,An.y,An.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)An.fromBufferAttribute(this,t),An.applyNormalMatrix(e),this.setXYZ(t,An.x,An.y,An.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)An.fromBufferAttribute(this,t),An.transformDirection(e),this.setXYZ(t,An.x,An.y,An.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=Dr(t,this.array)),t}setX(e,t){return this.normalized&&(t=Ut(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=Dr(t,this.array)),t}setY(e,t){return this.normalized&&(t=Ut(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=Dr(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Ut(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=Dr(t,this.array)),t}setW(e,t){return this.normalized&&(t=Ut(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=Ut(t,this.array),i=Ut(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,s){return e*=this.itemSize,this.normalized&&(t=Ut(t,this.array),i=Ut(i,this.array),s=Ut(s,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=s,this}setXYZW(e,t,i,s,r){return e*=this.itemSize,this.normalized&&(t=Ut(t,this.array),i=Ut(i,this.array),s=Ut(s,this.array),r=Ut(r,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=s,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==gm&&(e.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(e.updateRange=this.updateRange),e}}class Gz extends ot{constructor(e,t,i){super(new Int8Array(e),t,i)}}class Vz extends ot{constructor(e,t,i){super(new Uint8Array(e),t,i)}}class Hz extends ot{constructor(e,t,i){super(new Uint8ClampedArray(e),t,i)}}class Qz extends ot{constructor(e,t,i){super(new Int16Array(e),t,i)}}class iM extends ot{constructor(e,t,i){super(new Uint16Array(e),t,i)}}class Wz extends ot{constructor(e,t,i){super(new Int32Array(e),t,i)}}class nM extends ot{constructor(e,t,i){super(new Uint32Array(e),t,i)}}class jz extends ot{constructor(e,t,i){super(new Uint16Array(e),t,i),this.isFloat16BufferAttribute=!0}getX(e){let t=lg(this.array[e*this.itemSize]);return this.normalized&&(t=Dr(t,this.array)),t}setX(e,t){return this.normalized&&(t=Ut(t,this.array)),this.array[e*this.itemSize]=ir(t),this}getY(e){let t=lg(this.array[e*this.itemSize+1]);return this.normalized&&(t=Dr(t,this.array)),t}setY(e,t){return this.normalized&&(t=Ut(t,this.array)),this.array[e*this.itemSize+1]=ir(t),this}getZ(e){let t=lg(this.array[e*this.itemSize+2]);return this.normalized&&(t=Dr(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Ut(t,this.array)),this.array[e*this.itemSize+2]=ir(t),this}getW(e){let t=lg(this.array[e*this.itemSize+3]);return this.normalized&&(t=Dr(t,this.array)),t}setW(e,t){return this.normalized&&(t=Ut(t,this.array)),this.array[e*this.itemSize+3]=ir(t),this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=Ut(t,this.array),i=Ut(i,this.array)),this.array[e+0]=ir(t),this.array[e+1]=ir(i),this}setXYZ(e,t,i,s){return e*=this.itemSize,this.normalized&&(t=Ut(t,this.array),i=Ut(i,this.array),s=Ut(s,this.array)),this.array[e+0]=ir(t),this.array[e+1]=ir(i),this.array[e+2]=ir(s),this}setXYZW(e,t,i,s,r){return e*=this.itemSize,this.normalized&&(t=Ut(t,this.array),i=Ut(i,this.array),s=Ut(s,this.array),r=Ut(r,this.array)),this.array[e+0]=ir(t),this.array[e+1]=ir(i),this.array[e+2]=ir(s),this.array[e+3]=ir(r),this}}class st extends ot{constructor(e,t,i){super(new Float32Array(e),t,i)}}class qz extends ot{constructor(e,t,i){super(new Float64Array(e),t,i)}}let Xz=0;const Jr=new Ie,Ox=new Me,ud=new w,_r=new Bn,Bp=new Bn,Nn=new w;class ft extends Fn{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Xz++}),this.uuid=Lr(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(Ek(e)?nM:iM)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const i=this.attributes.normal;if(i!==void 0){const r=new It().getNormalMatrix(e);i.applyNormalMatrix(r),i.needsUpdate=!0}const s=this.attributes.tangent;return s!==void 0&&(s.transformDirection(e),s.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Jr.makeRotationFromQuaternion(e),this.applyMatrix4(Jr),this}rotateX(e){return Jr.makeRotationX(e),this.applyMatrix4(Jr),this}rotateY(e){return Jr.makeRotationY(e),this.applyMatrix4(Jr),this}rotateZ(e){return Jr.makeRotationZ(e),this.applyMatrix4(Jr),this}translate(e,t,i){return Jr.makeTranslation(e,t,i),this.applyMatrix4(Jr),this}scale(e,t,i){return Jr.makeScale(e,t,i),this.applyMatrix4(Jr),this}lookAt(e){return Ox.lookAt(e),Ox.updateMatrix(),this.applyMatrix4(Ox.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(ud).negate(),this.translate(ud.x,ud.y,ud.z),this}setFromPoints(e){const t=[];for(let i=0,s=e.length;i<s;i++){const r=e[i];t.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new st(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Bn);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new w(-1/0,-1/0,-1/0),new w(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,s=t.length;i<s;i++){const r=t[i];_r.setFromBufferAttribute(r),this.morphTargetsRelative?(Nn.addVectors(this.boundingBox.min,_r.min),this.boundingBox.expandByPoint(Nn),Nn.addVectors(this.boundingBox.max,_r.max),this.boundingBox.expandByPoint(Nn)):(this.boundingBox.expandByPoint(_r.min),this.boundingBox.expandByPoint(_r.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Ys);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new w,1/0);return}if(e){const i=this.boundingSphere.center;if(_r.setFromBufferAttribute(e),t)for(let r=0,o=t.length;r<o;r++){const a=t[r];Bp.setFromBufferAttribute(a),this.morphTargetsRelative?(Nn.addVectors(_r.min,Bp.min),_r.expandByPoint(Nn),Nn.addVectors(_r.max,Bp.max),_r.expandByPoint(Nn)):(_r.expandByPoint(Bp.min),_r.expandByPoint(Bp.max))}_r.getCenter(i);let s=0;for(let r=0,o=e.count;r<o;r++)Nn.fromBufferAttribute(e,r),s=Math.max(s,i.distanceToSquared(Nn));if(t)for(let r=0,o=t.length;r<o;r++){const a=t[r],l=this.morphTargetsRelative;for(let c=0,u=a.count;c<u;c++)Nn.fromBufferAttribute(a,c),l&&(ud.fromBufferAttribute(e,c),Nn.add(ud)),s=Math.max(s,i.distanceToSquared(Nn))}this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const i=e.array,s=t.position.array,r=t.normal.array,o=t.uv.array,a=s.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new ot(new Float32Array(4*a),4));const l=this.getAttribute("tangent").array,c=[],u=[];for(let T=0;T<a;T++)c[T]=new w,u[T]=new w;const d=new w,f=new w,p=new w,g=new te,A=new te,v=new te,m=new w,b=new w;function y(T,O,J){d.fromArray(s,T*3),f.fromArray(s,O*3),p.fromArray(s,J*3),g.fromArray(o,T*2),A.fromArray(o,O*2),v.fromArray(o,J*2),f.sub(d),p.sub(d),A.sub(g),v.sub(g);const V=1/(A.x*v.y-v.x*A.y);isFinite(V)&&(m.copy(f).multiplyScalar(v.y).addScaledVector(p,-A.y).multiplyScalar(V),b.copy(p).multiplyScalar(A.x).addScaledVector(f,-v.x).multiplyScalar(V),c[T].add(m),c[O].add(m),c[J].add(m),u[T].add(b),u[O].add(b),u[J].add(b))}let _=this.groups;_.length===0&&(_=[{start:0,count:i.length}]);for(let T=0,O=_.length;T<O;++T){const J=_[T],V=J.start,H=J.count;for(let Y=V,N=V+H;Y<N;Y+=3)y(i[Y+0],i[Y+1],i[Y+2])}const E=new w,M=new w,I=new w,R=new w;function C(T){I.fromArray(r,T*3),R.copy(I);const O=c[T];E.copy(O),E.sub(I.multiplyScalar(I.dot(O))).normalize(),M.crossVectors(R,O);const V=M.dot(u[T])<0?-1:1;l[T*4]=E.x,l[T*4+1]=E.y,l[T*4+2]=E.z,l[T*4+3]=V}for(let T=0,O=_.length;T<O;++T){const J=_[T],V=J.start,H=J.count;for(let Y=V,N=V+H;Y<N;Y+=3)C(i[Y+0]),C(i[Y+1]),C(i[Y+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new ot(new Float32Array(t.count*3),3),this.setAttribute("normal",i);else for(let f=0,p=i.count;f<p;f++)i.setXYZ(f,0,0,0);const s=new w,r=new w,o=new w,a=new w,l=new w,c=new w,u=new w,d=new w;if(e)for(let f=0,p=e.count;f<p;f+=3){const g=e.getX(f+0),A=e.getX(f+1),v=e.getX(f+2);s.fromBufferAttribute(t,g),r.fromBufferAttribute(t,A),o.fromBufferAttribute(t,v),u.subVectors(o,r),d.subVectors(s,r),u.cross(d),a.fromBufferAttribute(i,g),l.fromBufferAttribute(i,A),c.fromBufferAttribute(i,v),a.add(u),l.add(u),c.add(u),i.setXYZ(g,a.x,a.y,a.z),i.setXYZ(A,l.x,l.y,l.z),i.setXYZ(v,c.x,c.y,c.z)}else for(let f=0,p=t.count;f<p;f+=3)s.fromBufferAttribute(t,f+0),r.fromBufferAttribute(t,f+1),o.fromBufferAttribute(t,f+2),u.subVectors(o,r),d.subVectors(s,r),u.cross(d),i.setXYZ(f+0,u.x,u.y,u.z),i.setXYZ(f+1,u.x,u.y,u.z),i.setXYZ(f+2,u.x,u.y,u.z);this.normalizeNormals(),i.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)Nn.fromBufferAttribute(e,t),Nn.normalize(),e.setXYZ(t,Nn.x,Nn.y,Nn.z)}toNonIndexed(){function e(a,l){const c=a.array,u=a.itemSize,d=a.normalized,f=new c.constructor(l.length*u);let p=0,g=0;for(let A=0,v=l.length;A<v;A++){a.isInterleavedBufferAttribute?p=l[A]*a.data.stride+a.offset:p=l[A]*u;for(let m=0;m<u;m++)f[g++]=c[p++]}return new ot(f,u,d)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new ft,i=this.index.array,s=this.attributes;for(const a in s){const l=s[a],c=e(l,i);t.setAttribute(a,c)}const r=this.morphAttributes;for(const a in r){const l=[],c=r[a];for(let u=0,d=c.length;u<d;u++){const f=c[u],p=e(f,i);l.push(p)}t.morphAttributes[a]=l}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let a=0,l=o.length;a<l;a++){const c=o[a];t.addGroup(c.start,c.count,c.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const c in l)l[c]!==void 0&&(e[c]=l[c]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const i=this.attributes;for(const l in i){const c=i[l];e.data.attributes[l]=c.toJSON(e.data)}const s={};let r=!1;for(const l in this.morphAttributes){const c=this.morphAttributes[l],u=[];for(let d=0,f=c.length;d<f;d++){const p=c[d];u.push(p.toJSON(e.data))}u.length>0&&(s[l]=u,r=!0)}r&&(e.data.morphAttributes=s,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return a!==null&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const i=e.index;i!==null&&this.setIndex(i.clone(t));const s=e.attributes;for(const c in s){const u=s[c];this.setAttribute(c,u.clone(t))}const r=e.morphAttributes;for(const c in r){const u=[],d=r[c];for(let f=0,p=d.length;f<p;f++)u.push(d[f].clone(t));this.morphAttributes[c]=u}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let c=0,u=o.length;c<u;c++){const d=o[c];this.addGroup(d.start,d.count,d.materialIndex)}const a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());const l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const bI=new Ie,Sh=new Qa,ZA=new Ys,_I=new w,dd=new w,fd=new w,pd=new w,kx=new w,$A=new w,ev=new te,tv=new te,iv=new te,xI=new w,wI=new w,SI=new w,nv=new w,sv=new w;class ye extends Me{constructor(e=new ft,t=new ai){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const s=t[i[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=s.length;r<o;r++){const a=s[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}getVertexPosition(e,t){const i=this.geometry,s=i.attributes.position,r=i.morphAttributes.position,o=i.morphTargetsRelative;t.fromBufferAttribute(s,e);const a=this.morphTargetInfluences;if(r&&a){$A.set(0,0,0);for(let l=0,c=r.length;l<c;l++){const u=a[l],d=r[l];u!==0&&(kx.fromBufferAttribute(d,e),o?$A.addScaledVector(kx,u):$A.addScaledVector(kx.sub(t),u))}t.add($A)}return t}raycast(e,t){const i=this.geometry,s=this.material,r=this.matrixWorld;s!==void 0&&(i.boundingSphere===null&&i.computeBoundingSphere(),ZA.copy(i.boundingSphere),ZA.applyMatrix4(r),Sh.copy(e.ray).recast(e.near),!(ZA.containsPoint(Sh.origin)===!1&&(Sh.intersectSphere(ZA,_I)===null||Sh.origin.distanceToSquared(_I)>(e.far-e.near)**2))&&(bI.copy(r).invert(),Sh.copy(e.ray).applyMatrix4(bI),!(i.boundingBox!==null&&Sh.intersectsBox(i.boundingBox)===!1)&&this._computeIntersections(e,t,Sh)))}_computeIntersections(e,t,i){let s;const r=this.geometry,o=this.material,a=r.index,l=r.attributes.position,c=r.attributes.uv,u=r.attributes.uv1,d=r.attributes.normal,f=r.groups,p=r.drawRange;if(a!==null)if(Array.isArray(o))for(let g=0,A=f.length;g<A;g++){const v=f[g],m=o[v.materialIndex],b=Math.max(v.start,p.start),y=Math.min(a.count,Math.min(v.start+v.count,p.start+p.count));for(let _=b,E=y;_<E;_+=3){const M=a.getX(_),I=a.getX(_+1),R=a.getX(_+2);s=rv(this,m,e,i,c,u,d,M,I,R),s&&(s.faceIndex=Math.floor(_/3),s.face.materialIndex=v.materialIndex,t.push(s))}}else{const g=Math.max(0,p.start),A=Math.min(a.count,p.start+p.count);for(let v=g,m=A;v<m;v+=3){const b=a.getX(v),y=a.getX(v+1),_=a.getX(v+2);s=rv(this,o,e,i,c,u,d,b,y,_),s&&(s.faceIndex=Math.floor(v/3),t.push(s))}}else if(l!==void 0)if(Array.isArray(o))for(let g=0,A=f.length;g<A;g++){const v=f[g],m=o[v.materialIndex],b=Math.max(v.start,p.start),y=Math.min(l.count,Math.min(v.start+v.count,p.start+p.count));for(let _=b,E=y;_<E;_+=3){const M=_,I=_+1,R=_+2;s=rv(this,m,e,i,c,u,d,M,I,R),s&&(s.faceIndex=Math.floor(_/3),s.face.materialIndex=v.materialIndex,t.push(s))}}else{const g=Math.max(0,p.start),A=Math.min(l.count,p.start+p.count);for(let v=g,m=A;v<m;v+=3){const b=v,y=v+1,_=v+2;s=rv(this,o,e,i,c,u,d,b,y,_),s&&(s.faceIndex=Math.floor(v/3),t.push(s))}}}}function Yz(n,e,t,i,s,r,o,a){let l;if(e.side===fn?l=i.intersectTriangle(o,r,s,!0,a):l=i.intersectTriangle(s,r,o,e.side===Es,a),l===null)return null;sv.copy(a),sv.applyMatrix4(n.matrixWorld);const c=t.ray.origin.distanceTo(sv);return c<t.near||c>t.far?null:{distance:c,point:sv.clone(),object:n}}function rv(n,e,t,i,s,r,o,a,l,c){n.getVertexPosition(a,dd),n.getVertexPosition(l,fd),n.getVertexPosition(c,pd);const u=Yz(n,e,t,i,dd,fd,pd,nv);if(u){s&&(ev.fromBufferAttribute(s,a),tv.fromBufferAttribute(s,l),iv.fromBufferAttribute(s,c),u.uv=Vs.getInterpolation(nv,dd,fd,pd,ev,tv,iv,new te)),r&&(ev.fromBufferAttribute(r,a),tv.fromBufferAttribute(r,l),iv.fromBufferAttribute(r,c),u.uv1=Vs.getInterpolation(nv,dd,fd,pd,ev,tv,iv,new te),u.uv2=u.uv1),o&&(xI.fromBufferAttribute(o,a),wI.fromBufferAttribute(o,l),SI.fromBufferAttribute(o,c),u.normal=Vs.getInterpolation(nv,dd,fd,pd,xI,wI,SI,new w),u.normal.dot(i.direction)>0&&u.normal.multiplyScalar(-1));const d={a,b:l,c,normal:new w,materialIndex:0};Vs.getNormal(dd,fd,pd,d.normal),u.face=d}return u}class Ei extends ft{constructor(e=1,t=1,i=1,s=1,r=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:s,heightSegments:r,depthSegments:o};const a=this;s=Math.floor(s),r=Math.floor(r),o=Math.floor(o);const l=[],c=[],u=[],d=[];let f=0,p=0;g("z","y","x",-1,-1,i,t,e,o,r,0),g("z","y","x",1,-1,i,t,-e,o,r,1),g("x","z","y",1,1,e,i,t,s,o,2),g("x","z","y",1,-1,e,i,-t,s,o,3),g("x","y","z",1,-1,e,t,i,s,r,4),g("x","y","z",-1,-1,e,t,-i,s,r,5),this.setIndex(l),this.setAttribute("position",new st(c,3)),this.setAttribute("normal",new st(u,3)),this.setAttribute("uv",new st(d,2));function g(A,v,m,b,y,_,E,M,I,R,C){const T=_/I,O=E/R,J=_/2,V=E/2,H=M/2,Y=I+1,N=R+1;let L=0,G=0;const ee=new w;for(let $=0;$<N;$++){const j=$*O-V;for(let ie=0;ie<Y;ie++){const Ae=ie*T-J;ee[A]=Ae*b,ee[v]=j*y,ee[m]=H,c.push(ee.x,ee.y,ee.z),ee[A]=0,ee[v]=0,ee[m]=M>0?1:-1,u.push(ee.x,ee.y,ee.z),d.push(ie/I),d.push(1-$/R),L+=1}}for(let $=0;$<R;$++)for(let j=0;j<I;j++){const ie=f+j+Y*$,Ae=f+j+Y*($+1),ge=f+(j+1)+Y*($+1),Ce=f+(j+1)+Y*$;l.push(ie,Ae,Ce),l.push(Ae,ge,Ce),G+=6}a.addGroup(p,G,C),p+=G,f+=L}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Ei(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Df(n){const e={};for(const t in n){e[t]={};for(const i in n[t]){const s=n[t][i];s&&(s.isColor||s.isMatrix3||s.isMatrix4||s.isVector2||s.isVector3||s.isVector4||s.isTexture||s.isQuaternion)?s.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][i]=null):e[t][i]=s.clone():Array.isArray(s)?e[t][i]=s.slice():e[t][i]=s}}return e}function Ns(n){const e={};for(let t=0;t<n.length;t++){const i=Df(n[t]);for(const s in i)e[s]=i[s]}return e}function Jz(n){const e=[];for(let t=0;t<n.length;t++)e.push(n[t].clone());return e}function Ik(n){return n.getRenderTarget()===null?n.outputColorSpace:gn}const Sb={clone:Df,merge:Ns};var Kz=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,Zz=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Bt extends Pt{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=Kz,this.fragmentShader=Zz,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Df(e.uniforms),this.uniformsGroups=Jz(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const s in this.uniforms){const o=this.uniforms[s].value;o&&o.isTexture?t.uniforms[s]={type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?t.uniforms[s]={type:"c",value:o.getHex()}:o&&o.isVector2?t.uniforms[s]={type:"v2",value:o.toArray()}:o&&o.isVector3?t.uniforms[s]={type:"v3",value:o.toArray()}:o&&o.isVector4?t.uniforms[s]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?t.uniforms[s]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?t.uniforms[s]={type:"m4",value:o.toArray()}:t.uniforms[s]={value:o}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const i={};for(const s in this.extensions)this.extensions[s]===!0&&(i[s]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}}let qf=class extends Me{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Ie,this.projectionMatrix=new Ie,this.projectionMatrixInverse=new Ie,this.coordinateSystem=Ba}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}};class qt extends qf{constructor(e=50,t=1,i=.1,s=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=s,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=Bf*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(pu*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return Bf*2*Math.atan(Math.tan(pu*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,i,s,r,o){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=s,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(pu*.5*this.fov)/this.zoom,i=2*t,s=this.aspect*i,r=-.5*s;const o=this.view;if(this.view!==null&&this.view.enabled){const l=o.fullWidth,c=o.fullHeight;r+=o.offsetX*s/l,t-=o.offsetY*i/c,s*=o.width/l,i*=o.height/c}const a=this.filmOffset;a!==0&&(r+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+s,t,t-i,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const gd=-90,md=1;class sM extends Me{constructor(e,t,i){super(),this.type="CubeCamera",this.renderTarget=i,this.coordinateSystem=null;const s=new qt(gd,md,e,t);s.layers=this.layers,this.add(s);const r=new qt(gd,md,e,t);r.layers=this.layers,this.add(r);const o=new qt(gd,md,e,t);o.layers=this.layers,this.add(o);const a=new qt(gd,md,e,t);a.layers=this.layers,this.add(a);const l=new qt(gd,md,e,t);l.layers=this.layers,this.add(l);const c=new qt(gd,md,e,t);c.layers=this.layers,this.add(c)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[i,s,r,o,a,l]=t;for(const c of t)this.remove(c);if(e===Ba)i.up.set(0,1,0),i.lookAt(1,0,0),s.up.set(0,1,0),s.lookAt(-1,0,0),r.up.set(0,0,-1),r.lookAt(0,1,0),o.up.set(0,0,1),o.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),l.up.set(0,1,0),l.lookAt(0,0,-1);else if(e===mm)i.up.set(0,-1,0),i.lookAt(-1,0,0),s.up.set(0,-1,0),s.lookAt(1,0,0),r.up.set(0,0,1),r.lookAt(0,1,0),o.up.set(0,0,-1),o.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),l.up.set(0,-1,0),l.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const c of t)this.add(c),c.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const i=this.renderTarget;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[s,r,o,a,l,c]=this.children,u=e.getRenderTarget(),d=e.toneMapping,f=e.xr.enabled;e.toneMapping=Qs,e.xr.enabled=!1;const p=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0),e.render(t,s),e.setRenderTarget(i,1),e.render(t,r),e.setRenderTarget(i,2),e.render(t,o),e.setRenderTarget(i,3),e.render(t,a),e.setRenderTarget(i,4),e.render(t,l),i.texture.generateMipmaps=p,e.setRenderTarget(i,5),e.render(t,c),e.setRenderTarget(u),e.toneMapping=d,e.xr.enabled=f,i.texture.needsPMREMUpdate=!0}}class Zm extends Rt{constructor(e,t,i,s,r,o,a,l,c,u){e=e!==void 0?e:[],t=t!==void 0?t:qc,super(e,t,i,s,r,o,a,l,c,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class Cb extends ni{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const i={width:e,height:e,depth:1},s=[i,i,i,i,i,i];t.encoding!==void 0&&(Eg("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),t.colorSpace=t.encoding===ka?Je:ur),this.texture=new Zm(s,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:Dt}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},s=new Ei(5,5,5),r=new Bt({name:"CubemapFromEquirect",uniforms:Df(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:fn,blending:qi});r.uniforms.tEquirect.value=t;const o=new ye(s,r),a=t.minFilter;return t.minFilter===yo&&(t.minFilter=Dt),new sM(1,10,this).update(e,o),t.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(e,t,i,s){const r=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(t,i,s);e.setRenderTarget(r)}}const Lx=new w,$z=new w,eG=new It;class Ir{constructor(e=new w(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,s){return this.normal.set(e,t,i),this.constant=s,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){const s=Lx.subVectors(i,t).cross($z.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(s,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const i=e.delta(Lx),s=this.normal.dot(i);if(s===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const r=-(e.start.dot(this.normal)+this.constant)/s;return r<0||r>1?null:t.copy(e.start).addScaledVector(i,r)}intersectsLine(e){const t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const i=t||eG.getNormalMatrix(e),s=this.coplanarPoint(Lx).applyMatrix4(e),r=this.normal.applyMatrix3(i).normalize();return this.constant=-s.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const Ch=new Ys,ov=new w;class Eb{constructor(e=new Ir,t=new Ir,i=new Ir,s=new Ir,r=new Ir,o=new Ir){this.planes=[e,t,i,s,r,o]}set(e,t,i,s,r,o){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(i),a[3].copy(s),a[4].copy(r),a[5].copy(o),this}copy(e){const t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e,t=Ba){const i=this.planes,s=e.elements,r=s[0],o=s[1],a=s[2],l=s[3],c=s[4],u=s[5],d=s[6],f=s[7],p=s[8],g=s[9],A=s[10],v=s[11],m=s[12],b=s[13],y=s[14],_=s[15];if(i[0].setComponents(l-r,f-c,v-p,_-m).normalize(),i[1].setComponents(l+r,f+c,v+p,_+m).normalize(),i[2].setComponents(l+o,f+u,v+g,_+b).normalize(),i[3].setComponents(l-o,f-u,v-g,_-b).normalize(),i[4].setComponents(l-a,f-d,v-A,_-y).normalize(),t===Ba)i[5].setComponents(l+a,f+d,v+A,_+y).normalize();else if(t===mm)i[5].setComponents(a,d,A,y).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),Ch.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),Ch.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(Ch)}intersectsSprite(e){return Ch.center.set(0,0,0),Ch.radius=.7071067811865476,Ch.applyMatrix4(e.matrixWorld),this.intersectsSphere(Ch)}intersectsSphere(e){const t=this.planes,i=e.center,s=-e.radius;for(let r=0;r<6;r++)if(t[r].distanceToPoint(i)<s)return!1;return!0}intersectsBox(e){const t=this.planes;for(let i=0;i<6;i++){const s=t[i];if(ov.x=s.normal.x>0?e.max.x:e.min.x,ov.y=s.normal.y>0?e.max.y:e.min.y,ov.z=s.normal.z>0?e.max.z:e.min.z,s.distanceToPoint(ov)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function Rk(){let n=null,e=!1,t=null,i=null;function s(r,o){t(r,o),i=n.requestAnimationFrame(s)}return{start:function(){e!==!0&&t!==null&&(i=n.requestAnimationFrame(s),e=!0)},stop:function(){n.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(r){t=r},setContext:function(r){n=r}}}function tG(n,e){const t=e.isWebGL2,i=new WeakMap;function s(c,u){const d=c.array,f=c.usage,p=n.createBuffer();n.bindBuffer(u,p),n.bufferData(u,d,f),c.onUploadCallback();let g;if(d instanceof Float32Array)g=n.FLOAT;else if(d instanceof Uint16Array)if(c.isFloat16BufferAttribute)if(t)g=n.HALF_FLOAT;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else g=n.UNSIGNED_SHORT;else if(d instanceof Int16Array)g=n.SHORT;else if(d instanceof Uint32Array)g=n.UNSIGNED_INT;else if(d instanceof Int32Array)g=n.INT;else if(d instanceof Int8Array)g=n.BYTE;else if(d instanceof Uint8Array)g=n.UNSIGNED_BYTE;else if(d instanceof Uint8ClampedArray)g=n.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+d);return{buffer:p,type:g,bytesPerElement:d.BYTES_PER_ELEMENT,version:c.version}}function r(c,u,d){const f=u.array,p=u.updateRange;n.bindBuffer(d,c),p.count===-1?n.bufferSubData(d,0,f):(t?n.bufferSubData(d,p.offset*f.BYTES_PER_ELEMENT,f,p.offset,p.count):n.bufferSubData(d,p.offset*f.BYTES_PER_ELEMENT,f.subarray(p.offset,p.offset+p.count)),p.count=-1),u.onUploadCallback()}function o(c){return c.isInterleavedBufferAttribute&&(c=c.data),i.get(c)}function a(c){c.isInterleavedBufferAttribute&&(c=c.data);const u=i.get(c);u&&(n.deleteBuffer(u.buffer),i.delete(c))}function l(c,u){if(c.isGLBufferAttribute){const f=i.get(c);(!f||f.version<c.version)&&i.set(c,{buffer:c.buffer,type:c.type,bytesPerElement:c.elementSize,version:c.version});return}c.isInterleavedBufferAttribute&&(c=c.data);const d=i.get(c);d===void 0?i.set(c,s(c,u)):d.version<c.version&&(r(d.buffer,c,u),d.version=c.version)}return{get:o,remove:a,update:l}}class us extends ft{constructor(e=1,t=1,i=1,s=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:s};const r=e/2,o=t/2,a=Math.floor(i),l=Math.floor(s),c=a+1,u=l+1,d=e/a,f=t/l,p=[],g=[],A=[],v=[];for(let m=0;m<u;m++){const b=m*f-o;for(let y=0;y<c;y++){const _=y*d-r;g.push(_,-b,0),A.push(0,0,1),v.push(y/a),v.push(1-m/l)}}for(let m=0;m<l;m++)for(let b=0;b<a;b++){const y=b+c*m,_=b+c*(m+1),E=b+1+c*(m+1),M=b+1+c*m;p.push(y,_,M),p.push(_,E,M)}this.setIndex(p),this.setAttribute("position",new st(g,3)),this.setAttribute("normal",new st(A,3)),this.setAttribute("uv",new st(v,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new us(e.width,e.height,e.widthSegments,e.heightSegments)}}var iG=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,nG=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,sG=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,rG=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,oG=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,aG=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,lG=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,cG=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,hG=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,uG=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,dG=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,fG=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			 return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float R21 = R12;
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,pG=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,gG=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,mG=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,AG=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,vG=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,yG=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,bG=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,_G=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,xG=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,wG=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,SG=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,CG=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,EG=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,MG=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,TG=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,IG=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,RG="gl_FragColor = linearToOutputTexel( gl_FragColor );",PG=`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,BG=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,DG=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,OG=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,kG=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,LG=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,FG=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,UG=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,NG=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,zG=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,GG=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,VG=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,HG=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,QG=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,WG=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,jG=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( LEGACY_LIGHTS )
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#else
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,qG=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,XG=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,YG=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,JG=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,KG=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,ZG=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	anisotropyV /= material.anisotropy;
	material.anisotropy = saturate( material.anisotropy );
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x - tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x + tbn[ 0 ] * anisotropyV.y;
#endif`,$G=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,eV=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometry.viewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,tV=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometry.viewDir, geometry.normal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,iV=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,nV=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,sV=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,rV=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,oV=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,aV=`#ifdef USE_MAP
#ifdef USE_MIPMAP_BIAS
    vec4 sampledDiffuseColor = texture2D( map, vMapUv, mipmapBias );
#else
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,lV=`#ifdef USE_MAP
	uniform sampler2D map;
        
#ifdef USE_MIPMAP_BIAS
    uniform float mipmapBias;
#endif
#endif`,cV=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,hV=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,uV=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,dV=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,fV=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,pV=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,gV=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,mV=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,AV=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 geometryNormal = normal;`,vV=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,yV=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,bV=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,_V=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,xV=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,wV=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,SV=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,CV=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,EV=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,MV=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,TV=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,IV=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,RV=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,PV=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,BV=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,DV=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,OV=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,kV=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,LV=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,FV=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,UV=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,NV=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,zV=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,GV=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,VV=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,HV=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,QV=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,WV=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,jV=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,qV=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,XV=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,YV=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,JV=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,KV=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,ZV=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const $V=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,eH=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,tH=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,iH=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,nH=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,sH=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,rH=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,oH=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,aH=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,lH=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,cH=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,hH=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,uH=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,dH=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,fH=`#include <common>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,pH=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,gH=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,mH=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,AH=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,vH=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,yH=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,bH=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,_H=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,xH=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,wH=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,SH=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,CH=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,EH=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,MH=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,TH=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,IH=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,RH=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,PH=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,BH=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,Tt={alphahash_fragment:iG,alphahash_pars_fragment:nG,alphamap_fragment:sG,alphamap_pars_fragment:rG,alphatest_fragment:oG,alphatest_pars_fragment:aG,aomap_fragment:lG,aomap_pars_fragment:cG,begin_vertex:hG,beginnormal_vertex:uG,bsdfs:dG,iridescence_fragment:fG,bumpmap_pars_fragment:pG,clipping_planes_fragment:gG,clipping_planes_pars_fragment:mG,clipping_planes_pars_vertex:AG,clipping_planes_vertex:vG,color_fragment:yG,color_pars_fragment:bG,color_pars_vertex:_G,color_vertex:xG,common:wG,cube_uv_reflection_fragment:SG,defaultnormal_vertex:CG,displacementmap_pars_vertex:EG,displacementmap_vertex:MG,emissivemap_fragment:TG,emissivemap_pars_fragment:IG,colorspace_fragment:RG,colorspace_pars_fragment:PG,envmap_fragment:BG,envmap_common_pars_fragment:DG,envmap_pars_fragment:OG,envmap_pars_vertex:kG,envmap_physical_pars_fragment:qG,envmap_vertex:LG,fog_vertex:FG,fog_pars_vertex:UG,fog_fragment:NG,fog_pars_fragment:zG,gradientmap_pars_fragment:GG,lightmap_fragment:VG,lightmap_pars_fragment:HG,lights_lambert_fragment:QG,lights_lambert_pars_fragment:WG,lights_pars_begin:jG,lights_toon_fragment:XG,lights_toon_pars_fragment:YG,lights_phong_fragment:JG,lights_phong_pars_fragment:KG,lights_physical_fragment:ZG,lights_physical_pars_fragment:$G,lights_fragment_begin:eV,lights_fragment_maps:tV,lights_fragment_end:iV,logdepthbuf_fragment:nV,logdepthbuf_pars_fragment:sV,logdepthbuf_pars_vertex:rV,logdepthbuf_vertex:oV,map_fragment:aV,map_pars_fragment:lV,map_particle_fragment:cV,map_particle_pars_fragment:hV,metalnessmap_fragment:uV,metalnessmap_pars_fragment:dV,morphcolor_vertex:fV,morphnormal_vertex:pV,morphtarget_pars_vertex:gV,morphtarget_vertex:mV,normal_fragment_begin:AV,normal_fragment_maps:vV,normal_pars_fragment:yV,normal_pars_vertex:bV,normal_vertex:_V,normalmap_pars_fragment:xV,clearcoat_normal_fragment_begin:wV,clearcoat_normal_fragment_maps:SV,clearcoat_pars_fragment:CV,iridescence_pars_fragment:EV,opaque_fragment:MV,packing:TV,premultiplied_alpha_fragment:IV,project_vertex:RV,dithering_fragment:PV,dithering_pars_fragment:BV,roughnessmap_fragment:DV,roughnessmap_pars_fragment:OV,shadowmap_pars_fragment:kV,shadowmap_pars_vertex:LV,shadowmap_vertex:FV,shadowmask_pars_fragment:UV,skinbase_vertex:NV,skinning_pars_vertex:zV,skinning_vertex:GV,skinnormal_vertex:VV,specularmap_fragment:HV,specularmap_pars_fragment:QV,tonemapping_fragment:WV,tonemapping_pars_fragment:jV,transmission_fragment:qV,transmission_pars_fragment:XV,uv_pars_fragment:YV,uv_pars_vertex:JV,uv_vertex:KV,worldpos_vertex:ZV,background_vert:$V,background_frag:eH,backgroundCube_vert:tH,backgroundCube_frag:iH,cube_vert:nH,cube_frag:sH,depth_vert:rH,depth_frag:oH,distanceRGBA_vert:aH,distanceRGBA_frag:lH,equirect_vert:cH,equirect_frag:hH,linedashed_vert:uH,linedashed_frag:dH,meshbasic_vert:fH,meshbasic_frag:pH,meshlambert_vert:gH,meshlambert_frag:mH,meshmatcap_vert:AH,meshmatcap_frag:vH,meshnormal_vert:yH,meshnormal_frag:bH,meshphong_vert:_H,meshphong_frag:xH,meshphysical_vert:wH,meshphysical_frag:SH,meshtoon_vert:CH,meshtoon_frag:EH,points_vert:MH,points_frag:TH,shadow_vert:IH,shadow_frag:RH,sprite_vert:PH,sprite_frag:BH},Ue={common:{diffuse:{value:new _e(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new It},alphaMap:{value:null},alphaMapTransform:{value:new It},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new It}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new It}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new It}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new It},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new It},normalScale:{value:new te(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new It},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new It}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new It}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new It}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new _e(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new _e(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new It},alphaTest:{value:0},uvTransform:{value:new It}},sprite:{diffuse:{value:new _e(16777215)},opacity:{value:1},center:{value:new te(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new It},alphaMap:{value:null},alphaMapTransform:{value:new It},alphaTest:{value:0}}},Rr={basic:{uniforms:Ns([Ue.common,Ue.specularmap,Ue.envmap,Ue.aomap,Ue.lightmap,Ue.fog]),vertexShader:Tt.meshbasic_vert,fragmentShader:Tt.meshbasic_frag},lambert:{uniforms:Ns([Ue.common,Ue.specularmap,Ue.envmap,Ue.aomap,Ue.lightmap,Ue.emissivemap,Ue.bumpmap,Ue.normalmap,Ue.displacementmap,Ue.fog,Ue.lights,{emissive:{value:new _e(0)}}]),vertexShader:Tt.meshlambert_vert,fragmentShader:Tt.meshlambert_frag},phong:{uniforms:Ns([Ue.common,Ue.specularmap,Ue.envmap,Ue.aomap,Ue.lightmap,Ue.emissivemap,Ue.bumpmap,Ue.normalmap,Ue.displacementmap,Ue.fog,Ue.lights,{emissive:{value:new _e(0)},specular:{value:new _e(1118481)},shininess:{value:30}}]),vertexShader:Tt.meshphong_vert,fragmentShader:Tt.meshphong_frag},standard:{uniforms:Ns([Ue.common,Ue.envmap,Ue.aomap,Ue.lightmap,Ue.emissivemap,Ue.bumpmap,Ue.normalmap,Ue.displacementmap,Ue.roughnessmap,Ue.metalnessmap,Ue.fog,Ue.lights,{emissive:{value:new _e(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Tt.meshphysical_vert,fragmentShader:Tt.meshphysical_frag},toon:{uniforms:Ns([Ue.common,Ue.aomap,Ue.lightmap,Ue.emissivemap,Ue.bumpmap,Ue.normalmap,Ue.displacementmap,Ue.gradientmap,Ue.fog,Ue.lights,{emissive:{value:new _e(0)}}]),vertexShader:Tt.meshtoon_vert,fragmentShader:Tt.meshtoon_frag},matcap:{uniforms:Ns([Ue.common,Ue.bumpmap,Ue.normalmap,Ue.displacementmap,Ue.fog,{matcap:{value:null}}]),vertexShader:Tt.meshmatcap_vert,fragmentShader:Tt.meshmatcap_frag},points:{uniforms:Ns([Ue.points,Ue.fog]),vertexShader:Tt.points_vert,fragmentShader:Tt.points_frag},dashed:{uniforms:Ns([Ue.common,Ue.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Tt.linedashed_vert,fragmentShader:Tt.linedashed_frag},depth:{uniforms:Ns([Ue.common,Ue.displacementmap]),vertexShader:Tt.depth_vert,fragmentShader:Tt.depth_frag},normal:{uniforms:Ns([Ue.common,Ue.bumpmap,Ue.normalmap,Ue.displacementmap,{opacity:{value:1}}]),vertexShader:Tt.meshnormal_vert,fragmentShader:Tt.meshnormal_frag},sprite:{uniforms:Ns([Ue.sprite,Ue.fog]),vertexShader:Tt.sprite_vert,fragmentShader:Tt.sprite_frag},background:{uniforms:{uvTransform:{value:new It},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Tt.background_vert,fragmentShader:Tt.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:Tt.backgroundCube_vert,fragmentShader:Tt.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Tt.cube_vert,fragmentShader:Tt.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Tt.equirect_vert,fragmentShader:Tt.equirect_frag},distanceRGBA:{uniforms:Ns([Ue.common,Ue.displacementmap,{referencePosition:{value:new w},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Tt.distanceRGBA_vert,fragmentShader:Tt.distanceRGBA_frag},shadow:{uniforms:Ns([Ue.lights,Ue.fog,{color:{value:new _e(0)},opacity:{value:1}}]),vertexShader:Tt.shadow_vert,fragmentShader:Tt.shadow_frag}};Rr.physical={uniforms:Ns([Rr.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new It},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new It},clearcoatNormalScale:{value:new te(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new It},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new It},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new It},sheen:{value:0},sheenColor:{value:new _e(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new It},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new It},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new It},transmissionSamplerSize:{value:new te},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new It},attenuationDistance:{value:0},attenuationColor:{value:new _e(0)},specularColor:{value:new _e(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new It},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new It},anisotropyVector:{value:new te},anisotropyMap:{value:null},anisotropyMapTransform:{value:new It}}]),vertexShader:Tt.meshphysical_vert,fragmentShader:Tt.meshphysical_frag};const av={r:0,b:0,g:0};function DH(n,e,t,i,s,r,o){const a=new _e(0);let l=r===!0?0:1,c,u,d=null,f=0,p=null;function g(v,m){let b=!1,y=m.isScene===!0?m.background:null;switch(y&&y.isTexture&&(y=(m.backgroundBlurriness>0?t:e).get(y)),y===null?A(a,l):y&&y.isColor&&(A(y,1),b=!0),n.xr.getEnvironmentBlendMode()){case"opaque":b=!0;break;case"additive":i.buffers.color.setClear(0,0,0,1,o),b=!0;break;case"alpha-blend":i.buffers.color.setClear(0,0,0,0,o),b=!0;break}(n.autoClear||b)&&n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil),y&&(y.isCubeTexture||y.mapping===jf)?(u===void 0&&(u=new ye(new Ei(1,1,1),new Bt({name:"BackgroundCubeMaterial",uniforms:Df(Rr.backgroundCube.uniforms),vertexShader:Rr.backgroundCube.vertexShader,fragmentShader:Rr.backgroundCube.fragmentShader,side:fn,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(M,I,R){this.matrixWorld.copyPosition(R.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),s.update(u)),u.material.uniforms.envMap.value=y,u.material.uniforms.flipEnvMap.value=y.isCubeTexture&&y.isRenderTargetTexture===!1?-1:1,u.material.uniforms.backgroundBlurriness.value=m.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=m.backgroundIntensity,u.material.toneMapped=y.colorSpace!==Je,(d!==y||f!==y.version||p!==n.toneMapping)&&(u.material.needsUpdate=!0,d=y,f=y.version,p=n.toneMapping),u.layers.enableAll(),v.unshift(u,u.geometry,u.material,0,0,null)):y&&y.isTexture&&(c===void 0&&(c=new ye(new us(2,2),new Bt({name:"BackgroundMaterial",uniforms:Df(Rr.background.uniforms),vertexShader:Rr.background.vertexShader,fragmentShader:Rr.background.fragmentShader,side:Es,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),s.update(c)),c.material.uniforms.t2D.value=y,c.material.uniforms.backgroundIntensity.value=m.backgroundIntensity,c.material.toneMapped=y.colorSpace!==Je,y.matrixAutoUpdate===!0&&y.updateMatrix(),c.material.uniforms.uvTransform.value.copy(y.matrix),(d!==y||f!==y.version||p!==n.toneMapping)&&(c.material.needsUpdate=!0,d=y,f=y.version,p=n.toneMapping),c.layers.enableAll(),v.unshift(c,c.geometry,c.material,0,0,null))}function A(v,m){v.getRGB(av,Ik(n)),i.buffers.color.setClear(av.r,av.g,av.b,m,o)}return{getClearColor:function(){return a},setClearColor:function(v,m=1){a.set(v),l=m,A(a,l)},getClearAlpha:function(){return l},setClearAlpha:function(v){l=v,A(a,l)},render:g}}function OH(n,e,t,i){const s=n.getParameter(n.MAX_VERTEX_ATTRIBS),r=i.isWebGL2?null:e.get("OES_vertex_array_object"),o=i.isWebGL2||r!==null,a={},l=v(null);let c=l,u=!1;function d(H,Y,N,L,G){let ee=!1;if(o){const $=A(L,N,Y);c!==$&&(c=$,p(c.object)),ee=m(H,L,N,G),ee&&b(H,L,N,G)}else{const $=Y.wireframe===!0;(c.geometry!==L.id||c.program!==N.id||c.wireframe!==$)&&(c.geometry=L.id,c.program=N.id,c.wireframe=$,ee=!0)}G!==null&&t.update(G,n.ELEMENT_ARRAY_BUFFER),(ee||u)&&(u=!1,R(H,Y,N,L),G!==null&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t.get(G).buffer))}function f(){return i.isWebGL2?n.createVertexArray():r.createVertexArrayOES()}function p(H){return i.isWebGL2?n.bindVertexArray(H):r.bindVertexArrayOES(H)}function g(H){return i.isWebGL2?n.deleteVertexArray(H):r.deleteVertexArrayOES(H)}function A(H,Y,N){const L=N.wireframe===!0;let G=a[H.id];G===void 0&&(G={},a[H.id]=G);let ee=G[Y.id];ee===void 0&&(ee={},G[Y.id]=ee);let $=ee[L];return $===void 0&&($=v(f()),ee[L]=$),$}function v(H){const Y=[],N=[],L=[];for(let G=0;G<s;G++)Y[G]=0,N[G]=0,L[G]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:Y,enabledAttributes:N,attributeDivisors:L,object:H,attributes:{},index:null}}function m(H,Y,N,L){const G=c.attributes,ee=Y.attributes;let $=0;const j=N.getAttributes();for(const ie in j)if(j[ie].location>=0){const ge=G[ie];let Ce=ee[ie];if(Ce===void 0&&(ie==="instanceMatrix"&&H.instanceMatrix&&(Ce=H.instanceMatrix),ie==="instanceColor"&&H.instanceColor&&(Ce=H.instanceColor)),ge===void 0||ge.attribute!==Ce||Ce&&ge.data!==Ce.data)return!0;$++}return c.attributesNum!==$||c.index!==L}function b(H,Y,N,L){const G={},ee=Y.attributes;let $=0;const j=N.getAttributes();for(const ie in j)if(j[ie].location>=0){let ge=ee[ie];ge===void 0&&(ie==="instanceMatrix"&&H.instanceMatrix&&(ge=H.instanceMatrix),ie==="instanceColor"&&H.instanceColor&&(ge=H.instanceColor));const Ce={};Ce.attribute=ge,ge&&ge.data&&(Ce.data=ge.data),G[ie]=Ce,$++}c.attributes=G,c.attributesNum=$,c.index=L}function y(){const H=c.newAttributes;for(let Y=0,N=H.length;Y<N;Y++)H[Y]=0}function _(H){E(H,0)}function E(H,Y){const N=c.newAttributes,L=c.enabledAttributes,G=c.attributeDivisors;N[H]=1,L[H]===0&&(n.enableVertexAttribArray(H),L[H]=1),G[H]!==Y&&((i.isWebGL2?n:e.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](H,Y),G[H]=Y)}function M(){const H=c.newAttributes,Y=c.enabledAttributes;for(let N=0,L=Y.length;N<L;N++)Y[N]!==H[N]&&(n.disableVertexAttribArray(N),Y[N]=0)}function I(H,Y,N,L,G,ee,$){$===!0?n.vertexAttribIPointer(H,Y,N,G,ee):n.vertexAttribPointer(H,Y,N,L,G,ee)}function R(H,Y,N,L){if(i.isWebGL2===!1&&(H.isInstancedMesh||L.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;y();const G=L.attributes,ee=N.getAttributes(),$=Y.defaultAttributeValues;for(const j in ee){const ie=ee[j];if(ie.location>=0){let Ae=G[j];if(Ae===void 0&&(j==="instanceMatrix"&&H.instanceMatrix&&(Ae=H.instanceMatrix),j==="instanceColor"&&H.instanceColor&&(Ae=H.instanceColor)),Ae!==void 0){const ge=Ae.normalized,Ce=Ae.itemSize,Ee=t.get(Ae);if(Ee===void 0)continue;const Ne=Ee.buffer,Ve=Ee.type,lt=Ee.bytesPerElement,xt=i.isWebGL2===!0&&(Ve===n.INT||Ve===n.UNSIGNED_INT||Ae.gpuType===VE);if(Ae.isInterleavedBufferAttribute){const et=Ae.data,W=et.stride,Le=Ae.offset;if(et.isInstancedInterleavedBuffer){for(let me=0;me<ie.locationSize;me++)E(ie.location+me,et.meshPerAttribute);H.isInstancedMesh!==!0&&L._maxInstanceCount===void 0&&(L._maxInstanceCount=et.meshPerAttribute*et.count)}else for(let me=0;me<ie.locationSize;me++)_(ie.location+me);n.bindBuffer(n.ARRAY_BUFFER,Ne);for(let me=0;me<ie.locationSize;me++)I(ie.location+me,Ce/ie.locationSize,Ve,ge,W*lt,(Le+Ce/ie.locationSize*me)*lt,xt)}else{if(Ae.isInstancedBufferAttribute){for(let et=0;et<ie.locationSize;et++)E(ie.location+et,Ae.meshPerAttribute);H.isInstancedMesh!==!0&&L._maxInstanceCount===void 0&&(L._maxInstanceCount=Ae.meshPerAttribute*Ae.count)}else for(let et=0;et<ie.locationSize;et++)_(ie.location+et);n.bindBuffer(n.ARRAY_BUFFER,Ne);for(let et=0;et<ie.locationSize;et++)I(ie.location+et,Ce/ie.locationSize,Ve,ge,Ce*lt,Ce/ie.locationSize*et*lt,xt)}}else if($!==void 0){const ge=$[j];if(ge!==void 0)switch(ge.length){case 2:n.vertexAttrib2fv(ie.location,ge);break;case 3:n.vertexAttrib3fv(ie.location,ge);break;case 4:n.vertexAttrib4fv(ie.location,ge);break;default:n.vertexAttrib1fv(ie.location,ge)}}}}M()}function C(){J();for(const H in a){const Y=a[H];for(const N in Y){const L=Y[N];for(const G in L)g(L[G].object),delete L[G];delete Y[N]}delete a[H]}}function T(H){if(a[H.id]===void 0)return;const Y=a[H.id];for(const N in Y){const L=Y[N];for(const G in L)g(L[G].object),delete L[G];delete Y[N]}delete a[H.id]}function O(H){for(const Y in a){const N=a[Y];if(N[H.id]===void 0)continue;const L=N[H.id];for(const G in L)g(L[G].object),delete L[G];delete N[H.id]}}function J(){V(),u=!0,c!==l&&(c=l,p(c.object))}function V(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:d,reset:J,resetDefaultState:V,dispose:C,releaseStatesOfGeometry:T,releaseStatesOfProgram:O,initAttributes:y,enableAttribute:_,disableUnusedAttributes:M}}function kH(n,e,t,i){const s=i.isWebGL2;let r;function o(c){r=c}function a(c,u){n.drawArrays(r,c,u),t.update(u,r,1)}function l(c,u,d){if(d===0)return;let f,p;if(s)f=n,p="drawArraysInstanced";else if(f=e.get("ANGLE_instanced_arrays"),p="drawArraysInstancedANGLE",f===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}f[p](r,c,u,d),t.update(u,r,d)}this.setMode=o,this.render=a,this.renderInstances=l}function LH(n,e,t){let i;function s(){if(i!==void 0)return i;if(e.has("EXT_texture_filter_anisotropic")===!0){const I=e.get("EXT_texture_filter_anisotropic");i=n.getParameter(I.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i}function r(I){if(I==="highp"){if(n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.HIGH_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT).precision>0)return"highp";I="mediump"}return I==="mediump"&&n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.MEDIUM_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const o=typeof WebGL2RenderingContext<"u"&&n.constructor.name==="WebGL2RenderingContext";let a=t.precision!==void 0?t.precision:"highp";const l=r(a);l!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",l,"instead."),a=l);const c=o||e.has("WEBGL_draw_buffers"),u=t.logarithmicDepthBuffer===!0,d=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS),f=n.getParameter(n.MAX_VERTEX_TEXTURE_IMAGE_UNITS),p=n.getParameter(n.MAX_TEXTURE_SIZE),g=n.getParameter(n.MAX_CUBE_MAP_TEXTURE_SIZE),A=n.getParameter(n.MAX_VERTEX_ATTRIBS),v=n.getParameter(n.MAX_VERTEX_UNIFORM_VECTORS),m=n.getParameter(n.MAX_VARYING_VECTORS),b=n.getParameter(n.MAX_FRAGMENT_UNIFORM_VECTORS),y=f>0,_=o||e.has("OES_texture_float"),E=y&&_,M=o?n.getParameter(n.MAX_SAMPLES):0;return{isWebGL2:o,drawBuffers:c,getMaxAnisotropy:s,getMaxPrecision:r,precision:a,logarithmicDepthBuffer:u,maxTextures:d,maxVertexTextures:f,maxTextureSize:p,maxCubemapSize:g,maxAttributes:A,maxVertexUniforms:v,maxVaryings:m,maxFragmentUniforms:b,vertexTextures:y,floatFragmentTextures:_,floatVertexTextures:E,maxSamples:M}}function FH(n){const e=this;let t=null,i=0,s=!1,r=!1;const o=new Ir,a=new It,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(d,f){const p=d.length!==0||f||i!==0||s;return s=f,i=d.length,p},this.beginShadows=function(){r=!0,u(null)},this.endShadows=function(){r=!1},this.setGlobalState=function(d,f){t=u(d,f,0)},this.setState=function(d,f,p){const g=d.clippingPlanes,A=d.clipIntersection,v=d.clipShadows,m=n.get(d);if(!s||g===null||g.length===0||r&&!v)r?u(null):c();else{const b=r?0:i,y=b*4;let _=m.clippingState||null;l.value=_,_=u(g,f,y,p);for(let E=0;E!==y;++E)_[E]=t[E];m.clippingState=_,this.numIntersection=A?this.numPlanes:0,this.numPlanes+=b}};function c(){l.value!==t&&(l.value=t,l.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}function u(d,f,p,g){const A=d!==null?d.length:0;let v=null;if(A!==0){if(v=l.value,g!==!0||v===null){const m=p+A*4,b=f.matrixWorldInverse;a.getNormalMatrix(b),(v===null||v.length<m)&&(v=new Float32Array(m));for(let y=0,_=p;y!==A;++y,_+=4)o.copy(d[y]).applyMatrix4(b,a),o.normal.toArray(v,_),v[_+3]=o.constant}l.value=v,l.needsUpdate=!0}return e.numPlanes=A,e.numIntersection=0,v}}function UH(n){let e=new WeakMap;function t(o,a){return a===mo?o.mapping=qc:a===Rf&&(o.mapping=Xc),o}function i(o){if(o&&o.isTexture&&o.isRenderTargetTexture===!1){const a=o.mapping;if(a===mo||a===Rf)if(e.has(o)){const l=e.get(o).texture;return t(l,o.mapping)}else{const l=o.image;if(l&&l.height>0){const c=new Cb(l.height/2);return c.fromEquirectangularTexture(n,o),e.set(o,c),o.addEventListener("dispose",s),t(c.texture,o.mapping)}else return null}}return o}function s(o){const a=o.target;a.removeEventListener("dispose",s);const l=e.get(a);l!==void 0&&(e.delete(a),l.dispose())}function r(){e=new WeakMap}return{get:i,dispose:r}}class rh extends qf{constructor(e=-1,t=1,i=1,s=-1,r=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=s,this.near=r,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,i,s,r,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=s,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,s=(this.top+this.bottom)/2;let r=i-e,o=i+e,a=s+t,l=s-t;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=c*this.view.offsetX,o=r+c*this.view.width,a-=u*this.view.offsetY,l=a-u*this.view.height}this.projectionMatrix.makeOrthographic(r,o,a,l,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}const Qd=4,CI=[.125,.215,.35,.446,.526,.582],Qh=20,Fx=new rh,EI=new _e;let Ux=null;const zh=(1+Math.sqrt(5))/2,Ad=1/zh,MI=[new w(1,1,1),new w(-1,1,1),new w(1,1,-1),new w(-1,1,-1),new w(0,zh,Ad),new w(0,zh,-Ad),new w(Ad,0,zh),new w(-Ad,0,zh),new w(zh,Ad,0),new w(-zh,Ad,0)];class $S{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,s=100){Ux=this._renderer.getRenderTarget(),this._setSize(256);const r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(e,i,s,r),t>0&&this._blur(r,0,0,t),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=PI(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=RI(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(Ux),e.scissorTest=!1,lv(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===qc||e.mapping===Xc?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),Ux=this._renderer.getRenderTarget();const i=t||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,i={magFilter:Dt,minFilter:Dt,generateMipmaps:!1,type:xn,format:Ti,colorSpace:gn,depthBuffer:!1},s=II(e,t,i),{_lodMax:r}=this;if({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=TI(r),this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=II(e,t,i);const{_lodMax:o}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=TI(o)),this._blurMaterial=NH(o,e,t)}return s}_compileMaterial(e){const t=new ye(this._lodPlanes[0],e);this._renderer.compile(t,Fx)}_sceneToCubeUV(e,t,i,s){const a=new qt(90,1,t,i),l=[1,-1,1,1,1,1],c=[1,1,1,-1,-1,-1],u=this._renderer,d=u.autoClear,f=u.toneMapping;u.getClearColor(EI),u.toneMapping=Qs,u.autoClear=!1;const p=new ai({name:"PMREM.Background",side:fn,depthWrite:!1,depthTest:!1}),g=new ye(new Ei,p);let A=!1;const v=e.background;v?v.isColor&&(p.color.copy(v),e.background=null,A=!0):(p.color.copy(EI),A=!0);for(let m=0;m<6;m++){const b=m%3;b===0?(a.up.set(0,l[m],0),a.lookAt(c[m],0,0)):b===1?(a.up.set(0,0,l[m]),a.lookAt(0,c[m],0)):(a.up.set(0,l[m],0),a.lookAt(0,0,c[m]));const y=this._cubeSize;lv(s,b*y,m>2?y:0,y,y),u.setRenderTarget(s),A&&u.render(g,a),u.render(e,a)}g.geometry.dispose(),g.material.dispose(),u.toneMapping=f,u.autoClear=d,e.background=v}_textureToCubeUV(e,t){const i=this._renderer,s=e.mapping===qc||e.mapping===Xc;s?(this._cubemapMaterial===null&&(this._cubemapMaterial=PI()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=RI());const r=s?this._cubemapMaterial:this._equirectMaterial,o=new ye(this._lodPlanes[0],r),a=r.uniforms;a.envMap.value=e;const l=this._cubeSize;lv(t,0,0,3*l,2*l),i.setRenderTarget(t),i.render(o,Fx)}_applyPMREM(e){const t=this._renderer,i=t.autoClear;t.autoClear=!1;for(let s=1;s<this._lodPlanes.length;s++){const r=Math.sqrt(this._sigmas[s]*this._sigmas[s]-this._sigmas[s-1]*this._sigmas[s-1]),o=MI[(s-1)%MI.length];this._blur(e,s-1,s,r,o)}t.autoClear=i}_blur(e,t,i,s,r){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,i,s,"latitudinal",r),this._halfBlur(o,e,i,i,s,"longitudinal",r)}_halfBlur(e,t,i,s,r,o,a){const l=this._renderer,c=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const u=3,d=new ye(this._lodPlanes[s],c),f=c.uniforms,p=this._sizeLods[i]-1,g=isFinite(r)?Math.PI/(2*p):2*Math.PI/(2*Qh-1),A=r/g,v=isFinite(r)?1+Math.floor(u*A):Qh;v>Qh&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${v} samples when the maximum is set to ${Qh}`);const m=[];let b=0;for(let I=0;I<Qh;++I){const R=I/A,C=Math.exp(-R*R/2);m.push(C),I===0?b+=C:I<v&&(b+=2*C)}for(let I=0;I<m.length;I++)m[I]=m[I]/b;f.envMap.value=e.texture,f.samples.value=v,f.weights.value=m,f.latitudinal.value=o==="latitudinal",a&&(f.poleAxis.value=a);const{_lodMax:y}=this;f.dTheta.value=g,f.mipInt.value=y-i;const _=this._sizeLods[s],E=3*_*(s>y-Qd?s-y+Qd:0),M=4*(this._cubeSize-_);lv(t,E,M,3*_,2*_),l.setRenderTarget(t),l.render(d,Fx)}}function TI(n){const e=[],t=[],i=[];let s=n;const r=n-Qd+1+CI.length;for(let o=0;o<r;o++){const a=Math.pow(2,s);t.push(a);let l=1/a;o>n-Qd?l=CI[o-n+Qd-1]:o===0&&(l=0),i.push(l);const c=1/(a-2),u=-c,d=1+c,f=[u,u,d,u,d,d,u,u,d,d,u,d],p=6,g=6,A=3,v=2,m=1,b=new Float32Array(A*g*p),y=new Float32Array(v*g*p),_=new Float32Array(m*g*p);for(let M=0;M<p;M++){const I=M%3*2/3-1,R=M>2?0:-1,C=[I,R,0,I+2/3,R,0,I+2/3,R+1,0,I,R,0,I+2/3,R+1,0,I,R+1,0];b.set(C,A*g*M),y.set(f,v*g*M);const T=[M,M,M,M,M,M];_.set(T,m*g*M)}const E=new ft;E.setAttribute("position",new ot(b,A)),E.setAttribute("uv",new ot(y,v)),E.setAttribute("faceIndex",new ot(_,m)),e.push(E),s>Qd&&s--}return{lodPlanes:e,sizeLods:t,sigmas:i}}function II(n,e,t){const i=new ni(n,e,t);return i.texture.mapping=jf,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function lv(n,e,t,i,s){n.viewport.set(e,t,i,s),n.scissor.set(e,t,i,s)}function NH(n,e,t){const i=new Float32Array(Qh),s=new w(0,1,0);return new Bt({name:"SphericalGaussianBlur",defines:{n:Qh,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:s}},vertexShader:rM(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:qi,depthTest:!1,depthWrite:!1})}function RI(){return new Bt({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:rM(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:qi,depthTest:!1,depthWrite:!1})}function PI(){return new Bt({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:rM(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:qi,depthTest:!1,depthWrite:!1})}function rM(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function zH(n){let e=new WeakMap,t=null;function i(a){if(a&&a.isTexture){const l=a.mapping,c=l===mo||l===Rf,u=l===qc||l===Xc;if(c||u)if(a.isRenderTargetTexture&&a.needsPMREMUpdate===!0){a.needsPMREMUpdate=!1;let d=e.get(a);return t===null&&(t=new $S(n)),d=c?t.fromEquirectangular(a,d):t.fromCubemap(a,d),e.set(a,d),d.texture}else{if(e.has(a))return e.get(a).texture;{const d=a.image;if(c&&d&&d.height>0||u&&d&&s(d)){t=new $S(n);const f=c?t.fromEquirectangular(a):t.fromCubemap(a);return e.set(a,f),a.addEventListener("dispose",r),f.texture}else return null}}}return a}function s(a){let l=0;const c=6;for(let u=0;u<c;u++)a[u]!==void 0&&l++;return l===c}function r(a){const l=a.target;l.removeEventListener("dispose",r);const c=e.get(l);c!==void 0&&(e.delete(l),c.dispose())}function o(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:i,dispose:o}}function GH(n){const e={};function t(i){if(e[i]!==void 0)return e[i];let s;switch(i){case"WEBGL_depth_texture":s=n.getExtension("WEBGL_depth_texture")||n.getExtension("MOZ_WEBGL_depth_texture")||n.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":s=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":s=n.getExtension("WEBGL_compressed_texture_s3tc")||n.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":s=n.getExtension("WEBGL_compressed_texture_pvrtc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:s=n.getExtension(i)}return e[i]=s,s}return{has:function(i){return t(i)!==null},init:function(i){i.isWebGL2?t("EXT_color_buffer_float"):(t("WEBGL_depth_texture"),t("OES_texture_float"),t("OES_texture_half_float"),t("OES_texture_half_float_linear"),t("OES_standard_derivatives"),t("OES_element_index_uint"),t("OES_vertex_array_object"),t("ANGLE_instanced_arrays")),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture")},get:function(i){const s=t(i);return s===null&&console.warn("THREE.WebGLRenderer: "+i+" extension not supported."),s}}}function VH(n,e,t,i){const s={},r=new WeakMap;function o(d){const f=d.target;f.index!==null&&e.remove(f.index);for(const g in f.attributes)e.remove(f.attributes[g]);for(const g in f.morphAttributes){const A=f.morphAttributes[g];for(let v=0,m=A.length;v<m;v++)e.remove(A[v])}f.removeEventListener("dispose",o),delete s[f.id];const p=r.get(f);p&&(e.remove(p),r.delete(f)),i.releaseStatesOfGeometry(f),f.isInstancedBufferGeometry===!0&&delete f._maxInstanceCount,t.memory.geometries--}function a(d,f){return s[f.id]===!0||(f.addEventListener("dispose",o),s[f.id]=!0,t.memory.geometries++),f}function l(d){const f=d.attributes;for(const g in f)e.update(f[g],n.ARRAY_BUFFER);const p=d.morphAttributes;for(const g in p){const A=p[g];for(let v=0,m=A.length;v<m;v++)e.update(A[v],n.ARRAY_BUFFER)}}function c(d){const f=[],p=d.index,g=d.attributes.position;let A=0;if(p!==null){const b=p.array;A=p.version;for(let y=0,_=b.length;y<_;y+=3){const E=b[y+0],M=b[y+1],I=b[y+2];f.push(E,M,M,I,I,E)}}else{const b=g.array;A=g.version;for(let y=0,_=b.length/3-1;y<_;y+=3){const E=y+0,M=y+1,I=y+2;f.push(E,M,M,I,I,E)}}const v=new(Ek(f)?nM:iM)(f,1);v.version=A;const m=r.get(d);m&&e.remove(m),r.set(d,v)}function u(d){const f=r.get(d);if(f){const p=d.index;p!==null&&f.version<p.version&&c(d)}else c(d);return r.get(d)}return{get:a,update:l,getWireframeAttribute:u}}function HH(n,e,t,i){const s=i.isWebGL2;let r;function o(f){r=f}let a,l;function c(f){a=f.type,l=f.bytesPerElement}function u(f,p){n.drawElements(r,p,a,f*l),t.update(p,r,1)}function d(f,p,g){if(g===0)return;let A,v;if(s)A=n,v="drawElementsInstanced";else if(A=e.get("ANGLE_instanced_arrays"),v="drawElementsInstancedANGLE",A===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}A[v](r,p,a,f*l,g),t.update(p,r,g)}this.setMode=o,this.setIndex=c,this.render=u,this.renderInstances=d}function QH(n){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function i(r,o,a){switch(t.calls++,o){case n.TRIANGLES:t.triangles+=a*(r/3);break;case n.LINES:t.lines+=a*(r/2);break;case n.LINE_STRIP:t.lines+=a*(r-1);break;case n.LINE_LOOP:t.lines+=a*r;break;case n.POINTS:t.points+=a*r;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o);break}}function s(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:s,update:i}}function WH(n,e){return n[0]-e[0]}function jH(n,e){return Math.abs(e[1])-Math.abs(n[1])}function qH(n,e,t){const i={},s=new Float32Array(8),r=new WeakMap,o=new Ke,a=[];for(let c=0;c<8;c++)a[c]=[c,0];function l(c,u,d){const f=c.morphTargetInfluences;if(e.isWebGL2===!0){const p=u.morphAttributes.position||u.morphAttributes.normal||u.morphAttributes.color,g=p!==void 0?p.length:0;let A=r.get(u);if(A===void 0||A.count!==g){let H=function(){J.dispose(),r.delete(u),u.removeEventListener("dispose",H)};A!==void 0&&A.texture.dispose();const b=u.morphAttributes.position!==void 0,y=u.morphAttributes.normal!==void 0,_=u.morphAttributes.color!==void 0,E=u.morphAttributes.position||[],M=u.morphAttributes.normal||[],I=u.morphAttributes.color||[];let R=0;b===!0&&(R=1),y===!0&&(R=2),_===!0&&(R=3);let C=u.attributes.position.count*R,T=1;C>e.maxTextureSize&&(T=Math.ceil(C/e.maxTextureSize),C=e.maxTextureSize);const O=new Float32Array(C*T*4*g),J=new xb(O,C,T,g);J.type=sn,J.needsUpdate=!0;const V=R*4;for(let Y=0;Y<g;Y++){const N=E[Y],L=M[Y],G=I[Y],ee=C*T*4*Y;for(let $=0;$<N.count;$++){const j=$*V;b===!0&&(o.fromBufferAttribute(N,$),O[ee+j+0]=o.x,O[ee+j+1]=o.y,O[ee+j+2]=o.z,O[ee+j+3]=0),y===!0&&(o.fromBufferAttribute(L,$),O[ee+j+4]=o.x,O[ee+j+5]=o.y,O[ee+j+6]=o.z,O[ee+j+7]=0),_===!0&&(o.fromBufferAttribute(G,$),O[ee+j+8]=o.x,O[ee+j+9]=o.y,O[ee+j+10]=o.z,O[ee+j+11]=G.itemSize===4?o.w:1)}}A={count:g,texture:J,size:new te(C,T)},r.set(u,A),u.addEventListener("dispose",H)}let v=0;for(let b=0;b<f.length;b++)v+=f[b];const m=u.morphTargetsRelative?1:1-v;d.getUniforms().setValue(n,"morphTargetBaseInfluence",m),d.getUniforms().setValue(n,"morphTargetInfluences",f),d.getUniforms().setValue(n,"morphTargetsTexture",A.texture,t),d.getUniforms().setValue(n,"morphTargetsTextureSize",A.size)}else{const p=f===void 0?0:f.length;let g=i[u.id];if(g===void 0||g.length!==p){g=[];for(let y=0;y<p;y++)g[y]=[y,0];i[u.id]=g}for(let y=0;y<p;y++){const _=g[y];_[0]=y,_[1]=f[y]}g.sort(jH);for(let y=0;y<8;y++)y<p&&g[y][1]?(a[y][0]=g[y][0],a[y][1]=g[y][1]):(a[y][0]=Number.MAX_SAFE_INTEGER,a[y][1]=0);a.sort(WH);const A=u.morphAttributes.position,v=u.morphAttributes.normal;let m=0;for(let y=0;y<8;y++){const _=a[y],E=_[0],M=_[1];E!==Number.MAX_SAFE_INTEGER&&M?(A&&u.getAttribute("morphTarget"+y)!==A[E]&&u.setAttribute("morphTarget"+y,A[E]),v&&u.getAttribute("morphNormal"+y)!==v[E]&&u.setAttribute("morphNormal"+y,v[E]),s[y]=M,m+=M):(A&&u.hasAttribute("morphTarget"+y)===!0&&u.deleteAttribute("morphTarget"+y),v&&u.hasAttribute("morphNormal"+y)===!0&&u.deleteAttribute("morphNormal"+y),s[y]=0)}const b=u.morphTargetsRelative?1:1-m;d.getUniforms().setValue(n,"morphTargetBaseInfluence",b),d.getUniforms().setValue(n,"morphTargetInfluences",s)}}return{update:l}}function XH(n,e,t,i){let s=new WeakMap;function r(l){const c=i.render.frame,u=l.geometry,d=e.get(l,u);if(s.get(d)!==c&&(e.update(d),s.set(d,c)),l.isInstancedMesh&&(l.hasEventListener("dispose",a)===!1&&l.addEventListener("dispose",a),s.get(l)!==c&&(t.update(l.instanceMatrix,n.ARRAY_BUFFER),l.instanceColor!==null&&t.update(l.instanceColor,n.ARRAY_BUFFER),s.set(l,c))),l.isSkinnedMesh){const f=l.skeleton;s.get(f)!==c&&(f.update(),s.set(f,c))}return d}function o(){s=new WeakMap}function a(l){const c=l.target;c.removeEventListener("dispose",a),t.remove(c.instanceMatrix),c.instanceColor!==null&&t.remove(c.instanceColor)}return{update:r,dispose:o}}const Pk=new Rt,Bk=new xb,Dk=new wb,Ok=new Zm,BI=[],DI=[],OI=new Float32Array(16),kI=new Float32Array(9),LI=new Float32Array(4);function Xf(n,e,t){const i=n[0];if(i<=0||i>0)return n;const s=e*t;let r=BI[s];if(r===void 0&&(r=new Float32Array(s),BI[s]=r),e!==0){i.toArray(r,0);for(let o=1,a=0;o!==e;++o)a+=t,n[o].toArray(r,a)}return r}function kn(n,e){if(n.length!==e.length)return!1;for(let t=0,i=n.length;t<i;t++)if(n[t]!==e[t])return!1;return!0}function Ln(n,e){for(let t=0,i=e.length;t<i;t++)n[t]=e[t]}function Mb(n,e){let t=DI[e];t===void 0&&(t=new Int32Array(e),DI[e]=t);for(let i=0;i!==e;++i)t[i]=n.allocateTextureUnit();return t}function YH(n,e){const t=this.cache;t[0]!==e&&(n.uniform1f(this.addr,e),t[0]=e)}function JH(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(kn(t,e))return;n.uniform2fv(this.addr,e),Ln(t,e)}}function KH(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(n.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(kn(t,e))return;n.uniform3fv(this.addr,e),Ln(t,e)}}function ZH(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(kn(t,e))return;n.uniform4fv(this.addr,e),Ln(t,e)}}function $H(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(kn(t,e))return;n.uniformMatrix2fv(this.addr,!1,e),Ln(t,e)}else{if(kn(t,i))return;LI.set(i),n.uniformMatrix2fv(this.addr,!1,LI),Ln(t,i)}}function eQ(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(kn(t,e))return;n.uniformMatrix3fv(this.addr,!1,e),Ln(t,e)}else{if(kn(t,i))return;kI.set(i),n.uniformMatrix3fv(this.addr,!1,kI),Ln(t,i)}}function tQ(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(kn(t,e))return;n.uniformMatrix4fv(this.addr,!1,e),Ln(t,e)}else{if(kn(t,i))return;OI.set(i),n.uniformMatrix4fv(this.addr,!1,OI),Ln(t,i)}}function iQ(n,e){const t=this.cache;t[0]!==e&&(n.uniform1i(this.addr,e),t[0]=e)}function nQ(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(kn(t,e))return;n.uniform2iv(this.addr,e),Ln(t,e)}}function sQ(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(kn(t,e))return;n.uniform3iv(this.addr,e),Ln(t,e)}}function rQ(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(kn(t,e))return;n.uniform4iv(this.addr,e),Ln(t,e)}}function oQ(n,e){const t=this.cache;t[0]!==e&&(n.uniform1ui(this.addr,e),t[0]=e)}function aQ(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(kn(t,e))return;n.uniform2uiv(this.addr,e),Ln(t,e)}}function lQ(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(kn(t,e))return;n.uniform3uiv(this.addr,e),Ln(t,e)}}function cQ(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(kn(t,e))return;n.uniform4uiv(this.addr,e),Ln(t,e)}}function hQ(n,e,t){const i=this.cache,s=t.allocateTextureUnit();i[0]!==s&&(n.uniform1i(this.addr,s),i[0]=s),t.setTexture2D(e||Pk,s)}function uQ(n,e,t){const i=this.cache,s=t.allocateTextureUnit();i[0]!==s&&(n.uniform1i(this.addr,s),i[0]=s),t.setTexture3D(e||Dk,s)}function dQ(n,e,t){const i=this.cache,s=t.allocateTextureUnit();i[0]!==s&&(n.uniform1i(this.addr,s),i[0]=s),t.setTextureCube(e||Ok,s)}function fQ(n,e,t){const i=this.cache,s=t.allocateTextureUnit();i[0]!==s&&(n.uniform1i(this.addr,s),i[0]=s),t.setTexture2DArray(e||Bk,s)}function pQ(n){switch(n){case 5126:return YH;case 35664:return JH;case 35665:return KH;case 35666:return ZH;case 35674:return $H;case 35675:return eQ;case 35676:return tQ;case 5124:case 35670:return iQ;case 35667:case 35671:return nQ;case 35668:case 35672:return sQ;case 35669:case 35673:return rQ;case 5125:return oQ;case 36294:return aQ;case 36295:return lQ;case 36296:return cQ;case 35678:case 36198:case 36298:case 36306:case 35682:return hQ;case 35679:case 36299:case 36307:return uQ;case 35680:case 36300:case 36308:case 36293:return dQ;case 36289:case 36303:case 36311:case 36292:return fQ}}function gQ(n,e){n.uniform1fv(this.addr,e)}function mQ(n,e){const t=Xf(e,this.size,2);n.uniform2fv(this.addr,t)}function AQ(n,e){const t=Xf(e,this.size,3);n.uniform3fv(this.addr,t)}function vQ(n,e){const t=Xf(e,this.size,4);n.uniform4fv(this.addr,t)}function yQ(n,e){const t=Xf(e,this.size,4);n.uniformMatrix2fv(this.addr,!1,t)}function bQ(n,e){const t=Xf(e,this.size,9);n.uniformMatrix3fv(this.addr,!1,t)}function _Q(n,e){const t=Xf(e,this.size,16);n.uniformMatrix4fv(this.addr,!1,t)}function xQ(n,e){n.uniform1iv(this.addr,e)}function wQ(n,e){n.uniform2iv(this.addr,e)}function SQ(n,e){n.uniform3iv(this.addr,e)}function CQ(n,e){n.uniform4iv(this.addr,e)}function EQ(n,e){n.uniform1uiv(this.addr,e)}function MQ(n,e){n.uniform2uiv(this.addr,e)}function TQ(n,e){n.uniform3uiv(this.addr,e)}function IQ(n,e){n.uniform4uiv(this.addr,e)}function RQ(n,e,t){const i=this.cache,s=e.length,r=Mb(t,s);kn(i,r)||(n.uniform1iv(this.addr,r),Ln(i,r));for(let o=0;o!==s;++o)t.setTexture2D(e[o]||Pk,r[o])}function PQ(n,e,t){const i=this.cache,s=e.length,r=Mb(t,s);kn(i,r)||(n.uniform1iv(this.addr,r),Ln(i,r));for(let o=0;o!==s;++o)t.setTexture3D(e[o]||Dk,r[o])}function BQ(n,e,t){const i=this.cache,s=e.length,r=Mb(t,s);kn(i,r)||(n.uniform1iv(this.addr,r),Ln(i,r));for(let o=0;o!==s;++o)t.setTextureCube(e[o]||Ok,r[o])}function DQ(n,e,t){const i=this.cache,s=e.length,r=Mb(t,s);kn(i,r)||(n.uniform1iv(this.addr,r),Ln(i,r));for(let o=0;o!==s;++o)t.setTexture2DArray(e[o]||Bk,r[o])}function OQ(n){switch(n){case 5126:return gQ;case 35664:return mQ;case 35665:return AQ;case 35666:return vQ;case 35674:return yQ;case 35675:return bQ;case 35676:return _Q;case 5124:case 35670:return xQ;case 35667:case 35671:return wQ;case 35668:case 35672:return SQ;case 35669:case 35673:return CQ;case 5125:return EQ;case 36294:return MQ;case 36295:return TQ;case 36296:return IQ;case 35678:case 36198:case 36298:case 36306:case 35682:return RQ;case 35679:case 36299:case 36307:return PQ;case 35680:case 36300:case 36308:case 36293:return BQ;case 36289:case 36303:case 36311:case 36292:return DQ}}class kQ{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.setValue=pQ(t.type)}}class LQ{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.size=t.size,this.setValue=OQ(t.type)}}class FQ{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,i){const s=this.seq;for(let r=0,o=s.length;r!==o;++r){const a=s[r];a.setValue(e,t[a.id],i)}}}const Nx=/(\w+)(\])?(\[|\.)?/g;function FI(n,e){n.seq.push(e),n.map[e.id]=e}function UQ(n,e,t){const i=n.name,s=i.length;for(Nx.lastIndex=0;;){const r=Nx.exec(i),o=Nx.lastIndex;let a=r[1];const l=r[2]==="]",c=r[3];if(l&&(a=a|0),c===void 0||c==="["&&o+2===s){FI(t,c===void 0?new kQ(a,n,e):new LQ(a,n,e));break}else{let d=t.map[a];d===void 0&&(d=new FQ(a),FI(t,d)),t=d}}}class Sy{constructor(e,t){this.seq=[],this.map={};const i=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let s=0;s<i;++s){const r=e.getActiveUniform(t,s),o=e.getUniformLocation(t,r.name);UQ(r,o,this)}}setValue(e,t,i,s){const r=this.map[t];r!==void 0&&r.setValue(e,i,s)}setOptional(e,t,i){const s=t[i];s!==void 0&&this.setValue(e,i,s)}static upload(e,t,i,s){for(let r=0,o=t.length;r!==o;++r){const a=t[r],l=i[a.id];l.needsUpdate!==!1&&a.setValue(e,l.value,s)}}static seqWithValue(e,t){const i=[];for(let s=0,r=e.length;s!==r;++s){const o=e[s];o.id in t&&i.push(o)}return i}}function UI(n,e,t){const i=n.createShader(e);return n.shaderSource(i,t),n.compileShader(i),i}let NQ=0;function zQ(n,e){const t=n.split(`
`),i=[],s=Math.max(e-6,0),r=Math.min(e+6,t.length);for(let o=s;o<r;o++){const a=o+1;i.push(`${a===e?">":" "} ${a}: ${t[o]}`)}return i.join(`
`)}function GQ(n){switch(n){case gn:return["Linear","( value )"];case Je:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",n),["Linear","( value )"]}}function NI(n,e,t){const i=n.getShaderParameter(e,n.COMPILE_STATUS),s=n.getShaderInfoLog(e).trim();if(i&&s==="")return"";const r=/ERROR: 0:(\d+)/.exec(s);if(r){const o=parseInt(r[1]);return t.toUpperCase()+`

`+s+`

`+zQ(n.getShaderSource(e),o)}else return s}function VQ(n,e){const t=GQ(e);return"vec4 "+n+"( vec4 value ) { return LinearTo"+t[0]+t[1]+"; }"}function HQ(n,e){let t;switch(e){case dm:t="Linear";break;case zE:t="Reinhard";break;case XO:t="OptimizedCineon";break;case GE:t="ACESFilmic";break;case YO:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+n+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function QQ(n){return[n.extensionDerivatives||n.envMapCubeUVHeight||n.bumpMap||n.normalMapTangentSpace||n.clearcoatNormalMap||n.flatShading||n.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(n.extensionFragDepth||n.logarithmicDepthBuffer)&&n.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",n.extensionDrawBuffers&&n.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(n.extensionShaderTextureLOD||n.envMap||n.transmission)&&n.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(cg).join(`
`)}function WQ(n){const e=[];for(const t in n){const i=n[t];i!==!1&&e.push("#define "+t+" "+i)}return e.join(`
`)}function jQ(n,e){const t={},i=n.getProgramParameter(e,n.ACTIVE_ATTRIBUTES);for(let s=0;s<i;s++){const r=n.getActiveAttrib(e,s),o=r.name;let a=1;r.type===n.FLOAT_MAT2&&(a=2),r.type===n.FLOAT_MAT3&&(a=3),r.type===n.FLOAT_MAT4&&(a=4),t[o]={type:r.type,location:n.getAttribLocation(e,o),locationSize:a}}return t}function cg(n){return n!==""}function zI(n,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return n.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function GI(n,e){return n.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const qQ=/^[ \t]*#include +<([\w\d./]+)>/gm;function eC(n){return n.replace(qQ,YQ)}const XQ=new Map([["encodings_fragment","colorspace_fragment"],["encodings_pars_fragment","colorspace_pars_fragment"],["output_fragment","opaque_fragment"]]);function YQ(n,e){let t=Tt[e];if(t===void 0){const i=XQ.get(e);if(i!==void 0)t=Tt[i],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,i);else throw new Error("Can not resolve #include <"+e+">")}return eC(t)}const JQ=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function VI(n){return n.replace(JQ,KQ)}function KQ(n,e,t,i){let s="";for(let r=parseInt(e);r<parseInt(t);r++)s+=i.replace(/\[\s*i\s*\]/g,"[ "+r+" ]").replace(/UNROLLED_LOOP_INDEX/g,r);return s}function HI(n){let e="precision "+n.precision+` float;
precision `+n.precision+" int;";return n.precision==="highp"?e+=`
#define HIGH_PRECISION`:n.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:n.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function ZQ(n){let e="SHADOWMAP_TYPE_BASIC";return n.shadowMapType===kE?e="SHADOWMAP_TYPE_PCF":n.shadowMapType===LE?e="SHADOWMAP_TYPE_PCF_SOFT":n.shadowMapType===ha&&(e="SHADOWMAP_TYPE_VSM"),e}function $Q(n){let e="ENVMAP_TYPE_CUBE";if(n.envMap)switch(n.envMapMode){case qc:case Xc:e="ENVMAP_TYPE_CUBE";break;case jf:e="ENVMAP_TYPE_CUBE_UV";break}return e}function e4(n){let e="ENVMAP_MODE_REFLECTION";if(n.envMap)switch(n.envMapMode){case Xc:e="ENVMAP_MODE_REFRACTION";break}return e}function t4(n){let e="ENVMAP_BLENDING_NONE";if(n.envMap)switch(n.combine){case Ym:e="ENVMAP_BLENDING_MULTIPLY";break;case jO:e="ENVMAP_BLENDING_MIX";break;case qO:e="ENVMAP_BLENDING_ADD";break}return e}function i4(n){const e=n.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,i=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:i,maxMip:t}}function n4(n,e,t,i){const s=n.getContext(),r=t.defines;let o=t.vertexShader,a=t.fragmentShader;const l=ZQ(t),c=$Q(t),u=e4(t),d=t4(t),f=i4(t),p=t.isWebGL2?"":QQ(t),g=WQ(r),A=s.createProgram();let v,m,b=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(v=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,g].filter(cg).join(`
`),v.length>0&&(v+=`
`),m=[p,"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,g].filter(cg).join(`
`),m.length>0&&(m+=`
`)):(v=[HI(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,g,t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+u:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors&&t.isWebGL2?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(cg).join(`
`),m=[p,HI(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,g,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+c:"",t.envMap?"#define "+u:"",t.envMap?"#define "+d:"",f?"#define CUBEUV_TEXEL_WIDTH "+f.texelWidth:"",f?"#define CUBEUV_TEXEL_HEIGHT "+f.texelHeight:"",f?"#define CUBEUV_MAX_MIP "+f.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==Qs?"#define TONE_MAPPING":"",t.toneMapping!==Qs?Tt.tonemapping_pars_fragment:"",t.toneMapping!==Qs?HQ("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",Tt.colorspace_pars_fragment,VQ("linearToOutputTexel",t.outputColorSpace),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(cg).join(`
`)),o=eC(o),o=zI(o,t),o=GI(o,t),a=eC(a),a=zI(a,t),a=GI(a,t),o=VI(o),a=VI(a),t.isWebGL2&&t.isRawShaderMaterial!==!0&&(b=`#version 300 es
`,v=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+v,m=["#define varying in",t.glslVersion===n0?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===n0?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+m);const y=b+v+o,_=b+m+a,E=UI(s,s.VERTEX_SHADER,y),M=UI(s,s.FRAGMENT_SHADER,_);if(s.attachShader(A,E),s.attachShader(A,M),t.index0AttributeName!==void 0?s.bindAttribLocation(A,0,t.index0AttributeName):t.morphTargets===!0&&s.bindAttribLocation(A,0,"position"),s.linkProgram(A),n.debug.checkShaderErrors){const C=s.getProgramInfoLog(A).trim(),T=s.getShaderInfoLog(E).trim(),O=s.getShaderInfoLog(M).trim();let J=!0,V=!0;if(s.getProgramParameter(A,s.LINK_STATUS)===!1)if(J=!1,typeof n.debug.onShaderError=="function")n.debug.onShaderError(s,A,E,M);else{const H=NI(s,E,"vertex"),Y=NI(s,M,"fragment");console.error("THREE.WebGLProgram: Shader Error "+s.getError()+" - VALIDATE_STATUS "+s.getProgramParameter(A,s.VALIDATE_STATUS)+`

Program Info Log: `+C+`
`+H+`
`+Y)}else C!==""?console.warn("THREE.WebGLProgram: Program Info Log:",C):(T===""||O==="")&&(V=!1);V&&(this.diagnostics={runnable:J,programLog:C,vertexShader:{log:T,prefix:v},fragmentShader:{log:O,prefix:m}})}s.deleteShader(E),s.deleteShader(M);let I;this.getUniforms=function(){return I===void 0&&(I=new Sy(s,A)),I};let R;return this.getAttributes=function(){return R===void 0&&(R=jQ(s,A)),R},this.destroy=function(){i.releaseStatesOfProgram(this),s.deleteProgram(A),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=NQ++,this.cacheKey=e,this.usedTimes=1,this.program=A,this.vertexShader=E,this.fragmentShader=M,this}let s4=0;class r4{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,i=e.fragmentShader,s=this._getShaderStage(t),r=this._getShaderStage(i),o=this._getShaderCacheForMaterial(e);return o.has(s)===!1&&(o.add(s),s.usedTimes++),o.has(r)===!1&&(o.add(r),r.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const i of t)i.usedTimes--,i.usedTimes===0&&this.shaderCache.delete(i.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let i=t.get(e);return i===void 0&&(i=new Set,t.set(e,i)),i}_getShaderStage(e){const t=this.shaderCache;let i=t.get(e);return i===void 0&&(i=new o4(e),t.set(e,i)),i}}class o4{constructor(e){this.id=s4++,this.code=e,this.usedTimes=0}}function a4(n,e,t,i,s,r,o){const a=new Ss,l=new r4,c=[],u=s.isWebGL2,d=s.logarithmicDepthBuffer,f=s.vertexTextures;let p=s.precision;const g={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function A(C){return C===0?"uv":`uv${C}`}function v(C,T,O,J,V){const H=J.fog,Y=V.geometry,N=C.isMeshStandardMaterial?J.environment:null,L=(C.isMeshStandardMaterial?t:e).get(C.envMap||N),G=L&&L.mapping===jf?L.image.height:null,ee=g[C.type];C.precision!==null&&(p=s.getMaxPrecision(C.precision),p!==C.precision&&console.warn("THREE.WebGLProgram.getParameters:",C.precision,"not supported, using",p,"instead."));const $=Y.morphAttributes.position||Y.morphAttributes.normal||Y.morphAttributes.color,j=$!==void 0?$.length:0;let ie=0;Y.morphAttributes.position!==void 0&&(ie=1),Y.morphAttributes.normal!==void 0&&(ie=2),Y.morphAttributes.color!==void 0&&(ie=3);let Ae,ge,Ce,Ee;if(ee){const qr=Rr[ee];Ae=qr.vertexShader,ge=qr.fragmentShader}else Ae=C.vertexShader,ge=C.fragmentShader,l.update(C),Ce=l.getVertexShaderID(C),Ee=l.getFragmentShaderID(C);const Ne=n.getRenderTarget(),Ve=V.isInstancedMesh===!0,lt=!!C.map,xt=!!C.matcap,et=!!L,W=!!C.aoMap,Le=!!C.lightMap,me=!!C.bumpMap,ke=!!C.normalMap,we=!!C.displacementMap,Ze=!!C.emissiveMap,We=!!C.metalnessMap,qe=!!C.roughnessMap,pt=C.anisotropy>0,wt=C.clearcoat>0,Qt=C.iridescence>0,z=C.sheen>0,k=C.transmission>0,he=pt&&!!C.anisotropyMap,Re=wt&&!!C.clearcoatMap,Pe=wt&&!!C.clearcoatNormalMap,Fe=wt&&!!C.clearcoatRoughnessMap,X=Qt&&!!C.iridescenceMap,de=Qt&&!!C.iridescenceThicknessMap,le=z&&!!C.sheenColorMap,Qe=z&&!!C.sheenRoughnessMap,je=!!C.specularMap,Ge=!!C.specularColorMap,Oe=!!C.specularIntensityMap,it=k&&!!C.transmissionMap,gt=k&&!!C.thicknessMap,yt=!!C.gradientMap,Z=!!C.alphaMap,ue=C.alphaTest>0,fe=!!C.alphaHash,He=!!C.extensions,Xe=!!Y.attributes.uv1,Zt=!!Y.attributes.uv2,Ii=!!Y.attributes.uv3;return{isWebGL2:u,shaderID:ee,shaderType:C.type,shaderName:C.name,vertexShader:Ae,fragmentShader:ge,defines:C.defines,customVertexShaderID:Ce,customFragmentShaderID:Ee,isRawShaderMaterial:C.isRawShaderMaterial===!0,glslVersion:C.glslVersion,precision:p,instancing:Ve,instancingColor:Ve&&V.instanceColor!==null,supportsVertexTextures:f,outputColorSpace:Ne===null?n.outputColorSpace:Ne.isXRRenderTarget===!0?Ne.texture.colorSpace:gn,map:lt,matcap:xt,envMap:et,envMapMode:et&&L.mapping,envMapCubeUVHeight:G,aoMap:W,lightMap:Le,bumpMap:me,normalMap:ke,displacementMap:f&&we,emissiveMap:Ze,normalMapObjectSpace:ke&&C.normalMapType===nk,normalMapTangentSpace:ke&&C.normalMapType===sh,metalnessMap:We,roughnessMap:qe,anisotropy:pt,anisotropyMap:he,clearcoat:wt,clearcoatMap:Re,clearcoatNormalMap:Pe,clearcoatRoughnessMap:Fe,iridescence:Qt,iridescenceMap:X,iridescenceThicknessMap:de,sheen:z,sheenColorMap:le,sheenRoughnessMap:Qe,specularMap:je,specularColorMap:Ge,specularIntensityMap:Oe,transmission:k,transmissionMap:it,thicknessMap:gt,gradientMap:yt,opaque:C.transparent===!1&&C.blending===Lc,alphaMap:Z,alphaTest:ue,alphaHash:fe,combine:C.combine,mapUv:lt&&A(C.map.channel),aoMapUv:W&&A(C.aoMap.channel),lightMapUv:Le&&A(C.lightMap.channel),bumpMapUv:me&&A(C.bumpMap.channel),normalMapUv:ke&&A(C.normalMap.channel),displacementMapUv:we&&A(C.displacementMap.channel),emissiveMapUv:Ze&&A(C.emissiveMap.channel),metalnessMapUv:We&&A(C.metalnessMap.channel),roughnessMapUv:qe&&A(C.roughnessMap.channel),anisotropyMapUv:he&&A(C.anisotropyMap.channel),clearcoatMapUv:Re&&A(C.clearcoatMap.channel),clearcoatNormalMapUv:Pe&&A(C.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:Fe&&A(C.clearcoatRoughnessMap.channel),iridescenceMapUv:X&&A(C.iridescenceMap.channel),iridescenceThicknessMapUv:de&&A(C.iridescenceThicknessMap.channel),sheenColorMapUv:le&&A(C.sheenColorMap.channel),sheenRoughnessMapUv:Qe&&A(C.sheenRoughnessMap.channel),specularMapUv:je&&A(C.specularMap.channel),specularColorMapUv:Ge&&A(C.specularColorMap.channel),specularIntensityMapUv:Oe&&A(C.specularIntensityMap.channel),transmissionMapUv:it&&A(C.transmissionMap.channel),thicknessMapUv:gt&&A(C.thicknessMap.channel),alphaMapUv:Z&&A(C.alphaMap.channel),vertexTangents:!!Y.attributes.tangent&&(ke||pt),vertexColors:C.vertexColors,vertexAlphas:C.vertexColors===!0&&!!Y.attributes.color&&Y.attributes.color.itemSize===4,vertexUv1s:Xe,vertexUv2s:Zt,vertexUv3s:Ii,pointsUvs:V.isPoints===!0&&!!Y.attributes.uv&&(lt||Z),fog:!!H,useFog:C.fog===!0,fogExp2:H&&H.isFogExp2,flatShading:C.flatShading===!0,sizeAttenuation:C.sizeAttenuation===!0,logarithmicDepthBuffer:d,skinning:V.isSkinnedMesh===!0,morphTargets:Y.morphAttributes.position!==void 0,morphNormals:Y.morphAttributes.normal!==void 0,morphColors:Y.morphAttributes.color!==void 0,morphTargetsCount:j,morphTextureStride:ie,numDirLights:T.directional.length,numPointLights:T.point.length,numSpotLights:T.spot.length,numSpotLightMaps:T.spotLightMap.length,numRectAreaLights:T.rectArea.length,numHemiLights:T.hemi.length,numDirLightShadows:T.directionalShadowMap.length,numPointLightShadows:T.pointShadowMap.length,numSpotLightShadows:T.spotShadowMap.length,numSpotLightShadowsWithMaps:T.numSpotLightShadowsWithMaps,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:C.dithering,shadowMapEnabled:n.shadowMap.enabled&&O.length>0,shadowMapType:n.shadowMap.type,toneMapping:C.toneMapped?n.toneMapping:Qs,useLegacyLights:n.useLegacyLights,premultipliedAlpha:C.premultipliedAlpha,doubleSided:C.side===wi,flipSided:C.side===fn,useDepthPacking:C.depthPacking>=0,depthPacking:C.depthPacking||0,index0AttributeName:C.index0AttributeName,extensionDerivatives:He&&C.extensions.derivatives===!0,extensionFragDepth:He&&C.extensions.fragDepth===!0,extensionDrawBuffers:He&&C.extensions.drawBuffers===!0,extensionShaderTextureLOD:He&&C.extensions.shaderTextureLOD===!0,rendererExtensionFragDepth:u||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:u||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:u||i.has("EXT_shader_texture_lod"),customProgramCacheKey:C.customProgramCacheKey()}}function m(C){const T=[];if(C.shaderID?T.push(C.shaderID):(T.push(C.customVertexShaderID),T.push(C.customFragmentShaderID)),C.defines!==void 0)for(const O in C.defines)T.push(O),T.push(C.defines[O]);return C.isRawShaderMaterial===!1&&(b(T,C),y(T,C),T.push(n.outputColorSpace)),T.push(C.customProgramCacheKey),T.join()}function b(C,T){C.push(T.precision),C.push(T.outputColorSpace),C.push(T.envMapMode),C.push(T.envMapCubeUVHeight),C.push(T.mapUv),C.push(T.alphaMapUv),C.push(T.lightMapUv),C.push(T.aoMapUv),C.push(T.bumpMapUv),C.push(T.normalMapUv),C.push(T.displacementMapUv),C.push(T.emissiveMapUv),C.push(T.metalnessMapUv),C.push(T.roughnessMapUv),C.push(T.anisotropyMapUv),C.push(T.clearcoatMapUv),C.push(T.clearcoatNormalMapUv),C.push(T.clearcoatRoughnessMapUv),C.push(T.iridescenceMapUv),C.push(T.iridescenceThicknessMapUv),C.push(T.sheenColorMapUv),C.push(T.sheenRoughnessMapUv),C.push(T.specularMapUv),C.push(T.specularColorMapUv),C.push(T.specularIntensityMapUv),C.push(T.transmissionMapUv),C.push(T.thicknessMapUv),C.push(T.combine),C.push(T.fogExp2),C.push(T.sizeAttenuation),C.push(T.morphTargetsCount),C.push(T.morphAttributeCount),C.push(T.numDirLights),C.push(T.numPointLights),C.push(T.numSpotLights),C.push(T.numSpotLightMaps),C.push(T.numHemiLights),C.push(T.numRectAreaLights),C.push(T.numDirLightShadows),C.push(T.numPointLightShadows),C.push(T.numSpotLightShadows),C.push(T.numSpotLightShadowsWithMaps),C.push(T.shadowMapType),C.push(T.toneMapping),C.push(T.numClippingPlanes),C.push(T.numClipIntersection),C.push(T.depthPacking)}function y(C,T){a.disableAll(),T.isWebGL2&&a.enable(0),T.supportsVertexTextures&&a.enable(1),T.instancing&&a.enable(2),T.instancingColor&&a.enable(3),T.matcap&&a.enable(4),T.envMap&&a.enable(5),T.normalMapObjectSpace&&a.enable(6),T.normalMapTangentSpace&&a.enable(7),T.clearcoat&&a.enable(8),T.iridescence&&a.enable(9),T.alphaTest&&a.enable(10),T.vertexColors&&a.enable(11),T.vertexAlphas&&a.enable(12),T.vertexUv1s&&a.enable(13),T.vertexUv2s&&a.enable(14),T.vertexUv3s&&a.enable(15),T.vertexTangents&&a.enable(16),T.anisotropy&&a.enable(17),C.push(a.mask),a.disableAll(),T.fog&&a.enable(0),T.useFog&&a.enable(1),T.flatShading&&a.enable(2),T.logarithmicDepthBuffer&&a.enable(3),T.skinning&&a.enable(4),T.morphTargets&&a.enable(5),T.morphNormals&&a.enable(6),T.morphColors&&a.enable(7),T.premultipliedAlpha&&a.enable(8),T.shadowMapEnabled&&a.enable(9),T.useLegacyLights&&a.enable(10),T.doubleSided&&a.enable(11),T.flipSided&&a.enable(12),T.useDepthPacking&&a.enable(13),T.dithering&&a.enable(14),T.transmission&&a.enable(15),T.sheen&&a.enable(16),T.opaque&&a.enable(17),T.pointsUvs&&a.enable(18),C.push(a.mask)}function _(C){const T=g[C.type];let O;if(T){const J=Rr[T];O=Sb.clone(J.uniforms)}else O=C.uniforms;return O}function E(C,T){let O;for(let J=0,V=c.length;J<V;J++){const H=c[J];if(H.cacheKey===T){O=H,++O.usedTimes;break}}return O===void 0&&(O=new n4(n,T,C,r),c.push(O)),O}function M(C){if(--C.usedTimes===0){const T=c.indexOf(C);c[T]=c[c.length-1],c.pop(),C.destroy()}}function I(C){l.remove(C)}function R(){l.dispose()}return{getParameters:v,getProgramCacheKey:m,getUniforms:_,acquireProgram:E,releaseProgram:M,releaseShaderCache:I,programs:c,dispose:R}}function l4(){let n=new WeakMap;function e(r){let o=n.get(r);return o===void 0&&(o={},n.set(r,o)),o}function t(r){n.delete(r)}function i(r,o,a){n.get(r)[o]=a}function s(){n=new WeakMap}return{get:e,remove:t,update:i,dispose:s}}function c4(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.material.id!==e.material.id?n.material.id-e.material.id:n.z!==e.z?n.z-e.z:n.id-e.id}function QI(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}function WI(){const n=[];let e=0;const t=[],i=[],s=[];function r(){e=0,t.length=0,i.length=0,s.length=0}function o(d,f,p,g,A,v){let m=n[e];return m===void 0?(m={id:d.id,object:d,geometry:f,material:p,groupOrder:g,renderOrder:d.renderOrder,z:A,group:v},n[e]=m):(m.id=d.id,m.object=d,m.geometry=f,m.material=p,m.groupOrder=g,m.renderOrder=d.renderOrder,m.z=A,m.group=v),e++,m}function a(d,f,p,g,A,v){const m=o(d,f,p,g,A,v);p.transmission>0?i.push(m):p.transparent===!0?s.push(m):t.push(m)}function l(d,f,p,g,A,v){const m=o(d,f,p,g,A,v);p.transmission>0?i.unshift(m):p.transparent===!0?s.unshift(m):t.unshift(m)}function c(d,f){t.length>1&&t.sort(d||c4),i.length>1&&i.sort(f||QI),s.length>1&&s.sort(f||QI)}function u(){for(let d=e,f=n.length;d<f;d++){const p=n[d];if(p.id===null)break;p.id=null,p.object=null,p.geometry=null,p.material=null,p.group=null}}return{opaque:t,transmissive:i,transparent:s,init:r,push:a,unshift:l,finish:u,sort:c}}function h4(){let n=new WeakMap;function e(i,s){const r=n.get(i);let o;return r===void 0?(o=new WI,n.set(i,[o])):s>=r.length?(o=new WI,r.push(o)):o=r[s],o}function t(){n=new WeakMap}return{get:e,dispose:t}}function u4(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new w,color:new _e};break;case"SpotLight":t={position:new w,direction:new w,color:new _e,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new w,color:new _e,distance:0,decay:0};break;case"HemisphereLight":t={direction:new w,skyColor:new _e,groundColor:new _e};break;case"RectAreaLight":t={color:new _e,position:new w,halfWidth:new w,halfHeight:new w};break}return n[e.id]=t,t}}}function d4(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new te};break;case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new te};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new te,shadowCameraNear:1,shadowCameraFar:1e3};break}return n[e.id]=t,t}}}let f4=0;function p4(n,e){return(e.castShadow?2:0)-(n.castShadow?2:0)+(e.map?1:0)-(n.map?1:0)}function g4(n,e){const t=new u4,i=d4(),s={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let u=0;u<9;u++)s.probe.push(new w);const r=new w,o=new Ie,a=new Ie;function l(u,d){let f=0,p=0,g=0;for(let O=0;O<9;O++)s.probe[O].set(0,0,0);let A=0,v=0,m=0,b=0,y=0,_=0,E=0,M=0,I=0,R=0;u.sort(p4);const C=d===!0?Math.PI:1;for(let O=0,J=u.length;O<J;O++){const V=u[O],H=V.color,Y=V.intensity,N=V.distance,L=V.shadow&&V.shadow.map?V.shadow.map.texture:null;if(V.isAmbientLight)f+=H.r*Y*C,p+=H.g*Y*C,g+=H.b*Y*C;else if(V.isLightProbe)for(let G=0;G<9;G++)s.probe[G].addScaledVector(V.sh.coefficients[G],Y);else if(V.isDirectionalLight){const G=t.get(V);if(G.color.copy(V.color).multiplyScalar(V.intensity*C),V.castShadow){const ee=V.shadow,$=i.get(V);$.shadowBias=ee.bias,$.shadowNormalBias=ee.normalBias,$.shadowRadius=ee.radius,$.shadowMapSize=ee.mapSize,s.directionalShadow[A]=$,s.directionalShadowMap[A]=L,s.directionalShadowMatrix[A]=V.shadow.matrix,_++}s.directional[A]=G,A++}else if(V.isSpotLight){const G=t.get(V);G.position.setFromMatrixPosition(V.matrixWorld),G.color.copy(H).multiplyScalar(Y*C),G.distance=N,G.coneCos=Math.cos(V.angle),G.penumbraCos=Math.cos(V.angle*(1-V.penumbra)),G.decay=V.decay,s.spot[m]=G;const ee=V.shadow;if(V.map&&(s.spotLightMap[I]=V.map,I++,ee.updateMatrices(V),V.castShadow&&R++),s.spotLightMatrix[m]=ee.matrix,V.castShadow){const $=i.get(V);$.shadowBias=ee.bias,$.shadowNormalBias=ee.normalBias,$.shadowRadius=ee.radius,$.shadowMapSize=ee.mapSize,s.spotShadow[m]=$,s.spotShadowMap[m]=L,M++}m++}else if(V.isRectAreaLight){const G=t.get(V);G.color.copy(H).multiplyScalar(Y),G.halfWidth.set(V.width*.5,0,0),G.halfHeight.set(0,V.height*.5,0),s.rectArea[b]=G,b++}else if(V.isPointLight){const G=t.get(V);if(G.color.copy(V.color).multiplyScalar(V.intensity*C),G.distance=V.distance,G.decay=V.decay,V.castShadow){const ee=V.shadow,$=i.get(V);$.shadowBias=ee.bias,$.shadowNormalBias=ee.normalBias,$.shadowRadius=ee.radius,$.shadowMapSize=ee.mapSize,$.shadowCameraNear=ee.camera.near,$.shadowCameraFar=ee.camera.far,s.pointShadow[v]=$,s.pointShadowMap[v]=L,s.pointShadowMatrix[v]=V.shadow.matrix,E++}s.point[v]=G,v++}else if(V.isHemisphereLight){const G=t.get(V);G.skyColor.copy(V.color).multiplyScalar(Y*C),G.groundColor.copy(V.groundColor).multiplyScalar(Y*C),s.hemi[y]=G,y++}}b>0&&(e.isWebGL2||n.has("OES_texture_float_linear")===!0?(s.rectAreaLTC1=Ue.LTC_FLOAT_1,s.rectAreaLTC2=Ue.LTC_FLOAT_2):n.has("OES_texture_half_float_linear")===!0?(s.rectAreaLTC1=Ue.LTC_HALF_1,s.rectAreaLTC2=Ue.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),s.ambient[0]=f,s.ambient[1]=p,s.ambient[2]=g;const T=s.hash;(T.directionalLength!==A||T.pointLength!==v||T.spotLength!==m||T.rectAreaLength!==b||T.hemiLength!==y||T.numDirectionalShadows!==_||T.numPointShadows!==E||T.numSpotShadows!==M||T.numSpotMaps!==I)&&(s.directional.length=A,s.spot.length=m,s.rectArea.length=b,s.point.length=v,s.hemi.length=y,s.directionalShadow.length=_,s.directionalShadowMap.length=_,s.pointShadow.length=E,s.pointShadowMap.length=E,s.spotShadow.length=M,s.spotShadowMap.length=M,s.directionalShadowMatrix.length=_,s.pointShadowMatrix.length=E,s.spotLightMatrix.length=M+I-R,s.spotLightMap.length=I,s.numSpotLightShadowsWithMaps=R,T.directionalLength=A,T.pointLength=v,T.spotLength=m,T.rectAreaLength=b,T.hemiLength=y,T.numDirectionalShadows=_,T.numPointShadows=E,T.numSpotShadows=M,T.numSpotMaps=I,s.version=f4++)}function c(u,d){let f=0,p=0,g=0,A=0,v=0;const m=d.matrixWorldInverse;for(let b=0,y=u.length;b<y;b++){const _=u[b];if(_.isDirectionalLight){const E=s.directional[f];E.direction.setFromMatrixPosition(_.matrixWorld),r.setFromMatrixPosition(_.target.matrixWorld),E.direction.sub(r),E.direction.transformDirection(m),f++}else if(_.isSpotLight){const E=s.spot[g];E.position.setFromMatrixPosition(_.matrixWorld),E.position.applyMatrix4(m),E.direction.setFromMatrixPosition(_.matrixWorld),r.setFromMatrixPosition(_.target.matrixWorld),E.direction.sub(r),E.direction.transformDirection(m),g++}else if(_.isRectAreaLight){const E=s.rectArea[A];E.position.setFromMatrixPosition(_.matrixWorld),E.position.applyMatrix4(m),a.identity(),o.copy(_.matrixWorld),o.premultiply(m),a.extractRotation(o),E.halfWidth.set(_.width*.5,0,0),E.halfHeight.set(0,_.height*.5,0),E.halfWidth.applyMatrix4(a),E.halfHeight.applyMatrix4(a),A++}else if(_.isPointLight){const E=s.point[p];E.position.setFromMatrixPosition(_.matrixWorld),E.position.applyMatrix4(m),p++}else if(_.isHemisphereLight){const E=s.hemi[v];E.direction.setFromMatrixPosition(_.matrixWorld),E.direction.transformDirection(m),v++}}}return{setup:l,setupView:c,state:s}}function jI(n,e){const t=new g4(n,e),i=[],s=[];function r(){i.length=0,s.length=0}function o(d){i.push(d)}function a(d){s.push(d)}function l(d){t.setup(i,d)}function c(d){t.setupView(i,d)}return{init:r,state:{lightsArray:i,shadowsArray:s,lights:t},setupLights:l,setupLightsView:c,pushLight:o,pushShadow:a}}function m4(n,e){let t=new WeakMap;function i(r,o=0){const a=t.get(r);let l;return a===void 0?(l=new jI(n,e),t.set(r,[l])):o>=a.length?(l=new jI(n,e),a.push(l)):l=a[o],l}function s(){t=new WeakMap}return{get:i,dispose:s}}class Tb extends Pt{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=hs,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class oM extends Pt{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const A4=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,v4=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function y4(n,e,t){let i=new Eb;const s=new te,r=new te,o=new Ke,a=new Tb({depthPacking:_b}),l=new oM,c={},u=t.maxTextureSize,d={[Es]:fn,[fn]:Es,[wi]:wi},f=new Bt({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new te},radius:{value:4}},vertexShader:A4,fragmentShader:v4}),p=f.clone();p.defines.HORIZONTAL_PASS=1;const g=new ft;g.setAttribute("position",new ot(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const A=new ye(g,f),v=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=kE;let m=this.type;this.render=function(E,M,I){if(v.enabled===!1||v.autoUpdate===!1&&v.needsUpdate===!1||E.length===0)return;const R=n.getRenderTarget(),C=n.getActiveCubeFace(),T=n.getActiveMipmapLevel(),O=n.state;O.setBlending(qi),O.buffers.color.setClear(1,1,1,1),O.buffers.depth.setTest(!0),O.setScissorTest(!1);const J=m!==ha&&this.type===ha,V=m===ha&&this.type!==ha;for(let H=0,Y=E.length;H<Y;H++){const N=E[H],L=N.shadow;if(L===void 0){console.warn("THREE.WebGLShadowMap:",N,"has no shadow.");continue}if(L.autoUpdate===!1&&L.needsUpdate===!1)continue;s.copy(L.mapSize);const G=L.getFrameExtents();if(s.multiply(G),r.copy(L.mapSize),(s.x>u||s.y>u)&&(s.x>u&&(r.x=Math.floor(u/G.x),s.x=r.x*G.x,L.mapSize.x=r.x),s.y>u&&(r.y=Math.floor(u/G.y),s.y=r.y*G.y,L.mapSize.y=r.y)),L.map===null||J===!0||V===!0){const $=this.type!==ha?{minFilter:Ft,magFilter:Ft}:{};L.map!==null&&L.map.dispose(),L.map=new ni(s.x,s.y,$),L.map.texture.name=N.name+".shadowMap",L.camera.updateProjectionMatrix()}n.setRenderTarget(L.map),n.clear();const ee=L.getViewportCount();for(let $=0;$<ee;$++){const j=L.getViewport($);o.set(r.x*j.x,r.y*j.y,r.x*j.z,r.y*j.w),O.viewport(o),L.updateMatrices(N,$),i=L.getFrustum(),_(M,I,L.camera,N,this.type)}L.isPointLightShadow!==!0&&this.type===ha&&b(L,I),L.needsUpdate=!1}m=this.type,v.needsUpdate=!1,n.setRenderTarget(R,C,T)};function b(E,M){const I=e.update(A);f.defines.VSM_SAMPLES!==E.blurSamples&&(f.defines.VSM_SAMPLES=E.blurSamples,p.defines.VSM_SAMPLES=E.blurSamples,f.needsUpdate=!0,p.needsUpdate=!0),E.mapPass===null&&(E.mapPass=new ni(s.x,s.y)),f.uniforms.shadow_pass.value=E.map.texture,f.uniforms.resolution.value=E.mapSize,f.uniforms.radius.value=E.radius,n.setRenderTarget(E.mapPass),n.clear(),n.renderBufferDirect(M,null,I,f,A,null),p.uniforms.shadow_pass.value=E.mapPass.texture,p.uniforms.resolution.value=E.mapSize,p.uniforms.radius.value=E.radius,n.setRenderTarget(E.map),n.clear(),n.renderBufferDirect(M,null,I,p,A,null)}function y(E,M,I,R){let C=null;const T=I.isPointLight===!0?E.customDistanceMaterial:E.customDepthMaterial;if(T!==void 0)C=T;else if(C=I.isPointLight===!0?l:a,n.localClippingEnabled&&M.clipShadows===!0&&Array.isArray(M.clippingPlanes)&&M.clippingPlanes.length!==0||M.displacementMap&&M.displacementScale!==0||M.alphaMap&&M.alphaTest>0||M.map&&M.alphaTest>0){const O=C.uuid,J=M.uuid;let V=c[O];V===void 0&&(V={},c[O]=V);let H=V[J];H===void 0&&(H=C.clone(),V[J]=H),C=H}if(C.visible=M.visible,C.wireframe=M.wireframe,R===ha?C.side=M.shadowSide!==null?M.shadowSide:M.side:C.side=M.shadowSide!==null?M.shadowSide:d[M.side],C.alphaMap=M.alphaMap,C.alphaTest=M.alphaTest,C.map=M.map,C.clipShadows=M.clipShadows,C.clippingPlanes=M.clippingPlanes,C.clipIntersection=M.clipIntersection,C.displacementMap=M.displacementMap,C.displacementScale=M.displacementScale,C.displacementBias=M.displacementBias,C.wireframeLinewidth=M.wireframeLinewidth,C.linewidth=M.linewidth,I.isPointLight===!0&&C.isMeshDistanceMaterial===!0){const O=n.properties.get(C);O.light=I}return C}function _(E,M,I,R,C){if(E.visible===!1)return;if(E.layers.test(M.layers)&&(E.isMesh||E.isLine||E.isPoints)&&(E.castShadow||E.receiveShadow&&C===ha)&&(!E.frustumCulled||i.intersectsObject(E))){E.modelViewMatrix.multiplyMatrices(I.matrixWorldInverse,E.matrixWorld);const J=e.update(E),V=E.material;if(Array.isArray(V)){const H=J.groups;for(let Y=0,N=H.length;Y<N;Y++){const L=H[Y],G=V[L.materialIndex];if(G&&G.visible){const ee=y(E,G,R,C);n.renderBufferDirect(I,null,J,ee,E,L)}}}else if(V.visible){const H=y(E,V,R,C);n.renderBufferDirect(I,null,J,H,E,null)}}const O=E.children;for(let J=0,V=O.length;J<V;J++)_(O[J],M,I,R,C)}}function b4(n,e,t){const i=t.isWebGL2;function s(){let Z=!1;const ue=new Ke;let fe=null;const He=new Ke(0,0,0,0);return{setMask:function(Xe){fe!==Xe&&!Z&&(n.colorMask(Xe,Xe,Xe,Xe),fe=Xe)},setLocked:function(Xe){Z=Xe},setClear:function(Xe,Zt,Ii,mn,qr){qr===!0&&(Xe*=mn,Zt*=mn,Ii*=mn),ue.set(Xe,Zt,Ii,mn),He.equals(ue)===!1&&(n.clearColor(Xe,Zt,Ii,mn),He.copy(ue))},reset:function(){Z=!1,fe=null,He.set(-1,0,0,0)}}}function r(){let Z=!1,ue=null,fe=null,He=null;return{setTest:function(Xe){Xe?Ne(n.DEPTH_TEST):Ve(n.DEPTH_TEST)},setMask:function(Xe){ue!==Xe&&!Z&&(n.depthMask(Xe),ue=Xe)},setFunc:function(Xe){if(fe!==Xe){switch(Xe){case NE:n.depthFunc(n.NEVER);break;case pb:n.depthFunc(n.ALWAYS);break;case um:n.depthFunc(n.LESS);break;case Tf:n.depthFunc(n.LEQUAL);break;case If:n.depthFunc(n.EQUAL);break;case gb:n.depthFunc(n.GEQUAL);break;case mb:n.depthFunc(n.GREATER);break;case Xm:n.depthFunc(n.NOTEQUAL);break;default:n.depthFunc(n.LEQUAL)}fe=Xe}},setLocked:function(Xe){Z=Xe},setClear:function(Xe){He!==Xe&&(n.clearDepth(Xe),He=Xe)},reset:function(){Z=!1,ue=null,fe=null,He=null}}}function o(){let Z=!1,ue=null,fe=null,He=null,Xe=null,Zt=null,Ii=null,mn=null,qr=null;return{setTest:function(ki){Z||(ki?Ne(n.STENCIL_TEST):Ve(n.STENCIL_TEST))},setMask:function(ki){ue!==ki&&!Z&&(n.stencilMask(ki),ue=ki)},setFunc:function(ki,Xr,Jn){(fe!==ki||He!==Xr||Xe!==Jn)&&(n.stencilFunc(ki,Xr,Jn),fe=ki,He=Xr,Xe=Jn)},setOp:function(ki,Xr,Jn){(Zt!==ki||Ii!==Xr||mn!==Jn)&&(n.stencilOp(ki,Xr,Jn),Zt=ki,Ii=Xr,mn=Jn)},setLocked:function(ki){Z=ki},setClear:function(ki){qr!==ki&&(n.clearStencil(ki),qr=ki)},reset:function(){Z=!1,ue=null,fe=null,He=null,Xe=null,Zt=null,Ii=null,mn=null,qr=null}}}const a=new s,l=new r,c=new o,u=new WeakMap,d=new WeakMap;let f={},p={},g=new WeakMap,A=[],v=null,m=!1,b=null,y=null,_=null,E=null,M=null,I=null,R=null,C=!1,T=null,O=null,J=null,V=null,H=null;const Y=n.getParameter(n.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let N=!1,L=0;const G=n.getParameter(n.VERSION);G.indexOf("WebGL")!==-1?(L=parseFloat(/^WebGL (\d)/.exec(G)[1]),N=L>=1):G.indexOf("OpenGL ES")!==-1&&(L=parseFloat(/^OpenGL ES (\d)/.exec(G)[1]),N=L>=2);let ee=null,$={};const j=n.getParameter(n.SCISSOR_BOX),ie=n.getParameter(n.VIEWPORT),Ae=new Ke().fromArray(j),ge=new Ke().fromArray(ie);function Ce(Z,ue,fe,He){const Xe=new Uint8Array(4),Zt=n.createTexture();n.bindTexture(Z,Zt),n.texParameteri(Z,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(Z,n.TEXTURE_MAG_FILTER,n.NEAREST);for(let Ii=0;Ii<fe;Ii++)i&&(Z===n.TEXTURE_3D||Z===n.TEXTURE_2D_ARRAY)?n.texImage3D(ue,0,n.RGBA,1,1,He,0,n.RGBA,n.UNSIGNED_BYTE,Xe):n.texImage2D(ue+Ii,0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,Xe);return Zt}const Ee={};Ee[n.TEXTURE_2D]=Ce(n.TEXTURE_2D,n.TEXTURE_2D,1),Ee[n.TEXTURE_CUBE_MAP]=Ce(n.TEXTURE_CUBE_MAP,n.TEXTURE_CUBE_MAP_POSITIVE_X,6),i&&(Ee[n.TEXTURE_2D_ARRAY]=Ce(n.TEXTURE_2D_ARRAY,n.TEXTURE_2D_ARRAY,1,1),Ee[n.TEXTURE_3D]=Ce(n.TEXTURE_3D,n.TEXTURE_3D,1,1)),a.setClear(0,0,0,1),l.setClear(1),c.setClear(0),Ne(n.DEPTH_TEST),l.setFunc(Tf),we(!1),Ze(TS),Ne(n.CULL_FACE),me(qi);function Ne(Z){f[Z]!==!0&&(n.enable(Z),f[Z]=!0)}function Ve(Z){f[Z]!==!1&&(n.disable(Z),f[Z]=!1)}function lt(Z,ue){return p[Z]!==ue?(n.bindFramebuffer(Z,ue),p[Z]=ue,i&&(Z===n.DRAW_FRAMEBUFFER&&(p[n.FRAMEBUFFER]=ue),Z===n.FRAMEBUFFER&&(p[n.DRAW_FRAMEBUFFER]=ue)),!0):!1}function xt(Z,ue){let fe=A,He=!1;if(Z)if(fe=g.get(ue),fe===void 0&&(fe=[],g.set(ue,fe)),Z.isWebGLMultipleRenderTargets){const Xe=Z.texture;if(fe.length!==Xe.length||fe[0]!==n.COLOR_ATTACHMENT0){for(let Zt=0,Ii=Xe.length;Zt<Ii;Zt++)fe[Zt]=n.COLOR_ATTACHMENT0+Zt;fe.length=Xe.length,He=!0}}else fe[0]!==n.COLOR_ATTACHMENT0&&(fe[0]=n.COLOR_ATTACHMENT0,He=!0);else fe[0]!==n.BACK&&(fe[0]=n.BACK,He=!0);He&&(t.isWebGL2?n.drawBuffers(fe):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(fe))}function et(Z){return v!==Z?(n.useProgram(Z),v=Z,!0):!1}const W={[Hh]:n.FUNC_ADD,[kO]:n.FUNC_SUBTRACT,[LO]:n.FUNC_REVERSE_SUBTRACT};if(i)W[PS]=n.MIN,W[BS]=n.MAX;else{const Z=e.get("EXT_blend_minmax");Z!==null&&(W[PS]=Z.MIN_EXT,W[BS]=Z.MAX_EXT)}const Le={[FO]:n.ZERO,[UO]:n.ONE,[NO]:n.SRC_COLOR,[FE]:n.SRC_ALPHA,[WO]:n.SRC_ALPHA_SATURATE,[HO]:n.DST_COLOR,[GO]:n.DST_ALPHA,[zO]:n.ONE_MINUS_SRC_COLOR,[UE]:n.ONE_MINUS_SRC_ALPHA,[QO]:n.ONE_MINUS_DST_COLOR,[VO]:n.ONE_MINUS_DST_ALPHA};function me(Z,ue,fe,He,Xe,Zt,Ii,mn){if(Z===qi){m===!0&&(Ve(n.BLEND),m=!1);return}if(m===!1&&(Ne(n.BLEND),m=!0),Z!==OO){if(Z!==b||mn!==C){if((y!==Hh||M!==Hh)&&(n.blendEquation(n.FUNC_ADD),y=Hh,M=Hh),mn)switch(Z){case Lc:n.blendFuncSeparate(n.ONE,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case Mf:n.blendFunc(n.ONE,n.ONE);break;case IS:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case RS:n.blendFuncSeparate(n.ZERO,n.SRC_COLOR,n.ZERO,n.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",Z);break}else switch(Z){case Lc:n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case Mf:n.blendFunc(n.SRC_ALPHA,n.ONE);break;case IS:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case RS:n.blendFunc(n.ZERO,n.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",Z);break}_=null,E=null,I=null,R=null,b=Z,C=mn}return}Xe=Xe||ue,Zt=Zt||fe,Ii=Ii||He,(ue!==y||Xe!==M)&&(n.blendEquationSeparate(W[ue],W[Xe]),y=ue,M=Xe),(fe!==_||He!==E||Zt!==I||Ii!==R)&&(n.blendFuncSeparate(Le[fe],Le[He],Le[Zt],Le[Ii]),_=fe,E=He,I=Zt,R=Ii),b=Z,C=!1}function ke(Z,ue){Z.side===wi?Ve(n.CULL_FACE):Ne(n.CULL_FACE);let fe=Z.side===fn;ue&&(fe=!fe),we(fe),Z.blending===Lc&&Z.transparent===!1?me(qi):me(Z.blending,Z.blendEquation,Z.blendSrc,Z.blendDst,Z.blendEquationAlpha,Z.blendSrcAlpha,Z.blendDstAlpha,Z.premultipliedAlpha),l.setFunc(Z.depthFunc),l.setTest(Z.depthTest),l.setMask(Z.depthWrite),a.setMask(Z.colorWrite);const He=Z.stencilWrite;c.setTest(He),He&&(c.setMask(Z.stencilWriteMask),c.setFunc(Z.stencilFunc,Z.stencilRef,Z.stencilFuncMask),c.setOp(Z.stencilFail,Z.stencilZFail,Z.stencilZPass)),qe(Z.polygonOffset,Z.polygonOffsetFactor,Z.polygonOffsetUnits),Z.alphaToCoverage===!0?Ne(n.SAMPLE_ALPHA_TO_COVERAGE):Ve(n.SAMPLE_ALPHA_TO_COVERAGE)}function we(Z){T!==Z&&(Z?n.frontFace(n.CW):n.frontFace(n.CCW),T=Z)}function Ze(Z){Z!==BO?(Ne(n.CULL_FACE),Z!==O&&(Z===TS?n.cullFace(n.BACK):Z===DO?n.cullFace(n.FRONT):n.cullFace(n.FRONT_AND_BACK))):Ve(n.CULL_FACE),O=Z}function We(Z){Z!==J&&(N&&n.lineWidth(Z),J=Z)}function qe(Z,ue,fe){Z?(Ne(n.POLYGON_OFFSET_FILL),(V!==ue||H!==fe)&&(n.polygonOffset(ue,fe),V=ue,H=fe)):Ve(n.POLYGON_OFFSET_FILL)}function pt(Z){Z?Ne(n.SCISSOR_TEST):Ve(n.SCISSOR_TEST)}function wt(Z){Z===void 0&&(Z=n.TEXTURE0+Y-1),ee!==Z&&(n.activeTexture(Z),ee=Z)}function Qt(Z,ue,fe){fe===void 0&&(ee===null?fe=n.TEXTURE0+Y-1:fe=ee);let He=$[fe];He===void 0&&(He={type:void 0,texture:void 0},$[fe]=He),(He.type!==Z||He.texture!==ue)&&(ee!==fe&&(n.activeTexture(fe),ee=fe),n.bindTexture(Z,ue||Ee[Z]),He.type=Z,He.texture=ue)}function z(){const Z=$[ee];Z!==void 0&&Z.type!==void 0&&(n.bindTexture(Z.type,null),Z.type=void 0,Z.texture=void 0)}function k(){try{n.compressedTexImage2D.apply(n,arguments)}catch(Z){console.error("THREE.WebGLState:",Z)}}function he(){try{n.compressedTexImage3D.apply(n,arguments)}catch(Z){console.error("THREE.WebGLState:",Z)}}function Re(){try{n.texSubImage2D.apply(n,arguments)}catch(Z){console.error("THREE.WebGLState:",Z)}}function Pe(){try{n.texSubImage3D.apply(n,arguments)}catch(Z){console.error("THREE.WebGLState:",Z)}}function Fe(){try{n.compressedTexSubImage2D.apply(n,arguments)}catch(Z){console.error("THREE.WebGLState:",Z)}}function X(){try{n.compressedTexSubImage3D.apply(n,arguments)}catch(Z){console.error("THREE.WebGLState:",Z)}}function de(){try{n.texStorage2D.apply(n,arguments)}catch(Z){console.error("THREE.WebGLState:",Z)}}function le(){try{n.texStorage3D.apply(n,arguments)}catch(Z){console.error("THREE.WebGLState:",Z)}}function Qe(){try{n.texImage2D.apply(n,arguments)}catch(Z){console.error("THREE.WebGLState:",Z)}}function je(){try{n.texImage3D.apply(n,arguments)}catch(Z){console.error("THREE.WebGLState:",Z)}}function Ge(Z){Ae.equals(Z)===!1&&(n.scissor(Z.x,Z.y,Z.z,Z.w),Ae.copy(Z))}function Oe(Z){ge.equals(Z)===!1&&(n.viewport(Z.x,Z.y,Z.z,Z.w),ge.copy(Z))}function it(Z,ue){let fe=d.get(ue);fe===void 0&&(fe=new WeakMap,d.set(ue,fe));let He=fe.get(Z);He===void 0&&(He=n.getUniformBlockIndex(ue,Z.name),fe.set(Z,He))}function gt(Z,ue){const He=d.get(ue).get(Z);u.get(ue)!==He&&(n.uniformBlockBinding(ue,He,Z.__bindingPointIndex),u.set(ue,He))}function yt(){n.disable(n.BLEND),n.disable(n.CULL_FACE),n.disable(n.DEPTH_TEST),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SCISSOR_TEST),n.disable(n.STENCIL_TEST),n.disable(n.SAMPLE_ALPHA_TO_COVERAGE),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.ONE,n.ZERO),n.blendFuncSeparate(n.ONE,n.ZERO,n.ONE,n.ZERO),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.depthMask(!0),n.depthFunc(n.LESS),n.clearDepth(1),n.stencilMask(4294967295),n.stencilFunc(n.ALWAYS,0,4294967295),n.stencilOp(n.KEEP,n.KEEP,n.KEEP),n.clearStencil(0),n.cullFace(n.BACK),n.frontFace(n.CCW),n.polygonOffset(0,0),n.activeTexture(n.TEXTURE0),n.bindFramebuffer(n.FRAMEBUFFER,null),i===!0&&(n.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),n.bindFramebuffer(n.READ_FRAMEBUFFER,null)),n.useProgram(null),n.lineWidth(1),n.scissor(0,0,n.canvas.width,n.canvas.height),n.viewport(0,0,n.canvas.width,n.canvas.height),f={},ee=null,$={},p={},g=new WeakMap,A=[],v=null,m=!1,b=null,y=null,_=null,E=null,M=null,I=null,R=null,C=!1,T=null,O=null,J=null,V=null,H=null,Ae.set(0,0,n.canvas.width,n.canvas.height),ge.set(0,0,n.canvas.width,n.canvas.height),a.reset(),l.reset(),c.reset()}return{buffers:{color:a,depth:l,stencil:c},enable:Ne,disable:Ve,bindFramebuffer:lt,drawBuffers:xt,useProgram:et,setBlending:me,setMaterial:ke,setFlipSided:we,setCullFace:Ze,setLineWidth:We,setPolygonOffset:qe,setScissorTest:pt,activeTexture:wt,bindTexture:Qt,unbindTexture:z,compressedTexImage2D:k,compressedTexImage3D:he,texImage2D:Qe,texImage3D:je,updateUBOMapping:it,uniformBlockBinding:gt,texStorage2D:de,texStorage3D:le,texSubImage2D:Re,texSubImage3D:Pe,compressedTexSubImage2D:Fe,compressedTexSubImage3D:X,scissor:Ge,viewport:Oe,reset:yt}}function _4(n,e,t,i,s,r,o){const a=s.isWebGL2,l=s.maxTextures,c=s.maxCubemapSize,u=s.maxTextureSize,d=s.maxSamples,f=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,p=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),g=new WeakMap;let A;const v=new WeakMap;let m=!1;try{m=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function b(z,k){return m?new OffscreenCanvas(z,k):Am("canvas")}function y(z,k,he,Re){let Pe=1;if((z.width>Re||z.height>Re)&&(Pe=Re/Math.max(z.width,z.height)),Pe<1||k===!0)if(typeof HTMLImageElement<"u"&&z instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&z instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&z instanceof ImageBitmap){const Fe=k?r0:Math.floor,X=Fe(Pe*z.width),de=Fe(Pe*z.height);A===void 0&&(A=b(X,de));const le=he?b(X,de):A;return le.width=X,le.height=de,le.getContext("2d").drawImage(z,0,0,X,de),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+z.width+"x"+z.height+") to ("+X+"x"+de+")."),le}else return"data"in z&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+z.width+"x"+z.height+")."),z;return z}function _(z){return ZS(z.width)&&ZS(z.height)}function E(z){return a?!1:z.wrapS!==Wn||z.wrapT!==Wn||z.minFilter!==Ft&&z.minFilter!==Dt}function M(z,k){return z.generateMipmaps&&k&&z.minFilter!==Ft&&z.minFilter!==Dt}function I(z){n.generateMipmap(z)}function R(z,k,he,Re,Pe=!1){if(a===!1)return k;if(z!==null){if(n[z]!==void 0)return n[z];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+z+"'")}let Fe=k;return k===n.RED&&(he===n.FLOAT&&(Fe=n.R32F),he===n.HALF_FLOAT&&(Fe=n.R16F),he===n.UNSIGNED_BYTE&&(Fe=n.R8)),k===n.RG&&(he===n.FLOAT&&(Fe=n.RG32F),he===n.HALF_FLOAT&&(Fe=n.RG16F),he===n.UNSIGNED_BYTE&&(Fe=n.RG8)),k===n.RGBA&&(he===n.FLOAT&&(Fe=n.RGBA32F),he===n.HALF_FLOAT&&(Fe=n.RGBA16F),he===n.UNSIGNED_BYTE&&(Fe=Re===Je&&Pe===!1?n.SRGB8_ALPHA8:n.RGBA8),he===n.UNSIGNED_SHORT_4_4_4_4&&(Fe=n.RGBA4),he===n.UNSIGNED_SHORT_5_5_5_1&&(Fe=n.RGB5_A1)),(Fe===n.R16F||Fe===n.R32F||Fe===n.RG16F||Fe===n.RG32F||Fe===n.RGBA16F||Fe===n.RGBA32F)&&e.get("EXT_color_buffer_float"),Fe}function C(z,k,he){return M(z,he)===!0||z.isFramebufferTexture&&z.minFilter!==Ft&&z.minFilter!==Dt?Math.log2(Math.max(k.width,k.height))+1:z.mipmaps!==void 0&&z.mipmaps.length>0?z.mipmaps.length:z.isCompressedTexture&&Array.isArray(z.image)?k.mipmaps.length:1}function T(z){return z===Ft||z===Pf||z===fu?n.NEAREST:n.LINEAR}function O(z){const k=z.target;k.removeEventListener("dispose",O),V(k),k.isVideoTexture&&g.delete(k)}function J(z){const k=z.target;k.removeEventListener("dispose",J),Y(k)}function V(z){const k=i.get(z);if(k.__webglInit===void 0)return;const he=z.source,Re=v.get(he);if(Re){const Pe=Re[k.__cacheKey];Pe.usedTimes--,Pe.usedTimes===0&&H(z),Object.keys(Re).length===0&&v.delete(he)}i.remove(z)}function H(z){const k=i.get(z);n.deleteTexture(k.__webglTexture);const he=z.source,Re=v.get(he);delete Re[k.__cacheKey],o.memory.textures--}function Y(z){const k=z.texture,he=i.get(z),Re=i.get(k);if(Re.__webglTexture!==void 0&&(n.deleteTexture(Re.__webglTexture),o.memory.textures--),z.depthTexture&&z.depthTexture.dispose(),z.isWebGLCubeRenderTarget)for(let Pe=0;Pe<6;Pe++)n.deleteFramebuffer(he.__webglFramebuffer[Pe]),he.__webglDepthbuffer&&n.deleteRenderbuffer(he.__webglDepthbuffer[Pe]);else{if(n.deleteFramebuffer(he.__webglFramebuffer),he.__webglDepthbuffer&&n.deleteRenderbuffer(he.__webglDepthbuffer),he.__webglMultisampledFramebuffer&&n.deleteFramebuffer(he.__webglMultisampledFramebuffer),he.__webglColorRenderbuffer)for(let Pe=0;Pe<he.__webglColorRenderbuffer.length;Pe++)he.__webglColorRenderbuffer[Pe]&&n.deleteRenderbuffer(he.__webglColorRenderbuffer[Pe]);he.__webglDepthRenderbuffer&&n.deleteRenderbuffer(he.__webglDepthRenderbuffer)}if(z.isWebGLMultipleRenderTargets)for(let Pe=0,Fe=k.length;Pe<Fe;Pe++){const X=i.get(k[Pe]);X.__webglTexture&&(n.deleteTexture(X.__webglTexture),o.memory.textures--),i.remove(k[Pe])}i.remove(k),i.remove(z)}let N=0;function L(){N=0}function G(){const z=N;return z>=l&&console.warn("THREE.WebGLTextures: Trying to use "+z+" texture units while this GPU supports only "+l),N+=1,z}function ee(z){const k=[];return k.push(z.wrapS),k.push(z.wrapT),k.push(z.wrapR||0),k.push(z.magFilter),k.push(z.minFilter),k.push(z.anisotropy),k.push(z.internalFormat),k.push(z.format),k.push(z.type),k.push(z.generateMipmaps),k.push(z.premultiplyAlpha),k.push(z.flipY),k.push(z.unpackAlignment),k.push(z.colorSpace),k.join()}function $(z,k){const he=i.get(z);if(z.isVideoTexture&&wt(z),z.isRenderTargetTexture===!1&&z.version>0&&he.__version!==z.version){const Re=z.image;if(Re===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(Re.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{lt(he,z,k);return}}t.bindTexture(n.TEXTURE_2D,he.__webglTexture,n.TEXTURE0+k)}function j(z,k){const he=i.get(z);if(z.version>0&&he.__version!==z.version){lt(he,z,k);return}t.bindTexture(n.TEXTURE_2D_ARRAY,he.__webglTexture,n.TEXTURE0+k)}function ie(z,k){const he=i.get(z);if(z.version>0&&he.__version!==z.version){lt(he,z,k);return}t.bindTexture(n.TEXTURE_3D,he.__webglTexture,n.TEXTURE0+k)}function Ae(z,k){const he=i.get(z);if(z.version>0&&he.__version!==z.version){xt(he,z,k);return}t.bindTexture(n.TEXTURE_CUBE_MAP,he.__webglTexture,n.TEXTURE0+k)}const ge={[vo]:n.REPEAT,[Wn]:n.CLAMP_TO_EDGE,[wu]:n.MIRRORED_REPEAT},Ce={[Ft]:n.NEAREST,[Pf]:n.NEAREST_MIPMAP_NEAREST,[fu]:n.NEAREST_MIPMAP_LINEAR,[Dt]:n.LINEAR,[Jm]:n.LINEAR_MIPMAP_NEAREST,[yo]:n.LINEAR_MIPMAP_LINEAR},Ee={[Ak]:n.NEVER,[Sk]:n.ALWAYS,[vk]:n.LESS,[bk]:n.LEQUAL,[yk]:n.EQUAL,[wk]:n.GEQUAL,[_k]:n.GREATER,[xk]:n.NOTEQUAL};function Ne(z,k,he){if(he?(n.texParameteri(z,n.TEXTURE_WRAP_S,ge[k.wrapS]),n.texParameteri(z,n.TEXTURE_WRAP_T,ge[k.wrapT]),(z===n.TEXTURE_3D||z===n.TEXTURE_2D_ARRAY)&&n.texParameteri(z,n.TEXTURE_WRAP_R,ge[k.wrapR]),n.texParameteri(z,n.TEXTURE_MAG_FILTER,Ce[k.magFilter]),n.texParameteri(z,n.TEXTURE_MIN_FILTER,Ce[k.minFilter])):(n.texParameteri(z,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(z,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),(z===n.TEXTURE_3D||z===n.TEXTURE_2D_ARRAY)&&n.texParameteri(z,n.TEXTURE_WRAP_R,n.CLAMP_TO_EDGE),(k.wrapS!==Wn||k.wrapT!==Wn)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),n.texParameteri(z,n.TEXTURE_MAG_FILTER,T(k.magFilter)),n.texParameteri(z,n.TEXTURE_MIN_FILTER,T(k.minFilter)),k.minFilter!==Ft&&k.minFilter!==Dt&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),k.compareFunction&&(n.texParameteri(z,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(z,n.TEXTURE_COMPARE_FUNC,Ee[k.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){const Re=e.get("EXT_texture_filter_anisotropic");if(k.magFilter===Ft||k.minFilter!==fu&&k.minFilter!==yo||k.type===sn&&e.has("OES_texture_float_linear")===!1||a===!1&&k.type===xn&&e.has("OES_texture_half_float_linear")===!1)return;(k.anisotropy>1||i.get(k).__currentAnisotropy)&&(n.texParameterf(z,Re.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(k.anisotropy,s.getMaxAnisotropy())),i.get(k).__currentAnisotropy=k.anisotropy)}}function Ve(z,k){let he=!1;z.__webglInit===void 0&&(z.__webglInit=!0,k.addEventListener("dispose",O));const Re=k.source;let Pe=v.get(Re);Pe===void 0&&(Pe={},v.set(Re,Pe));const Fe=ee(k);if(Fe!==z.__cacheKey){Pe[Fe]===void 0&&(Pe[Fe]={texture:n.createTexture(),usedTimes:0},o.memory.textures++,he=!0),Pe[Fe].usedTimes++;const X=Pe[z.__cacheKey];X!==void 0&&(Pe[z.__cacheKey].usedTimes--,X.usedTimes===0&&H(k)),z.__cacheKey=Fe,z.__webglTexture=Pe[Fe].texture}return he}function lt(z,k,he){let Re=n.TEXTURE_2D;(k.isDataArrayTexture||k.isCompressedArrayTexture)&&(Re=n.TEXTURE_2D_ARRAY),k.isData3DTexture&&(Re=n.TEXTURE_3D);const Pe=Ve(z,k),Fe=k.source;t.bindTexture(Re,z.__webglTexture,n.TEXTURE0+he);const X=i.get(Fe);if(Fe.version!==X.__version||Pe===!0){t.activeTexture(n.TEXTURE0+he),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,k.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,k.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,k.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,n.NONE);const de=E(k)&&_(k.image)===!1;let le=y(k.image,de,!1,u);le=Qt(k,le);const Qe=_(le)||a,je=r.convert(k.format,k.colorSpace);let Ge=r.convert(k.type),Oe=R(k.internalFormat,je,Ge,k.colorSpace);Ne(Re,k,Qe);let it;const gt=k.mipmaps,yt=a&&k.isVideoTexture!==!0,Z=X.__version===void 0||Pe===!0,ue=C(k,le,Qe);if(k.isDepthTexture)Oe=n.DEPTH_COMPONENT,a?k.type===sn?Oe=n.DEPTH_COMPONENT32F:k.type===Pa?Oe=n.DEPTH_COMPONENT24:k.type===Dl?Oe=n.DEPTH24_STENCIL8:Oe=n.DEPTH_COMPONENT16:k.type===sn&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),k.format===Fc&&Oe===n.DEPTH_COMPONENT&&k.type!==vb&&k.type!==Pa&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),k.type=Pa,Ge=r.convert(k.type)),k.format===Yc&&Oe===n.DEPTH_COMPONENT&&(Oe=n.DEPTH_STENCIL,k.type!==Dl&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),k.type=Dl,Ge=r.convert(k.type))),Z&&(yt?t.texStorage2D(n.TEXTURE_2D,1,Oe,le.width,le.height):t.texImage2D(n.TEXTURE_2D,0,Oe,le.width,le.height,0,je,Ge,null));else if(k.isDataTexture)if(gt.length>0&&Qe){yt&&Z&&t.texStorage2D(n.TEXTURE_2D,ue,Oe,gt[0].width,gt[0].height);for(let fe=0,He=gt.length;fe<He;fe++)it=gt[fe],yt?t.texSubImage2D(n.TEXTURE_2D,fe,0,0,it.width,it.height,je,Ge,it.data):t.texImage2D(n.TEXTURE_2D,fe,Oe,it.width,it.height,0,je,Ge,it.data);k.generateMipmaps=!1}else yt?(Z&&t.texStorage2D(n.TEXTURE_2D,ue,Oe,le.width,le.height),t.texSubImage2D(n.TEXTURE_2D,0,0,0,le.width,le.height,je,Ge,le.data)):t.texImage2D(n.TEXTURE_2D,0,Oe,le.width,le.height,0,je,Ge,le.data);else if(k.isCompressedTexture)if(k.isCompressedArrayTexture){yt&&Z&&t.texStorage3D(n.TEXTURE_2D_ARRAY,ue,Oe,gt[0].width,gt[0].height,le.depth);for(let fe=0,He=gt.length;fe<He;fe++)it=gt[fe],k.format!==Ti?je!==null?yt?t.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,fe,0,0,0,it.width,it.height,le.depth,je,it.data,0,0):t.compressedTexImage3D(n.TEXTURE_2D_ARRAY,fe,Oe,it.width,it.height,le.depth,0,it.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):yt?t.texSubImage3D(n.TEXTURE_2D_ARRAY,fe,0,0,0,it.width,it.height,le.depth,je,Ge,it.data):t.texImage3D(n.TEXTURE_2D_ARRAY,fe,Oe,it.width,it.height,le.depth,0,je,Ge,it.data)}else{yt&&Z&&t.texStorage2D(n.TEXTURE_2D,ue,Oe,gt[0].width,gt[0].height);for(let fe=0,He=gt.length;fe<He;fe++)it=gt[fe],k.format!==Ti?je!==null?yt?t.compressedTexSubImage2D(n.TEXTURE_2D,fe,0,0,it.width,it.height,je,it.data):t.compressedTexImage2D(n.TEXTURE_2D,fe,Oe,it.width,it.height,0,it.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):yt?t.texSubImage2D(n.TEXTURE_2D,fe,0,0,it.width,it.height,je,Ge,it.data):t.texImage2D(n.TEXTURE_2D,fe,Oe,it.width,it.height,0,je,Ge,it.data)}else if(k.isDataArrayTexture)yt?(Z&&t.texStorage3D(n.TEXTURE_2D_ARRAY,ue,Oe,le.width,le.height,le.depth),t.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,le.width,le.height,le.depth,je,Ge,le.data)):t.texImage3D(n.TEXTURE_2D_ARRAY,0,Oe,le.width,le.height,le.depth,0,je,Ge,le.data);else if(k.isData3DTexture)yt?(Z&&t.texStorage3D(n.TEXTURE_3D,ue,Oe,le.width,le.height,le.depth),t.texSubImage3D(n.TEXTURE_3D,0,0,0,0,le.width,le.height,le.depth,je,Ge,le.data)):t.texImage3D(n.TEXTURE_3D,0,Oe,le.width,le.height,le.depth,0,je,Ge,le.data);else if(k.isFramebufferTexture){if(Z)if(yt)t.texStorage2D(n.TEXTURE_2D,ue,Oe,le.width,le.height);else{let fe=le.width,He=le.height;for(let Xe=0;Xe<ue;Xe++)t.texImage2D(n.TEXTURE_2D,Xe,Oe,fe,He,0,je,Ge,null),fe>>=1,He>>=1}}else if(gt.length>0&&Qe){yt&&Z&&t.texStorage2D(n.TEXTURE_2D,ue,Oe,gt[0].width,gt[0].height);for(let fe=0,He=gt.length;fe<He;fe++)it=gt[fe],yt?t.texSubImage2D(n.TEXTURE_2D,fe,0,0,je,Ge,it):t.texImage2D(n.TEXTURE_2D,fe,Oe,je,Ge,it);k.generateMipmaps=!1}else yt?(Z&&t.texStorage2D(n.TEXTURE_2D,ue,Oe,le.width,le.height),t.texSubImage2D(n.TEXTURE_2D,0,0,0,je,Ge,le)):t.texImage2D(n.TEXTURE_2D,0,Oe,je,Ge,le);M(k,Qe)&&I(Re),X.__version=Fe.version,k.onUpdate&&k.onUpdate(k)}z.__version=k.version}function xt(z,k,he){if(k.image.length!==6)return;const Re=Ve(z,k),Pe=k.source;t.bindTexture(n.TEXTURE_CUBE_MAP,z.__webglTexture,n.TEXTURE0+he);const Fe=i.get(Pe);if(Pe.version!==Fe.__version||Re===!0){t.activeTexture(n.TEXTURE0+he),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,k.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,k.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,k.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,n.NONE);const X=k.isCompressedTexture||k.image[0].isCompressedTexture,de=k.image[0]&&k.image[0].isDataTexture,le=[];for(let fe=0;fe<6;fe++)!X&&!de?le[fe]=y(k.image[fe],!1,!0,c):le[fe]=de?k.image[fe].image:k.image[fe],le[fe]=Qt(k,le[fe]);const Qe=le[0],je=_(Qe)||a,Ge=r.convert(k.format,k.colorSpace),Oe=r.convert(k.type),it=R(k.internalFormat,Ge,Oe,k.colorSpace),gt=a&&k.isVideoTexture!==!0,yt=Fe.__version===void 0||Re===!0;let Z=C(k,Qe,je);Ne(n.TEXTURE_CUBE_MAP,k,je);let ue;if(X){gt&&yt&&t.texStorage2D(n.TEXTURE_CUBE_MAP,Z,it,Qe.width,Qe.height);for(let fe=0;fe<6;fe++){ue=le[fe].mipmaps;for(let He=0;He<ue.length;He++){const Xe=ue[He];k.format!==Ti?Ge!==null?gt?t.compressedTexSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+fe,He,0,0,Xe.width,Xe.height,Ge,Xe.data):t.compressedTexImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+fe,He,it,Xe.width,Xe.height,0,Xe.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):gt?t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+fe,He,0,0,Xe.width,Xe.height,Ge,Oe,Xe.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+fe,He,it,Xe.width,Xe.height,0,Ge,Oe,Xe.data)}}}else{ue=k.mipmaps,gt&&yt&&(ue.length>0&&Z++,t.texStorage2D(n.TEXTURE_CUBE_MAP,Z,it,le[0].width,le[0].height));for(let fe=0;fe<6;fe++)if(de){gt?t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+fe,0,0,0,le[fe].width,le[fe].height,Ge,Oe,le[fe].data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+fe,0,it,le[fe].width,le[fe].height,0,Ge,Oe,le[fe].data);for(let He=0;He<ue.length;He++){const Zt=ue[He].image[fe].image;gt?t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+fe,He+1,0,0,Zt.width,Zt.height,Ge,Oe,Zt.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+fe,He+1,it,Zt.width,Zt.height,0,Ge,Oe,Zt.data)}}else{gt?t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+fe,0,0,0,Ge,Oe,le[fe]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+fe,0,it,Ge,Oe,le[fe]);for(let He=0;He<ue.length;He++){const Xe=ue[He];gt?t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+fe,He+1,0,0,Ge,Oe,Xe.image[fe]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+fe,He+1,it,Ge,Oe,Xe.image[fe])}}}M(k,je)&&I(n.TEXTURE_CUBE_MAP),Fe.__version=Pe.version,k.onUpdate&&k.onUpdate(k)}z.__version=k.version}function et(z,k,he,Re,Pe){const Fe=r.convert(he.format,he.colorSpace),X=r.convert(he.type),de=R(he.internalFormat,Fe,X,he.colorSpace);i.get(k).__hasExternalTextures||(Pe===n.TEXTURE_3D||Pe===n.TEXTURE_2D_ARRAY?t.texImage3D(Pe,0,de,k.width,k.height,k.depth,0,Fe,X,null):t.texImage2D(Pe,0,de,k.width,k.height,0,Fe,X,null)),t.bindFramebuffer(n.FRAMEBUFFER,z),pt(k)?f.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,Re,Pe,i.get(he).__webglTexture,0,qe(k)):(Pe===n.TEXTURE_2D||Pe>=n.TEXTURE_CUBE_MAP_POSITIVE_X&&Pe<=n.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&n.framebufferTexture2D(n.FRAMEBUFFER,Re,Pe,i.get(he).__webglTexture,0),t.bindFramebuffer(n.FRAMEBUFFER,null)}function W(z,k,he){if(n.bindRenderbuffer(n.RENDERBUFFER,z),k.depthBuffer&&!k.stencilBuffer){let Re=n.DEPTH_COMPONENT16;if(he||pt(k)){const Pe=k.depthTexture;Pe&&Pe.isDepthTexture&&(Pe.type===sn?Re=n.DEPTH_COMPONENT32F:Pe.type===Pa&&(Re=n.DEPTH_COMPONENT24));const Fe=qe(k);pt(k)?f.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,Fe,Re,k.width,k.height):n.renderbufferStorageMultisample(n.RENDERBUFFER,Fe,Re,k.width,k.height)}else n.renderbufferStorage(n.RENDERBUFFER,Re,k.width,k.height);n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,z)}else if(k.depthBuffer&&k.stencilBuffer){const Re=qe(k);he&&pt(k)===!1?n.renderbufferStorageMultisample(n.RENDERBUFFER,Re,n.DEPTH24_STENCIL8,k.width,k.height):pt(k)?f.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,Re,n.DEPTH24_STENCIL8,k.width,k.height):n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_STENCIL,k.width,k.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,z)}else{const Re=k.isWebGLMultipleRenderTargets===!0?k.texture:[k.texture];for(let Pe=0;Pe<Re.length;Pe++){const Fe=Re[Pe],X=r.convert(Fe.format,Fe.colorSpace),de=r.convert(Fe.type),le=R(Fe.internalFormat,X,de,Fe.colorSpace),Qe=qe(k);he&&pt(k)===!1?n.renderbufferStorageMultisample(n.RENDERBUFFER,Qe,le,k.width,k.height):pt(k)?f.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,Qe,le,k.width,k.height):n.renderbufferStorage(n.RENDERBUFFER,le,k.width,k.height)}}n.bindRenderbuffer(n.RENDERBUFFER,null)}function Le(z,k){if(k&&k.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(n.FRAMEBUFFER,z),!(k.depthTexture&&k.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!i.get(k.depthTexture).__webglTexture||k.depthTexture.image.width!==k.width||k.depthTexture.image.height!==k.height)&&(k.depthTexture.image.width=k.width,k.depthTexture.image.height=k.height,k.depthTexture.needsUpdate=!0),$(k.depthTexture,0);const Re=i.get(k.depthTexture).__webglTexture,Pe=qe(k);if(k.depthTexture.format===Fc)pt(k)?f.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,Re,0,Pe):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,Re,0);else if(k.depthTexture.format===Yc)pt(k)?f.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,Re,0,Pe):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,Re,0);else throw new Error("Unknown depthTexture format")}function me(z){const k=i.get(z),he=z.isWebGLCubeRenderTarget===!0;if(z.depthTexture&&!k.__autoAllocateDepthBuffer){if(he)throw new Error("target.depthTexture not supported in Cube render targets");Le(k.__webglFramebuffer,z)}else if(he){k.__webglDepthbuffer=[];for(let Re=0;Re<6;Re++)t.bindFramebuffer(n.FRAMEBUFFER,k.__webglFramebuffer[Re]),k.__webglDepthbuffer[Re]=n.createRenderbuffer(),W(k.__webglDepthbuffer[Re],z,!1)}else t.bindFramebuffer(n.FRAMEBUFFER,k.__webglFramebuffer),k.__webglDepthbuffer=n.createRenderbuffer(),W(k.__webglDepthbuffer,z,!1);t.bindFramebuffer(n.FRAMEBUFFER,null)}function ke(z,k,he){const Re=i.get(z);k!==void 0&&et(Re.__webglFramebuffer,z,z.texture,n.COLOR_ATTACHMENT0,n.TEXTURE_2D),he!==void 0&&me(z)}function we(z){const k=z.texture,he=i.get(z),Re=i.get(k);z.addEventListener("dispose",J),z.isWebGLMultipleRenderTargets!==!0&&(Re.__webglTexture===void 0&&(Re.__webglTexture=n.createTexture()),Re.__version=k.version,o.memory.textures++);const Pe=z.isWebGLCubeRenderTarget===!0,Fe=z.isWebGLMultipleRenderTargets===!0,X=_(z)||a;if(Pe){he.__webglFramebuffer=[];for(let de=0;de<6;de++)he.__webglFramebuffer[de]=n.createFramebuffer()}else{if(he.__webglFramebuffer=n.createFramebuffer(),Fe)if(s.drawBuffers){const de=z.texture;for(let le=0,Qe=de.length;le<Qe;le++){const je=i.get(de[le]);je.__webglTexture===void 0&&(je.__webglTexture=n.createTexture(),o.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(a&&z.samples>0&&pt(z)===!1){const de=Fe?k:[k];he.__webglMultisampledFramebuffer=n.createFramebuffer(),he.__webglColorRenderbuffer=[],t.bindFramebuffer(n.FRAMEBUFFER,he.__webglMultisampledFramebuffer);for(let le=0;le<de.length;le++){const Qe=de[le];he.__webglColorRenderbuffer[le]=n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,he.__webglColorRenderbuffer[le]);const je=r.convert(Qe.format,Qe.colorSpace),Ge=r.convert(Qe.type),Oe=R(Qe.internalFormat,je,Ge,Qe.colorSpace,z.isXRRenderTarget===!0),it=qe(z);n.renderbufferStorageMultisample(n.RENDERBUFFER,it,Oe,z.width,z.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+le,n.RENDERBUFFER,he.__webglColorRenderbuffer[le])}n.bindRenderbuffer(n.RENDERBUFFER,null),z.depthBuffer&&(he.__webglDepthRenderbuffer=n.createRenderbuffer(),W(he.__webglDepthRenderbuffer,z,!0)),t.bindFramebuffer(n.FRAMEBUFFER,null)}}if(Pe){t.bindTexture(n.TEXTURE_CUBE_MAP,Re.__webglTexture),Ne(n.TEXTURE_CUBE_MAP,k,X);for(let de=0;de<6;de++)et(he.__webglFramebuffer[de],z,k,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+de);M(k,X)&&I(n.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(Fe){const de=z.texture;for(let le=0,Qe=de.length;le<Qe;le++){const je=de[le],Ge=i.get(je);t.bindTexture(n.TEXTURE_2D,Ge.__webglTexture),Ne(n.TEXTURE_2D,je,X),et(he.__webglFramebuffer,z,je,n.COLOR_ATTACHMENT0+le,n.TEXTURE_2D),M(je,X)&&I(n.TEXTURE_2D)}t.unbindTexture()}else{let de=n.TEXTURE_2D;(z.isWebGL3DRenderTarget||z.isWebGLArrayRenderTarget)&&(a?de=z.isWebGL3DRenderTarget?n.TEXTURE_3D:n.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),t.bindTexture(de,Re.__webglTexture),Ne(de,k,X),et(he.__webglFramebuffer,z,k,n.COLOR_ATTACHMENT0,de),M(k,X)&&I(de),t.unbindTexture()}z.depthBuffer&&me(z)}function Ze(z){const k=_(z)||a,he=z.isWebGLMultipleRenderTargets===!0?z.texture:[z.texture];for(let Re=0,Pe=he.length;Re<Pe;Re++){const Fe=he[Re];if(M(Fe,k)){const X=z.isWebGLCubeRenderTarget?n.TEXTURE_CUBE_MAP:n.TEXTURE_2D,de=i.get(Fe).__webglTexture;t.bindTexture(X,de),I(X),t.unbindTexture()}}}function We(z){if(a&&z.samples>0&&pt(z)===!1){const k=z.isWebGLMultipleRenderTargets?z.texture:[z.texture],he=z.width,Re=z.height;let Pe=n.COLOR_BUFFER_BIT;const Fe=[],X=z.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,de=i.get(z),le=z.isWebGLMultipleRenderTargets===!0;if(le)for(let Qe=0;Qe<k.length;Qe++)t.bindFramebuffer(n.FRAMEBUFFER,de.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+Qe,n.RENDERBUFFER,null),t.bindFramebuffer(n.FRAMEBUFFER,de.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+Qe,n.TEXTURE_2D,null,0);t.bindFramebuffer(n.READ_FRAMEBUFFER,de.__webglMultisampledFramebuffer),t.bindFramebuffer(n.DRAW_FRAMEBUFFER,de.__webglFramebuffer);for(let Qe=0;Qe<k.length;Qe++){Fe.push(n.COLOR_ATTACHMENT0+Qe),z.depthBuffer&&Fe.push(X);const je=de.__ignoreDepthValues!==void 0?de.__ignoreDepthValues:!1;if(je===!1&&(z.depthBuffer&&(Pe|=n.DEPTH_BUFFER_BIT),z.stencilBuffer&&(Pe|=n.STENCIL_BUFFER_BIT)),le&&n.framebufferRenderbuffer(n.READ_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,de.__webglColorRenderbuffer[Qe]),je===!0&&(n.invalidateFramebuffer(n.READ_FRAMEBUFFER,[X]),n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,[X])),le){const Ge=i.get(k[Qe]).__webglTexture;n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,Ge,0)}n.blitFramebuffer(0,0,he,Re,0,0,he,Re,Pe,n.NEAREST),p&&n.invalidateFramebuffer(n.READ_FRAMEBUFFER,Fe)}if(t.bindFramebuffer(n.READ_FRAMEBUFFER,null),t.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),le)for(let Qe=0;Qe<k.length;Qe++){t.bindFramebuffer(n.FRAMEBUFFER,de.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+Qe,n.RENDERBUFFER,de.__webglColorRenderbuffer[Qe]);const je=i.get(k[Qe]).__webglTexture;t.bindFramebuffer(n.FRAMEBUFFER,de.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+Qe,n.TEXTURE_2D,je,0)}t.bindFramebuffer(n.DRAW_FRAMEBUFFER,de.__webglMultisampledFramebuffer)}}function qe(z){return Math.min(d,z.samples)}function pt(z){const k=i.get(z);return a&&z.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&k.__useRenderToTexture!==!1}function wt(z){const k=o.render.frame;g.get(z)!==k&&(g.set(z,k),z.update())}function Qt(z,k){const he=z.colorSpace,Re=z.format,Pe=z.type;return z.isCompressedTexture===!0||z.format===s0||he!==gn&&he!==ur&&(he===Je?a===!1?e.has("EXT_sRGB")===!0&&Re===Ti?(z.format=s0,z.minFilter=Dt,z.generateMipmaps=!1):k=tM.sRGBToLinear(k):(Re!==Ti||Pe!==fi)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",he)),k}this.allocateTextureUnit=G,this.resetTextureUnits=L,this.setTexture2D=$,this.setTexture2DArray=j,this.setTexture3D=ie,this.setTextureCube=Ae,this.rebindTextures=ke,this.setupRenderTarget=we,this.updateRenderTargetMipmap=Ze,this.updateMultisampleRenderTarget=We,this.setupDepthRenderbuffer=me,this.setupFrameBufferTexture=et,this.useMultisampledRTT=pt}function kk(n,e,t){const i=t.isWebGL2;function s(r,o=ur){let a;if(r===fi)return n.UNSIGNED_BYTE;if(r===HE)return n.UNSIGNED_SHORT_4_4_4_4;if(r===QE)return n.UNSIGNED_SHORT_5_5_5_1;if(r===JO)return n.BYTE;if(r===KO)return n.SHORT;if(r===vb)return n.UNSIGNED_SHORT;if(r===VE)return n.INT;if(r===Pa)return n.UNSIGNED_INT;if(r===sn)return n.FLOAT;if(r===xn)return i?n.HALF_FLOAT:(a=e.get("OES_texture_half_float"),a!==null?a.HALF_FLOAT_OES:null);if(r===ZO)return n.ALPHA;if(r===Ti)return n.RGBA;if(r===yb)return n.LUMINANCE;if(r===$O)return n.LUMINANCE_ALPHA;if(r===Fc)return n.DEPTH_COMPONENT;if(r===Yc)return n.DEPTH_STENCIL;if(r===s0)return a=e.get("EXT_sRGB"),a!==null?a.SRGB_ALPHA_EXT:null;if(r===wl)return n.RED;if(r===WE)return n.RED_INTEGER;if(r===iu)return n.RG;if(r===jE)return n.RG_INTEGER;if(r===qE)return n.RGBA_INTEGER;if(r===_g||r===_y||r===xy||r===xg)if(o===Je)if(a=e.get("WEBGL_compressed_texture_s3tc_srgb"),a!==null){if(r===_g)return a.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(r===_y)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(r===xy)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(r===xg)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(a=e.get("WEBGL_compressed_texture_s3tc"),a!==null){if(r===_g)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(r===_y)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(r===xy)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(r===xg)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(r===Ky||r===DS||r===Zy||r===OS)if(a=e.get("WEBGL_compressed_texture_pvrtc"),a!==null){if(r===Ky)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(r===DS)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(r===Zy)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(r===OS)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(r===XE)return a=e.get("WEBGL_compressed_texture_etc1"),a!==null?a.COMPRESSED_RGB_ETC1_WEBGL:null;if(r===$y||r===e0)if(a=e.get("WEBGL_compressed_texture_etc"),a!==null){if(r===$y)return o===Je?a.COMPRESSED_SRGB8_ETC2:a.COMPRESSED_RGB8_ETC2;if(r===e0)return o===Je?a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:a.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(r===t0||r===kS||r===LS||r===FS||r===US||r===NS||r===zS||r===GS||r===VS||r===HS||r===QS||r===WS||r===jS||r===qS)if(a=e.get("WEBGL_compressed_texture_astc"),a!==null){if(r===t0)return o===Je?a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:a.COMPRESSED_RGBA_ASTC_4x4_KHR;if(r===kS)return o===Je?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:a.COMPRESSED_RGBA_ASTC_5x4_KHR;if(r===LS)return o===Je?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:a.COMPRESSED_RGBA_ASTC_5x5_KHR;if(r===FS)return o===Je?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:a.COMPRESSED_RGBA_ASTC_6x5_KHR;if(r===US)return o===Je?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:a.COMPRESSED_RGBA_ASTC_6x6_KHR;if(r===NS)return o===Je?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:a.COMPRESSED_RGBA_ASTC_8x5_KHR;if(r===zS)return o===Je?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:a.COMPRESSED_RGBA_ASTC_8x6_KHR;if(r===GS)return o===Je?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:a.COMPRESSED_RGBA_ASTC_8x8_KHR;if(r===VS)return o===Je?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:a.COMPRESSED_RGBA_ASTC_10x5_KHR;if(r===HS)return o===Je?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:a.COMPRESSED_RGBA_ASTC_10x6_KHR;if(r===QS)return o===Je?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:a.COMPRESSED_RGBA_ASTC_10x8_KHR;if(r===WS)return o===Je?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:a.COMPRESSED_RGBA_ASTC_10x10_KHR;if(r===jS)return o===Je?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:a.COMPRESSED_RGBA_ASTC_12x10_KHR;if(r===qS)return o===Je?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:a.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(r===wg)if(a=e.get("EXT_texture_compression_bptc"),a!==null){if(r===wg)return o===Je?a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:a.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(r===ek||r===XS||r===YS||r===JS)if(a=e.get("EXT_texture_compression_rgtc"),a!==null){if(r===wg)return a.COMPRESSED_RED_RGTC1_EXT;if(r===XS)return a.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(r===YS)return a.COMPRESSED_RED_GREEN_RGTC2_EXT;if(r===JS)return a.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return r===Dl?i?n.UNSIGNED_INT_24_8:(a=e.get("WEBGL_depth_texture"),a!==null?a.UNSIGNED_INT_24_8_WEBGL:null):n[r]!==void 0?n[r]:null}return{convert:s}}class Lk extends qt{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class ar extends Me{constructor(){super(),this.isGroup=!0,this.type="Group"}}const x4={type:"move"};let zx=class{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new ar,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new ar,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new w,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new w),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new ar,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new w,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new w),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const i of e.hand.values())this._getHandJoint(t,i)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,i){let s=null,r=null,o=null;const a=this._targetRay,l=this._grip,c=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(c&&e.hand){o=!0;for(const A of e.hand.values()){const v=t.getJointPose(A,i),m=this._getHandJoint(c,A);v!==null&&(m.matrix.fromArray(v.transform.matrix),m.matrix.decompose(m.position,m.rotation,m.scale),m.matrixWorldNeedsUpdate=!0,m.jointRadius=v.radius),m.visible=v!==null}const u=c.joints["index-finger-tip"],d=c.joints["thumb-tip"],f=u.position.distanceTo(d.position),p=.02,g=.005;c.inputState.pinching&&f>p+g?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!c.inputState.pinching&&f<=p-g&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else l!==null&&e.gripSpace&&(r=t.getPose(e.gripSpace,i),r!==null&&(l.matrix.fromArray(r.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,r.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(r.linearVelocity)):l.hasLinearVelocity=!1,r.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(r.angularVelocity)):l.hasAngularVelocity=!1));a!==null&&(s=t.getPose(e.targetRaySpace,i),s===null&&r!==null&&(s=r),s!==null&&(a.matrix.fromArray(s.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,s.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(s.linearVelocity)):a.hasLinearVelocity=!1,s.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(s.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(x4)))}return a!==null&&(a.visible=s!==null),l!==null&&(l.visible=r!==null),c!==null&&(c.visible=o!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const i=new ar;i.matrixAutoUpdate=!1,i.visible=!1,e.joints[t.jointName]=i,e.add(i)}return e.joints[t.jointName]}};class Ib extends Rt{constructor(e,t,i,s,r,o,a,l,c,u){if(u=u!==void 0?u:Fc,u!==Fc&&u!==Yc)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&u===Fc&&(i=Pa),i===void 0&&u===Yc&&(i=Dl),super(null,s,r,o,a,l,u,i,c),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=a!==void 0?a:Ft,this.minFilter=l!==void 0?l:Ft,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}class w4 extends Fn{constructor(e,t){super();const i=this;let s=null,r=1,o=null,a="local-floor",l=1,c=null,u=null,d=null,f=null,p=null,g=null;const A=t.getContextAttributes();let v=null,m=null;const b=[],y=[],_=new qt;_.layers.enable(1),_.viewport=new Ke;const E=new qt;E.layers.enable(2),E.viewport=new Ke;const M=[_,E],I=new Lk;I.layers.enable(1),I.layers.enable(2);let R=null,C=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(j){let ie=b[j];return ie===void 0&&(ie=new zx,b[j]=ie),ie.getTargetRaySpace()},this.getControllerGrip=function(j){let ie=b[j];return ie===void 0&&(ie=new zx,b[j]=ie),ie.getGripSpace()},this.getHand=function(j){let ie=b[j];return ie===void 0&&(ie=new zx,b[j]=ie),ie.getHandSpace()};function T(j){const ie=y.indexOf(j.inputSource);if(ie===-1)return;const Ae=b[ie];Ae!==void 0&&(Ae.update(j.inputSource,j.frame,c||o),Ae.dispatchEvent({type:j.type,data:j.inputSource}))}function O(){s.removeEventListener("select",T),s.removeEventListener("selectstart",T),s.removeEventListener("selectend",T),s.removeEventListener("squeeze",T),s.removeEventListener("squeezestart",T),s.removeEventListener("squeezeend",T),s.removeEventListener("end",O),s.removeEventListener("inputsourceschange",J);for(let j=0;j<b.length;j++){const ie=y[j];ie!==null&&(y[j]=null,b[j].disconnect(ie))}R=null,C=null,e.setRenderTarget(v),p=null,f=null,d=null,s=null,m=null,$.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(j){r=j,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(j){a=j,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return c||o},this.setReferenceSpace=function(j){c=j},this.getBaseLayer=function(){return f!==null?f:p},this.getBinding=function(){return d},this.getFrame=function(){return g},this.getSession=function(){return s},this.setSession=async function(j){if(s=j,s!==null){if(v=e.getRenderTarget(),s.addEventListener("select",T),s.addEventListener("selectstart",T),s.addEventListener("selectend",T),s.addEventListener("squeeze",T),s.addEventListener("squeezestart",T),s.addEventListener("squeezeend",T),s.addEventListener("end",O),s.addEventListener("inputsourceschange",J),A.xrCompatible!==!0&&await t.makeXRCompatible(),s.renderState.layers===void 0||e.capabilities.isWebGL2===!1){const ie={antialias:s.renderState.layers===void 0?A.antialias:!0,alpha:!0,depth:A.depth,stencil:A.stencil,framebufferScaleFactor:r};p=new XRWebGLLayer(s,t,ie),s.updateRenderState({baseLayer:p}),m=new ni(p.framebufferWidth,p.framebufferHeight,{format:Ti,type:fi,colorSpace:e.outputColorSpace,stencilBuffer:A.stencil})}else{let ie=null,Ae=null,ge=null;A.depth&&(ge=A.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,ie=A.stencil?Yc:Fc,Ae=A.stencil?Dl:Pa);const Ce={colorFormat:t.RGBA8,depthFormat:ge,scaleFactor:r};d=new XRWebGLBinding(s,t),f=d.createProjectionLayer(Ce),s.updateRenderState({layers:[f]}),m=new ni(f.textureWidth,f.textureHeight,{format:Ti,type:fi,depthTexture:new Ib(f.textureWidth,f.textureHeight,Ae,void 0,void 0,void 0,void 0,void 0,void 0,ie),stencilBuffer:A.stencil,colorSpace:e.outputColorSpace,samples:A.antialias?4:0});const Ee=e.properties.get(m);Ee.__ignoreDepthValues=f.ignoreDepthValues}m.isXRRenderTarget=!0,this.setFoveation(l),c=null,o=await s.requestReferenceSpace(a),$.setContext(s),$.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(s!==null)return s.environmentBlendMode};function J(j){for(let ie=0;ie<j.removed.length;ie++){const Ae=j.removed[ie],ge=y.indexOf(Ae);ge>=0&&(y[ge]=null,b[ge].disconnect(Ae))}for(let ie=0;ie<j.added.length;ie++){const Ae=j.added[ie];let ge=y.indexOf(Ae);if(ge===-1){for(let Ee=0;Ee<b.length;Ee++)if(Ee>=y.length){y.push(Ae),ge=Ee;break}else if(y[Ee]===null){y[Ee]=Ae,ge=Ee;break}if(ge===-1)break}const Ce=b[ge];Ce&&Ce.connect(Ae)}}const V=new w,H=new w;function Y(j,ie,Ae){V.setFromMatrixPosition(ie.matrixWorld),H.setFromMatrixPosition(Ae.matrixWorld);const ge=V.distanceTo(H),Ce=ie.projectionMatrix.elements,Ee=Ae.projectionMatrix.elements,Ne=Ce[14]/(Ce[10]-1),Ve=Ce[14]/(Ce[10]+1),lt=(Ce[9]+1)/Ce[5],xt=(Ce[9]-1)/Ce[5],et=(Ce[8]-1)/Ce[0],W=(Ee[8]+1)/Ee[0],Le=Ne*et,me=Ne*W,ke=ge/(-et+W),we=ke*-et;ie.matrixWorld.decompose(j.position,j.quaternion,j.scale),j.translateX(we),j.translateZ(ke),j.matrixWorld.compose(j.position,j.quaternion,j.scale),j.matrixWorldInverse.copy(j.matrixWorld).invert();const Ze=Ne+ke,We=Ve+ke,qe=Le-we,pt=me+(ge-we),wt=lt*Ve/We*Ze,Qt=xt*Ve/We*Ze;j.projectionMatrix.makePerspective(qe,pt,wt,Qt,Ze,We),j.projectionMatrixInverse.copy(j.projectionMatrix).invert()}function N(j,ie){ie===null?j.matrixWorld.copy(j.matrix):j.matrixWorld.multiplyMatrices(ie.matrixWorld,j.matrix),j.matrixWorldInverse.copy(j.matrixWorld).invert()}this.updateCamera=function(j){if(s===null)return;I.near=E.near=_.near=j.near,I.far=E.far=_.far=j.far,(R!==I.near||C!==I.far)&&(s.updateRenderState({depthNear:I.near,depthFar:I.far}),R=I.near,C=I.far);const ie=j.parent,Ae=I.cameras;N(I,ie);for(let ge=0;ge<Ae.length;ge++)N(Ae[ge],ie);Ae.length===2?Y(I,_,E):I.projectionMatrix.copy(_.projectionMatrix),L(j,I,ie)};function L(j,ie,Ae){Ae===null?j.matrix.copy(ie.matrixWorld):(j.matrix.copy(Ae.matrixWorld),j.matrix.invert(),j.matrix.multiply(ie.matrixWorld)),j.matrix.decompose(j.position,j.quaternion,j.scale),j.updateMatrixWorld(!0);const ge=j.children;for(let Ce=0,Ee=ge.length;Ce<Ee;Ce++)ge[Ce].updateMatrixWorld(!0);j.projectionMatrix.copy(ie.projectionMatrix),j.projectionMatrixInverse.copy(ie.projectionMatrixInverse),j.isPerspectiveCamera&&(j.fov=Bf*2*Math.atan(1/j.projectionMatrix.elements[5]),j.zoom=1)}this.getCamera=function(){return I},this.getFoveation=function(){if(!(f===null&&p===null))return l},this.setFoveation=function(j){l=j,f!==null&&(f.fixedFoveation=j),p!==null&&p.fixedFoveation!==void 0&&(p.fixedFoveation=j)};let G=null;function ee(j,ie){if(u=ie.getViewerPose(c||o),g=ie,u!==null){const Ae=u.views;p!==null&&(e.setRenderTargetFramebuffer(m,p.framebuffer),e.setRenderTarget(m));let ge=!1;Ae.length!==I.cameras.length&&(I.cameras.length=0,ge=!0);for(let Ce=0;Ce<Ae.length;Ce++){const Ee=Ae[Ce];let Ne=null;if(p!==null)Ne=p.getViewport(Ee);else{const lt=d.getViewSubImage(f,Ee);Ne=lt.viewport,Ce===0&&(e.setRenderTargetTextures(m,lt.colorTexture,f.ignoreDepthValues?void 0:lt.depthStencilTexture),e.setRenderTarget(m))}let Ve=M[Ce];Ve===void 0&&(Ve=new qt,Ve.layers.enable(Ce),Ve.viewport=new Ke,M[Ce]=Ve),Ve.matrix.fromArray(Ee.transform.matrix),Ve.matrix.decompose(Ve.position,Ve.quaternion,Ve.scale),Ve.projectionMatrix.fromArray(Ee.projectionMatrix),Ve.projectionMatrixInverse.copy(Ve.projectionMatrix).invert(),Ve.viewport.set(Ne.x,Ne.y,Ne.width,Ne.height),Ce===0&&(I.matrix.copy(Ve.matrix),I.matrix.decompose(I.position,I.quaternion,I.scale)),ge===!0&&I.cameras.push(Ve)}}for(let Ae=0;Ae<b.length;Ae++){const ge=y[Ae],Ce=b[Ae];ge!==null&&Ce!==void 0&&Ce.update(ge,ie,c||o)}G&&G(j,ie),ie.detectedPlanes&&i.dispatchEvent({type:"planesdetected",data:ie}),g=null}const $=new Rk;$.setAnimationLoop(ee),this.setAnimationLoop=function(j){G=j},this.dispose=function(){}}}function S4(n,e){function t(v,m){v.matrixAutoUpdate===!0&&v.updateMatrix(),m.value.copy(v.matrix)}function i(v,m){m.color.getRGB(v.fogColor.value,Ik(n)),m.isFog?(v.fogNear.value=m.near,v.fogFar.value=m.far):m.isFogExp2&&(v.fogDensity.value=m.density)}function s(v,m,b,y,_){m.isMeshBasicMaterial||m.isMeshLambertMaterial?r(v,m):m.isMeshToonMaterial?(r(v,m),d(v,m)):m.isMeshPhongMaterial?(r(v,m),u(v,m)):m.isMeshStandardMaterial?(r(v,m),f(v,m),m.isMeshPhysicalMaterial&&p(v,m,_)):m.isMeshMatcapMaterial?(r(v,m),g(v,m)):m.isMeshDepthMaterial?r(v,m):m.isMeshDistanceMaterial?(r(v,m),A(v,m)):m.isMeshNormalMaterial?r(v,m):m.isLineBasicMaterial?(o(v,m),m.isLineDashedMaterial&&a(v,m)):m.isPointsMaterial?l(v,m,b,y):m.isSpriteMaterial?c(v,m):m.isShadowMaterial?(v.color.value.copy(m.color),v.opacity.value=m.opacity):m.isShaderMaterial&&(m.uniformsNeedUpdate=!1)}function r(v,m){v.opacity.value=m.opacity,m.color&&v.diffuse.value.copy(m.color),m.emissive&&v.emissive.value.copy(m.emissive).multiplyScalar(m.emissiveIntensity),m.map&&(v.map.value=m.map,t(m.map,v.mapTransform)),m.alphaMap&&(v.alphaMap.value=m.alphaMap,t(m.alphaMap,v.alphaMapTransform)),m.bumpMap&&(v.bumpMap.value=m.bumpMap,t(m.bumpMap,v.bumpMapTransform),v.bumpScale.value=m.bumpScale,m.side===fn&&(v.bumpScale.value*=-1)),m.normalMap&&(v.normalMap.value=m.normalMap,t(m.normalMap,v.normalMapTransform),v.normalScale.value.copy(m.normalScale),m.side===fn&&v.normalScale.value.negate()),m.displacementMap&&(v.displacementMap.value=m.displacementMap,t(m.displacementMap,v.displacementMapTransform),v.displacementScale.value=m.displacementScale,v.displacementBias.value=m.displacementBias),m.emissiveMap&&(v.emissiveMap.value=m.emissiveMap,t(m.emissiveMap,v.emissiveMapTransform)),m.specularMap&&(v.specularMap.value=m.specularMap,t(m.specularMap,v.specularMapTransform)),m.alphaTest>0&&(v.alphaTest.value=m.alphaTest);const b=e.get(m).envMap;if(b&&(v.envMap.value=b,v.flipEnvMap.value=b.isCubeTexture&&b.isRenderTargetTexture===!1?-1:1,v.reflectivity.value=m.reflectivity,v.ior.value=m.ior,v.refractionRatio.value=m.refractionRatio),m.lightMap){v.lightMap.value=m.lightMap;const y=n.useLegacyLights===!0?Math.PI:1;v.lightMapIntensity.value=m.lightMapIntensity*y,t(m.lightMap,v.lightMapTransform)}m.aoMap&&(v.aoMap.value=m.aoMap,v.aoMapIntensity.value=m.aoMapIntensity,t(m.aoMap,v.aoMapTransform))}function o(v,m){v.diffuse.value.copy(m.color),v.opacity.value=m.opacity,m.map&&(v.map.value=m.map,t(m.map,v.mapTransform))}function a(v,m){v.dashSize.value=m.dashSize,v.totalSize.value=m.dashSize+m.gapSize,v.scale.value=m.scale}function l(v,m,b,y){v.diffuse.value.copy(m.color),v.opacity.value=m.opacity,v.size.value=m.size*b,v.scale.value=y*.5,m.map&&(v.map.value=m.map,t(m.map,v.uvTransform)),m.alphaMap&&(v.alphaMap.value=m.alphaMap,t(m.alphaMap,v.alphaMapTransform)),m.alphaTest>0&&(v.alphaTest.value=m.alphaTest)}function c(v,m){v.diffuse.value.copy(m.color),v.opacity.value=m.opacity,v.rotation.value=m.rotation,m.map&&(v.map.value=m.map,t(m.map,v.mapTransform)),m.alphaMap&&(v.alphaMap.value=m.alphaMap,t(m.alphaMap,v.alphaMapTransform)),m.alphaTest>0&&(v.alphaTest.value=m.alphaTest)}function u(v,m){v.specular.value.copy(m.specular),v.shininess.value=Math.max(m.shininess,1e-4)}function d(v,m){m.gradientMap&&(v.gradientMap.value=m.gradientMap)}function f(v,m){v.metalness.value=m.metalness,m.metalnessMap&&(v.metalnessMap.value=m.metalnessMap,t(m.metalnessMap,v.metalnessMapTransform)),v.roughness.value=m.roughness,m.roughnessMap&&(v.roughnessMap.value=m.roughnessMap,t(m.roughnessMap,v.roughnessMapTransform)),e.get(m).envMap&&(v.envMapIntensity.value=m.envMapIntensity)}function p(v,m,b){v.ior.value=m.ior,m.sheen>0&&(v.sheenColor.value.copy(m.sheenColor).multiplyScalar(m.sheen),v.sheenRoughness.value=m.sheenRoughness,m.sheenColorMap&&(v.sheenColorMap.value=m.sheenColorMap,t(m.sheenColorMap,v.sheenColorMapTransform)),m.sheenRoughnessMap&&(v.sheenRoughnessMap.value=m.sheenRoughnessMap,t(m.sheenRoughnessMap,v.sheenRoughnessMapTransform))),m.clearcoat>0&&(v.clearcoat.value=m.clearcoat,v.clearcoatRoughness.value=m.clearcoatRoughness,m.clearcoatMap&&(v.clearcoatMap.value=m.clearcoatMap,t(m.clearcoatMap,v.clearcoatMapTransform)),m.clearcoatRoughnessMap&&(v.clearcoatRoughnessMap.value=m.clearcoatRoughnessMap,t(m.clearcoatRoughnessMap,v.clearcoatRoughnessMapTransform)),m.clearcoatNormalMap&&(v.clearcoatNormalMap.value=m.clearcoatNormalMap,t(m.clearcoatNormalMap,v.clearcoatNormalMapTransform),v.clearcoatNormalScale.value.copy(m.clearcoatNormalScale),m.side===fn&&v.clearcoatNormalScale.value.negate())),m.iridescence>0&&(v.iridescence.value=m.iridescence,v.iridescenceIOR.value=m.iridescenceIOR,v.iridescenceThicknessMinimum.value=m.iridescenceThicknessRange[0],v.iridescenceThicknessMaximum.value=m.iridescenceThicknessRange[1],m.iridescenceMap&&(v.iridescenceMap.value=m.iridescenceMap,t(m.iridescenceMap,v.iridescenceMapTransform)),m.iridescenceThicknessMap&&(v.iridescenceThicknessMap.value=m.iridescenceThicknessMap,t(m.iridescenceThicknessMap,v.iridescenceThicknessMapTransform))),m.transmission>0&&(v.transmission.value=m.transmission,v.transmissionSamplerMap.value=b.texture,v.transmissionSamplerSize.value.set(b.width,b.height),m.transmissionMap&&(v.transmissionMap.value=m.transmissionMap,t(m.transmissionMap,v.transmissionMapTransform)),v.thickness.value=m.thickness,m.thicknessMap&&(v.thicknessMap.value=m.thicknessMap,t(m.thicknessMap,v.thicknessMapTransform)),v.attenuationDistance.value=m.attenuationDistance,v.attenuationColor.value.copy(m.attenuationColor)),m.anisotropy>0&&(v.anisotropyVector.value.set(m.anisotropy*Math.cos(m.anisotropyRotation),m.anisotropy*Math.sin(m.anisotropyRotation)),m.anisotropyMap&&(v.anisotropyMap.value=m.anisotropyMap,t(m.anisotropyMap,v.anisotropyMapTransform))),v.specularIntensity.value=m.specularIntensity,v.specularColor.value.copy(m.specularColor),m.specularColorMap&&(v.specularColorMap.value=m.specularColorMap,t(m.specularColorMap,v.specularColorMapTransform)),m.specularIntensityMap&&(v.specularIntensityMap.value=m.specularIntensityMap,t(m.specularIntensityMap,v.specularIntensityMapTransform))}function g(v,m){m.matcap&&(v.matcap.value=m.matcap)}function A(v,m){const b=e.get(m).light;v.referencePosition.value.setFromMatrixPosition(b.matrixWorld),v.nearDistance.value=b.shadow.camera.near,v.farDistance.value=b.shadow.camera.far}return{refreshFogUniforms:i,refreshMaterialUniforms:s}}function C4(n,e,t,i){let s={},r={},o=[];const a=t.isWebGL2?n.getParameter(n.MAX_UNIFORM_BUFFER_BINDINGS):0;function l(b,y){const _=y.program;i.uniformBlockBinding(b,_)}function c(b,y){let _=s[b.id];_===void 0&&(g(b),_=u(b),s[b.id]=_,b.addEventListener("dispose",v));const E=y.program;i.updateUBOMapping(b,E);const M=e.render.frame;r[b.id]!==M&&(f(b),r[b.id]=M)}function u(b){const y=d();b.__bindingPointIndex=y;const _=n.createBuffer(),E=b.__size,M=b.usage;return n.bindBuffer(n.UNIFORM_BUFFER,_),n.bufferData(n.UNIFORM_BUFFER,E,M),n.bindBuffer(n.UNIFORM_BUFFER,null),n.bindBufferBase(n.UNIFORM_BUFFER,y,_),_}function d(){for(let b=0;b<a;b++)if(o.indexOf(b)===-1)return o.push(b),b;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function f(b){const y=s[b.id],_=b.uniforms,E=b.__cache;n.bindBuffer(n.UNIFORM_BUFFER,y);for(let M=0,I=_.length;M<I;M++){const R=_[M];if(p(R,M,E)===!0){const C=R.__offset,T=Array.isArray(R.value)?R.value:[R.value];let O=0;for(let J=0;J<T.length;J++){const V=T[J],H=A(V);typeof V=="number"?(R.__data[0]=V,n.bufferSubData(n.UNIFORM_BUFFER,C+O,R.__data)):V.isMatrix3?(R.__data[0]=V.elements[0],R.__data[1]=V.elements[1],R.__data[2]=V.elements[2],R.__data[3]=V.elements[0],R.__data[4]=V.elements[3],R.__data[5]=V.elements[4],R.__data[6]=V.elements[5],R.__data[7]=V.elements[0],R.__data[8]=V.elements[6],R.__data[9]=V.elements[7],R.__data[10]=V.elements[8],R.__data[11]=V.elements[0]):(V.toArray(R.__data,O),O+=H.storage/Float32Array.BYTES_PER_ELEMENT)}n.bufferSubData(n.UNIFORM_BUFFER,C,R.__data)}}n.bindBuffer(n.UNIFORM_BUFFER,null)}function p(b,y,_){const E=b.value;if(_[y]===void 0){if(typeof E=="number")_[y]=E;else{const M=Array.isArray(E)?E:[E],I=[];for(let R=0;R<M.length;R++)I.push(M[R].clone());_[y]=I}return!0}else if(typeof E=="number"){if(_[y]!==E)return _[y]=E,!0}else{const M=Array.isArray(_[y])?_[y]:[_[y]],I=Array.isArray(E)?E:[E];for(let R=0;R<M.length;R++){const C=M[R];if(C.equals(I[R])===!1)return C.copy(I[R]),!0}}return!1}function g(b){const y=b.uniforms;let _=0;const E=16;let M=0;for(let I=0,R=y.length;I<R;I++){const C=y[I],T={boundary:0,storage:0},O=Array.isArray(C.value)?C.value:[C.value];for(let J=0,V=O.length;J<V;J++){const H=O[J],Y=A(H);T.boundary+=Y.boundary,T.storage+=Y.storage}if(C.__data=new Float32Array(T.storage/Float32Array.BYTES_PER_ELEMENT),C.__offset=_,I>0){M=_%E;const J=E-M;M!==0&&J-T.boundary<0&&(_+=E-M,C.__offset=_)}_+=T.storage}return M=_%E,M>0&&(_+=E-M),b.__size=_,b.__cache={},this}function A(b){const y={boundary:0,storage:0};return typeof b=="number"?(y.boundary=4,y.storage=4):b.isVector2?(y.boundary=8,y.storage=8):b.isVector3||b.isColor?(y.boundary=16,y.storage=12):b.isVector4?(y.boundary=16,y.storage=16):b.isMatrix3?(y.boundary=48,y.storage=48):b.isMatrix4?(y.boundary=64,y.storage=64):b.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",b),y}function v(b){const y=b.target;y.removeEventListener("dispose",v);const _=o.indexOf(y.__bindingPointIndex);o.splice(_,1),n.deleteBuffer(s[y.id]),delete s[y.id],delete r[y.id]}function m(){for(const b in s)n.deleteBuffer(s[b]);o=[],s={},r={}}return{bind:l,update:c,dispose:m}}function E4(){const n=Am("canvas");return n.style.display="block",n}class oh{constructor(e={}){const{canvas:t=E4(),context:i=null,depth:s=!0,stencil:r=!0,alpha:o=!1,antialias:a=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:c=!1,powerPreference:u="default",failIfMajorPerformanceCaveat:d=!1}=e;this.isWebGLRenderer=!0;let f;i!==null?f=i.getContextAttributes().alpha:f=o;const p=new Uint32Array(4),g=new Int32Array(4);let A=null,v=null;const m=[],b=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputColorSpace=Je,this.useLegacyLights=!0,this.toneMapping=Qs,this.toneMappingExposure=1;const y=this;let _=!1,E=0,M=0,I=null,R=-1,C=null;const T=new Ke,O=new Ke;let J=null;const V=new _e(0);let H=0,Y=t.width,N=t.height,L=1,G=null,ee=null;const $=new Ke(0,0,Y,N),j=new Ke(0,0,Y,N);let ie=!1;const Ae=new Eb;let ge=!1,Ce=!1,Ee=null;const Ne=new Ie,Ve=new te,lt=new w,xt={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function et(){return I===null?L:1}let W=i;function Le(S,B){for(let F=0;F<S.length;F++){const U=S[F],Q=t.getContext(U,B);if(Q!==null)return Q}return null}try{const S={alpha:!0,depth:s,stencil:r,antialias:a,premultipliedAlpha:l,preserveDrawingBuffer:c,powerPreference:u,failIfMajorPerformanceCaveat:d};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${nh}`),t.addEventListener("webglcontextlost",ue,!1),t.addEventListener("webglcontextrestored",fe,!1),t.addEventListener("webglcontextcreationerror",He,!1),W===null){const B=["webgl2","webgl","experimental-webgl"];if(y.isWebGL1Renderer===!0&&B.shift(),W=Le(B,S),W===null)throw Le(B)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}typeof WebGLRenderingContext<"u"&&W instanceof WebGLRenderingContext&&console.warn("THREE.WebGLRenderer: WebGL 1 support was deprecated in r153 and will be removed in r163."),W.getShaderPrecisionFormat===void 0&&(W.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(S){throw console.error("THREE.WebGLRenderer: "+S.message),S}let me,ke,we,Ze,We,qe,pt,wt,Qt,z,k,he,Re,Pe,Fe,X,de,le,Qe,je,Ge,Oe,it,gt;function yt(){me=new GH(W),ke=new LH(W,me,e),me.init(ke),Oe=new kk(W,me,ke),we=new b4(W,me,ke),Ze=new QH(W),We=new l4,qe=new _4(W,me,we,We,ke,Oe,Ze),pt=new UH(y),wt=new zH(y),Qt=new tG(W,ke),it=new OH(W,me,Qt,ke),z=new VH(W,Qt,Ze,it),k=new XH(W,z,Qt,Ze),Qe=new qH(W,ke,qe),X=new FH(We),he=new a4(y,pt,wt,me,ke,it,X),Re=new S4(y,We),Pe=new h4,Fe=new m4(me,ke),le=new DH(y,pt,wt,we,k,f,l),de=new y4(y,k,ke),gt=new C4(W,Ze,ke,we),je=new kH(W,me,Ze,ke),Ge=new HH(W,me,Ze,ke),Ze.programs=he.programs,y.capabilities=ke,y.extensions=me,y.properties=We,y.renderLists=Pe,y.shadowMap=de,y.state=we,y.info=Ze}yt();const Z=new w4(y,W);this.xr=Z,this.getContext=function(){return W},this.getContextAttributes=function(){return W.getContextAttributes()},this.forceContextLoss=function(){const S=me.get("WEBGL_lose_context");S&&S.loseContext()},this.forceContextRestore=function(){const S=me.get("WEBGL_lose_context");S&&S.restoreContext()},this.getPixelRatio=function(){return L},this.setPixelRatio=function(S){S!==void 0&&(L=S,this.setSize(Y,N,!1))},this.getSize=function(S){return S.set(Y,N)},this.setSize=function(S,B,F=!0){if(Z.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}Y=S,N=B,t.width=Math.floor(S*L),t.height=Math.floor(B*L),F===!0&&(t.style.width=S+"px",t.style.height=B+"px"),this.setViewport(0,0,S,B)},this.getDrawingBufferSize=function(S){return S.set(Y*L,N*L).floor()},this.setDrawingBufferSize=function(S,B,F){Y=S,N=B,L=F,t.width=Math.floor(S*F),t.height=Math.floor(B*F),this.setViewport(0,0,S,B)},this.getCurrentViewport=function(S){return S.copy(T)},this.getViewport=function(S){return S.copy($)},this.setViewport=function(S,B,F,U){S.isVector4?$.set(S.x,S.y,S.z,S.w):$.set(S,B,F,U),we.viewport(T.copy($).multiplyScalar(L).floor())},this.getScissor=function(S){return S.copy(j)},this.setScissor=function(S,B,F,U){S.isVector4?j.set(S.x,S.y,S.z,S.w):j.set(S,B,F,U),we.scissor(O.copy(j).multiplyScalar(L).floor())},this.getScissorTest=function(){return ie},this.setScissorTest=function(S){we.setScissorTest(ie=S)},this.setOpaqueSort=function(S){G=S},this.setTransparentSort=function(S){ee=S},this.getClearColor=function(S){return S.copy(le.getClearColor())},this.setClearColor=function(){le.setClearColor.apply(le,arguments)},this.getClearAlpha=function(){return le.getClearAlpha()},this.setClearAlpha=function(){le.setClearAlpha.apply(le,arguments)},this.clear=function(S=!0,B=!0,F=!0){let U=0;if(S){let Q=!1;if(I!==null){const oe=I.texture.format;Q=oe===qE||oe===jE||oe===WE}if(Q){const oe=I.texture.type,pe=oe===fi||oe===Pa||oe===vb||oe===Dl||oe===HE||oe===QE,ve=le.getClearColor(),ce=le.getClearAlpha(),be=ve.r,Be=ve.g,De=ve.b;pe?(p[0]=be,p[1]=Be,p[2]=De,p[3]=ce,W.clearBufferuiv(W.COLOR,0,p)):(g[0]=be,g[1]=Be,g[2]=De,g[3]=ce,W.clearBufferiv(W.COLOR,0,g))}else U|=W.COLOR_BUFFER_BIT}B&&(U|=W.DEPTH_BUFFER_BIT),F&&(U|=W.STENCIL_BUFFER_BIT),W.clear(U)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",ue,!1),t.removeEventListener("webglcontextrestored",fe,!1),t.removeEventListener("webglcontextcreationerror",He,!1),Pe.dispose(),Fe.dispose(),We.dispose(),pt.dispose(),wt.dispose(),k.dispose(),it.dispose(),gt.dispose(),he.dispose(),Z.dispose(),Z.removeEventListener("sessionstart",ki),Z.removeEventListener("sessionend",Xr),Ee&&(Ee.dispose(),Ee=null),Jn.stop()};function ue(S){S.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),_=!0}function fe(){console.log("THREE.WebGLRenderer: Context Restored."),_=!1;const S=Ze.autoReset,B=de.enabled,F=de.autoUpdate,U=de.needsUpdate,Q=de.type;yt(),Ze.autoReset=S,de.enabled=B,de.autoUpdate=F,de.needsUpdate=U,de.type=Q}function He(S){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",S.statusMessage)}function Xe(S){const B=S.target;B.removeEventListener("dispose",Xe),Zt(B)}function Zt(S){Ii(S),We.remove(S)}function Ii(S){const B=We.get(S).programs;B!==void 0&&(B.forEach(function(F){he.releaseProgram(F)}),S.isShaderMaterial&&he.releaseShaderCache(S))}this.renderBufferDirect=function(S,B,F,U,Q,oe){B===null&&(B=xt);const pe=Q.isMesh&&Q.matrixWorld.determinant()<0,ve=VA(S,B,F,U,Q);we.setMaterial(U,pe);let ce=F.index,be=1;U.wireframe===!0&&(ce=z.getWireframeAttribute(F),be=2);const Be=F.drawRange,De=F.attributes.position;let Ye=Be.start*be,ht=(Be.start+Be.count)*be;oe!==null&&(Ye=Math.max(Ye,oe.start*be),ht=Math.min(ht,(oe.start+oe.count)*be)),ce!==null?(Ye=Math.max(Ye,0),ht=Math.min(ht,ce.count)):De!=null&&(Ye=Math.max(Ye,0),ht=Math.min(ht,De.count));const $e=ht-Ye;if($e<0||$e===1/0)return;it.setup(Q,U,ve,F,ce);let at,ut=je;if(ce!==null&&(at=Qt.get(ce),ut=Ge,ut.setIndex(at)),Q.isMesh)U.wireframe===!0?(we.setLineWidth(U.wireframeLinewidth*et()),ut.setMode(W.LINES)):ut.setMode(W.TRIANGLES);else if(Q.isLine){let dt=U.linewidth;dt===void 0&&(dt=1),we.setLineWidth(dt*et()),Q.isLineSegments?ut.setMode(W.LINES):Q.isLineLoop?ut.setMode(W.LINE_LOOP):ut.setMode(W.LINE_STRIP)}else Q.isPoints?ut.setMode(W.POINTS):Q.isSprite&&ut.setMode(W.TRIANGLES);if(Q.isInstancedMesh)ut.renderInstances(Ye,$e,Q.count);else if(F.isInstancedBufferGeometry){const dt=F._maxInstanceCount!==void 0?F._maxInstanceCount:1/0,Ri=Math.min(F.instanceCount,dt);ut.renderInstances(Ye,$e,Ri)}else ut.render(Ye,$e)},this.compile=function(S,B){function F(U,Q,oe){U.transparent===!0&&U.side===wi&&U.forceSinglePass===!1?(U.side=fn,U.needsUpdate=!0,ra(U,Q,oe),U.side=Es,U.needsUpdate=!0,ra(U,Q,oe),U.side=wi):ra(U,Q,oe)}v=Fe.get(S),v.init(),b.push(v),S.traverseVisible(function(U){U.isLight&&U.layers.test(B.layers)&&(v.pushLight(U),U.castShadow&&v.pushShadow(U))}),v.setupLights(y.useLegacyLights),S.traverse(function(U){const Q=U.material;if(Q)if(Array.isArray(Q))for(let oe=0;oe<Q.length;oe++){const pe=Q[oe];F(pe,S,U)}else F(Q,S,U)}),b.pop(),v=null};let mn=null;function qr(S){mn&&mn(S)}function ki(){Jn.stop()}function Xr(){Jn.start()}const Jn=new Rk;Jn.setAnimationLoop(qr),typeof self<"u"&&Jn.setContext(self),this.setAnimationLoop=function(S){mn=S,Z.setAnimationLoop(S),S===null?Jn.stop():Jn.start()},Z.addEventListener("sessionstart",ki),Z.addEventListener("sessionend",Xr),this.render=function(S,B){if(B!==void 0&&B.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(_===!0)return;S.matrixWorldAutoUpdate===!0&&S.updateMatrixWorld(),B.parent===null&&B.matrixWorldAutoUpdate===!0&&B.updateMatrixWorld(),Z.enabled===!0&&Z.isPresenting===!0&&(Z.cameraAutoUpdate===!0&&Z.updateCamera(B),B=Z.getCamera()),S.isScene===!0&&S.onBeforeRender(y,S,B,I),v=Fe.get(S,b.length),v.init(),b.push(v),Ne.multiplyMatrices(B.projectionMatrix,B.matrixWorldInverse),Ae.setFromProjectionMatrix(Ne),Ce=this.localClippingEnabled,ge=X.init(this.clippingPlanes,Ce),A=Pe.get(S,m.length),A.init(),m.push(A),zA(S,B,0,y.sortObjects),A.finish(),y.sortObjects===!0&&A.sort(G,ee),this.info.render.frame++,ge===!0&&X.beginShadows();const F=v.state.shadowsArray;if(de.render(F,S,B),ge===!0&&X.endShadows(),this.info.autoReset===!0&&this.info.reset(),le.render(A,S),v.setupLights(y.useLegacyLights),B.isArrayCamera){const U=B.cameras;for(let Q=0,oe=U.length;Q<oe;Q++){const pe=U[Q];GA(A,S,pe,pe.viewport)}}else GA(A,S,B);I!==null&&(qe.updateMultisampleRenderTarget(I),qe.updateRenderTargetMipmap(I)),S.isScene===!0&&S.onAfterRender(y,S,B),it.resetDefaultState(),R=-1,C=null,b.pop(),b.length>0?v=b[b.length-1]:v=null,m.pop(),m.length>0?A=m[m.length-1]:A=null};function zA(S,B,F,U){if(S.visible===!1)return;if(S.layers.test(B.layers)){if(S.isGroup)F=S.renderOrder;else if(S.isLOD)S.autoUpdate===!0&&S.update(B);else if(S.isLight)v.pushLight(S),S.castShadow&&v.pushShadow(S);else if(S.isSprite){if(!S.frustumCulled||Ae.intersectsSprite(S)){U&&lt.setFromMatrixPosition(S.matrixWorld).applyMatrix4(Ne);const pe=k.update(S),ve=S.material;ve.visible&&A.push(S,pe,ve,F,lt.z,null)}}else if((S.isMesh||S.isLine||S.isPoints)&&(!S.frustumCulled||Ae.intersectsObject(S))){const pe=k.update(S),ve=S.material;if(U&&(S.boundingSphere!==void 0?(S.boundingSphere===null&&S.computeBoundingSphere(),lt.copy(S.boundingSphere.center)):(pe.boundingSphere===null&&pe.computeBoundingSphere(),lt.copy(pe.boundingSphere.center)),lt.applyMatrix4(S.matrixWorld).applyMatrix4(Ne)),Array.isArray(ve)){const ce=pe.groups;for(let be=0,Be=ce.length;be<Be;be++){const De=ce[be],Ye=ve[De.materialIndex];Ye&&Ye.visible&&A.push(S,pe,Ye,F,lt.z,De)}}else ve.visible&&A.push(S,pe,ve,F,lt.z,null)}}const oe=S.children;for(let pe=0,ve=oe.length;pe<ve;pe++)zA(oe[pe],B,F,U)}function GA(S,B,F,U){const Q=S.opaque,oe=S.transmissive,pe=S.transparent;v.setupLightsView(F),ge===!0&&X.setGlobalState(y.clippingPlanes,F),oe.length>0&&ed(Q,oe,B,F),U&&we.viewport(T.copy(U)),Q.length>0&&td(Q,B,F),oe.length>0&&td(oe,B,F),pe.length>0&&td(pe,B,F),we.buffers.depth.setTest(!0),we.buffers.depth.setMask(!0),we.buffers.color.setMask(!0),we.setPolygonOffset(!1)}function ed(S,B,F,U){const Q=ke.isWebGL2;Ee===null&&(Ee=new ni(1,1,{generateMipmaps:!0,type:me.has("EXT_color_buffer_half_float")?xn:fi,minFilter:yo,samples:Q?4:0})),y.getDrawingBufferSize(Ve),Q?Ee.setSize(Ve.x,Ve.y):Ee.setSize(r0(Ve.x),r0(Ve.y));const oe=y.getRenderTarget();y.setRenderTarget(Ee),y.getClearColor(V),H=y.getClearAlpha(),H<1&&y.setClearColor(16777215,.5),y.clear();const pe=y.toneMapping;y.toneMapping=Qs,td(S,F,U),qe.updateMultisampleRenderTarget(Ee),qe.updateRenderTargetMipmap(Ee);let ve=!1;for(let ce=0,be=B.length;ce<be;ce++){const Be=B[ce],De=Be.object,Ye=Be.geometry,ht=Be.material,$e=Be.group;if(ht.side===wi&&De.layers.test(U.layers)){const at=ht.side;ht.side=fn,ht.needsUpdate=!0,nc(De,F,U,Ye,ht,$e),ht.side=at,ht.needsUpdate=!0,ve=!0}}ve===!0&&(qe.updateMultisampleRenderTarget(Ee),qe.updateRenderTargetMipmap(Ee)),y.setRenderTarget(oe),y.setClearColor(V,H),y.toneMapping=pe}function td(S,B,F){const U=B.isScene===!0?B.overrideMaterial:null;for(let Q=0,oe=S.length;Q<oe;Q++){const pe=S[Q],ve=pe.object,ce=pe.geometry,be=U===null?pe.material:U,Be=pe.group;ve.layers.test(F.layers)&&nc(ve,B,F,ce,be,Be)}}function nc(S,B,F,U,Q,oe){S.onBeforeRender(y,B,F,U,Q,oe),S.modelViewMatrix.multiplyMatrices(F.matrixWorldInverse,S.matrixWorld),S.normalMatrix.getNormalMatrix(S.modelViewMatrix),Q.onBeforeRender(y,B,F,U,S,oe),Q.transparent===!0&&Q.side===wi&&Q.forceSinglePass===!1?(Q.side=fn,Q.needsUpdate=!0,y.renderBufferDirect(F,B,U,Q,S,oe),Q.side=Es,Q.needsUpdate=!0,y.renderBufferDirect(F,B,U,Q,S,oe),Q.side=wi):y.renderBufferDirect(F,B,U,Q,S,oe),S.onAfterRender(y,B,F,U,Q,oe)}function ra(S,B,F){B.isScene!==!0&&(B=xt);const U=We.get(S),Q=v.state.lights,oe=v.state.shadowsArray,pe=Q.state.version,ve=he.getParameters(S,Q.state,oe,B,F),ce=he.getProgramCacheKey(ve);let be=U.programs;U.environment=S.isMeshStandardMaterial?B.environment:null,U.fog=B.fog,U.envMap=(S.isMeshStandardMaterial?wt:pt).get(S.envMap||U.environment),be===void 0&&(S.addEventListener("dispose",Xe),be=new Map,U.programs=be);let Be=be.get(ce);if(Be!==void 0){if(U.currentProgram===Be&&U.lightsStateVersion===pe)return Gt(S,ve),Be}else ve.uniforms=he.getUniforms(S),S.onBuild(F,ve,y),S.onBeforeCompile(ve,y),Be=he.acquireProgram(ve,ce),be.set(ce,Be),U.uniforms=ve.uniforms;const De=U.uniforms;(!S.isShaderMaterial&&!S.isRawShaderMaterial||S.clipping===!0)&&(De.clippingPlanes=X.uniform),Gt(S,ve),U.needsLights=P(S),U.lightsStateVersion=pe,U.needsLights&&(De.ambientLightColor.value=Q.state.ambient,De.lightProbe.value=Q.state.probe,De.directionalLights.value=Q.state.directional,De.directionalLightShadows.value=Q.state.directionalShadow,De.spotLights.value=Q.state.spot,De.spotLightShadows.value=Q.state.spotShadow,De.rectAreaLights.value=Q.state.rectArea,De.ltc_1.value=Q.state.rectAreaLTC1,De.ltc_2.value=Q.state.rectAreaLTC2,De.pointLights.value=Q.state.point,De.pointLightShadows.value=Q.state.pointShadow,De.hemisphereLights.value=Q.state.hemi,De.directionalShadowMap.value=Q.state.directionalShadowMap,De.directionalShadowMatrix.value=Q.state.directionalShadowMatrix,De.spotShadowMap.value=Q.state.spotShadowMap,De.spotLightMatrix.value=Q.state.spotLightMatrix,De.spotLightMap.value=Q.state.spotLightMap,De.pointShadowMap.value=Q.state.pointShadowMap,De.pointShadowMatrix.value=Q.state.pointShadowMatrix);const Ye=Be.getUniforms(),ht=Sy.seqWithValue(Ye.seq,De);return U.currentProgram=Be,U.uniformsList=ht,Be}function Gt(S,B){const F=We.get(S);F.outputColorSpace=B.outputColorSpace,F.instancing=B.instancing,F.skinning=B.skinning,F.morphTargets=B.morphTargets,F.morphNormals=B.morphNormals,F.morphColors=B.morphColors,F.morphTargetsCount=B.morphTargetsCount,F.numClippingPlanes=B.numClippingPlanes,F.numIntersection=B.numClipIntersection,F.vertexAlphas=B.vertexAlphas,F.vertexTangents=B.vertexTangents,F.toneMapping=B.toneMapping}function VA(S,B,F,U,Q){B.isScene!==!0&&(B=xt),qe.resetTextureUnits();const oe=B.fog,pe=U.isMeshStandardMaterial?B.environment:null,ve=I===null?y.outputColorSpace:I.isXRRenderTarget===!0?I.texture.colorSpace:gn,ce=(U.isMeshStandardMaterial?wt:pt).get(U.envMap||pe),be=U.vertexColors===!0&&!!F.attributes.color&&F.attributes.color.itemSize===4,Be=!!F.attributes.tangent&&(!!U.normalMap||U.anisotropy>0),De=!!F.morphAttributes.position,Ye=!!F.morphAttributes.normal,ht=!!F.morphAttributes.color,$e=U.toneMapped?y.toneMapping:Qs,at=F.morphAttributes.position||F.morphAttributes.normal||F.morphAttributes.color,ut=at!==void 0?at.length:0,dt=We.get(U),Ri=v.state.lights;if(ge===!0&&(Ce===!0||S!==C)){const Hi=S===C&&U.id===R;X.setState(U,S,Hi)}let ri=!1;U.version===dt.__version?(dt.needsLights&&dt.lightsStateVersion!==Ri.state.version||dt.outputColorSpace!==ve||Q.isInstancedMesh&&dt.instancing===!1||!Q.isInstancedMesh&&dt.instancing===!0||Q.isSkinnedMesh&&dt.skinning===!1||!Q.isSkinnedMesh&&dt.skinning===!0||dt.envMap!==ce||U.fog===!0&&dt.fog!==oe||dt.numClippingPlanes!==void 0&&(dt.numClippingPlanes!==X.numPlanes||dt.numIntersection!==X.numIntersection)||dt.vertexAlphas!==be||dt.vertexTangents!==Be||dt.morphTargets!==De||dt.morphNormals!==Ye||dt.morphColors!==ht||dt.toneMapping!==$e||ke.isWebGL2===!0&&dt.morphTargetsCount!==ut)&&(ri=!0):(ri=!0,dt.__version=U.version);let ei=dt.currentProgram;ri===!0&&(ei=ra(U,B,Q));let Wt=!1,Pi=!1,gs=!1;const $t=ei.getUniforms(),Vt=dt.uniforms;if(we.useProgram(ei.program)&&(Wt=!0,Pi=!0,gs=!0),U.id!==R&&(R=U.id,Pi=!0),Wt||C!==S){if($t.setValue(W,"projectionMatrix",S.projectionMatrix),ke.logarithmicDepthBuffer&&$t.setValue(W,"logDepthBufFC",2/(Math.log(S.far+1)/Math.LN2)),C!==S&&(C=S,Pi=!0,gs=!0),U.isShaderMaterial||U.isMeshPhongMaterial||U.isMeshToonMaterial||U.isMeshStandardMaterial||U.envMap){const Hi=$t.map.cameraPosition;Hi!==void 0&&Hi.setValue(W,lt.setFromMatrixPosition(S.matrixWorld))}(U.isMeshPhongMaterial||U.isMeshToonMaterial||U.isMeshLambertMaterial||U.isMeshBasicMaterial||U.isMeshStandardMaterial||U.isShaderMaterial)&&$t.setValue(W,"isOrthographic",S.isOrthographicCamera===!0),(U.isMeshPhongMaterial||U.isMeshToonMaterial||U.isMeshLambertMaterial||U.isMeshBasicMaterial||U.isMeshStandardMaterial||U.isShaderMaterial||U.isShadowMaterial||Q.isSkinnedMesh)&&$t.setValue(W,"viewMatrix",S.matrixWorldInverse)}if(Q.isSkinnedMesh){$t.setOptional(W,Q,"bindMatrix"),$t.setOptional(W,Q,"bindMatrixInverse");const Hi=Q.skeleton;Hi&&(ke.floatVertexTextures?(Hi.boneTexture===null&&Hi.computeBoneTexture(),$t.setValue(W,"boneTexture",Hi.boneTexture,qe),$t.setValue(W,"boneTextureSize",Hi.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const hi=F.morphAttributes;if((hi.position!==void 0||hi.normal!==void 0||hi.color!==void 0&&ke.isWebGL2===!0)&&Qe.update(Q,F,ei),(Pi||dt.receiveShadow!==Q.receiveShadow)&&(dt.receiveShadow=Q.receiveShadow,$t.setValue(W,"receiveShadow",Q.receiveShadow)),U.isMeshGouraudMaterial&&U.envMap!==null&&(Vt.envMap.value=ce,Vt.flipEnvMap.value=ce.isCubeTexture&&ce.isRenderTargetTexture===!1?-1:1),Pi&&($t.setValue(W,"toneMappingExposure",y.toneMappingExposure),dt.needsLights&&yx(Vt,gs),oe&&U.fog===!0&&Re.refreshFogUniforms(Vt,oe),Re.refreshMaterialUniforms(Vt,U,L,N,Ee),Sy.upload(W,dt.uniformsList,Vt,qe)),U.isShaderMaterial&&U.uniformsNeedUpdate===!0&&(Sy.upload(W,dt.uniformsList,Vt,qe),U.uniformsNeedUpdate=!1),U.isSpriteMaterial&&$t.setValue(W,"center",Q.center),$t.setValue(W,"modelViewMatrix",Q.modelViewMatrix),$t.setValue(W,"normalMatrix",Q.normalMatrix),$t.setValue(W,"modelMatrix",Q.matrixWorld),U.isShaderMaterial||U.isRawShaderMaterial){const Hi=U.uniformsGroups;for(let Ka=0,Yr=Hi.length;Ka<Yr;Ka++)if(ke.isWebGL2){const _h=Hi[Ka];gt.update(_h,ei),gt.bind(_h,ei)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return ei}function yx(S,B){S.ambientLightColor.needsUpdate=B,S.lightProbe.needsUpdate=B,S.directionalLights.needsUpdate=B,S.directionalLightShadows.needsUpdate=B,S.pointLights.needsUpdate=B,S.pointLightShadows.needsUpdate=B,S.spotLights.needsUpdate=B,S.spotLightShadows.needsUpdate=B,S.rectAreaLights.needsUpdate=B,S.hemisphereLights.needsUpdate=B}function P(S){return S.isMeshLambertMaterial||S.isMeshToonMaterial||S.isMeshPhongMaterial||S.isMeshStandardMaterial||S.isShadowMaterial||S.isShaderMaterial&&S.lights===!0}this.getActiveCubeFace=function(){return E},this.getActiveMipmapLevel=function(){return M},this.getRenderTarget=function(){return I},this.setRenderTargetTextures=function(S,B,F){We.get(S.texture).__webglTexture=B,We.get(S.depthTexture).__webglTexture=F;const U=We.get(S);U.__hasExternalTextures=!0,U.__hasExternalTextures&&(U.__autoAllocateDepthBuffer=F===void 0,U.__autoAllocateDepthBuffer||me.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),U.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(S,B){const F=We.get(S);F.__webglFramebuffer=B,F.__useDefaultFramebuffer=B===void 0},this.setRenderTarget=function(S,B=0,F=0){I=S,E=B,M=F;let U=!0,Q=null,oe=!1,pe=!1;if(S){const ce=We.get(S);ce.__useDefaultFramebuffer!==void 0?(we.bindFramebuffer(W.FRAMEBUFFER,null),U=!1):ce.__webglFramebuffer===void 0?qe.setupRenderTarget(S):ce.__hasExternalTextures&&qe.rebindTextures(S,We.get(S.texture).__webglTexture,We.get(S.depthTexture).__webglTexture);const be=S.texture;(be.isData3DTexture||be.isDataArrayTexture||be.isCompressedArrayTexture)&&(pe=!0);const Be=We.get(S).__webglFramebuffer;S.isWebGLCubeRenderTarget?(Q=Be[B],oe=!0):ke.isWebGL2&&S.samples>0&&qe.useMultisampledRTT(S)===!1?Q=We.get(S).__webglMultisampledFramebuffer:Q=Be,T.copy(S.viewport),O.copy(S.scissor),J=S.scissorTest}else T.copy($).multiplyScalar(L).floor(),O.copy(j).multiplyScalar(L).floor(),J=ie;if(we.bindFramebuffer(W.FRAMEBUFFER,Q)&&ke.drawBuffers&&U&&we.drawBuffers(S,Q),we.viewport(T),we.scissor(O),we.setScissorTest(J),oe){const ce=We.get(S.texture);W.framebufferTexture2D(W.FRAMEBUFFER,W.COLOR_ATTACHMENT0,W.TEXTURE_CUBE_MAP_POSITIVE_X+B,ce.__webglTexture,F)}else if(pe){const ce=We.get(S.texture),be=B||0;W.framebufferTextureLayer(W.FRAMEBUFFER,W.COLOR_ATTACHMENT0,ce.__webglTexture,F||0,be)}R=-1},this.readRenderTargetPixels=function(S,B,F,U,Q,oe,pe){if(!(S&&S.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let ve=We.get(S).__webglFramebuffer;if(S.isWebGLCubeRenderTarget&&pe!==void 0&&(ve=ve[pe]),ve){we.bindFramebuffer(W.FRAMEBUFFER,ve);try{const ce=S.texture,be=ce.format,Be=ce.type;if(be!==Ti&&Oe.convert(be)!==W.getParameter(W.IMPLEMENTATION_COLOR_READ_FORMAT)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const De=Be===xn&&(me.has("EXT_color_buffer_half_float")||ke.isWebGL2&&me.has("EXT_color_buffer_float"));if(Be!==fi&&Oe.convert(Be)!==W.getParameter(W.IMPLEMENTATION_COLOR_READ_TYPE)&&!(Be===sn&&(ke.isWebGL2||me.has("OES_texture_float")||me.has("WEBGL_color_buffer_float")))&&!De){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}B>=0&&B<=S.width-U&&F>=0&&F<=S.height-Q&&W.readPixels(B,F,U,Q,Oe.convert(be),Oe.convert(Be),oe)}finally{const ce=I!==null?We.get(I).__webglFramebuffer:null;we.bindFramebuffer(W.FRAMEBUFFER,ce)}}},this.copyFramebufferToTexture=function(S,B,F=0){const U=Math.pow(2,-F),Q=Math.floor(B.image.width*U),oe=Math.floor(B.image.height*U);qe.setTexture2D(B,0),W.copyTexSubImage2D(W.TEXTURE_2D,F,0,0,S.x,S.y,Q,oe),we.unbindTexture()},this.copyTextureToTexture=function(S,B,F,U=0){const Q=B.image.width,oe=B.image.height,pe=Oe.convert(F.format),ve=Oe.convert(F.type);qe.setTexture2D(F,0),W.pixelStorei(W.UNPACK_FLIP_Y_WEBGL,F.flipY),W.pixelStorei(W.UNPACK_PREMULTIPLY_ALPHA_WEBGL,F.premultiplyAlpha),W.pixelStorei(W.UNPACK_ALIGNMENT,F.unpackAlignment),B.isDataTexture?W.texSubImage2D(W.TEXTURE_2D,U,S.x,S.y,Q,oe,pe,ve,B.image.data):B.isCompressedTexture?W.compressedTexSubImage2D(W.TEXTURE_2D,U,S.x,S.y,B.mipmaps[0].width,B.mipmaps[0].height,pe,B.mipmaps[0].data):W.texSubImage2D(W.TEXTURE_2D,U,S.x,S.y,pe,ve,B.image),U===0&&F.generateMipmaps&&W.generateMipmap(W.TEXTURE_2D),we.unbindTexture()},this.copyTextureToTexture3D=function(S,B,F,U,Q=0){if(y.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const oe=S.max.x-S.min.x+1,pe=S.max.y-S.min.y+1,ve=S.max.z-S.min.z+1,ce=Oe.convert(U.format),be=Oe.convert(U.type);let Be;if(U.isData3DTexture)qe.setTexture3D(U,0),Be=W.TEXTURE_3D;else if(U.isDataArrayTexture)qe.setTexture2DArray(U,0),Be=W.TEXTURE_2D_ARRAY;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}W.pixelStorei(W.UNPACK_FLIP_Y_WEBGL,U.flipY),W.pixelStorei(W.UNPACK_PREMULTIPLY_ALPHA_WEBGL,U.premultiplyAlpha),W.pixelStorei(W.UNPACK_ALIGNMENT,U.unpackAlignment);const De=W.getParameter(W.UNPACK_ROW_LENGTH),Ye=W.getParameter(W.UNPACK_IMAGE_HEIGHT),ht=W.getParameter(W.UNPACK_SKIP_PIXELS),$e=W.getParameter(W.UNPACK_SKIP_ROWS),at=W.getParameter(W.UNPACK_SKIP_IMAGES),ut=F.isCompressedTexture?F.mipmaps[0]:F.image;W.pixelStorei(W.UNPACK_ROW_LENGTH,ut.width),W.pixelStorei(W.UNPACK_IMAGE_HEIGHT,ut.height),W.pixelStorei(W.UNPACK_SKIP_PIXELS,S.min.x),W.pixelStorei(W.UNPACK_SKIP_ROWS,S.min.y),W.pixelStorei(W.UNPACK_SKIP_IMAGES,S.min.z),F.isDataTexture||F.isData3DTexture?W.texSubImage3D(Be,Q,B.x,B.y,B.z,oe,pe,ve,ce,be,ut.data):F.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),W.compressedTexSubImage3D(Be,Q,B.x,B.y,B.z,oe,pe,ve,ce,ut.data)):W.texSubImage3D(Be,Q,B.x,B.y,B.z,oe,pe,ve,ce,be,ut),W.pixelStorei(W.UNPACK_ROW_LENGTH,De),W.pixelStorei(W.UNPACK_IMAGE_HEIGHT,Ye),W.pixelStorei(W.UNPACK_SKIP_PIXELS,ht),W.pixelStorei(W.UNPACK_SKIP_ROWS,$e),W.pixelStorei(W.UNPACK_SKIP_IMAGES,at),Q===0&&U.generateMipmaps&&W.generateMipmap(Be),we.unbindTexture()},this.initTexture=function(S){S.isCubeTexture?qe.setTextureCube(S,0):S.isData3DTexture?qe.setTexture3D(S,0):S.isDataArrayTexture||S.isCompressedArrayTexture?qe.setTexture2DArray(S,0):qe.setTexture2D(S,0),we.unbindTexture()},this.resetState=function(){E=0,M=0,I=null,we.reset(),it.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Ba}get physicallyCorrectLights(){return console.warn("THREE.WebGLRenderer: the property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),!this.useLegacyLights}set physicallyCorrectLights(e){console.warn("THREE.WebGLRenderer: the property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),this.useLegacyLights=!e}get outputEncoding(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===Je?ka:Km}set outputEncoding(e){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=e===ka?Je:gn}}class Fk extends oh{}Fk.prototype.isWebGL1Renderer=!0;class Rb{constructor(e,t=25e-5){this.isFogExp2=!0,this.name="",this.color=new _e(e),this.density=t}clone(){return new Rb(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}let aM=class Uk{constructor(e,t=1,i=1e3){this.isFog=!0,this.name="",this.color=new _e(e),this.near=t,this.far=i}clone(){return new Uk(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}};class mr extends Me{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t}}class $m{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=gm,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Lr()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,i){e*=this.stride,i*=t.stride;for(let s=0,r=this.stride;s<r;s++)this.array[e+s]=t.array[i+s];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Lr()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(t,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Lr()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const ks=new w;class Gl{constructor(e,t,i,s=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=s}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,i=this.data.count;t<i;t++)ks.fromBufferAttribute(this,t),ks.applyMatrix4(e),this.setXYZ(t,ks.x,ks.y,ks.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)ks.fromBufferAttribute(this,t),ks.applyNormalMatrix(e),this.setXYZ(t,ks.x,ks.y,ks.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)ks.fromBufferAttribute(this,t),ks.transformDirection(e),this.setXYZ(t,ks.x,ks.y,ks.z);return this}setX(e,t){return this.normalized&&(t=Ut(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=Ut(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=Ut(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=Ut(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=Dr(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=Dr(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=Dr(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=Dr(t,this.array)),t}setXY(e,t,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=Ut(t,this.array),i=Ut(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this}setXYZ(e,t,i,s){return e=e*this.data.stride+this.offset,this.normalized&&(t=Ut(t,this.array),i=Ut(i,this.array),s=Ut(s,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=s,this}setXYZW(e,t,i,s,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=Ut(t,this.array),i=Ut(i,this.array),s=Ut(s,this.array),r=Ut(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=s,this.data.array[e+3]=r,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const s=i*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)t.push(this.data.array[s+r])}return new ot(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Gl(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const s=i*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)t.push(this.data.array[s+r])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class lM extends Pt{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new _e(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let vd;const Dp=new w,yd=new w,bd=new w,_d=new te,Op=new te,Nk=new Ie,cv=new w,kp=new w,hv=new w,qI=new te,Gx=new te,XI=new te;let zk=class extends Me{constructor(e){if(super(),this.isSprite=!0,this.type="Sprite",vd===void 0){vd=new ft;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),i=new $m(t,5);vd.setIndex([0,1,2,0,2,3]),vd.setAttribute("position",new Gl(i,3,0,!1)),vd.setAttribute("uv",new Gl(i,2,3,!1))}this.geometry=vd,this.material=e!==void 0?e:new lM,this.center=new te(.5,.5)}raycast(e,t){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),yd.setFromMatrixScale(this.matrixWorld),Nk.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),bd.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&yd.multiplyScalar(-bd.z);const i=this.material.rotation;let s,r;i!==0&&(r=Math.cos(i),s=Math.sin(i));const o=this.center;uv(cv.set(-.5,-.5,0),bd,o,yd,s,r),uv(kp.set(.5,-.5,0),bd,o,yd,s,r),uv(hv.set(.5,.5,0),bd,o,yd,s,r),qI.set(0,0),Gx.set(1,0),XI.set(1,1);let a=e.ray.intersectTriangle(cv,kp,hv,!1,Dp);if(a===null&&(uv(kp.set(-.5,.5,0),bd,o,yd,s,r),Gx.set(0,1),a=e.ray.intersectTriangle(cv,hv,kp,!1,Dp),a===null))return;const l=e.ray.origin.distanceTo(Dp);l<e.near||l>e.far||t.push({distance:l,point:Dp.clone(),uv:Vs.getInterpolation(Dp,cv,kp,hv,qI,Gx,XI,new te),face:null,object:this})}copy(e,t){return super.copy(e,t),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}};function uv(n,e,t,i,s,r){_d.subVectors(n,t).addScalar(.5).multiply(i),s!==void 0?(Op.x=r*_d.x-s*_d.y,Op.y=s*_d.x+r*_d.y):Op.copy(_d),n.copy(e),n.x+=Op.x,n.y+=Op.y,n.applyMatrix4(Nk)}const dv=new w,YI=new w;let cM=class extends Me{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let i=0,s=t.length;i<s;i++){const r=t[i];this.addLevel(r.object.clone(),r.distance,r.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0,i=0){t=Math.abs(t);const s=this.levels;let r;for(r=0;r<s.length&&!(t<s[r].distance);r++);return s.splice(r,0,{distance:t,hysteresis:i,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let i,s;for(i=1,s=t.length;i<s;i++){let r=t[i].distance;if(t[i].object.visible&&(r-=r*t[i].hysteresis),e<r)break}return t[i-1].object}return null}raycast(e,t){if(this.levels.length>0){dv.setFromMatrixPosition(this.matrixWorld);const s=e.ray.origin.distanceTo(dv);this.getObjectForDistance(s).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){dv.setFromMatrixPosition(e.matrixWorld),YI.setFromMatrixPosition(this.matrixWorld);const i=dv.distanceTo(YI)/e.zoom;t[0].object.visible=!0;let s,r;for(s=1,r=t.length;s<r;s++){let o=t[s].distance;if(t[s].object.visible&&(o-=o*t[s].hysteresis),i>=o)t[s-1].object.visible=!1,t[s].object.visible=!0;else break}for(this._currentLevel=s-1;s<r;s++)t[s].object.visible=!1}}toJSON(e){const t=super.toJSON(e);this.autoUpdate===!1&&(t.object.autoUpdate=!1),t.object.levels=[];const i=this.levels;for(let s=0,r=i.length;s<r;s++){const o=i[s];t.object.levels.push({object:o.object.uuid,distance:o.distance,hysteresis:o.hysteresis})}return t}};const JI=new w,KI=new Ke,ZI=new Ke,M4=new w,$I=new Ie,xd=new w,Vx=new Ys,eR=new Ie,Hx=new Qa;class Yf extends ye{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Ie,this.bindMatrixInverse=new Ie,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;this.boundingBox===null&&(this.boundingBox=new Bn),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let i=0;i<t.count;i++)xd.fromBufferAttribute(t,i),this.applyBoneTransform(i,xd),this.boundingBox.expandByPoint(xd)}computeBoundingSphere(){const e=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new Ys),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let i=0;i<t.count;i++)xd.fromBufferAttribute(t,i),this.applyBoneTransform(i,xd),this.boundingSphere.expandByPoint(xd)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const i=this.material,s=this.matrixWorld;i!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),Vx.copy(this.boundingSphere),Vx.applyMatrix4(s),e.ray.intersectsSphere(Vx)!==!1&&(eR.copy(s).invert(),Hx.copy(e.ray).applyMatrix4(eR),!(this.boundingBox!==null&&Hx.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(e,t,Hx)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Ke,t=this.geometry.attributes.skinWeight;for(let i=0,s=t.count;i<s;i++){e.fromBufferAttribute(t,i);const r=1/e.manhattanLength();r!==1/0?e.multiplyScalar(r):e.set(1,0,0,0),t.setXYZW(i,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){const i=this.skeleton,s=this.geometry;KI.fromBufferAttribute(s.attributes.skinIndex,e),ZI.fromBufferAttribute(s.attributes.skinWeight,e),JI.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let r=0;r<4;r++){const o=ZI.getComponent(r);if(o!==0){const a=KI.getComponent(r);$I.multiplyMatrices(i.bones[a].matrixWorld,i.boneInverses[a]),t.addScaledVector(M4.copy(JI).applyMatrix4($I),o)}}return t.applyMatrix4(this.bindMatrixInverse)}boneTransform(e,t){return console.warn("THREE.SkinnedMesh: .boneTransform() was renamed to .applyBoneTransform() in r151."),this.applyBoneTransform(e,t)}}class eA extends Me{constructor(){super(),this.isBone=!0,this.type="Bone"}}class Ao extends Rt{constructor(e=null,t=1,i=1,s,r,o,a,l,c=Ft,u=Ft,d,f){super(null,o,a,l,c,u,s,r,d,f),this.isDataTexture=!0,this.image={data:e,width:t,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const tR=new Ie,T4=new Ie;class Jf{constructor(e=[],t=[]){this.uuid=Lr(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let i=0,s=this.bones.length;i<s;i++)this.boneInverses.push(new Ie)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const i=new Ie;this.bones[e]&&i.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(i)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const i=this.bones[e];i&&i.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const i=this.bones[e];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}update(){const e=this.bones,t=this.boneInverses,i=this.boneMatrices,s=this.boneTexture;for(let r=0,o=e.length;r<o;r++){const a=e[r]?e[r].matrixWorld:T4;tR.multiplyMatrices(a,t[r]),tR.toArray(i,r*16)}s!==null&&(s.needsUpdate=!0)}clone(){return new Jf(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=Ck(e),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const i=new Ao(t,e,e,Ti,sn);return i.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=i,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,i=this.bones.length;t<i;t++){const s=this.bones[t];if(s.name===e)return s}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let i=0,s=e.bones.length;i<s;i++){const r=e.bones[i];let o=t[r];o===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),o=new eA),this.bones.push(o),this.boneInverses.push(new Ie().fromArray(e.boneInverses[i]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,i=this.boneInverses;for(let s=0,r=t.length;s<r;s++){const o=t[s];e.bones.push(o.uuid);const a=i[s];e.boneInverses.push(a.toArray())}return e}}class Mr extends ot{constructor(e,t,i,s=1){super(e,t,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=s}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const wd=new Ie,iR=new Ie,fv=[],nR=new Bn,I4=new Ie,Lp=new ye,Fp=new Ys;class Pb extends ye{constructor(e,t,i){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new Mr(new Float32Array(i*16),16),this.instanceColor=null,this.count=i,this.boundingBox=null,this.boundingSphere=null;for(let s=0;s<i;s++)this.setMatrixAt(s,I4)}computeBoundingBox(){const e=this.geometry,t=this.count;this.boundingBox===null&&(this.boundingBox=new Bn),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let i=0;i<t;i++)this.getMatrixAt(i,wd),nR.copy(e.boundingBox).applyMatrix4(wd),this.boundingBox.union(nR)}computeBoundingSphere(){const e=this.geometry,t=this.count;this.boundingSphere===null&&(this.boundingSphere=new Ys),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let i=0;i<t;i++)this.getMatrixAt(i,wd),Fp.copy(e.boundingSphere).applyMatrix4(wd),this.boundingSphere.union(Fp)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}raycast(e,t){const i=this.matrixWorld,s=this.count;if(Lp.geometry=this.geometry,Lp.material=this.material,Lp.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),Fp.copy(this.boundingSphere),Fp.applyMatrix4(i),e.ray.intersectsSphere(Fp)!==!1))for(let r=0;r<s;r++){this.getMatrixAt(r,wd),iR.multiplyMatrices(i,wd),Lp.matrixWorld=iR,Lp.raycast(e,fv);for(let o=0,a=fv.length;o<a;o++){const l=fv[o];l.instanceId=r,l.object=this,t.push(l)}fv.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new Mr(new Float32Array(this.instanceMatrix.count*3),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}class Sn extends Pt{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new _e(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const sR=new w,rR=new w,oR=new Ie,Qx=new Qa,pv=new Ys;let dn=class extends Me{constructor(e=new ft,t=new Sn){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,i=[0];for(let s=1,r=t.count;s<r;s++)sR.fromBufferAttribute(t,s-1),rR.fromBufferAttribute(t,s),i[s]=i[s-1],i[s]+=sR.distanceTo(rR);e.setAttribute("lineDistance",new st(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const i=this.geometry,s=this.matrixWorld,r=e.params.Line.threshold,o=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),pv.copy(i.boundingSphere),pv.applyMatrix4(s),pv.radius+=r,e.ray.intersectsSphere(pv)===!1)return;oR.copy(s).invert(),Qx.copy(e.ray).applyMatrix4(oR);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=new w,u=new w,d=new w,f=new w,p=this.isLineSegments?2:1,g=i.index,v=i.attributes.position;if(g!==null){const m=Math.max(0,o.start),b=Math.min(g.count,o.start+o.count);for(let y=m,_=b-1;y<_;y+=p){const E=g.getX(y),M=g.getX(y+1);if(c.fromBufferAttribute(v,E),u.fromBufferAttribute(v,M),Qx.distanceSqToSegment(c,u,f,d)>l)continue;f.applyMatrix4(this.matrixWorld);const R=e.ray.origin.distanceTo(f);R<e.near||R>e.far||t.push({distance:R,point:d.clone().applyMatrix4(this.matrixWorld),index:y,face:null,faceIndex:null,object:this})}}else{const m=Math.max(0,o.start),b=Math.min(v.count,o.start+o.count);for(let y=m,_=b-1;y<_;y+=p){if(c.fromBufferAttribute(v,y),u.fromBufferAttribute(v,y+1),Qx.distanceSqToSegment(c,u,f,d)>l)continue;f.applyMatrix4(this.matrixWorld);const M=e.ray.origin.distanceTo(f);M<e.near||M>e.far||t.push({distance:M,point:d.clone().applyMatrix4(this.matrixWorld),index:y,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const s=t[i[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=s.length;r<o;r++){const a=s[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}};const aR=new w,lR=new w;class wo extends dn{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,i=[];for(let s=0,r=t.count;s<r;s+=2)aR.fromBufferAttribute(t,s),lR.fromBufferAttribute(t,s+1),i[s]=s===0?0:i[s-1],i[s+1]=i[s]+aR.distanceTo(lR);e.setAttribute("lineDistance",new st(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class hM extends dn{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class Bb extends Pt{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new _e(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const cR=new Ie,tC=new Qa,gv=new Ys,mv=new w;class uM extends Me{constructor(e=new ft,t=new Bb){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){const i=this.geometry,s=this.matrixWorld,r=e.params.Points.threshold,o=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),gv.copy(i.boundingSphere),gv.applyMatrix4(s),gv.radius+=r,e.ray.intersectsSphere(gv)===!1)return;cR.copy(s).invert(),tC.copy(e.ray).applyMatrix4(cR);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=i.index,d=i.attributes.position;if(c!==null){const f=Math.max(0,o.start),p=Math.min(c.count,o.start+o.count);for(let g=f,A=p;g<A;g++){const v=c.getX(g);mv.fromBufferAttribute(d,v),hR(mv,v,l,s,e,t,this)}}else{const f=Math.max(0,o.start),p=Math.min(d.count,o.start+o.count);for(let g=f,A=p;g<A;g++)mv.fromBufferAttribute(d,g),hR(mv,g,l,s,e,t,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const s=t[i[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=s.length;r<o;r++){const a=s[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}}function hR(n,e,t,i,s,r,o){const a=tC.distanceSqToPoint(n);if(a<t){const l=new w;tC.closestPointToPoint(n,l),l.applyMatrix4(i);const c=s.ray.origin.distanceTo(l);if(c<s.near||c>s.far)return;r.push({distance:c,distanceToRay:Math.sqrt(a),point:l,index:e,face:null,object:o})}}class Gk extends Rt{constructor(e,t,i,s,r,o,a,l,c){super(e,t,i,s,r,o,a,l,c),this.isVideoTexture=!0,this.minFilter=o!==void 0?o:Dt,this.magFilter=r!==void 0?r:Dt,this.generateMipmaps=!1;const u=this;function d(){u.needsUpdate=!0,e.requestVideoFrameCallback(d)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(d)}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class R4 extends Rt{constructor(e,t){super({width:e,height:t}),this.isFramebufferTexture=!0,this.magFilter=Ft,this.minFilter=Ft,this.generateMipmaps=!1,this.needsUpdate=!0}}class Ol extends Rt{constructor(e,t,i,s,r,o,a,l,c,u,d,f){super(null,o,a,l,c,u,s,r,d,f),this.isCompressedTexture=!0,this.image={width:t,height:i},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class Vk extends Ol{constructor(e,t,i,s,r,o){super(e,t,i,r,o),this.isCompressedArrayTexture=!0,this.image.depth=s,this.wrapR=Wn}}class Hk extends Rt{constructor(e,t,i,s,r,o,a,l,c){super(e,t,i,s,r,o,a,l,c),this.isCanvasTexture=!0,this.needsUpdate=!0}}class Zo{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const i=this.getUtoTmapping(e);return this.getPoint(i,t)}getPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return t}getSpacedPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let i,s=this.getPoint(0),r=0;t.push(0);for(let o=1;o<=e;o++)i=this.getPoint(o/e),r+=i.distanceTo(s),t.push(r),s=i;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const i=this.getLengths();let s=0;const r=i.length;let o;t?o=t:o=e*i[r-1];let a=0,l=r-1,c;for(;a<=l;)if(s=Math.floor(a+(l-a)/2),c=i[s]-o,c<0)a=s+1;else if(c>0)l=s-1;else{l=s;break}if(s=l,i[s]===o)return s/(r-1);const u=i[s],f=i[s+1]-u,p=(o-u)/f;return(s+p)/(r-1)}getTangent(e,t){let s=e-1e-4,r=e+1e-4;s<0&&(s=0),r>1&&(r=1);const o=this.getPoint(s),a=this.getPoint(r),l=t||(o.isVector2?new te:new w);return l.copy(a).sub(o).normalize(),l}getTangentAt(e,t){const i=this.getUtoTmapping(e);return this.getTangent(i,t)}computeFrenetFrames(e,t){const i=new w,s=[],r=[],o=[],a=new w,l=new Ie;for(let p=0;p<=e;p++){const g=p/e;s[p]=this.getTangentAt(g,new w)}r[0]=new w,o[0]=new w;let c=Number.MAX_VALUE;const u=Math.abs(s[0].x),d=Math.abs(s[0].y),f=Math.abs(s[0].z);u<=c&&(c=u,i.set(1,0,0)),d<=c&&(c=d,i.set(0,1,0)),f<=c&&i.set(0,0,1),a.crossVectors(s[0],i).normalize(),r[0].crossVectors(s[0],a),o[0].crossVectors(s[0],r[0]);for(let p=1;p<=e;p++){if(r[p]=r[p-1].clone(),o[p]=o[p-1].clone(),a.crossVectors(s[p-1],s[p]),a.length()>Number.EPSILON){a.normalize();const g=Math.acos(nn(s[p-1].dot(s[p]),-1,1));r[p].applyMatrix4(l.makeRotationAxis(a,g))}o[p].crossVectors(s[p],r[p])}if(t===!0){let p=Math.acos(nn(r[0].dot(r[e]),-1,1));p/=e,s[0].dot(a.crossVectors(r[0],r[e]))>0&&(p=-p);for(let g=1;g<=e;g++)r[g].applyMatrix4(l.makeRotationAxis(s[g],p*g)),o[g].crossVectors(s[g],r[g])}return{tangents:s,normals:r,binormals:o}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class Db extends Zo{constructor(e=0,t=0,i=1,s=1,r=0,o=Math.PI*2,a=!1,l=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=s,this.aStartAngle=r,this.aEndAngle=o,this.aClockwise=a,this.aRotation=l}getPoint(e,t){const i=t||new te,s=Math.PI*2;let r=this.aEndAngle-this.aStartAngle;const o=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=s;for(;r>s;)r-=s;r<Number.EPSILON&&(o?r=0:r=s),this.aClockwise===!0&&!o&&(r===s?r=-s:r=r-s);const a=this.aStartAngle+e*r;let l=this.aX+this.xRadius*Math.cos(a),c=this.aY+this.yRadius*Math.sin(a);if(this.aRotation!==0){const u=Math.cos(this.aRotation),d=Math.sin(this.aRotation),f=l-this.aX,p=c-this.aY;l=f*u-p*d+this.aX,c=f*d+p*u+this.aY}return i.set(l,c)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class Qk extends Db{constructor(e,t,i,s,r,o){super(e,t,i,i,s,r,o),this.isArcCurve=!0,this.type="ArcCurve"}}function dM(){let n=0,e=0,t=0,i=0;function s(r,o,a,l){n=r,e=a,t=-3*r+3*o-2*a-l,i=2*r-2*o+a+l}return{initCatmullRom:function(r,o,a,l,c){s(o,a,c*(a-r),c*(l-o))},initNonuniformCatmullRom:function(r,o,a,l,c,u,d){let f=(o-r)/c-(a-r)/(c+u)+(a-o)/u,p=(a-o)/u-(l-o)/(u+d)+(l-a)/d;f*=u,p*=u,s(o,a,f,p)},calc:function(r){const o=r*r,a=o*r;return n+e*r+t*o+i*a}}}const Av=new w,Wx=new dM,jx=new dM,qx=new dM;class Wk extends Zo{constructor(e=[],t=!1,i="centripetal",s=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=i,this.tension=s}getPoint(e,t=new w){const i=t,s=this.points,r=s.length,o=(r-(this.closed?0:1))*e;let a=Math.floor(o),l=o-a;this.closed?a+=a>0?0:(Math.floor(Math.abs(a)/r)+1)*r:l===0&&a===r-1&&(a=r-2,l=1);let c,u;this.closed||a>0?c=s[(a-1)%r]:(Av.subVectors(s[0],s[1]).add(s[0]),c=Av);const d=s[a%r],f=s[(a+1)%r];if(this.closed||a+2<r?u=s[(a+2)%r]:(Av.subVectors(s[r-1],s[r-2]).add(s[r-1]),u=Av),this.curveType==="centripetal"||this.curveType==="chordal"){const p=this.curveType==="chordal"?.5:.25;let g=Math.pow(c.distanceToSquared(d),p),A=Math.pow(d.distanceToSquared(f),p),v=Math.pow(f.distanceToSquared(u),p);A<1e-4&&(A=1),g<1e-4&&(g=A),v<1e-4&&(v=A),Wx.initNonuniformCatmullRom(c.x,d.x,f.x,u.x,g,A,v),jx.initNonuniformCatmullRom(c.y,d.y,f.y,u.y,g,A,v),qx.initNonuniformCatmullRom(c.z,d.z,f.z,u.z,g,A,v)}else this.curveType==="catmullrom"&&(Wx.initCatmullRom(c.x,d.x,f.x,u.x,this.tension),jx.initCatmullRom(c.y,d.y,f.y,u.y,this.tension),qx.initCatmullRom(c.z,d.z,f.z,u.z,this.tension));return i.set(Wx.calc(l),jx.calc(l),qx.calc(l)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const s=e.points[t];this.points.push(s.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){const s=this.points[t];e.points.push(s.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const s=e.points[t];this.points.push(new w().fromArray(s))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function uR(n,e,t,i,s){const r=(i-e)*.5,o=(s-t)*.5,a=n*n,l=n*a;return(2*t-2*i+r+o)*l+(-3*t+3*i-2*r-o)*a+r*n+t}function P4(n,e){const t=1-n;return t*t*e}function B4(n,e){return 2*(1-n)*n*e}function D4(n,e){return n*n*e}function Mg(n,e,t,i){return P4(n,e)+B4(n,t)+D4(n,i)}function O4(n,e){const t=1-n;return t*t*t*e}function k4(n,e){const t=1-n;return 3*t*t*n*e}function L4(n,e){return 3*(1-n)*n*n*e}function F4(n,e){return n*n*n*e}function Tg(n,e,t,i,s){return O4(n,e)+k4(n,t)+L4(n,i)+F4(n,s)}class fM extends Zo{constructor(e=new te,t=new te,i=new te,s=new te){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=i,this.v3=s}getPoint(e,t=new te){const i=t,s=this.v0,r=this.v1,o=this.v2,a=this.v3;return i.set(Tg(e,s.x,r.x,o.x,a.x),Tg(e,s.y,r.y,o.y,a.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class jk extends Zo{constructor(e=new w,t=new w,i=new w,s=new w){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=i,this.v3=s}getPoint(e,t=new w){const i=t,s=this.v0,r=this.v1,o=this.v2,a=this.v3;return i.set(Tg(e,s.x,r.x,o.x,a.x),Tg(e,s.y,r.y,o.y,a.y),Tg(e,s.z,r.z,o.z,a.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class Ob extends Zo{constructor(e=new te,t=new te){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new te){const i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new te){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class qk extends Zo{constructor(e=new w,t=new w){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new w){const i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new w){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class pM extends Zo{constructor(e=new te,t=new te,i=new te){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new te){const i=t,s=this.v0,r=this.v1,o=this.v2;return i.set(Mg(e,s.x,r.x,o.x),Mg(e,s.y,r.y,o.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class gM extends Zo{constructor(e=new w,t=new w,i=new w){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new w){const i=t,s=this.v0,r=this.v1,o=this.v2;return i.set(Mg(e,s.x,r.x,o.x),Mg(e,s.y,r.y,o.y),Mg(e,s.z,r.z,o.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class mM extends Zo{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new te){const i=t,s=this.points,r=(s.length-1)*e,o=Math.floor(r),a=r-o,l=s[o===0?o:o-1],c=s[o],u=s[o>s.length-2?s.length-1:o+1],d=s[o>s.length-3?s.length-1:o+2];return i.set(uR(a,l.x,c.x,u.x,d.x),uR(a,l.y,c.y,u.y,d.y)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const s=e.points[t];this.points.push(s.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){const s=this.points[t];e.points.push(s.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const s=e.points[t];this.points.push(new te().fromArray(s))}return this}}var AM=Object.freeze({__proto__:null,ArcCurve:Qk,CatmullRomCurve3:Wk,CubicBezierCurve:fM,CubicBezierCurve3:jk,EllipseCurve:Db,LineCurve:Ob,LineCurve3:qk,QuadraticBezierCurve:pM,QuadraticBezierCurve3:gM,SplineCurve:mM});class Xk extends Zo{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Ob(t,e))}getPoint(e,t){const i=e*this.getLength(),s=this.getCurveLengths();let r=0;for(;r<s.length;){if(s[r]>=i){const o=s[r]-i,a=this.curves[r],l=a.getLength(),c=l===0?0:1-o/l;return a.getPointAt(c,t)}r++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let i=0,s=this.curves.length;i<s;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let i;for(let s=0,r=this.curves;s<r.length;s++){const o=r[s],a=o.isEllipseCurve?e*2:o.isLineCurve||o.isLineCurve3?1:o.isSplineCurve?e*o.points.length:e,l=o.getPoints(a);for(let c=0;c<l.length;c++){const u=l[c];i&&i.equals(u)||(t.push(u),i=u)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const s=e.curves[t];this.curves.push(s.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,i=this.curves.length;t<i;t++){const s=this.curves[t];e.curves.push(s.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const s=e.curves[t];this.curves.push(new AM[s.type]().fromJSON(s))}return this}}class vm extends Xk{constructor(e){super(),this.type="Path",this.currentPoint=new te,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const i=new Ob(this.currentPoint.clone(),new te(e,t));return this.curves.push(i),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,i,s){const r=new pM(this.currentPoint.clone(),new te(e,t),new te(i,s));return this.curves.push(r),this.currentPoint.set(i,s),this}bezierCurveTo(e,t,i,s,r,o){const a=new fM(this.currentPoint.clone(),new te(e,t),new te(i,s),new te(r,o));return this.curves.push(a),this.currentPoint.set(r,o),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),i=new mM(t);return this.curves.push(i),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,i,s,r,o){const a=this.currentPoint.x,l=this.currentPoint.y;return this.absarc(e+a,t+l,i,s,r,o),this}absarc(e,t,i,s,r,o){return this.absellipse(e,t,i,i,s,r,o),this}ellipse(e,t,i,s,r,o,a,l){const c=this.currentPoint.x,u=this.currentPoint.y;return this.absellipse(e+c,t+u,i,s,r,o,a,l),this}absellipse(e,t,i,s,r,o,a,l){const c=new Db(e,t,i,s,r,o,a,l);if(this.curves.length>0){const d=c.getPoint(0);d.equals(this.currentPoint)||this.lineTo(d.x,d.y)}this.curves.push(c);const u=c.getPoint(1);return this.currentPoint.copy(u),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class tA extends ft{constructor(e=[new te(0,-.5),new te(.5,0),new te(0,.5)],t=12,i=0,s=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:i,phiLength:s},t=Math.floor(t),s=nn(s,0,Math.PI*2);const r=[],o=[],a=[],l=[],c=[],u=1/t,d=new w,f=new te,p=new w,g=new w,A=new w;let v=0,m=0;for(let b=0;b<=e.length-1;b++)switch(b){case 0:v=e[b+1].x-e[b].x,m=e[b+1].y-e[b].y,p.x=m*1,p.y=-v,p.z=m*0,A.copy(p),p.normalize(),l.push(p.x,p.y,p.z);break;case e.length-1:l.push(A.x,A.y,A.z);break;default:v=e[b+1].x-e[b].x,m=e[b+1].y-e[b].y,p.x=m*1,p.y=-v,p.z=m*0,g.copy(p),p.x+=A.x,p.y+=A.y,p.z+=A.z,p.normalize(),l.push(p.x,p.y,p.z),A.copy(g)}for(let b=0;b<=t;b++){const y=i+b*u*s,_=Math.sin(y),E=Math.cos(y);for(let M=0;M<=e.length-1;M++){d.x=e[M].x*_,d.y=e[M].y,d.z=e[M].x*E,o.push(d.x,d.y,d.z),f.x=b/t,f.y=M/(e.length-1),a.push(f.x,f.y);const I=l[3*M+0]*_,R=l[3*M+1],C=l[3*M+0]*E;c.push(I,R,C)}}for(let b=0;b<t;b++)for(let y=0;y<e.length-1;y++){const _=y+b*e.length,E=_,M=_+e.length,I=_+e.length+1,R=_+1;r.push(E,M,R),r.push(I,R,M)}this.setIndex(r),this.setAttribute("position",new st(o,3)),this.setAttribute("uv",new st(a,2)),this.setAttribute("normal",new st(c,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new tA(e.points,e.segments,e.phiStart,e.phiLength)}}class kb extends tA{constructor(e=1,t=1,i=4,s=8){const r=new vm;r.absarc(0,-t/2,e,Math.PI*1.5,0),r.absarc(0,t/2,e,0,Math.PI*.5),super(r.getPoints(i),s),this.type="CapsuleGeometry",this.parameters={radius:e,height:t,capSegments:i,radialSegments:s}}static fromJSON(e){return new kb(e.radius,e.length,e.capSegments,e.radialSegments)}}class Lb extends ft{constructor(e=1,t=32,i=0,s=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:i,thetaLength:s},t=Math.max(3,t);const r=[],o=[],a=[],l=[],c=new w,u=new te;o.push(0,0,0),a.push(0,0,1),l.push(.5,.5);for(let d=0,f=3;d<=t;d++,f+=3){const p=i+d/t*s;c.x=e*Math.cos(p),c.y=e*Math.sin(p),o.push(c.x,c.y,c.z),a.push(0,0,1),u.x=(o[f]/e+1)/2,u.y=(o[f+1]/e+1)/2,l.push(u.x,u.y)}for(let d=1;d<=t;d++)r.push(d,d+1,0);this.setIndex(r),this.setAttribute("position",new st(o,3)),this.setAttribute("normal",new st(a,3)),this.setAttribute("uv",new st(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Lb(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class cn extends ft{constructor(e=1,t=1,i=1,s=32,r=1,o=!1,a=0,l=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:s,heightSegments:r,openEnded:o,thetaStart:a,thetaLength:l};const c=this;s=Math.floor(s),r=Math.floor(r);const u=[],d=[],f=[],p=[];let g=0;const A=[],v=i/2;let m=0;b(),o===!1&&(e>0&&y(!0),t>0&&y(!1)),this.setIndex(u),this.setAttribute("position",new st(d,3)),this.setAttribute("normal",new st(f,3)),this.setAttribute("uv",new st(p,2));function b(){const _=new w,E=new w;let M=0;const I=(t-e)/i;for(let R=0;R<=r;R++){const C=[],T=R/r,O=T*(t-e)+e;for(let J=0;J<=s;J++){const V=J/s,H=V*l+a,Y=Math.sin(H),N=Math.cos(H);E.x=O*Y,E.y=-T*i+v,E.z=O*N,d.push(E.x,E.y,E.z),_.set(Y,I,N).normalize(),f.push(_.x,_.y,_.z),p.push(V,1-T),C.push(g++)}A.push(C)}for(let R=0;R<s;R++)for(let C=0;C<r;C++){const T=A[C][R],O=A[C+1][R],J=A[C+1][R+1],V=A[C][R+1];u.push(T,O,V),u.push(O,J,V),M+=6}c.addGroup(m,M,0),m+=M}function y(_){const E=g,M=new te,I=new w;let R=0;const C=_===!0?e:t,T=_===!0?1:-1;for(let J=1;J<=s;J++)d.push(0,v*T,0),f.push(0,T,0),p.push(.5,.5),g++;const O=g;for(let J=0;J<=s;J++){const H=J/s*l+a,Y=Math.cos(H),N=Math.sin(H);I.x=C*N,I.y=v*T,I.z=C*Y,d.push(I.x,I.y,I.z),f.push(0,T,0),M.x=Y*.5+.5,M.y=N*.5*T+.5,p.push(M.x,M.y),g++}for(let J=0;J<s;J++){const V=E+J,H=O+J;_===!0?u.push(H,H+1,V):u.push(H+1,H,V),R+=3}c.addGroup(m,R,_===!0?1:2),m+=R}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new cn(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Fb extends cn{constructor(e=1,t=1,i=32,s=1,r=!1,o=0,a=Math.PI*2){super(0,e,t,i,s,r,o,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:s,openEnded:r,thetaStart:o,thetaLength:a}}static fromJSON(e){return new Fb(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class ah extends ft{constructor(e=[],t=[],i=1,s=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:s};const r=[],o=[];a(s),c(i),u(),this.setAttribute("position",new st(r,3)),this.setAttribute("normal",new st(r.slice(),3)),this.setAttribute("uv",new st(o,2)),s===0?this.computeVertexNormals():this.normalizeNormals();function a(b){const y=new w,_=new w,E=new w;for(let M=0;M<t.length;M+=3)p(t[M+0],y),p(t[M+1],_),p(t[M+2],E),l(y,_,E,b)}function l(b,y,_,E){const M=E+1,I=[];for(let R=0;R<=M;R++){I[R]=[];const C=b.clone().lerp(_,R/M),T=y.clone().lerp(_,R/M),O=M-R;for(let J=0;J<=O;J++)J===0&&R===M?I[R][J]=C:I[R][J]=C.clone().lerp(T,J/O)}for(let R=0;R<M;R++)for(let C=0;C<2*(M-R)-1;C++){const T=Math.floor(C/2);C%2===0?(f(I[R][T+1]),f(I[R+1][T]),f(I[R][T])):(f(I[R][T+1]),f(I[R+1][T+1]),f(I[R+1][T]))}}function c(b){const y=new w;for(let _=0;_<r.length;_+=3)y.x=r[_+0],y.y=r[_+1],y.z=r[_+2],y.normalize().multiplyScalar(b),r[_+0]=y.x,r[_+1]=y.y,r[_+2]=y.z}function u(){const b=new w;for(let y=0;y<r.length;y+=3){b.x=r[y+0],b.y=r[y+1],b.z=r[y+2];const _=v(b)/2/Math.PI+.5,E=m(b)/Math.PI+.5;o.push(_,1-E)}g(),d()}function d(){for(let b=0;b<o.length;b+=6){const y=o[b+0],_=o[b+2],E=o[b+4],M=Math.max(y,_,E),I=Math.min(y,_,E);M>.9&&I<.1&&(y<.2&&(o[b+0]+=1),_<.2&&(o[b+2]+=1),E<.2&&(o[b+4]+=1))}}function f(b){r.push(b.x,b.y,b.z)}function p(b,y){const _=b*3;y.x=e[_+0],y.y=e[_+1],y.z=e[_+2]}function g(){const b=new w,y=new w,_=new w,E=new w,M=new te,I=new te,R=new te;for(let C=0,T=0;C<r.length;C+=9,T+=6){b.set(r[C+0],r[C+1],r[C+2]),y.set(r[C+3],r[C+4],r[C+5]),_.set(r[C+6],r[C+7],r[C+8]),M.set(o[T+0],o[T+1]),I.set(o[T+2],o[T+3]),R.set(o[T+4],o[T+5]),E.copy(b).add(y).add(_).divideScalar(3);const O=v(E);A(M,T+0,b,O),A(I,T+2,y,O),A(R,T+4,_,O)}}function A(b,y,_,E){E<0&&b.x===1&&(o[y]=b.x-1),_.x===0&&_.z===0&&(o[y]=E/2/Math.PI+.5)}function v(b){return Math.atan2(b.z,-b.x)}function m(b){return Math.atan2(-b.y,Math.sqrt(b.x*b.x+b.z*b.z))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new ah(e.vertices,e.indices,e.radius,e.details)}}class Ub extends ah{constructor(e=1,t=0){const i=(1+Math.sqrt(5))/2,s=1/i,r=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-s,-i,0,-s,i,0,s,-i,0,s,i,-s,-i,0,-s,i,0,s,-i,0,s,i,0,-i,0,-s,i,0,-s,-i,0,s,i,0,s],o=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(r,o,e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Ub(e.radius,e.detail)}}const vv=new w,yv=new w,Xx=new w,bv=new Vs;class vM extends ft{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},e!==null){const s=Math.pow(10,4),r=Math.cos(pu*t),o=e.getIndex(),a=e.getAttribute("position"),l=o?o.count:a.count,c=[0,0,0],u=["a","b","c"],d=new Array(3),f={},p=[];for(let g=0;g<l;g+=3){o?(c[0]=o.getX(g),c[1]=o.getX(g+1),c[2]=o.getX(g+2)):(c[0]=g,c[1]=g+1,c[2]=g+2);const{a:A,b:v,c:m}=bv;if(A.fromBufferAttribute(a,c[0]),v.fromBufferAttribute(a,c[1]),m.fromBufferAttribute(a,c[2]),bv.getNormal(Xx),d[0]=`${Math.round(A.x*s)},${Math.round(A.y*s)},${Math.round(A.z*s)}`,d[1]=`${Math.round(v.x*s)},${Math.round(v.y*s)},${Math.round(v.z*s)}`,d[2]=`${Math.round(m.x*s)},${Math.round(m.y*s)},${Math.round(m.z*s)}`,!(d[0]===d[1]||d[1]===d[2]||d[2]===d[0]))for(let b=0;b<3;b++){const y=(b+1)%3,_=d[b],E=d[y],M=bv[u[b]],I=bv[u[y]],R=`${_}_${E}`,C=`${E}_${_}`;C in f&&f[C]?(Xx.dot(f[C].normal)<=r&&(p.push(M.x,M.y,M.z),p.push(I.x,I.y,I.z)),f[C]=null):R in f||(f[R]={index0:c[b],index1:c[y],normal:Xx.clone()})}}for(const g in f)if(f[g]){const{index0:A,index1:v}=f[g];vv.fromBufferAttribute(a,A),yv.fromBufferAttribute(a,v),p.push(vv.x,vv.y,vv.z),p.push(yv.x,yv.y,yv.z)}this.setAttribute("position",new st(p,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}class gu extends vm{constructor(e){super(e),this.uuid=Lr(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let i=0,s=this.holes.length;i<s;i++)t[i]=this.holes[i].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){const s=e.holes[t];this.holes.push(s.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,i=this.holes.length;t<i;t++){const s=this.holes[t];e.holes.push(s.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){const s=e.holes[t];this.holes.push(new vm().fromJSON(s))}return this}}const U4={triangulate:function(n,e,t=2){const i=e&&e.length,s=i?e[0]*t:n.length;let r=Yk(n,0,s,t,!0);const o=[];if(!r||r.next===r.prev)return o;let a,l,c,u,d,f,p;if(i&&(r=H4(n,e,r,t)),n.length>80*t){a=c=n[0],l=u=n[1];for(let g=t;g<s;g+=t)d=n[g],f=n[g+1],d<a&&(a=d),f<l&&(l=f),d>c&&(c=d),f>u&&(u=f);p=Math.max(c-a,u-l),p=p!==0?32767/p:0}return ym(r,o,t,a,l,p,0),o}};function Yk(n,e,t,i,s){let r,o;if(s===e5(n,e,t,i)>0)for(r=e;r<t;r+=i)o=dR(r,n[r],n[r+1],o);else for(r=t-i;r>=e;r-=i)o=dR(r,n[r],n[r+1],o);return o&&Nb(o,o.next)&&(_m(o),o=o.next),o}function Cu(n,e){if(!n)return n;e||(e=n);let t=n,i;do if(i=!1,!t.steiner&&(Nb(t,t.next)||ji(t.prev,t,t.next)===0)){if(_m(t),t=e=t.prev,t===t.next)break;i=!0}else t=t.next;while(i||t!==e);return e}function ym(n,e,t,i,s,r,o){if(!n)return;!o&&r&&X4(n,i,s,r);let a=n,l,c;for(;n.prev!==n.next;){if(l=n.prev,c=n.next,r?z4(n,i,s,r):N4(n)){e.push(l.i/t|0),e.push(n.i/t|0),e.push(c.i/t|0),_m(n),n=c.next,a=c.next;continue}if(n=c,n===a){o?o===1?(n=G4(Cu(n),e,t),ym(n,e,t,i,s,r,2)):o===2&&V4(n,e,t,i,s,r):ym(Cu(n),e,t,i,s,r,1);break}}}function N4(n){const e=n.prev,t=n,i=n.next;if(ji(e,t,i)>=0)return!1;const s=e.x,r=t.x,o=i.x,a=e.y,l=t.y,c=i.y,u=s<r?s<o?s:o:r<o?r:o,d=a<l?a<c?a:c:l<c?l:c,f=s>r?s>o?s:o:r>o?r:o,p=a>l?a>c?a:c:l>c?l:c;let g=i.next;for(;g!==e;){if(g.x>=u&&g.x<=f&&g.y>=d&&g.y<=p&&Wd(s,a,r,l,o,c,g.x,g.y)&&ji(g.prev,g,g.next)>=0)return!1;g=g.next}return!0}function z4(n,e,t,i){const s=n.prev,r=n,o=n.next;if(ji(s,r,o)>=0)return!1;const a=s.x,l=r.x,c=o.x,u=s.y,d=r.y,f=o.y,p=a<l?a<c?a:c:l<c?l:c,g=u<d?u<f?u:f:d<f?d:f,A=a>l?a>c?a:c:l>c?l:c,v=u>d?u>f?u:f:d>f?d:f,m=iC(p,g,e,t,i),b=iC(A,v,e,t,i);let y=n.prevZ,_=n.nextZ;for(;y&&y.z>=m&&_&&_.z<=b;){if(y.x>=p&&y.x<=A&&y.y>=g&&y.y<=v&&y!==s&&y!==o&&Wd(a,u,l,d,c,f,y.x,y.y)&&ji(y.prev,y,y.next)>=0||(y=y.prevZ,_.x>=p&&_.x<=A&&_.y>=g&&_.y<=v&&_!==s&&_!==o&&Wd(a,u,l,d,c,f,_.x,_.y)&&ji(_.prev,_,_.next)>=0))return!1;_=_.nextZ}for(;y&&y.z>=m;){if(y.x>=p&&y.x<=A&&y.y>=g&&y.y<=v&&y!==s&&y!==o&&Wd(a,u,l,d,c,f,y.x,y.y)&&ji(y.prev,y,y.next)>=0)return!1;y=y.prevZ}for(;_&&_.z<=b;){if(_.x>=p&&_.x<=A&&_.y>=g&&_.y<=v&&_!==s&&_!==o&&Wd(a,u,l,d,c,f,_.x,_.y)&&ji(_.prev,_,_.next)>=0)return!1;_=_.nextZ}return!0}function G4(n,e,t){let i=n;do{const s=i.prev,r=i.next.next;!Nb(s,r)&&Jk(s,i,i.next,r)&&bm(s,r)&&bm(r,s)&&(e.push(s.i/t|0),e.push(i.i/t|0),e.push(r.i/t|0),_m(i),_m(i.next),i=n=r),i=i.next}while(i!==n);return Cu(i)}function V4(n,e,t,i,s,r){let o=n;do{let a=o.next.next;for(;a!==o.prev;){if(o.i!==a.i&&K4(o,a)){let l=Kk(o,a);o=Cu(o,o.next),l=Cu(l,l.next),ym(o,e,t,i,s,r,0),ym(l,e,t,i,s,r,0);return}a=a.next}o=o.next}while(o!==n)}function H4(n,e,t,i){const s=[];let r,o,a,l,c;for(r=0,o=e.length;r<o;r++)a=e[r]*i,l=r<o-1?e[r+1]*i:n.length,c=Yk(n,a,l,i,!1),c===c.next&&(c.steiner=!0),s.push(J4(c));for(s.sort(Q4),r=0;r<s.length;r++)t=W4(s[r],t);return t}function Q4(n,e){return n.x-e.x}function W4(n,e){const t=j4(n,e);if(!t)return e;const i=Kk(t,n);return Cu(i,i.next),Cu(t,t.next)}function j4(n,e){let t=e,i=-1/0,s;const r=n.x,o=n.y;do{if(o<=t.y&&o>=t.next.y&&t.next.y!==t.y){const f=t.x+(o-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(f<=r&&f>i&&(i=f,s=t.x<t.next.x?t:t.next,f===r))return s}t=t.next}while(t!==e);if(!s)return null;const a=s,l=s.x,c=s.y;let u=1/0,d;t=s;do r>=t.x&&t.x>=l&&r!==t.x&&Wd(o<c?r:i,o,l,c,o<c?i:r,o,t.x,t.y)&&(d=Math.abs(o-t.y)/(r-t.x),bm(t,n)&&(d<u||d===u&&(t.x>s.x||t.x===s.x&&q4(s,t)))&&(s=t,u=d)),t=t.next;while(t!==a);return s}function q4(n,e){return ji(n.prev,n,e.prev)<0&&ji(e.next,n,n.next)<0}function X4(n,e,t,i){let s=n;do s.z===0&&(s.z=iC(s.x,s.y,e,t,i)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==n);s.prevZ.nextZ=null,s.prevZ=null,Y4(s)}function Y4(n){let e,t,i,s,r,o,a,l,c=1;do{for(t=n,n=null,r=null,o=0;t;){for(o++,i=t,a=0,e=0;e<c&&(a++,i=i.nextZ,!!i);e++);for(l=c;a>0||l>0&&i;)a!==0&&(l===0||!i||t.z<=i.z)?(s=t,t=t.nextZ,a--):(s=i,i=i.nextZ,l--),r?r.nextZ=s:n=s,s.prevZ=r,r=s;t=i}r.nextZ=null,c*=2}while(o>1);return n}function iC(n,e,t,i,s){return n=(n-t)*s|0,e=(e-i)*s|0,n=(n|n<<8)&16711935,n=(n|n<<4)&252645135,n=(n|n<<2)&858993459,n=(n|n<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,n|e<<1}function J4(n){let e=n,t=n;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==n);return t}function Wd(n,e,t,i,s,r,o,a){return(s-o)*(e-a)>=(n-o)*(r-a)&&(n-o)*(i-a)>=(t-o)*(e-a)&&(t-o)*(r-a)>=(s-o)*(i-a)}function K4(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!Z4(n,e)&&(bm(n,e)&&bm(e,n)&&$4(n,e)&&(ji(n.prev,n,e.prev)||ji(n,e.prev,e))||Nb(n,e)&&ji(n.prev,n,n.next)>0&&ji(e.prev,e,e.next)>0)}function ji(n,e,t){return(e.y-n.y)*(t.x-e.x)-(e.x-n.x)*(t.y-e.y)}function Nb(n,e){return n.x===e.x&&n.y===e.y}function Jk(n,e,t,i){const s=xv(ji(n,e,t)),r=xv(ji(n,e,i)),o=xv(ji(t,i,n)),a=xv(ji(t,i,e));return!!(s!==r&&o!==a||s===0&&_v(n,t,e)||r===0&&_v(n,i,e)||o===0&&_v(t,n,i)||a===0&&_v(t,e,i))}function _v(n,e,t){return e.x<=Math.max(n.x,t.x)&&e.x>=Math.min(n.x,t.x)&&e.y<=Math.max(n.y,t.y)&&e.y>=Math.min(n.y,t.y)}function xv(n){return n>0?1:n<0?-1:0}function Z4(n,e){let t=n;do{if(t.i!==n.i&&t.next.i!==n.i&&t.i!==e.i&&t.next.i!==e.i&&Jk(t,t.next,n,e))return!0;t=t.next}while(t!==n);return!1}function bm(n,e){return ji(n.prev,n,n.next)<0?ji(n,e,n.next)>=0&&ji(n,n.prev,e)>=0:ji(n,e,n.prev)<0||ji(n,n.next,e)<0}function $4(n,e){let t=n,i=!1;const s=(n.x+e.x)/2,r=(n.y+e.y)/2;do t.y>r!=t.next.y>r&&t.next.y!==t.y&&s<(t.next.x-t.x)*(r-t.y)/(t.next.y-t.y)+t.x&&(i=!i),t=t.next;while(t!==n);return i}function Kk(n,e){const t=new nC(n.i,n.x,n.y),i=new nC(e.i,e.x,e.y),s=n.next,r=e.prev;return n.next=e,e.prev=n,t.next=s,s.prev=t,i.next=t,t.prev=i,r.next=i,i.prev=r,i}function dR(n,e,t,i){const s=new nC(n,e,t);return i?(s.next=i.next,s.prev=i,i.next.prev=s,i.next=s):(s.prev=s,s.next=s),s}function _m(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function nC(n,e,t){this.i=n,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function e5(n,e,t,i){let s=0;for(let r=e,o=t-i;r<t;r+=i)s+=(n[o]-n[r])*(n[r+1]+n[o+1]),o=r;return s}class La{static area(e){const t=e.length;let i=0;for(let s=t-1,r=0;r<t;s=r++)i+=e[s].x*e[r].y-e[r].x*e[s].y;return i*.5}static isClockWise(e){return La.area(e)<0}static triangulateShape(e,t){const i=[],s=[],r=[];fR(e),pR(i,e);let o=e.length;t.forEach(fR);for(let l=0;l<t.length;l++)s.push(o),o+=t[l].length,pR(i,t[l]);const a=U4.triangulate(i,s);for(let l=0;l<a.length;l+=3)r.push(a.slice(l,l+3));return r}}function fR(n){const e=n.length;e>2&&n[e-1].equals(n[0])&&n.pop()}function pR(n,e){for(let t=0;t<e.length;t++)n.push(e[t].x),n.push(e[t].y)}class zb extends ft{constructor(e=new gu([new te(.5,.5),new te(-.5,.5),new te(-.5,-.5),new te(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const i=this,s=[],r=[];for(let a=0,l=e.length;a<l;a++){const c=e[a];o(c)}this.setAttribute("position",new st(s,3)),this.setAttribute("uv",new st(r,2)),this.computeVertexNormals();function o(a){const l=[],c=t.curveSegments!==void 0?t.curveSegments:12,u=t.steps!==void 0?t.steps:1,d=t.depth!==void 0?t.depth:1;let f=t.bevelEnabled!==void 0?t.bevelEnabled:!0,p=t.bevelThickness!==void 0?t.bevelThickness:.2,g=t.bevelSize!==void 0?t.bevelSize:p-.1,A=t.bevelOffset!==void 0?t.bevelOffset:0,v=t.bevelSegments!==void 0?t.bevelSegments:3;const m=t.extrudePath,b=t.UVGenerator!==void 0?t.UVGenerator:t5;let y,_=!1,E,M,I,R;m&&(y=m.getSpacedPoints(u),_=!0,f=!1,E=m.computeFrenetFrames(u,!1),M=new w,I=new w,R=new w),f||(v=0,p=0,g=0,A=0);const C=a.extractPoints(c);let T=C.shape;const O=C.holes;if(!La.isClockWise(T)){T=T.reverse();for(let W=0,Le=O.length;W<Le;W++){const me=O[W];La.isClockWise(me)&&(O[W]=me.reverse())}}const V=La.triangulateShape(T,O),H=T;for(let W=0,Le=O.length;W<Le;W++){const me=O[W];T=T.concat(me)}function Y(W,Le,me){return Le||console.error("THREE.ExtrudeGeometry: vec does not exist"),W.clone().addScaledVector(Le,me)}const N=T.length,L=V.length;function G(W,Le,me){let ke,we,Ze;const We=W.x-Le.x,qe=W.y-Le.y,pt=me.x-W.x,wt=me.y-W.y,Qt=We*We+qe*qe,z=We*wt-qe*pt;if(Math.abs(z)>Number.EPSILON){const k=Math.sqrt(Qt),he=Math.sqrt(pt*pt+wt*wt),Re=Le.x-qe/k,Pe=Le.y+We/k,Fe=me.x-wt/he,X=me.y+pt/he,de=((Fe-Re)*wt-(X-Pe)*pt)/(We*wt-qe*pt);ke=Re+We*de-W.x,we=Pe+qe*de-W.y;const le=ke*ke+we*we;if(le<=2)return new te(ke,we);Ze=Math.sqrt(le/2)}else{let k=!1;We>Number.EPSILON?pt>Number.EPSILON&&(k=!0):We<-Number.EPSILON?pt<-Number.EPSILON&&(k=!0):Math.sign(qe)===Math.sign(wt)&&(k=!0),k?(ke=-qe,we=We,Ze=Math.sqrt(Qt)):(ke=We,we=qe,Ze=Math.sqrt(Qt/2))}return new te(ke/Ze,we/Ze)}const ee=[];for(let W=0,Le=H.length,me=Le-1,ke=W+1;W<Le;W++,me++,ke++)me===Le&&(me=0),ke===Le&&(ke=0),ee[W]=G(H[W],H[me],H[ke]);const $=[];let j,ie=ee.concat();for(let W=0,Le=O.length;W<Le;W++){const me=O[W];j=[];for(let ke=0,we=me.length,Ze=we-1,We=ke+1;ke<we;ke++,Ze++,We++)Ze===we&&(Ze=0),We===we&&(We=0),j[ke]=G(me[ke],me[Ze],me[We]);$.push(j),ie=ie.concat(j)}for(let W=0;W<v;W++){const Le=W/v,me=p*Math.cos(Le*Math.PI/2),ke=g*Math.sin(Le*Math.PI/2)+A;for(let we=0,Ze=H.length;we<Ze;we++){const We=Y(H[we],ee[we],ke);Ne(We.x,We.y,-me)}for(let we=0,Ze=O.length;we<Ze;we++){const We=O[we];j=$[we];for(let qe=0,pt=We.length;qe<pt;qe++){const wt=Y(We[qe],j[qe],ke);Ne(wt.x,wt.y,-me)}}}const Ae=g+A;for(let W=0;W<N;W++){const Le=f?Y(T[W],ie[W],Ae):T[W];_?(I.copy(E.normals[0]).multiplyScalar(Le.x),M.copy(E.binormals[0]).multiplyScalar(Le.y),R.copy(y[0]).add(I).add(M),Ne(R.x,R.y,R.z)):Ne(Le.x,Le.y,0)}for(let W=1;W<=u;W++)for(let Le=0;Le<N;Le++){const me=f?Y(T[Le],ie[Le],Ae):T[Le];_?(I.copy(E.normals[W]).multiplyScalar(me.x),M.copy(E.binormals[W]).multiplyScalar(me.y),R.copy(y[W]).add(I).add(M),Ne(R.x,R.y,R.z)):Ne(me.x,me.y,d/u*W)}for(let W=v-1;W>=0;W--){const Le=W/v,me=p*Math.cos(Le*Math.PI/2),ke=g*Math.sin(Le*Math.PI/2)+A;for(let we=0,Ze=H.length;we<Ze;we++){const We=Y(H[we],ee[we],ke);Ne(We.x,We.y,d+me)}for(let we=0,Ze=O.length;we<Ze;we++){const We=O[we];j=$[we];for(let qe=0,pt=We.length;qe<pt;qe++){const wt=Y(We[qe],j[qe],ke);_?Ne(wt.x,wt.y+y[u-1].y,y[u-1].x+me):Ne(wt.x,wt.y,d+me)}}}ge(),Ce();function ge(){const W=s.length/3;if(f){let Le=0,me=N*Le;for(let ke=0;ke<L;ke++){const we=V[ke];Ve(we[2]+me,we[1]+me,we[0]+me)}Le=u+v*2,me=N*Le;for(let ke=0;ke<L;ke++){const we=V[ke];Ve(we[0]+me,we[1]+me,we[2]+me)}}else{for(let Le=0;Le<L;Le++){const me=V[Le];Ve(me[2],me[1],me[0])}for(let Le=0;Le<L;Le++){const me=V[Le];Ve(me[0]+N*u,me[1]+N*u,me[2]+N*u)}}i.addGroup(W,s.length/3-W,0)}function Ce(){const W=s.length/3;let Le=0;Ee(H,Le),Le+=H.length;for(let me=0,ke=O.length;me<ke;me++){const we=O[me];Ee(we,Le),Le+=we.length}i.addGroup(W,s.length/3-W,1)}function Ee(W,Le){let me=W.length;for(;--me>=0;){const ke=me;let we=me-1;we<0&&(we=W.length-1);for(let Ze=0,We=u+v*2;Ze<We;Ze++){const qe=N*Ze,pt=N*(Ze+1),wt=Le+ke+qe,Qt=Le+we+qe,z=Le+we+pt,k=Le+ke+pt;lt(wt,Qt,z,k)}}}function Ne(W,Le,me){l.push(W),l.push(Le),l.push(me)}function Ve(W,Le,me){xt(W),xt(Le),xt(me);const ke=s.length/3,we=b.generateTopUV(i,s,ke-3,ke-2,ke-1);et(we[0]),et(we[1]),et(we[2])}function lt(W,Le,me,ke){xt(W),xt(Le),xt(ke),xt(Le),xt(me),xt(ke);const we=s.length/3,Ze=b.generateSideWallUV(i,s,we-6,we-3,we-2,we-1);et(Ze[0]),et(Ze[1]),et(Ze[3]),et(Ze[1]),et(Ze[2]),et(Ze[3])}function xt(W){s.push(l[W*3+0]),s.push(l[W*3+1]),s.push(l[W*3+2])}function et(W){r.push(W.x),r.push(W.y)}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),t=this.parameters.shapes,i=this.parameters.options;return i5(t,i,e)}static fromJSON(e,t){const i=[];for(let r=0,o=e.shapes.length;r<o;r++){const a=t[e.shapes[r]];i.push(a)}const s=e.options.extrudePath;return s!==void 0&&(e.options.extrudePath=new AM[s.type]().fromJSON(s)),new zb(i,e.options)}}const t5={generateTopUV:function(n,e,t,i,s){const r=e[t*3],o=e[t*3+1],a=e[i*3],l=e[i*3+1],c=e[s*3],u=e[s*3+1];return[new te(r,o),new te(a,l),new te(c,u)]},generateSideWallUV:function(n,e,t,i,s,r){const o=e[t*3],a=e[t*3+1],l=e[t*3+2],c=e[i*3],u=e[i*3+1],d=e[i*3+2],f=e[s*3],p=e[s*3+1],g=e[s*3+2],A=e[r*3],v=e[r*3+1],m=e[r*3+2];return Math.abs(a-u)<Math.abs(o-c)?[new te(o,1-l),new te(c,1-d),new te(f,1-g),new te(A,1-m)]:[new te(a,1-l),new te(u,1-d),new te(p,1-g),new te(v,1-m)]}};function i5(n,e,t){if(t.shapes=[],Array.isArray(n))for(let i=0,s=n.length;i<s;i++){const r=n[i];t.shapes.push(r.uuid)}else t.shapes.push(n.uuid);return t.options=Object.assign({},e),e.extrudePath!==void 0&&(t.options.extrudePath=e.extrudePath.toJSON()),t}class iA extends ah{constructor(e=1,t=0){const i=(1+Math.sqrt(5))/2,s=[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],r=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(s,r,e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new iA(e.radius,e.detail)}}class Cl extends ah{constructor(e=1,t=0){const i=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],s=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(i,s,e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Cl(e.radius,e.detail)}}class nA extends ft{constructor(e=.5,t=1,i=32,s=1,r=0,o=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:i,phiSegments:s,thetaStart:r,thetaLength:o},i=Math.max(3,i),s=Math.max(1,s);const a=[],l=[],c=[],u=[];let d=e;const f=(t-e)/s,p=new w,g=new te;for(let A=0;A<=s;A++){for(let v=0;v<=i;v++){const m=r+v/i*o;p.x=d*Math.cos(m),p.y=d*Math.sin(m),l.push(p.x,p.y,p.z),c.push(0,0,1),g.x=(p.x/t+1)/2,g.y=(p.y/t+1)/2,u.push(g.x,g.y)}d+=f}for(let A=0;A<s;A++){const v=A*(i+1);for(let m=0;m<i;m++){const b=m+v,y=b,_=b+i+1,E=b+i+2,M=b+1;a.push(y,_,M),a.push(_,E,M)}}this.setIndex(a),this.setAttribute("position",new st(l,3)),this.setAttribute("normal",new st(c,3)),this.setAttribute("uv",new st(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new nA(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class Gb extends ft{constructor(e=new gu([new te(0,.5),new te(-.5,-.5),new te(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const i=[],s=[],r=[],o=[];let a=0,l=0;if(Array.isArray(e)===!1)c(e);else for(let u=0;u<e.length;u++)c(e[u]),this.addGroup(a,l,u),a+=l,l=0;this.setIndex(i),this.setAttribute("position",new st(s,3)),this.setAttribute("normal",new st(r,3)),this.setAttribute("uv",new st(o,2));function c(u){const d=s.length/3,f=u.extractPoints(t);let p=f.shape;const g=f.holes;La.isClockWise(p)===!1&&(p=p.reverse());for(let v=0,m=g.length;v<m;v++){const b=g[v];La.isClockWise(b)===!0&&(g[v]=b.reverse())}const A=La.triangulateShape(p,g);for(let v=0,m=g.length;v<m;v++){const b=g[v];p=p.concat(b)}for(let v=0,m=p.length;v<m;v++){const b=p[v];s.push(b.x,b.y,0),r.push(0,0,1),o.push(b.x,b.y)}for(let v=0,m=A.length;v<m;v++){const b=A[v],y=b[0]+d,_=b[1]+d,E=b[2]+d;i.push(y,_,E),l+=3}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),t=this.parameters.shapes;return n5(t,e)}static fromJSON(e,t){const i=[];for(let s=0,r=e.shapes.length;s<r;s++){const o=t[e.shapes[s]];i.push(o)}return new Gb(i,e.curveSegments)}}function n5(n,e){if(e.shapes=[],Array.isArray(n))for(let t=0,i=n.length;t<i;t++){const s=n[t];e.shapes.push(s.uuid)}else e.shapes.push(n.uuid);return e}class So extends ft{constructor(e=1,t=32,i=16,s=0,r=Math.PI*2,o=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:s,phiLength:r,thetaStart:o,thetaLength:a},t=Math.max(3,Math.floor(t)),i=Math.max(2,Math.floor(i));const l=Math.min(o+a,Math.PI);let c=0;const u=[],d=new w,f=new w,p=[],g=[],A=[],v=[];for(let m=0;m<=i;m++){const b=[],y=m/i;let _=0;m===0&&o===0?_=.5/t:m===i&&l===Math.PI&&(_=-.5/t);for(let E=0;E<=t;E++){const M=E/t;d.x=-e*Math.cos(s+M*r)*Math.sin(o+y*a),d.y=e*Math.cos(o+y*a),d.z=e*Math.sin(s+M*r)*Math.sin(o+y*a),g.push(d.x,d.y,d.z),f.copy(d).normalize(),A.push(f.x,f.y,f.z),v.push(M+_,1-y),b.push(c++)}u.push(b)}for(let m=0;m<i;m++)for(let b=0;b<t;b++){const y=u[m][b+1],_=u[m][b],E=u[m+1][b],M=u[m+1][b+1];(m!==0||o>0)&&p.push(y,_,M),(m!==i-1||l<Math.PI)&&p.push(_,E,M)}this.setIndex(p),this.setAttribute("position",new st(g,3)),this.setAttribute("normal",new st(A,3)),this.setAttribute("uv",new st(v,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new So(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class Vb extends ah{constructor(e=1,t=0){const i=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],s=[2,1,0,0,3,2,1,3,0,2,3,1];super(i,s,e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Vb(e.radius,e.detail)}}class bl extends ft{constructor(e=1,t=.4,i=12,s=48,r=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:s,arc:r},i=Math.floor(i),s=Math.floor(s);const o=[],a=[],l=[],c=[],u=new w,d=new w,f=new w;for(let p=0;p<=i;p++)for(let g=0;g<=s;g++){const A=g/s*r,v=p/i*Math.PI*2;d.x=(e+t*Math.cos(v))*Math.cos(A),d.y=(e+t*Math.cos(v))*Math.sin(A),d.z=t*Math.sin(v),a.push(d.x,d.y,d.z),u.x=e*Math.cos(A),u.y=e*Math.sin(A),f.subVectors(d,u).normalize(),l.push(f.x,f.y,f.z),c.push(g/s),c.push(p/i)}for(let p=1;p<=i;p++)for(let g=1;g<=s;g++){const A=(s+1)*p+g-1,v=(s+1)*(p-1)+g-1,m=(s+1)*(p-1)+g,b=(s+1)*p+g;o.push(A,v,b),o.push(v,m,b)}this.setIndex(o),this.setAttribute("position",new st(a,3)),this.setAttribute("normal",new st(l,3)),this.setAttribute("uv",new st(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new bl(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class Hb extends ft{constructor(e=1,t=.4,i=64,s=8,r=2,o=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:s,p:r,q:o},i=Math.floor(i),s=Math.floor(s);const a=[],l=[],c=[],u=[],d=new w,f=new w,p=new w,g=new w,A=new w,v=new w,m=new w;for(let y=0;y<=i;++y){const _=y/i*r*Math.PI*2;b(_,r,o,e,p),b(_+.01,r,o,e,g),v.subVectors(g,p),m.addVectors(g,p),A.crossVectors(v,m),m.crossVectors(A,v),A.normalize(),m.normalize();for(let E=0;E<=s;++E){const M=E/s*Math.PI*2,I=-t*Math.cos(M),R=t*Math.sin(M);d.x=p.x+(I*m.x+R*A.x),d.y=p.y+(I*m.y+R*A.y),d.z=p.z+(I*m.z+R*A.z),l.push(d.x,d.y,d.z),f.subVectors(d,p).normalize(),c.push(f.x,f.y,f.z),u.push(y/i),u.push(E/s)}}for(let y=1;y<=i;y++)for(let _=1;_<=s;_++){const E=(s+1)*(y-1)+(_-1),M=(s+1)*y+(_-1),I=(s+1)*y+_,R=(s+1)*(y-1)+_;a.push(E,M,R),a.push(M,I,R)}this.setIndex(a),this.setAttribute("position",new st(l,3)),this.setAttribute("normal",new st(c,3)),this.setAttribute("uv",new st(u,2));function b(y,_,E,M,I){const R=Math.cos(y),C=Math.sin(y),T=E/_*y,O=Math.cos(T);I.x=M*(2+O)*.5*R,I.y=M*(2+O)*C*.5,I.z=M*Math.sin(T)*.5}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Hb(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class Qb extends ft{constructor(e=new gM(new w(-1,-1,0),new w(-1,1,0),new w(1,1,0)),t=64,i=1,s=8,r=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:i,radialSegments:s,closed:r};const o=e.computeFrenetFrames(t,r);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;const a=new w,l=new w,c=new te;let u=new w;const d=[],f=[],p=[],g=[];A(),this.setIndex(g),this.setAttribute("position",new st(d,3)),this.setAttribute("normal",new st(f,3)),this.setAttribute("uv",new st(p,2));function A(){for(let y=0;y<t;y++)v(y);v(r===!1?t:0),b(),m()}function v(y){u=e.getPointAt(y/t,u);const _=o.normals[y],E=o.binormals[y];for(let M=0;M<=s;M++){const I=M/s*Math.PI*2,R=Math.sin(I),C=-Math.cos(I);l.x=C*_.x+R*E.x,l.y=C*_.y+R*E.y,l.z=C*_.z+R*E.z,l.normalize(),f.push(l.x,l.y,l.z),a.x=u.x+i*l.x,a.y=u.y+i*l.y,a.z=u.z+i*l.z,d.push(a.x,a.y,a.z)}}function m(){for(let y=1;y<=t;y++)for(let _=1;_<=s;_++){const E=(s+1)*(y-1)+(_-1),M=(s+1)*y+(_-1),I=(s+1)*y+_,R=(s+1)*(y-1)+_;g.push(E,M,R),g.push(M,I,R)}}function b(){for(let y=0;y<=t;y++)for(let _=0;_<=s;_++)c.x=y/t,c.y=_/s,p.push(c.x,c.y)}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new Qb(new AM[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class Zk extends ft{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},e!==null){const t=[],i=new Set,s=new w,r=new w;if(e.index!==null){const o=e.attributes.position,a=e.index;let l=e.groups;l.length===0&&(l=[{start:0,count:a.count,materialIndex:0}]);for(let c=0,u=l.length;c<u;++c){const d=l[c],f=d.start,p=d.count;for(let g=f,A=f+p;g<A;g+=3)for(let v=0;v<3;v++){const m=a.getX(g+v),b=a.getX(g+(v+1)%3);s.fromBufferAttribute(o,m),r.fromBufferAttribute(o,b),gR(s,r,i)===!0&&(t.push(s.x,s.y,s.z),t.push(r.x,r.y,r.z))}}}else{const o=e.attributes.position;for(let a=0,l=o.count/3;a<l;a++)for(let c=0;c<3;c++){const u=3*a+c,d=3*a+(c+1)%3;s.fromBufferAttribute(o,u),r.fromBufferAttribute(o,d),gR(s,r,i)===!0&&(t.push(s.x,s.y,s.z),t.push(r.x,r.y,r.z))}}this.setAttribute("position",new st(t,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function gR(n,e,t){const i=`${n.x},${n.y},${n.z}-${e.x},${e.y},${e.z}`,s=`${e.x},${e.y},${e.z}-${n.x},${n.y},${n.z}`;return t.has(i)===!0||t.has(s)===!0?!1:(t.add(i),t.add(s),!0)}var mR=Object.freeze({__proto__:null,BoxGeometry:Ei,CapsuleGeometry:kb,CircleGeometry:Lb,ConeGeometry:Fb,CylinderGeometry:cn,DodecahedronGeometry:Ub,EdgesGeometry:vM,ExtrudeGeometry:zb,IcosahedronGeometry:iA,LatheGeometry:tA,OctahedronGeometry:Cl,PlaneGeometry:us,PolyhedronGeometry:ah,RingGeometry:nA,ShapeGeometry:Gb,SphereGeometry:So,TetrahedronGeometry:Vb,TorusGeometry:bl,TorusKnotGeometry:Hb,TubeGeometry:Qb,WireframeGeometry:Zk});class Wb extends Pt{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new _e(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class jb extends Bt{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class Yo extends Pt{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new _e(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new _e(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=sh,this.normalScale=new te(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class bo extends Yo{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new te(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return nn(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new _e(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new _e(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new _e(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class $k extends Pt{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new _e(16777215),this.specular=new _e(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new _e(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=sh,this.normalScale=new te(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Ym,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class eL extends Pt{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new _e(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new _e(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=sh,this.normalScale=new te(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class yM extends Pt{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=sh,this.normalScale=new te(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class tL extends Pt{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new _e(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new _e(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=sh,this.normalScale=new te(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Ym,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class iL extends Pt{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new _e(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=sh,this.normalScale=new te(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class nL extends Sn{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function ho(n,e,t){return bM(n)?new n.constructor(n.subarray(e,t!==void 0?t:n.length)):n.slice(e,t)}function ou(n,e,t){return!n||!t&&n.constructor===e?n:typeof e.BYTES_PER_ELEMENT=="number"?new e(n):Array.prototype.slice.call(n)}function bM(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function sL(n){function e(s,r){return n[s]-n[r]}const t=n.length,i=new Array(t);for(let s=0;s!==t;++s)i[s]=s;return i.sort(e),i}function sC(n,e,t){const i=n.length,s=new n.constructor(i);for(let r=0,o=0;o!==i;++r){const a=t[r]*e;for(let l=0;l!==e;++l)s[o++]=n[a+l]}return s}function _M(n,e,t,i){let s=1,r=n[0];for(;r!==void 0&&r[i]===void 0;)r=n[s++];if(r===void 0)return;let o=r[i];if(o!==void 0)if(Array.isArray(o))do o=r[i],o!==void 0&&(e.push(r.time),t.push.apply(t,o)),r=n[s++];while(r!==void 0);else if(o.toArray!==void 0)do o=r[i],o!==void 0&&(e.push(r.time),o.toArray(t,t.length)),r=n[s++];while(r!==void 0);else do o=r[i],o!==void 0&&(e.push(r.time),t.push(o)),r=n[s++];while(r!==void 0)}function s5(n,e,t,i,s=30){const r=n.clone();r.name=e;const o=[];for(let l=0;l<r.tracks.length;++l){const c=r.tracks[l],u=c.getValueSize(),d=[],f=[];for(let p=0;p<c.times.length;++p){const g=c.times[p]*s;if(!(g<t||g>=i)){d.push(c.times[p]);for(let A=0;A<u;++A)f.push(c.values[p*u+A])}}d.length!==0&&(c.times=ou(d,c.times.constructor),c.values=ou(f,c.values.constructor),o.push(c))}r.tracks=o;let a=1/0;for(let l=0;l<r.tracks.length;++l)a>r.tracks[l].times[0]&&(a=r.tracks[l].times[0]);for(let l=0;l<r.tracks.length;++l)r.tracks[l].shift(-1*a);return r.resetDuration(),r}function r5(n,e=0,t=n,i=30){i<=0&&(i=30);const s=t.tracks.length,r=e/i;for(let o=0;o<s;++o){const a=t.tracks[o],l=a.ValueTypeName;if(l==="bool"||l==="string")continue;const c=n.tracks.find(function(m){return m.name===a.name&&m.ValueTypeName===l});if(c===void 0)continue;let u=0;const d=a.getValueSize();a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(u=d/3);let f=0;const p=c.getValueSize();c.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(f=p/3);const g=a.times.length-1;let A;if(r<=a.times[0]){const m=u,b=d-u;A=ho(a.values,m,b)}else if(r>=a.times[g]){const m=g*d+u,b=m+d-u;A=ho(a.values,m,b)}else{const m=a.createInterpolant(),b=u,y=d-u;m.evaluate(r),A=ho(m.resultBuffer,b,y)}l==="quaternion"&&new Se().fromArray(A).normalize().conjugate().toArray(A);const v=c.times.length;for(let m=0;m<v;++m){const b=m*p+f;if(l==="quaternion")Se.multiplyQuaternionsFlat(c.values,b,A,0,c.values,b);else{const y=p-f*2;for(let _=0;_<y;++_)c.values[b+_]-=A[_]}}}return n.blendMode=JE,n}const o5={arraySlice:ho,convertArray:ou,isTypedArray:bM,getKeyframeOrder:sL,sortedArray:sC,flattenJSON:_M,subclip:s5,makeClipAdditive:r5};class Kf{constructor(e,t,i,s){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=s!==void 0?s:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let i=this._cachedIndex,s=t[i],r=t[i-1];e:{t:{let o;i:{n:if(!(e<s)){for(let a=i+2;;){if(s===void 0){if(e<r)break n;return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===a)break;if(r=s,s=t[++i],e<s)break t}o=t.length;break i}if(!(e>=r)){const a=t[1];e<a&&(i=2,r=a);for(let l=i-2;;){if(r===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===l)break;if(s=r,r=t[--i-1],e>=r)break t}o=i,i=0;break i}break e}for(;i<o;){const a=i+o>>>1;e<t[a]?o=a:i=a+1}if(s=t[i],r=t[i-1],r===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(s===void 0)return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,r,s)}return this.interpolate_(i,r,e,s)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,s=this.valueSize,r=e*s;for(let o=0;o!==s;++o)t[o]=i[r+o];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class rL extends Kf{constructor(e,t,i,s){super(e,t,i,s),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:nu,endingEnd:nu}}intervalChanged_(e,t,i){const s=this.parameterPositions;let r=e-2,o=e+1,a=s[r],l=s[o];if(a===void 0)switch(this.getSettings_().endingStart){case su:r=e,a=2*t-i;break;case pm:r=s.length-2,a=t+s[r]-s[r+1];break;default:r=e,a=i}if(l===void 0)switch(this.getSettings_().endingEnd){case su:o=e,l=2*i-t;break;case pm:o=1,l=i+s[1]-s[0];break;default:o=e-1,l=t}const c=(i-t)*.5,u=this.valueSize;this._weightPrev=c/(t-a),this._weightNext=c/(l-i),this._offsetPrev=r*u,this._offsetNext=o*u}interpolate_(e,t,i,s){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=e*a,c=l-a,u=this._offsetPrev,d=this._offsetNext,f=this._weightPrev,p=this._weightNext,g=(i-t)/(s-t),A=g*g,v=A*g,m=-f*v+2*f*A-f*g,b=(1+f)*v+(-1.5-2*f)*A+(-.5+f)*g+1,y=(-1-p)*v+(1.5+p)*A+.5*g,_=p*v-p*A;for(let E=0;E!==a;++E)r[E]=m*o[u+E]+b*o[c+E]+y*o[l+E]+_*o[d+E];return r}}class xM extends Kf{constructor(e,t,i,s){super(e,t,i,s)}interpolate_(e,t,i,s){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=e*a,c=l-a,u=(i-t)/(s-t),d=1-u;for(let f=0;f!==a;++f)r[f]=o[c+f]*d+o[l+f]*u;return r}}class oL extends Kf{constructor(e,t,i,s){super(e,t,i,s)}interpolate_(e){return this.copySampleValue_(e-1)}}class dr{constructor(e,t,i,s){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=ou(t,this.TimeBufferType),this.values=ou(i,this.ValueBufferType),this.setInterpolation(s||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let i;if(t.toJSON!==this.toJSON)i=t.toJSON(e);else{i={name:e.name,times:ou(e.times,Array),values:ou(e.values,Array)};const s=e.getInterpolation();s!==e.DefaultInterpolation&&(i.interpolation=s)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new oL(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new xM(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new rL(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case Su:t=this.InterpolantFactoryMethodDiscrete;break;case Jc:t=this.InterpolantFactoryMethodLinear;break;case wy:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){const i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(i);return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Su;case this.InterpolantFactoryMethodLinear:return Jc;case this.InterpolantFactoryMethodSmooth:return wy}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const t=this.times;for(let i=0,s=t.length;i!==s;++i)t[i]+=e}return this}scale(e){if(e!==1){const t=this.times;for(let i=0,s=t.length;i!==s;++i)t[i]*=e}return this}trim(e,t){const i=this.times,s=i.length;let r=0,o=s-1;for(;r!==s&&i[r]<e;)++r;for(;o!==-1&&i[o]>t;)--o;if(++o,r!==0||o!==s){r>=o&&(o=Math.max(o,1),r=o-1);const a=this.getValueSize();this.times=ho(i,r,o),this.values=ho(this.values,r*a,o*a)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const i=this.times,s=this.values,r=i.length;r===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let a=0;a!==r;a++){const l=i[a];if(typeof l=="number"&&isNaN(l)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,l),e=!1;break}if(o!==null&&o>l){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,l,o),e=!1;break}o=l}if(s!==void 0&&bM(s))for(let a=0,l=s.length;a!==l;++a){const c=s[a];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,c),e=!1;break}}return e}optimize(){const e=ho(this.times),t=ho(this.values),i=this.getValueSize(),s=this.getInterpolation()===wy,r=e.length-1;let o=1;for(let a=1;a<r;++a){let l=!1;const c=e[a],u=e[a+1];if(c!==u&&(a!==1||c!==e[0]))if(s)l=!0;else{const d=a*i,f=d-i,p=d+i;for(let g=0;g!==i;++g){const A=t[d+g];if(A!==t[f+g]||A!==t[p+g]){l=!0;break}}}if(l){if(a!==o){e[o]=e[a];const d=a*i,f=o*i;for(let p=0;p!==i;++p)t[f+p]=t[d+p]}++o}}if(r>0){e[o]=e[r];for(let a=r*i,l=o*i,c=0;c!==i;++c)t[l+c]=t[a+c];++o}return o!==e.length?(this.times=ho(e,0,o),this.values=ho(t,0,o*i)):(this.times=e,this.values=t),this}clone(){const e=ho(this.times,0),t=ho(this.values,0),i=this.constructor,s=new i(this.name,e,t);return s.createInterpolant=this.createInterpolant,s}}dr.prototype.TimeBufferType=Float32Array;dr.prototype.ValueBufferType=Float32Array;dr.prototype.DefaultInterpolation=Jc;class Lu extends dr{}Lu.prototype.ValueTypeName="bool";Lu.prototype.ValueBufferType=Array;Lu.prototype.DefaultInterpolation=Su;Lu.prototype.InterpolantFactoryMethodLinear=void 0;Lu.prototype.InterpolantFactoryMethodSmooth=void 0;class wM extends dr{}wM.prototype.ValueTypeName="color";class Eu extends dr{}Eu.prototype.ValueTypeName="number";class aL extends Kf{constructor(e,t,i,s){super(e,t,i,s)}interpolate_(e,t,i,s){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=(i-t)/(s-t);let c=e*a;for(let u=c+a;c!==u;c+=4)Se.slerpFlat(r,0,o,c-a,o,c,l);return r}}class Vl extends dr{InterpolantFactoryMethodLinear(e){return new aL(this.times,this.values,this.getValueSize(),e)}}Vl.prototype.ValueTypeName="quaternion";Vl.prototype.DefaultInterpolation=Jc;Vl.prototype.InterpolantFactoryMethodSmooth=void 0;class Fu extends dr{}Fu.prototype.ValueTypeName="string";Fu.prototype.ValueBufferType=Array;Fu.prototype.DefaultInterpolation=Su;Fu.prototype.InterpolantFactoryMethodLinear=void 0;Fu.prototype.InterpolantFactoryMethodSmooth=void 0;class Kc extends dr{}Kc.prototype.ValueTypeName="vector";class fr{constructor(e,t=-1,i,s=bb){this.name=e,this.tracks=i,this.duration=t,this.blendMode=s,this.uuid=Lr(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],i=e.tracks,s=1/(e.fps||1);for(let o=0,a=i.length;o!==a;++o)t.push(l5(i[o]).scale(s));const r=new this(e.name,e.duration,t,e.blendMode);return r.uuid=e.uuid,r}static toJSON(e){const t=[],i=e.tracks,s={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let r=0,o=i.length;r!==o;++r)t.push(dr.toJSON(i[r]));return s}static CreateFromMorphTargetSequence(e,t,i,s){const r=t.length,o=[];for(let a=0;a<r;a++){let l=[],c=[];l.push((a+r-1)%r,a,(a+1)%r),c.push(0,1,0);const u=sL(l);l=sC(l,1,u),c=sC(c,1,u),!s&&l[0]===0&&(l.push(r),c.push(c[0])),o.push(new Eu(".morphTargetInfluences["+t[a].name+"]",l,c).scale(1/i))}return new this(e,-1,o)}static findByName(e,t){let i=e;if(!Array.isArray(e)){const s=e;i=s.geometry&&s.geometry.animations||s.animations}for(let s=0;s<i.length;s++)if(i[s].name===t)return i[s];return null}static CreateClipsFromMorphTargetSequences(e,t,i){const s={},r=/^([\w-]*?)([\d]+)$/;for(let a=0,l=e.length;a<l;a++){const c=e[a],u=c.name.match(r);if(u&&u.length>1){const d=u[1];let f=s[d];f||(s[d]=f=[]),f.push(c)}}const o=[];for(const a in s)o.push(this.CreateFromMorphTargetSequence(a,s[a],t,i));return o}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(d,f,p,g,A){if(p.length!==0){const v=[],m=[];_M(p,v,m,g),v.length!==0&&A.push(new d(f,v,m))}},s=[],r=e.name||"default",o=e.fps||30,a=e.blendMode;let l=e.length||-1;const c=e.hierarchy||[];for(let d=0;d<c.length;d++){const f=c[d].keys;if(!(!f||f.length===0))if(f[0].morphTargets){const p={};let g;for(g=0;g<f.length;g++)if(f[g].morphTargets)for(let A=0;A<f[g].morphTargets.length;A++)p[f[g].morphTargets[A]]=-1;for(const A in p){const v=[],m=[];for(let b=0;b!==f[g].morphTargets.length;++b){const y=f[g];v.push(y.time),m.push(y.morphTarget===A?1:0)}s.push(new Eu(".morphTargetInfluence["+A+"]",v,m))}l=p.length*o}else{const p=".bones["+t[d].name+"]";i(Kc,p+".position",f,"pos",s),i(Vl,p+".quaternion",f,"rot",s),i(Kc,p+".scale",f,"scl",s)}}return s.length===0?null:new this(r,l,s,a)}resetDuration(){const e=this.tracks;let t=0;for(let i=0,s=e.length;i!==s;++i){const r=this.tracks[i];t=Math.max(t,r.times[r.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function a5(n){switch(n.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Eu;case"vector":case"vector2":case"vector3":case"vector4":return Kc;case"color":return wM;case"quaternion":return Vl;case"bool":case"boolean":return Lu;case"string":return Fu}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+n)}function l5(n){if(n.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=a5(n.type);if(n.times===void 0){const t=[],i=[];_M(n.keys,t,i,"value"),n.times=t,n.values=i}return e.parse!==void 0?e.parse(n):new e(n.name,n.times,n.values,n.interpolation)}const Mu={enabled:!1,files:{},add:function(n,e){this.enabled!==!1&&(this.files[n]=e)},get:function(n){if(this.enabled!==!1)return this.files[n]},remove:function(n){delete this.files[n]},clear:function(){this.files={}}};class qb{constructor(e,t,i){const s=this;let r=!1,o=0,a=0,l;const c=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(u){a++,r===!1&&s.onStart!==void 0&&s.onStart(u,o,a),r=!0},this.itemEnd=function(u){o++,s.onProgress!==void 0&&s.onProgress(u,o,a),o===a&&(r=!1,s.onLoad!==void 0&&s.onLoad())},this.itemError=function(u){s.onError!==void 0&&s.onError(u)},this.resolveURL=function(u){return l?l(u):u},this.setURLModifier=function(u){return l=u,this},this.addHandler=function(u,d){return c.push(u,d),this},this.removeHandler=function(u){const d=c.indexOf(u);return d!==-1&&c.splice(d,2),this},this.getHandler=function(u){for(let d=0,f=c.length;d<f;d+=2){const p=c[d],g=c[d+1];if(p.global&&(p.lastIndex=0),p.test(u))return g}return null}}}const lL=new qb;class ds{constructor(e){this.manager=e!==void 0?e:lL,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const i=this;return new Promise(function(s,r){i.load(e,s,t,r)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}ds.DEFAULT_MATERIAL_NAME="__DEFAULT";const sl={};class c5 extends Error{constructor(e,t){super(e),this.response=t}}class Dn extends ds{constructor(e){super(e)}load(e,t,i,s){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=Mu.get(e);if(r!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(r),this.manager.itemEnd(e)},0),r;if(sl[e]!==void 0){sl[e].push({onLoad:t,onProgress:i,onError:s});return}sl[e]=[],sl[e].push({onLoad:t,onProgress:i,onError:s});const o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,l=this.responseType;fetch(o).then(c=>{if(c.status===200||c.status===0){if(c.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||c.body===void 0||c.body.getReader===void 0)return c;const u=sl[e],d=c.body.getReader(),f=c.headers.get("Content-Length")||c.headers.get("X-File-Size"),p=f?parseInt(f):0,g=p!==0;let A=0;const v=new ReadableStream({start(m){b();function b(){d.read().then(({done:y,value:_})=>{if(y)m.close();else{A+=_.byteLength;const E=new ProgressEvent("progress",{lengthComputable:g,loaded:A,total:p});for(let M=0,I=u.length;M<I;M++){const R=u[M];R.onProgress&&R.onProgress(E)}m.enqueue(_),b()}})}}});return new Response(v)}else throw new c5(`fetch for "${c.url}" responded with ${c.status}: ${c.statusText}`,c)}).then(c=>{switch(l){case"arraybuffer":return c.arrayBuffer();case"blob":return c.blob();case"document":return c.text().then(u=>new DOMParser().parseFromString(u,a));case"json":return c.json();default:if(a===void 0)return c.text();{const d=/charset="?([^;"\s]*)"?/i.exec(a),f=d&&d[1]?d[1].toLowerCase():void 0,p=new TextDecoder(f);return c.arrayBuffer().then(g=>p.decode(g))}}}).then(c=>{Mu.add(e,c);const u=sl[e];delete sl[e];for(let d=0,f=u.length;d<f;d++){const p=u[d];p.onLoad&&p.onLoad(c)}}).catch(c=>{const u=sl[e];if(u===void 0)throw this.manager.itemError(e),c;delete sl[e];for(let d=0,f=u.length;d<f;d++){const p=u[d];p.onError&&p.onError(c)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class h5 extends ds{constructor(e){super(e)}load(e,t,i,s){const r=this,o=new Dn(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(a){try{t(r.parse(JSON.parse(a)))}catch(l){s?s(l):console.error(l),r.manager.itemError(e)}},i,s)}parse(e){const t=[];for(let i=0;i<e.length;i++){const s=fr.parse(e[i]);t.push(s)}return t}}class u5 extends ds{constructor(e){super(e)}load(e,t,i,s){const r=this,o=[],a=new Ol,l=new Dn(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(r.withCredentials);let c=0;function u(d){l.load(e[d],function(f){const p=r.parse(f,!0);o[d]={width:p.width,height:p.height,format:p.format,mipmaps:p.mipmaps},c+=1,c===6&&(p.mipmapCount===1&&(a.minFilter=Dt),a.image=o,a.format=p.format,a.needsUpdate=!0,t&&t(a))},i,s)}if(Array.isArray(e))for(let d=0,f=e.length;d<f;++d)u(d);else l.load(e,function(d){const f=r.parse(d,!0);if(f.isCubemap){const p=f.mipmaps.length/f.mipmapCount;for(let g=0;g<p;g++){o[g]={mipmaps:[]};for(let A=0;A<f.mipmapCount;A++)o[g].mipmaps.push(f.mipmaps[g*f.mipmapCount+A]),o[g].format=f.format,o[g].width=f.width,o[g].height=f.height}a.image=o}else a.image.width=f.width,a.image.height=f.height,a.mipmaps=f.mipmaps;f.mipmapCount===1&&(a.minFilter=Dt),a.format=f.format,a.needsUpdate=!0,t&&t(a)},i,s);return a}}class xm extends ds{constructor(e){super(e)}load(e,t,i,s){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,o=Mu.get(e);if(o!==void 0)return r.manager.itemStart(e),setTimeout(function(){t&&t(o),r.manager.itemEnd(e)},0),o;const a=Am("img");function l(){u(),Mu.add(e,this),t&&t(this),r.manager.itemEnd(e)}function c(d){u(),s&&s(d),r.manager.itemError(e),r.manager.itemEnd(e)}function u(){a.removeEventListener("load",l,!1),a.removeEventListener("error",c,!1)}return a.addEventListener("load",l,!1),a.addEventListener("error",c,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),r.manager.itemStart(e),a.src=e,a}}class d5 extends ds{constructor(e){super(e)}load(e,t,i,s){const r=new Zm;r.colorSpace=Je;const o=new xm(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);let a=0;function l(c){o.load(e[c],function(u){r.images[c]=u,a++,a===6&&(r.needsUpdate=!0,t&&t(r))},void 0,s)}for(let c=0;c<e.length;++c)l(c);return r}}class SM extends ds{constructor(e){super(e)}load(e,t,i,s){const r=this,o=new Ao,a=new Dn(this.manager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(r.withCredentials),a.load(e,function(l){const c=r.parse(l);c&&(c.image!==void 0?o.image=c.image:c.data!==void 0&&(o.image.width=c.width,o.image.height=c.height,o.image.data=c.data),o.wrapS=c.wrapS!==void 0?c.wrapS:Wn,o.wrapT=c.wrapT!==void 0?c.wrapT:Wn,o.magFilter=c.magFilter!==void 0?c.magFilter:Dt,o.minFilter=c.minFilter!==void 0?c.minFilter:Dt,o.anisotropy=c.anisotropy!==void 0?c.anisotropy:1,c.colorSpace!==void 0?o.colorSpace=c.colorSpace:c.encoding!==void 0&&(o.encoding=c.encoding),c.flipY!==void 0&&(o.flipY=c.flipY),c.format!==void 0&&(o.format=c.format),c.type!==void 0&&(o.type=c.type),c.mipmaps!==void 0&&(o.mipmaps=c.mipmaps,o.minFilter=yo),c.mipmapCount===1&&(o.minFilter=Dt),c.generateMipmaps!==void 0&&(o.generateMipmaps=c.generateMipmaps),o.needsUpdate=!0,t&&t(o,c))},i,s),o}}class kl extends ds{constructor(e){super(e)}load(e,t,i,s){const r=new Rt,o=new xm(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(a){r.image=a,r.needsUpdate=!0,t!==void 0&&t(r)},i,s),r}}let lh=class extends Me{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new _e(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}};class CM extends lh{constructor(e,t,i){super(e,i),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Me.DEFAULT_UP),this.updateMatrix(),this.groundColor=new _e(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}const Yx=new Ie,AR=new w,vR=new w;class EM{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new te(512,512),this.map=null,this.mapPass=null,this.matrix=new Ie,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Eb,this._frameExtents=new te(1,1),this._viewportCount=1,this._viewports=[new Ke(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,i=this.matrix;AR.setFromMatrixPosition(e.matrixWorld),t.position.copy(AR),vR.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(vR),t.updateMatrixWorld(),Yx.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Yx),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(Yx)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class f5 extends EM{constructor(){super(new qt(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,i=Bf*2*e.angle*this.focus,s=this.mapSize.width/this.mapSize.height,r=e.distance||t.far;(i!==t.fov||s!==t.aspect||r!==t.far)&&(t.fov=i,t.aspect=s,t.far=r,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class Xb extends lh{constructor(e,t,i=0,s=Math.PI/3,r=0,o=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Me.DEFAULT_UP),this.updateMatrix(),this.target=new Me,this.distance=i,this.angle=s,this.penumbra=r,this.decay=o,this.map=null,this.shadow=new f5}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const yR=new Ie,Up=new w,Jx=new w;class p5 extends EM{constructor(){super(new qt(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new te(4,2),this._viewportCount=6,this._viewports=[new Ke(2,1,1,1),new Ke(0,1,1,1),new Ke(3,1,1,1),new Ke(1,1,1,1),new Ke(3,0,1,1),new Ke(1,0,1,1)],this._cubeDirections=[new w(1,0,0),new w(-1,0,0),new w(0,0,1),new w(0,0,-1),new w(0,1,0),new w(0,-1,0)],this._cubeUps=[new w(0,1,0),new w(0,1,0),new w(0,1,0),new w(0,1,0),new w(0,0,1),new w(0,0,-1)]}updateMatrices(e,t=0){const i=this.camera,s=this.matrix,r=e.distance||i.far;r!==i.far&&(i.far=r,i.updateProjectionMatrix()),Up.setFromMatrixPosition(e.matrixWorld),i.position.copy(Up),Jx.copy(i.position),Jx.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(Jx),i.updateMatrixWorld(),s.makeTranslation(-Up.x,-Up.y,-Up.z),yR.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(yR)}}class Yb extends lh{constructor(e,t,i=0,s=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=s,this.shadow=new p5}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class g5 extends EM{constructor(){super(new rh(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class Jb extends lh{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Me.DEFAULT_UP),this.updateMatrix(),this.target=new Me,this.shadow=new g5}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class MM extends lh{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class cL extends lh{constructor(e,t,i=10,s=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=i,this.height=s}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class jd{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new w)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const i=e.x,s=e.y,r=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.282095),t.addScaledVector(o[1],.488603*s),t.addScaledVector(o[2],.488603*r),t.addScaledVector(o[3],.488603*i),t.addScaledVector(o[4],1.092548*(i*s)),t.addScaledVector(o[5],1.092548*(s*r)),t.addScaledVector(o[6],.315392*(3*r*r-1)),t.addScaledVector(o[7],1.092548*(i*r)),t.addScaledVector(o[8],.546274*(i*i-s*s)),t}getIrradianceAt(e,t){const i=e.x,s=e.y,r=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.886227),t.addScaledVector(o[1],2*.511664*s),t.addScaledVector(o[2],2*.511664*r),t.addScaledVector(o[3],2*.511664*i),t.addScaledVector(o[4],2*.429043*i*s),t.addScaledVector(o[5],2*.429043*s*r),t.addScaledVector(o[6],.743125*r*r-.247708),t.addScaledVector(o[7],2*.429043*i*r),t.addScaledVector(o[8],.429043*(i*i-s*s)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let i=0;i<9;i++)this.coefficients[i].addScaledVector(e.coefficients[i],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let i=0;i<9;i++)this.coefficients[i].lerp(e.coefficients[i],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){const i=this.coefficients;for(let s=0;s<9;s++)i[s].fromArray(e,t+s*3);return this}toArray(e=[],t=0){const i=this.coefficients;for(let s=0;s<9;s++)i[s].toArray(e,t+s*3);return e}static getBasisAt(e,t){const i=e.x,s=e.y,r=e.z;t[0]=.282095,t[1]=.488603*s,t[2]=.488603*r,t[3]=.488603*i,t[4]=1.092548*i*s,t[5]=1.092548*s*r,t[6]=.315392*(3*r*r-1),t[7]=1.092548*i*r,t[8]=.546274*(i*i-s*s)}}class Of extends lh{constructor(e=new jd,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class Kb extends ds{constructor(e){super(e),this.textures={}}load(e,t,i,s){const r=this,o=new Dn(r.manager);o.setPath(r.path),o.setRequestHeader(r.requestHeader),o.setWithCredentials(r.withCredentials),o.load(e,function(a){try{t(r.parse(JSON.parse(a)))}catch(l){s?s(l):console.error(l),r.manager.itemError(e)}},i,s)}parse(e){const t=this.textures;function i(r){return t[r]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",r),t[r]}const s=Kb.createMaterialFromType(e.type);if(e.uuid!==void 0&&(s.uuid=e.uuid),e.name!==void 0&&(s.name=e.name),e.color!==void 0&&s.color!==void 0&&s.color.setHex(e.color),e.roughness!==void 0&&(s.roughness=e.roughness),e.metalness!==void 0&&(s.metalness=e.metalness),e.sheen!==void 0&&(s.sheen=e.sheen),e.sheenColor!==void 0&&(s.sheenColor=new _e().setHex(e.sheenColor)),e.sheenRoughness!==void 0&&(s.sheenRoughness=e.sheenRoughness),e.emissive!==void 0&&s.emissive!==void 0&&s.emissive.setHex(e.emissive),e.specular!==void 0&&s.specular!==void 0&&s.specular.setHex(e.specular),e.specularIntensity!==void 0&&(s.specularIntensity=e.specularIntensity),e.specularColor!==void 0&&s.specularColor!==void 0&&s.specularColor.setHex(e.specularColor),e.shininess!==void 0&&(s.shininess=e.shininess),e.clearcoat!==void 0&&(s.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(s.clearcoatRoughness=e.clearcoatRoughness),e.iridescence!==void 0&&(s.iridescence=e.iridescence),e.iridescenceIOR!==void 0&&(s.iridescenceIOR=e.iridescenceIOR),e.iridescenceThicknessRange!==void 0&&(s.iridescenceThicknessRange=e.iridescenceThicknessRange),e.transmission!==void 0&&(s.transmission=e.transmission),e.thickness!==void 0&&(s.thickness=e.thickness),e.attenuationDistance!==void 0&&(s.attenuationDistance=e.attenuationDistance),e.attenuationColor!==void 0&&s.attenuationColor!==void 0&&s.attenuationColor.setHex(e.attenuationColor),e.anisotropy!==void 0&&(s.anisotropy=e.anisotropy),e.anisotropyRotation!==void 0&&(s.anisotropyRotation=e.anisotropyRotation),e.fog!==void 0&&(s.fog=e.fog),e.flatShading!==void 0&&(s.flatShading=e.flatShading),e.blending!==void 0&&(s.blending=e.blending),e.combine!==void 0&&(s.combine=e.combine),e.side!==void 0&&(s.side=e.side),e.shadowSide!==void 0&&(s.shadowSide=e.shadowSide),e.opacity!==void 0&&(s.opacity=e.opacity),e.transparent!==void 0&&(s.transparent=e.transparent),e.alphaTest!==void 0&&(s.alphaTest=e.alphaTest),e.alphaHash!==void 0&&(s.alphaHash=e.alphaHash),e.depthTest!==void 0&&(s.depthTest=e.depthTest),e.depthWrite!==void 0&&(s.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(s.colorWrite=e.colorWrite),e.stencilWrite!==void 0&&(s.stencilWrite=e.stencilWrite),e.stencilWriteMask!==void 0&&(s.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(s.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(s.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(s.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(s.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(s.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(s.stencilZPass=e.stencilZPass),e.wireframe!==void 0&&(s.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(s.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(s.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(s.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(s.rotation=e.rotation),e.linewidth!==1&&(s.linewidth=e.linewidth),e.dashSize!==void 0&&(s.dashSize=e.dashSize),e.gapSize!==void 0&&(s.gapSize=e.gapSize),e.scale!==void 0&&(s.scale=e.scale),e.polygonOffset!==void 0&&(s.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(s.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(s.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(s.dithering=e.dithering),e.alphaToCoverage!==void 0&&(s.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(s.premultipliedAlpha=e.premultipliedAlpha),e.forceSinglePass!==void 0&&(s.forceSinglePass=e.forceSinglePass),e.visible!==void 0&&(s.visible=e.visible),e.toneMapped!==void 0&&(s.toneMapped=e.toneMapped),e.userData!==void 0&&(s.userData=e.userData),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?s.vertexColors=e.vertexColors>0:s.vertexColors=e.vertexColors),e.uniforms!==void 0)for(const r in e.uniforms){const o=e.uniforms[r];switch(s.uniforms[r]={},o.type){case"t":s.uniforms[r].value=i(o.value);break;case"c":s.uniforms[r].value=new _e().setHex(o.value);break;case"v2":s.uniforms[r].value=new te().fromArray(o.value);break;case"v3":s.uniforms[r].value=new w().fromArray(o.value);break;case"v4":s.uniforms[r].value=new Ke().fromArray(o.value);break;case"m3":s.uniforms[r].value=new It().fromArray(o.value);break;case"m4":s.uniforms[r].value=new Ie().fromArray(o.value);break;default:s.uniforms[r].value=o.value}}if(e.defines!==void 0&&(s.defines=e.defines),e.vertexShader!==void 0&&(s.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(s.fragmentShader=e.fragmentShader),e.glslVersion!==void 0&&(s.glslVersion=e.glslVersion),e.extensions!==void 0)for(const r in e.extensions)s.extensions[r]=e.extensions[r];if(e.lights!==void 0&&(s.lights=e.lights),e.clipping!==void 0&&(s.clipping=e.clipping),e.size!==void 0&&(s.size=e.size),e.sizeAttenuation!==void 0&&(s.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(s.map=i(e.map)),e.matcap!==void 0&&(s.matcap=i(e.matcap)),e.alphaMap!==void 0&&(s.alphaMap=i(e.alphaMap)),e.bumpMap!==void 0&&(s.bumpMap=i(e.bumpMap)),e.bumpScale!==void 0&&(s.bumpScale=e.bumpScale),e.normalMap!==void 0&&(s.normalMap=i(e.normalMap)),e.normalMapType!==void 0&&(s.normalMapType=e.normalMapType),e.normalScale!==void 0){let r=e.normalScale;Array.isArray(r)===!1&&(r=[r,r]),s.normalScale=new te().fromArray(r)}return e.displacementMap!==void 0&&(s.displacementMap=i(e.displacementMap)),e.displacementScale!==void 0&&(s.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(s.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(s.roughnessMap=i(e.roughnessMap)),e.metalnessMap!==void 0&&(s.metalnessMap=i(e.metalnessMap)),e.emissiveMap!==void 0&&(s.emissiveMap=i(e.emissiveMap)),e.emissiveIntensity!==void 0&&(s.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(s.specularMap=i(e.specularMap)),e.specularIntensityMap!==void 0&&(s.specularIntensityMap=i(e.specularIntensityMap)),e.specularColorMap!==void 0&&(s.specularColorMap=i(e.specularColorMap)),e.envMap!==void 0&&(s.envMap=i(e.envMap)),e.envMapIntensity!==void 0&&(s.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(s.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(s.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(s.lightMap=i(e.lightMap)),e.lightMapIntensity!==void 0&&(s.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(s.aoMap=i(e.aoMap)),e.aoMapIntensity!==void 0&&(s.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(s.gradientMap=i(e.gradientMap)),e.clearcoatMap!==void 0&&(s.clearcoatMap=i(e.clearcoatMap)),e.clearcoatRoughnessMap!==void 0&&(s.clearcoatRoughnessMap=i(e.clearcoatRoughnessMap)),e.clearcoatNormalMap!==void 0&&(s.clearcoatNormalMap=i(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(s.clearcoatNormalScale=new te().fromArray(e.clearcoatNormalScale)),e.iridescenceMap!==void 0&&(s.iridescenceMap=i(e.iridescenceMap)),e.iridescenceThicknessMap!==void 0&&(s.iridescenceThicknessMap=i(e.iridescenceThicknessMap)),e.transmissionMap!==void 0&&(s.transmissionMap=i(e.transmissionMap)),e.thicknessMap!==void 0&&(s.thicknessMap=i(e.thicknessMap)),e.anisotropyMap!==void 0&&(s.anisotropyMap=i(e.anisotropyMap)),e.sheenColorMap!==void 0&&(s.sheenColorMap=i(e.sheenColorMap)),e.sheenRoughnessMap!==void 0&&(s.sheenRoughnessMap=i(e.sheenRoughnessMap)),s}setTextures(e){return this.textures=e,this}static createMaterialFromType(e){const t={ShadowMaterial:Wb,SpriteMaterial:lM,RawShaderMaterial:jb,ShaderMaterial:Bt,PointsMaterial:Bb,MeshPhysicalMaterial:bo,MeshStandardMaterial:Yo,MeshPhongMaterial:$k,MeshToonMaterial:eL,MeshNormalMaterial:yM,MeshLambertMaterial:tL,MeshDepthMaterial:Tb,MeshDistanceMaterial:oM,MeshBasicMaterial:ai,MeshMatcapMaterial:iL,LineDashedMaterial:nL,LineBasicMaterial:Sn,Material:Pt};return new t[e]}}class kf{static decodeText(e){if(typeof TextDecoder<"u")return new TextDecoder().decode(e);let t="";for(let i=0,s=e.length;i<s;i++)t+=String.fromCharCode(e[i]);try{return decodeURIComponent(escape(t))}catch{return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return t===-1?"./":e.slice(0,t+1)}static resolveURL(e,t){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class TM extends ft{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class hL extends ds{constructor(e){super(e)}load(e,t,i,s){const r=this,o=new Dn(r.manager);o.setPath(r.path),o.setRequestHeader(r.requestHeader),o.setWithCredentials(r.withCredentials),o.load(e,function(a){try{t(r.parse(JSON.parse(a)))}catch(l){s?s(l):console.error(l),r.manager.itemError(e)}},i,s)}parse(e){const t={},i={};function s(p,g){if(t[g]!==void 0)return t[g];const v=p.interleavedBuffers[g],m=r(p,v.buffer),b=Hd(v.type,m),y=new $m(b,v.stride);return y.uuid=v.uuid,t[g]=y,y}function r(p,g){if(i[g]!==void 0)return i[g];const v=p.arrayBuffers[g],m=new Uint32Array(v).buffer;return i[g]=m,m}const o=e.isInstancedBufferGeometry?new TM:new ft,a=e.data.index;if(a!==void 0){const p=Hd(a.type,a.array);o.setIndex(new ot(p,1))}const l=e.data.attributes;for(const p in l){const g=l[p];let A;if(g.isInterleavedBufferAttribute){const v=s(e.data,g.data);A=new Gl(v,g.itemSize,g.offset,g.normalized)}else{const v=Hd(g.type,g.array),m=g.isInstancedBufferAttribute?Mr:ot;A=new m(v,g.itemSize,g.normalized)}g.name!==void 0&&(A.name=g.name),g.usage!==void 0&&A.setUsage(g.usage),g.updateRange!==void 0&&(A.updateRange.offset=g.updateRange.offset,A.updateRange.count=g.updateRange.count),o.setAttribute(p,A)}const c=e.data.morphAttributes;if(c)for(const p in c){const g=c[p],A=[];for(let v=0,m=g.length;v<m;v++){const b=g[v];let y;if(b.isInterleavedBufferAttribute){const _=s(e.data,b.data);y=new Gl(_,b.itemSize,b.offset,b.normalized)}else{const _=Hd(b.type,b.array);y=new ot(_,b.itemSize,b.normalized)}b.name!==void 0&&(y.name=b.name),A.push(y)}o.morphAttributes[p]=A}e.data.morphTargetsRelative&&(o.morphTargetsRelative=!0);const d=e.data.groups||e.data.drawcalls||e.data.offsets;if(d!==void 0)for(let p=0,g=d.length;p!==g;++p){const A=d[p];o.addGroup(A.start,A.count,A.materialIndex)}const f=e.data.boundingSphere;if(f!==void 0){const p=new w;f.center!==void 0&&p.fromArray(f.center),o.boundingSphere=new Ys(p,f.radius)}return e.name&&(o.name=e.name),e.userData&&(o.userData=e.userData),o}}class m5 extends ds{constructor(e){super(e)}load(e,t,i,s){const r=this,o=this.path===""?kf.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||o;const a=new Dn(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(l){let c=null;try{c=JSON.parse(l)}catch(d){s!==void 0&&s(d),console.error("THREE:ObjectLoader: Can't parse "+e+".",d.message);return}const u=c.metadata;if(u===void 0||u.type===void 0||u.type.toLowerCase()==="geometry"){s!==void 0&&s(new Error("THREE.ObjectLoader: Can't load "+e)),console.error("THREE.ObjectLoader: Can't load "+e);return}r.parse(c,t)},i,s)}async loadAsync(e,t){const i=this,s=this.path===""?kf.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||s;const r=new Dn(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials);const o=await r.loadAsync(e,t),a=JSON.parse(o),l=a.metadata;if(l===void 0||l.type===void 0||l.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+e);return await i.parseAsync(a)}parse(e,t){const i=this.parseAnimations(e.animations),s=this.parseShapes(e.shapes),r=this.parseGeometries(e.geometries,s),o=this.parseImages(e.images,function(){t!==void 0&&t(c)}),a=this.parseTextures(e.textures,o),l=this.parseMaterials(e.materials,a),c=this.parseObject(e.object,r,l,a,i),u=this.parseSkeletons(e.skeletons,c);if(this.bindSkeletons(c,u),t!==void 0){let d=!1;for(const f in o)if(o[f].data instanceof HTMLImageElement){d=!0;break}d===!1&&t(c)}return c}async parseAsync(e){const t=this.parseAnimations(e.animations),i=this.parseShapes(e.shapes),s=this.parseGeometries(e.geometries,i),r=await this.parseImagesAsync(e.images),o=this.parseTextures(e.textures,r),a=this.parseMaterials(e.materials,o),l=this.parseObject(e.object,s,a,o,t),c=this.parseSkeletons(e.skeletons,l);return this.bindSkeletons(l,c),l}parseShapes(e){const t={};if(e!==void 0)for(let i=0,s=e.length;i<s;i++){const r=new gu().fromJSON(e[i]);t[r.uuid]=r}return t}parseSkeletons(e,t){const i={},s={};if(t.traverse(function(r){r.isBone&&(s[r.uuid]=r)}),e!==void 0)for(let r=0,o=e.length;r<o;r++){const a=new Jf().fromJSON(e[r],s);i[a.uuid]=a}return i}parseGeometries(e,t){const i={};if(e!==void 0){const s=new hL;for(let r=0,o=e.length;r<o;r++){let a;const l=e[r];switch(l.type){case"BufferGeometry":case"InstancedBufferGeometry":a=s.parse(l);break;default:l.type in mR?a=mR[l.type].fromJSON(l,t):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${l.type}"`)}a.uuid=l.uuid,l.name!==void 0&&(a.name=l.name),l.userData!==void 0&&(a.userData=l.userData),i[l.uuid]=a}}return i}parseMaterials(e,t){const i={},s={};if(e!==void 0){const r=new Kb;r.setTextures(t);for(let o=0,a=e.length;o<a;o++){const l=e[o];i[l.uuid]===void 0&&(i[l.uuid]=r.parse(l)),s[l.uuid]=i[l.uuid]}}return s}parseAnimations(e){const t={};if(e!==void 0)for(let i=0;i<e.length;i++){const s=e[i],r=fr.parse(s);t[r.uuid]=r}return t}parseImages(e,t){const i=this,s={};let r;function o(l){return i.manager.itemStart(l),r.load(l,function(){i.manager.itemEnd(l)},void 0,function(){i.manager.itemError(l),i.manager.itemEnd(l)})}function a(l){if(typeof l=="string"){const c=l,u=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(c)?c:i.resourcePath+c;return o(u)}else return l.data?{data:Hd(l.type,l.data),width:l.width,height:l.height}:null}if(e!==void 0&&e.length>0){const l=new qb(t);r=new xm(l),r.setCrossOrigin(this.crossOrigin);for(let c=0,u=e.length;c<u;c++){const d=e[c],f=d.url;if(Array.isArray(f)){const p=[];for(let g=0,A=f.length;g<A;g++){const v=f[g],m=a(v);m!==null&&(m instanceof HTMLImageElement?p.push(m):p.push(new Ao(m.data,m.width,m.height)))}s[d.uuid]=new Sl(p)}else{const p=a(d.url);s[d.uuid]=new Sl(p)}}}return s}async parseImagesAsync(e){const t=this,i={};let s;async function r(o){if(typeof o=="string"){const a=o,l=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(a)?a:t.resourcePath+a;return await s.loadAsync(l)}else return o.data?{data:Hd(o.type,o.data),width:o.width,height:o.height}:null}if(e!==void 0&&e.length>0){s=new xm(this.manager),s.setCrossOrigin(this.crossOrigin);for(let o=0,a=e.length;o<a;o++){const l=e[o],c=l.url;if(Array.isArray(c)){const u=[];for(let d=0,f=c.length;d<f;d++){const p=c[d],g=await r(p);g!==null&&(g instanceof HTMLImageElement?u.push(g):u.push(new Ao(g.data,g.width,g.height)))}i[l.uuid]=new Sl(u)}else{const u=await r(l.url);i[l.uuid]=new Sl(u)}}}return i}parseTextures(e,t){function i(r,o){return typeof r=="number"?r:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",r),o[r])}const s={};if(e!==void 0)for(let r=0,o=e.length;r<o;r++){const a=e[r];a.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',a.uuid),t[a.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",a.image);const l=t[a.image],c=l.data;let u;Array.isArray(c)?(u=new Zm,c.length===6&&(u.needsUpdate=!0)):(c&&c.data?u=new Ao:u=new Rt,c&&(u.needsUpdate=!0)),u.source=l,u.uuid=a.uuid,a.name!==void 0&&(u.name=a.name),a.mapping!==void 0&&(u.mapping=i(a.mapping,A5)),a.channel!==void 0&&(u.channel=a.channel),a.offset!==void 0&&u.offset.fromArray(a.offset),a.repeat!==void 0&&u.repeat.fromArray(a.repeat),a.center!==void 0&&u.center.fromArray(a.center),a.rotation!==void 0&&(u.rotation=a.rotation),a.wrap!==void 0&&(u.wrapS=i(a.wrap[0],bR),u.wrapT=i(a.wrap[1],bR)),a.format!==void 0&&(u.format=a.format),a.internalFormat!==void 0&&(u.internalFormat=a.internalFormat),a.type!==void 0&&(u.type=a.type),a.colorSpace!==void 0&&(u.colorSpace=a.colorSpace),a.encoding!==void 0&&(u.encoding=a.encoding),a.minFilter!==void 0&&(u.minFilter=i(a.minFilter,_R)),a.magFilter!==void 0&&(u.magFilter=i(a.magFilter,_R)),a.anisotropy!==void 0&&(u.anisotropy=a.anisotropy),a.flipY!==void 0&&(u.flipY=a.flipY),a.generateMipmaps!==void 0&&(u.generateMipmaps=a.generateMipmaps),a.premultiplyAlpha!==void 0&&(u.premultiplyAlpha=a.premultiplyAlpha),a.unpackAlignment!==void 0&&(u.unpackAlignment=a.unpackAlignment),a.compareFunction!==void 0&&(u.compareFunction=a.compareFunction),a.userData!==void 0&&(u.userData=a.userData),s[a.uuid]=u}return s}parseObject(e,t,i,s,r){let o;function a(f){return t[f]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",f),t[f]}function l(f){if(f!==void 0){if(Array.isArray(f)){const p=[];for(let g=0,A=f.length;g<A;g++){const v=f[g];i[v]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",v),p.push(i[v])}return p}return i[f]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",f),i[f]}}function c(f){return s[f]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",f),s[f]}let u,d;switch(e.type){case"Scene":o=new mr,e.background!==void 0&&(Number.isInteger(e.background)?o.background=new _e(e.background):o.background=c(e.background)),e.environment!==void 0&&(o.environment=c(e.environment)),e.fog!==void 0&&(e.fog.type==="Fog"?o.fog=new aM(e.fog.color,e.fog.near,e.fog.far):e.fog.type==="FogExp2"&&(o.fog=new Rb(e.fog.color,e.fog.density))),e.backgroundBlurriness!==void 0&&(o.backgroundBlurriness=e.backgroundBlurriness),e.backgroundIntensity!==void 0&&(o.backgroundIntensity=e.backgroundIntensity);break;case"PerspectiveCamera":o=new qt(e.fov,e.aspect,e.near,e.far),e.focus!==void 0&&(o.focus=e.focus),e.zoom!==void 0&&(o.zoom=e.zoom),e.filmGauge!==void 0&&(o.filmGauge=e.filmGauge),e.filmOffset!==void 0&&(o.filmOffset=e.filmOffset),e.view!==void 0&&(o.view=Object.assign({},e.view));break;case"OrthographicCamera":o=new rh(e.left,e.right,e.top,e.bottom,e.near,e.far),e.zoom!==void 0&&(o.zoom=e.zoom),e.view!==void 0&&(o.view=Object.assign({},e.view));break;case"AmbientLight":o=new MM(e.color,e.intensity);break;case"DirectionalLight":o=new Jb(e.color,e.intensity);break;case"PointLight":o=new Yb(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":o=new cL(e.color,e.intensity,e.width,e.height);break;case"SpotLight":o=new Xb(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":o=new CM(e.color,e.groundColor,e.intensity);break;case"LightProbe":o=new Of().fromJSON(e);break;case"SkinnedMesh":u=a(e.geometry),d=l(e.material),o=new Yf(u,d),e.bindMode!==void 0&&(o.bindMode=e.bindMode),e.bindMatrix!==void 0&&o.bindMatrix.fromArray(e.bindMatrix),e.skeleton!==void 0&&(o.skeleton=e.skeleton);break;case"Mesh":u=a(e.geometry),d=l(e.material),o=new ye(u,d);break;case"InstancedMesh":u=a(e.geometry),d=l(e.material);const f=e.count,p=e.instanceMatrix,g=e.instanceColor;o=new Pb(u,d,f),o.instanceMatrix=new Mr(new Float32Array(p.array),16),g!==void 0&&(o.instanceColor=new Mr(new Float32Array(g.array),g.itemSize));break;case"LOD":o=new cM;break;case"Line":o=new dn(a(e.geometry),l(e.material));break;case"LineLoop":o=new hM(a(e.geometry),l(e.material));break;case"LineSegments":o=new wo(a(e.geometry),l(e.material));break;case"PointCloud":case"Points":o=new uM(a(e.geometry),l(e.material));break;case"Sprite":o=new zk(l(e.material));break;case"Group":o=new ar;break;case"Bone":o=new eA;break;default:o=new Me}if(o.uuid=e.uuid,e.name!==void 0&&(o.name=e.name),e.matrix!==void 0?(o.matrix.fromArray(e.matrix),e.matrixAutoUpdate!==void 0&&(o.matrixAutoUpdate=e.matrixAutoUpdate),o.matrixAutoUpdate&&o.matrix.decompose(o.position,o.quaternion,o.scale)):(e.position!==void 0&&o.position.fromArray(e.position),e.rotation!==void 0&&o.rotation.fromArray(e.rotation),e.quaternion!==void 0&&o.quaternion.fromArray(e.quaternion),e.scale!==void 0&&o.scale.fromArray(e.scale)),e.up!==void 0&&o.up.fromArray(e.up),e.castShadow!==void 0&&(o.castShadow=e.castShadow),e.receiveShadow!==void 0&&(o.receiveShadow=e.receiveShadow),e.shadow&&(e.shadow.bias!==void 0&&(o.shadow.bias=e.shadow.bias),e.shadow.normalBias!==void 0&&(o.shadow.normalBias=e.shadow.normalBias),e.shadow.radius!==void 0&&(o.shadow.radius=e.shadow.radius),e.shadow.mapSize!==void 0&&o.shadow.mapSize.fromArray(e.shadow.mapSize),e.shadow.camera!==void 0&&(o.shadow.camera=this.parseObject(e.shadow.camera))),e.visible!==void 0&&(o.visible=e.visible),e.frustumCulled!==void 0&&(o.frustumCulled=e.frustumCulled),e.renderOrder!==void 0&&(o.renderOrder=e.renderOrder),e.userData!==void 0&&(o.userData=e.userData),e.layers!==void 0&&(o.layers.mask=e.layers),e.children!==void 0){const f=e.children;for(let p=0;p<f.length;p++)o.add(this.parseObject(f[p],t,i,s,r))}if(e.animations!==void 0){const f=e.animations;for(let p=0;p<f.length;p++){const g=f[p];o.animations.push(r[g])}}if(e.type==="LOD"){e.autoUpdate!==void 0&&(o.autoUpdate=e.autoUpdate);const f=e.levels;for(let p=0;p<f.length;p++){const g=f[p],A=o.getObjectByProperty("uuid",g.object);A!==void 0&&o.addLevel(A,g.distance,g.hysteresis)}}return o}bindSkeletons(e,t){Object.keys(t).length!==0&&e.traverse(function(i){if(i.isSkinnedMesh===!0&&i.skeleton!==void 0){const s=t[i.skeleton];s===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",i.skeleton):i.bind(s,i.bindMatrix)}})}}const A5={UVMapping:Ab,CubeReflectionMapping:qc,CubeRefractionMapping:Xc,EquirectangularReflectionMapping:mo,EquirectangularRefractionMapping:Rf,CubeUVReflectionMapping:jf},bR={RepeatWrapping:vo,ClampToEdgeWrapping:Wn,MirroredRepeatWrapping:wu},_R={NearestFilter:Ft,NearestMipmapNearestFilter:Pf,NearestMipmapLinearFilter:fu,LinearFilter:Dt,LinearMipmapNearestFilter:Jm,LinearMipmapLinearFilter:yo};class uL extends ds{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,i,s){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,o=Mu.get(e);if(o!==void 0)return r.manager.itemStart(e),setTimeout(function(){t&&t(o),r.manager.itemEnd(e)},0),o;const a={};a.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",a.headers=this.requestHeader,fetch(e,a).then(function(l){return l.blob()}).then(function(l){return createImageBitmap(l,Object.assign(r.options,{colorSpaceConversion:"none"}))}).then(function(l){Mu.add(e,l),t&&t(l),r.manager.itemEnd(e)}).catch(function(l){s&&s(l),r.manager.itemError(e),r.manager.itemEnd(e)}),r.manager.itemStart(e)}}let wv;class IM{static getContext(){return wv===void 0&&(wv=new(window.AudioContext||window.webkitAudioContext)),wv}static setContext(e){wv=e}}class o0 extends ds{constructor(e){super(e)}load(e,t,i,s){const r=this,o=new Dn(this.manager);o.setResponseType("arraybuffer"),o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(l){try{const c=l.slice(0);IM.getContext().decodeAudioData(c,function(d){t(d)},a)}catch(c){a(c)}},i,s);function a(l){s?s(l):console.error(l),r.manager.itemError(e)}}}class v5 extends Of{constructor(e,t,i=1){super(void 0,i),this.isHemisphereLightProbe=!0;const s=new _e().set(e),r=new _e().set(t),o=new w(s.r,s.g,s.b),a=new w(r.r,r.g,r.b),l=Math.sqrt(Math.PI),c=l*Math.sqrt(.75);this.sh.coefficients[0].copy(o).add(a).multiplyScalar(l),this.sh.coefficients[1].copy(o).sub(a).multiplyScalar(c)}}class y5 extends Of{constructor(e,t=1){super(void 0,t),this.isAmbientLightProbe=!0;const i=new _e().set(e);this.sh.coefficients[0].set(i.r,i.g,i.b).multiplyScalar(2*Math.sqrt(Math.PI))}}const xR=new Ie,wR=new Ie,Eh=new Ie;class b5{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new qt,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new qt,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,Eh.copy(e.projectionMatrix);const s=t.eyeSep/2,r=s*t.near/t.focus,o=t.near*Math.tan(pu*t.fov*.5)/t.zoom;let a,l;wR.elements[12]=-s,xR.elements[12]=s,a=-o*t.aspect+r,l=o*t.aspect+r,Eh.elements[0]=2*t.near/(l-a),Eh.elements[8]=(l+a)/(l-a),this.cameraL.projectionMatrix.copy(Eh),a=-o*t.aspect-r,l=o*t.aspect-r,Eh.elements[0]=2*t.near/(l-a),Eh.elements[8]=(l+a)/(l-a),this.cameraR.projectionMatrix.copy(Eh)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(wR),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(xR)}}class RM{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=SR(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=SR();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function SR(){return(typeof performance>"u"?Date:performance).now()}const Mh=new w,CR=new Se,_5=new w,Th=new w;let dL=class extends Me{constructor(){super(),this.type="AudioListener",this.context=IM.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new RM}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener,i=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Mh,CR,_5),Th.set(0,0,-1).applyQuaternion(CR),t.positionX){const s=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(Mh.x,s),t.positionY.linearRampToValueAtTime(Mh.y,s),t.positionZ.linearRampToValueAtTime(Mh.z,s),t.forwardX.linearRampToValueAtTime(Th.x,s),t.forwardY.linearRampToValueAtTime(Th.y,s),t.forwardZ.linearRampToValueAtTime(Th.z,s),t.upX.linearRampToValueAtTime(i.x,s),t.upY.linearRampToValueAtTime(i.y,s),t.upZ.linearRampToValueAtTime(i.z,s)}else t.setPosition(Mh.x,Mh.y,Mh.z),t.setOrientation(Th.x,Th.y,Th.z,i.x,i.y,i.z)}},PM=class extends Me{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source!==null&&(this.source.stop(),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}};const Ih=new w,ER=new Se,x5=new w,Rh=new w;class fL extends PM{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){super.connect(),this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,i){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=i,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(Ih,ER,x5),Rh.set(0,0,1).applyQuaternion(ER);const t=this.panner;if(t.positionX){const i=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(Ih.x,i),t.positionY.linearRampToValueAtTime(Ih.y,i),t.positionZ.linearRampToValueAtTime(Ih.z,i),t.orientationX.linearRampToValueAtTime(Rh.x,i),t.orientationY.linearRampToValueAtTime(Rh.y,i),t.orientationZ.linearRampToValueAtTime(Rh.z,i)}else t.setPosition(Ih.x,Ih.y,Ih.z),t.setOrientation(Rh.x,Rh.y,Rh.z)}}class w5{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let i=0;i<t.length;i++)e+=t[i];return e/t.length}}class pL{constructor(e,t,i){this.binding=e,this.valueSize=i;let s,r,o;switch(t){case"quaternion":s=this._slerp,r=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(i*6),this._workIndex=5;break;case"string":case"bool":s=this._select,r=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(i*5);break;default:s=this._lerp,r=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(i*5)}this._mixBufferRegion=s,this._mixBufferRegionAdditive=r,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const i=this.buffer,s=this.valueSize,r=e*s+s;let o=this.cumulativeWeight;if(o===0){for(let a=0;a!==s;++a)i[r+a]=i[a];o=t}else{o+=t;const a=t/o;this._mixBufferRegion(i,r,0,a,s)}this.cumulativeWeight=o}accumulateAdditive(e){const t=this.buffer,i=this.valueSize,s=i*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,s,0,e,i),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,i=this.buffer,s=e*t+t,r=this.cumulativeWeight,o=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){const l=t*this._origIndex;this._mixBufferRegion(i,s,l,1-r,t)}o>0&&this._mixBufferRegionAdditive(i,s,this._addIndex*t,1,t);for(let l=t,c=t+t;l!==c;++l)if(i[l]!==i[l+t]){a.setValue(i,s);break}}saveOriginalState(){const e=this.binding,t=this.buffer,i=this.valueSize,s=i*this._origIndex;e.getValue(t,s);for(let r=i,o=s;r!==o;++r)t[r]=t[s+r%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let i=e;i<t;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[t+i]=this.buffer[e+i]}_select(e,t,i,s,r){if(s>=.5)for(let o=0;o!==r;++o)e[t+o]=e[i+o]}_slerp(e,t,i,s){Se.slerpFlat(e,t,e,t,e,i,s)}_slerpAdditive(e,t,i,s,r){const o=this._workIndex*r;Se.multiplyQuaternionsFlat(e,o,e,t,e,i),Se.slerpFlat(e,t,e,t,e,o,s)}_lerp(e,t,i,s,r){const o=1-s;for(let a=0;a!==r;++a){const l=t+a;e[l]=e[l]*o+e[i+a]*s}}_lerpAdditive(e,t,i,s,r){for(let o=0;o!==r;++o){const a=t+o;e[a]=e[a]+e[i+o]*s}}}const BM="\\[\\]\\.:\\/",S5=new RegExp("["+BM+"]","g"),DM="[^"+BM+"]",C5="[^"+BM.replace("\\.","")+"]",E5=/((?:WC+[\/:])*)/.source.replace("WC",DM),M5=/(WCOD+)?/.source.replace("WCOD",C5),T5=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",DM),I5=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",DM),R5=new RegExp("^"+E5+M5+T5+I5+"$"),P5=["material","materials","bones","map"];class B5{constructor(e,t,i){const s=i||kt.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,s)}getValue(e,t){this.bind();const i=this._targetGroup.nCachedObjects_,s=this._bindings[i];s!==void 0&&s.getValue(e,t)}setValue(e,t){const i=this._bindings;for(let s=this._targetGroup.nCachedObjects_,r=i.length;s!==r;++s)i[s].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}}class kt{constructor(e,t,i){this.path=t,this.parsedPath=i||kt.parseTrackName(t),this.node=kt.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,i){return e&&e.isAnimationObjectGroup?new kt.Composite(e,t,i):new kt(e,t,i)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(S5,"")}static parseTrackName(e){const t=R5.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},s=i.nodeName&&i.nodeName.lastIndexOf(".");if(s!==void 0&&s!==-1){const r=i.nodeName.substring(s+1);P5.indexOf(r)!==-1&&(i.nodeName=i.nodeName.substring(0,s),i.objectName=r)}if(i.propertyName===null||i.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const i=e.skeleton.getBoneByName(t);if(i!==void 0)return i}if(e.children){const i=function(r){for(let o=0;o<r.length;o++){const a=r[o];if(a.name===t||a.uuid===t)return a;const l=i(a.children);if(l)return l}return null},s=i(e.children);if(s)return s}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const i=this.resolvedProperty;for(let s=0,r=i.length;s!==r;++s)e[t++]=i[s]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const i=this.resolvedProperty;for(let s=0,r=i.length;s!==r;++s)i[s]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const i=this.resolvedProperty;for(let s=0,r=i.length;s!==r;++s)i[s]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const i=this.resolvedProperty;for(let s=0,r=i.length;s!==r;++s)i[s]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,i=t.objectName,s=t.propertyName;let r=t.propertyIndex;if(e||(e=kt.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(i){let c=t.objectIndex;switch(i){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let u=0;u<e.length;u++)if(e[u].name===c){c=u;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[i]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[i]}if(c!==void 0){if(e[c]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[c]}}const o=e[s];if(o===void 0){const c=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+c+"."+s+" but it wasn't found.",e);return}let a=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?a=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(a=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(r!==void 0){if(s==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[r]!==void 0&&(r=e.morphTargetDictionary[r])}l=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=r}else o.fromArray!==void 0&&o.toArray!==void 0?(l=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(l=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=s;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}kt.Composite=B5;kt.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};kt.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};kt.prototype.GetterByBindingType=[kt.prototype._getValue_direct,kt.prototype._getValue_array,kt.prototype._getValue_arrayElement,kt.prototype._getValue_toArray];kt.prototype.SetterByBindingTypeAndVersioning=[[kt.prototype._setValue_direct,kt.prototype._setValue_direct_setNeedsUpdate,kt.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[kt.prototype._setValue_array,kt.prototype._setValue_array_setNeedsUpdate,kt.prototype._setValue_array_setMatrixWorldNeedsUpdate],[kt.prototype._setValue_arrayElement,kt.prototype._setValue_arrayElement_setNeedsUpdate,kt.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[kt.prototype._setValue_fromArray,kt.prototype._setValue_fromArray_setNeedsUpdate,kt.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class D5{constructor(){this.isAnimationObjectGroup=!0,this.uuid=Lr(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let i=0,s=arguments.length;i!==s;++i)e[arguments[i].uuid]=i;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,i=this._paths,s=this._parsedPaths,r=this._bindings,o=r.length;let a,l=e.length,c=this.nCachedObjects_;for(let u=0,d=arguments.length;u!==d;++u){const f=arguments[u],p=f.uuid;let g=t[p];if(g===void 0){g=l++,t[p]=g,e.push(f);for(let A=0,v=o;A!==v;++A)r[A].push(new kt(f,i[A],s[A]))}else if(g<c){a=e[g];const A=--c,v=e[A];t[v.uuid]=g,e[g]=v,t[p]=A,e[A]=f;for(let m=0,b=o;m!==b;++m){const y=r[m],_=y[A];let E=y[g];y[g]=_,E===void 0&&(E=new kt(f,i[m],s[m])),y[A]=E}}else e[g]!==a&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=c}remove(){const e=this._objects,t=this._indicesByUUID,i=this._bindings,s=i.length;let r=this.nCachedObjects_;for(let o=0,a=arguments.length;o!==a;++o){const l=arguments[o],c=l.uuid,u=t[c];if(u!==void 0&&u>=r){const d=r++,f=e[d];t[f.uuid]=u,e[u]=f,t[c]=d,e[d]=l;for(let p=0,g=s;p!==g;++p){const A=i[p],v=A[d],m=A[u];A[u]=v,A[d]=m}}}this.nCachedObjects_=r}uncache(){const e=this._objects,t=this._indicesByUUID,i=this._bindings,s=i.length;let r=this.nCachedObjects_,o=e.length;for(let a=0,l=arguments.length;a!==l;++a){const c=arguments[a],u=c.uuid,d=t[u];if(d!==void 0)if(delete t[u],d<r){const f=--r,p=e[f],g=--o,A=e[g];t[p.uuid]=d,e[d]=p,t[A.uuid]=f,e[f]=A,e.pop();for(let v=0,m=s;v!==m;++v){const b=i[v],y=b[f],_=b[g];b[d]=y,b[f]=_,b.pop()}}else{const f=--o,p=e[f];f>0&&(t[p.uuid]=d),e[d]=p,e.pop();for(let g=0,A=s;g!==A;++g){const v=i[g];v[d]=v[f],v.pop()}}}this.nCachedObjects_=r}subscribe_(e,t){const i=this._bindingsIndicesByPath;let s=i[e];const r=this._bindings;if(s!==void 0)return r[s];const o=this._paths,a=this._parsedPaths,l=this._objects,c=l.length,u=this.nCachedObjects_,d=new Array(c);s=r.length,i[e]=s,o.push(e),a.push(t),r.push(d);for(let f=u,p=l.length;f!==p;++f){const g=l[f];d[f]=new kt(g,e,t)}return d}unsubscribe_(e){const t=this._bindingsIndicesByPath,i=t[e];if(i!==void 0){const s=this._paths,r=this._parsedPaths,o=this._bindings,a=o.length-1,l=o[a],c=e[a];t[c]=i,o[i]=l,o.pop(),r[i]=r[a],r.pop(),s[i]=s[a],s.pop()}}}class gL{constructor(e,t,i=null,s=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=i,this.blendMode=s;const r=t.tracks,o=r.length,a=new Array(o),l={endingStart:nu,endingEnd:nu};for(let c=0;c!==o;++c){const u=r[c].createInterpolant(null);a[c]=u,u.settings=l}this._interpolantSettings=l,this._interpolants=a,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=YE,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,i){if(e.fadeOut(t),this.fadeIn(t),i){const s=this._clip.duration,r=e._clip.duration,o=r/s,a=s/r;e.warp(1,o,t),this.warp(a,1,t)}return this}crossFadeTo(e,t,i){return e.crossFadeFrom(this,t,i)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,i){const s=this._mixer,r=s.time,o=this.timeScale;let a=this._timeScaleInterpolant;a===null&&(a=s._lendControlInterpolant(),this._timeScaleInterpolant=a);const l=a.parameterPositions,c=a.sampleValues;return l[0]=r,l[1]=r+i,c[0]=e/o,c[1]=t/o,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,i,s){if(!this.enabled){this._updateWeight(e);return}const r=this._startTime;if(r!==null){const l=(e-r)*i;l<0||i===0?t=0:(this._startTime=null,t=i*l)}t*=this._updateTimeScale(e);const o=this._updateTime(t),a=this._updateWeight(e);if(a>0){const l=this._interpolants,c=this._propertyBindings;switch(this.blendMode){case JE:for(let u=0,d=l.length;u!==d;++u)l[u].evaluate(o),c[u].accumulateAdditive(a);break;case bb:default:for(let u=0,d=l.length;u!==d;++u)l[u].evaluate(o),c[u].accumulate(s,a)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const i=this._weightInterpolant;if(i!==null){const s=i.evaluate(e)[0];t*=s,e>i.parameterPositions[1]&&(this.stopFading(),s===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const i=this._timeScaleInterpolant;if(i!==null){const s=i.evaluate(e)[0];t*=s,e>i.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,i=this.loop;let s=this.time+e,r=this._loopCount;const o=i===tk;if(e===0)return r===-1?s:o&&(r&1)===1?t-s:s;if(i===fm){r===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(s>=t)s=t;else if(s<0)s=0;else{this.time=s;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=s,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(r===-1&&(e>=0?(r=0,this._setEndings(!0,this.repetitions===0,o)):this._setEndings(this.repetitions===0,!0,o)),s>=t||s<0){const a=Math.floor(s/t);s-=t*a,r+=Math.abs(a);const l=this.repetitions-r;if(l<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,s=e>0?t:0,this.time=s,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(l===1){const c=e<0;this._setEndings(c,!c,o)}else this._setEndings(!1,!1,o);this._loopCount=r,this.time=s,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}else this.time=s;if(o&&(r&1)===1)return t-s}return s}_setEndings(e,t,i){const s=this._interpolantSettings;i?(s.endingStart=su,s.endingEnd=su):(e?s.endingStart=this.zeroSlopeAtStart?su:nu:s.endingStart=pm,t?s.endingEnd=this.zeroSlopeAtEnd?su:nu:s.endingEnd=pm)}_scheduleFading(e,t,i){const s=this._mixer,r=s.time;let o=this._weightInterpolant;o===null&&(o=s._lendControlInterpolant(),this._weightInterpolant=o);const a=o.parameterPositions,l=o.sampleValues;return a[0]=r,l[0]=t,a[1]=r+e,l[1]=i,this}}const O5=new Float32Array(1);class Zb extends Fn{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const i=e._localRoot||this._root,s=e._clip.tracks,r=s.length,o=e._propertyBindings,a=e._interpolants,l=i.uuid,c=this._bindingsByRootAndName;let u=c[l];u===void 0&&(u={},c[l]=u);for(let d=0;d!==r;++d){const f=s[d],p=f.name;let g=u[p];if(g!==void 0)++g.referenceCount,o[d]=g;else{if(g=o[d],g!==void 0){g._cacheIndex===null&&(++g.referenceCount,this._addInactiveBinding(g,l,p));continue}const A=t&&t._propertyBindings[d].binding.parsedPath;g=new pL(kt.create(i,p,A),f.ValueTypeName,f.getValueSize()),++g.referenceCount,this._addInactiveBinding(g,l,p),o[d]=g}a[d].resultBuffer=g.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const i=(e._localRoot||this._root).uuid,s=e._clip.uuid,r=this._actionsByClip[s];this._bindAction(e,r&&r.knownActions[0]),this._addInactiveAction(e,s,i)}const t=e._propertyBindings;for(let i=0,s=t.length;i!==s;++i){const r=t[i];r.useCount++===0&&(this._lendBinding(r),r.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let i=0,s=t.length;i!==s;++i){const r=t[i];--r.useCount===0&&(r.restoreOriginalState(),this._takeBackBinding(r))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,i){const s=this._actions,r=this._actionsByClip;let o=r[t];if(o===void 0)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,r[t]=o;else{const a=o.knownActions;e._byClipCacheIndex=a.length,a.push(e)}e._cacheIndex=s.length,s.push(e),o.actionByRoot[i]=e}_removeInactiveAction(e){const t=this._actions,i=t[t.length-1],s=e._cacheIndex;i._cacheIndex=s,t[s]=i,t.pop(),e._cacheIndex=null;const r=e._clip.uuid,o=this._actionsByClip,a=o[r],l=a.knownActions,c=l[l.length-1],u=e._byClipCacheIndex;c._byClipCacheIndex=u,l[u]=c,l.pop(),e._byClipCacheIndex=null;const d=a.actionByRoot,f=(e._localRoot||this._root).uuid;delete d[f],l.length===0&&delete o[r],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let i=0,s=t.length;i!==s;++i){const r=t[i];--r.referenceCount===0&&this._removeInactiveBinding(r)}}_lendAction(e){const t=this._actions,i=e._cacheIndex,s=this._nActiveActions++,r=t[s];e._cacheIndex=s,t[s]=e,r._cacheIndex=i,t[i]=r}_takeBackAction(e){const t=this._actions,i=e._cacheIndex,s=--this._nActiveActions,r=t[s];e._cacheIndex=s,t[s]=e,r._cacheIndex=i,t[i]=r}_addInactiveBinding(e,t,i){const s=this._bindingsByRootAndName,r=this._bindings;let o=s[t];o===void 0&&(o={},s[t]=o),o[i]=e,e._cacheIndex=r.length,r.push(e)}_removeInactiveBinding(e){const t=this._bindings,i=e.binding,s=i.rootNode.uuid,r=i.path,o=this._bindingsByRootAndName,a=o[s],l=t[t.length-1],c=e._cacheIndex;l._cacheIndex=c,t[c]=l,t.pop(),delete a[r],Object.keys(a).length===0&&delete o[s]}_lendBinding(e){const t=this._bindings,i=e._cacheIndex,s=this._nActiveBindings++,r=t[s];e._cacheIndex=s,t[s]=e,r._cacheIndex=i,t[i]=r}_takeBackBinding(e){const t=this._bindings,i=e._cacheIndex,s=--this._nActiveBindings,r=t[s];e._cacheIndex=s,t[s]=e,r._cacheIndex=i,t[i]=r}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let i=e[t];return i===void 0&&(i=new xM(new Float32Array(2),new Float32Array(2),1,O5),i.__cacheIndex=t,e[t]=i),i}_takeBackControlInterpolant(e){const t=this._controlInterpolants,i=e.__cacheIndex,s=--this._nActiveControlInterpolants,r=t[s];e.__cacheIndex=s,t[s]=e,r.__cacheIndex=i,t[i]=r}clipAction(e,t,i){const s=t||this._root,r=s.uuid;let o=typeof e=="string"?fr.findByName(s,e):e;const a=o!==null?o.uuid:e,l=this._actionsByClip[a];let c=null;if(i===void 0&&(o!==null?i=o.blendMode:i=bb),l!==void 0){const d=l.actionByRoot[r];if(d!==void 0&&d.blendMode===i)return d;c=l.knownActions[0],o===null&&(o=c._clip)}if(o===null)return null;const u=new gL(this,o,t,i);return this._bindAction(u,c),this._addInactiveAction(u,a,r),u}existingAction(e,t){const i=t||this._root,s=i.uuid,r=typeof e=="string"?fr.findByName(i,e):e,o=r?r.uuid:e,a=this._actionsByClip[o];return a!==void 0&&a.actionByRoot[s]||null}stopAllAction(){const e=this._actions,t=this._nActiveActions;for(let i=t-1;i>=0;--i)e[i].stop();return this}update(e){e*=this.timeScale;const t=this._actions,i=this._nActiveActions,s=this.time+=e,r=Math.sign(e),o=this._accuIndex^=1;for(let c=0;c!==i;++c)t[c]._update(s,e,r,o);const a=this._bindings,l=this._nActiveBindings;for(let c=0;c!==l;++c)a[c].apply(o);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,i=e.uuid,s=this._actionsByClip,r=s[i];if(r!==void 0){const o=r.knownActions;for(let a=0,l=o.length;a!==l;++a){const c=o[a];this._deactivateAction(c);const u=c._cacheIndex,d=t[t.length-1];c._cacheIndex=null,c._byClipCacheIndex=null,d._cacheIndex=u,t[u]=d,t.pop(),this._removeInactiveBindingsForAction(c)}delete s[i]}}uncacheRoot(e){const t=e.uuid,i=this._actionsByClip;for(const o in i){const a=i[o].actionByRoot,l=a[t];l!==void 0&&(this._deactivateAction(l),this._removeInactiveAction(l))}const s=this._bindingsByRootAndName,r=s[t];if(r!==void 0)for(const o in r){const a=r[o];a.restoreOriginalState(),this._removeInactiveBinding(a)}}uncacheAction(e,t){const i=this.existingAction(e,t);i!==null&&(this._deactivateAction(i),this._removeInactiveAction(i))}}class xe{constructor(e){this.value=e}clone(){return new xe(this.value.clone===void 0?this.value:this.value.clone())}}let k5=0;class L5 extends Fn{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:k5++}),this.name="",this.usage=gm,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const t=this.uniforms.indexOf(e);return t!==-1&&this.uniforms.splice(t,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(e){this.name=e.name,this.usage=e.usage;const t=e.uniforms;this.uniforms.length=0;for(let i=0,s=t.length;i<s;i++)this.uniforms.push(t[i].clone());return this}clone(){return new this.constructor().copy(this)}}class F5 extends $m{constructor(e,t,i=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}class U5{constructor(e,t,i,s,r){this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=t,this.itemSize=i,this.elementSize=s,this.count=r,this.version=0}set needsUpdate(e){e===!0&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}let Uu=class{constructor(e,t,i=0,s=1/0){this.ray=new Qa(e,t),this.near=i,this.far=s,this.camera=null,this.layers=new Ss,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,i=[]){return rC(e,this,i,t),i.sort(MR),i}intersectObjects(e,t=!0,i=[]){for(let s=0,r=e.length;s<r;s++)rC(e[s],this,i,t);return i.sort(MR),i}};function MR(n,e){return n.distance-e.distance}function rC(n,e,t,i){if(n.layers.test(e.layers)&&n.raycast(e,t),i===!0){const s=n.children;for(let r=0,o=s.length;r<o;r++)rC(s[r],e,t,!0)}}class oC{constructor(e=1,t=0,i=0){return this.radius=e,this.phi=t,this.theta=i,this}set(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(nn(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class N5{constructor(e=1,t=0,i=0){return this.radius=e,this.theta=t,this.y=i,this}set(e,t,i){return this.radius=e,this.theta=t,this.y=i,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+i*i),this.theta=Math.atan2(e,i),this.y=t,this}clone(){return new this.constructor().copy(this)}}const TR=new te;class z5{constructor(e=new te(1/0,1/0),t=new te(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=TR.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,TR).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const IR=new w,Sv=new w;class mL{constructor(e=new w,t=new w){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){IR.subVectors(e,this.start),Sv.subVectors(this.end,this.start);const i=Sv.dot(Sv);let r=Sv.dot(IR)/i;return t&&(r=nn(r,0,1)),r}closestPointToPoint(e,t,i){const s=this.closestPointToPointParameter(e,t);return this.delta(i).multiplyScalar(s).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const RR=new w;class G5 extends Me{constructor(e,t){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";const i=new ft,s=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let o=0,a=1,l=32;o<l;o++,a++){const c=o/l*Math.PI*2,u=a/l*Math.PI*2;s.push(Math.cos(c),Math.sin(c),1,Math.cos(u),Math.sin(u),1)}i.setAttribute("position",new st(s,3));const r=new Sn({fog:!1,toneMapped:!1});this.cone=new wo(i,r),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),RR.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(RR),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const lc=new w,Cv=new Ie,Kx=new Ie;class V5 extends wo{constructor(e){const t=AL(e),i=new ft,s=[],r=[],o=new _e(0,0,1),a=new _e(0,1,0);for(let c=0;c<t.length;c++){const u=t[c];u.parent&&u.parent.isBone&&(s.push(0,0,0),s.push(0,0,0),r.push(o.r,o.g,o.b),r.push(a.r,a.g,a.b))}i.setAttribute("position",new st(s,3)),i.setAttribute("color",new st(r,3));const l=new Sn({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(i,l),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,i=this.geometry,s=i.getAttribute("position");Kx.copy(this.root.matrixWorld).invert();for(let r=0,o=0;r<t.length;r++){const a=t[r];a.parent&&a.parent.isBone&&(Cv.multiplyMatrices(Kx,a.matrixWorld),lc.setFromMatrixPosition(Cv),s.setXYZ(o,lc.x,lc.y,lc.z),Cv.multiplyMatrices(Kx,a.parent.matrixWorld),lc.setFromMatrixPosition(Cv),s.setXYZ(o+1,lc.x,lc.y,lc.z),o+=2)}i.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose()}}function AL(n){const e=[];n.isBone===!0&&e.push(n);for(let t=0;t<n.children.length;t++)e.push.apply(e,AL(n.children[t]));return e}class H5 extends ye{constructor(e,t,i){const s=new So(t,4,2),r=new ai({wireframe:!0,fog:!1,toneMapped:!1});super(s,r),this.light=e,this.color=i,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const Q5=new w,PR=new _e,BR=new _e;class W5 extends Me{constructor(e,t,i){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,this.type="HemisphereLightHelper";const s=new Cl(t);s.rotateY(Math.PI*.5),this.material=new ai({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const r=s.getAttribute("position"),o=new Float32Array(r.count*3);s.setAttribute("color",new ot(o,3)),this.add(new ye(s,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");PR.copy(this.light.color),BR.copy(this.light.groundColor);for(let i=0,s=t.count;i<s;i++){const r=i<s/2?PR:BR;t.setXYZ(i,r.r,r.g,r.b)}t.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(Q5.setFromMatrixPosition(this.light.matrixWorld).negate())}}let OM=class extends wo{constructor(e=10,t=10,i=4473924,s=8947848){i=new _e(i),s=new _e(s);const r=t/2,o=e/t,a=e/2,l=[],c=[];for(let f=0,p=0,g=-a;f<=t;f++,g+=o){l.push(-a,0,g,a,0,g),l.push(g,0,-a,g,0,a);const A=f===r?i:s;A.toArray(c,p),p+=3,A.toArray(c,p),p+=3,A.toArray(c,p),p+=3,A.toArray(c,p),p+=3}const u=new ft;u.setAttribute("position",new st(l,3)),u.setAttribute("color",new st(c,3));const d=new Sn({vertexColors:!0,toneMapped:!1});super(u,d),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}};class j5 extends wo{constructor(e=10,t=16,i=8,s=64,r=4473924,o=8947848){r=new _e(r),o=new _e(o);const a=[],l=[];if(t>1)for(let d=0;d<t;d++){const f=d/t*(Math.PI*2),p=Math.sin(f)*e,g=Math.cos(f)*e;a.push(0,0,0),a.push(p,0,g);const A=d&1?r:o;l.push(A.r,A.g,A.b),l.push(A.r,A.g,A.b)}for(let d=0;d<i;d++){const f=d&1?r:o,p=e-e/i*d;for(let g=0;g<s;g++){let A=g/s*(Math.PI*2),v=Math.sin(A)*p,m=Math.cos(A)*p;a.push(v,0,m),l.push(f.r,f.g,f.b),A=(g+1)/s*(Math.PI*2),v=Math.sin(A)*p,m=Math.cos(A)*p,a.push(v,0,m),l.push(f.r,f.g,f.b)}}const c=new ft;c.setAttribute("position",new st(a,3)),c.setAttribute("color",new st(l,3));const u=new Sn({vertexColors:!0,toneMapped:!1});super(c,u),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const DR=new w,Ev=new w,OR=new w;class vL extends Me{constructor(e,t,i){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,this.type="DirectionalLightHelper",t===void 0&&(t=1);let s=new ft;s.setAttribute("position",new st([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const r=new Sn({fog:!1,toneMapped:!1});this.lightPlane=new dn(s,r),this.add(this.lightPlane),s=new ft,s.setAttribute("position",new st([0,0,0,0,0,1],3)),this.targetLine=new dn(s,r),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),DR.setFromMatrixPosition(this.light.matrixWorld),Ev.setFromMatrixPosition(this.light.target.matrixWorld),OR.subVectors(Ev,DR),this.lightPlane.lookAt(Ev),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Ev),this.targetLine.scale.z=OR.length()}}const Mv=new w,Ki=new qf;class yL extends wo{constructor(e){const t=new ft,i=new Sn({color:16777215,vertexColors:!0,toneMapped:!1}),s=[],r=[],o={};a("n1","n2"),a("n2","n4"),a("n4","n3"),a("n3","n1"),a("f1","f2"),a("f2","f4"),a("f4","f3"),a("f3","f1"),a("n1","f1"),a("n2","f2"),a("n3","f3"),a("n4","f4"),a("p","n1"),a("p","n2"),a("p","n3"),a("p","n4"),a("u1","u2"),a("u2","u3"),a("u3","u1"),a("c","t"),a("p","c"),a("cn1","cn2"),a("cn3","cn4"),a("cf1","cf2"),a("cf3","cf4");function a(g,A){l(g),l(A)}function l(g){s.push(0,0,0),r.push(0,0,0),o[g]===void 0&&(o[g]=[]),o[g].push(s.length/3-1)}t.setAttribute("position",new st(s,3)),t.setAttribute("color",new st(r,3)),super(t,i),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update();const c=new _e(16755200),u=new _e(16711680),d=new _e(43775),f=new _e(16777215),p=new _e(3355443);this.setColors(c,u,d,f,p)}setColors(e,t,i,s,r){const a=this.geometry.getAttribute("color");a.setXYZ(0,e.r,e.g,e.b),a.setXYZ(1,e.r,e.g,e.b),a.setXYZ(2,e.r,e.g,e.b),a.setXYZ(3,e.r,e.g,e.b),a.setXYZ(4,e.r,e.g,e.b),a.setXYZ(5,e.r,e.g,e.b),a.setXYZ(6,e.r,e.g,e.b),a.setXYZ(7,e.r,e.g,e.b),a.setXYZ(8,e.r,e.g,e.b),a.setXYZ(9,e.r,e.g,e.b),a.setXYZ(10,e.r,e.g,e.b),a.setXYZ(11,e.r,e.g,e.b),a.setXYZ(12,e.r,e.g,e.b),a.setXYZ(13,e.r,e.g,e.b),a.setXYZ(14,e.r,e.g,e.b),a.setXYZ(15,e.r,e.g,e.b),a.setXYZ(16,e.r,e.g,e.b),a.setXYZ(17,e.r,e.g,e.b),a.setXYZ(18,e.r,e.g,e.b),a.setXYZ(19,e.r,e.g,e.b),a.setXYZ(20,e.r,e.g,e.b),a.setXYZ(21,e.r,e.g,e.b),a.setXYZ(22,e.r,e.g,e.b),a.setXYZ(23,e.r,e.g,e.b),a.setXYZ(24,t.r,t.g,t.b),a.setXYZ(25,t.r,t.g,t.b),a.setXYZ(26,t.r,t.g,t.b),a.setXYZ(27,t.r,t.g,t.b),a.setXYZ(28,t.r,t.g,t.b),a.setXYZ(29,t.r,t.g,t.b),a.setXYZ(30,t.r,t.g,t.b),a.setXYZ(31,t.r,t.g,t.b),a.setXYZ(32,i.r,i.g,i.b),a.setXYZ(33,i.r,i.g,i.b),a.setXYZ(34,i.r,i.g,i.b),a.setXYZ(35,i.r,i.g,i.b),a.setXYZ(36,i.r,i.g,i.b),a.setXYZ(37,i.r,i.g,i.b),a.setXYZ(38,s.r,s.g,s.b),a.setXYZ(39,s.r,s.g,s.b),a.setXYZ(40,r.r,r.g,r.b),a.setXYZ(41,r.r,r.g,r.b),a.setXYZ(42,r.r,r.g,r.b),a.setXYZ(43,r.r,r.g,r.b),a.setXYZ(44,r.r,r.g,r.b),a.setXYZ(45,r.r,r.g,r.b),a.setXYZ(46,r.r,r.g,r.b),a.setXYZ(47,r.r,r.g,r.b),a.setXYZ(48,r.r,r.g,r.b),a.setXYZ(49,r.r,r.g,r.b),a.needsUpdate=!0}update(){const e=this.geometry,t=this.pointMap,i=1,s=1;Ki.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),an("c",t,e,Ki,0,0,-1),an("t",t,e,Ki,0,0,1),an("n1",t,e,Ki,-i,-s,-1),an("n2",t,e,Ki,i,-s,-1),an("n3",t,e,Ki,-i,s,-1),an("n4",t,e,Ki,i,s,-1),an("f1",t,e,Ki,-i,-s,1),an("f2",t,e,Ki,i,-s,1),an("f3",t,e,Ki,-i,s,1),an("f4",t,e,Ki,i,s,1),an("u1",t,e,Ki,i*.7,s*1.1,-1),an("u2",t,e,Ki,-i*.7,s*1.1,-1),an("u3",t,e,Ki,0,s*2,-1),an("cf1",t,e,Ki,-i,0,1),an("cf2",t,e,Ki,i,0,1),an("cf3",t,e,Ki,0,-s,1),an("cf4",t,e,Ki,0,s,1),an("cn1",t,e,Ki,-i,0,-1),an("cn2",t,e,Ki,i,0,-1),an("cn3",t,e,Ki,0,-s,-1),an("cn4",t,e,Ki,0,s,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function an(n,e,t,i,s,r,o){Mv.set(s,r,o).unproject(i);const a=e[n];if(a!==void 0){const l=t.getAttribute("position");for(let c=0,u=a.length;c<u;c++)l.setXYZ(a[c],Mv.x,Mv.y,Mv.z)}}const Tv=new Bn;class $b extends wo{constructor(e,t=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),s=new Float32Array(8*3),r=new ft;r.setIndex(new ot(i,1)),r.setAttribute("position",new ot(s,3)),super(r,new Sn({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(e!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&Tv.setFromObject(this.object),Tv.isEmpty())return;const t=Tv.min,i=Tv.max,s=this.geometry.attributes.position,r=s.array;r[0]=i.x,r[1]=i.y,r[2]=i.z,r[3]=t.x,r[4]=i.y,r[5]=i.z,r[6]=t.x,r[7]=t.y,r[8]=i.z,r[9]=i.x,r[10]=t.y,r[11]=i.z,r[12]=i.x,r[13]=i.y,r[14]=t.z,r[15]=t.x,r[16]=i.y,r[17]=t.z,r[18]=t.x,r[19]=t.y,r[20]=t.z,r[21]=i.x,r[22]=t.y,r[23]=t.z,s.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,t){return super.copy(e,t),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class aC extends wo{constructor(e,t=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),s=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],r=new ft;r.setIndex(new ot(i,1)),r.setAttribute("position",new st(s,3)),super(r,new Sn({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class q5 extends dn{constructor(e,t=1,i=16776960){const s=i,r=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],o=new ft;o.setAttribute("position",new st(r,3)),o.computeBoundingSphere(),super(o,new Sn({color:s,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const a=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],l=new ft;l.setAttribute("position",new st(a,3)),l.computeBoundingSphere(),this.add(new ye(l,new ai({color:s,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const kR=new w;let Iv,Zx;class X5 extends Me{constructor(e=new w(0,0,1),t=new w(0,0,0),i=1,s=16776960,r=i*.2,o=r*.2){super(),this.type="ArrowHelper",Iv===void 0&&(Iv=new ft,Iv.setAttribute("position",new st([0,0,0,0,1,0],3)),Zx=new cn(0,.5,1,5,1),Zx.translate(0,-.5,0)),this.position.copy(t),this.line=new dn(Iv,new Sn({color:s,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new ye(Zx,new ai({color:s,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(i,r,o)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{kR.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(kR,t)}}setLength(e,t=e*.2,i=t*.2){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(i,t,i),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}let Zf=class extends wo{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],i=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],s=new ft;s.setAttribute("position",new st(t,3)),s.setAttribute("color",new st(i,3));const r=new Sn({vertexColors:!0,toneMapped:!1});super(s,r),this.type="AxesHelper"}setColors(e,t,i){const s=new _e,r=this.geometry.attributes.color.array;return s.set(e),s.toArray(r,0),s.toArray(r,3),s.set(t),s.toArray(r,6),s.toArray(r,9),s.set(i),s.toArray(r,12),s.toArray(r,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}};class Y5{constructor(){this.type="ShapePath",this.color=new _e,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new vm,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,i,s){return this.currentPath.quadraticCurveTo(e,t,i,s),this}bezierCurveTo(e,t,i,s,r,o){return this.currentPath.bezierCurveTo(e,t,i,s,r,o),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function t(m){const b=[];for(let y=0,_=m.length;y<_;y++){const E=m[y],M=new gu;M.curves=E.curves,b.push(M)}return b}function i(m,b){const y=b.length;let _=!1;for(let E=y-1,M=0;M<y;E=M++){let I=b[E],R=b[M],C=R.x-I.x,T=R.y-I.y;if(Math.abs(T)>Number.EPSILON){if(T<0&&(I=b[M],C=-C,R=b[E],T=-T),m.y<I.y||m.y>R.y)continue;if(m.y===I.y){if(m.x===I.x)return!0}else{const O=T*(m.x-I.x)-C*(m.y-I.y);if(O===0)return!0;if(O<0)continue;_=!_}}else{if(m.y!==I.y)continue;if(R.x<=m.x&&m.x<=I.x||I.x<=m.x&&m.x<=R.x)return!0}}return _}const s=La.isClockWise,r=this.subPaths;if(r.length===0)return[];let o,a,l;const c=[];if(r.length===1)return a=r[0],l=new gu,l.curves=a.curves,c.push(l),c;let u=!s(r[0].getPoints());u=e?!u:u;const d=[],f=[];let p=[],g=0,A;f[g]=void 0,p[g]=[];for(let m=0,b=r.length;m<b;m++)a=r[m],A=a.getPoints(),o=s(A),o=e?!o:o,o?(!u&&f[g]&&g++,f[g]={s:new gu,p:A},f[g].s.curves=a.curves,u&&g++,p[g]=[]):p[g].push({h:a,p:A[0]});if(!f[0])return t(r);if(f.length>1){let m=!1,b=0;for(let y=0,_=f.length;y<_;y++)d[y]=[];for(let y=0,_=f.length;y<_;y++){const E=p[y];for(let M=0;M<E.length;M++){const I=E[M];let R=!0;for(let C=0;C<f.length;C++)i(I.p,f[C].p)&&(y!==C&&b++,R?(R=!1,d[C].push(I)):m=!0);R&&d[y].push(I)}}b>0&&m===!1&&(p=d)}let v;for(let m=0,b=f.length;m<b;m++){l=f[m].s,c.push(l),v=p[m];for(let y=0,_=v.length;y<_;y++)l.holes.push(v[y].h)}return c}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:nh}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=nh);const J5=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:GE,AddEquation:Hh,AddOperation:qO,AdditiveAnimationBlendMode:JE,AdditiveBlending:Mf,AlphaFormat:ZO,AlwaysCompare:Sk,AlwaysDepth:pb,AlwaysStencilFunc:$E,AmbientLight:MM,AmbientLightProbe:y5,AnimationAction:gL,AnimationClip:fr,AnimationLoader:h5,AnimationMixer:Zb,AnimationObjectGroup:D5,AnimationUtils:o5,ArcCurve:Qk,ArrayCamera:Lk,ArrowHelper:X5,Audio:PM,AudioAnalyser:w5,AudioContext:IM,AudioListener:dL,AudioLoader:o0,AxesHelper:Zf,BackSide:fn,BasicDepthPacking:hs,BasicShadowMap:X3,Bone:eA,BooleanKeyframeTrack:Lu,Box2:z5,Box3:Bn,Box3Helper:aC,BoxGeometry:Ei,BoxHelper:$b,BufferAttribute:ot,BufferGeometry:ft,BufferGeometryLoader:hL,ByteType:JO,Cache:Mu,Camera:qf,CameraHelper:yL,CanvasTexture:Hk,CapsuleGeometry:kb,CatmullRomCurve3:Wk,CineonToneMapping:XO,CircleGeometry:Lb,ClampToEdgeWrapping:Wn,Clock:RM,Color:_e,ColorKeyframeTrack:wM,ColorManagement:io,CompressedArrayTexture:Vk,CompressedTexture:Ol,CompressedTextureLoader:u5,ConeGeometry:Fb,CubeCamera:sM,CubeReflectionMapping:qc,CubeRefractionMapping:Xc,CubeTexture:Zm,CubeTextureLoader:d5,CubeUVReflectionMapping:jf,CubicBezierCurve:fM,CubicBezierCurve3:jk,CubicInterpolant:rL,CullFaceBack:TS,CullFaceFront:DO,CullFaceFrontBack:q3,CullFaceNone:BO,Curve:Zo,CurvePath:Xk,CustomBlending:OO,CustomToneMapping:YO,CylinderGeometry:cn,Cylindrical:N5,Data3DTexture:wb,DataArrayTexture:xb,DataTexture:Ao,DataTextureLoader:SM,DataUtils:ru,DecrementStencilOp:ak,DecrementWrapStencilOp:ck,DefaultLoadingManager:lL,DepthFormat:Fc,DepthStencilFormat:Yc,DepthTexture:Ib,DirectionalLight:Jb,DirectionalLightHelper:vL,DiscreteInterpolant:oL,DisplayP3ColorSpace:ZE,DodecahedronGeometry:Ub,DoubleSide:wi,DstAlphaFactor:GO,DstColorFactor:HO,DynamicCopyUsage:rz,DynamicDrawUsage:xs,DynamicReadUsage:iz,EdgesGeometry:vM,EllipseCurve:Db,EqualCompare:yk,EqualDepth:If,EqualStencilFunc:dk,EquirectangularReflectionMapping:mo,EquirectangularRefractionMapping:Rf,Euler:pn,EventDispatcher:Fn,ExtrudeGeometry:zb,FileLoader:Dn,Float16BufferAttribute:jz,Float32BufferAttribute:st,Float64BufferAttribute:qz,FloatType:sn,Fog:aM,FogExp2:Rb,FramebufferTexture:R4,FrontSide:Es,Frustum:Eb,GLBufferAttribute:U5,GLSL1:az,GLSL3:n0,GreaterCompare:_k,GreaterDepth:mb,GreaterEqualCompare:wk,GreaterEqualDepth:gb,GreaterEqualStencilFunc:mk,GreaterStencilFunc:pk,GridHelper:OM,Group:ar,HalfFloatType:xn,HemisphereLight:CM,HemisphereLightHelper:W5,HemisphereLightProbe:v5,IcosahedronGeometry:iA,ImageBitmapLoader:uL,ImageLoader:xm,ImageUtils:tM,IncrementStencilOp:ok,IncrementWrapStencilOp:lk,InstancedBufferAttribute:Mr,InstancedBufferGeometry:TM,InstancedInterleavedBuffer:F5,InstancedMesh:Pb,Int16BufferAttribute:Qz,Int32BufferAttribute:Wz,Int8BufferAttribute:Gz,IntType:VE,InterleavedBuffer:$m,InterleavedBufferAttribute:Gl,Interpolant:Kf,InterpolateDiscrete:Su,InterpolateLinear:Jc,InterpolateSmooth:wy,InvertStencilOp:hk,KeepStencilOp:Sg,KeyframeTrack:dr,LOD:cM,LatheGeometry:tA,Layers:Ss,LessCompare:vk,LessDepth:um,LessEqualCompare:bk,LessEqualDepth:Tf,LessEqualStencilFunc:fk,LessStencilFunc:uk,Light:lh,LightProbe:Of,Line:dn,Line3:mL,LineBasicMaterial:Sn,LineCurve:Ob,LineCurve3:qk,LineDashedMaterial:nL,LineLoop:hM,LineSegments:wo,LinearEncoding:Km,LinearFilter:Dt,LinearInterpolant:xM,LinearMipMapLinearFilter:$3,LinearMipMapNearestFilter:Z3,LinearMipmapLinearFilter:yo,LinearMipmapNearestFilter:Jm,LinearSRGBColorSpace:gn,LinearToneMapping:dm,Loader:ds,LoaderUtils:kf,LoadingManager:qb,LoopOnce:fm,LoopPingPong:tk,LoopRepeat:YE,LuminanceAlphaFormat:$O,LuminanceFormat:yb,MOUSE:Uh,Material:Pt,MaterialLoader:Kb,MathUtils:cs,Matrix3:It,Matrix4:Ie,MaxEquation:BS,Mesh:ye,MeshBasicMaterial:ai,MeshDepthMaterial:Tb,MeshDistanceMaterial:oM,MeshLambertMaterial:tL,MeshMatcapMaterial:iL,MeshNormalMaterial:yM,MeshPhongMaterial:$k,MeshPhysicalMaterial:bo,MeshStandardMaterial:Yo,MeshToonMaterial:eL,MinEquation:PS,MirroredRepeatWrapping:wu,MixOperation:jO,MultiplyBlending:RS,MultiplyOperation:Ym,NearestFilter:Ft,NearestMipMapLinearFilter:K3,NearestMipMapNearestFilter:J3,NearestMipmapLinearFilter:fu,NearestMipmapNearestFilter:Pf,NeverCompare:Ak,NeverDepth:NE,NeverStencilFunc:KS,NoBlending:qi,NoColorSpace:ur,NoToneMapping:Qs,NormalAnimationBlendMode:bb,NormalBlending:Lc,NotEqualCompare:xk,NotEqualDepth:Xm,NotEqualStencilFunc:gk,NumberKeyframeTrack:Eu,Object3D:Me,ObjectLoader:m5,ObjectSpaceNormalMap:nk,OctahedronGeometry:Cl,OneFactor:UO,OneMinusDstAlphaFactor:VO,OneMinusDstColorFactor:QO,OneMinusSrcAlphaFactor:UE,OneMinusSrcColorFactor:zO,OrthographicCamera:rh,PCFShadowMap:kE,PCFSoftShadowMap:LE,PMREMGenerator:$S,Path:vm,PerspectiveCamera:qt,Plane:Ir,PlaneGeometry:us,PlaneHelper:q5,PointLight:Yb,PointLightHelper:H5,Points:uM,PointsMaterial:Bb,PolarGridHelper:j5,PolyhedronGeometry:ah,PositionalAudio:fL,PropertyBinding:kt,PropertyMixer:pL,QuadraticBezierCurve:pM,QuadraticBezierCurve3:gM,Quaternion:Se,QuaternionKeyframeTrack:Vl,QuaternionLinearInterpolant:aL,RED_GREEN_RGTC2_Format:YS,RED_RGTC1_Format:ek,REVISION:nh,RGBADepthPacking:_b,RGBAFormat:Ti,RGBAIntegerFormat:qE,RGBA_ASTC_10x10_Format:WS,RGBA_ASTC_10x5_Format:VS,RGBA_ASTC_10x6_Format:HS,RGBA_ASTC_10x8_Format:QS,RGBA_ASTC_12x10_Format:jS,RGBA_ASTC_12x12_Format:qS,RGBA_ASTC_4x4_Format:t0,RGBA_ASTC_5x4_Format:kS,RGBA_ASTC_5x5_Format:LS,RGBA_ASTC_6x5_Format:FS,RGBA_ASTC_6x6_Format:US,RGBA_ASTC_8x5_Format:NS,RGBA_ASTC_8x6_Format:zS,RGBA_ASTC_8x8_Format:GS,RGBA_BPTC_Format:wg,RGBA_ETC2_EAC_Format:e0,RGBA_PVRTC_2BPPV1_Format:OS,RGBA_PVRTC_4BPPV1_Format:Zy,RGBA_S3TC_DXT1_Format:_y,RGBA_S3TC_DXT3_Format:xy,RGBA_S3TC_DXT5_Format:xg,RGB_ETC1_Format:XE,RGB_ETC2_Format:$y,RGB_PVRTC_2BPPV1_Format:DS,RGB_PVRTC_4BPPV1_Format:Ky,RGB_S3TC_DXT1_Format:_g,RGFormat:iu,RGIntegerFormat:jE,RawShaderMaterial:jb,Ray:Qa,Raycaster:Uu,RectAreaLight:cL,RedFormat:wl,RedIntegerFormat:WE,ReinhardToneMapping:zE,RepeatWrapping:vo,ReplaceStencilOp:rk,ReverseSubtractEquation:LO,RingGeometry:nA,SIGNED_RED_GREEN_RGTC2_Format:JS,SIGNED_RED_RGTC1_Format:XS,SRGBColorSpace:Je,Scene:mr,ShaderChunk:Tt,ShaderLib:Rr,ShaderMaterial:Bt,ShadowMaterial:Wb,Shape:gu,ShapeGeometry:Gb,ShapePath:Y5,ShapeUtils:La,ShortType:KO,Skeleton:Jf,SkeletonHelper:V5,SkinnedMesh:Yf,Source:Sl,Sphere:Ys,SphereGeometry:So,Spherical:oC,SphericalHarmonics3:jd,SplineCurve:mM,SpotLight:Xb,SpotLightHelper:G5,Sprite:zk,SpriteMaterial:lM,SrcAlphaFactor:FE,SrcAlphaSaturateFactor:WO,SrcColorFactor:NO,StaticCopyUsage:sz,StaticDrawUsage:gm,StaticReadUsage:tz,StereoCamera:b5,StreamCopyUsage:oz,StreamDrawUsage:ez,StreamReadUsage:nz,StringKeyframeTrack:Fu,SubtractEquation:kO,SubtractiveBlending:IS,TOUCH:Nh,TangentSpaceNormalMap:sh,TetrahedronGeometry:Vb,Texture:Rt,TextureLoader:kl,TorusGeometry:bl,TorusKnotGeometry:Hb,Triangle:Vs,TriangleFanDrawMode:i0,TriangleStripDrawMode:KE,TrianglesDrawMode:ik,TubeGeometry:Qb,TwoPassDoubleSide:Y3,UVMapping:Ab,Uint16BufferAttribute:iM,Uint32BufferAttribute:nM,Uint8BufferAttribute:Vz,Uint8ClampedBufferAttribute:Hz,Uniform:xe,UniformsGroup:L5,UniformsLib:Ue,UniformsUtils:Sb,UnsignedByteType:fi,UnsignedInt248Type:Dl,UnsignedIntType:Pa,UnsignedShort4444Type:HE,UnsignedShort5551Type:QE,UnsignedShortType:vb,VSMShadowMap:ha,Vector2:te,Vector3:w,Vector4:Ke,VectorKeyframeTrack:Kc,VideoTexture:Gk,WebGL1Renderer:Fk,WebGL3DRenderTarget:Pz,WebGLArrayRenderTarget:Rz,WebGLCoordinateSystem:Ba,WebGLCubeRenderTarget:Cb,WebGLMultipleRenderTargets:Mk,WebGLRenderTarget:ni,WebGLRenderer:oh,WebGLUtils:kk,WebGPUCoordinateSystem:mm,WireframeGeometry:Zk,WrapAroundEnding:pm,ZeroCurvatureEnding:nu,ZeroFactor:FO,ZeroSlopeEnding:su,ZeroStencilOp:sk,_SRGBAFormat:s0,sRGBEncoding:ka},Symbol.toStringTag,{value:"Module"})),LR=()=>n=>n;class Lf{constructor(e,t){h(this,"_factory");h(this,"_cache",[]);h(this,"_maxSize");h(this,"_index",0);this._factory=e,this._maxSize=t}get(){const e=this._index%this._maxSize;return this._index++,this._cache.length<=e&&(this._cache[e]=this._factory()),this._cache[e]}}let kM=!1;const lC=[];setTimeout(()=>{kM&&console.log(lC.sort())},100);function LM(){var n;return new URLSearchParams((n=globalThis.location)==null?void 0:n.search)}function re(n){kM&&!lC.includes(n)&&lC.push(n);const e=LM();if(e.has(n)){const t=e.get(n);if(t){const i=Number(t);return isNaN(i)?t:i}else return!0}return!1}kM=re("help")===!0;function K5(n,e,t=!0){const i=LM();i.has(n)?e===null?i.delete(n):i.set(n,e):e!==null&&i.append(n,e),t?Z5(n,i):bL(n,i)}function a0(n,e,t){n.has(e)?n.set(e,t.toString()):n.append(e,t.toString())}function Z5(n,e,t){window.history.pushState(t,n,"?"+e.toString())}function bL(n,e,t){window.history.replaceState(t,n,"?"+e.toString())}function $5(n,e){return Math.floor(Math.random()*(e-n+1))+n}const FR=["smol","tiny","giant","interesting","smart","bright","dull","extreme","beautiful","pretty","dark","epic","salty","silly","funny","lame","lazy","loud","lucky","mad","mean","mighty","mysterious","nasty","odd","old","powerful","quiet","rapid","scary","shiny","shy","silly","smooth","sour","spicy","stupid","sweet","tasty","terrible","ugly","unusual","vast","wet","wild","witty","wrong","zany","zealous","zippy","zombie","zorro"],UR=["cat","dog","mouse","pig","cow","horse","sheep","chicken","duck","goat","panda","tiger","lion","elephant","monkey","bird","fish","snake","frog","turtle","hamster","penguin","kangaroo","whale","dolphin","crocodile","snail","ant","bee","beetle","butterfly","dragon","eagle","fish","giraffe","lizard","panda","penguin","rabbit","snake","spider","tiger","zebra"];function e8(){const n=FR[Math.floor(Math.random()*FR.length)],e=UR[Math.floor(Math.random()*UR.length)];return n+"_"+e}function t8(n){return n=n.replace(/[^a-z0-9 \.,_-]/gim,""),n.trim()}function wm(n,e,t=!0,i=!1){var s;if(e==null)return null;if(e.userData&&e.userData.guid===n)return e;if(e.guid==n)return e;if(i&&(s=e.userData)!=null&&s.components){for(const r of e.userData.components)if(r.guid===n)return r}if(t){if(e.scenes)for(const r in e.scenes){const o=e.scenes[r],a=wm(n,o,t,i);if(a)return a}if(e.children)for(const r in e.children){const o=e.children[r],a=wm(n,o,t,i);if(a)return a}}}function FM(n,e){if(n!=null&&typeof n=="object"){let t;Array.isArray(n)?t=[]:(t=Object.create(n),Object.assign(t,n));for(const i of Object.keys(n)){const s=n[i];e&&!e(n,i,s)?t[i]=s:(s==null?void 0:s.clone)!==void 0&&typeof s.clone=="function"?t[i]=s.clone():t[i]=FM(s,e)}return t}return n}function Tu(n){return new Promise((e,t)=>{setTimeout(e,n)})}const Rv=re("debugresolveurl"),i8="rel:";function Nu(n,e){if(e===void 0)return Rv&&console.warn("getPath: uri is undefined, returning uri",e),e;if(e.startsWith("./"))return e;if(e.startsWith("http"))return Rv&&console.warn("getPath: uri is absolute, returning uri",e),e;if(n===void 0)return Rv&&console.warn("getPath: source is undefined, returning uri",e),e;e.startsWith(i8)&&(e=e.substring(4));const t=n.lastIndexOf("/");if(t>=0){const i=n.substring(0,t+1),s=i+e;return Rv&&console.log("source:",n,`- changed uri 
from`,e,`
 `,s,`
`+i),s}return e}class n8{constructor(e,t){h(this,"writeCallbacks",[]);h(this,"_applied",!1);h(this,"_object");h(this,"_prop");h(this,"_wrapperProp");this._object=e,this._prop=t,this._wrapperProp=Symbol("$"+t),this.apply()}subscribeWrite(e){this.writeCallbacks.push(e)}unsubscribeWrite(e){const t=this.writeCallbacks.indexOf(e);t!==-1&&this.writeCallbacks.splice(t,1)}apply(){if(this._applied||!this._object)return;const e=this._object,t=this._prop;if(e[t]===void 0)return;this._applied=!0,e[this._wrapperProp]!==void 0&&console.warn("Watcher is being applied to an object that already has a wrapper property. This is not (yet) supported");const i=e[t];e[this._wrapperProp]=i,Object.defineProperty(e,t,{get:()=>e[this._wrapperProp],set:o=>{e[this._wrapperProp]=o;for(const a of this.writeCallbacks)a(o,this._prop)}})}revoke(){if(!this._applied||!this._object)return;this._applied=!1;const e=this._object,t=this._prop;Reflect.deleteProperty(e,t);const i=e[this._wrapperProp];e[t]=i,Reflect.deleteProperty(e,this._wrapperProp)}dispose(){this.revoke(),this.writeCallbacks.length=0,this._object=null}}class Uc{constructor(e,t){h(this,"_watches",[]);if(Array.isArray(t))for(const i of t)this._watches.push(new Uc(e,i));else this._watches.push(new n8(e,t))}subscribeWrite(e){for(const t of this._watches)t.subscribeWrite(e)}unsubscribeWrite(e){for(const t of this._watches)t.unsubscribeWrite(e)}apply(){for(const e of this._watches)e.apply()}revoke(){for(const e of this._watches)e.revoke()}dispose(){for(const e of this._watches)e.dispose();this._watches.length=0}}const kd=Symbol("needle:watches");function _L(n,e){if(!n[kd])if(n instanceof te)n[kd]=new Uc(n,["x","y"]);else if(n instanceof w)n[kd]=new Uc(n,["x","y","z"]);else if(n instanceof Ke||n instanceof Se)n[kd]=new Uc(n,["x","y","z","w"]);else return!1;return n[kd].subscribeWrite(e),!0}function s8(n,e){if(!n)return;const t=n[kd];t&&t.unsubscribeWrite(e)}function ch(){return typeof window.orientation<"u"||navigator.userAgent.indexOf("IEMobile")!==-1}function cC(){return/WebXRViewer\//i.test(navigator.userAgent)}const r8=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"];function hC(){return r8.includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}function Wh(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}function o8(){return navigator.userAgent.includes("OculusBrowser")}async function NR(){try{return(await navigator.permissions.query({name:"microphone"})).state!=="denied"}catch(n){return console.error("Error querying `microphone` permissions.",n),!1}}const Dc=new WeakMap;function a8(n,e,t){if(!Dc.get(n)){const s=new MutationObserver(r=>{c8(n,r)});Dc.set(n,{observer:s,attributeChangedListeners:new Map}),s.observe(n,{attributes:!0})}const i=Dc.get(n).attributeChangedListeners;i.has(e)||i.set(e,[]),i.get(e).push(t)}function l8(n,e,t){if(!Dc.get(n))return;const i=Dc.get(n).attributeChangedListeners;if(!i.has(e))return;const s=i.get(e),r=s.indexOf(t);if(r!==-1&&(s.splice(r,1),s.length<=0)){i.delete(e);const o=Dc.get(n);o==null||o.observer.disconnect(),Dc.delete(n)}}function c8(n,e){const t=Dc.get(n).attributeChangedListeners;for(const i of e)if(i.type==="attributes"){const s=i.attributeName,r=n.getAttribute(s);if(t.has(s))for(const o of t.get(s))o(r)}}class zR{constructor(e){h(this,"reason");this.reason=e}}async function UM(n){const e=await Promise.allSettled(n).catch(s=>[new zR(s.message)]);let t=!1;const i=e.map(s=>"value"in s?s.value:(t=!0,new zR(s.reason)));return{anyFailed:t,results:i}}const $x=new Map;function Ar(n=(e=>(e=globalThis.location)==null?void 0:e.hostname)()){if($x.has(n))return $x.get(n);const t=/(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})|localhost/.test(n);return $x.set(n,t),t===!0}function h8(){return window.location.hostname.includes("glitch.me")}var Qn;(function(n){n.ContextRegistered="ContextRegistered",n.ContextCreationStart="ContextCreationStart",n.ContextCreated="ContextCreated",n.ContextDestroyed="ContextDestroyed",n.MissingCamera="MissingCamera",n.ContextClearing="ContextClearing",n.ContextCleared="ContextCleared"})(Qn||(Qn={}));class en{static get Current(){return globalThis["NeedleEngine.Context.Current"]}static set Current(e){globalThis["NeedleEngine.Context.Current"]=e}static get All(){return this.Registered}static register(e){this.Registered.push(e),this.dispatchCallback(Qn.ContextRegistered,e)}static unregister(e){const t=this.Registered.indexOf(e);t!==-1&&this.Registered.splice(t,1)}static registerCallback(e,t){this._callbacks[e]||(this._callbacks[e]=[]),this._callbacks[e].push(t)}static unregisterCallback(e,t){if(!this._callbacks[e])return;const i=this._callbacks[e].indexOf(t);i!==-1&&this._callbacks[e].splice(i,1)}static dispatchCallback(e,t,i){if(!this._callbacks[e])return!0;const s={event:e,context:t};if(i)for(const o in i)s[o]=i[o];const r=new Array;return this._callbacks[e].forEach(o=>{const a=o(s);a instanceof Promise&&r.push(a)}),Promise.all(r)}static addContextCreatedCallback(e){this.registerCallback(Qn.ContextCreated,e)}static addContextDestroyedCallback(e){this.registerCallback(Qn.ContextDestroyed,e)}}h(en,"Registered",[]),h(en,"_callbacks",{});const GR=re("debugdebug");let Ig=!1;re("noerrors")&&(Ig=!0);const ew="needle_engine_global_error_container";var jn;(function(n){n[n.Log=0]="Log",n[n.Warn=1]="Warn",n[n.Error=2]="Error"})(jn||(jn={}));function xL(){return wL}const u8=console.error,d8=function(...n){u8.apply(console,n),p8(n),Nc(jn.Error,n),uC()};function f8(){if(Ig)return;const n=Ar();GR&&console.log("Is this a local network?",n),n&&(GR&&console.log(window.location.hostname),console.error=d8,window.addEventListener("error",e=>{if(Ig||!e)return;const t=e.error;if(t===void 0){Ar()&&console.warn("Received unknown error",e,e.target);return}Nc(jn.Error,t,e.filename,e.lineno),uC()},!0),window.addEventListener("unhandledrejection",e=>{Ig||e&&(e.reason?Nc(jn.Error,e.reason.message,e.reason.stack):Nc(jn.Error,"unhandled rejection"),uC())}))}let wL=0;function uC(){wL+=1}function p8(n){if(Array.isArray(n))for(let e=0;e<n.length;e++){const t=n[e];typeof t=="string"&&t.startsWith("THREE.PropertyBinding: Trying to update node for track:")&&(n[e]="Some animated objects couldn't be found: see console for details")}}function Nc(n,e,t,i){if(Ig)return;const s=en.Current,r=(s==null?void 0:s.domElement)??document.querySelector("needle-engine");if(r){if(Array.isArray(e)){let o="";for(let a=0;a<e.length;a++){let l=e[a];l instanceof Error&&(l=l.message),typeof l!="object"&&(a>0&&(o+=" "),o+=l)}e=o}!e||e.length<=0||g8(n,r,e)}}const tw=new Set;function g8(n,e,t){if(t==null)return;const i=A8(e);if(i.childElementCount>=20){const o=i.lastElementChild;VR(o)}if(t.length>400&&(t=t.substring(0,400)+"..."),tw.has(t))return;tw.add(t);const s=v8(n,t);i.prepend(s);const r=t;setTimeout(()=>{tw.delete(r),VR(s)},1e4)}const m8=`

@import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap');

div[data-needle_engine_debug_overlay] {
    font-family: 'Roboto', sans-serif;
    font-weight: 400;
}

div[data-needle_engine_debug_overlay] strong {
    font-weight: 700;
}

div[data-needle_engine_debug_overlay] a {
    color: white;
    text-decoration: none;
    border-bottom: 1px solid rgba(255, 255, 255, 0.3);
}

div[data-needle_engine_debug_overlay] a:hover {
    text-decoration: none;
    border: none;
}

div[data-needle_engine_debug_overlay] .log strong {
    color: rgba(200,200,200,.9);
}

div[data-needle_engine_debug_overlay] .warn strong {
    color: rgba(255,255,230, 1);
}

div[data-needle_engine_debug_overlay] .error strong {
    color: rgba(255,100,120, 1);
}
`;function A8(n){globalThis[ew]||(globalThis[ew]=new Map);const e=globalThis[ew];if(e.has(n))return e.get(n);{const t=document.createElement("div");e.set(n,t),t.setAttribute("data-needle_engine_debug_overlay",""),t.classList.add("debug-container"),t.style.cssText=`
            position: absolute;
            top: 0;
            right: 5px;
            padding-top: 0px;
            max-width: 70%;
            max-height: calc(100% - 5px);
            z-index: 9999999999;
            pointer-events: scroll;
            display: flex;
            align-items: end;
            flex-direction: column;
            color: white;
            overflow: auto;
        `,n.shadowRoot?n.shadowRoot.appendChild(t):n.appendChild(t);const i=document.createElement("style");return i.innerHTML=m8,t.appendChild(i),t}}const SL=Symbol("logtype"),l0=new Map;function VR(n){n.remove();const e=n[SL],t=l0.get(e)??[];t.push(n),l0.set(e,t)}function v8(n,e){if(l0.has(n)){const i=l0.get(n);if(i.length>0){const s=i.pop();return s.innerHTML=e,s}}const t=document.createElement("div");switch(t.setAttribute("data-id","__needle_engine_debug_overlay"),t.style.marginRight="5px",t.style.padding=".5em",t.style.backgroundColor="rgba(0,0,0,.9)",t.style.marginTop="5px",t.style.marginBottom="3px",t.style.borderRadius="8px",t.style.pointerEvents="all",t.style.userSelect="text",t.style.maxWidth="250px",t.style.whiteSpace="pre-wrap",t.style["backdrop-filter"]="blur(10px)",t.style.backgroundColor="rgba(20,20,20,.8)",t.style.boxShadow="inset 0 0 80px rgba(0,0,0,.2), 0 0 5px rgba(0,0,0,.2)",t.style.border="1px solid rgba(160,160,160,.2)",t[SL]=n,n){case jn.Log:t.classList.add("log"),t.style.color="rgba(200,200,200,.7)",t.style.backgroundColor="rgba(40,40,40,.7)";break;case jn.Warn:t.classList.add("warn"),t.style.color="rgb(255, 255, 150)",t.style.backgroundColor="rgba(50,50,20,.8)";break;case jn.Error:t.classList.add("error"),t.style.color="rgb(255, 50, 50",t.style.backgroundColor="rgba(50,20,20,.8)";break}return t.title="Open the browser console (F12) for more information",t.innerHTML=e,t}let Ll=null,Cr=null,Da=null,iw=!1,HR=null;const CL="",dC=re("console"),y8=re("noerrors")||re("noconsole");dC&&EL();if(!y8&&(dC||Ar())){if(Ar()){const e=new URL(window.location.href);e.searchParams.set("console","1"),console.log(' Tip: You can add the "?console" query parameter to the url to show the debug console (on mobile it will automatically open in the bottom right corner when your get errors during development)',`
Open this page console: `+e.toString())}const n=ch();if(n&&(ML(),TL(!0),n)){const e=document.querySelector("needle-engine");e==null||e.addEventListener("enter-ar",()=>{(dC||Ll||xL()>0)&&re("noerrors")}),e==null||e.addEventListener("exit-ar",()=>{S8()})}}const fC=Symbol("consoleParent");function EL(){if(Ll!==null){Ll.showSwitch();return}TL()}function b8(){Ll!==null&&(Ll.hide(),Ll.hideSwitch())}function ML(){HR||(HR=setInterval(_8,500))}let QR=0;function _8(){const n=xL(),e=n!==QR;QR=n,e&&x8()}function x8(){EL(),Da&&(Da.setAttribute("error","true"),Da.innerText="")}function w8(){Da&&(Da.removeAttribute("error"),Da.innerText=CL)}function S8(){Cr&&Cr[fC]&&Cr[fC].appendChild(Cr)}function TL(n=!1){if(Ll||iw)return;iw=!0;const e=document.createElement("script");e.onload=()=>{if(iw=!1,ML(),Ll=new window.VConsole,Cr=E8(),Cr&&(Cr[fC]=Cr.parentElement,Cr.style.position="absolute",Cr.style.zIndex=Number.MAX_SAFE_INTEGER.toString()),Ll.setSwitchPosition(20,10),Da=C8(),Da){Da.innerText=CL,Da.addEventListener("click",w8);const t=document.createElement("style"),i=40;t.innerHTML=`
                #__vconsole .vc-switch {
                    border: 1px solid rgba(255,255,255,.2);
                    border-radius: 50%;
                    width: ${i}px;
                    height: ${i}px;
                    padding: 0;
                    line-height: ${i}px;
                    font-size: ${i*.4}px;
                    text-align: center;
                    background: rgba(200,200,200,.2);
                    backdrop-filter: blur(10px);
                    user-select: none;
                    pointer-events: auto;
                    transition: transform .2s ease-in-out;
                }
                #__vconsole .vc-switch:hover {
                    cursor: pointer;
                    transform: scale(1.1);
                    transition: transform .1s ease-in-out;
                }
                #__vconsole .vc-switch[error] {
                    background: rgba(255,0,0,.2);
                    animation: vconsole-notify 1s ease-in-out;
                }
                @keyframes vconsole-notify {
                    from {
                        transform: scale(1, 1);
                    }
                    10% {
                        transform: scale(1.3, 1.3);
                    }
                    70% {
                        transform: scale(1.4, 1.4);
                    }
                    to {
                        transform: scale(1, 1);
                    }
                }
            `,Cr==null||Cr.prepend(t),n===!0&&b8(),console.log(" Debug console has loaded")}},e.src="https://unpkg.com/vconsole@latest/dist/vconsole.min.js",document.body.appendChild(e)}function C8(){const n=document.querySelector("#__vconsole .vc-switch");return n||null}function E8(){const n=document.querySelector("#__vconsole");return n||null}function bn(n,e=jn.Log){Nc(e,n)}function Rs(n){bn(n,jn.Warn)}function M8(n){bn(n,jn.Error)}function si(){return Ar()}const Kr=re("debuginput");class xc extends PointerEvent{constructor(t,i,s){super(t,s);h(this,"source");this.source=i}stopImmediatePropagation(){var t;super.stopImmediatePropagation(),(t=this.source)==null||t.stopImmediatePropagation()}}class nw extends KeyboardEvent{constructor(t,i,s){super(t,s);h(this,"source");this.source=i}stopImmediatePropagation(){var t;super.stopImmediatePropagation(),(t=this.source)==null||t.stopImmediatePropagation()}}var ui;(function(n){n.PointerDown="pointerdown",n.PointerUp="pointerup",n.PointerMove="pointermove",n.KeyDown="keydown",n.KeyUp="keyup",n.KeyPressed="keypress"})(ui||(ui={}));var ns;(function(n){n.Mouse="mouse",n.Touch="touch"})(ns||(ns={}));class T8 extends EventTarget{constructor(t){super();h(this,"_doubleClickTimeThreshold",.2);h(this,"_longPressTimeThreshold",1);h(this,"_specialCursorTrigger",0);h(this,"context");h(this,"_pointerDown",[!1]);h(this,"_pointerUp",[!1]);h(this,"_pointerClick",[!1]);h(this,"_pointerDoubleClick",[!1]);h(this,"_pointerPressed",[!1]);h(this,"_pointerPositions",[new te]);h(this,"_pointerPositionsLastFrame",[new te]);h(this,"_pointerPositionsDelta",[new te]);h(this,"_pointerPositionsRC",[new te]);h(this,"_pointerPositionDown",[new te]);h(this,"_pointerDownTime",[]);h(this,"_pointerUpTime",[]);h(this,"_pointerUpTimestamp",[]);h(this,"_pointerIds",[]);h(this,"_pointerTypes",[""]);h(this,"_mouseWheelChanged",[!1]);h(this,"_mouseWheelDeltaY",[0]);h(this,"_pointerEvent",[]);h(this,"_pointerUsed",[]);h(this,"onLostFocus",()=>{for(const t in this.keysPressed)this.keysPressed[t].pressed=!1});h(this,"onEndOfFrame",()=>{for(let t=0;t<this._pointerUp.length;t++)this._pointerUp[t]=!1;for(let t=0;t<this._pointerDown.length;t++)this._pointerDown[t]=!1;for(let t=0;t<this._pointerClick.length;t++)this._pointerClick[t]=!1;for(let t=0;t<this._pointerDoubleClick.length;t++)this._pointerDoubleClick[t]=!1;for(const t of this._pointerPositionsDelta)t.set(0,0);for(let t=0;t<this._mouseWheelChanged.length;t++)this._mouseWheelChanged[t]=!1;for(let t=0;t<this._mouseWheelDeltaY.length;t++)this._mouseWheelDeltaY[t]=0});h(this,"keysPressed",{});h(this,"onKeyDown",t=>{if(!this.context.application.hasFocus)return;const i=this.keysPressed[t.code];if(i&&i.pressed)return;this.keysPressed[t.code]={pressed:!0,frame:this.context.time.frameCount+1,startFrame:this.context.time.frameCount+1,key:t.key,code:t.code};const s=new nw(ui.KeyDown,t,t);this.onDispatchEvent(s)});h(this,"onKeyPressed",t=>{if(!this.context.application.hasFocus)return;const i=this.keysPressed[t.code];if(!i)return;i.pressed=!0,i.frame=this.context.time.frameCount+1;const s=new nw(ui.KeyPressed,t,t);this.onDispatchEvent(s)});h(this,"onKeyUp",t=>{if(!this.context.application.hasFocus)return;const i=this.keysPressed[t.code];if(!i)return;i.pressed=!1,i.frame=this.context.time.frameCount+1;const s=new nw(ui.KeyUp,t,t);this.onDispatchEvent(s)});h(this,"onMouseWheel",t=>{if(this.canReceiveInput(t)===!1)return;this._mouseWheelDeltaY.length<=0&&this._mouseWheelDeltaY.push(0),this._mouseWheelChanged.length<=0&&this._mouseWheelChanged.push(!1),this._mouseWheelChanged[0]=!0;const i=this._mouseWheelDeltaY[0];this._mouseWheelDeltaY[0]=i+t.deltaY});h(this,"onTouchStart",t=>{if(!(t.changedTouches.length<=0)&&this.canReceiveInput(t)!==!1)for(let i=0;i<t.changedTouches.length;i++){const s=t.changedTouches[i],r=this.getPointerIndex(s.identifier);Kr&&bn(`touch start #${r}, identifier:${s.identifier}`);const o=new xc(ui.PointerDown,t,{button:r,clientX:s.clientX,clientY:s.clientY,pointerType:ns.Touch});this.onDown(o)}});h(this,"onTouchMove",t=>{if(!(t.changedTouches.length<=0))for(let i=0;i<t.changedTouches.length;i++){const s=t.changedTouches[i],r=this.getPointerIndex(s.identifier),o=new xc(ui.PointerMove,t,{button:r,clientX:s.clientX,clientY:s.clientY,pointerType:ns.Touch});this.onMove(o)}});h(this,"onTouchUp",t=>{if(!(t.changedTouches.length<=0))for(let i=0;i<t.changedTouches.length;i++){const s=t.changedTouches[i],r=this.getPointerIndex(s.identifier);if(!this.isNewEvent(t.timeStamp,r,this._pointerUpTimestamp))continue;Kr&&bn(`touch up #${r}, identifier:${s.identifier}`);const o=new xc(ui.PointerUp,t,{button:r,clientX:s.clientX,clientY:s.clientY,pointerType:ns.Touch});this.onUp(o)}});h(this,"onMouseDown",t=>{if(t.defaultPrevented||this.canReceiveInput(t)===!1)return;const i=t.button,s=new xc(ui.PointerDown,t,{button:i,clientX:t.clientX,clientY:t.clientY,pointerType:ns.Mouse});this.onDown(s)});h(this,"onMouseMove",t=>{if(t.defaultPrevented)return;const i=t.button,s=new xc(ui.PointerMove,t,{button:i,clientX:t.clientX,clientY:t.clientY,pointerType:ns.Mouse});this.onMove(s)});h(this,"onMouseUp",t=>{if(t.defaultPrevented)return;const i=t.button;if(!this.isNewEvent(t.timeStamp,i,this._pointerUpTimestamp))return;const s=new xc(ui.PointerUp,t,{button:i,clientX:t.clientX,clientY:t.clientY,pointerType:ns.Mouse});this.onUp(s)});this.context=t,this.context.post_render_callbacks.push(this.onEndOfFrame),window.addEventListener("touchstart",this.onTouchStart,!1),window.addEventListener("touchmove",this.onTouchMove,{passive:!0}),window.addEventListener("touchend",this.onTouchUp,!1),window.addEventListener("mousedown",this.onMouseDown,!1),window.addEventListener("mousemove",this.onMouseMove,!1),window.addEventListener("mouseup",this.onMouseUp,!1),window.addEventListener("wheel",this.onMouseWheel,{passive:!0}),window.addEventListener("keydown",this.onKeyDown,!1),window.addEventListener("keypress",this.onKeyPressed,!1),window.addEventListener("keyup",this.onKeyUp,!1),window.addEventListener("blur",this.onLostFocus)}get mousePosition(){return this._pointerPositions[0]}get mousePositionRC(){return this._pointerPositionsRC[0]}get mouseDown(){return this._pointerDown[0]}get mouseUp(){return this._pointerUp[0]}get mouseClick(){return this._pointerClick[0]}get mouseDoubleClick(){return this._pointerDoubleClick[0]}get mousePressed(){return this._pointerPressed[0]}get mouseWheelChanged(){return this.getMouseWheelChanged(0)}setCursorPointer(){this._specialCursorTrigger+=1,this.context.domElement.style.cursor="pointer"}setCursorNormal(){this._specialCursorTrigger-=1,this._specialCursorTrigger=Math.max(0,this._specialCursorTrigger),this._specialCursorTrigger===0&&(this.context.domElement.style.cursor="default")}setPointerUsed(t,i=!0){if(t>=this._pointerUsed.length){if(t>=this._pointerIds.length)return;for(;this._pointerUsed.length<=t;)this._pointerUsed.push(!1)}this._pointerUsed[t]=i}getPointerUsed(t){return t>=this._pointerUsed.length?!1:this._pointerUsed[t]}getPointerPressedCount(){let t=0;for(let i=0;i<this._pointerPressed.length;i++)this._pointerPressed[i]&&t++;return t}getPointerPosition(t){return t>=this._pointerPositions.length?null:this._pointerPositions[t]}getPointerPositionLastFrame(t){return t>=this._pointerPositionsLastFrame.length?null:this._pointerPositionsLastFrame[t]}getPointerPositionDelta(t){return t>=this._pointerPositionsDelta.length?null:this._pointerPositionsDelta[t]}getPointerPositionRC(t){return t>=this._pointerPositionsRC.length?null:this._pointerPositionsRC[t]}getPointerDown(t){return t>=this._pointerDown.length?!1:this._pointerDown[t]}getPointerUp(t){return t>=this._pointerUp.length?!1:this._pointerUp[t]}getPointerPressed(t){return t>=this._pointerPressed.length?!1:this._pointerPressed[t]}getPointerClicked(t){return t>=this._pointerClick.length?!1:this._pointerClick[t]}getPointerDoubleClicked(t){return t>=this._pointerDoubleClick.length?!1:this._pointerDoubleClick[t]}getPointerDownTime(t){return t>=this._pointerDownTime.length?-1:this._pointerDownTime[t]}getPointerUpTime(t){return t>=this._pointerUpTime.length?-1:this._pointerUpTime[t]}getPointerLongPress(t){return t>=this._pointerDownTime.length?!1:this.getPointerPressed(t)&&this.context.time.time-this._pointerDownTime[t]>this._longPressTimeThreshold}getIsMouse(t){return t<0||t>=this._pointerTypes.length?!1:this._pointerTypes[t]===ns.Mouse}getIsTouch(t){return t<0||t>=this._pointerTypes.length?!1:this._pointerTypes[t]===ns.Touch}getTouchesPressedCount(){let t=0;for(let i=0;i<this._pointerPressed.length;i++)this._pointerPressed[i]&&this.getIsTouch(i)&&t++;return t}getMouseWheelChanged(t=0){return t>=this._mouseWheelChanged.length?!1:this._mouseWheelChanged[t]}getMouseWheelDeltaY(t=0){return t>=this._mouseWheelDeltaY.length?0:this._mouseWheelDeltaY[t]}getPointerEvent(t){if(!(t>=this._pointerEvent.length))return this._pointerEvent[t]??void 0}*foreachPointerId(t){for(let i=0;i<this._pointerTypes.length;i++)if(this._pointerIsActive(i)){if(t!==void 0){const s=this._pointerTypes[i];if(Array.isArray(t)){let r=!1;for(const o of t)if(s===o){r=!0;break}if(!r)continue}else if(t!==s)continue}yield i}}*foreachTouchId(){for(let t=0;t<this._pointerTypes.length;t++)this._pointerTypes[t]===ns.Touch&&this._pointerIsActive[t]&&(yield t)}_pointerIsActive(t){return t<0?!1:this._pointerPressed[t]||this._pointerDown[t]||this._pointerUp[t]}getKeyDown(){for(const t in this.keysPressed){const i=this.keysPressed[t];if(i.startFrame===this.context.time.frameCount)return i.key}return null}getKeyPressed(){for(const t in this.keysPressed){const i=this.keysPressed[t];if(i.pressed)return i.key}return null}isKeyDown(t){var s;if(!this.context.application.isVisible||!this.context.application.hasFocus)return!1;const i=this.getCodeForCommonKeyName(t);if(i!==null){for(const r of i)if(this.isKeyDown(r))return!0;return!1}return((s=this.keysPressed[t])==null?void 0:s.startFrame)===this.context.time.frameCount&&this.keysPressed[t].pressed}isKeyUp(t){var s;if(!this.context.application.isVisible||!this.context.application.hasFocus)return!1;const i=this.getCodeForCommonKeyName(t);if(i!==null){for(const r of i)if(this.isKeyUp(r))return!0;return!1}return((s=this.keysPressed[t])==null?void 0:s.frame)===this.context.time.frameCount&&!this.keysPressed[t].pressed}isKeyPressed(t){var s;if(!this.context.application.isVisible||!this.context.application.hasFocus)return!1;const i=this.getCodeForCommonKeyName(t);if(i!==null){for(const r of i)if(this.isKeyPressed(r))return!0;return!1}return(s=this.keysPressed[t])==null?void 0:s.pressed}getCodeForCommonKeyName(t){if(t.length===1){if(t>="0"&&t<="9")return["Digit"+t];if(t>="a"&&t<="z")return["Key"+t.toUpperCase()];if(t==" ")return["Space"]}switch(t){case"shift":case"Shift":return["ShiftLeft","ShiftRight"];case"control":case"Control":return["ControlLeft","ControlRight"];case"alt":case"Alt":return["AltLeft","AltRight"]}return null}createPointerDown(t){Kr&&bn("Create Pointer down"),this.onDown(t)}createPointerMove(t){Kr&&bn("Create Pointer move"),this.onMove(t)}createPointerUp(t){Kr&&bn("Create Pointer up"),this.onUp(t)}convertScreenspaceToRaycastSpace(t){t.x=(t.x-this.context.domX)/this.context.domWidth*2-1,t.y=-((t.y-this.context.domY)/this.context.domHeight)*2+1}dispose(){const t=this.context.post_render_callbacks.indexOf(this.onEndOfFrame);t>=0&&this.context.post_render_callbacks.splice(t,1),window.removeEventListener("touchstart",this.onTouchStart,!1),window.removeEventListener("touchmove",this.onTouchMove,!1),window.removeEventListener("touchend",this.onTouchUp,!1),window.removeEventListener("mousedown",this.onMouseDown,!1),window.removeEventListener("mousemove",this.onMouseMove,!1),window.removeEventListener("mouseup",this.onMouseUp,!1),window.removeEventListener("wheel",this.onMouseWheel,!1),window.removeEventListener("keydown",this.onKeyDown,!1),window.removeEventListener("keypress",this.onKeyPressed,!1),window.removeEventListener("keyup",this.onKeyUp,!1),window.removeEventListener("blur",this.onLostFocus)}canReceiveInput(t){var i;return t.target===((i=this.context.renderer)==null?void 0:i.domElement)||t.target===this.context.domElement}isNewEvent(t,i,s){for(;s.length<=i;)s.push(-1);return t===s[i]?!1:(s[i]=t,!0)}isInRect(t){if(this.context.isInXR)return!0;const i=this.context.domElement.getBoundingClientRect(),s=t.clientX,r=t.clientY,o=s>=i.x&&s<=i.right&&r>=i.y&&r<=i.bottom;return Kr&&!o&&console.log("Not in rect",i,s,r),o}onDown(t){var i;if(Kr&&console.log(t.pointerType,"DOWN",t.button),!!this.isInRect(t)){if(t.pointerType===ns.Mouse){const s=this._pointerUpTimestamp[t.button];if(s>0&&((i=t.source)==null?void 0:i.timeStamp)!==void 0){const r=t.source.timeStamp-s;if(r<60&&r>=0){Kr&&console.log("Ignoring mouse.down for touch.up");return}}}for(this.setPointerState(t.button,this._pointerPressed,!0),this.setPointerState(t.button,this._pointerDown,!0),this.setPointerStateT(t.button,this._pointerEvent,t.source);t.button>=this._pointerTypes.length;)this._pointerTypes.push(t.pointerType);for(this._pointerTypes[t.button]=t.pointerType;t.button>=this._pointerPositionDown.length;)this._pointerPositionDown.push(new te);for(this._pointerPositionDown[t.button].set(t.clientX,t.clientY);t.button>=this._pointerPositions.length;)this._pointerPositions.push(new te);this._pointerPositions[t.button].set(t.clientX,t.clientY),t.button>=this._pointerDownTime.length&&this._pointerDownTime.push(0),this._pointerDownTime[t.button]=this.context.time.time,this.updatePointerPosition(t),this.onDispatchEvent(t)}}onMove(t){const i=t.button,s=this.getPointerPressed(i);s===!1&&!this.isInRect(t)||t.pointerType===ns.Touch&&!s||(Kr&&console.log(t.pointerType,"MOVE",i),this.updatePointerPosition(t),this.setPointerStateT(i,this._pointerEvent,t.source),this.onDispatchEvent(t))}onUp(t){var o;if(((o=this._pointerIds)==null?void 0:o.length)>=t.button&&(this._pointerIds[t.button]=-1),!this._pointerPressed[t.button]){Kr&&console.log(t.pointerType,"UP",t.button,"was not down");return}for(Kr&&console.log(t.pointerType,"UP",t.button),this.setPointerState(t.button,this._pointerPressed,!1),this.setPointerStateT(t.button,this._pointerEvent,t.source),this.setPointerState(t.button,this._pointerUp,!0);t.button>=this._pointerUsed.length;)this._pointerUsed.push(!1);if(this.setPointerState(t.button,this._pointerUsed,!1),this.updatePointerPosition(t),!this._pointerPositionDown[t.button]){Kr&&Rs("Received pointer up event without matching down event for button: "+t.button),console.warn("Received pointer up event without matching down event for button: "+t.button);return}const s=t.clientX-this._pointerPositionDown[t.button].x,r=t.clientY-this._pointerPositionDown[t.button].y;if(t.button>=this._pointerUpTime.length&&this._pointerUpTime.push(-99),Math.abs(s)<5&&Math.abs(r)<5){this.setPointerState(t.button,this._pointerClick,!0);const a=this._pointerUpTime[t.button],l=this.context.time.time-a;l<this._doubleClickTimeThreshold&&l>0&&this.setPointerState(t.button,this._pointerDoubleClick,!0)}this._pointerUpTime[t.button]=this.context.time.time,this.onDispatchEvent(t)}updatePointerPosition(t){for(;t.button>=this._pointerPositions.length;)this._pointerPositions.push(new te);for(;t.button>=this._pointerPositionsLastFrame.length;)this._pointerPositionsLastFrame.push(new te);for(;t.button>=this._pointerPositionsDelta.length;)this._pointerPositionsDelta.push(new te);const i=this._pointerPositionsLastFrame[t.button];i.copy(this._pointerPositions[t.button]);const s=this._pointerPositionsDelta[t.button];let r=t.clientX-i.x,o=t.clientY-i.y;if(t.source instanceof MouseEvent||t.source instanceof TouchEvent){const u=t.source;r===0&&u.movementX!==0&&(r=u.movementX||0),o===0&&u.movementY!==0&&(o=u.movementY||0)}s.x+=r,s.y+=o,this._pointerPositions[t.button].x=t.clientX,this._pointerPositions[t.button].y=t.clientY;const a=t.clientX,l=t.clientY;for(;t.button>=this._pointerPositionsRC.length;)this._pointerPositionsRC.push(new te);const c=this._pointerPositionsRC[t.button];c.set(a,l),this.convertScreenspaceToRaycastSpace(c)}getPointerIndex(t){const i=this._pointerIds;let s=-1;for(let r=0;r<i.length;r++){if(i[r]===t)return r;s===-1&&i[r]===-1&&(s=r)}return s!==-1?(i[s]=t,s):(i.push(t),i.length-1)}setPointerState(t,i,s){for(;i.length<=t;)i.push(!1);i[t]=s}setPointerStateT(t,i,s){for(;i.length<=t;)i.push(null);i[t]=s}onDispatchEvent(t){const i=Lt.Current;try{Lt.Current=this.context,this.dispatchEvent(t)}finally{Lt.Current=i}}}class I8{constructor(){h(this,"Rad2Deg",180/Math.PI);h(this,"Deg2Rad",Math.PI/180);h(this,"Epsilon",1e-5)}random(e,t){return e!==void 0&&t!==void 0?Math.random()*(t-e)+e:Math.random()}clamp(e,t,i){return e<t?t:e>i?i:e}clamp01(e){return this.clamp(e,0,1)}lerp(e,t,i){return i=i<0?0:i,i=i>1?1:i,e+(t-e)*i}inverseLerp(e,t,i){return(i-e)/(t-e)}remap(e,t,i,s,r){return s+(r-s)*(e-t)/(i-t)}moveTowards(e,t,i){return e+=i,(i<0&&e<t||i>0&&e>t)&&(e=t),e}toDegrees(e){return e*180/Math.PI}toRadians(e){return e*Math.PI/180}tan(e){return Math.tan(e)}gammaToLinear(e){return Math.pow(e,2.2)}linearToGamma(e){return Math.pow(e,1/2.2)}approximately(e,t,i=Number.EPSILON){for(const s of R8){const r=e[s],o=t[s];if(r===void 0||o===void 0)break;if(Math.abs(r-o)>i)return!1}return!0}}const R8=["x","y","z","w"],tt=new I8;function P8(n,e,t){const i=n.length(),s=e.length(),r=tt.lerp(i,s,t);return n.lerp(e,t).normalize().multiplyScalar(r)}new Se().setFromAxisAngle(new w(0,1,0),Math.PI);const NM=new Lf(()=>new w,100);function Mt(n,e=null,t=!0){const i=e??NM.get();return n?n.parent?(t&&n.updateWorldMatrix(!0,!1),n.matrixWorldNeedsUpdate&&n.updateMatrixWorld(),i.setFromMatrixPosition(n.matrixWorld),i):i.copy(n.position):i.set(0,0,0)}function On(n,e){if(!n)return;const t=NM.get();e!==t&&t.copy(e),((n==null?void 0:n.parent)??n).worldToLocal(t),n.position.set(t.x,t.y,t.z)}function c0(n,e,t,i){const s=NM.get();s.set(e,t,i),On(n,s)}const h0=new Lf(()=>new Se,100),Rg=new Se,sw=new Se;function Gr(n,e=null){if(!n)return h0.get().identity();const t=e??h0.get();return n.parent?(n.getWorldQuaternion(t),t):t.copy(n.quaternion)}function _o(n,e){if(!n)return;e!==Rg&&Rg.copy(e);const t=Rg,i=n==null?void 0:n.parent;i==null||i.getWorldQuaternion(sw),sw.invert();const s=sw.multiply(t);n.quaternion.set(s.x,s.y,s.z,s.w)}const B8=new Lf(()=>new w,100),D8=new w;function Jo(n,e=null){return e||(e=B8.get()),n?n.parent?(n.getWorldScale(e),e):e.copy(n.scale):e.set(0,0,0)}function WR(n,e){if(!n)return;if(!n.parent){n.scale.copy(e);return}const t=D8;n.parent.getWorldScale(t),n.scale.copy(e),n.scale.divide(t)}new w;const jR=new pn,qR=new pn,O8=new w;function k8(n){const e=h0.get();return n.getWorldQuaternion(e),qR.setFromQuaternion(e),qR}function L8(n,e){const t=h0.get();_o(n,t.setFromEuler(e))}function zM(n){const e=k8(n),t=O8;return t.set(e.x,e.y,e.z),t.x=tt.toDegrees(t.x),t.y=tt.toDegrees(t.y),t.z=tt.toDegrees(t.z),t}function F8(n,e){GM(n,e.x,e.y,e.z,!0)}function GM(n,e,t,i,s=!0){s&&(e=tt.toRadians(e),t=tt.toRadians(t),i=tt.toRadians(i)),jR.set(e,t,i),Rg.setFromEuler(jR),_o(n,Rg)}function pC(n,e=!0){n&&(e?function t(i){console.groupCollapsed((i.name?i.name:"(no name : "+i.type+")")+" %o",i),i.children.forEach(t),console.groupEnd()}(n):n.traverse(function(t){for(var i="|___",s=t;s.parent!==null;)i="	"+i,s=s.parent;console.log(i+t.name+" <"+t.type+">")}))}function U8(n){if(n){const e=n;return e.blendMode!==void 0&&e.clampWhenFinished!==void 0&&e.enabled!==void 0&&e.fadeIn!==void 0&&e.getClip!==void 0}return!1}class cl{static createBlitMaterial(e){return new Bt({uniforms:{map:new xe(null)},vertexShader:this.vertex,fragmentShader:e})}static copyTexture(e,t){const i=t??this.blipMaterial;i.uniforms.map.value=e,i.needsUpdate=!0,i.uniformsNeedUpdate=!0,this.blipMaterial||(this.blipMaterial=new Bt({uniforms:{map:new xe(null)},vertexShader:this.vertex,fragmentShader:this.fragment})),this.mesh||(this.mesh=new ye(this.planeGeometry,this.blipMaterial));const s=this.mesh;s.material=i,s.frustumCulled=!1,this.scene.children.length=0,this.scene.add(s),this.renderer||(this.renderer=new oh({antialias:!1})),this.renderer.setSize(e.image.width,e.image.height),this.renderer.clear(),this.renderer.render(this.scene,this.perspectiveCam);const r=new Rt(this.renderer.domElement);return r.name="Copy",r.needsUpdate=!0,r}static textureToCanvas(e,t){if(!e)return null;(t===!0||e.isCompressedTexture===!0)&&(e=N8(e));const i=e.image;if(z8(i)){const s=document.createElement("canvas");s.width=i.width,s.height=i.height;const r=s.getContext("2d");return r?(r.drawImage(i,0,0,i.width,i.height,0,0,s.width,s.height),s):(console.error("Failed getting canvas 2d context"),null)}return null}}h(cl,"planeGeometry",new us(2,2,1,1)),h(cl,"renderer"),h(cl,"perspectiveCam",new qt),h(cl,"scene",new mr),h(cl,"vertex",`
    varying vec2 vUv;
    void main(){
        vUv = uv;
        gl_Position = vec4(position.xy * 1.0,0.,.999999);
    }`),h(cl,"fragment",`
    uniform sampler2D map; 
    varying vec2 vUv;
    void main(){ 
        vec2 uv = vUv;
        uv.y = 1.0 - uv.y;
        gl_FragColor = texture2D( map, uv);
        // gl_FragColor = vec4(uv.xy, 0, 1);
    }`),h(cl,"blipMaterial"),h(cl,"mesh");function N8(n){return cl.copyTexture(n)}function z8(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas||typeof ImageBitmap<"u"&&n instanceof ImageBitmap}const G8=re("debugphysics"),XR=new Ss;class Ko{constructor(){h(this,"ray");h(this,"cam");h(this,"screenPoint");h(this,"raycaster");h(this,"results");h(this,"targets");h(this,"recursive",!0);h(this,"minDistance");h(this,"maxDistance");h(this,"lineThreshold");h(this,"layerMask");h(this,"ignore")}screenPointFromOffset(e,t){this.screenPoint===void 0&&(this.screenPoint=new te),this.screenPoint.x=e/window.innerWidth*2-1,this.screenPoint.y=-(t/window.innerHeight)*2+1}setLayer(e){XR.set(e),this.layerMask=XR}setMask(e){this.layerMask||(this.layerMask=new Ss);const t=this.layerMask;t?t.mask=e:this.layerMask=e}}h(Ko,"AllLayers",4294967295);class V8{constructor(e,t,i){h(this,"distance");h(this,"point");h(this,"object");this.object=e,this.distance=t,this.point=i}}class H8{constructor(e){h(this,"context");h(this,"engine");h(this,"raycaster",new Uu);h(this,"defaultRaycastOptions",new Ko);h(this,"targetBuffer",new Array(1));h(this,"defaultThresholds",{Mesh:{},Line:{threshold:0},LOD:{},Points:{threshold:0},Sprite:{}});h(this,"sphereResults",new Array);h(this,"sphereMask",new Ss);h(this,"tempBoundingBox",new Bn);this.context=e}raycastPhysicsFast(e,t=void 0,i=1/0,s=!0){var r;return((r=this.context.physics.engine)==null?void 0:r.raycast(e,t,i,s))??null}raycastPhysicsFastAndGetNormal(e,t=void 0,i=1/0,s=!0){var r;return((r=this.context.physics.engine)==null?void 0:r.raycastAndGetNormal(e,t,i,s))??null}sphereOverlapPhysics(e,t){var i;return((i=this.context.physics.engine)==null?void 0:i.sphereOverlap(e,t))??null}sphereOverlap(e,t,i=!0){if(this.sphereResults.length=0,!this.context.scene)return this.sphereResults;const s=new Ys(e,t),r=this.sphereMask;r.enableAll(),r.disable(2);for(const o of this.context.scene.children)this.onSphereOverlap(o,s,r,this.sphereResults,i);return this.sphereResults.sort((o,a)=>o.distance-a.distance)}onSphereOverlap(e,t,i,s,r){if(e.type==="Mesh"&&e.layers.test(i)){const o=e,a=o.geometry;if(a.boundingBox||a.computeBoundingBox(),a.boundingBox){o.matrixWorldNeedsUpdate&&o.updateMatrixWorld();const l=this.tempBoundingBox.copy(a.boundingBox).applyMatrix4(o.matrixWorld);if(t.intersectsBox(l)){const c=Mt(e),u=c.distanceTo(t.center),d=new V8(e,u,c);if(s.push(d),!r)return}}}if(e.children)for(const o of e.children){const a=s.length;if(this.onSphereOverlap(o,t,i,s,r),a!=s.length&&!r)return}}raycastFromRay(e,t=null){const i=t??this.defaultRaycastOptions;return i.ray=e,this.raycast(i)}raycast(e=null){e||(e=this.defaultRaycastOptions);const t=e.screenPoint??this.context.input.mousePositionRC,i=e.raycaster??this.raycaster;if(i.near=e.minDistance??0,i.far=e.maxDistance??1/0,i.params=this.defaultThresholds,e.lineThreshold?i.params.Line={threshold:e.lineThreshold}:i.params.Line={threshold:0},e.ray)i.ray.copy(e.ray);else{const a=e.cam??this.context.mainCamera;if(!a)return G8&&console.error("Can not perform raycast - no main camera found"),this.defaultRaycastOptions.results&&(this.defaultRaycastOptions.results.length=0),this.defaultRaycastOptions.results??[];i.setFromCamera(t,a)}let s=e.targets;s||(s=this.targetBuffer,s.length=1,s[0]=this.context.scene);let r=e.results;this.defaultRaycastOptions.results&&(this.defaultRaycastOptions.results.length=0),r||(this.defaultRaycastOptions.results||(this.defaultRaycastOptions.results=new Array),r=this.defaultRaycastOptions.results),e.layerMask!==void 0?e.layerMask instanceof Ss?i.layers.mask=e.layerMask.mask:i.layers.mask=e.layerMask:(i.layers.enableAll(),i.layers.disable(2)),r.length=0,i.intersectObjects(s,e.recursive,r);const o=e.ignore;return o!==void 0&&o.length>0&&(r=r.filter(a=>!o.includes(a.object))),r}}const YR=re("timescale");let gC=1;typeof YR=="number"&&(gC=YR);class Q8{constructor(){h(this,"deltaTime",0);h(this,"time",0);h(this,"timeScale",1);h(this,"frame",0);h(this,"clock",new RM);h(this,"_smoothedFps",0);h(this,"_smoothedDeltaTime",0);h(this,"_fpsSamples",[]);h(this,"_fpsSampleIndex",0);typeof gC=="number"&&(this.timeScale=gC)}get realtimeSinceStartup(){return this.clock.elapsedTime}get frameCount(){return this.frame}get smoothedFps(){return this._smoothedFps}get smoothedDeltaTime(){return 1/this._smoothedFps}update(){this.deltaTime=this.clock.getDelta(),this.deltaTime=Math.min(.1,this.deltaTime),this.deltaTime*=this.timeScale,this.deltaTime<=0&&(this.deltaTime=1e-12),this.frame+=1,this.time+=this.deltaTime,this._fpsSamples.length<30?this._fpsSamples.push(this.deltaTime):this._fpsSamples[this._fpsSampleIndex++%30]=this.deltaTime;let e=0;for(let t=0;t<this._fpsSamples.length;t++)e+=this._fpsSamples[t];this._smoothedDeltaTime=e/this._fpsSamples.length,this._smoothedFps=1/this._smoothedDeltaTime}}const W8="modulepreload",j8=function(n,e){return new URL(n,e).href},JR={},e_=function(e,t,i){if(!t||t.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(t.map(r=>{if(r=j8(r,i),r in JR)return;JR[r]=!0;const o=r.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!i)for(let u=s.length-1;u>=0;u--){const d=s[u];if(d.href===r&&(!o||d.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${r}"]${a}`))return;const c=document.createElement("link");if(c.rel=o?"stylesheet":W8,o||(c.as="script",c.crossOrigin=""),c.href=r,document.head.appendChild(c),o)return new Promise((u,d)=>{c.addEventListener("load",u),c.addEventListener("error",()=>d(new Error(`Unable to preload CSS for ${r}`)))})})).then(()=>e())},rw=2,Ca=4,_l=4,t_=4,wc=new Int32Array(2),KR=new Float32Array(wc.buffer),ZR=new Float64Array(wc.buffer),Pv=new Uint16Array(new Uint8Array([1,0]).buffer)[0]===1;class Fa{constructor(e,t){this.low=e|0,this.high=t|0}static create(e,t){return e==0&&t==0?Fa.ZERO:new Fa(e,t)}toFloat64(){return(this.low>>>0)+this.high*4294967296}equals(e){return this.low==e.low&&this.high==e.high}}Fa.ZERO=new Fa(0,0);var mC;(function(n){n[n.UTF8_BYTES=1]="UTF8_BYTES",n[n.UTF16_STRING=2]="UTF16_STRING"})(mC||(mC={}));class Sm{constructor(e){this.bytes_=e,this.position_=0}static allocate(e){return new Sm(new Uint8Array(e))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(e){this.position_=e}capacity(){return this.bytes_.length}readInt8(e){return this.readUint8(e)<<24>>24}readUint8(e){return this.bytes_[e]}readInt16(e){return this.readUint16(e)<<16>>16}readUint16(e){return this.bytes_[e]|this.bytes_[e+1]<<8}readInt32(e){return this.bytes_[e]|this.bytes_[e+1]<<8|this.bytes_[e+2]<<16|this.bytes_[e+3]<<24}readUint32(e){return this.readInt32(e)>>>0}readInt64(e){return new Fa(this.readInt32(e),this.readInt32(e+4))}readUint64(e){return new Fa(this.readUint32(e),this.readUint32(e+4))}readFloat32(e){return wc[0]=this.readInt32(e),KR[0]}readFloat64(e){return wc[Pv?0:1]=this.readInt32(e),wc[Pv?1:0]=this.readInt32(e+4),ZR[0]}writeInt8(e,t){this.bytes_[e]=t}writeUint8(e,t){this.bytes_[e]=t}writeInt16(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8}writeUint16(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8}writeInt32(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8,this.bytes_[e+2]=t>>16,this.bytes_[e+3]=t>>24}writeUint32(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8,this.bytes_[e+2]=t>>16,this.bytes_[e+3]=t>>24}writeInt64(e,t){this.writeInt32(e,t.low),this.writeInt32(e+4,t.high)}writeUint64(e,t){this.writeUint32(e,t.low),this.writeUint32(e+4,t.high)}writeFloat32(e,t){KR[0]=t,this.writeInt32(e,wc[0])}writeFloat64(e,t){ZR[0]=t,this.writeInt32(e,wc[Pv?0:1]),this.writeInt32(e+4,wc[Pv?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+Ca+_l)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let e="";for(let t=0;t<_l;t++)e+=String.fromCharCode(this.readInt8(this.position_+Ca+t));return e}__offset(e,t){const i=e-this.readInt32(e);return t<this.readInt16(i)?this.readInt16(i+t):0}__union(e,t){return e.bb_pos=t+this.readInt32(t),e.bb=this,e}__string(e,t){e+=this.readInt32(e);const i=this.readInt32(e);let s="",r=0;if(e+=Ca,t===mC.UTF8_BYTES)return this.bytes_.subarray(e,e+i);for(;r<i;){let o;const a=this.readUint8(e+r++);if(a<192)o=a;else{const l=this.readUint8(e+r++);if(a<224)o=(a&31)<<6|l&63;else{const c=this.readUint8(e+r++);if(a<240)o=(a&15)<<12|(l&63)<<6|c&63;else{const u=this.readUint8(e+r++);o=(a&7)<<18|(l&63)<<12|(c&63)<<6|u&63}}}o<65536?s+=String.fromCharCode(o):(o-=65536,s+=String.fromCharCode((o>>10)+55296,(o&1024-1)+56320))}return s}__union_with_string(e,t){return typeof e=="string"?this.__string(t):this.__union(e,t)}__indirect(e){return e+this.readInt32(e)}__vector(e){return e+this.readInt32(e)+Ca}__vector_len(e){return this.readInt32(e+this.readInt32(e))}__has_identifier(e){if(e.length!=_l)throw new Error("FlatBuffers: file identifier must be length "+_l);for(let t=0;t<_l;t++)if(e.charCodeAt(t)!=this.readInt8(this.position()+Ca+t))return!1;return!0}createLong(e,t){return Fa.create(e,t)}createScalarList(e,t){const i=[];for(let s=0;s<t;++s)e(s)!==null&&i.push(e(s));return i}createObjList(e,t){const i=[];for(let s=0;s<t;++s){const r=e(s);r!==null&&i.push(r.unpack())}return i}}class $f{constructor(e){this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null;let t;e?t=e:t=1024,this.bb=Sm.allocate(t),this.space=t}clear(){this.bb.clear(),this.space=this.bb.capacity(),this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null}forceDefaults(e){this.force_defaults=e}dataBuffer(){return this.bb}asUint8Array(){return this.bb.bytes().subarray(this.bb.position(),this.bb.position()+this.offset())}prep(e,t){e>this.minalign&&(this.minalign=e);const i=~(this.bb.capacity()-this.space+t)+1&e-1;for(;this.space<i+e+t;){const s=this.bb.capacity();this.bb=$f.growByteBuffer(this.bb),this.space+=this.bb.capacity()-s}this.pad(i)}pad(e){for(let t=0;t<e;t++)this.bb.writeInt8(--this.space,0)}writeInt8(e){this.bb.writeInt8(this.space-=1,e)}writeInt16(e){this.bb.writeInt16(this.space-=2,e)}writeInt32(e){this.bb.writeInt32(this.space-=4,e)}writeInt64(e){this.bb.writeInt64(this.space-=8,e)}writeFloat32(e){this.bb.writeFloat32(this.space-=4,e)}writeFloat64(e){this.bb.writeFloat64(this.space-=8,e)}addInt8(e){this.prep(1,0),this.writeInt8(e)}addInt16(e){this.prep(2,0),this.writeInt16(e)}addInt32(e){this.prep(4,0),this.writeInt32(e)}addInt64(e){this.prep(8,0),this.writeInt64(e)}addFloat32(e){this.prep(4,0),this.writeFloat32(e)}addFloat64(e){this.prep(8,0),this.writeFloat64(e)}addFieldInt8(e,t,i){(this.force_defaults||t!=i)&&(this.addInt8(t),this.slot(e))}addFieldInt16(e,t,i){(this.force_defaults||t!=i)&&(this.addInt16(t),this.slot(e))}addFieldInt32(e,t,i){(this.force_defaults||t!=i)&&(this.addInt32(t),this.slot(e))}addFieldInt64(e,t,i){(this.force_defaults||!t.equals(i))&&(this.addInt64(t),this.slot(e))}addFieldFloat32(e,t,i){(this.force_defaults||t!=i)&&(this.addFloat32(t),this.slot(e))}addFieldFloat64(e,t,i){(this.force_defaults||t!=i)&&(this.addFloat64(t),this.slot(e))}addFieldOffset(e,t,i){(this.force_defaults||t!=i)&&(this.addOffset(t),this.slot(e))}addFieldStruct(e,t,i){t!=i&&(this.nested(t),this.slot(e))}nested(e){if(e!=this.offset())throw new Error("FlatBuffers: struct must be serialized inline.")}notNested(){if(this.isNested)throw new Error("FlatBuffers: object serialization must not be nested.")}slot(e){this.vtable!==null&&(this.vtable[e]=this.offset())}offset(){return this.bb.capacity()-this.space}static growByteBuffer(e){const t=e.capacity();if(t&3221225472)throw new Error("FlatBuffers: cannot grow buffer beyond 2 gigabytes.");const i=t<<1,s=Sm.allocate(i);return s.setPosition(i-t),s.bytes().set(e.bytes(),i-t),s}addOffset(e){this.prep(Ca,0),this.writeInt32(this.offset()-e+Ca)}startObject(e){this.notNested(),this.vtable==null&&(this.vtable=[]),this.vtable_in_use=e;for(let t=0;t<e;t++)this.vtable[t]=0;this.isNested=!0,this.object_start=this.offset()}endObject(){if(this.vtable==null||!this.isNested)throw new Error("FlatBuffers: endObject called without startObject");this.addInt32(0);const e=this.offset();let t=this.vtable_in_use-1;for(;t>=0&&this.vtable[t]==0;t--);const i=t+1;for(;t>=0;t--)this.addInt16(this.vtable[t]!=0?e-this.vtable[t]:0);const s=2;this.addInt16(e-this.object_start);const r=(i+s)*rw;this.addInt16(r);let o=0;const a=this.space;e:for(t=0;t<this.vtables.length;t++){const l=this.bb.capacity()-this.vtables[t];if(r==this.bb.readInt16(l)){for(let c=rw;c<r;c+=rw)if(this.bb.readInt16(a+c)!=this.bb.readInt16(l+c))continue e;o=this.vtables[t];break}}return o?(this.space=this.bb.capacity()-e,this.bb.writeInt32(this.space,o-e)):(this.vtables.push(this.offset()),this.bb.writeInt32(this.bb.capacity()-e,this.offset()-e)),this.isNested=!1,e}finish(e,t,i){const s=i?t_:0;if(t){const r=t;if(this.prep(this.minalign,Ca+_l+s),r.length!=_l)throw new Error("FlatBuffers: file identifier must be length "+_l);for(let o=_l-1;o>=0;o--)this.writeInt8(r.charCodeAt(o))}this.prep(this.minalign,Ca+s),this.addOffset(e),s&&this.addInt32(this.bb.capacity()-this.space),this.bb.setPosition(this.space)}finishSizePrefixed(e,t){this.finish(e,t,!0)}requiredField(e,t){const i=this.bb.capacity()-e,s=i-this.bb.readInt32(i);if(!(this.bb.readInt16(s+t)!=0))throw new Error("FlatBuffers: field "+t+" must be set")}startVector(e,t,i){this.notNested(),this.vector_num_elems=t,this.prep(Ca,e*t),this.prep(i,e*t)}endVector(){return this.writeInt32(this.vector_num_elems),this.offset()}createSharedString(e){if(!e)return 0;if(this.string_maps||(this.string_maps=new Map),this.string_maps.has(e))return this.string_maps.get(e);const t=this.createString(e);return this.string_maps.set(e,t),t}createString(e){if(!e)return 0;let t;if(e instanceof Uint8Array)t=e;else{t=[];let i=0;for(;i<e.length;){let s;const r=e.charCodeAt(i++);if(r<55296||r>=56320)s=r;else{const o=e.charCodeAt(i++);s=(r<<10)+o+(65536-56623104-56320)}s<128?t.push(s):(s<2048?t.push(s>>6&31|192):(s<65536?t.push(s>>12&15|224):t.push(s>>18&7|240,s>>12&63|128),t.push(s>>6&63|128)),t.push(s&63|128))}}this.addInt8(0),this.startVector(1,t.length,1),this.bb.setPosition(this.space-=t.length);for(let i=0,s=this.space,r=this.bb.bytes();i<t.length;i++)r[s++]=t[i];return this.endVector()}createLong(e,t){return Fa.create(e,t)}createObjectOffset(e){return e===null?0:typeof e=="string"?this.createString(e):e.pack(this)}createObjectOffsetList(e){const t=[];for(let i=0;i<e.length;++i){const s=e[i];if(s!==null)t.push(this.createObjectOffset(s));else throw new Error("FlatBuffers: Argument for createObjectOffsetList cannot contain null.")}return t}createStructOffsetList(e,t){return t(this,e.length),this.createObjectOffsetList(e),this.endVector()}}const IL={};function VM(n,e){IL[n]=e}function q8(n){const e=n.getBufferIdentifier(),t=IL[e];return t(n)}function X8(n){return typeof n.guid=="function"?n.guid():null}var fse=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function i_(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var RL={exports:{}};(function(n){var e={};e.useBlobBuilder=function(){try{return new Blob([]),!1}catch{return!0}}(),e.useArrayBufferView=!e.useBlobBuilder&&function(){try{return new Blob([new Uint8Array([])]).size===0}catch{return!0}}(),n.exports.binaryFeatures=e;var t=n.exports.BlobBuilder;typeof window<"u"&&(t=n.exports.BlobBuilder=window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder||window.BlobBuilder);function i(){this._pieces=[],this._parts=[]}i.prototype.append=function(s){typeof s=="number"?this._pieces.push(s):(this.flush(),this._parts.push(s))},i.prototype.flush=function(){if(this._pieces.length>0){var s=new Uint8Array(this._pieces);e.useArrayBufferView||(s=s.buffer),this._parts.push(s),this._pieces=[]}},i.prototype.getBuffer=function(){if(this.flush(),e.useBlobBuilder){for(var s=new t,r=0,o=this._parts.length;r<o;r++)s.append(this._parts[r]);return s.getBlob()}else return new Blob(this._parts)},n.exports.BufferBuilder=i})(RL);var PL=RL.exports,Y8=PL.BufferBuilder,$R=PL.binaryFeatures,J8={unpack:function(n){var e=new fs(n);return e.unpack()},pack:function(n){var e=new ps;e.pack(n);var t=e.getBuffer();return t}},K8=J8;function fs(n){this.index=0,this.dataBuffer=n,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}fs.prototype.unpack=function(){var n=this.unpack_uint8();if(n<128)return n;if((n^224)<32)return(n^224)-32;var e;if((e=n^160)<=15)return this.unpack_raw(e);if((e=n^176)<=15)return this.unpack_string(e);if((e=n^144)<=15)return this.unpack_array(e);if((e=n^128)<=15)return this.unpack_map(e);switch(n){case 192:return null;case 193:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:return;case 213:return;case 214:return;case 215:return;case 216:return e=this.unpack_uint16(),this.unpack_string(e);case 217:return e=this.unpack_uint32(),this.unpack_string(e);case 218:return e=this.unpack_uint16(),this.unpack_raw(e);case 219:return e=this.unpack_uint32(),this.unpack_raw(e);case 220:return e=this.unpack_uint16(),this.unpack_array(e);case 221:return e=this.unpack_uint32(),this.unpack_array(e);case 222:return e=this.unpack_uint16(),this.unpack_map(e);case 223:return e=this.unpack_uint32(),this.unpack_map(e)}};fs.prototype.unpack_uint8=function(){var n=this.dataView[this.index]&255;return this.index++,n};fs.prototype.unpack_uint16=function(){var n=this.read(2),e=(n[0]&255)*256+(n[1]&255);return this.index+=2,e};fs.prototype.unpack_uint32=function(){var n=this.read(4),e=((n[0]*256+n[1])*256+n[2])*256+n[3];return this.index+=4,e};fs.prototype.unpack_uint64=function(){var n=this.read(8),e=((((((n[0]*256+n[1])*256+n[2])*256+n[3])*256+n[4])*256+n[5])*256+n[6])*256+n[7];return this.index+=8,e};fs.prototype.unpack_int8=function(){var n=this.unpack_uint8();return n<128?n:n-256};fs.prototype.unpack_int16=function(){var n=this.unpack_uint16();return n<32768?n:n-65536};fs.prototype.unpack_int32=function(){var n=this.unpack_uint32();return n<Math.pow(2,31)?n:n-Math.pow(2,32)};fs.prototype.unpack_int64=function(){var n=this.unpack_uint64();return n<Math.pow(2,63)?n:n-Math.pow(2,64)};fs.prototype.unpack_raw=function(n){if(this.length<this.index+n)throw new Error("BinaryPackFailure: index is out of range "+this.index+" "+n+" "+this.length);var e=this.dataBuffer.slice(this.index,this.index+n);return this.index+=n,e};fs.prototype.unpack_string=function(n){for(var e=this.read(n),t=0,i="",s,r;t<n;)s=e[t],s<128?(i+=String.fromCharCode(s),t++):(s^192)<32?(r=(s^192)<<6|e[t+1]&63,i+=String.fromCharCode(r),t+=2):(r=(s&15)<<12|(e[t+1]&63)<<6|e[t+2]&63,i+=String.fromCharCode(r),t+=3);return this.index+=n,i};fs.prototype.unpack_array=function(n){for(var e=new Array(n),t=0;t<n;t++)e[t]=this.unpack();return e};fs.prototype.unpack_map=function(n){for(var e={},t=0;t<n;t++){var i=this.unpack(),s=this.unpack();e[i]=s}return e};fs.prototype.unpack_float=function(){var n=this.unpack_uint32(),e=n>>31,t=(n>>23&255)-127,i=n&8388607|8388608;return(e===0?1:-1)*i*Math.pow(2,t-23)};fs.prototype.unpack_double=function(){var n=this.unpack_uint32(),e=this.unpack_uint32(),t=n>>31,i=(n>>20&2047)-1023,s=n&1048575|1048576,r=s*Math.pow(2,i-20)+e*Math.pow(2,i-52);return(t===0?1:-1)*r};fs.prototype.read=function(n){var e=this.index;if(e+n<=this.length)return this.dataView.subarray(e,e+n);throw new Error("BinaryPackFailure: read index out of range")};function ps(){this.bufferBuilder=new Y8}ps.prototype.getBuffer=function(){return this.bufferBuilder.getBuffer()};ps.prototype.pack=function(n){var e=typeof n;if(e==="string")this.pack_string(n);else if(e==="number")Math.floor(n)===n?this.pack_integer(n):this.pack_double(n);else if(e==="boolean")n===!0?this.bufferBuilder.append(195):n===!1&&this.bufferBuilder.append(194);else if(e==="undefined")this.bufferBuilder.append(192);else if(e==="object")if(n===null)this.bufferBuilder.append(192);else{var t=n.constructor;if(t==Array)this.pack_array(n);else if(t==Blob||t==File||n instanceof Blob||n instanceof File)this.pack_bin(n);else if(t==ArrayBuffer)$R.useArrayBufferView?this.pack_bin(new Uint8Array(n)):this.pack_bin(n);else if("BYTES_PER_ELEMENT"in n)$R.useArrayBufferView?this.pack_bin(new Uint8Array(n.buffer)):this.pack_bin(n.buffer);else if(t==Object||t.toString().startsWith("class"))this.pack_object(n);else if(t==Date)this.pack_string(n.toString());else if(typeof n.toBinaryPack=="function")this.bufferBuilder.append(n.toBinaryPack());else throw new Error('Type "'+t.toString()+'" not yet supported')}else throw new Error('Type "'+e+'" not yet supported');this.bufferBuilder.flush()};ps.prototype.pack_bin=function(n){var e=n.length||n.byteLength||n.size;if(e<=15)this.pack_uint8(160+e);else if(e<=65535)this.bufferBuilder.append(218),this.pack_uint16(e);else if(e<=4294967295)this.bufferBuilder.append(219),this.pack_uint32(e);else throw new Error("Invalid length");this.bufferBuilder.append(n)};ps.prototype.pack_string=function(n){var e=$8(n);if(e<=15)this.pack_uint8(176+e);else if(e<=65535)this.bufferBuilder.append(216),this.pack_uint16(e);else if(e<=4294967295)this.bufferBuilder.append(217),this.pack_uint32(e);else throw new Error("Invalid length");this.bufferBuilder.append(n)};ps.prototype.pack_array=function(n){var e=n.length;if(e<=15)this.pack_uint8(144+e);else if(e<=65535)this.bufferBuilder.append(220),this.pack_uint16(e);else if(e<=4294967295)this.bufferBuilder.append(221),this.pack_uint32(e);else throw new Error("Invalid length");for(var t=0;t<e;t++)this.pack(n[t])};ps.prototype.pack_integer=function(n){if(n>=-32&&n<=127)this.bufferBuilder.append(n&255);else if(n>=0&&n<=255)this.bufferBuilder.append(204),this.pack_uint8(n);else if(n>=-128&&n<=127)this.bufferBuilder.append(208),this.pack_int8(n);else if(n>=0&&n<=65535)this.bufferBuilder.append(205),this.pack_uint16(n);else if(n>=-32768&&n<=32767)this.bufferBuilder.append(209),this.pack_int16(n);else if(n>=0&&n<=4294967295)this.bufferBuilder.append(206),this.pack_uint32(n);else if(n>=-2147483648&&n<=2147483647)this.bufferBuilder.append(210),this.pack_int32(n);else if(n>=-9223372036854776e3&&n<=9223372036854776e3)this.bufferBuilder.append(211),this.pack_int64(n);else if(n>=0&&n<=18446744073709552e3)this.bufferBuilder.append(207),this.pack_uint64(n);else throw new Error("Invalid integer")};ps.prototype.pack_double=function(n){var e=0;n<0&&(e=1,n=-n);var t=Math.floor(Math.log(n)/Math.LN2),i=n/Math.pow(2,t)-1,s=Math.floor(i*Math.pow(2,52)),r=Math.pow(2,32),o=e<<31|t+1023<<20|s/r&1048575,a=s%r;this.bufferBuilder.append(203),this.pack_int32(o),this.pack_int32(a)};ps.prototype.pack_object=function(n){var e=Object.keys(n),t=e.length;if(t<=15)this.pack_uint8(128+t);else if(t<=65535)this.bufferBuilder.append(222),this.pack_uint16(t);else if(t<=4294967295)this.bufferBuilder.append(223),this.pack_uint32(t);else throw new Error("Invalid length");for(var i in n)n.hasOwnProperty(i)&&(this.pack(i),this.pack(n[i]))};ps.prototype.pack_uint8=function(n){this.bufferBuilder.append(n)};ps.prototype.pack_uint16=function(n){this.bufferBuilder.append(n>>8),this.bufferBuilder.append(n&255)};ps.prototype.pack_uint32=function(n){var e=n&4294967295;this.bufferBuilder.append((e&4278190080)>>>24),this.bufferBuilder.append((e&16711680)>>>16),this.bufferBuilder.append((e&65280)>>>8),this.bufferBuilder.append(e&255)};ps.prototype.pack_uint64=function(n){var e=n/Math.pow(2,32),t=n%Math.pow(2,32);this.bufferBuilder.append((e&4278190080)>>>24),this.bufferBuilder.append((e&16711680)>>>16),this.bufferBuilder.append((e&65280)>>>8),this.bufferBuilder.append(e&255),this.bufferBuilder.append((t&4278190080)>>>24),this.bufferBuilder.append((t&16711680)>>>16),this.bufferBuilder.append((t&65280)>>>8),this.bufferBuilder.append(t&255)};ps.prototype.pack_int8=function(n){this.bufferBuilder.append(n&255)};ps.prototype.pack_int16=function(n){this.bufferBuilder.append((n&65280)>>8),this.bufferBuilder.append(n&255)};ps.prototype.pack_int32=function(n){this.bufferBuilder.append(n>>>24&255),this.bufferBuilder.append((n&16711680)>>>16),this.bufferBuilder.append((n&65280)>>>8),this.bufferBuilder.append(n&255)};ps.prototype.pack_int64=function(n){var e=Math.floor(n/Math.pow(2,32)),t=n%Math.pow(2,32);this.bufferBuilder.append((e&4278190080)>>>24),this.bufferBuilder.append((e&16711680)>>>16),this.bufferBuilder.append((e&65280)>>>8),this.bufferBuilder.append(e&255),this.bufferBuilder.append((t&4278190080)>>>24),this.bufferBuilder.append((t&16711680)>>>16),this.bufferBuilder.append((t&65280)>>>8),this.bufferBuilder.append(t&255)};function Z8(n){var e=n.charCodeAt(0);return e<=2047?"00":e<=65535?"000":e<=2097151?"0000":e<=67108863?"00000":"000000"}function $8(n){return n.length>600?new Blob([n]).size:n.replace(/[^\u0000-\u007F]/g,Z8).length}const eP=i_(K8);let BL=!0,DL=!0;function hg(n,e,t){const i=n.match(e);return i&&i.length>=t&&parseInt(i[t],10)}function ep(n,e,t){if(!n.RTCPeerConnection)return;const i=n.RTCPeerConnection.prototype,s=i.addEventListener;i.addEventListener=function(o,a){if(o!==e)return s.apply(this,arguments);const l=c=>{const u=t(c);u&&(a.handleEvent?a.handleEvent(u):a(u))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(a,l),s.apply(this,[o,l])};const r=i.removeEventListener;i.removeEventListener=function(o,a){if(o!==e||!this._eventMap||!this._eventMap[e])return r.apply(this,arguments);if(!this._eventMap[e].has(a))return r.apply(this,arguments);const l=this._eventMap[e].get(a);return this._eventMap[e].delete(a),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,r.apply(this,[o,l])},Object.defineProperty(i,"on"+e,{get(){return this["_on"+e]},set(o){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),o&&this.addEventListener(e,this["_on"+e]=o)},enumerable:!0,configurable:!0})}function eW(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(BL=n,n?"adapter.js logging disabled":"adapter.js logging enabled")}function tW(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(DL=!n,"adapter.js deprecation warnings "+(n?"disabled":"enabled"))}function HM(){if(typeof window=="object"){if(BL)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function n_(n,e){DL&&console.warn(n+" is deprecated, please use "+e+" instead.")}function iW(n){const e={browser:null,version:null};if(typeof n>"u"||!n.navigator)return e.browser="Not a browser.",e;const{navigator:t}=n;if(t.mozGetUserMedia)e.browser="firefox",e.version=hg(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia||n.isSecureContext===!1&&n.webkitRTCPeerConnection&&!n.RTCIceGatherer)e.browser="chrome",e.version=hg(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))e.browser="edge",e.version=hg(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else if(n.RTCPeerConnection&&t.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=hg(t.userAgent,/AppleWebKit\/(\d+)\./,1),e.supportsUnifiedPlan=n.RTCRtpTransceiver&&"currentDirection"in n.RTCRtpTransceiver.prototype;else return e.browser="Not a supported browser.",e;return e}function tP(n){return Object.prototype.toString.call(n)==="[object Object]"}function OL(n){return tP(n)?Object.keys(n).reduce(function(e,t){const i=tP(n[t]),s=i?OL(n[t]):n[t],r=i&&!Object.keys(s).length;return s===void 0||r?e:Object.assign(e,{[t]:s})},{}):n}function AC(n,e,t){!e||t.has(e.id)||(t.set(e.id,e),Object.keys(e).forEach(i=>{i.endsWith("Id")?AC(n,n.get(e[i]),t):i.endsWith("Ids")&&e[i].forEach(s=>{AC(n,n.get(s),t)})}))}function iP(n,e,t){const i=t?"outbound-rtp":"inbound-rtp",s=new Map;if(e===null)return s;const r=[];return n.forEach(o=>{o.type==="track"&&o.trackIdentifier===e.id&&r.push(o)}),r.forEach(o=>{n.forEach(a=>{a.type===i&&a.trackId===o.id&&AC(n,a,s)})}),s}const nP=HM;function kL(n,e){const t=n&&n.navigator;if(!t.mediaDevices)return;const i=function(a){if(typeof a!="object"||a.mandatory||a.optional)return a;const l={};return Object.keys(a).forEach(c=>{if(c==="require"||c==="advanced"||c==="mediaSource")return;const u=typeof a[c]=="object"?a[c]:{ideal:a[c]};u.exact!==void 0&&typeof u.exact=="number"&&(u.min=u.max=u.exact);const d=function(f,p){return f?f+p.charAt(0).toUpperCase()+p.slice(1):p==="deviceId"?"sourceId":p};if(u.ideal!==void 0){l.optional=l.optional||[];let f={};typeof u.ideal=="number"?(f[d("min",c)]=u.ideal,l.optional.push(f),f={},f[d("max",c)]=u.ideal,l.optional.push(f)):(f[d("",c)]=u.ideal,l.optional.push(f))}u.exact!==void 0&&typeof u.exact!="number"?(l.mandatory=l.mandatory||{},l.mandatory[d("",c)]=u.exact):["min","max"].forEach(f=>{u[f]!==void 0&&(l.mandatory=l.mandatory||{},l.mandatory[d(f,c)]=u[f])})}),a.advanced&&(l.optional=(l.optional||[]).concat(a.advanced)),l},s=function(a,l){if(e.version>=61)return l(a);if(a=JSON.parse(JSON.stringify(a)),a&&typeof a.audio=="object"){const c=function(u,d,f){d in u&&!(f in u)&&(u[f]=u[d],delete u[d])};a=JSON.parse(JSON.stringify(a)),c(a.audio,"autoGainControl","googAutoGainControl"),c(a.audio,"noiseSuppression","googNoiseSuppression"),a.audio=i(a.audio)}if(a&&typeof a.video=="object"){let c=a.video.facingMode;c=c&&(typeof c=="object"?c:{ideal:c});const u=e.version<66;if(c&&(c.exact==="user"||c.exact==="environment"||c.ideal==="user"||c.ideal==="environment")&&!(t.mediaDevices.getSupportedConstraints&&t.mediaDevices.getSupportedConstraints().facingMode&&!u)){delete a.video.facingMode;let d;if(c.exact==="environment"||c.ideal==="environment"?d=["back","rear"]:(c.exact==="user"||c.ideal==="user")&&(d=["front"]),d)return t.mediaDevices.enumerateDevices().then(f=>{f=f.filter(g=>g.kind==="videoinput");let p=f.find(g=>d.some(A=>g.label.toLowerCase().includes(A)));return!p&&f.length&&d.includes("back")&&(p=f[f.length-1]),p&&(a.video.deviceId=c.exact?{exact:p.deviceId}:{ideal:p.deviceId}),a.video=i(a.video),nP("chrome: "+JSON.stringify(a)),l(a)})}a.video=i(a.video)}return nP("chrome: "+JSON.stringify(a)),l(a)},r=function(a){return e.version>=64?a:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[a.name]||a.name,message:a.message,constraint:a.constraint||a.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},o=function(a,l,c){s(a,u=>{t.webkitGetUserMedia(u,l,d=>{c&&c(r(d))})})};if(t.getUserMedia=o.bind(t),t.mediaDevices.getUserMedia){const a=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(l){return s(l,c=>a(c).then(u=>{if(c.audio&&!u.getAudioTracks().length||c.video&&!u.getVideoTracks().length)throw u.getTracks().forEach(d=>{d.stop()}),new DOMException("","NotFoundError");return u},u=>Promise.reject(r(u))))}}}function nW(n,e){if(!(n.navigator.mediaDevices&&"getDisplayMedia"in n.navigator.mediaDevices)&&n.navigator.mediaDevices){if(typeof e!="function"){console.error("shimGetDisplayMedia: getSourceId argument is not a function");return}n.navigator.mediaDevices.getDisplayMedia=function(i){return e(i).then(s=>{const r=i.video&&i.video.width,o=i.video&&i.video.height,a=i.video&&i.video.frameRate;return i.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:s,maxFrameRate:a||3}},r&&(i.video.mandatory.maxWidth=r),o&&(i.video.mandatory.maxHeight=o),n.navigator.mediaDevices.getUserMedia(i)})}}}function LL(n){n.MediaStream=n.MediaStream||n.webkitMediaStream}function FL(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("ontrack"in n.RTCPeerConnection.prototype)){Object.defineProperty(n.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(t){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=t)},enumerable:!0,configurable:!0});const e=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",s=>{let r;n.RTCPeerConnection.prototype.getReceivers?r=this.getReceivers().find(a=>a.track&&a.track.id===s.track.id):r={track:s.track};const o=new Event("track");o.track=s.track,o.receiver=r,o.transceiver={receiver:r},o.streams=[i.stream],this.dispatchEvent(o)}),i.stream.getTracks().forEach(s=>{let r;n.RTCPeerConnection.prototype.getReceivers?r=this.getReceivers().find(a=>a.track&&a.track.id===s.id):r={track:s};const o=new Event("track");o.track=s,o.receiver=r,o.transceiver={receiver:r},o.streams=[i.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else ep(n,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function UL(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("getSenders"in n.RTCPeerConnection.prototype)&&"createDTMFSender"in n.RTCPeerConnection.prototype){const e=function(s,r){return{track:r,get dtmf(){return this._dtmf===void 0&&(r.kind==="audio"?this._dtmf=s.createDTMFSender(r):this._dtmf=null),this._dtmf},_pc:s}};if(!n.RTCPeerConnection.prototype.getSenders){n.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const s=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(a,l){let c=s.apply(this,arguments);return c||(c=e(this,a),this._senders.push(c)),c};const r=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(a){r.apply(this,arguments);const l=this._senders.indexOf(a);l!==-1&&this._senders.splice(l,1)}}const t=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(r){this._senders=this._senders||[],t.apply(this,[r]),r.getTracks().forEach(o=>{this._senders.push(e(this,o))})};const i=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(r){this._senders=this._senders||[],i.apply(this,[r]),r.getTracks().forEach(o=>{const a=this._senders.find(l=>l.track===o);a&&this._senders.splice(this._senders.indexOf(a),1)})}}else if(typeof n=="object"&&n.RTCPeerConnection&&"getSenders"in n.RTCPeerConnection.prototype&&"createDTMFSender"in n.RTCPeerConnection.prototype&&n.RTCRtpSender&&!("dtmf"in n.RTCRtpSender.prototype)){const e=n.RTCPeerConnection.prototype.getSenders;n.RTCPeerConnection.prototype.getSenders=function(){const i=e.apply(this,[]);return i.forEach(s=>s._pc=this),i},Object.defineProperty(n.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function NL(n){if(!n.RTCPeerConnection)return;const e=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){const[i,s,r]=arguments;if(arguments.length>0&&typeof i=="function")return e.apply(this,arguments);if(e.length===0&&(arguments.length===0||typeof i!="function"))return e.apply(this,[]);const o=function(l){const c={};return l.result().forEach(d=>{const f={id:d.id,timestamp:d.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[d.type]||d.type};d.names().forEach(p=>{f[p]=d.stat(p)}),c[f.id]=f}),c},a=function(l){return new Map(Object.keys(l).map(c=>[c,l[c]]))};if(arguments.length>=2){const l=function(c){s(a(o(c)))};return e.apply(this,[l,i])}return new Promise((l,c)=>{e.apply(this,[function(u){l(a(o(u)))},c])}).then(s,r)}}function zL(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender&&n.RTCRtpReceiver))return;if(!("getStats"in n.RTCRtpSender.prototype)){const t=n.RTCPeerConnection.prototype.getSenders;t&&(n.RTCPeerConnection.prototype.getSenders=function(){const r=t.apply(this,[]);return r.forEach(o=>o._pc=this),r});const i=n.RTCPeerConnection.prototype.addTrack;i&&(n.RTCPeerConnection.prototype.addTrack=function(){const r=i.apply(this,arguments);return r._pc=this,r}),n.RTCRtpSender.prototype.getStats=function(){const r=this;return this._pc.getStats().then(o=>iP(o,r.track,!0))}}if(!("getStats"in n.RTCRtpReceiver.prototype)){const t=n.RTCPeerConnection.prototype.getReceivers;t&&(n.RTCPeerConnection.prototype.getReceivers=function(){const s=t.apply(this,[]);return s.forEach(r=>r._pc=this),s}),ep(n,"track",i=>(i.receiver._pc=i.srcElement,i)),n.RTCRtpReceiver.prototype.getStats=function(){const s=this;return this._pc.getStats().then(r=>iP(r,s.track,!1))}}if(!("getStats"in n.RTCRtpSender.prototype&&"getStats"in n.RTCRtpReceiver.prototype))return;const e=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof n.MediaStreamTrack){const i=arguments[0];let s,r,o;return this.getSenders().forEach(a=>{a.track===i&&(s?o=!0:s=a)}),this.getReceivers().forEach(a=>(a.track===i&&(r?o=!0:r=a),a.track===i)),o||s&&r?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):s?s.getStats():r?r.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function GL(n){n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};const e=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(o,a){if(!a)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const l=e.apply(this,arguments);return this._shimmedLocalStreams[a.id]?this._shimmedLocalStreams[a.id].indexOf(l)===-1&&this._shimmedLocalStreams[a.id].push(l):this._shimmedLocalStreams[a.id]=[a,l],l};const t=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(c=>{if(this.getSenders().find(d=>d.track===c))throw new DOMException("Track already exists.","InvalidAccessError")});const a=this.getSenders();t.apply(this,arguments);const l=this.getSenders().filter(c=>a.indexOf(c)===-1);this._shimmedLocalStreams[o.id]=[o].concat(l)};const i=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],i.apply(this,arguments)};const s=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(a=>{const l=this._shimmedLocalStreams[a].indexOf(o);l!==-1&&this._shimmedLocalStreams[a].splice(l,1),this._shimmedLocalStreams[a].length===1&&delete this._shimmedLocalStreams[a]}),s.apply(this,arguments)}}function VL(n,e){if(!n.RTCPeerConnection)return;if(n.RTCPeerConnection.prototype.addTrack&&e.version>=65)return GL(n);const t=n.RTCPeerConnection.prototype.getLocalStreams;n.RTCPeerConnection.prototype.getLocalStreams=function(){const u=t.apply(this);return this._reverseStreams=this._reverseStreams||{},u.map(d=>this._reverseStreams[d.id])};const i=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(u){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},u.getTracks().forEach(d=>{if(this.getSenders().find(p=>p.track===d))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[u.id]){const d=new n.MediaStream(u.getTracks());this._streams[u.id]=d,this._reverseStreams[d.id]=u,u=d}i.apply(this,[u])};const s=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(u){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},s.apply(this,[this._streams[u.id]||u]),delete this._reverseStreams[this._streams[u.id]?this._streams[u.id].id:u.id],delete this._streams[u.id]},n.RTCPeerConnection.prototype.addTrack=function(u,d){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const f=[].slice.call(arguments,1);if(f.length!==1||!f[0].getTracks().find(A=>A===u))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(A=>A.track===u))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const g=this._streams[d.id];if(g)g.addTrack(u),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const A=new n.MediaStream([u]);this._streams[d.id]=A,this._reverseStreams[A.id]=d,this.addStream(A)}return this.getSenders().find(A=>A.track===u)};function r(c,u){let d=u.sdp;return Object.keys(c._reverseStreams||[]).forEach(f=>{const p=c._reverseStreams[f],g=c._streams[p.id];d=d.replace(new RegExp(g.id,"g"),p.id)}),new RTCSessionDescription({type:u.type,sdp:d})}function o(c,u){let d=u.sdp;return Object.keys(c._reverseStreams||[]).forEach(f=>{const p=c._reverseStreams[f],g=c._streams[p.id];d=d.replace(new RegExp(p.id,"g"),g.id)}),new RTCSessionDescription({type:u.type,sdp:d})}["createOffer","createAnswer"].forEach(function(c){const u=n.RTCPeerConnection.prototype[c],d={[c](){const f=arguments;return arguments.length&&typeof arguments[0]=="function"?u.apply(this,[g=>{const A=r(this,g);f[0].apply(null,[A])},g=>{f[1]&&f[1].apply(null,g)},arguments[2]]):u.apply(this,arguments).then(g=>r(this,g))}};n.RTCPeerConnection.prototype[c]=d[c]});const a=n.RTCPeerConnection.prototype.setLocalDescription;n.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?a.apply(this,arguments):(arguments[0]=o(this,arguments[0]),a.apply(this,arguments))};const l=Object.getOwnPropertyDescriptor(n.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(n.RTCPeerConnection.prototype,"localDescription",{get(){const c=l.get.apply(this);return c.type===""?c:r(this,c)}}),n.RTCPeerConnection.prototype.removeTrack=function(u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!u._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(u._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let f;Object.keys(this._streams).forEach(p=>{this._streams[p].getTracks().find(A=>u.track===A)&&(f=this._streams[p])}),f&&(f.getTracks().length===1?this.removeStream(this._reverseStreams[f.id]):f.removeTrack(u.track),this.dispatchEvent(new Event("negotiationneeded")))}}function vC(n,e){!n.RTCPeerConnection&&n.webkitRTCPeerConnection&&(n.RTCPeerConnection=n.webkitRTCPeerConnection),n.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){const i=n.RTCPeerConnection.prototype[t],s={[t](){return arguments[0]=new(t==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};n.RTCPeerConnection.prototype[t]=s[t]})}function HL(n,e){ep(n,"negotiationneeded",t=>{const i=t.target;if(!((e.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")&&i.signalingState!=="stable"))return t})}const sP=Object.freeze(Object.defineProperty({__proto__:null,fixNegotiationNeeded:HL,shimAddTrackRemoveTrack:VL,shimAddTrackRemoveTrackWithNative:GL,shimGetDisplayMedia:nW,shimGetSendersWithDtmf:UL,shimGetStats:NL,shimGetUserMedia:kL,shimMediaStream:LL,shimOnTrack:FL,shimPeerConnection:vC,shimSenderReceiverGetStats:zL},Symbol.toStringTag,{value:"Module"}));function sW(n,e){let t=!1;return n=JSON.parse(JSON.stringify(n)),n.filter(i=>{if(i&&(i.urls||i.url)){let s=i.urls||i.url;i.url&&!i.urls&&n_("RTCIceServer.url","RTCIceServer.urls");const r=typeof s=="string";return r&&(s=[s]),s=s.filter(o=>{if(o.indexOf("stun:")===0)return!1;const a=o.startsWith("turn")&&!o.startsWith("turn:[")&&o.includes("transport=udp");return a&&!t?(t=!0,!0):a&&!t}),delete i.url,i.urls=r?s[0]:s,!!s.length}})}var QL={exports:{}};(function(n){var e={};e.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},e.localCName=e.generateIdentifier(),e.splitLines=function(t){return t.trim().split(`
`).map(function(i){return i.trim()})},e.splitSections=function(t){var i=t.split(`
m=`);return i.map(function(s,r){return(r>0?"m="+s:s).trim()+`\r
`})},e.getDescription=function(t){var i=e.splitSections(t);return i&&i[0]},e.getMediaSections=function(t){var i=e.splitSections(t);return i.shift(),i},e.matchPrefix=function(t,i){return e.splitLines(t).filter(function(s){return s.indexOf(i)===0})},e.parseCandidate=function(t){var i;t.indexOf("a=candidate:")===0?i=t.substring(12).split(" "):i=t.substring(10).split(" ");for(var s={foundation:i[0],component:parseInt(i[1],10),protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]},r=8;r<i.length;r+=2)switch(i[r]){case"raddr":s.relatedAddress=i[r+1];break;case"rport":s.relatedPort=parseInt(i[r+1],10);break;case"tcptype":s.tcpType=i[r+1];break;case"ufrag":s.ufrag=i[r+1],s.usernameFragment=i[r+1];break;default:s[i[r]]=i[r+1];break}return s},e.writeCandidate=function(t){var i=[];i.push(t.foundation),i.push(t.component),i.push(t.protocol.toUpperCase()),i.push(t.priority),i.push(t.address||t.ip),i.push(t.port);var s=t.type;return i.push("typ"),i.push(s),s!=="host"&&t.relatedAddress&&t.relatedPort&&(i.push("raddr"),i.push(t.relatedAddress),i.push("rport"),i.push(t.relatedPort)),t.tcpType&&t.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(t.tcpType)),(t.usernameFragment||t.ufrag)&&(i.push("ufrag"),i.push(t.usernameFragment||t.ufrag)),"candidate:"+i.join(" ")},e.parseIceOptions=function(t){return t.substr(14).split(" ")},e.parseRtpMap=function(t){var i=t.substr(9).split(" "),s={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),s.name=i[0],s.clockRate=parseInt(i[1],10),s.channels=i.length===3?parseInt(i[2],10):1,s.numChannels=s.channels,s},e.writeRtpMap=function(t){var i=t.payloadType;t.preferredPayloadType!==void 0&&(i=t.preferredPayloadType);var s=t.channels||t.numChannels||1;return"a=rtpmap:"+i+" "+t.name+"/"+t.clockRate+(s!==1?"/"+s:"")+`\r
`},e.parseExtmap=function(t){var i=t.substr(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1]}},e.writeExtmap=function(t){return"a=extmap:"+(t.id||t.preferredId)+(t.direction&&t.direction!=="sendrecv"?"/"+t.direction:"")+" "+t.uri+`\r
`},e.parseFmtp=function(t){for(var i={},s,r=t.substr(t.indexOf(" ")+1).split(";"),o=0;o<r.length;o++)s=r[o].trim().split("="),i[s[0].trim()]=s[1];return i},e.writeFmtp=function(t){var i="",s=t.payloadType;if(t.preferredPayloadType!==void 0&&(s=t.preferredPayloadType),t.parameters&&Object.keys(t.parameters).length){var r=[];Object.keys(t.parameters).forEach(function(o){t.parameters[o]?r.push(o+"="+t.parameters[o]):r.push(o)}),i+="a=fmtp:"+s+" "+r.join(";")+`\r
`}return i},e.parseRtcpFb=function(t){var i=t.substr(t.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},e.writeRtcpFb=function(t){var i="",s=t.payloadType;return t.preferredPayloadType!==void 0&&(s=t.preferredPayloadType),t.rtcpFeedback&&t.rtcpFeedback.length&&t.rtcpFeedback.forEach(function(r){i+="a=rtcp-fb:"+s+" "+r.type+(r.parameter&&r.parameter.length?" "+r.parameter:"")+`\r
`}),i},e.parseSsrcMedia=function(t){var i=t.indexOf(" "),s={ssrc:parseInt(t.substr(7,i-7),10)},r=t.indexOf(":",i);return r>-1?(s.attribute=t.substr(i+1,r-i-1),s.value=t.substr(r+1)):s.attribute=t.substr(i+1),s},e.parseSsrcGroup=function(t){var i=t.substr(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(function(s){return parseInt(s,10)})}},e.getMid=function(t){var i=e.matchPrefix(t,"a=mid:")[0];if(i)return i.substr(6)},e.parseFingerprint=function(t){var i=t.substr(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1]}},e.getDtlsParameters=function(t,i){var s=e.matchPrefix(t+i,"a=fingerprint:");return{role:"auto",fingerprints:s.map(e.parseFingerprint)}},e.writeDtlsParameters=function(t,i){var s="a=setup:"+i+`\r
`;return t.fingerprints.forEach(function(r){s+="a=fingerprint:"+r.algorithm+" "+r.value+`\r
`}),s},e.parseCryptoLine=function(t){var i=t.substr(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},e.writeCryptoLine=function(t){return"a=crypto:"+t.tag+" "+t.cryptoSuite+" "+(typeof t.keyParams=="object"?e.writeCryptoKeyParams(t.keyParams):t.keyParams)+(t.sessionParams?" "+t.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(t){if(t.indexOf("inline:")!==0)return null;var i=t.substr(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(t){return t.keyMethod+":"+t.keySalt+(t.lifeTime?"|"+t.lifeTime:"")+(t.mkiValue&&t.mkiLength?"|"+t.mkiValue+":"+t.mkiLength:"")},e.getCryptoParameters=function(t,i){var s=e.matchPrefix(t+i,"a=crypto:");return s.map(e.parseCryptoLine)},e.getIceParameters=function(t,i){var s=e.matchPrefix(t+i,"a=ice-ufrag:")[0],r=e.matchPrefix(t+i,"a=ice-pwd:")[0];return s&&r?{usernameFragment:s.substr(12),password:r.substr(10)}:null},e.writeIceParameters=function(t){return"a=ice-ufrag:"+t.usernameFragment+`\r
a=ice-pwd:`+t.password+`\r
`},e.parseRtpParameters=function(t){for(var i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},s=e.splitLines(t),r=s[0].split(" "),o=3;o<r.length;o++){var a=r[o],l=e.matchPrefix(t,"a=rtpmap:"+a+" ")[0];if(l){var c=e.parseRtpMap(l),u=e.matchPrefix(t,"a=fmtp:"+a+" ");switch(c.parameters=u.length?e.parseFmtp(u[0]):{},c.rtcpFeedback=e.matchPrefix(t,"a=rtcp-fb:"+a+" ").map(e.parseRtcpFb),i.codecs.push(c),c.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(c.name.toUpperCase());break}}}return e.matchPrefix(t,"a=extmap:").forEach(function(d){i.headerExtensions.push(e.parseExtmap(d))}),i},e.writeRtpDescription=function(t,i){var s="";s+="m="+t+" ",s+=i.codecs.length>0?"9":"0",s+=" UDP/TLS/RTP/SAVPF ",s+=i.codecs.map(function(o){return o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType}).join(" ")+`\r
`,s+=`c=IN IP4 0.0.0.0\r
`,s+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(function(o){s+=e.writeRtpMap(o),s+=e.writeFmtp(o),s+=e.writeRtcpFb(o)});var r=0;return i.codecs.forEach(function(o){o.maxptime>r&&(r=o.maxptime)}),r>0&&(s+="a=maxptime:"+r+`\r
`),s+=`a=rtcp-mux\r
`,i.headerExtensions&&i.headerExtensions.forEach(function(o){s+=e.writeExtmap(o)}),s},e.parseRtpEncodingParameters=function(t){var i=[],s=e.parseRtpParameters(t),r=s.fecMechanisms.indexOf("RED")!==-1,o=s.fecMechanisms.indexOf("ULPFEC")!==-1,a=e.matchPrefix(t,"a=ssrc:").map(function(f){return e.parseSsrcMedia(f)}).filter(function(f){return f.attribute==="cname"}),l=a.length>0&&a[0].ssrc,c,u=e.matchPrefix(t,"a=ssrc-group:FID").map(function(f){var p=f.substr(17).split(" ");return p.map(function(g){return parseInt(g,10)})});u.length>0&&u[0].length>1&&u[0][0]===l&&(c=u[0][1]),s.codecs.forEach(function(f){if(f.name.toUpperCase()==="RTX"&&f.parameters.apt){var p={ssrc:l,codecPayloadType:parseInt(f.parameters.apt,10)};l&&c&&(p.rtx={ssrc:c}),i.push(p),r&&(p=JSON.parse(JSON.stringify(p)),p.fec={ssrc:l,mechanism:o?"red+ulpfec":"red"},i.push(p))}}),i.length===0&&l&&i.push({ssrc:l});var d=e.matchPrefix(t,"b=");return d.length&&(d[0].indexOf("b=TIAS:")===0?d=parseInt(d[0].substr(7),10):d[0].indexOf("b=AS:")===0?d=parseInt(d[0].substr(5),10)*1e3*.95-50*40*8:d=void 0,i.forEach(function(f){f.maxBitrate=d})),i},e.parseRtcpParameters=function(t){var i={},s=e.matchPrefix(t,"a=ssrc:").map(function(a){return e.parseSsrcMedia(a)}).filter(function(a){return a.attribute==="cname"})[0];s&&(i.cname=s.value,i.ssrc=s.ssrc);var r=e.matchPrefix(t,"a=rtcp-rsize");i.reducedSize=r.length>0,i.compound=r.length===0;var o=e.matchPrefix(t,"a=rtcp-mux");return i.mux=o.length>0,i},e.parseMsid=function(t){var i,s=e.matchPrefix(t,"a=msid:");if(s.length===1)return i=s[0].substr(7).split(" "),{stream:i[0],track:i[1]};var r=e.matchPrefix(t,"a=ssrc:").map(function(o){return e.parseSsrcMedia(o)}).filter(function(o){return o.attribute==="msid"});if(r.length>0)return i=r[0].value.split(" "),{stream:i[0],track:i[1]}},e.parseSctpDescription=function(t){var i=e.parseMLine(t),s=e.matchPrefix(t,"a=max-message-size:"),r;s.length>0&&(r=parseInt(s[0].substr(19),10)),isNaN(r)&&(r=65536);var o=e.matchPrefix(t,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substr(12),10),protocol:i.fmt,maxMessageSize:r};var a=e.matchPrefix(t,"a=sctpmap:");if(a.length>0){var l=e.matchPrefix(t,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(l[0],10),protocol:l[1],maxMessageSize:r}}},e.writeSctpDescription=function(t,i){var s=[];return t.protocol!=="DTLS/SCTP"?s=["m="+t.kind+" 9 "+t.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:s=["m="+t.kind+" 9 "+t.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&s.push("a=max-message-size:"+i.maxMessageSize+`\r
`),s.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,21)},e.writeSessionBoilerplate=function(t,i,s){var r,o=i!==void 0?i:2;t?r=t:r=e.generateSessionId();var a=s||"thisisadapterortc";return`v=0\r
o=`+a+" "+r+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.writeMediaSection=function(t,i,s,r){var o=e.writeRtpDescription(t.kind,i);if(o+=e.writeIceParameters(t.iceGatherer.getLocalParameters()),o+=e.writeDtlsParameters(t.dtlsTransport.getLocalParameters(),s==="offer"?"actpass":"active"),o+="a=mid:"+t.mid+`\r
`,t.direction?o+="a="+t.direction+`\r
`:t.rtpSender&&t.rtpReceiver?o+=`a=sendrecv\r
`:t.rtpSender?o+=`a=sendonly\r
`:t.rtpReceiver?o+=`a=recvonly\r
`:o+=`a=inactive\r
`,t.rtpSender){var a="msid:"+r.id+" "+t.rtpSender.track.id+`\r
`;o+="a="+a,o+="a=ssrc:"+t.sendEncodingParameters[0].ssrc+" "+a,t.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+t.sendEncodingParameters[0].rtx.ssrc+" "+a,o+="a=ssrc-group:FID "+t.sendEncodingParameters[0].ssrc+" "+t.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return o+="a=ssrc:"+t.sendEncodingParameters[0].ssrc+" cname:"+e.localCName+`\r
`,t.rtpSender&&t.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+t.sendEncodingParameters[0].rtx.ssrc+" cname:"+e.localCName+`\r
`),o},e.getDirection=function(t,i){for(var s=e.splitLines(t),r=0;r<s.length;r++)switch(s[r]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return s[r].substr(2)}return i?e.getDirection(i):"sendrecv"},e.getKind=function(t){var i=e.splitLines(t),s=i[0].split(" ");return s[0].substr(2)},e.isRejected=function(t){return t.split(" ",2)[1]==="0"},e.parseMLine=function(t){var i=e.splitLines(t),s=i[0].substr(2).split(" ");return{kind:s[0],port:parseInt(s[1],10),protocol:s[2],fmt:s.slice(3).join(" ")}},e.parseOLine=function(t){var i=e.matchPrefix(t,"o=")[0],s=i.substr(2).split(" ");return{username:s[0],sessionId:s[1],sessionVersion:parseInt(s[2],10),netType:s[3],addressType:s[4],address:s[5]}},e.isValidSDP=function(t){if(typeof t!="string"||t.length===0)return!1;for(var i=e.splitLines(t),s=0;s<i.length;s++)if(i[s].length<2||i[s].charAt(1)!=="=")return!1;return!0},n.exports=e})(QL);var WL=QL.exports;const Cy=i_(WL);var St=WL;function rW(n){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[n.type]||n.type}function rP(n,e,t,i,s){var r=St.writeRtpDescription(n.kind,e);if(r+=St.writeIceParameters(n.iceGatherer.getLocalParameters()),r+=St.writeDtlsParameters(n.dtlsTransport.getLocalParameters(),t==="offer"?"actpass":s||"active"),r+="a=mid:"+n.mid+`\r
`,n.rtpSender&&n.rtpReceiver?r+=`a=sendrecv\r
`:n.rtpSender?r+=`a=sendonly\r
`:n.rtpReceiver?r+=`a=recvonly\r
`:r+=`a=inactive\r
`,n.rtpSender){var o=n.rtpSender._initialTrackId||n.rtpSender.track.id;n.rtpSender._initialTrackId=o;var a="msid:"+(i?i.id:"-")+" "+o+`\r
`;r+="a="+a,r+="a=ssrc:"+n.sendEncodingParameters[0].ssrc+" "+a,n.sendEncodingParameters[0].rtx&&(r+="a=ssrc:"+n.sendEncodingParameters[0].rtx.ssrc+" "+a,r+="a=ssrc-group:FID "+n.sendEncodingParameters[0].ssrc+" "+n.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return r+="a=ssrc:"+n.sendEncodingParameters[0].ssrc+" cname:"+St.localCName+`\r
`,n.rtpSender&&n.sendEncodingParameters[0].rtx&&(r+="a=ssrc:"+n.sendEncodingParameters[0].rtx.ssrc+" cname:"+St.localCName+`\r
`),r}function oW(n,e){var t=!1;return n=JSON.parse(JSON.stringify(n)),n.filter(function(i){if(i&&(i.urls||i.url)){var s=i.urls||i.url;i.url&&!i.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var r=typeof s=="string";return r&&(s=[s]),s=s.filter(function(o){var a=o.indexOf("turn:")===0&&o.indexOf("transport=udp")!==-1&&o.indexOf("turn:[")===-1&&!t;return a?(t=!0,!0):o.indexOf("stun:")===0&&e>=14393&&o.indexOf("?transport=udp")===-1}),delete i.url,i.urls=r?s[0]:s,!!s.length}})}function Bv(n,e){var t={codecs:[],headerExtensions:[],fecMechanisms:[]},i=function(r,o){r=parseInt(r,10);for(var a=0;a<o.length;a++)if(o[a].payloadType===r||o[a].preferredPayloadType===r)return o[a]},s=function(r,o,a,l){var c=i(r.parameters.apt,a),u=i(o.parameters.apt,l);return c&&u&&c.name.toLowerCase()===u.name.toLowerCase()};return n.codecs.forEach(function(r){for(var o=0;o<e.codecs.length;o++){var a=e.codecs[o];if(r.name.toLowerCase()===a.name.toLowerCase()&&r.clockRate===a.clockRate){if(r.name.toLowerCase()==="rtx"&&r.parameters&&a.parameters.apt&&!s(r,a,n.codecs,e.codecs))continue;a=JSON.parse(JSON.stringify(a)),a.numChannels=Math.min(r.numChannels,a.numChannels),t.codecs.push(a),a.rtcpFeedback=a.rtcpFeedback.filter(function(l){for(var c=0;c<r.rtcpFeedback.length;c++)if(r.rtcpFeedback[c].type===l.type&&r.rtcpFeedback[c].parameter===l.parameter)return!0;return!1});break}}}),n.headerExtensions.forEach(function(r){for(var o=0;o<e.headerExtensions.length;o++){var a=e.headerExtensions[o];if(r.uri===a.uri){t.headerExtensions.push(a);break}}}),t}function oP(n,e,t){return{offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[e][n].indexOf(t)!==-1}function ow(n,e){var t=n.getRemoteCandidates().find(function(i){return e.foundation===i.foundation&&e.ip===i.ip&&e.port===i.port&&e.priority===i.priority&&e.protocol===i.protocol&&e.type===i.type});return t||n.addRemoteCandidate(e),!t}function vs(n,e){var t=new Error(e);return t.name=n,t.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[n],t}var aW=function(n,e){function t(l,c){c.addTrack(l),c.dispatchEvent(new n.MediaStreamTrackEvent("addtrack",{track:l}))}function i(l,c){c.removeTrack(l),c.dispatchEvent(new n.MediaStreamTrackEvent("removetrack",{track:l}))}function s(l,c,u,d){var f=new Event("track");f.track=c,f.receiver=u,f.transceiver={receiver:u},f.streams=d,n.setTimeout(function(){l._dispatchEvent("track",f)})}var r=function(l){var c=this,u=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(f){c[f]=u[f].bind(u)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",l=JSON.parse(JSON.stringify(l||{})),this.usingBundle=l.bundlePolicy==="max-bundle",l.rtcpMuxPolicy==="negotiate")throw vs("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(l.rtcpMuxPolicy||(l.rtcpMuxPolicy="require"),l.iceTransportPolicy){case"all":case"relay":break;default:l.iceTransportPolicy="all";break}switch(l.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:l.bundlePolicy="balanced";break}if(l.iceServers=oW(l.iceServers||[],e),this._iceGatherers=[],l.iceCandidatePoolSize)for(var d=l.iceCandidatePoolSize;d>0;d--)this._iceGatherers.push(new n.RTCIceGatherer({iceServers:l.iceServers,gatherPolicy:l.iceTransportPolicy}));else l.iceCandidatePoolSize=0;this._config=l,this.transceivers=[],this._sdpSessionId=St.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(r.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(r.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),r.prototype.onicecandidate=null,r.prototype.onaddstream=null,r.prototype.ontrack=null,r.prototype.onremovestream=null,r.prototype.onsignalingstatechange=null,r.prototype.oniceconnectionstatechange=null,r.prototype.onconnectionstatechange=null,r.prototype.onicegatheringstatechange=null,r.prototype.onnegotiationneeded=null,r.prototype.ondatachannel=null,r.prototype._dispatchEvent=function(l,c){this._isClosed||(this.dispatchEvent(c),typeof this["on"+l]=="function"&&this["on"+l](c))},r.prototype._emitGatheringStateChange=function(){var l=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",l)},r.prototype.getConfiguration=function(){return this._config},r.prototype.getLocalStreams=function(){return this.localStreams},r.prototype.getRemoteStreams=function(){return this.remoteStreams},r.prototype._createTransceiver=function(l,c){var u=this.transceivers.length>0,d={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:l,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&u)d.iceTransport=this.transceivers[0].iceTransport,d.dtlsTransport=this.transceivers[0].dtlsTransport;else{var f=this._createIceAndDtlsTransports();d.iceTransport=f.iceTransport,d.dtlsTransport=f.dtlsTransport}return c||this.transceivers.push(d),d},r.prototype.addTrack=function(l,c){if(this._isClosed)throw vs("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var u=this.transceivers.find(function(p){return p.track===l});if(u)throw vs("InvalidAccessError","Track already exists.");for(var d,f=0;f<this.transceivers.length;f++)!this.transceivers[f].track&&this.transceivers[f].kind===l.kind&&(d=this.transceivers[f]);return d||(d=this._createTransceiver(l.kind)),this._maybeFireNegotiationNeeded(),this.localStreams.indexOf(c)===-1&&this.localStreams.push(c),d.track=l,d.stream=c,d.rtpSender=new n.RTCRtpSender(l,d.dtlsTransport),d.rtpSender},r.prototype.addStream=function(l){var c=this;if(e>=15025)l.getTracks().forEach(function(d){c.addTrack(d,l)});else{var u=l.clone();l.getTracks().forEach(function(d,f){var p=u.getTracks()[f];d.addEventListener("enabled",function(g){p.enabled=g.enabled})}),u.getTracks().forEach(function(d){c.addTrack(d,u)})}},r.prototype.removeTrack=function(l){if(this._isClosed)throw vs("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(l instanceof n.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var c=this.transceivers.find(function(f){return f.rtpSender===l});if(!c)throw vs("InvalidAccessError","Sender was not created by this connection.");var u=c.stream;c.rtpSender.stop(),c.rtpSender=null,c.track=null,c.stream=null;var d=this.transceivers.map(function(f){return f.stream});d.indexOf(u)===-1&&this.localStreams.indexOf(u)>-1&&this.localStreams.splice(this.localStreams.indexOf(u),1),this._maybeFireNegotiationNeeded()},r.prototype.removeStream=function(l){var c=this;l.getTracks().forEach(function(u){var d=c.getSenders().find(function(f){return f.track===u});d&&c.removeTrack(d)})},r.prototype.getSenders=function(){return this.transceivers.filter(function(l){return!!l.rtpSender}).map(function(l){return l.rtpSender})},r.prototype.getReceivers=function(){return this.transceivers.filter(function(l){return!!l.rtpReceiver}).map(function(l){return l.rtpReceiver})},r.prototype._createIceGatherer=function(l,c){var u=this;if(c&&l>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var d=new n.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(d,"state",{value:"new",writable:!0}),this.transceivers[l].bufferedCandidateEvents=[],this.transceivers[l].bufferCandidates=function(f){var p=!f.candidate||Object.keys(f.candidate).length===0;d.state=p?"completed":"gathering",u.transceivers[l].bufferedCandidateEvents!==null&&u.transceivers[l].bufferedCandidateEvents.push(f)},d.addEventListener("localcandidate",this.transceivers[l].bufferCandidates),d},r.prototype._gather=function(l,c){var u=this,d=this.transceivers[c].iceGatherer;if(!d.onlocalcandidate){var f=this.transceivers[c].bufferedCandidateEvents;this.transceivers[c].bufferedCandidateEvents=null,d.removeEventListener("localcandidate",this.transceivers[c].bufferCandidates),d.onlocalcandidate=function(p){if(!(u.usingBundle&&c>0)){var g=new Event("icecandidate");g.candidate={sdpMid:l,sdpMLineIndex:c};var A=p.candidate,v=!A||Object.keys(A).length===0;if(v)(d.state==="new"||d.state==="gathering")&&(d.state="completed");else{d.state==="new"&&(d.state="gathering"),A.component=1,A.ufrag=d.getLocalParameters().usernameFragment;var m=St.writeCandidate(A);g.candidate=Object.assign(g.candidate,St.parseCandidate(m)),g.candidate.candidate=m,g.candidate.toJSON=function(){return{candidate:g.candidate.candidate,sdpMid:g.candidate.sdpMid,sdpMLineIndex:g.candidate.sdpMLineIndex,usernameFragment:g.candidate.usernameFragment}}}var b=St.getMediaSections(u._localDescription.sdp);v?b[g.candidate.sdpMLineIndex]+=`a=end-of-candidates\r
`:b[g.candidate.sdpMLineIndex]+="a="+g.candidate.candidate+`\r
`,u._localDescription.sdp=St.getDescription(u._localDescription.sdp)+b.join("");var y=u.transceivers.every(function(_){return _.iceGatherer&&_.iceGatherer.state==="completed"});u.iceGatheringState!=="gathering"&&(u.iceGatheringState="gathering",u._emitGatheringStateChange()),v||u._dispatchEvent("icecandidate",g),y&&(u._dispatchEvent("icecandidate",new Event("icecandidate")),u.iceGatheringState="complete",u._emitGatheringStateChange())}},n.setTimeout(function(){f.forEach(function(p){d.onlocalcandidate(p)})},0)}},r.prototype._createIceAndDtlsTransports=function(){var l=this,c=new n.RTCIceTransport(null);c.onicestatechange=function(){l._updateIceConnectionState(),l._updateConnectionState()};var u=new n.RTCDtlsTransport(c);return u.ondtlsstatechange=function(){l._updateConnectionState()},u.onerror=function(){Object.defineProperty(u,"state",{value:"failed",writable:!0}),l._updateConnectionState()},{iceTransport:c,dtlsTransport:u}},r.prototype._disposeIceAndDtlsTransports=function(l){var c=this.transceivers[l].iceGatherer;c&&(delete c.onlocalcandidate,delete this.transceivers[l].iceGatherer);var u=this.transceivers[l].iceTransport;u&&(delete u.onicestatechange,delete this.transceivers[l].iceTransport);var d=this.transceivers[l].dtlsTransport;d&&(delete d.ondtlsstatechange,delete d.onerror,delete this.transceivers[l].dtlsTransport)},r.prototype._transceive=function(l,c,u){var d=Bv(l.localCapabilities,l.remoteCapabilities);c&&l.rtpSender&&(d.encodings=l.sendEncodingParameters,d.rtcp={cname:St.localCName,compound:l.rtcpParameters.compound},l.recvEncodingParameters.length&&(d.rtcp.ssrc=l.recvEncodingParameters[0].ssrc),l.rtpSender.send(d)),u&&l.rtpReceiver&&d.codecs.length>0&&(l.kind==="video"&&l.recvEncodingParameters&&e<15019&&l.recvEncodingParameters.forEach(function(f){delete f.rtx}),l.recvEncodingParameters.length?d.encodings=l.recvEncodingParameters:d.encodings=[{}],d.rtcp={compound:l.rtcpParameters.compound},l.rtcpParameters.cname&&(d.rtcp.cname=l.rtcpParameters.cname),l.sendEncodingParameters.length&&(d.rtcp.ssrc=l.sendEncodingParameters[0].ssrc),l.rtpReceiver.receive(d))},r.prototype.setLocalDescription=function(l){var c=this;if(["offer","answer"].indexOf(l.type)===-1)return Promise.reject(vs("TypeError",'Unsupported type "'+l.type+'"'));if(!oP("setLocalDescription",l.type,c.signalingState)||c._isClosed)return Promise.reject(vs("InvalidStateError","Can not set local "+l.type+" in state "+c.signalingState));var u,d;if(l.type==="offer")u=St.splitSections(l.sdp),d=u.shift(),u.forEach(function(p,g){var A=St.parseRtpParameters(p);c.transceivers[g].localCapabilities=A}),c.transceivers.forEach(function(p,g){c._gather(p.mid,g)});else if(l.type==="answer"){u=St.splitSections(c._remoteDescription.sdp),d=u.shift();var f=St.matchPrefix(d,"a=ice-lite").length>0;u.forEach(function(p,g){var A=c.transceivers[g],v=A.iceGatherer,m=A.iceTransport,b=A.dtlsTransport,y=A.localCapabilities,_=A.remoteCapabilities,E=St.isRejected(p)&&St.matchPrefix(p,"a=bundle-only").length===0;if(!E&&!A.rejected){var M=St.getIceParameters(p,d),I=St.getDtlsParameters(p,d);f&&(I.role="server"),(!c.usingBundle||g===0)&&(c._gather(A.mid,g),m.state==="new"&&m.start(v,M,f?"controlling":"controlled"),b.state==="new"&&b.start(I));var R=Bv(y,_);c._transceive(A,R.codecs.length>0,!1)}})}return c._localDescription={type:l.type,sdp:l.sdp},l.type==="offer"?c._updateSignalingState("have-local-offer"):c._updateSignalingState("stable"),Promise.resolve()},r.prototype.setRemoteDescription=function(l){var c=this;if(["offer","answer"].indexOf(l.type)===-1)return Promise.reject(vs("TypeError",'Unsupported type "'+l.type+'"'));if(!oP("setRemoteDescription",l.type,c.signalingState)||c._isClosed)return Promise.reject(vs("InvalidStateError","Can not set remote "+l.type+" in state "+c.signalingState));var u={};c.remoteStreams.forEach(function(m){u[m.id]=m});var d=[],f=St.splitSections(l.sdp),p=f.shift(),g=St.matchPrefix(p,"a=ice-lite").length>0,A=St.matchPrefix(p,"a=group:BUNDLE ").length>0;c.usingBundle=A;var v=St.matchPrefix(p,"a=ice-options:")[0];return v?c.canTrickleIceCandidates=v.substr(14).split(" ").indexOf("trickle")>=0:c.canTrickleIceCandidates=!1,f.forEach(function(m,b){var y=St.splitLines(m),_=St.getKind(m),E=St.isRejected(m)&&St.matchPrefix(m,"a=bundle-only").length===0,M=y[0].substr(2).split(" ")[2],I=St.getDirection(m,p),R=St.parseMsid(m),C=St.getMid(m)||St.generateIdentifier();if(E||_==="application"&&(M==="DTLS/SCTP"||M==="UDP/DTLS/SCTP")){c.transceivers[b]={mid:C,kind:_,protocol:M,rejected:!0};return}!E&&c.transceivers[b]&&c.transceivers[b].rejected&&(c.transceivers[b]=c._createTransceiver(_,!0));var T,O,J,V,H,Y,N,L,G,ee=St.parseRtpParameters(m),$,j;E||($=St.getIceParameters(m,p),j=St.getDtlsParameters(m,p),j.role="client"),N=St.parseRtpEncodingParameters(m);var ie=St.parseRtcpParameters(m),Ae=St.matchPrefix(m,"a=end-of-candidates",p).length>0,ge=St.matchPrefix(m,"a=candidate:").map(function(lt){return St.parseCandidate(lt)}).filter(function(lt){return lt.component===1});if((l.type==="offer"||l.type==="answer")&&!E&&A&&b>0&&c.transceivers[b]&&(c._disposeIceAndDtlsTransports(b),c.transceivers[b].iceGatherer=c.transceivers[0].iceGatherer,c.transceivers[b].iceTransport=c.transceivers[0].iceTransport,c.transceivers[b].dtlsTransport=c.transceivers[0].dtlsTransport,c.transceivers[b].rtpSender&&c.transceivers[b].rtpSender.setTransport(c.transceivers[0].dtlsTransport),c.transceivers[b].rtpReceiver&&c.transceivers[b].rtpReceiver.setTransport(c.transceivers[0].dtlsTransport)),l.type==="offer"&&!E){T=c.transceivers[b]||c._createTransceiver(_),T.mid=C,T.iceGatherer||(T.iceGatherer=c._createIceGatherer(b,A)),ge.length&&T.iceTransport.state==="new"&&(Ae&&(!A||b===0)?T.iceTransport.setRemoteCandidates(ge):ge.forEach(function(lt){ow(T.iceTransport,lt)})),L=n.RTCRtpReceiver.getCapabilities(_),e<15019&&(L.codecs=L.codecs.filter(function(lt){return lt.name!=="rtx"})),Y=T.sendEncodingParameters||[{ssrc:(2*b+2)*1001}];var Ce=!1;if(I==="sendrecv"||I==="sendonly"){if(Ce=!T.rtpReceiver,H=T.rtpReceiver||new n.RTCRtpReceiver(T.dtlsTransport,_),Ce){var Ee;G=H.track,R&&R.stream==="-"||(R?(u[R.stream]||(u[R.stream]=new n.MediaStream,Object.defineProperty(u[R.stream],"id",{get:function(){return R.stream}})),Object.defineProperty(G,"id",{get:function(){return R.track}}),Ee=u[R.stream]):(u.default||(u.default=new n.MediaStream),Ee=u.default)),Ee&&(t(G,Ee),T.associatedRemoteMediaStreams.push(Ee)),d.push([G,H,Ee])}}else T.rtpReceiver&&T.rtpReceiver.track&&(T.associatedRemoteMediaStreams.forEach(function(lt){var xt=lt.getTracks().find(function(et){return et.id===T.rtpReceiver.track.id});xt&&i(xt,lt)}),T.associatedRemoteMediaStreams=[]);T.localCapabilities=L,T.remoteCapabilities=ee,T.rtpReceiver=H,T.rtcpParameters=ie,T.sendEncodingParameters=Y,T.recvEncodingParameters=N,c._transceive(c.transceivers[b],!1,Ce)}else if(l.type==="answer"&&!E){T=c.transceivers[b],O=T.iceGatherer,J=T.iceTransport,V=T.dtlsTransport,H=T.rtpReceiver,Y=T.sendEncodingParameters,L=T.localCapabilities,c.transceivers[b].recvEncodingParameters=N,c.transceivers[b].remoteCapabilities=ee,c.transceivers[b].rtcpParameters=ie,ge.length&&J.state==="new"&&((g||Ae)&&(!A||b===0)?J.setRemoteCandidates(ge):ge.forEach(function(lt){ow(T.iceTransport,lt)})),(!A||b===0)&&(J.state==="new"&&J.start(O,$,"controlling"),V.state==="new"&&V.start(j));var Ne=Bv(T.localCapabilities,T.remoteCapabilities),Ve=Ne.codecs.filter(function(lt){return lt.name.toLowerCase()==="rtx"}).length;!Ve&&T.sendEncodingParameters[0].rtx&&delete T.sendEncodingParameters[0].rtx,c._transceive(T,I==="sendrecv"||I==="recvonly",I==="sendrecv"||I==="sendonly"),H&&(I==="sendrecv"||I==="sendonly")?(G=H.track,R?(u[R.stream]||(u[R.stream]=new n.MediaStream),t(G,u[R.stream]),d.push([G,H,u[R.stream]])):(u.default||(u.default=new n.MediaStream),t(G,u.default),d.push([G,H,u.default]))):delete T.rtpReceiver}}),c._dtlsRole===void 0&&(c._dtlsRole=l.type==="offer"?"active":"passive"),c._remoteDescription={type:l.type,sdp:l.sdp},l.type==="offer"?c._updateSignalingState("have-remote-offer"):c._updateSignalingState("stable"),Object.keys(u).forEach(function(m){var b=u[m];if(b.getTracks().length){if(c.remoteStreams.indexOf(b)===-1){c.remoteStreams.push(b);var y=new Event("addstream");y.stream=b,n.setTimeout(function(){c._dispatchEvent("addstream",y)})}d.forEach(function(_){var E=_[0],M=_[1];b.id===_[2].id&&s(c,E,M,[b])})}}),d.forEach(function(m){m[2]||s(c,m[0],m[1],[])}),n.setTimeout(function(){c&&c.transceivers&&c.transceivers.forEach(function(m){m.iceTransport&&m.iceTransport.state==="new"&&m.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),m.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},r.prototype.close=function(){this.transceivers.forEach(function(l){l.iceTransport&&l.iceTransport.stop(),l.dtlsTransport&&l.dtlsTransport.stop(),l.rtpSender&&l.rtpSender.stop(),l.rtpReceiver&&l.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},r.prototype._updateSignalingState=function(l){this.signalingState=l;var c=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",c)},r.prototype._maybeFireNegotiationNeeded=function(){var l=this;this.signalingState!=="stable"||this.needNegotiation===!0||(this.needNegotiation=!0,n.setTimeout(function(){if(l.needNegotiation){l.needNegotiation=!1;var c=new Event("negotiationneeded");l._dispatchEvent("negotiationneeded",c)}},0))},r.prototype._updateIceConnectionState=function(){var l,c={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(d){d.iceTransport&&!d.rejected&&c[d.iceTransport.state]++}),l="new",c.failed>0?l="failed":c.checking>0?l="checking":c.disconnected>0?l="disconnected":c.new>0?l="new":c.connected>0?l="connected":c.completed>0&&(l="completed"),l!==this.iceConnectionState){this.iceConnectionState=l;var u=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",u)}},r.prototype._updateConnectionState=function(){var l,c={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(d){d.iceTransport&&d.dtlsTransport&&!d.rejected&&(c[d.iceTransport.state]++,c[d.dtlsTransport.state]++)}),c.connected+=c.completed,l="new",c.failed>0?l="failed":c.connecting>0?l="connecting":c.disconnected>0?l="disconnected":c.new>0?l="new":c.connected>0&&(l="connected"),l!==this.connectionState){this.connectionState=l;var u=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",u)}},r.prototype.createOffer=function(){var l=this;if(l._isClosed)return Promise.reject(vs("InvalidStateError","Can not call createOffer after close"));var c=l.transceivers.filter(function(g){return g.kind==="audio"}).length,u=l.transceivers.filter(function(g){return g.kind==="video"}).length,d=arguments[0];if(d){if(d.mandatory||d.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");d.offerToReceiveAudio!==void 0&&(d.offerToReceiveAudio===!0?c=1:d.offerToReceiveAudio===!1?c=0:c=d.offerToReceiveAudio),d.offerToReceiveVideo!==void 0&&(d.offerToReceiveVideo===!0?u=1:d.offerToReceiveVideo===!1?u=0:u=d.offerToReceiveVideo)}for(l.transceivers.forEach(function(g){g.kind==="audio"?(c--,c<0&&(g.wantReceive=!1)):g.kind==="video"&&(u--,u<0&&(g.wantReceive=!1))});c>0||u>0;)c>0&&(l._createTransceiver("audio"),c--),u>0&&(l._createTransceiver("video"),u--);var f=St.writeSessionBoilerplate(l._sdpSessionId,l._sdpSessionVersion++);l.transceivers.forEach(function(g,A){var v=g.track,m=g.kind,b=g.mid||St.generateIdentifier();g.mid=b,g.iceGatherer||(g.iceGatherer=l._createIceGatherer(A,l.usingBundle));var y=n.RTCRtpSender.getCapabilities(m);e<15019&&(y.codecs=y.codecs.filter(function(E){return E.name!=="rtx"})),y.codecs.forEach(function(E){E.name==="H264"&&E.parameters["level-asymmetry-allowed"]===void 0&&(E.parameters["level-asymmetry-allowed"]="1"),g.remoteCapabilities&&g.remoteCapabilities.codecs&&g.remoteCapabilities.codecs.forEach(function(M){E.name.toLowerCase()===M.name.toLowerCase()&&E.clockRate===M.clockRate&&(E.preferredPayloadType=M.payloadType)})}),y.headerExtensions.forEach(function(E){var M=g.remoteCapabilities&&g.remoteCapabilities.headerExtensions||[];M.forEach(function(I){E.uri===I.uri&&(E.id=I.id)})});var _=g.sendEncodingParameters||[{ssrc:(2*A+1)*1001}];v&&e>=15019&&m==="video"&&!_[0].rtx&&(_[0].rtx={ssrc:_[0].ssrc+1}),g.wantReceive&&(g.rtpReceiver=new n.RTCRtpReceiver(g.dtlsTransport,m)),g.localCapabilities=y,g.sendEncodingParameters=_}),l._config.bundlePolicy!=="max-compat"&&(f+="a=group:BUNDLE "+l.transceivers.map(function(g){return g.mid}).join(" ")+`\r
`),f+=`a=ice-options:trickle\r
`,l.transceivers.forEach(function(g,A){f+=rP(g,g.localCapabilities,"offer",g.stream,l._dtlsRole),f+=`a=rtcp-rsize\r
`,g.iceGatherer&&l.iceGatheringState!=="new"&&(A===0||!l.usingBundle)&&(g.iceGatherer.getLocalCandidates().forEach(function(v){v.component=1,f+="a="+St.writeCandidate(v)+`\r
`}),g.iceGatherer.state==="completed"&&(f+=`a=end-of-candidates\r
`))});var p=new n.RTCSessionDescription({type:"offer",sdp:f});return Promise.resolve(p)},r.prototype.createAnswer=function(){var l=this;if(l._isClosed)return Promise.reject(vs("InvalidStateError","Can not call createAnswer after close"));if(!(l.signalingState==="have-remote-offer"||l.signalingState==="have-local-pranswer"))return Promise.reject(vs("InvalidStateError","Can not call createAnswer in signalingState "+l.signalingState));var c=St.writeSessionBoilerplate(l._sdpSessionId,l._sdpSessionVersion++);l.usingBundle&&(c+="a=group:BUNDLE "+l.transceivers.map(function(f){return f.mid}).join(" ")+`\r
`),c+=`a=ice-options:trickle\r
`;var u=St.getMediaSections(l._remoteDescription.sdp).length;l.transceivers.forEach(function(f,p){if(!(p+1>u)){if(f.rejected){f.kind==="application"?f.protocol==="DTLS/SCTP"?c+=`m=application 0 DTLS/SCTP 5000\r
`:c+="m=application 0 "+f.protocol+` webrtc-datachannel\r
`:f.kind==="audio"?c+=`m=audio 0 UDP/TLS/RTP/SAVPF 0\r
a=rtpmap:0 PCMU/8000\r
`:f.kind==="video"&&(c+=`m=video 0 UDP/TLS/RTP/SAVPF 120\r
a=rtpmap:120 VP8/90000\r
`),c+=`c=IN IP4 0.0.0.0\r
a=inactive\r
a=mid:`+f.mid+`\r
`;return}if(f.stream){var g;f.kind==="audio"?g=f.stream.getAudioTracks()[0]:f.kind==="video"&&(g=f.stream.getVideoTracks()[0]),g&&e>=15019&&f.kind==="video"&&!f.sendEncodingParameters[0].rtx&&(f.sendEncodingParameters[0].rtx={ssrc:f.sendEncodingParameters[0].ssrc+1})}var A=Bv(f.localCapabilities,f.remoteCapabilities),v=A.codecs.filter(function(m){return m.name.toLowerCase()==="rtx"}).length;!v&&f.sendEncodingParameters[0].rtx&&delete f.sendEncodingParameters[0].rtx,c+=rP(f,A,"answer",f.stream,l._dtlsRole),f.rtcpParameters&&f.rtcpParameters.reducedSize&&(c+=`a=rtcp-rsize\r
`)}});var d=new n.RTCSessionDescription({type:"answer",sdp:c});return Promise.resolve(d)},r.prototype.addIceCandidate=function(l){var c=this,u;return l&&!(l.sdpMLineIndex!==void 0||l.sdpMid)?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(d,f){if(c._remoteDescription)if(!l||l.candidate==="")for(var p=0;p<c.transceivers.length&&!(!c.transceivers[p].rejected&&(c.transceivers[p].iceTransport.addRemoteCandidate({}),u=St.getMediaSections(c._remoteDescription.sdp),u[p]+=`a=end-of-candidates\r
`,c._remoteDescription.sdp=St.getDescription(c._remoteDescription.sdp)+u.join(""),c.usingBundle));p++);else{var g=l.sdpMLineIndex;if(l.sdpMid){for(var A=0;A<c.transceivers.length;A++)if(c.transceivers[A].mid===l.sdpMid){g=A;break}}var v=c.transceivers[g];if(v){if(v.rejected)return d();var m=Object.keys(l.candidate).length>0?St.parseCandidate(l.candidate):{};if(m.protocol==="tcp"&&(m.port===0||m.port===9)||m.component&&m.component!==1)return d();if((g===0||g>0&&v.iceTransport!==c.transceivers[0].iceTransport)&&!ow(v.iceTransport,m))return f(vs("OperationError","Can not add ICE candidate"));var b=l.candidate.trim();b.indexOf("a=")===0&&(b=b.substr(2)),u=St.getMediaSections(c._remoteDescription.sdp),u[g]+="a="+(m.type?b:"end-of-candidates")+`\r
`,c._remoteDescription.sdp=St.getDescription(c._remoteDescription.sdp)+u.join("")}else return f(vs("OperationError","Can not add ICE candidate"))}else return f(vs("InvalidStateError","Can not add ICE candidate without a remote description"));d()})},r.prototype.getStats=function(l){if(l&&l instanceof n.MediaStreamTrack){var c=null;if(this.transceivers.forEach(function(d){d.rtpSender&&d.rtpSender.track===l?c=d.rtpSender:d.rtpReceiver&&d.rtpReceiver.track===l&&(c=d.rtpReceiver)}),!c)throw vs("InvalidAccessError","Invalid selector.");return c.getStats()}var u=[];return this.transceivers.forEach(function(d){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(f){d[f]&&u.push(d[f].getStats())})}),Promise.all(u).then(function(d){var f=new Map;return d.forEach(function(p){p.forEach(function(g){f.set(g.id,g)})}),f})};var o=["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"];o.forEach(function(l){var c=n[l];if(c&&c.prototype&&c.prototype.getStats){var u=c.prototype.getStats;c.prototype.getStats=function(){return u.apply(this).then(function(d){var f=new Map;return Object.keys(d).forEach(function(p){d[p].type=rW(d[p]),f.set(p,d[p])}),f})}}});var a=["createOffer","createAnswer"];return a.forEach(function(l){var c=r.prototype[l];r.prototype[l]=function(){var u=arguments;return typeof u[0]=="function"||typeof u[1]=="function"?c.apply(this,[arguments[2]]).then(function(d){typeof u[0]=="function"&&u[0].apply(null,[d])},function(d){typeof u[1]=="function"&&u[1].apply(null,[d])}):c.apply(this,arguments)}}),a=["setLocalDescription","setRemoteDescription","addIceCandidate"],a.forEach(function(l){var c=r.prototype[l];r.prototype[l]=function(){var u=arguments;return typeof u[1]=="function"||typeof u[2]=="function"?c.apply(this,arguments).then(function(){typeof u[1]=="function"&&u[1].apply(null)},function(d){typeof u[2]=="function"&&u[2].apply(null,[d])}):c.apply(this,arguments)}}),["getStats"].forEach(function(l){var c=r.prototype[l];r.prototype[l]=function(){var u=arguments;return typeof u[1]=="function"?c.apply(this,arguments).then(function(){typeof u[1]=="function"&&u[1].apply(null)}):c.apply(this,arguments)}}),r};const lW=i_(aW);function jL(n){const e=n&&n.navigator,t=function(s){return{name:{PermissionDeniedError:"NotAllowedError"}[s.name]||s.name,message:s.message,constraint:s.constraint,toString(){return this.name}}},i=e.mediaDevices.getUserMedia.bind(e.mediaDevices);e.mediaDevices.getUserMedia=function(s){return i(s).catch(r=>Promise.reject(t(r)))}}function qL(n){"getDisplayMedia"in n.navigator&&n.navigator.mediaDevices&&(n.navigator.mediaDevices&&"getDisplayMedia"in n.navigator.mediaDevices||(n.navigator.mediaDevices.getDisplayMedia=n.navigator.getDisplayMedia.bind(n.navigator)))}function yC(n,e){if(n.RTCIceGatherer&&(n.RTCIceCandidate||(n.RTCIceCandidate=function(s){return s}),n.RTCSessionDescription||(n.RTCSessionDescription=function(s){return s}),e.version<15025)){const i=Object.getOwnPropertyDescriptor(n.MediaStreamTrack.prototype,"enabled");Object.defineProperty(n.MediaStreamTrack.prototype,"enabled",{set(s){i.set.call(this,s);const r=new Event("enabled");r.enabled=s,this.dispatchEvent(r)}})}n.RTCRtpSender&&!("dtmf"in n.RTCRtpSender.prototype)&&Object.defineProperty(n.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=new n.RTCDtmfSender(this):this.track.kind==="video"&&(this._dtmf=null)),this._dtmf}}),n.RTCDtmfSender&&!n.RTCDTMFSender&&(n.RTCDTMFSender=n.RTCDtmfSender);const t=lW(n,e.version);n.RTCPeerConnection=function(s){return s&&s.iceServers&&(s.iceServers=sW(s.iceServers,e.version),HM("ICE servers after filtering:",s.iceServers)),new t(s)},n.RTCPeerConnection.prototype=t.prototype}function XL(n){n.RTCRtpSender&&!("replaceTrack"in n.RTCRtpSender.prototype)&&(n.RTCRtpSender.prototype.replaceTrack=n.RTCRtpSender.prototype.setTrack)}const aP=Object.freeze(Object.defineProperty({__proto__:null,shimGetDisplayMedia:qL,shimGetUserMedia:jL,shimPeerConnection:yC,shimReplaceTrack:XL},Symbol.toStringTag,{value:"Module"}));function YL(n,e){const t=n&&n.navigator,i=n&&n.MediaStreamTrack;if(t.getUserMedia=function(s,r,o){n_("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),t.mediaDevices.getUserMedia(s).then(r,o)},!(e.version>55&&"autoGainControl"in t.mediaDevices.getSupportedConstraints())){const s=function(o,a,l){a in o&&!(l in o)&&(o[l]=o[a],delete o[a])},r=t.mediaDevices.getUserMedia.bind(t.mediaDevices);if(t.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),s(o.audio,"autoGainControl","mozAutoGainControl"),s(o.audio,"noiseSuppression","mozNoiseSuppression")),r(o)},i&&i.prototype.getSettings){const o=i.prototype.getSettings;i.prototype.getSettings=function(){const a=o.apply(this,arguments);return s(a,"mozAutoGainControl","autoGainControl"),s(a,"mozNoiseSuppression","noiseSuppression"),a}}if(i&&i.prototype.applyConstraints){const o=i.prototype.applyConstraints;i.prototype.applyConstraints=function(a){return this.kind==="audio"&&typeof a=="object"&&(a=JSON.parse(JSON.stringify(a)),s(a,"autoGainControl","mozAutoGainControl"),s(a,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[a])}}}}function cW(n,e){n.navigator.mediaDevices&&"getDisplayMedia"in n.navigator.mediaDevices||n.navigator.mediaDevices&&(n.navigator.mediaDevices.getDisplayMedia=function(i){if(!(i&&i.video)){const s=new DOMException("getDisplayMedia without video constraints is undefined");return s.name="NotFoundError",s.code=8,Promise.reject(s)}return i.video===!0?i.video={mediaSource:e}:i.video.mediaSource=e,n.navigator.mediaDevices.getUserMedia(i)})}function JL(n){typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function bC(n,e){if(typeof n!="object"||!(n.RTCPeerConnection||n.mozRTCPeerConnection))return;!n.RTCPeerConnection&&n.mozRTCPeerConnection&&(n.RTCPeerConnection=n.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(s){const r=n.RTCPeerConnection.prototype[s],o={[s](){return arguments[0]=new(s==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};n.RTCPeerConnection.prototype[s]=o[s]});const t={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){const[r,o,a]=arguments;return i.apply(this,[r||null]).then(l=>{if(e.version<53&&!o)try{l.forEach(c=>{c.type=t[c.type]||c.type})}catch(c){if(c.name!=="TypeError")throw c;l.forEach((u,d)=>{l.set(d,Object.assign({},u,{type:t[u.type]||u.type}))})}return l}).then(o,a)}}function KL(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender)||n.RTCRtpSender&&"getStats"in n.RTCRtpSender.prototype)return;const e=n.RTCPeerConnection.prototype.getSenders;e&&(n.RTCPeerConnection.prototype.getSenders=function(){const s=e.apply(this,[]);return s.forEach(r=>r._pc=this),s});const t=n.RTCPeerConnection.prototype.addTrack;t&&(n.RTCPeerConnection.prototype.addTrack=function(){const s=t.apply(this,arguments);return s._pc=this,s}),n.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function ZL(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender)||n.RTCRtpSender&&"getStats"in n.RTCRtpReceiver.prototype)return;const e=n.RTCPeerConnection.prototype.getReceivers;e&&(n.RTCPeerConnection.prototype.getReceivers=function(){const i=e.apply(this,[]);return i.forEach(s=>s._pc=this),i}),ep(n,"track",t=>(t.receiver._pc=t.srcElement,t)),n.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function $L(n){!n.RTCPeerConnection||"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(t){n_("removeStream","removeTrack"),this.getSenders().forEach(i=>{i.track&&t.getTracks().includes(i.track)&&this.removeTrack(i)})})}function e2(n){n.DataChannel&&!n.RTCDataChannel&&(n.RTCDataChannel=n.DataChannel)}function t2(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const e=n.RTCPeerConnection.prototype.addTransceiver;e&&(n.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];const i=arguments[1],s=i&&"sendEncodings"in i;s&&i.sendEncodings.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const r=e.apply(this,arguments);if(s){const{sender:o}=r,a=o.getParameters();(!("encodings"in a)||a.encodings.length===1&&Object.keys(a.encodings[0]).length===0)&&(a.encodings=i.sendEncodings,o.sendEncodings=i.sendEncodings,this.setParametersPromises.push(o.setParameters(a).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return r})}function i2(n){if(!(typeof n=="object"&&n.RTCRtpSender))return;const e=n.RTCRtpSender.prototype.getParameters;e&&(n.RTCRtpSender.prototype.getParameters=function(){const i=e.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function n2(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const e=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function s2(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const e=n.RTCPeerConnection.prototype.createAnswer;n.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}const lP=Object.freeze(Object.defineProperty({__proto__:null,shimAddTransceiver:t2,shimCreateAnswer:s2,shimCreateOffer:n2,shimGetDisplayMedia:cW,shimGetParameters:i2,shimGetUserMedia:YL,shimOnTrack:JL,shimPeerConnection:bC,shimRTCDataChannel:e2,shimReceiverGetStats:ZL,shimRemoveStream:$L,shimSenderGetStats:KL},Symbol.toStringTag,{value:"Module"}));function r2(n){if(!(typeof n!="object"||!n.RTCPeerConnection)){if("getLocalStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in n.RTCPeerConnection.prototype)){const e=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addStream=function(i){this._localStreams||(this._localStreams=[]),this._localStreams.includes(i)||this._localStreams.push(i),i.getAudioTracks().forEach(s=>e.call(this,s,i)),i.getVideoTracks().forEach(s=>e.call(this,s,i))},n.RTCPeerConnection.prototype.addTrack=function(i,...s){return s&&s.forEach(r=>{this._localStreams?this._localStreams.includes(r)||this._localStreams.push(r):this._localStreams=[r]}),e.apply(this,arguments)}}"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const i=this._localStreams.indexOf(t);if(i===-1)return;this._localStreams.splice(i,1);const s=t.getTracks();this.getSenders().forEach(r=>{s.includes(r.track)&&this.removeTrack(r)})})}}function o2(n){if(!(typeof n!="object"||!n.RTCPeerConnection)&&("getRemoteStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in n.RTCPeerConnection.prototype))){Object.defineProperty(n.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(t){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=t),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(s=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(s))return;this._remoteStreams.push(s);const r=new Event("addstream");r.stream=s,this.dispatchEvent(r)})})}});const e=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){const i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(s){s.streams.forEach(r=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(r)>=0)return;i._remoteStreams.push(r);const o=new Event("addstream");o.stream=r,i.dispatchEvent(o)})}),e.apply(i,arguments)}}}function a2(n){if(typeof n!="object"||!n.RTCPeerConnection)return;const e=n.RTCPeerConnection.prototype,t=e.createOffer,i=e.createAnswer,s=e.setLocalDescription,r=e.setRemoteDescription,o=e.addIceCandidate;e.createOffer=function(c,u){const d=arguments.length>=2?arguments[2]:arguments[0],f=t.apply(this,[d]);return u?(f.then(c,u),Promise.resolve()):f},e.createAnswer=function(c,u){const d=arguments.length>=2?arguments[2]:arguments[0],f=i.apply(this,[d]);return u?(f.then(c,u),Promise.resolve()):f};let a=function(l,c,u){const d=s.apply(this,[l]);return u?(d.then(c,u),Promise.resolve()):d};e.setLocalDescription=a,a=function(l,c,u){const d=r.apply(this,[l]);return u?(d.then(c,u),Promise.resolve()):d},e.setRemoteDescription=a,a=function(l,c,u){const d=o.apply(this,[l]);return u?(d.then(c,u),Promise.resolve()):d},e.addIceCandidate=a}function l2(n){const e=n&&n.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const t=e.mediaDevices,i=t.getUserMedia.bind(t);e.mediaDevices.getUserMedia=s=>i(c2(s))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=function(i,s,r){e.mediaDevices.getUserMedia(i).then(s,r)}.bind(e))}function c2(n){return n&&n.video!==void 0?Object.assign({},n,{video:OL(n.video)}):n}function h2(n){if(!n.RTCPeerConnection)return;const e=n.RTCPeerConnection;n.RTCPeerConnection=function(i,s){if(i&&i.iceServers){const r=[];for(let o=0;o<i.iceServers.length;o++){let a=i.iceServers[o];!a.hasOwnProperty("urls")&&a.hasOwnProperty("url")?(n_("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,delete a.url,r.push(a)):r.push(i.iceServers[o])}i.iceServers=r}return new e(i,s)},n.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(n.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function u2(n){typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function d2(n){const e=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(i){if(i){typeof i.offerToReceiveAudio<"u"&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);const s=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");i.offerToReceiveAudio===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):i.offerToReceiveAudio===!0&&!s&&this.addTransceiver("audio"),typeof i.offerToReceiveVideo<"u"&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);const r=this.getTransceivers().find(o=>o.receiver.track.kind==="video");i.offerToReceiveVideo===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):i.offerToReceiveVideo===!0&&!r&&this.addTransceiver("video")}return e.apply(this,arguments)}}function f2(n){typeof n!="object"||n.AudioContext||(n.AudioContext=n.webkitAudioContext)}const cP=Object.freeze(Object.defineProperty({__proto__:null,shimAudioContext:f2,shimCallbacksAPI:a2,shimConstraints:c2,shimCreateOfferLegacy:d2,shimGetUserMedia:l2,shimLocalStreamsAPI:r2,shimRTCIceServerUrls:h2,shimRemoteStreamsAPI:o2,shimTrackEventTransceiver:u2},Symbol.toStringTag,{value:"Module"}));function Ey(n){if(!n.RTCIceCandidate||n.RTCIceCandidate&&"foundation"in n.RTCIceCandidate.prototype)return;const e=n.RTCIceCandidate;n.RTCIceCandidate=function(i){if(typeof i=="object"&&i.candidate&&i.candidate.indexOf("a=")===0&&(i=JSON.parse(JSON.stringify(i)),i.candidate=i.candidate.substr(2)),i.candidate&&i.candidate.length){const s=new e(i),r=Cy.parseCandidate(i.candidate),o=Object.assign(s,r);return o.toJSON=function(){return{candidate:o.candidate,sdpMid:o.sdpMid,sdpMLineIndex:o.sdpMLineIndex,usernameFragment:o.usernameFragment}},o}return new e(i)},n.RTCIceCandidate.prototype=e.prototype,ep(n,"icecandidate",t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new n.RTCIceCandidate(t.candidate),writable:"false"}),t))}function ug(n,e){if(!n.RTCPeerConnection)return;"sctp"in n.RTCPeerConnection.prototype||Object.defineProperty(n.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const t=function(a){if(!a||!a.sdp)return!1;const l=Cy.splitSections(a.sdp);return l.shift(),l.some(c=>{const u=Cy.parseMLine(c);return u&&u.kind==="application"&&u.protocol.indexOf("SCTP")!==-1})},i=function(a){const l=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(l===null||l.length<2)return-1;const c=parseInt(l[1],10);return c!==c?-1:c},s=function(a){let l=65536;return e.browser==="firefox"&&(e.version<57?a===-1?l=16384:l=2147483637:e.version<60?l=e.version===57?65535:65536:l=2147483637),l},r=function(a,l){let c=65536;e.browser==="firefox"&&e.version===57&&(c=65535);const u=Cy.matchPrefix(a.sdp,"a=max-message-size:");return u.length>0?c=parseInt(u[0].substr(19),10):e.browser==="firefox"&&l!==-1&&(c=2147483637),c},o=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:l}=this.getConfiguration();l==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(t(arguments[0])){const l=i(arguments[0]),c=s(l),u=r(arguments[0],l);let d;c===0&&u===0?d=Number.POSITIVE_INFINITY:c===0||u===0?d=Math.max(c,u):d=Math.min(c,u);const f={};Object.defineProperty(f,"maxMessageSize",{get(){return d}}),this._sctp=f}return o.apply(this,arguments)}}function dg(n){if(!(n.RTCPeerConnection&&"createDataChannel"in n.RTCPeerConnection.prototype))return;function e(i,s){const r=i.send;i.send=function(){const a=arguments[0],l=a.length||a.size||a.byteLength;if(i.readyState==="open"&&s.sctp&&l>s.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+s.sctp.maxMessageSize+" bytes)");return r.apply(i,arguments)}}const t=n.RTCPeerConnection.prototype.createDataChannel;n.RTCPeerConnection.prototype.createDataChannel=function(){const s=t.apply(this,arguments);return e(s,this),s},ep(n,"datachannel",i=>(e(i.channel,i.target),i))}function _C(n){if(!n.RTCPeerConnection||"connectionState"in n.RTCPeerConnection.prototype)return;const e=n.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(t){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),t&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=t)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(t=>{const i=e[t];e[t]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=s=>{const r=s.target;if(r._lastConnectionState!==r.connectionState){r._lastConnectionState=r.connectionState;const o=new Event("connectionstatechange",s);r.dispatchEvent(o)}return s},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function xC(n,e){if(!n.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e.version>=605)return;const t=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(s){if(s&&s.sdp&&s.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const r=s.sdp.split(`
`).filter(o=>o.trim()!=="a=extmap-allow-mixed").join(`
`);n.RTCSessionDescription&&s instanceof n.RTCSessionDescription?arguments[0]=new n.RTCSessionDescription({type:s.type,sdp:r}):s.sdp=r}return t.apply(this,arguments)}}function My(n,e){if(!(n.RTCPeerConnection&&n.RTCPeerConnection.prototype))return;const t=n.RTCPeerConnection.prototype.addIceCandidate;!t||t.length===0||(n.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():t.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}const hW=Object.freeze(Object.defineProperty({__proto__:null,removeExtmapAllowMixed:xC,shimAddIceCandidateNullOrEmpty:My,shimConnectionState:_C,shimMaxMessageSize:ug,shimRTCIceCandidate:Ey,shimSendThrowTypeError:dg},Symbol.toStringTag,{value:"Module"}));function uW({window:n}={},e={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0}){const t=HM,i=iW(n),s={browserDetails:i,commonShim:hW,extractVersion:hg,disableLog:eW,disableWarnings:tW};switch(i.browser){case"chrome":if(!sP||!vC||!e.shimChrome)return t("Chrome shim is not included in this adapter release."),s;if(i.version===null)return t("Chrome shim can not determine version, not shimming."),s;t("adapter.js shimming chrome."),s.browserShim=sP,My(n,i),kL(n,i),LL(n),vC(n,i),FL(n),VL(n,i),UL(n),NL(n),zL(n),HL(n,i),Ey(n),_C(n),ug(n,i),dg(n),xC(n,i);break;case"firefox":if(!lP||!bC||!e.shimFirefox)return t("Firefox shim is not included in this adapter release."),s;t("adapter.js shimming firefox."),s.browserShim=lP,My(n,i),YL(n,i),bC(n,i),JL(n),$L(n),KL(n),ZL(n),e2(n),t2(n),i2(n),n2(n),s2(n),Ey(n),_C(n),ug(n,i),dg(n);break;case"edge":if(!aP||!yC||!e.shimEdge)return t("MS edge shim is not included in this adapter release."),s;t("adapter.js shimming edge."),s.browserShim=aP,jL(n),qL(n),yC(n,i),XL(n),ug(n,i),dg(n);break;case"safari":if(!cP||!e.shimSafari)return t("Safari shim is not included in this adapter release."),s;t("adapter.js shimming safari."),s.browserShim=cP,My(n,i),h2(n),d2(n),a2(n),r2(n),o2(n),u2(n),l2(n),f2(n),Ey(n),ug(n,i),dg(n),xC(n,i);break;default:t("Unsupported browser!");break}return s}const hP=uW({window:typeof window>"u"?void 0:window});function Wa(n,e,t,i){Object.defineProperty(n,e,{get:t,set:i,enumerable:!0,configurable:!0})}var aw=hP.default||hP,Np=new(function(){function n(){this.isIOS=["iPad","iPhone","iPod"].includes(navigator.platform),this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}return n.prototype.isWebRTCSupported=function(){return typeof RTCPeerConnection<"u"},n.prototype.isBrowserSupported=function(){var e=this.getBrowser(),t=this.getVersion(),i=this.supportedBrowsers.includes(e);return i?e==="chrome"?t>=this.minChromeVersion:e==="firefox"?t>=this.minFirefoxVersion:e==="safari"?!this.isIOS&&t>=this.minSafariVersion:!1:!1},n.prototype.getBrowser=function(){return aw.browserDetails.browser},n.prototype.getVersion=function(){return aw.browserDetails.version||0},n.prototype.isUnifiedPlanSupported=function(){var e=this.getBrowser(),t=aw.browserDetails.version||0;if(e==="chrome"&&t<this.minChromeVersion)return!1;if(e==="firefox"&&t>=this.minFirefoxVersion)return!0;if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;var i,s=!1;try{i=new RTCPeerConnection,i.addTransceiver("audio"),s=!0}catch{}finally{i&&i.close()}return s},n.prototype.toString=function(){return`Supports:
    browser:`.concat(this.getBrowser(),`
    version:`).concat(this.getVersion(),`
    isIOS:`).concat(this.isIOS,`
    isWebRTCSupported:`).concat(this.isWebRTCSupported(),`
    isBrowserSupported:`).concat(this.isBrowserSupported(),`
    isUnifiedPlanSupported:`).concat(this.isUnifiedPlanSupported())},n}()),uP={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["turn:eu-0.turn.peerjs.com:3478","turn:us-0.turn.peerjs.com:3478"],username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"},dW=function(){function n(){this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.chunkedMTU=16300,this.defaultConfig=uP,this.browser=Np.getBrowser(),this.browserVersion=Np.getVersion(),this.supports=function(){var e={browser:Np.isBrowserSupported(),webRTC:Np.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!e.webRTC)return e;var t;try{t=new RTCPeerConnection(uP),e.audioVideo=!0;var i=void 0;try{i=t.createDataChannel("_PEERJSTEST",{ordered:!0}),e.data=!0,e.reliable=!!i.ordered;try{i.binaryType="blob",e.binaryBlob=!Np.isIOS}catch{}}catch{}finally{i&&i.close()}}catch{}finally{t&&t.close()}return e}(),this.pack=eP.pack,this.unpack=eP.unpack,this._dataCount=1}return n.prototype.noop=function(){},n.prototype.validateId=function(e){return!e||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(e)},n.prototype.chunk=function(e){for(var t=[],i=e.size,s=Math.ceil(i/ci.chunkedMTU),r=0,o=0;o<i;){var a=Math.min(i,o+ci.chunkedMTU),l=e.slice(o,a),c={__peerData:this._dataCount,n:r,data:l,total:s};t.push(c),o=a,r++}return this._dataCount++,t},n.prototype.blobToArrayBuffer=function(e,t){var i=new FileReader;return i.onload=function(s){s.target&&t(s.target.result)},i.readAsArrayBuffer(e),i},n.prototype.binaryStringToArrayBuffer=function(e){for(var t=new Uint8Array(e.length),i=0;i<e.length;i++)t[i]=e.charCodeAt(i)&255;return t.buffer},n.prototype.randomToken=function(){return Math.random().toString(36).slice(2)},n.prototype.isSecure=function(){return location.protocol==="https:"},n}(),ci=new dW,p2={};Wa(p2,"Peer",()=>CC,n=>CC=n);var sA={},fW=Object.prototype.hasOwnProperty,qs="~";function Cm(){}Object.create&&(Cm.prototype=Object.create(null),new Cm().__proto__||(qs=!1));function pW(n,e,t){this.fn=n,this.context=e,this.once=t||!1}function g2(n,e,t,i,s){if(typeof t!="function")throw new TypeError("The listener must be a function");var r=new pW(t,i||n,s),o=qs?qs+e:e;return n._events[o]?n._events[o].fn?n._events[o]=[n._events[o],r]:n._events[o].push(r):(n._events[o]=r,n._eventsCount++),n}function Ty(n,e){--n._eventsCount===0?n._events=new Cm:delete n._events[e]}function Ms(){this._events=new Cm,this._eventsCount=0}Ms.prototype.eventNames=function(){var e=[],t,i;if(this._eventsCount===0)return e;for(i in t=this._events)fW.call(t,i)&&e.push(qs?i.slice(1):i);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(t)):e};Ms.prototype.listeners=function(e){var t=qs?qs+e:e,i=this._events[t];if(!i)return[];if(i.fn)return[i.fn];for(var s=0,r=i.length,o=new Array(r);s<r;s++)o[s]=i[s].fn;return o};Ms.prototype.listenerCount=function(e){var t=qs?qs+e:e,i=this._events[t];return i?i.fn?1:i.length:0};Ms.prototype.emit=function(e,t,i,s,r,o){var a=qs?qs+e:e;if(!this._events[a])return!1;var l=this._events[a],c=arguments.length,u,d;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),c){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,i),!0;case 4:return l.fn.call(l.context,t,i,s),!0;case 5:return l.fn.call(l.context,t,i,s,r),!0;case 6:return l.fn.call(l.context,t,i,s,r,o),!0}for(d=1,u=new Array(c-1);d<c;d++)u[d-1]=arguments[d];l.fn.apply(l.context,u)}else{var f=l.length,p;for(d=0;d<f;d++)switch(l[d].once&&this.removeListener(e,l[d].fn,void 0,!0),c){case 1:l[d].fn.call(l[d].context);break;case 2:l[d].fn.call(l[d].context,t);break;case 3:l[d].fn.call(l[d].context,t,i);break;case 4:l[d].fn.call(l[d].context,t,i,s);break;default:if(!u)for(p=1,u=new Array(c-1);p<c;p++)u[p-1]=arguments[p];l[d].fn.apply(l[d].context,u)}}return!0};Ms.prototype.on=function(e,t,i){return g2(this,e,t,i,!1)};Ms.prototype.once=function(e,t,i){return g2(this,e,t,i,!0)};Ms.prototype.removeListener=function(e,t,i,s){var r=qs?qs+e:e;if(!this._events[r])return this;if(!t)return Ty(this,r),this;var o=this._events[r];if(o.fn)o.fn===t&&(!s||o.once)&&(!i||o.context===i)&&Ty(this,r);else{for(var a=0,l=[],c=o.length;a<c;a++)(o[a].fn!==t||s&&!o[a].once||i&&o[a].context!==i)&&l.push(o[a]);l.length?this._events[r]=l.length===1?l[0]:l:Ty(this,r)}return this};Ms.prototype.removeAllListeners=function(e){var t;return e?(t=qs?qs+e:e,this._events[t]&&Ty(this,t)):(this._events=new Cm,this._eventsCount=0),this};Ms.prototype.off=Ms.prototype.removeListener;Ms.prototype.addListener=Ms.prototype.on;Ms.prefixed=qs;Ms.EventEmitter=Ms;sA=Ms;var rt={};Wa(rt,"LogLevel",()=>rr,n=>rr=n);Wa(rt,"default",()=>dP,n=>dP=n);var Ph=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var i=t.call(n),s,r=[],o;try{for(;(e===void 0||e-- >0)&&!(s=i.next()).done;)r.push(s.value)}catch(a){o={error:a}}finally{try{s&&!s.done&&(t=i.return)&&t.call(i)}finally{if(o)throw o.error}}return r},Bh=function(n,e,t){if(t||arguments.length===2)for(var i=0,s=e.length,r;i<s;i++)(r||!(i in e))&&(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return n.concat(r||Array.prototype.slice.call(e))},gW="PeerJS: ",rr;(function(n){n[n.Disabled=0]="Disabled",n[n.Errors=1]="Errors",n[n.Warnings=2]="Warnings",n[n.All=3]="All"})(rr||(rr={}));var mW=function(){function n(){this._logLevel=rr.Disabled}return Object.defineProperty(n.prototype,"logLevel",{get:function(){return this._logLevel},set:function(e){this._logLevel=e},enumerable:!1,configurable:!0}),n.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logLevel>=rr.All&&this._print.apply(this,Bh([rr.All],Ph(e),!1))},n.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logLevel>=rr.Warnings&&this._print.apply(this,Bh([rr.Warnings],Ph(e),!1))},n.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logLevel>=rr.Errors&&this._print.apply(this,Bh([rr.Errors],Ph(e),!1))},n.prototype.setLogFunction=function(e){this._print=e},n.prototype._print=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];var s=Bh([gW],Ph(t),!1);for(var r in s)s[r]instanceof Error&&(s[r]="("+s[r].name+") "+s[r].message);e>=rr.All?console.log.apply(console,Bh([],Ph(s),!1)):e>=rr.Warnings?console.warn.apply(console,Bh(["WARNING"],Ph(s),!1)):e>=rr.Errors&&console.error.apply(console,Bh(["ERROR"],Ph(s),!1))},n}(),dP=new mW,m2={};Wa(m2,"Socket",()=>fP,n=>fP=n);var Uo;(function(n){n.Data="data",n.Media="media"})(Uo||(Uo={}));var hn;(function(n){n.BrowserIncompatible="browser-incompatible",n.Disconnected="disconnected",n.InvalidID="invalid-id",n.InvalidKey="invalid-key",n.Network="network",n.PeerUnavailable="peer-unavailable",n.SslUnavailable="ssl-unavailable",n.ServerError="server-error",n.SocketError="socket-error",n.SocketClosed="socket-closed",n.UnavailableID="unavailable-id",n.WebRTC="webrtc"})(hn||(hn={}));var dl;(function(n){n.Binary="binary",n.BinaryUTF8="binary-utf8",n.JSON="json"})(dl||(dl={}));var El;(function(n){n.Message="message",n.Disconnected="disconnected",n.Error="error",n.Close="close"})(El||(El={}));var rs;(function(n){n.Heartbeat="HEARTBEAT",n.Candidate="CANDIDATE",n.Offer="OFFER",n.Answer="ANSWER",n.Open="OPEN",n.Error="ERROR",n.IdTaken="ID-TAKEN",n.InvalidKey="INVALID-KEY",n.Leave="LEAVE",n.Expire="EXPIRE"})(rs||(rs={}));var QM={};QM=JSON.parse('{"name":"peerjs","version":"1.4.7","keywords":["peerjs","webrtc","p2p","rtc"],"description":"PeerJS client","homepage":"https://peerjs.com","bugs":{"url":"https://github.com/peers/peerjs/issues"},"repository":{"type":"git","url":"https://github.com/peers/peerjs"},"license":"MIT","contributors":["Michelle Bu <michelle@michellebu.com>","afrokick <devbyru@gmail.com>","ericz <really.ez@gmail.com>","Jairo <kidandcat@gmail.com>","Jonas Gloning <34194370+jonasgloning@users.noreply.github.com>","Jairo Caro-Accino Viciana <jairo@galax.be>","Carlos Caballero <carlos.caballero.gonzalez@gmail.com>","hc <hheennrryy@gmail.com>","Muhammad Asif <capripio@gmail.com>","PrashoonB <prashoonbhattacharjee@gmail.com>","Harsh Bardhan Mishra <47351025+HarshCasper@users.noreply.github.com>","akotynski <aleksanderkotbury@gmail.com>","lmb <i@lmb.io>","Jairooo <jairocaro@msn.com>","Moritz Stckler <moritz.stueckler@gmail.com>","Simon <crydotsnakegithub@gmail.com>","Denis Lukov <denismassters@gmail.com>","Philipp Hancke <fippo@andyet.net>","Hans Oksendahl <hansoksendahl@gmail.com>","Jess <jessachandler@gmail.com>","khankuan <khankuan@gmail.com>","DUODVK <kurmanov.work@gmail.com>","XiZhao <kwang1imsa@gmail.com>","Matthias Lohr <matthias@lohr.me>","=frank tree <=frnktrb@googlemail.com>","Andre Eckardt <aeckardt@outlook.com>","Chris Cowan <agentme49@gmail.com>","Alex Chuev <alex@chuev.com>","alxnull <alxnull@e.mail.de>","Yemel Jardi <angel.jardi@gmail.com>","Ben Parnell <benjaminparnell.94@gmail.com>","Benny Lichtner <bennlich@gmail.com>","fresheneesz <bitetrudpublic@gmail.com>","bob.barstead@exaptive.com <bob.barstead@exaptive.com>","chandika <chandika@gmail.com>","emersion <contact@emersion.fr>","Christopher Van <cvan@users.noreply.github.com>","eddieherm <edhermoso@gmail.com>","Eduardo Pinho <enet4mikeenet@gmail.com>","Evandro Zanatta <ezanatta@tray.net.br>","Gardner Bickford <gardner@users.noreply.github.com>","Gian Luca <gianluca.cecchi@cynny.com>","PatrickJS <github@gdi2290.com>","jonnyf <github@jonathanfoss.co.uk>","Hizkia Felix <hizkifw@gmail.com>","Hristo Oskov <hristo.oskov@gmail.com>","Isaac Madwed <i.madwed@gmail.com>","Ilya Konanykhin <ilya.konanykhin@gmail.com>","jasonbarry <jasbarry@me.com>","Jonathan Burke <jonathan.burke.1311@googlemail.com>","Josh Hamit <josh.hamit@gmail.com>","Jordan Austin <jrax86@gmail.com>","Joel Wetzell <jwetzell@yahoo.com>","xizhao <kevin.wang@cloudera.com>","Alberto Torres <kungfoobar@gmail.com>","Jonathan Mayol <mayoljonathan@gmail.com>","Jefferson Felix <me@jsfelix.dev>","Rolf Erik Lekang <me@rolflekang.com>","Kevin Mai-Husan Chia <mhchia@users.noreply.github.com>","Pepijn de Vos <pepijndevos@gmail.com>","JooYoung <qkdlql@naver.com>","Tobias Speicher <rootcommander@gmail.com>","Steve Blaurock <sblaurock@gmail.com>","Kyrylo Shegeda <shegeda@ualberta.ca>","Diwank Singh Tomer <singh@diwank.name>","Soren Balko <Soeren.Balko@gmail.com>","Arpit Solanki <solankiarpit1997@gmail.com>","Yuki Ito <yuki@gnnk.net>","Artur Zayats <zag2art@gmail.com>"],"funding":{"type":"opencollective","url":"https://opencollective.com/peer"},"collective":{"type":"opencollective","url":"https://opencollective.com/peer"},"files":["dist/*"],"sideEffects":["lib/global.ts","lib/supports.ts"],"main":"dist/bundler.cjs","module":"dist/bundler.mjs","browser-minified":"dist/peerjs.min.js","browser-unminified":"dist/peerjs.js","types":"dist/types.d.ts","engines":{"node":">= 10"},"targets":{"types":{"source":"lib/exports.ts"},"main":{"source":"lib/exports.ts","sourceMap":{"inlineSources":true}},"module":{"source":"lib/exports.ts","includeNodeModules":["eventemitter3"],"sourceMap":{"inlineSources":true}},"browser-minified":{"context":"browser","outputFormat":"global","optimize":true,"engines":{"browsers":"cover 99%, not dead"},"source":"lib/global.ts"},"browser-unminified":{"context":"browser","outputFormat":"global","optimize":false,"engines":{"browsers":"cover 99%, not dead"},"source":"lib/global.ts"}},"scripts":{"contributors":"git-authors-cli --print=false && prettier --write package.json && git add package.json package-lock.json && git commit -m \\"chore(contributors): update and sort contributors list\\"","check":"tsc --noEmit","watch":"parcel watch","build":"rm -rf dist && parcel build","prepublishOnly":"npm run build","test":"mocha -r ts-node/register -r jsdom-global/register test/**/*.ts","format":"prettier --write .","semantic-release":"semantic-release"},"devDependencies":{"@parcel/config-default":"^2.5.0","@parcel/packager-ts":"^2.5.0","@parcel/transformer-typescript-tsc":"^2.5.0","@parcel/transformer-typescript-types":"^2.5.0","@semantic-release/changelog":"^6.0.1","@semantic-release/git":"^10.0.1","@types/chai":"^4.3.0","@types/mocha":"^9.1.0","@types/node":"^17.0.18","chai":"^4.3.6","git-authors-cli":"^1.0.40","jsdom":"^19.0.0","jsdom-global":"^3.0.2","mocha":"^9.2.0","mock-socket":"8.0.5","parcel":"^2.5.0","parcel-transformer-tsc-sourcemaps":"^1.0.2","prettier":"^2.6.2","semantic-release":"^19.0.2","standard":"^16.0.4","ts-node":"^10.5.0","typescript":"^4.5.5"},"dependencies":{"@swc/helpers":"^0.3.13","eventemitter3":"^4.0.7","peerjs-js-binarypack":"1.0.1","webrtc-adapter":"^7.7.1"}}');var AW=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,s){i.__proto__=s}||function(i,s){for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(i[r]=s[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),vW=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var i=t.call(n),s,r=[],o;try{for(;(e===void 0||e-- >0)&&!(s=i.next()).done;)r.push(s.value)}catch(a){o={error:a}}finally{try{s&&!s.done&&(t=i.return)&&t.call(i)}finally{if(o)throw o.error}}return r},yW=function(n,e,t){if(t||arguments.length===2)for(var i=0,s=e.length,r;i<s;i++)(r||!(i in e))&&(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return n.concat(r||Array.prototype.slice.call(e))},bW=function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],i=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},fP=function(n){AW(e,n);function e(t,i,s,r,o,a){a===void 0&&(a=5e3);var l=n.call(this)||this;l.pingInterval=a,l._disconnected=!0,l._messagesQueue=[];var c=t?"wss://":"ws://";return l._baseUrl=c+i+":"+s+r+"peerjs?key="+o,l}return e.prototype.start=function(t,i){var s=this;this._id=t;var r="".concat(this._baseUrl,"&id=").concat(t,"&token=").concat(i);this._socket||!this._disconnected||(this._socket=new WebSocket(r+"&version="+QM.version),this._disconnected=!1,this._socket.onmessage=function(o){var a;try{a=JSON.parse(o.data),rt.default.log("Server message received:",a)}catch{rt.default.log("Invalid server message",o.data);return}s.emit(El.Message,a)},this._socket.onclose=function(o){s._disconnected||(rt.default.log("Socket closed.",o),s._cleanup(),s._disconnected=!0,s.emit(El.Disconnected))},this._socket.onopen=function(){s._disconnected||(s._sendQueuedMessages(),rt.default.log("Socket open"),s._scheduleHeartbeat())})},e.prototype._scheduleHeartbeat=function(){var t=this;this._wsPingTimer=setTimeout(function(){t._sendHeartbeat()},this.pingInterval)},e.prototype._sendHeartbeat=function(){if(!this._wsOpen()){rt.default.log("Cannot send heartbeat, because socket closed");return}var t=JSON.stringify({type:rs.Heartbeat});this._socket.send(t),this._scheduleHeartbeat()},e.prototype._wsOpen=function(){return!!this._socket&&this._socket.readyState===1},e.prototype._sendQueuedMessages=function(){var t,i,s=yW([],vW(this._messagesQueue),!1);this._messagesQueue=[];try{for(var r=bW(s),o=r.next();!o.done;o=r.next()){var a=o.value;this.send(a)}}catch(l){t={error:l}}finally{try{o&&!o.done&&(i=r.return)&&i.call(r)}finally{if(t)throw t.error}}},e.prototype.send=function(t){if(!this._disconnected){if(!this._id){this._messagesQueue.push(t);return}if(!t.type){this.emit(El.Error,"Invalid message");return}if(this._wsOpen()){var i=JSON.stringify(t);this._socket.send(i)}}},e.prototype.close=function(){this._disconnected||(this._cleanup(),this._disconnected=!0)},e.prototype._cleanup=function(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)},e}(sA.EventEmitter),wC={};Wa(wC,"MediaConnection",()=>mP,n=>mP=n);var WM={};Wa(WM,"Negotiator",()=>pP,n=>pP=n);var u0=function(){return u0=Object.assign||function(n){for(var e,t=1,i=arguments.length;t<i;t++){e=arguments[t];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(n[s]=e[s])}return n},u0.apply(this,arguments)},Dv=function(n,e,t,i){function s(r){return r instanceof t?r:new t(function(o){o(r)})}return new(t||(t=Promise))(function(r,o){function a(u){try{c(i.next(u))}catch(d){o(d)}}function l(u){try{c(i.throw(u))}catch(d){o(d)}}function c(u){u.done?r(u.value):s(u.value).then(a,l)}c((i=i.apply(n,e||[])).next())})},Ov=function(n,e){var t={label:0,sent:function(){if(r[0]&1)throw r[1];return r[1]},trys:[],ops:[]},i,s,r,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(c){return function(u){return l([c,u])}}function l(c){if(i)throw new TypeError("Generator is already executing.");for(;t;)try{if(i=1,s&&(r=c[0]&2?s.return:c[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,c[1])).done)return r;switch(s=0,r&&(c=[c[0]&2,r.value]),c[0]){case 0:case 1:r=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,s=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(r=t.trys,!(r=r.length>0&&r[r.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!r||c[1]>r[0]&&c[1]<r[3])){t.label=c[1];break}if(c[0]===6&&t.label<r[1]){t.label=r[1],r=c;break}if(r&&t.label<r[2]){t.label=r[2],t.ops.push(c);break}r[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(n,t)}catch(u){c=[6,u],s=0}finally{i=r=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}},pP=function(){function n(e){this.connection=e}return n.prototype.startConnection=function(e){var t=this._startPeerConnection();if(this.connection.peerConnection=t,this.connection.type===Uo.Media&&e._stream&&this._addTracksToConnection(e._stream,t),e.originator){if(this.connection.type===Uo.Data){var i=this.connection,s={ordered:!!e.reliable},r=t.createDataChannel(i.label,s);i.initialize(r)}this._makeOffer()}else this.handleSDP("OFFER",e.sdp)},n.prototype._startPeerConnection=function(){rt.default.log("Creating RTCPeerConnection.");var e=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(e),e},n.prototype._setupListeners=function(e){var t=this,i=this.connection.peer,s=this.connection.connectionId,r=this.connection.type,o=this.connection.provider;rt.default.log("Listening for ICE candidates."),e.onicecandidate=function(a){!a.candidate||!a.candidate.candidate||(rt.default.log("Received ICE candidates for ".concat(i,":"),a.candidate),o.socket.send({type:rs.Candidate,payload:{candidate:a.candidate,type:r,connectionId:s},dst:i}))},e.oniceconnectionstatechange=function(){switch(e.iceConnectionState){case"failed":rt.default.log("iceConnectionState is failed, closing connections to "+i),t.connection.emit("error",new Error("Negotiation of connection to "+i+" failed.")),t.connection.close();break;case"closed":rt.default.log("iceConnectionState is closed, closing connections to "+i),t.connection.emit("error",new Error("Connection to "+i+" closed.")),t.connection.close();break;case"disconnected":rt.default.log("iceConnectionState changed to disconnected on the connection with "+i);break;case"completed":e.onicecandidate=ci.noop;break}t.connection.emit("iceStateChanged",e.iceConnectionState)},rt.default.log("Listening for data channel"),e.ondatachannel=function(a){rt.default.log("Received data channel");var l=a.channel,c=o.getConnection(i,s);c.initialize(l)},rt.default.log("Listening for remote stream"),e.ontrack=function(a){rt.default.log("Received remote stream");var l=a.streams[0],c=o.getConnection(i,s);if(c.type===Uo.Media){var u=c;t._addStreamToMediaConnection(l,u)}}},n.prototype.cleanup=function(){rt.default.log("Cleaning up PeerConnection to "+this.connection.peer);var e=this.connection.peerConnection;if(e){this.connection.peerConnection=null,e.onicecandidate=e.oniceconnectionstatechange=e.ondatachannel=e.ontrack=function(){};var t=e.signalingState!=="closed",i=!1;if(this.connection.type===Uo.Data){var s=this.connection,r=s.dataChannel;r&&(i=!!r.readyState&&r.readyState!=="closed")}(t||i)&&e.close()}},n.prototype._makeOffer=function(){return Dv(this,void 0,Promise,function(){var e,t,i,s,r,o,a;return Ov(this,function(l){switch(l.label){case 0:e=this.connection.peerConnection,t=this.connection.provider,l.label=1;case 1:return l.trys.push([1,7,,8]),[4,e.createOffer(this.connection.options.constraints)];case 2:i=l.sent(),rt.default.log("Created offer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(i.sdp=this.connection.options.sdpTransform(i.sdp)||i.sdp),l.label=3;case 3:return l.trys.push([3,5,,6]),[4,e.setLocalDescription(i)];case 4:return l.sent(),rt.default.log("Set localDescription:",i,"for:".concat(this.connection.peer)),s={sdp:i,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata,browser:ci.browser},this.connection.type===Uo.Data&&(r=this.connection,s=u0(u0({},s),{label:r.label,reliable:r.reliable,serialization:r.serialization})),t.socket.send({type:rs.Offer,payload:s,dst:this.connection.peer}),[3,6];case 5:return o=l.sent(),o!="OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"&&(t.emitError(hn.WebRTC,o),rt.default.log("Failed to setLocalDescription, ",o)),[3,6];case 6:return[3,8];case 7:return a=l.sent(),t.emitError(hn.WebRTC,a),rt.default.log("Failed to createOffer, ",a),[3,8];case 8:return[2]}})})},n.prototype._makeAnswer=function(){return Dv(this,void 0,Promise,function(){var e,t,i,s,r;return Ov(this,function(o){switch(o.label){case 0:e=this.connection.peerConnection,t=this.connection.provider,o.label=1;case 1:return o.trys.push([1,7,,8]),[4,e.createAnswer()];case 2:i=o.sent(),rt.default.log("Created answer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(i.sdp=this.connection.options.sdpTransform(i.sdp)||i.sdp),o.label=3;case 3:return o.trys.push([3,5,,6]),[4,e.setLocalDescription(i)];case 4:return o.sent(),rt.default.log("Set localDescription:",i,"for:".concat(this.connection.peer)),t.socket.send({type:rs.Answer,payload:{sdp:i,type:this.connection.type,connectionId:this.connection.connectionId,browser:ci.browser},dst:this.connection.peer}),[3,6];case 5:return s=o.sent(),t.emitError(hn.WebRTC,s),rt.default.log("Failed to setLocalDescription, ",s),[3,6];case 6:return[3,8];case 7:return r=o.sent(),t.emitError(hn.WebRTC,r),rt.default.log("Failed to create answer, ",r),[3,8];case 8:return[2]}})})},n.prototype.handleSDP=function(e,t){return Dv(this,void 0,Promise,function(){var i,s,r,o;return Ov(this,function(a){switch(a.label){case 0:t=new RTCSessionDescription(t),i=this.connection.peerConnection,s=this.connection.provider,rt.default.log("Setting remote description",t),r=this,a.label=1;case 1:return a.trys.push([1,5,,6]),[4,i.setRemoteDescription(t)];case 2:return a.sent(),rt.default.log("Set remoteDescription:".concat(e," for:").concat(this.connection.peer)),e!=="OFFER"?[3,4]:[4,r._makeAnswer()];case 3:a.sent(),a.label=4;case 4:return[3,6];case 5:return o=a.sent(),s.emitError(hn.WebRTC,o),rt.default.log("Failed to setRemoteDescription, ",o),[3,6];case 6:return[2]}})})},n.prototype.handleCandidate=function(e){return Dv(this,void 0,Promise,function(){var t,i,s,r,o,a;return Ov(this,function(l){switch(l.label){case 0:rt.default.log("handleCandidate:",e),t=e.candidate,i=e.sdpMLineIndex,s=e.sdpMid,r=this.connection.peerConnection,o=this.connection.provider,l.label=1;case 1:return l.trys.push([1,3,,4]),[4,r.addIceCandidate(new RTCIceCandidate({sdpMid:s,sdpMLineIndex:i,candidate:t}))];case 2:return l.sent(),rt.default.log("Added ICE candidate for:".concat(this.connection.peer)),[3,4];case 3:return a=l.sent(),o.emitError(hn.WebRTC,a),rt.default.log("Failed to handleCandidate, ",a),[3,4];case 4:return[2]}})})},n.prototype._addTracksToConnection=function(e,t){if(rt.default.log("add tracks from stream ".concat(e.id," to peer connection")),!t.addTrack)return rt.default.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");e.getTracks().forEach(function(i){t.addTrack(i,e)})},n.prototype._addStreamToMediaConnection=function(e,t){rt.default.log("add stream ".concat(e.id," to media connection ").concat(t.connectionId)),t.addStream(e)},n}(),jM={};Wa(jM,"BaseConnection",()=>gP,n=>gP=n);var _W=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,s){i.__proto__=s}||function(i,s){for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(i[r]=s[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),gP=function(n){_W(e,n);function e(t,i,s){var r=n.call(this)||this;return r.peer=t,r.provider=i,r.options=s,r._open=!1,r.metadata=s.metadata,r}return Object.defineProperty(e.prototype,"open",{get:function(){return this._open},enumerable:!1,configurable:!0}),e}(sA.EventEmitter),xW=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,s){i.__proto__=s}||function(i,s){for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(i[r]=s[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),d0=function(){return d0=Object.assign||function(n){for(var e,t=1,i=arguments.length;t<i;t++){e=arguments[t];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(n[s]=e[s])}return n},d0.apply(this,arguments)},wW=function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],i=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},mP=function(n){xW(e,n);function e(t,i,s){var r=n.call(this,t,i,s)||this;return r._localStream=r.options._stream,r.connectionId=r.options.connectionId||e.ID_PREFIX+ci.randomToken(),r._negotiator=new WM.Negotiator(r),r._localStream&&r._negotiator.startConnection({_stream:r._localStream,originator:!0}),r}return Object.defineProperty(e.prototype,"type",{get:function(){return Uo.Media},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"localStream",{get:function(){return this._localStream},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"remoteStream",{get:function(){return this._remoteStream},enumerable:!1,configurable:!0}),e.prototype.addStream=function(t){rt.default.log("Receiving stream",t),this._remoteStream=t,n.prototype.emit.call(this,"stream",t)},e.prototype.handleMessage=function(t){var i=t.type,s=t.payload;switch(t.type){case rs.Answer:this._negotiator.handleSDP(i,s.sdp),this._open=!0;break;case rs.Candidate:this._negotiator.handleCandidate(s.candidate);break;default:rt.default.warn("Unrecognized message type:".concat(i," from peer:").concat(this.peer));break}},e.prototype.answer=function(t,i){var s,r;if(i===void 0&&(i={}),this._localStream){rt.default.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");return}this._localStream=t,i&&i.sdpTransform&&(this.options.sdpTransform=i.sdpTransform),this._negotiator.startConnection(d0(d0({},this.options._payload),{_stream:t}));var o=this.provider._getMessages(this.connectionId);try{for(var a=wW(o),l=a.next();!l.done;l=a.next()){var c=l.value;this.handleMessage(c)}}catch(u){s={error:u}}finally{try{l&&!l.done&&(r=a.return)&&r.call(a)}finally{if(s)throw s.error}}this._open=!0},e.prototype.close=function(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,n.prototype.emit.call(this,"close"))},e.ID_PREFIX="mc_",e}(jM.BaseConnection),SC={};Wa(SC,"DataConnection",()=>vP,n=>vP=n);var A2={};Wa(A2,"EncodingQueue",()=>AP,n=>AP=n);var SW=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,s){i.__proto__=s}||function(i,s){for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(i[r]=s[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),AP=function(n){SW(e,n);function e(){var t=n.call(this)||this;return t.fileReader=new FileReader,t._queue=[],t._processing=!1,t.fileReader.onload=function(i){t._processing=!1,i.target&&t.emit("done",i.target.result),t.doNextTask()},t.fileReader.onerror=function(i){rt.default.error("EncodingQueue error:",i),t._processing=!1,t.destroy(),t.emit("error",i)},t}return Object.defineProperty(e.prototype,"queue",{get:function(){return this._queue},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this.queue.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"processing",{get:function(){return this._processing},enumerable:!1,configurable:!0}),e.prototype.enque=function(t){this.queue.push(t),!this.processing&&this.doNextTask()},e.prototype.destroy=function(){this.fileReader.abort(),this._queue=[]},e.prototype.doNextTask=function(){this.size!==0&&(this.processing||(this._processing=!0,this.fileReader.readAsArrayBuffer(this.queue.shift())))},e}(sA.EventEmitter),CW=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,s){i.__proto__=s}||function(i,s){for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(i[r]=s[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),EW=function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],i=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},vP=function(n){CW(e,n);function e(t,i,s){var r=n.call(this,t,i,s)||this;return r.stringify=JSON.stringify,r.parse=JSON.parse,r._buffer=[],r._bufferSize=0,r._buffering=!1,r._chunkedData={},r._encodingQueue=new A2.EncodingQueue,r.connectionId=r.options.connectionId||e.ID_PREFIX+ci.randomToken(),r.label=r.options.label||r.connectionId,r.serialization=r.options.serialization||dl.Binary,r.reliable=!!r.options.reliable,r._encodingQueue.on("done",function(o){r._bufferedSend(o)}),r._encodingQueue.on("error",function(){rt.default.error("DC#".concat(r.connectionId,": Error occured in encoding from blob to arraybuffer, close DC")),r.close()}),r._negotiator=new WM.Negotiator(r),r._negotiator.startConnection(r.options._payload||{originator:!0}),r}return Object.defineProperty(e.prototype,"type",{get:function(){return Uo.Data},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dataChannel",{get:function(){return this._dc},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bufferSize",{get:function(){return this._bufferSize},enumerable:!1,configurable:!0}),e.prototype.initialize=function(t){this._dc=t,this._configureDataChannel()},e.prototype._configureDataChannel=function(){var t=this;(!ci.supports.binaryBlob||ci.supports.reliable)&&(this.dataChannel.binaryType="arraybuffer"),this.dataChannel.onopen=function(){rt.default.log("DC#".concat(t.connectionId," dc connection success")),t._open=!0,t.emit("open")},this.dataChannel.onmessage=function(i){rt.default.log("DC#".concat(t.connectionId," dc onmessage:"),i.data),t._handleDataMessage(i)},this.dataChannel.onclose=function(){rt.default.log("DC#".concat(t.connectionId," dc closed for:"),t.peer),t.close()}},e.prototype._handleDataMessage=function(t){var i=this,s=t.data,r=s.constructor,o=this.serialization===dl.Binary||this.serialization===dl.BinaryUTF8,a=s;if(o){if(r===Blob){ci.blobToArrayBuffer(s,function(c){var u=ci.unpack(c);i.emit("data",u)});return}else if(r===ArrayBuffer)a=ci.unpack(s);else if(r===String){var l=ci.binaryStringToArrayBuffer(s);a=ci.unpack(l)}}else this.serialization===dl.JSON&&(a=this.parse(s));if(a.__peerData){this._handleChunk(a);return}n.prototype.emit.call(this,"data",a)},e.prototype._handleChunk=function(t){var i=t.__peerData,s=this._chunkedData[i]||{data:[],count:0,total:t.total};if(s.data[t.n]=t.data,s.count++,this._chunkedData[i]=s,s.total===s.count){delete this._chunkedData[i];var r=new Blob(s.data);this._handleDataMessage({data:r})}},e.prototype.close=function(){this._buffer=[],this._bufferSize=0,this._chunkedData={},this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this._dc=null),this._encodingQueue&&(this._encodingQueue.destroy(),this._encodingQueue.removeAllListeners(),this._encodingQueue=null),this.open&&(this._open=!1,n.prototype.emit.call(this,"close"))},e.prototype.send=function(t,i){if(!this.open){n.prototype.emit.call(this,"error",new Error("Connection is not open. You should listen for the `open` event before sending messages."));return}if(this.serialization===dl.JSON)this._bufferedSend(this.stringify(t));else if(this.serialization===dl.Binary||this.serialization===dl.BinaryUTF8){var s=ci.pack(t);if(!i&&s.size>ci.chunkedMTU){this._sendChunks(s);return}ci.supports.binaryBlob?this._bufferedSend(s):this._encodingQueue.enque(s)}else this._bufferedSend(t)},e.prototype._bufferedSend=function(t){(this._buffering||!this._trySend(t))&&(this._buffer.push(t),this._bufferSize=this._buffer.length)},e.prototype._trySend=function(t){var i=this;if(!this.open)return!1;if(this.dataChannel.bufferedAmount>e.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(function(){i._buffering=!1,i._tryBuffer()},50),!1;try{this.dataChannel.send(t)}catch(s){return rt.default.error("DC#:".concat(this.connectionId," Error when sending:"),s),this._buffering=!0,this.close(),!1}return!0},e.prototype._tryBuffer=function(){if(this.open&&this._buffer.length!==0){var t=this._buffer[0];this._trySend(t)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}},e.prototype._sendChunks=function(t){var i,s,r=ci.chunk(t);rt.default.log("DC#".concat(this.connectionId," Try to send ").concat(r.length," chunks..."));try{for(var o=EW(r),a=o.next();!a.done;a=o.next()){var l=a.value;this.send(l,!0)}}catch(c){i={error:c}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}},e.prototype.handleMessage=function(t){var i=t.payload;switch(t.type){case rs.Answer:this._negotiator.handleSDP(t.type,i.sdp);break;case rs.Candidate:this._negotiator.handleCandidate(i.candidate);break;default:rt.default.warn("Unrecognized message type:",t.type,"from peer:",this.peer);break}},e.ID_PREFIX="dc_",e.MAX_BUFFERED_AMOUNT=8388608,e}(jM.BaseConnection),v2={};Wa(v2,"API",()=>_P,n=>_P=n);var yP=function(n,e,t,i){function s(r){return r instanceof t?r:new t(function(o){o(r)})}return new(t||(t=Promise))(function(r,o){function a(u){try{c(i.next(u))}catch(d){o(d)}}function l(u){try{c(i.throw(u))}catch(d){o(d)}}function c(u){u.done?r(u.value):s(u.value).then(a,l)}c((i=i.apply(n,e||[])).next())})},bP=function(n,e){var t={label:0,sent:function(){if(r[0]&1)throw r[1];return r[1]},trys:[],ops:[]},i,s,r,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(c){return function(u){return l([c,u])}}function l(c){if(i)throw new TypeError("Generator is already executing.");for(;t;)try{if(i=1,s&&(r=c[0]&2?s.return:c[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,c[1])).done)return r;switch(s=0,r&&(c=[c[0]&2,r.value]),c[0]){case 0:case 1:r=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,s=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(r=t.trys,!(r=r.length>0&&r[r.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!r||c[1]>r[0]&&c[1]<r[3])){t.label=c[1];break}if(c[0]===6&&t.label<r[1]){t.label=r[1],r=c;break}if(r&&t.label<r[2]){t.label=r[2],t.ops.push(c);break}r[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(n,t)}catch(u){c=[6,u],s=0}finally{i=r=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}},_P=function(){function n(e){this._options=e}return n.prototype._buildRequest=function(e){var t=this._options.secure?"https":"http",i=this._options,s=i.host,r=i.port,o=i.path,a=i.key,l=new URL("".concat(t,"://").concat(s,":").concat(r).concat(o).concat(a,"/").concat(e));return l.searchParams.set("ts","".concat(Date.now()).concat(Math.random())),l.searchParams.set("version",QM.version),fetch(l.href,{referrerPolicy:this._options.referrerPolicy})},n.prototype.retrieveId=function(){return yP(this,void 0,Promise,function(){var e,t,i;return bP(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,this._buildRequest("id")];case 1:if(e=s.sent(),e.status!==200)throw new Error("Error. Status:".concat(e.status));return[2,e.text()];case 2:throw t=s.sent(),rt.default.error("Error retrieving ID",t),i="",this._options.path==="/"&&this._options.host!==ci.CLOUD_HOST&&(i=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+i);case 3:return[2]}})})},n.prototype.listAllPeers=function(){return yP(this,void 0,Promise,function(){var e,t,i;return bP(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,this._buildRequest("peers")];case 1:if(e=s.sent(),e.status!==200)throw e.status===401?(t="",this._options.host===ci.CLOUD_HOST?t="It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":t="You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+t)):new Error("Error. Status:".concat(e.status));return[2,e.json()];case 2:throw i=s.sent(),rt.default.error("Error retrieving list peers",i),new Error("Could not get list peers from the server."+i);case 3:return[2]}})})},n}(),MW=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,s){i.__proto__=s}||function(i,s){for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(i[r]=s[r])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),Pg=function(){return Pg=Object.assign||function(n){for(var e,t=1,i=arguments.length;t<i;t++){e=arguments[t];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(n[s]=e[s])}return n},Pg.apply(this,arguments)},zp=function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],i=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},TW=function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var i=t.call(n),s,r=[],o;try{for(;(e===void 0||e-- >0)&&!(s=i.next()).done;)r.push(s.value)}catch(a){o={error:a}}finally{try{s&&!s.done&&(t=i.return)&&t.call(i)}finally{if(o)throw o.error}}return r},CC=function(n){MW(e,n);function e(t,i){var s=n.call(this)||this;s._id=null,s._lastServerId=null,s._destroyed=!1,s._disconnected=!1,s._open=!1,s._connections=new Map,s._lostMessages=new Map;var r;return t&&t.constructor==Object?i=t:t&&(r=t.toString()),i=Pg({debug:0,host:ci.CLOUD_HOST,port:ci.CLOUD_PORT,path:"/",key:e.DEFAULT_KEY,token:ci.randomToken(),config:ci.defaultConfig,referrerPolicy:"strict-origin-when-cross-origin"},i),s._options=i,s._options.host==="/"&&(s._options.host=window.location.hostname),s._options.path&&(s._options.path[0]!=="/"&&(s._options.path="/"+s._options.path),s._options.path[s._options.path.length-1]!=="/"&&(s._options.path+="/")),s._options.secure===void 0&&s._options.host!==ci.CLOUD_HOST?s._options.secure=ci.isSecure():s._options.host==ci.CLOUD_HOST&&(s._options.secure=!0),s._options.logFunction&&rt.default.setLogFunction(s._options.logFunction),rt.default.logLevel=s._options.debug||0,s._api=new v2.API(i),s._socket=s._createServerConnection(),!ci.supports.audioVideo&&!ci.supports.data?(s._delayedAbort(hn.BrowserIncompatible,"The current browser does not support WebRTC"),s):r&&!ci.validateId(r)?(s._delayedAbort(hn.InvalidID,'ID "'.concat(r,'" is invalid')),s):(r?s._initialize(r):s._api.retrieveId().then(function(o){return s._initialize(o)}).catch(function(o){return s._abort(hn.ServerError,o)}),s)}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"options",{get:function(){return this._options},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"open",{get:function(){return this._open},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"socket",{get:function(){return this._socket},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"connections",{get:function(){var t,i,s=Object.create(null);try{for(var r=zp(this._connections),o=r.next();!o.done;o=r.next()){var a=TW(o.value,2),l=a[0],c=a[1];s[l]=c}}catch(u){t={error:u}}finally{try{o&&!o.done&&(i=r.return)&&i.call(r)}finally{if(t)throw t.error}}return s},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"disconnected",{get:function(){return this._disconnected},enumerable:!1,configurable:!0}),e.prototype._createServerConnection=function(){var t=this,i=new m2.Socket(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return i.on(El.Message,function(s){t._handleMessage(s)}),i.on(El.Error,function(s){t._abort(hn.SocketError,s)}),i.on(El.Disconnected,function(){t.disconnected||(t.emitError(hn.Network,"Lost connection to server."),t.disconnect())}),i.on(El.Close,function(){t.disconnected||t._abort(hn.SocketClosed,"Underlying socket is already closed.")}),i},e.prototype._initialize=function(t){this._id=t,this.socket.start(t,this._options.token)},e.prototype._handleMessage=function(t){var i,s,r=t.type,o=t.payload,a=t.src;switch(r){case rs.Open:this._lastServerId=this.id,this._open=!0,this.emit("open",this.id);break;case rs.Error:this._abort(hn.ServerError,o.msg);break;case rs.IdTaken:this._abort(hn.UnavailableID,'ID "'.concat(this.id,'" is taken'));break;case rs.InvalidKey:this._abort(hn.InvalidKey,'API KEY "'.concat(this._options.key,'" is invalid'));break;case rs.Leave:rt.default.log("Received leave message from ".concat(a)),this._cleanupPeer(a),this._connections.delete(a);break;case rs.Expire:this.emitError(hn.PeerUnavailable,"Could not connect to peer ".concat(a));break;case rs.Offer:var g=o.connectionId,A=this.getConnection(a,g);if(A&&(A.close(),rt.default.warn("Offer received for existing Connection ID:".concat(g))),o.type===Uo.Media){var l=new wC.MediaConnection(a,this,{connectionId:g,_payload:o,metadata:o.metadata});A=l,this._addConnection(a,A),this.emit("call",l)}else if(o.type===Uo.Data){var c=new SC.DataConnection(a,this,{connectionId:g,_payload:o,metadata:o.metadata,label:o.label,serialization:o.serialization,reliable:o.reliable});A=c,this._addConnection(a,A),this.emit("connection",c)}else{rt.default.warn("Received malformed connection type:".concat(o.type));return}var u=this._getMessages(g);try{for(var d=zp(u),f=d.next();!f.done;f=d.next()){var p=f.value;A.handleMessage(p)}}catch(v){i={error:v}}finally{try{f&&!f.done&&(s=d.return)&&s.call(d)}finally{if(i)throw i.error}}break;default:if(!o){rt.default.warn("You received a malformed message from ".concat(a," of type ").concat(r));return}var g=o.connectionId,A=this.getConnection(a,g);A&&A.peerConnection?A.handleMessage(t):g?this._storeMessage(g,t):rt.default.warn("You received an unrecognized message:",t);break}},e.prototype._storeMessage=function(t,i){this._lostMessages.has(t)||this._lostMessages.set(t,[]),this._lostMessages.get(t).push(i)},e.prototype._getMessages=function(t){var i=this._lostMessages.get(t);return i?(this._lostMessages.delete(t),i):[]},e.prototype.connect=function(t,i){if(i===void 0&&(i={}),this.disconnected){rt.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),this.emitError(hn.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}var s=new SC.DataConnection(t,this,i);return this._addConnection(t,s),s},e.prototype.call=function(t,i,s){if(s===void 0&&(s={}),this.disconnected){rt.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),this.emitError(hn.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}if(!i){rt.default.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.");return}var r=new wC.MediaConnection(t,this,Pg(Pg({},s),{_stream:i}));return this._addConnection(t,r),r},e.prototype._addConnection=function(t,i){rt.default.log("add connection ".concat(i.type,":").concat(i.connectionId," to peerId:").concat(t)),this._connections.has(t)||this._connections.set(t,[]),this._connections.get(t).push(i)},e.prototype._removeConnection=function(t){var i=this._connections.get(t.peer);if(i){var s=i.indexOf(t);s!==-1&&i.splice(s,1)}this._lostMessages.delete(t.connectionId)},e.prototype.getConnection=function(t,i){var s,r,o=this._connections.get(t);if(!o)return null;try{for(var a=zp(o),l=a.next();!l.done;l=a.next()){var c=l.value;if(c.connectionId===i)return c}}catch(u){s={error:u}}finally{try{l&&!l.done&&(r=a.return)&&r.call(a)}finally{if(s)throw s.error}}return null},e.prototype._delayedAbort=function(t,i){var s=this;setTimeout(function(){s._abort(t,i)},0)},e.prototype._abort=function(t,i){rt.default.error("Aborting!"),this.emitError(t,i),this._lastServerId?this.disconnect():this.destroy()},e.prototype.emitError=function(t,i){rt.default.error("Error:",i);var s;typeof i=="string"?s=new Error(i):s=i,s.type=t,this.emit("error",s)},e.prototype.destroy=function(){this.destroyed||(rt.default.log("Destroy peer with ID:".concat(this.id)),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit("close"))},e.prototype._cleanup=function(){var t,i;try{for(var s=zp(this._connections.keys()),r=s.next();!r.done;r=s.next()){var o=r.value;this._cleanupPeer(o),this._connections.delete(o)}}catch(a){t={error:a}}finally{try{r&&!r.done&&(i=s.return)&&i.call(s)}finally{if(t)throw t.error}}this.socket.removeAllListeners()},e.prototype._cleanupPeer=function(t){var i,s,r=this._connections.get(t);if(r)try{for(var o=zp(r),a=o.next();!a.done;a=o.next()){var l=a.value;l.close()}}catch(c){i={error:c}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}},e.prototype.disconnect=function(){if(!this.disconnected){var t=this.id;rt.default.log("Disconnect peer with ID:".concat(t)),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=t,this._id=null,this.emit("disconnected",t)}},e.prototype.reconnect=function(){if(this.disconnected&&!this.destroyed)rt.default.log("Attempting reconnection to server with ID ".concat(this._lastServerId)),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(!this.disconnected&&!this.open)rt.default.error("In a hurry? We're still trying to make the initial connection!");else throw new Error("Peer ".concat(this.id," cannot reconnect because it is not disconnected from the server!"))}},e.prototype.listAllPeers=function(t){var i=this;t===void 0&&(t=function(s){}),this._api.listAllPeers().then(function(s){return t(s)}).catch(function(s){return i._abort(hn.ServerError,s)})},e.DEFAULT_KEY="peerjs",e}(sA.EventEmitter),EC=p2.Peer;const IW=Object.freeze(Object.defineProperty({__proto__:null,get Peer(){return CC},default:EC,util:ci},Symbol.toStringTag,{value:"Module"}));let RW;function PW(n,e){return e||(e={}),e={...RW,...e},n?new EC(n,e):new EC(e)}async function xP(){const n=await e_(()=>Promise.resolve().then(()=>IW),void 0,import.meta.url);return console.log(n),n.default===void 0?n:n.default}var MC;(function(n){n.ConnectionList="connection-list"})(MC||(MC={}));class BW{constructor(){h(this,"_host");h(this,"_client");h(this,"_clientData");this.onEnable()}get isHost(){return this._host!==void 0}onEnable(){const e="HOST-5980e65c-8438-453e-8b35-f13c736dcd81";this.trySetupHost(e)}async trySetupHost(e){const t=await xP(),i=new t(e);i.on("error",s=>{console.error(s),this._host=void 0,this.trySetupClient(e)}),i.on("open",s=>{this._host=new OW(i)})}async trySetupClient(e){const t=await xP();this._client=new t,this._client.on("error",i=>{console.error("Client error",i)}),this._client.on("open",i=>{console.log("client connected",i),this._clientData=this._client.connect(e,{metadata:{id:i}}),this._clientData.on("open",()=>{console.log("Connected to host")}),this._clientData.on("data",s=>{console.log("<<",s)})})}}class DW{constructor(e){h(this,"_peer");this._peer=e}}class OW extends DW{constructor(t){var i;super(t);h(this,"_connections",[]);console.log("I AM THE HOST"),(i=this._peer)==null||i.on("connection",this.onConnection.bind(this)),this._peer.on("close",()=>{this.broadcast("BYE")}),setInterval(()=>{this.broadcast("HELLO")},2e3)}get isHost(){return!0}onConnection(t){console.log("host connection",t),t.on("open",()=>{this._connections.push(t),this.broadcastConnection(t)})}broadcastConnection(t){const i=this._connections.map(s=>{var r;return(r=s.metadata)==null?void 0:r.id}).filter(s=>s!==void 0);this.broadcast({type:MC.ConnectionList,connections:i})}broadcast(t){if(t!=null){console.log(">>",t);for(const i in this._peer.connections){const s=this._peer.connections[i];if(s)if(Array.isArray(s))for(const r of s)r&&r.send(t);else console.warn(s)}}}}var Tr;(function(n){n[n.OnConnection=0]="OnConnection",n[n.OnRoomJoin=1]="OnRoomJoin",n[n.Queued=2]="Queued",n[n.Immediate=3]="Immediate"})(Tr||(Tr={}));const wP="https://urls.needle.tools/default-networking-backend/index";let cc="wss://needle-tiny-starter.glitch.me/socket";const nr=!!re("debugnet"),kv=!!(nr||re("debugowner"));var TC;(function(n){n.ConnectionInfo="connection-start-info"})(TC||(TC={}));var pi;(function(n){n.Join="join-room",n.Leave="leave-room",n.JoinedRoom="joined-room",n.LeftRoom="left-room",n.UserJoinedRoom="user-joined-room",n.UserLeftRoom="user-left-room",n.RoomStateSent="room-state-sent"})(pi||(pi={}));var ys;(function(n){n.RequestHasOwner="request-has-owner",n.ResponseHasOwner="response-has-owner",n.RequestIsOwner="request-is-owner",n.ResponseIsOwner="response-is-owner",n.RequestOwnership="request-ownership",n.GainedOwnership="gained-ownership",n.RemoveOwnership="remove-ownership",n.LostOwnership="lost-ownership",n.GainedOwnershipBroadcast="gained-ownership-broadcast",n.LostOwnershipBroadcast="lost-ownership-broadcast"})(ys||(ys={}));class qM{constructor(e,t){h(this,"guid");h(this,"connection");h(this,"_hasOwnership",!1);h(this,"_isOwned");h(this,"_gainSubscription");h(this,"_lostSubscription");h(this,"_hasOwnerResponse");h(this,"_isWaitingForOwnershipResponseCallback",null);this.connection=e,this.guid=t,this._gainSubscription=this.onGainedOwnership.bind(this),this._lostSubscription=this.onLostOwnership.bind(this),e.beginListen(ys.LostOwnership,this._lostSubscription),e.beginListen(ys.GainedOwnershipBroadcast,this._gainSubscription),this._hasOwnerResponse=this.onHasOwnerResponse.bind(this),e.beginListen(ys.ResponseHasOwner,this._hasOwnerResponse)}get hasOwnership(){return this._hasOwnership}get isOwned(){return this._isOwned}get isConnected(){return this.connection.isConnected}updateIsOwned(){this.connection.send(ys.RequestHasOwner,{guid:this.guid})}onHasOwnerResponse(e){e.guid===this.guid&&(this._isOwned=e.value)}requestOwnershipIfNotOwned(){return this._isWaitingForOwnershipResponseCallback!==null?this:(this._isWaitingForOwnershipResponseCallback=this.waitForHasOwnershipRequestResponse.bind(this),this.connection.beginListen(ys.ResponseHasOwner,this._isWaitingForOwnershipResponseCallback),this.connection.send(ys.RequestHasOwner,{guid:this.guid}),this)}waitForHasOwnershipRequestResponse(e){e.guid===this.guid&&(this._isWaitingForOwnershipResponseCallback&&(this.connection.stopListen(ys.ResponseHasOwner,this._isWaitingForOwnershipResponseCallback),this._isWaitingForOwnershipResponseCallback=null),this._isOwned=e.value,e.value||(kv&&console.log("request ownership",this.guid),this.requestOwnership()))}requestOwnershipAsync(){return new Promise((e,t)=>{this.requestOwnership();let i=0;const s=()=>{if(i++>10)return t("Timeout");setTimeout(()=>{this.hasOwnership?e(this):s()},100)};s()})}requestOwnership(){return kv&&console.log("Request ownership",this.guid),this.connection.send(ys.RequestOwnership,{guid:this.guid}),this}freeOwnership(){return this.connection.send(ys.RemoveOwnership,{guid:this.guid}),this._isWaitingForOwnershipResponseCallback&&(this.connection.stopListen(ys.ResponseHasOwner,this._isWaitingForOwnershipResponseCallback),this._isWaitingForOwnershipResponseCallback=null),this}destroy(){this.connection.stopListen(ys.GainedOwnership,this._gainSubscription),this.connection.stopListen(ys.LostOwnership,this._lostSubscription),this.connection.stopListen(ys.ResponseHasOwner,this._hasOwnerResponse),this._isWaitingForOwnershipResponseCallback&&(this.connection.stopListen(ys.ResponseHasOwner,this._isWaitingForOwnershipResponseCallback),this._isWaitingForOwnershipResponseCallback=null)}onGainedOwnership(e){e.guid===this.guid&&(this._isOwned=!0,this.connection.connectionId===e.owner?(kv&&console.log("GAINED OWNERSHIP",this.guid),this._hasOwnership=!0):this._hasOwnership=!1)}onLostOwnership(e){e===this.guid&&(kv&&console.log("LOST OWNERSHIP",this.guid),this._hasOwnership=!1,this._isOwned=!1)}}class kW{constructor(e){h(this,"context");h(this,"_peer",null);h(this,"_usersInRoomCopy",[]);h(this,"_defaultMessagesBuffer",[]);h(this,"_defaultMessagesBufferArray",[]);h(this,"netWebSocketUrlProvider");h(this,"_listeners",{});h(this,"_listenersBinary",{});h(this,"connected",!1);h(this,"channelId");h(this,"_connectionId",null);h(this,"_ws");h(this,"_waitingForSocket",{});h(this,"_isInRoom",!1);h(this,"_currentRoomName",null);h(this,"_currentRoomViewId",null);h(this,"_currentRoomAllowEditing",!0);h(this,"_currentInRoom",[]);h(this,"_state",{});h(this,"_currentDelay",-1);h(this,"_connectingToWebsocketPromise",null);this.context=e}get peer(){return this._peer||(this._peer=new BW),this._peer}tryGetState(e){return e==="invalid"?null:this._state[e]}get connectionId(){return this._connectionId}get isDebugEnabled(){return nr}get isConnected(){return this.connected}get currentRoomName(){return this._currentRoomName}get allowEditing(){return this._currentRoomAllowEditing}get currentRoomViewId(){return this._currentRoomViewId}get isInRoom(){return this._isInRoom}get currentLatency(){return this._currentDelay}sendPing(){this.send("ping",{time:this.context.time.time})}userIsInRoom(e){return this._currentInRoom.indexOf(e)!==-1}usersInRoom(e=null){e||(e=this._usersInRoomCopy),e.length=0;for(const t of this._currentInRoom)e.push(t);return e}joinRoom(e,t=!1){return e?e.length>1024?(console.error('Room name too long, can not join: "'+e+'". Max length is 1024 characters.'),!1):(this.connect(),nr&&console.log("join: "+e),this.send(pi.Join,{room:e,viewOnly:t},Tr.OnConnection),!0):(console.error('Missing room name, can not join: "'+e+'"'),!1)}leaveRoom(e=null){return e||(e=this.currentRoomName),e?(this.send(pi.Leave,{room:e}),!0):(console.error('Missing room name, can not join: "'+e+'"'),!1)}send(e,t=null,i=Tr.Queued){if(t===null&&(t={}),i===Tr.Queued){this._defaultMessagesBuffer.push({key:e,value:t});return}return this.sendWithWebsocket(e,t,i)}sendDeleteRemoteState(e){this.send("delete-state",{guid:e,dontSave:!0}),delete this._state[e]}sendDeleteRemoteStateAll(){this.send("delete-all-state"),this._state={}}sendBinary(e){var t;nr&&console.log("<< bin",e.length),(t=this._ws)==null||t.send(e)}sendBufferedMessagesNow(){var i;if(!this._ws)return;this._defaultMessagesBufferArray.length=0;const e=Object.keys(this._defaultMessagesBuffer).length;for(const s in this._defaultMessagesBuffer){const r=this._defaultMessagesBuffer[s];if(e<=1){this.sendWithWebsocket(r.key,r.value,Tr.Immediate);break}const o=this.toMessage(r.key,r.value);this._defaultMessagesBufferArray.push(o)}if(this._defaultMessagesBuffer.length=0,this._defaultMessagesBufferArray.length>0&&nr&&console.log("SEND BUFFERED",this._defaultMessagesBufferArray.length),this._defaultMessagesBufferArray.length<=0)return;const t=JSON.stringify(this._defaultMessagesBufferArray);(i=this._ws)==null||i.send(t)}beginListen(e,t){return this._listeners[e]||(this._listeners[e]=[]),this._listeners[e].push(t),t}stopListening(e,t){return this.stopListen(e,t)}stopListen(e,t){if(!t||!this._listeners[e])return;const i=this._listeners[e].indexOf(t);i>=0&&this._listeners[e].splice(i,1)}beginListenBinary(e,t){return this._listenersBinary[e]||(this._listenersBinary[e]=[]),this._listenersBinary[e].push(t),t}stopListenBinary(e,t){if(!this._listenersBinary[e])return;const i=this._listenersBinary[e].indexOf(t);i>=0&&this._listenersBinary[e].splice(i,1)}registerProvider(e){this.netWebSocketUrlProvider=e}async connect(){var t;if(this.connected)return Promise.resolve(!0);nr&&console.log("connecting");const e=(t=this.netWebSocketUrlProvider)==null?void 0:t.getWebsocketUrl();return e?cc=e:h8()&&(cc="wss://"+window.location.host+"/socket"),this.connectWebsocket()}disconnect(){var e;(e=this._ws)==null||e.close(),this._ws=void 0}connectWebsocket(){return this._connectingToWebsocketPromise?this._connectingToWebsocketPromise:this._connectingToWebsocketPromise=new Promise(async(e,t)=>{var l;let i=!1;const s=c=>{i||(i=!0,e(c))};if(cc===void 0&&(console.log("Fetch default backend url: "+wP),cc=await(await fetch(wP)).text()),cc===void 0){s(!1);return}console.log(` Connecting to networking backend on
`+cc);const r=await e_(()=>import("./index-b66b5ca5.js").then(c=>c.i),[],import.meta.url),o=((l=r.default)==null?void 0:l.WebsocketBuilder)??r.WebsocketBuilder,a=new o(cc).onOpen(()=>{this._connectingToWebsocketPromise=null,this._ws=a,this.connected=!0,console.log(` Connected to networking backend
`+cc),s(!0),this.onSendQueued(Tr.OnConnection)}).onClose(c=>{this._connectingToWebsocketPromise=null,this.connected=!1,this._isInRoom=!1,s(!1)}).onError((c,u)=>{console.error(" Websocket error",c,u),s(!1)}).onMessage(this.onMessage.bind(this)).onRetry(()=>{console.log("Retry connecting to networking websocket")}).build()})}onMessage(e,t){const i=t.data;try{if(typeof i!="string"){i.size&&this.handleIncomingBinaryMessage(i);return}const s=JSON.parse(i);if(Array.isArray(s))for(const r of s)this.handleIncomingStringMessage(r);else this.handleIncomingStringMessage(s);return}catch{nr&&i==="pong"&&console.log("<<",i)}}async handleIncomingBinaryMessage(e){const t=await e.arrayBuffer();var i=new Uint8Array(t);const s=new Sm(i),r=s.getBufferIdentifier(),o=this._listenersBinary[r],a=q8(s),l=X8(a);if(l&&typeof l=="string"&&(this._state[l]=a),!o)return;const c=a??s;for(const u of o)u(c)}handleIncomingStringMessage(e){var s,r;if(nr&&console.log("<<",e.key??e),e.key)switch(e.key){case TC.ConnectionInfo:if(e.data){const l=e.data;l&&(console.assert(l.id!==void 0&&l.id!==null&&l.id.length>0,"server did not send connection id",l.id),console.log("Your id is: "+l.id,this.context.alias??""),this._connectionId=l.id)}else console.warn("Expected connection id in "+e.key);break;case pi.JoinedRoom:if(nr&&console.log(e),e){this._isInRoom=!0;const l=e;this._currentRoomName=l.room,this._currentRoomViewId=l.viewId,this._currentRoomAllowEditing=l.allowEditing??!0,this._currentInRoom.length=0,this._currentInRoom.push(...l.inRoom),nr&&console.log("joined room with",this._currentInRoom,this.context.alias??"");const c=new URL(window.location.href);c.searchParams.has("room")&&c.searchParams.delete("room"),c.searchParams.set("view",this._currentRoomViewId),console.log("Room view id: "+this._currentRoomViewId+`
`+c.href)}this.onSendQueued(Tr.OnRoomJoin);break;case pi.LeftRoom:e.room===this.currentRoomName&&(this._isInRoom=!1,this._currentRoomName=null,this._currentInRoom.length=0);break;case pi.UserJoinedRoom:if(e.data){const l=e.data;this._currentInRoom.push(l.userId),nr&&console.log(l.userId+" joined","now in room:",this._currentInRoom)}break;case pi.UserLeftRoom:if(e.data){const l=e.data,c=this._currentInRoom.indexOf(l.userId);c>=0&&(console.log(l.userId+" left",this.context.alias??""),this._currentInRoom.splice(c,1)),l.userId===this.connectionId&&console.log("you left the room")}break;case"all-room-state-deleted":nr&&console.log("RECEIVED all-room-state-deleted"),this._state={};break;case"ping":case"pong":const a=(s=e.data)==null?void 0:s.time;a&&(this._currentDelay=this.context.time.time-a),nr&&console.log("Current latency: "+this._currentDelay.toFixed(1)+" sec","Clients in room: "+((r=this._currentInRoom)==null?void 0:r.length));break}const t=this._listeners[e.key];if(t)for(const o of t)o(e.data);const i=e.data;i&&(this._state[i.guid]=i)}toMessage(e,t){return{key:e,data:t}}sendWithWebsocket(e,t,i=Tr.OnRoomJoin){if(!this._ws){const r=this._waitingForSocket[i]||[];r.push(()=>this.sendWithWebsocket(e,t,i)),this._waitingForSocket[i]=r;return}const s=JSON.stringify(this.toMessage(e,t));nr&&console.log(">>",e),this._ws.send(s)}onSendQueued(e){const t=this._waitingForSocket[e];if(t){for(const i of t)i();t.length=0}}}function pf(n,e){try{e?n(e):n()}catch(t){return console.error(t),!1}return!0}const y2=re("debugdefines");s_('if(!globalThis[""3.22.6""]) globalThis[""3.22.6""] = "0.0.0";');s_('if(!globalThis[""Unity 2021.3.1f1, Needle Engine Integration @3.20.1""]) globalThis[""Unity 2021.3.1f1, Needle Engine Integration @3.20.1""] = "unknown";');s_('globalThis["__NEEDLE_ENGINE_VERSION__"] = "3.22.6";');s_('globalThis["__NEEDLE_ENGINE_GENERATOR__"] = "Unity 2021.3.1f1, Needle Engine Integration @3.20.1";');const Ml="3.22.6",XM="Unity 2021.3.1f1, Needle Engine Integration @3.20.1";y2&&console.log(`Engine version: ${Ml} (generator: ${XM})`);const zc="needle_isActiveInHierarchy",Ld="builtin_components",Iy="needle_editor_guid";function s_(n){try{(0,eval)(n)}catch(e){y2&&console.error(e)}}const LW=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function FW(n){return typeof n=="string"&&LW.test(n)}const ts=[];for(let n=0;n<256;++n)ts.push((n+256).toString(16).slice(1));function UW(n,e=0){return ts[n[e+0]]+ts[n[e+1]]+ts[n[e+2]]+ts[n[e+3]]+"-"+ts[n[e+4]]+ts[n[e+5]]+"-"+ts[n[e+6]]+ts[n[e+7]]+"-"+ts[n[e+8]]+ts[n[e+9]]+"-"+ts[n[e+10]]+ts[n[e+11]]+ts[n[e+12]]+ts[n[e+13]]+ts[n[e+14]]+ts[n[e+15]]}function NW(n){if(!FW(n))throw TypeError("Invalid UUID");let e;const t=new Uint8Array(16);return t[0]=(e=parseInt(n.slice(0,8),16))>>>24,t[1]=e>>>16&255,t[2]=e>>>8&255,t[3]=e&255,t[4]=(e=parseInt(n.slice(9,13),16))>>>8,t[5]=e&255,t[6]=(e=parseInt(n.slice(14,18),16))>>>8,t[7]=e&255,t[8]=(e=parseInt(n.slice(19,23),16))>>>8,t[9]=e&255,t[10]=(e=parseInt(n.slice(24,36),16))/1099511627776&255,t[11]=e/4294967296&255,t[12]=e>>>24&255,t[13]=e>>>16&255,t[14]=e>>>8&255,t[15]=e&255,t}function zW(n){n=unescape(encodeURIComponent(n));const e=[];for(let t=0;t<n.length;++t)e.push(n.charCodeAt(t));return e}const GW="6ba7b810-9dad-11d1-80b4-00c04fd430c8",VW="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function HW(n,e,t){function i(s,r,o,a){var l;if(typeof s=="string"&&(s=zW(s)),typeof r=="string"&&(r=NW(r)),((l=r)===null||l===void 0?void 0:l.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let c=new Uint8Array(16+s.length);if(c.set(r),c.set(s,r.length),c=t(c),c[6]=c[6]&15|e,c[8]=c[8]&63|128,o){a=a||0;for(let u=0;u<16;++u)o[a+u]=c[u];return o}return UW(c)}try{i.name=n}catch{}return i.DNS=GW,i.URL=VW,i}function QW(n,e,t,i){switch(n){case 0:return e&t^~e&i;case 1:return e^t^i;case 2:return e&t^e&i^t&i;case 3:return e^t^i}}function lw(n,e){return n<<e|n>>>32-e}function WW(n){const e=[1518500249,1859775393,2400959708,3395469782],t=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof n=="string"){const o=unescape(encodeURIComponent(n));n=[];for(let a=0;a<o.length;++a)n.push(o.charCodeAt(a))}else Array.isArray(n)||(n=Array.prototype.slice.call(n));n.push(128);const i=n.length/4+2,s=Math.ceil(i/16),r=new Array(s);for(let o=0;o<s;++o){const a=new Uint32Array(16);for(let l=0;l<16;++l)a[l]=n[o*64+l*4]<<24|n[o*64+l*4+1]<<16|n[o*64+l*4+2]<<8|n[o*64+l*4+3];r[o]=a}r[s-1][14]=(n.length-1)*8/Math.pow(2,32),r[s-1][14]=Math.floor(r[s-1][14]),r[s-1][15]=(n.length-1)*8&4294967295;for(let o=0;o<s;++o){const a=new Uint32Array(80);for(let p=0;p<16;++p)a[p]=r[o][p];for(let p=16;p<80;++p)a[p]=lw(a[p-3]^a[p-8]^a[p-14]^a[p-16],1);let l=t[0],c=t[1],u=t[2],d=t[3],f=t[4];for(let p=0;p<80;++p){const g=Math.floor(p/20),A=lw(l,5)+QW(g,c,u,d)+f+e[g]+a[p]>>>0;f=d,d=u,u=lw(c,30)>>>0,c=l,l=A}t[0]=t[0]+l>>>0,t[1]=t[1]+c>>>0,t[2]=t[2]+u>>>0,t[3]=t[3]+d>>>0,t[4]=t[4]+f>>>0}return[t[0]>>24&255,t[0]>>16&255,t[0]>>8&255,t[0]&255,t[1]>>24&255,t[1]>>16&255,t[1]>>8&255,t[1]&255,t[2]>>24&255,t[2]>>16&255,t[2]>>8&255,t[2]&255,t[3]>>24&255,t[3]>>16&255,t[3]>>8&255,t[3]&255,t[4]>>24&255,t[4]>>16&255,t[4]>>8&255,t[4]&255]}const jW=HW("v5",80,WW),SP=jW;en.registerCallback(Qn.ContextCreated,n=>{const e=n.context;JW(e),XW(e)});const f0=re("debugcomponents"),CP="eff8ba80-635d-11ec-90d6-0242ac120003";class Ws{constructor(e){h(this,"_originalSeed");h(this,"_seed");typeof e=="string"&&(e=Ws.hash(e)),this._originalSeed=e,this._seed=e}get seed(){return this._seed}set seed(e){this._seed=e}reset(){this._seed=this._originalSeed}generateUUID(e){if(typeof e=="string")return SP(e,CP);const t=this._seed;return this._seed-=1,SP(t.toString(),CP)}initialize(e){typeof e=="string"?this._seed=Ws.hash(e):this._seed=e}static createFromString(e){return new Ws(this.hash(e))}static hash(e){let t=0;for(let i=0;i<e.length;i++)t=e.charCodeAt(i)+((t<<5)-t);return t}}var Iu;(function(n){n.NewInstanceCreated="new-instance-created",n.InstanceDestroyed="instance-destroyed"})(Iu||(Iu={}));class b2{constructor(e){h(this,"guid");this.guid=e}}function YM(n,e,t=!0){if(!n)return;const i=n;if(Zc(n,t),!e){console.warn("Can not send destroy: No networking connection provided",n.guid);return}if(!e.isConnected){console.warn("Can not send destroy: not connected",n.guid);return}let s=n.guid;if(!s&&i.uuid&&(s=i.uuid),!s){console.warn("Can not send destroy: failed to find guid",n);return}const r=new b2(s);e.send(Iu.InstanceDestroyed,r,Tr.Queued)}function qW(n,e){const t=new b2(n);e.send(Iu.InstanceDestroyed,t,Tr.Queued)}function XW(n){n.connection.beginListen(Iu.InstanceDestroyed,e=>{f0&&console.log("[Remote] Destroyed",n.scene,e);const t=h_(e.guid,n.scene);t&&Zc(t)})}class YW{constructor(e,t){h(this,"guid");h(this,"originalGuid");h(this,"seed");h(this,"visible");h(this,"hostData");h(this,"dontSave");h(this,"parent");h(this,"position");h(this,"rotation");h(this,"scale");this.originalGuid=e,this.guid=t}}function _2(n,e,t,i){var l;const s=n;if(!s.guid)return console.warn("Can not instantiate: No guid",s),null;if(e.context||(e.context=Lt.Current),!e.context)return console.error("Missing network instantiate options / reference to network connection in sync instantiate"),null;const r=e?{...e}:null,{instance:o,seed:a}=KW(s,e);if(o){const c=o;if(c.guid){f0&&console.log("[Local] new instance","gameobject:",o==null?void 0:o.guid);const u=new YW(s.guid,c.guid);u.seed=a,r&&(r.position&&(u.position={x:r.position.x,y:r.position.y,z:r.position.z}),r.rotation&&(u.rotation={x:r.rotation.x,y:r.rotation.y,z:r.rotation.z,w:r.rotation.w}),r.scale&&(u.scale={x:r.scale.x,y:r.scale.y,z:r.scale.z})),u.position||(u.position={x:c.position.x,y:c.position.y,z:c.position.z}),u.rotation||(u.rotation={x:c.quaternion.x,y:c.quaternion.y,z:c.quaternion.z,w:c.quaternion.w}),u.scale||(u.scale={x:c.scale.x,y:c.scale.y,z:c.scale.z}),u.visible=s.visible,r!=null&&r.parent&&(typeof r.parent=="string"?u.parent=r.parent:u.parent=r.parent.guid),u.hostData=t,i===!1&&(u.dontSave=!0),(l=e==null?void 0:e.context)==null||l.connection.send(Iu.NewInstanceCreated,u)}else console.warn("Missing guid, can not send new instance event",c)}return o}function JM(){return Math.random()*9999999}function JW(n){n.connection.beginListen(Iu.NewInstanceCreated,async e=>{const t=await $W(e.originalGuid,n.scene);if(!t){console.warn("could not find object that was instantiated: "+e.guid);return}const i=new Hl;e.position&&(i.position=new w(e.position.x,e.position.y,e.position.z)),e.rotation&&(i.rotation=new Se(e.rotation.x,e.rotation.y,e.rotation.z,e.rotation.w)),e.scale&&(i.scale=new w(e.scale.x,e.scale.y,e.scale.z)),i.parent=e.parent,e.seed&&(i.idProvider=new Ws(e.seed)),i.visible=e.visible,i.context=n,f0&&n.alias&&console.log("[Remote] instantiate in: "+n.alias);const s=u_(t,i);s&&(e.parent==="scene"&&n.scene.add(s),f0&&console.log("[Remote] new instance","gameobject:",s==null?void 0:s.guid,t))})}function KW(n,e){const t=JM(),i=e??new Hl;i.idProvider=new Ws(t);const s=u_(n,i);return{seed:t,instance:s}}const x2={};function ZW(n,e){x2[n]=e}async function $W(n,e){const t=x2[n];if(t!=null){const i=await t(n);if(i)return i}return w2(n,e)}function w2(n,e){if(e===null||!n)return null;if(e.guid===n)return e;if(e.children)for(const t of e.children){const i=w2(n,t);if(i)return i}return null}const S2=new Map;function ej(n,e){if(!n)return;if(!e){console.warn("No prototype found",n,n.prototype,n.constructor);return}const t=S2.get(e);t&&t.apply(n)}function tj(n){const e=ij(n.prototype);S2.set(n,e)}function ij(n){return new nj(n)}class nj{constructor(e){h(this,"$symbol");h(this,"extensions");h(this,"descriptors");this.$symbol=Symbol("prototype-extension"),this.extensions=Object.keys(e),this.descriptors=new Array;for(let t=0;t<this.extensions.length;t++){const i=this.extensions[t],s=Object.getOwnPropertyDescriptor(e,i);s&&this.descriptors.push(s)}}apply(e){if(!e[this.$symbol]){e[this.$symbol]=!0;for(let t=0;t<this.extensions.length;t++){const i=this.extensions[t],s=this.descriptors[t];s&&Object.defineProperty(e,i,s)}}}}var Em;(function(n){n.Added="component-added",n.Removing="removing-component"})(Em||(Em={}));const EP=re("debugcomponentevents");class r_{static addComponentLifecylceEventListener(e,t){this.eventListeners.has(e)&&this.eventListeners.set(e,[]);let i=this.eventListeners.get(e);i||(i=[]),i.push(t),this.eventListeners.set(e,i),EP&&console.log("Added event listener for "+e,this.eventListeners)}static removeComponentLifecylceEventListener(e,t){const i=this.eventListeners.get(e);if(!i)return;const s=i.indexOf(t);s<0||i.splice(s,1)}static dispatchComponentLifecycleEvent(e,t){const i=this.eventListeners.get(e);if(EP&&console.log("Dispatching event "+e,i),!!i)for(const s of i)s(t)}}h(r_,"eventListeners",new Map);const cw=re("debuggetcomponent");function sj(n){return n==null||n.isObject3D?n:n.object&&n.object.isObject3D?n.object:n}function C2(n,e){if(!n||!n.userData.components)return;const t=n.userData.components.indexOf(e);t<0||(r_.dispatchComponentLifecycleEvent(Em.Removing,e),e.gameObject=null,n.userData.components.splice(t,1))}function KM(n,e){const t=rA(n,e);if(t)return t;const i=new e;return zu(n,i)}const E2=new Ws("addComponentIdProvider");function zu(n,e,t=!0){n.userData||(n.userData={}),n.userData.components||(n.userData.components=[]),n.userData.components.push(e),e.gameObject=n,(e.guid===void 0||e.guid==="invalid")&&(e.guid=E2.generateUUID()),$M(n),dT(e);try{t&&e.__internalAwake&&(Dg(n),e.activeAndEnabled&&e.__internalAwake()),r_.dispatchComponentLifecycleEvent(Em.Added,e)}catch(i){console.error(i)}return e}function M2(n,e){if(typeof e=="function")return zu(n,new e);if(e.gameObject===n)return e;if(e.gameObject&&e.gameObject.userData.components){const t=e.gameObject.userData.components.indexOf(e);e.gameObject.userData.components.splice(t,1)}if(!n.userData.components)n.userData.components=[];else if(n.userData.components.includes(e))return e;return n.userData.components.push(e),e.gameObject=n,(e.guid===void 0||e.guid==="invalid")&&(e.guid=E2.generateUUID()),dT(e),e}function rj(n){if(n.gameObject&&n.gameObject.userData.components){const e=n.gameObject.userData.components.indexOf(n);n.gameObject.userData.components.splice(e,1)}n.__internalDisable&&n.__internalDisable(),Tc(n,n.context??Lt.Current),n.destroy(),n.gameObject=null}let MP=!1;function T2(n,e,t){var i;if(n==null)return null;if(!n.isObject3D)return console.error("Object is not object3D"),null;if(!((i=n==null?void 0:n.userData)!=null&&i.components)||(typeof e=="string"&&(MP||(MP=!0,console.warn(`Accessing components by name is not supported.
Please use the component type instead. This may keep working in local development but it will fail when bundling your application.

You can import other modules your main module to get access to types
or if you use npmdefs you can make types available globally using globalThis:
https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/globalThis`,e))),cw&&console.log("FIND",e),e==null))return null;for(let s=0;s<n.userData.components.length;s++){const r=n.userData.components[s];if(e===null||r.constructor.name===e.name||r.constructor.name===e)if(cw&&console.log("MATCH BY NAME",r),t)t.push(r);else return r}for(let s=0;s<n.userData.components.length;s++){const r=n.userData.components[s];let o=Object.getPrototypeOf(r.constructor);do{if(o===e)if(cw&&console.log("MATCH BY PROTOYPE",o),t)t.push(r);else return r;o=Object.getPrototypeOf(o)}while(o)}return t||null}function rA(n,e){return T2(n,e)}function o_(n,e,t){return t||(t=[]),T2(n,e,t),t}function a_(n,e,t){var s;const i=rA(n,e);if(t===!1&&(i==null?void 0:i.enabled)===!1)return null;if(i)return i;for(let r=0;r<((s=n==null?void 0:n.children)==null?void 0:s.length);r++){const o=a_(n.children[r],e);if(o)return o}return null}function l_(n,e,t){var i;t||(t=[]),o_(n,e,t);for(let s=0;s<((i=n==null?void 0:n.children)==null?void 0:i.length);s++)l_(n.children[s],e,t);return t}function p0(n,e){if(!n)return null;if(Array.isArray(n)){for(let i=0;i<n.length;i++){const s=sj(n[i]),r=p0(s,e);if(r)return r}return null}const t=rA(n,e);return t||(n.parent?p0(n.parent,e):null)}function ZM(n,e,t){return t||(t=[]),n?(o_(n,e,t),n.parent?ZM(n.parent,e,t):t):t}function oj(n,e,t){if(!n)return null;if(!e&&(e=Lt.Current,!e))return console.error("Can not search object without any needle context or scene!!!"),null;let i=e;if(i.isScene||(i=e==null?void 0:e.scene),!i)return null;for(const s in i.children){const r=i.children[s];if(t===!1&&r[zc]===!1)continue;if(r.constructor==n)return r;const o=a_(r,n);if(o)return o}return null}function aj(n,e,t){if(!n)return e;if(!t&&(t=Lt.Current,!t))return console.error("Can not search object without any needle context or scene!!!"),e;const i=t.isScene===!0||t.isObject3D===!0?t:t==null?void 0:t.scene;if(!i)return e;for(const s in i.children){const r=i.children[s];if(r.constructor==n)return r;l_(r,n,e)}return e}function $M(n){n&&n.isObject3D===!0&&ej(n,Me)}Me.prototype.SetActive=function(n){this.visible=n};Me.prototype.setActive=function(n){this.visible=n};Me.prototype.destroy=function(){Zc(this)};Me.prototype.addComponent=function(n){return M2(this,n)};Me.prototype.addNewComponent=function(n){return zu(this,new n)};Me.prototype.removeComponent=function(n){return C2(this,n)};Me.prototype.getOrAddComponent=function(n){return KM(this,n)};Me.prototype.getComponent=function(n){return rA(this,n)};Me.prototype.getComponents=function(n,e){return o_(this,n,e)};Me.prototype.getComponentInChildren=function(n){return a_(this,n)};Me.prototype.getComponentsInChildren=function(n,e){return l_(this,n,e)};Me.prototype.getComponentInParent=function(n){return p0(this,n)};Me.prototype.getComponentsInParent=function(n,e){return ZM(this,n,e)};Object.getOwnPropertyDescriptor(Me.prototype,"activeSelf")||Object.defineProperty(Me.prototype,"activeSelf",{get:function(){return aA(this)},set:function(n){Dy(this,n)}});Object.getOwnPropertyDescriptor(Me.prototype,"transform")||Object.defineProperty(Me.prototype,"transform",{get:function(){return this}});tj(Me);const Mm=Symbol("NEEDLE_NEED_UPDATE_INSTANCE"),I2=Symbol("isUsingInstancing");class Fr{static isUsingInstancing(e){return e[I2]===!0}static markDirty(e,t=!0){if(e&&(this.isUsingInstancing(e)&&(e[Mm]=!0,e.matrixWorldNeedsUpdate=!0),t))for(const i of e.children)Fr.markDirty(i,!0)}}const oA=re("gizmos"),ws=re("debugextension"),g0=re("debugresolvedependencies"),lj=["/extensions/","extensions/"],cj=[{prefix:"/nodes/",dependencyName:"node"},{prefix:"/meshes/",dependencyName:"mesh"},{prefix:"/materials/",dependencyName:"material"},{prefix:"/textures/",dependencyName:"texture"},{prefix:"/animations/",dependencyName:"animation"},{prefix:"nodes/",dependencyName:"node"},{prefix:"meshes/",dependencyName:"mesh"},{prefix:"materials/",dependencyName:"material"},{prefix:"textures/",dependencyName:"texture"},{prefix:"animations/",dependencyName:"animation"}];async function eT(n,e){g0&&console.log(n,e);const t=[];IC(cj,n,e,t);const i=await Promise.all(t);return typeof e=="string"&&i.length===1?i[0]:i}function IC(n,e,t,i){if(typeof t=="object"&&t!==void 0&&t!==null)for(const s of Object.keys(t)){const r=t[s];if(typeof r=="string"){const o=TP(e,r);if(o!=null)typeof o.then=="function"?i.push(o.then(a=>t[s]=a)):t[s]=o;else for(const a of n){const l=RC(a.prefix,r);if(l>=0){g0&&console.log(a,l,a.dependencyName),i.push(e==null?void 0:e.getDependency(a.dependencyName,l).then(c=>(t[s]=c,c)));break}}}else if(Array.isArray(r))for(let o=0;o<r.length;o++){const a=r[o],l=TP(e,a);if(l!==null){typeof l.then=="function"?i.push(l.then(c=>r[o]=c)):r[o]=l;continue}for(const c of n){const u=RC(c.prefix,a);if(u>=0){g0&&console.log(c,u,c.dependencyName),i.push(e==null?void 0:e.getDependency(c.dependencyName,u).then(d=>r[o]=d));break}}typeof a=="object"&&IC(n,e,a,i)}else typeof r=="object"&&IC(n,e,r,i)}else typeof t=="string"&&hj(n,e,t,i)}function TP(n,e){if(n&&n.plugins&&typeof e=="string"){for(const t of lj)if(e.startsWith(t)){let i=e.substring(t.length);const s=i.indexOf("/");s>=0&&(i=i.substring(0,s));const r=n.plugins[i];if(ws&&console.log(i,r),typeof(r==null?void 0:r.resolve)=="function"){const o=e.substring(t.length+i.length+1);return r.resolve(n,o)}break}}return null}function hj(n,e,t,i){for(const s of n){const r=RC(s.prefix,t);if(r>=0)return g0&&console.log(s,r,s.dependencyName),i.push(e==null?void 0:e.getDependency(s.dependencyName,r).then(o=>o)),!0}return!1}function RC(n,e){if(typeof e=="string"&&e.startsWith(n)){const t=e.substring(n.length),i=Number.parseInt(t);if(i>=0)return i}return-1}const IP=re("debugtypes");class uj{constructor(){h(this,"_types",{})}add(e,t){IP&&console.warn("ADD TYPE",e);const i=this._types[e];i===void 0?this._types[e]=t:IP&&i!==t&&console.warn("Type name exists multiple times in your project and may lead to runtime errors:",e)}get(e){return this._types[e]}}const dj=Symbol("BuiltInType"),q=new uj,hw="NEEDLE_persistent_assets";function fj(n){return(n==null?void 0:n.___persistentAsset)===!0}class pj{constructor(e){h(this,"parser");this.parser=e}get name(){return hw}async afterRoot(e){var s,r;if(!((r=(s=this.parser)==null?void 0:s.json)!=null&&r.extensions))return;const t=this.parser.json.extensions[hw];if(!t)return;ws&&console.log(t);const i=new Array;for(const o of t==null?void 0:t.assets){const a=eT(this.parser,o);a&&i.push(a)}await Promise.all(i)}resolve(e,t){const i=Number.parseInt(t);if(i>=0){ws&&console.log(t);const s=e.json.extensions[hw];if(s){const r=s==null?void 0:s.assets[i];if(r&&typeof r=="object"){r.___persistentAsset=!0;const o=r.__type;o&&q.get(o)}return r}}return null}}const Al=re("debugserializer");class gj{constructor(){h(this,"typeMap",{})}register(e,t){if(this.typeMap[e]!==void 0){if(this.typeMap[e]===t)return;console.warn("Type "+e+" is already registered",t,this.typeMap[e])}Al&&console.log("Register type serializer for "+e,t),this.typeMap[e]=t}getSerializer(e){if(e)return this.typeMap[e]}getSerializerForConstructor(e,t=0){var l;if(t>20)return;if(!e||!e.constructor){Al&&console.log("invalid type");return}const i=e.name??((l=e.constructor)==null?void 0:l.name);if(!i){Al&&console.log("invalid name",i);return}const s=this.getSerializer(i);if(s!==void 0)return Al&&console.log("FOUND "+i,e.name,e.constructor.name,s,this.typeMap),s;const r=Object.getPrototypeOf(e);if(!(r.prototype||r.constructor)){Al&&console.warn("No prototype for "+i,e,e.name,e.prototype,e.constructor.name);return}const a=r.prototype??r.constructor;if(a!==e){const c=this.getSerializerForConstructor(a,++t);if(c){Al&&console.log("FOUND "+a.constructor.name,a.name,a,c);const u=a.name??a.constructor.name;u==="Function"?console.error("Registering Function is not allowed, something went wrong",e,a,c):this.register(u,c)}return c}}}const m0=new gj;class hh{constructor(e){if(Array.isArray(e))for(const t of e)m0.register(t.name,this);else m0.register(e.name,this)}}class mj{constructor(){h(this,"isDevMode",Ar());h(this,"cache",{})}registerDefinedKeys(e,t){this.isDevMode&&this.cache[e]===void 0&&(this.cache[e]=Object.keys(t))}getDefinedKey(e,t){return this.cache[e]===void 0?!1:this.cache[e].includes(t)}}class R2{constructor(e){h(this,"root");h(this,"gltf");h(this,"gltfId");h(this,"object");h(this,"target");h(this,"nodeId");h(this,"nodeToObject");h(this,"objectToNode");h(this,"context");h(this,"path");h(this,"type");h(this,"serializable");h(this,"implementationInformation");this.root=e}}function Aj(n,e){const t=n.$serializedTypes;if(t===void 0)return null;const i={};for(const s in t){const r=n[s];if(r!=null&&typeof r=="object"){const o=m0.getSerializerForConstructor(r);if(o){i[s]=o.onSerialize(r,e);continue}}i[s]=r}return i.name=n.constructor.name,typeof n.guid=="string"&&(i.guid=n.guid),i}const Ry=[];function P2(n,e){if(!n)return e;typeof n.$serializedTypes=="object"&&(e||(e={}),Object.assign(e,n.$serializedTypes));const t=Object.getPrototypeOf(n);return P2(t,e)}function PC(n,e,t){if(!n)return!1;if(t.target=n,n.onBeforeDeserialize!==void 0){const s=n.onBeforeDeserialize(e,t);if(typeof s=="boolean")return s}const i=P2(n);if(e){if(typeof e.guid=="string"&&(n.guid=e.guid),i)for(const s in i){let a=function(l){const u=l.type;return u?BC(o,u,t,void 0,n[s]):BC(o,l,t,void 0,n[s])};const r=i[s],o=e[s];if(Al&&console.log(s,o,n,r),!(n[s]!==void 0&&o===void 0)&&(t.type=void 0,t.path=s,t.serializable=r,!(n.onBeforeDeserializeMember!==void 0&&n.onBeforeDeserializeMember(s,o,t)===!0))){if(r===null)n[s]=o;else{if(Array.isArray(r))for(let l=0;l<r.length;l++){const c=r[l],u=a(c);if(u!==void 0||l===r.length-1){n[s]=u;break}}else n[s]=a(r);Ry.length=0}n.onAfterDeserializeMember!==void 0&&n.onAfterDeserializeMember(s,o,t)}}bj(n,e)}return yj(n,e,t.implementationInformation),n.onAfterDeserialize!==void 0&&n.onAfterDeserialize(e,t),t.path=void 0,!0}const vj=re("noerrors");function yj(n,e,t){var r;if(vj||!e||Ar()===!1||!n||n.constructor&&n.constructor[dj]===!0)return;const i=(r=n.constructor)==null?void 0:r.name,s=Object.getOwnPropertyNames(e);for(const o of s){if(o==="sourceId")continue;const a=n[o];if(a==null)continue;const l=e[o];if((t==null?void 0:t.getDefinedKey(i,o))===!1){const c=o.charAt(0).toUpperCase()+o.slice(1);t.getDefinedKey(i,c)&&(Nc(jn.Warn,'<strong>Please rename</strong> "'+c+'" to "'+o+'" in '+i),console.warn('Please use lowercase for field: "'+c+'" in '+i,l,n));continue}if(l!=null){if(typeof l=="object"&&(a===void 0||!a.isObject3D)&&(typeof l.node=="number"||typeof l.guid=="string")){if(l.could_not_resolve)continue;if(!(a!==void 0&&Object.keys(a).length>1)){Nc(jn.Warn,`<strong>Missing serialization for object reference!</strong>

Please change to: 
@serializable(Object3D)
${o}? : Object3D;

in script ${i}.ts
<a href="https://docs.needle.tools/serializable" target="_blank">documentation</a>`),console.warn(i,o,n[o],n);continue}}if(typeof a=="string"&&(l.endsWith(".gltf")||l.endsWith(".glb"))){Nc(jn.Warn,`<strong>Missing serialization for object reference!</strong>

Please change to: 
@serializable(AssetReference)
${o}? : AssetReference;

in script ${i}.ts
<a href="https://docs.needle.tools/serializable" target="_blank">documentation</a>`),console.warn(i,o,n[o],n);continue}}}}function bj(n,e){for(const t of Object.keys(e)){const i=e[t];if(typeof i=="object"&&i!==null&&i!==void 0){const s=n[t];if(!s){Al&&console.log(t,"is undefined on",n);continue}for(const r of Object.keys(i))if(s[r]===void 0&&RP(i[r])&&!RP(s)){const a=_j(s,r);if(a&&((a==null?void 0:a.writable)===void 0||(a==null?void 0:a.writable)===!1)&&a.set===void 0){Al&&console.warn('Property is not writable "'+r+'"',s,a,i[r],s[r]);continue}s[r]=i[r]}}}}function _j(n,e){for(;n;){const t=Object.getOwnPropertyDescriptor(n,e);if(t)return t;n=Object.getPrototypeOf(n)}}function RP(n){switch(typeof n){case"number":case"string":case"boolean":return!0}return!1}function BC(n,e,t,i,s){let r=typeof e=="function"&&e.prototype===void 0,o=e;if(r)try{if(o=e==null?void 0:e.call(e,s),r=!1,o==null)return}catch(u){console.error("Error in callback",u,n)}if(t.type=o,!r&&s instanceof o)return s;if(s&&typeof s=="object"&&fj(s)){if(s.__concreteInstance)return s.__concreteInstance;const u=s;if(!u.$serializedTypes&&o.prototype.$serializedTypes&&(u.$serializedTypes=o.prototype.$serializedTypes),u.$serializedTypes&&PC(u,n,t),s&&o!==void 0)try{const d=new o;ws&&console.log("Create concrete instance for persistent asset",s,"instance:",d),Ff(d,s),s.__concreteInstance=d,s=d}catch(d){console.error("Error creating instance or creating values on instance",d,s,o)}return s}if(i||(i={serializer:m0.getSerializerForConstructor(o)}),Array.isArray(n)){const u=[];for(let d=0;d<n.length;d++){const f=n[d],p=BC(f,e,t,i,f);u.push(p)}return u}const a=i.serializer;if(a)return a.onDeserialize(n,t);let l;if(n&&(n.isMaterial||n.isTexture||n.isObject3D))l=n;else{if(n===void 0)return;if(n===null&&(o===Pt||o===Rt||o===ye||o===fr))return null;l=new o(...xj(n))}const c=l;return c.$serializedTypes&&PC(c,n,t),l}function xj(n){if(Ry.length=0,typeof n=="object"&&n!==null&&n!==void 0)for(const e of Object.keys(n))Ry.push(n[e]);return Ry}const DC=Symbol("assigned component properties");function Ff(n,e,t){var s;if(e==null||n==null)return;n[DC]=!0;const i=((s=n.constructor)==null?void 0:s.name)??"unknown";t==null||t.registerDefinedKeys(i,n);for(const r of Object.keys(e)){const o=wj(n,r);typeof(o==null?void 0:o.value)!="function"&&(!o||o.writable===!0||(o==null?void 0:o.set)!==void 0)&&(n[r]=e[r])}delete n[DC]}function wj(n,e){let t;do t=Object.getOwnPropertyDescriptor(n,e);while(!t&&(n=Object.getPrototypeOf(n)));return t}const PP=Symbol("gltf-loader-internal-usage-tracker"),Sj=re("debugusers"),nm=class{constructor(e){h(this,"parser");h(this,"_getDependency");h(this,"_loadingId");h(this,"_loadedObjects",new Set);this.parser=e,this._getDependency=this.parser.getDependency,this._loadingId=Date.now().toString()}get name(){return"NEEDLE_internal_usage_tracker"}static isLoading(e){return nm._loadingProcesses>0}beforeRoot(){nm._loadingProcesses++;const e=this,t=this._getDependency;return this.parser.getDependency=function(i,s){const r=t.call(this,i,s);return r.then(o=>(o&&(e._loadedObjects.add(o),o[PP]=e._loadingId),o)),r},null}afterRoot(e){nm._loadingProcesses--,this.parser.getDependency=this._getDependency;for(const t of this._loadedObjects)delete t[PP],t instanceof Me&&(t.parent||t instanceof ye&&(Sj&&console.warn("> GLTF LOADER: Mesh not used in scene!",t),t.material=null,t.geometry=null));return null}};let Bg=nm;h(Bg,"_loadingProcesses",0);const Cj=re("debugpatch");function tT(n,e,t,i){const s=Cj===e;if(!t&&!i)return;const r=e+"___needle";Ej(n,e,t,i);const o=Object.getOwnPropertyDescriptor(n,e),a=n[e];s&&console.log("Patch",n.constructor.name,e,o,a),o?(s&&console.log("Apply patch with existing descriptor",n.constructor.name,e,o),typeof o.value=="function"&&(n[e]=DP(o.value,n,e))):(s&&console.log("Create patch with new property",n.constructor.name,e,o),Object.defineProperty(n,e,{set:function(l){if(typeof l=="function")this[r]=DP(l,n,e);else{const c=this[r];D2(n,e,this,c,l),this[r]=l,O2(n,e,this,c,l)}},get:function(){const l=this[r];return typeof l=="function"&&l[r]?l[r]:l}}))}const BP=Symbol("Needle:Patches:WrappedFunction");function DP(n,e,t){if(n[BP])return n;const i=function(...s){D2(e,t,this,...s);const r=n.apply(this,s);return O2(e,t,this,r,...s),r};return i[BP]=!0,i}const uw="Needle:Patches";function OC(){return globalThis[uw]||(globalThis[uw]=new WeakMap),globalThis[uw]}function B2(n,e){const t=OC().get(n);return t?t.get(e):null}function Ej(n,e,t,i){let s=OC().get(n);s||(s=new Map,OC().set(n,s));let r=s.get(e);r||(r=[],s.set(e,r)),r.push({prefix:t,postfix:i})}function D2(n,e,t,...i){var r;if(!t)return;const s=B2(n,e);if(s)for(const o of s)(r=o.prefix)==null||r.call(t,...i)}function O2(n,e,t,i,...s){var o;if(!t)return;const r=B2(n,e);if(r)for(const a of r)(o=a.postfix)==null||o.call(t,i,...s)}class Mj{constructor(){window.addEventListener("unhandledrejection",e=>{var i;if(e.defaultPrevented)return;const t=(i=e==null?void 0:e.reason)==null?void 0:i.path;if(t){const s=t[0];s&&s.tagName==="IMG"&&(console.warn(`Could not load image:
`+s.src),e.preventDefault())}})}}const c_=re("trackresources");function k2(){return c_==="dispose"}let tp=!0;c_===0&&(tp=!1);function Tj(){return tp}const L2=Symbol("disposable");function F2(n,e){n&&(n[L2]=e,mu&&console.warn("Set disposable",e,n))}const Ij=Symbol("disposed");function Bi(n){var e;if(n){if(n[L2]===!1){mu&&console.warn("Object is marked as not disposable",n);return}if(n[Ij]=!0,n instanceof mr)Bi(n.environment),Bi(n.background),Bi(n.customDepthMaterial),Bi(n.customDistanceMaterial);else if(n instanceof Yf)Bi(n.geometry),Bi(n.material),Bi(n.skeleton),Bi(n.bindMatrix),Bi(n.bindMatrixInverse),Bi(n.customDepthMaterial),Bi(n.customDistanceMaterial),n.geometry=null,n.material=null;else if(n instanceof ye)Bi(n.geometry),Bi(n.material),Bi(n.customDepthMaterial),Bi(n.customDistanceMaterial),n.geometry=null,n.material=null;else if(n instanceof ft){Sd(n);for(const t of Object.keys(n.attributes)){const i=n.attributes[t];Bi(i)}}else if(n instanceof ot||n instanceof Gl)mu&&console.warn("BufferAttribute dispose not supported",n.count);else if(n instanceof Array)for(const t of n)t instanceof Pt&&Bi(t);else if(n instanceof Pt){Sd(n);for(const i of Object.keys(n)){const s=n[i];s instanceof Rt&&(Bi(s),n[i]=null)}const t=n.uniforms;if(t)for(const i of Object.keys(t)){const s=t[i];s instanceof Rt?(Bi(s),t[i]=null):s instanceof xe&&(Bi(s.value),s.value=null)}}else n instanceof Rt?(Sd(n),Sd(n.source),((e=n.source)==null?void 0:e.data)instanceof ImageBitmap&&Sd(n.source.data)):n instanceof Jf?(Sd(n.boneTexture),n.boneTexture=null):n instanceof eA||!(n instanceof Me)&&mu&&console.warn("Unknown object type",n)}}function Sd(n){n&&((mu||k2()||c_)&&console.warn(" FREE",n),n instanceof ImageBitmap?n.close():n instanceof Sl?n.data=null:n.dispose())}function Rj(n){(n instanceof ye||n instanceof Yf)&&(n.material=null,n.geometry=null)}const Pj=new Set;function U2(n,e,t=null,i){if(i||(i=Pj,i.clear()),!n)return i;const s=n[Tm];if(s)for(const r of s)i.has(r)||(t==null?void 0:t.call(null,r))!==!1&&(i.add(r),e&&U2(r,!0,t,i));return i}const mu=re("debugresourceusers")||re("debugmemory"),Tm=Symbol("needle-resource-users"),Lv=Symbol("needle-resource-users-count");function Ls(n,e){tT(n,e,function(t,i){tp&&(A0(Tm,this,t,!1),A0(Tm,this,i,!0))})}tp&&(Ls(ye.prototype,"material"),Ls(ye.prototype,"geometry"),Ls(Pt.prototype,"map"),Ls(Pt.prototype,"bumpMap"),Ls(Pt.prototype,"alphaMap"),Ls(Pt.prototype,"normalMap"),Ls(Pt.prototype,"displacementMap"),Ls(Pt.prototype,"roughnessMap"),Ls(Pt.prototype,"metalnessMap"),Ls(Pt.prototype,"emissiveMap"),Ls(Pt.prototype,"specularMap"),Ls(Pt.prototype,"envMap"),Ls(Pt.prototype,"lightMap"),Ls(Pt.prototype,"aoMap"),Ls(Pt.prototype,"gradientMap"));function Bj(n){if(tp===!1)return;const e=n[Tm];if(e)for(const t of e)A0(Tm,t,n,!1)}tp&&tT(Pt.prototype,"dispose",function(){Bj(this)});let kC=0;function A0(n,e,t,i){if(kC>0)return;if(Array.isArray(t)){for(const r of t)A0(n,e,r,i);return}if(!t)return;let s=t[n];if(s||(s=new Set),i){if(e&&!s.has(e)){s.add(e);let r=t[Lv]||0;r+=1,t[Lv]=r,mu&&console.warn(` Added user of "${t.type}"`,e,t,r,"users:",s)}}else if(e&&s.has(e)){s.delete(e);let r=t[Lv]||0;r>0&&(r-=1,t[Lv]=r),mu&&console.warn(` Removed user of "${t.type}"`,e,t,r,"users:",s),r<=0&&(Bg.isLoading(t)||(c_&&console.warn(` Removed all user of "${t.type}"`,t),k2()&&Bi(t)))}t[n]=s}try{tT(oh.prototype,"render",function(){kC++},function(){kC--})}catch(n){console.warn("Could not wrap WebGLRenderer.render",n)}const Py=re("debuggetcomponent"),By=re("debuginstantiate");var OP;(function(n){n[n.None=0]="None",n[n.HideInHierarchy=1]="HideInHierarchy",n[n.HideInInspector=2]="HideInInspector",n[n.DontSaveInEditor=4]="DontSaveInEditor",n[n.NotEditable=8]="NotEditable",n[n.DontSaveInBuild=16]="DontSaveInBuild",n[n.DontUnloadUnusedAsset=32]="DontUnloadUnusedAsset",n[n.DontSave=52]="DontSave",n[n.HideAndDontSave=61]="HideAndDontSave"})(OP||(OP={}));class Hl{constructor(){h(this,"idProvider");h(this,"parent");h(this,"keepWorldPosition");h(this,"position");h(this,"rotation");h(this,"scale");h(this,"visible");h(this,"context")}}function aA(n){return n.visible}function Dy(n,e){return typeof e=="number"&&(e=e>.5),n.visible=e,n.visible}function Dj(n){return n[zc]||iT(n)}function Oj(n,e){n[I2]=e}function iT(n){return Fr.isUsingInstancing(n)}function h_(n,e){return wm(n,e,!0,!0)}const N2=Symbol("isDestroyed");function nT(n){return n[N2]}function kj(n,e){n[N2]=e}function Zc(n,e=!0,t=!1){const i=[];z2(n,e,t,!0,i);for(const s of i)s.gameObject=null,s.context=null}function z2(n,e=!0,t=!1,i=!0,s){if(n==null)return;const r=n;if(r.isComponent){s.push(r);const l=r.gameObject;r.__internalDisable(),r.__internalDestroy(),r.gameObject=l;return}const o=n;if(kj(o,!0),t&&Bi(o),Rj(o),Py&&console.log(o),e&&o.children)for(const l of o.children)z2(l,e,t,!1,s);const a=o.userData.components;if(a){let l=a.length;for(let c=0;c<a.length;c++){const u=a[c];s.push(u);const d=u.gameObject;u.__internalDisable(),u.__internalDestroy(),u.gameObject=d,a.length<l&&(l=a.length,c--)}}i&&o.removeFromParent()}function v0(n,e,t=!0){return V2(n,e,t)}function*G2(n,e,t=!1,i=999,s=0){if(n!=null&&n.userData.components&&!(s>i)){for(const r of n.userData.components)e&&(r==null?void 0:r.isComponent)===!0&&r instanceof e?yield r:yield r;if(t===!0)for(const r of n.children)yield*G2(r,e,!0,i,s+1)}}function V2(n,e,t,i=0){var s;if(n){if(n.isObject3D,i>1e3){console.warn("Failed to iterate components: too many levels");return}if((s=n.userData)!=null&&s.components)for(let r=0;r<n.userData.components.length;r++){const o=n.userData.components[r];if((o==null?void 0:o.isComponent)===!0){const a=e(o);if(a!==void 0)return a}}if(t&&n.children){const r=i+1;for(let o=0;o<n.children.length;o++){const a=n.children[o];if(!a)continue;const l=V2(a,e,t,r);if(l!==void 0)return l}}}}function u_(n,e=null){if(n===null)return null;let t=null;e!==null&&(e.x!==void 0?(t=new Hl,t.position=e):t=e);let i=Lt.Current;t!=null&&t.context&&(i=t.context),Py&&i.alias&&console.log("context",i.alias),t&&!t.idProvider&&(t.idProvider=new Ws(Date.now()));const s=[],r={},o={},a=H2(i,n,t,s,r,o);a&&(Fj(r),Lj(o,r)),Py&&(pC(n,!0),pC(a,!0));const l={};for(const c in s){const u=s[c],d=u.guid;t&&t.idProvider&&(u.guid=t.idProvider.generateUUID(),l[d]=u.guid,Py&&console.log(u.name,u.guid)),dT(u,i),u.__internalNewInstanceCreated&&u.__internalNewInstanceCreated()}for(const c in s){const u=s[c];u.resolveGuids&&u.resolveGuids(l),u.enabled!==!1&&(u.enabled=!0)}return y0(i),a}function H2(n,e,t,i,s,r){var u;if(!e)return null;const o=e.userData;e.userData={};const a=e.children;e.children=[];const l=e.clone(!1);if($M(l),e.userData=o,e.children=a,s[e.uuid]={original:e,clone:l},By&&console.log("ADD",e,l),e.type==="SkinnedMesh"&&(r[e.uuid]={original:e,clone:l}),(t==null?void 0:t.visible)!==void 0&&(l.visible=t.visible),t!=null&&t.idProvider){l.uuid=t.idProvider.generateUUID();const d=l;d&&(d.guid=l.uuid)}e.animations&&e.animations.length>0&&(l.animations=[...e.animations]);const c=e.parent;if(c&&c.add(l),t!=null&&t.position?On(l,t.position):l.position.copy(e.position),t!=null&&t.rotation?_o(l,t.rotation):l.quaternion.copy(e.quaternion),t!=null&&t.scale?l.scale.copy(t.scale):l.scale.copy(e.scale),t!=null&&t.parent&&t.parent!=="scene"){let d=null;if(typeof t.parent=="string"?d=wm(t.parent,n.scene,!0):d=t.parent,d){const f=t.keepWorldPosition===!0?d.attach:d.add;f?f.call(d,l):console.error("Invalid parent object",d,"received when instantiating:",e)}else console.warn("could not find parent:",t.parent)}for(const[d,f]of Object.entries(e.userData))d!=="components"&&(l.userData[d]=f);if((u=e.userData)!=null&&u.components){const d=e.userData.components,f=[];l.userData.components=f;for(let p=0;p<d.length;p++){const g=d[p],A=new g.constructor;Ff(A,g),g[Iy]!==void 0&&(A[Iy]=g[Iy]),f.push(A),A.gameObject=l,i.push(A),r_.dispatchComponentLifecycleEvent(Em.Added,A)}}t&&(t.position=void 0,t.rotation=void 0,t.scale=void 0,t.parent=void 0);for(const d in e.children){const f=e.children[d],p=H2(n,f,t,i,s,r);p&&l.add(p)}return l}function Lj(n,e){for(const t in n){const i=n[t],s=i.original,r=s.skeleton,o=i.clone;if(!r){console.warn("Skinned mesh has no skeleton?",i);continue}const a=r.bones,l=o.skeleton.clone();o.skeleton=l,o.bindMatrix.clone().copy(s.bindMatrix),o.bindMatrixInverse.copy(s.bindMatrixInverse);const c=[];l.bones=c;for(let u=0;u<a.length;u++){const d=a[u],p=e[d.uuid].clone;c.push(p)}}for(const t in n){const i=n[t].clone;i.skeleton.update(),i.bind(i.skeleton,i.bindMatrix),i.updateMatrixWorld(!0)}}function Fj(n){var e;for(const t in n){const s=n[t].clone;if((e=s.userData)!=null&&e.components)for(let r=0;r<s.userData.components.length;r++){const o=s.userData.components[r],a=Object.entries(o);for(const[l,c]of a)if(Array.isArray(c)){const u=[];o[l]=u;for(let d=0;d<c.length;d++){const f=c[d];if(typeof f!="object"){u.push(f);continue}const p=kP(o,l,f,n);p!==void 0?u.push(p):u.push(f)}}else if(typeof c=="object"){const u=kP(o,l,c,n);u!==void 0&&(o[l]=u)}}}}function kP(n,e,t,i){var s,r;if(t!=null)if(t.isComponent===!0){const o=t.gameObject;if(o){const a=o.uuid,l=(s=i[a])==null?void 0:s.clone;if(!l){By&&console.log("reference did not change",e,n,t);return}const c=o.userData.components.indexOf(t);if(c>=0)return By&&console.log(e,a),l.userData.components[c];console.warn("could not find component",e,t)}}else if(t.isObject3D===!0){if(e==="gameObject")return;const o=t;if(o){const a=o.uuid,l=(r=i[a])==null?void 0:r.clone;if(l)return By&&console.log(e,"old",t,"new",l),l}}else{if(t.isVector4||t.isVector3||t.isVector2||t.isQuaternion||t.isEuler)return t.clone();if(t.isColor===!0)return t.clone();if(t.isEventList===!0)return new t.constructor}}const LC=re("debugnewscripts"),Uj=re("debughierarchy"),Li=[];function Nj(){return Li.length>0}function y0(n){if(!(n.new_scripts.length<=0)){if(LC&&console.log("Register new components",n.new_scripts.length,[...n.new_scripts],n.alias?"element: "+n.alias:n.hash,n),n.new_scripts_pre_setup_callbacks.length>0){for(const e of n.new_scripts_pre_setup_callbacks)e&&e();n.new_scripts_pre_setup_callbacks.length=0}Li.length=0,n.new_scripts.length>0&&Li.push(...n.new_scripts),n.new_scripts.length=0;for(let e=0;e<Li.length;e++)try{const t=Li[e];if(t.isComponent!==!0){(si()||LC)&&console.error(`Registered script is not a Needle Engine component. 
The script will be ignored. Please make sure your component extends "Behaviour" imported from "@needle-tools/engine"
`,t),Li.splice(e,1),e--;continue}if(t.destroyed)continue;if(!t.gameObject){console.error("MISSING GAMEOBJECT - will ignore",t),Li.splice(e,1),e--;continue}t.context=n,Dg(t.gameObject),W2(t,n)}catch(t){console.error(t),Tc(Li[e],n),Li.splice(e,1),e--}for(let e=0;e<Li.length;e++)try{const t=Li[e];if(t.destroyed){Tc(Li[e],n),Li.splice(e,1),e--;continue}if(t.registering)try{t.registering()}catch(i){console.error(i)}t.__internalAwake!==void 0&&(t.gameObject||console.error("MISSING GAMEOBJECT",t,t.gameObject),Dg(t.gameObject),t.activeAndEnabled&&pf(t.__internalAwake.bind(t)))}catch(t){console.error(t),Tc(Li[e],n),Li.splice(e,1),e--}for(let e=0;e<Li.length;e++)try{const t=Li[e];if(t.destroyed||t.enabled===!1||(Dg(t.gameObject),t.activeAndEnabled===!1))continue;t.__internalEnable!==void 0&&(t.enabled=!0,pf(t.__internalEnable.bind(t)))}catch(t){console.error(t),Tc(Li[e],n),Li.splice(e,1),e--}for(let e=0;e<Li.length;e++)try{const t=Li[e];if(t.destroyed||!t.gameObject)continue;n.new_script_start.push(t)}catch(t){console.error(t),Tc(Li[e],n),Li.splice(e,1),e--}Li.length=0;for(const e of n.new_scripts_post_setup_callbacks)e&&e();n.new_scripts_post_setup_callbacks.length=0}}function zj(n){n&&(n.__internalDisable(!0),Tc(n,n.context))}function Q2(n,e){for(let t=0;t<n.new_script_start.length;t++)try{const i=n.new_script_start[t];if(e!==void 0&&i.gameObject!==e||i.destroyed||i.activeAndEnabled===!1)continue;pf(i.__internalAwake.bind(i)),i.enabled&&(pf(i.__internalEnable.bind(i)),pf(i.__internalStart.bind(i)),n.new_script_start.splice(t,1),t--)}catch(i){console.error(i),Tc(n.new_script_start[t],n),n.new_script_start.splice(t,1),t--}}function W2(n,e){e.scripts.indexOf(n)===-1&&(e.scripts.push(n),n.earlyUpdate&&e.scripts_earlyUpdate.push(n),n.update&&e.scripts_update.push(n),n.lateUpdate&&e.scripts_lateUpdate.push(n),n.onBeforeRender&&e.scripts_onBeforeRender.push(n),n.onAfterRender&&e.scripts_onAfterRender.push(n),n.onPausedChanged&&e.scripts_pausedChanged.push(n))}function Tc(n,e){rl(n,e.new_scripts),rl(n,e.new_script_start),rl(n,e.scripts),rl(n,e.scripts_earlyUpdate),rl(n,e.scripts_update),rl(n,e.scripts_lateUpdate),rl(n,e.scripts_onBeforeRender),rl(n,e.scripts_onAfterRender),rl(n,e.scripts_pausedChanged),e.stopAllCoroutinesFrom(n)}function rl(n,e){const t=e.indexOf(n);t>=0&&e.splice(t,1)}function Oy(n){if(n||(n=en.Current.scene),!n){console.trace("Invalid call - no current context.");return}const e=aA(n);j2(n,e,!0)||(LC||si()?console.error(`Error updating hierarchy
Do you have circular references in your project? <a target="_blank" href="https://docs.needle.tools/circular-reference"> Click here for more information.`,n):console.error('Failed to update active state in hierarchy of "'+n.name+'"',n),console.warn("  this error might be caused by circular references. Please make sure you don't have files with circular references (e.g. one GLB 1 is loading GLB 2 which is then loading GLB 1 again)."))}function j2(n,e,t,i=0){if(i>1e3)return console.warn("Hierarchy is too deep (> 1000 level) - will abort updating active state"),!1;const s=aA(n);if(e&&(e=s,e&&n.parent)){const l=n.parent;e=l[zc],e===void 0&&(l instanceof mr||(e=!0))}const o=n[zc]!==e;n[zc]=e,o&&(Uj&&console.warn("ACTIVE CHANGE",n.name,s,n.visible,e,"changed?"+o,n),t&&Gj(n,l=>{e?l.enabled&&(pf(l.__internalAwake.bind(l)),l.enabled&&(l.__didEnable=!0,l.onEnable())):l.__didAwake&&l.enabled&&(l.__didEnable=!1,l.onDisable())}));let a=!0;if(n.children){const l=i+1;for(const c of n.children)j2(c,e,t,l)===!1&&(a=!1)}return a}function Dg(n){let e=!0,t=n,i=!1;for(;t&&t;){if(t.type==="Scene"&&(i=!0),!aA(t)){e=!1;break}t=t.parent}if(!n){console.error("GO is null");return}n[zc]=e&&i}function Gj(n,e){var t;if((t=n.userData)!=null&&t.components)for(const i of n.userData.components)e(i)}const ky=new Map,q2=Symbol("prewarmFlag"),FC=Symbol("waitingForPrewarm"),UC=re("debugprewarm");function X2(n,e){if(!n||n[q2]===!0||n[FC]===!0)return;ky.has(e)||ky.set(e,[]),n[FC]=!0,ky.get(e).push(n),UC&&console.debug("register prewarm",n.name)}let LP=null,FP=null;function Vj(n){if(!n)return;const e=ky.get(n);if(!(e!=null&&e.length))return;const t=n.mainCamera;if(t){UC&&console.log("prewarm",e.length,"objects",[...e]);const i=n.renderer;if(i.compile){const s=n.scene;i.compile(s,t),LP??(LP=new Cb(64)),FP??(FP=new sM(.001,9999999,LP)),FP.update(i,s);for(const r of e)r[q2]=!0,r[FC]=!1;e.length=0,UC&&console.log("prewarm done")}}}/**
 * postprocessing v6.33.3 build Mon Oct 30 2023
 * https://github.com/pmndrs/postprocessing
 * Copyright 2015-2023 Raoul van Rschen
 * @license Zlib
 */var ip="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",Hj=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#if PASS == 1
uniform vec4 kernel64[32];
#else
uniform vec4 kernel16[8];
#endif
uniform lowp sampler2D cocBuffer;uniform vec2 texelSize;uniform float scale;varying vec2 vUv;void main(){
#ifdef FOREGROUND
vec2 cocNearFar=texture2D(cocBuffer,vUv).rg*scale;float coc=cocNearFar.x;
#else
float coc=texture2D(cocBuffer,vUv).g*scale;
#endif
if(coc==0.0){gl_FragColor=texture2D(inputBuffer,vUv);}else{
#ifdef FOREGROUND
vec2 step=texelSize*max(cocNearFar.x,cocNearFar.y);
#else
vec2 step=texelSize*coc;
#endif
#if PASS == 1
vec4 acc=vec4(0.0);for(int i=0;i<32;++i){vec4 kernel=kernel64[i];vec2 uv=step*kernel.xy+vUv;acc+=texture2D(inputBuffer,uv);uv=step*kernel.zw+vUv;acc+=texture2D(inputBuffer,uv);}gl_FragColor=acc/64.0;
#else
vec4 maxValue=texture2D(inputBuffer,vUv);for(int i=0;i<8;++i){vec4 kernel=kernel16[i];vec2 uv=step*kernel.xy+vUv;maxValue=max(texture2D(inputBuffer,uv),maxValue);uv=step*kernel.zw+vUv;maxValue=max(texture2D(inputBuffer,uv),maxValue);}gl_FragColor=maxValue;
#endif
}}`,Fv=class extends Bt{constructor(n=!1,e=!1){super({name:"BokehMaterial",defines:{PASS:n?"2":"1"},uniforms:{inputBuffer:new xe(null),cocBuffer:new xe(null),texelSize:new xe(new te),kernel64:new xe(null),kernel16:new xe(null),scale:new xe(1)},blending:qi,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Hj,vertexShader:ip}),e&&(this.defines.FOREGROUND="1"),this.generateKernel()}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}set cocBuffer(n){this.uniforms.cocBuffer.value=n}setCoCBuffer(n){this.uniforms.cocBuffer.value=n}get scale(){return this.uniforms.scale.value}set scale(n){this.uniforms.scale.value=n}getScale(n){return this.scale}setScale(n){this.scale=n}generateKernel(){const n=2.39996323,e=new Float64Array(128),t=new Float64Array(32);let i=0,s=0;for(let r=0,o=Math.sqrt(80);r<80;++r){const a=r*n,l=Math.sqrt(r)/o,c=l*Math.cos(a),u=l*Math.sin(a);r%5===0?(t[s++]=c,t[s++]=u):(e[i++]=c,e[i++]=u)}this.uniforms.kernel64.value=e,this.uniforms.kernel16.value=t}setTexelSize(n,e){this.uniforms.texelSize.value.set(n,e)}setSize(n,e){this.uniforms.texelSize.value.set(1/n,1/e)}},Ot={SKIP:9,SET:30,ADD:0,ALPHA:1,AVERAGE:2,COLOR:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,DIVIDE:8,DST:9,EXCLUSION:10,HARD_LIGHT:11,HARD_MIX:12,HUE:13,INVERT:14,INVERT_RGB:15,LIGHTEN:16,LINEAR_BURN:17,LINEAR_DODGE:18,LINEAR_LIGHT:19,LUMINOSITY:20,MULTIPLY:21,NEGATION:22,NORMAL:23,OVERLAY:24,PIN_LIGHT:25,REFLECT:26,SATURATION:27,SCREEN:28,SOFT_LIGHT:29,SRC:30,SUBTRACT:31,VIVID_LIGHT:32},Y2={RED:0,GREEN:1,BLUE:2,ALPHA:3},J2="",vi="srgb",d_="srgb-linear",Og={DEFAULT:0,KEEP_MAX_DEPTH:1,DISCARD_MAX_DEPTH:2},sT={DEPTH:0,LUMA:1,COLOR:2},Ur={NONE:0,DEPTH:1,CONVOLUTION:2},oi={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},Ql={VERY_SMALL:0,SMALL:1,MEDIUM:2,LARGE:3,VERY_LARGE:4,HUGE:5},K2={DISCARD:0,MULTIPLY:1,MULTIPLY_RGB_SET_ALPHA:2,MULTIPLY_RGB:3},Qj={DISABLED:0,DEPTH:1,CUSTOM:2},Fd={LOW:0,MEDIUM:1,HIGH:2,ULTRA:3},Uv={DEFAULT:0,ESKIL:1},Z2=Number(nh.replace(/\D+/g,"")),$2=Z2>=152,Wj=new Map([[Km,d_],[ka,vi]]),jj=new Map([[d_,Km],[vi,ka]]);function Wl(n){return n===null?null:$2?n.outputColorSpace:Wj.get(n.outputEncoding)}function lr(n,e){n!==null&&($2?n.colorSpace=e:n.encoding=jj.get(e))}function np(n){return Z2<154?n.replace("colorspace_fragment","encodings_fragment"):n}function qd(n,e,t){return n*(e-t)-e}function au(n,e,t){return Math.min(Math.max((n+e)/(e-t),0),1)}var qj=`#include <common>
#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform float focusDistance;uniform float focusRange;uniform float cameraNear;uniform float cameraFar;varying vec2 vUv;float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
float depth=unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
float depth=texture2D(depthBuffer,uv).r;
#endif
#ifdef LOG_DEPTH
float d=pow(2.0,depth*log2(cameraFar+1.0))-1.0;float a=cameraFar/(cameraFar-cameraNear);float b=cameraFar*cameraNear/(cameraNear-cameraFar);depth=a+b/d;
#endif
return depth;}void main(){float depth=readDepth(vUv);
#ifdef PERSPECTIVE_CAMERA
float viewZ=perspectiveDepthToViewZ(depth,cameraNear,cameraFar);float linearDepth=viewZToOrthographicDepth(viewZ,cameraNear,cameraFar);
#else
float linearDepth=depth;
#endif
float signedDistance=linearDepth-focusDistance;float magnitude=smoothstep(0.0,focusRange,abs(signedDistance));gl_FragColor.rg=magnitude*vec2(step(signedDistance,0.0),step(0.0,signedDistance));}`,Xj=class extends Bt{constructor(n){super({name:"CircleOfConfusionMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new xe(null),focusDistance:new xe(0),focusRange:new xe(0),cameraNear:new xe(.3),cameraFar:new xe(1e3)},blending:qi,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:qj,vertexShader:ip}),this.uniforms.focalLength=this.uniforms.focusRange,this.copyCameraSettings(n)}get near(){return this.uniforms.cameraNear.value}get far(){return this.uniforms.cameraFar.value}set depthBuffer(n){this.uniforms.depthBuffer.value=n}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer(n,e=hs){this.depthBuffer=n,this.depthPacking=e}get focusDistance(){return this.uniforms.focusDistance.value}set focusDistance(n){this.uniforms.focusDistance.value=n}get worldFocusDistance(){return-qd(this.focusDistance,this.near,this.far)}set worldFocusDistance(n){this.focusDistance=au(-n,this.near,this.far)}getFocusDistance(n){this.uniforms.focusDistance.value=n}setFocusDistance(n){this.uniforms.focusDistance.value=n}get focalLength(){return this.focusRange}set focalLength(n){this.focusRange=n}get focusRange(){return this.uniforms.focusRange.value}set focusRange(n){this.uniforms.focusRange.value=n}get worldFocusRange(){return-qd(this.focusRange,this.near,this.far)}set worldFocusRange(n){this.focusRange=au(-n,this.near,this.far)}getFocalLength(n){return this.focusRange}setFocalLength(n){this.focusRange=n}adoptCameraSettings(n){this.copyCameraSettings(n)}copyCameraSettings(n){n&&(this.uniforms.cameraNear.value=n.near,this.uniforms.cameraFar.value=n.far,n instanceof qt?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}},Yj=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;
#include <colorspace_fragment>
}`,Jj="uniform vec4 texelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize.xy*vec2(kernel)+texelSize.zw)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}",Kj=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],eF=class extends Bt{constructor(n=new Ke){super({name:"KawaseBlurMaterial",uniforms:{inputBuffer:new xe(null),texelSize:new xe(new Ke),scale:new xe(1),kernel:new xe(0)},blending:qi,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Yj,vertexShader:Jj}),this.fragmentShader=np(this.fragmentShader),this.setTexelSize(n.x,n.y),this.kernelSize=Ql.MEDIUM}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.inputBuffer=n}get kernelSequence(){return Kj[this.kernelSize]}get scale(){return this.uniforms.scale.value}set scale(n){this.uniforms.scale.value=n}getScale(){return this.uniforms.scale.value}setScale(n){this.uniforms.scale.value=n}getKernel(){return null}get kernel(){return this.uniforms.kernel.value}set kernel(n){this.uniforms.kernel.value=n}setKernel(n){this.kernel=n}setTexelSize(n,e){this.uniforms.texelSize.value.set(n,e,n*.5,e*.5)}setSize(n,e){const t=1/n,i=1/e;this.uniforms.texelSize.value.set(t,i,t*.5,i*.5)}},Zj=`#include <common>
#include <dithering_pars_fragment>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform float opacity;varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=opacity*texel;
#include <colorspace_fragment>
#include <dithering_fragment>
}`,tF=class extends Bt{constructor(){super({name:"CopyMaterial",uniforms:{inputBuffer:new xe(null),opacity:new xe(1)},blending:qi,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Zj,vertexShader:ip}),this.fragmentShader=np(this.fragmentShader)}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}getOpacity(n){return this.uniforms.opacity.value}setOpacity(n){this.uniforms.opacity.value=n}},$j=`#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
#ifdef DOWNSAMPLE_NORMALS
uniform lowp sampler2D normalBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}int findBestDepth(const in float samples[4]){float c=(samples[0]+samples[1]+samples[2]+samples[3])*0.25;float distances[4];distances[0]=abs(c-samples[0]);distances[1]=abs(c-samples[1]);distances[2]=abs(c-samples[2]);distances[3]=abs(c-samples[3]);float maxDistance=max(max(distances[0],distances[1]),max(distances[2],distances[3]));int remaining[3];int rejected[3];int i,j,k;for(i=0,j=0,k=0;i<4;++i){if(distances[i]<maxDistance){remaining[j++]=i;}else{rejected[k++]=i;}}for(;j<3;++j){remaining[j]=rejected[--k];}vec3 s=vec3(samples[remaining[0]],samples[remaining[1]],samples[remaining[2]]);c=(s.x+s.y+s.z)/3.0;distances[0]=abs(c-s.x);distances[1]=abs(c-s.y);distances[2]=abs(c-s.z);float minDistance=min(distances[0],min(distances[1],distances[2]));for(i=0;i<3;++i){if(distances[i]==minDistance){break;}}return remaining[i];}void main(){float d[4];d[0]=readDepth(vUv0);d[1]=readDepth(vUv1);d[2]=readDepth(vUv2);d[3]=readDepth(vUv3);int index=findBestDepth(d);
#ifdef DOWNSAMPLE_NORMALS
vec3 n[4];n[0]=texture2D(normalBuffer,vUv0).rgb;n[1]=texture2D(normalBuffer,vUv1).rgb;n[2]=texture2D(normalBuffer,vUv2).rgb;n[3]=texture2D(normalBuffer,vUv3).rgb;
#else
vec3 n[4];n[0]=vec3(0.0);n[1]=vec3(0.0);n[2]=vec3(0.0);n[3]=vec3(0.0);
#endif
gl_FragColor=vec4(n[index],d[index]);}`,e9="uniform vec2 texelSize;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vUv0=uv;vUv1=vec2(uv.x,uv.y+texelSize.y);vUv2=vec2(uv.x+texelSize.x,uv.y);vUv3=uv+texelSize;gl_Position=vec4(position.xy,1.0,1.0);}",t9=class extends Bt{constructor(){super({name:"DepthDownsamplingMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new xe(null),normalBuffer:new xe(null),texelSize:new xe(new te)},blending:qi,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:$j,vertexShader:e9})}set depthBuffer(n){this.uniforms.depthBuffer.value=n}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer(n,e=hs){this.depthBuffer=n,this.depthPacking=e}set normalBuffer(n){this.uniforms.normalBuffer.value=n,n!==null?this.defines.DOWNSAMPLE_NORMALS="1":delete this.defines.DOWNSAMPLE_NORMALS,this.needsUpdate=!0}setNormalBuffer(n){this.normalBuffer=n}setTexelSize(n,e){this.uniforms.texelSize.value.set(n,e)}setSize(n,e){this.uniforms.texelSize.value.set(1/n,1/e)}},i9=`#include <common>
#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer0;uniform highp sampler2D depthBuffer1;
#else
uniform mediump sampler2D depthBuffer0;uniform mediump sampler2D depthBuffer1;
#endif
uniform sampler2D inputBuffer;uniform vec2 cameraNearFar;float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#else
return orthographicDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#endif
}varying vec2 vUv;void main(){vec2 depth;
#if DEPTH_PACKING_0 == 3201
depth.x=unpackRGBAToDepth(texture2D(depthBuffer0,vUv));
#else
depth.x=texture2D(depthBuffer0,vUv).r;
#ifdef LOG_DEPTH
float d=pow(2.0,depth.x*log2(cameraNearFar.y+1.0))-1.0;float a=cameraNearFar.y/(cameraNearFar.y-cameraNearFar.x);float b=cameraNearFar.y*cameraNearFar.x/(cameraNearFar.x-cameraNearFar.y);depth.x=a+b/d;
#endif
#endif
#if DEPTH_PACKING_1 == 3201
depth.y=unpackRGBAToDepth(texture2D(depthBuffer1,vUv));
#else
depth.y=texture2D(depthBuffer1,vUv).r;
#ifdef LOG_DEPTH
float d=pow(2.0,depth.y*log2(cameraNearFar.y+1.0))-1.0;float a=cameraNearFar.y/(cameraNearFar.y-cameraNearFar.x);float b=cameraNearFar.y*cameraNearFar.x/(cameraNearFar.x-cameraNearFar.y);depth.y=a+b/d;
#endif
#endif
bool isMaxDepth=(depth.x==1.0);
#ifdef PERSPECTIVE_CAMERA
depth.x=viewZToOrthographicDepth(getViewZ(depth.x),cameraNearFar.x,cameraNearFar.y);depth.y=viewZToOrthographicDepth(getViewZ(depth.y),cameraNearFar.x,cameraNearFar.y);
#endif
#if DEPTH_TEST_STRATEGY == 0
bool keep=depthTest(depth.x,depth.y);
#elif DEPTH_TEST_STRATEGY == 1
bool keep=isMaxDepth||depthTest(depth.x,depth.y);
#else
bool keep=!isMaxDepth&&depthTest(depth.x,depth.y);
#endif
if(keep){gl_FragColor=texture2D(inputBuffer,vUv);}else{discard;}}`,n9=class extends Bt{constructor(){super({name:"DepthMaskMaterial",defines:{DEPTH_EPSILON:"0.0001",DEPTH_PACKING_0:"0",DEPTH_PACKING_1:"0",DEPTH_TEST_STRATEGY:Og.KEEP_MAX_DEPTH},uniforms:{inputBuffer:new xe(null),depthBuffer0:new xe(null),depthBuffer1:new xe(null),cameraNearFar:new xe(new te(1,1))},blending:qi,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:i9,vertexShader:ip}),this.depthMode=um}set depthBuffer0(n){this.uniforms.depthBuffer0.value=n}set depthPacking0(n){this.defines.DEPTH_PACKING_0=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer0(n,e=hs){this.depthBuffer0=n,this.depthPacking0=e}set depthBuffer1(n){this.uniforms.depthBuffer1.value=n}set depthPacking1(n){this.defines.DEPTH_PACKING_1=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer1(n,e=hs){this.depthBuffer1=n,this.depthPacking1=e}get maxDepthStrategy(){return Number(this.defines.DEPTH_TEST_STRATEGY)}set maxDepthStrategy(n){this.defines.DEPTH_TEST_STRATEGY=n.toFixed(0),this.needsUpdate=!0}get keepFar(){return this.maxDepthStrategy}set keepFar(n){this.maxDepthStrategy=n?Og.KEEP_MAX_DEPTH:Og.DISCARD_MAX_DEPTH}getMaxDepthStrategy(){return this.maxDepthStrategy}setMaxDepthStrategy(n){this.maxDepthStrategy=n}get epsilon(){return Number(this.defines.DEPTH_EPSILON)}set epsilon(n){this.defines.DEPTH_EPSILON=n.toFixed(16),this.needsUpdate=!0}getEpsilon(){return this.epsilon}setEpsilon(n){this.epsilon=n}get depthMode(){return Number(this.defines.DEPTH_MODE)}set depthMode(n){let e;switch(n){case NE:e="false";break;case pb:e="true";break;case If:e="abs(d1 - d0) <= DEPTH_EPSILON";break;case Xm:e="abs(d1 - d0) > DEPTH_EPSILON";break;case um:e="d0 > d1";break;case Tf:e="d0 >= d1";break;case gb:e="d0 <= d1";break;case mb:default:e="d0 < d1";break}this.defines.DEPTH_MODE=n.toFixed(0),this.defines["depthTest(d0, d1)"]=e,this.needsUpdate=!0}getDepthMode(){return this.depthMode}setDepthMode(n){this.depthMode=n}adoptCameraSettings(n){this.copyCameraSettings(n)}copyCameraSettings(n){n&&(this.uniforms.cameraNearFar.value.set(n.near,n.far),n instanceof qt?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}},s9=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#define WEIGHT_INNER 0.125
#define WEIGHT_OUTER 0.0555555
varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;float clampToBorder(const in vec2 uv){return float(uv.s>=0.0&&uv.s<=1.0&&uv.t>=0.0&&uv.t<=1.0);}void main(){vec4 c=vec4(0.0);vec4 w=WEIGHT_INNER*vec4(clampToBorder(vUv00),clampToBorder(vUv01),clampToBorder(vUv02),clampToBorder(vUv03));c+=w.x*texture2D(inputBuffer,vUv00);c+=w.y*texture2D(inputBuffer,vUv01);c+=w.z*texture2D(inputBuffer,vUv02);c+=w.w*texture2D(inputBuffer,vUv03);w=WEIGHT_OUTER*vec4(clampToBorder(vUv04),clampToBorder(vUv05),clampToBorder(vUv06),clampToBorder(vUv07));c+=w.x*texture2D(inputBuffer,vUv04);c+=w.y*texture2D(inputBuffer,vUv05);c+=w.z*texture2D(inputBuffer,vUv06);c+=w.w*texture2D(inputBuffer,vUv07);w=WEIGHT_OUTER*vec4(clampToBorder(vUv08),clampToBorder(vUv09),clampToBorder(vUv10),clampToBorder(vUv11));c+=w.x*texture2D(inputBuffer,vUv08);c+=w.y*texture2D(inputBuffer,vUv09);c+=w.z*texture2D(inputBuffer,vUv10);c+=w.w*texture2D(inputBuffer,vUv11);c+=WEIGHT_OUTER*texture2D(inputBuffer,vUv);gl_FragColor=c;
#include <colorspace_fragment>
}`,r9="uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;void main(){vUv=position.xy*0.5+0.5;vUv00=vUv+texelSize*vec2(-1.0,1.0);vUv01=vUv+texelSize*vec2(1.0,1.0);vUv02=vUv+texelSize*vec2(-1.0,-1.0);vUv03=vUv+texelSize*vec2(1.0,-1.0);vUv04=vUv+texelSize*vec2(-2.0,2.0);vUv05=vUv+texelSize*vec2(0.0,2.0);vUv06=vUv+texelSize*vec2(2.0,2.0);vUv07=vUv+texelSize*vec2(-2.0,0.0);vUv08=vUv+texelSize*vec2(2.0,0.0);vUv09=vUv+texelSize*vec2(-2.0,-2.0);vUv10=vUv+texelSize*vec2(0.0,-2.0);vUv11=vUv+texelSize*vec2(2.0,-2.0);gl_Position=vec4(position.xy,1.0,1.0);}",o9=class extends Bt{constructor(){super({name:"DownsamplingMaterial",uniforms:{inputBuffer:new xe(null),texelSize:new xe(new te)},blending:qi,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:s9,vertexShader:r9}),this.fragmentShader=np(this.fragmentShader)}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setSize(n,e){this.uniforms.texelSize.value.set(1/n,1/e)}},a9=`varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#if EDGE_DETECTION_MODE != 0
varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;
#endif
#if EDGE_DETECTION_MODE == 1
#include <common>
#endif
#if EDGE_DETECTION_MODE == 0 || PREDICATION_MODE == 1
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}vec3 gatherNeighbors(){float p=readDepth(vUv);float pLeft=readDepth(vUv0);float pTop=readDepth(vUv1);return vec3(p,pLeft,pTop);}
#elif PREDICATION_MODE == 2
uniform sampler2D predicationBuffer;vec3 gatherNeighbors(){float p=texture2D(predicationBuffer,vUv).r;float pLeft=texture2D(predicationBuffer,vUv0).r;float pTop=texture2D(predicationBuffer,vUv1).r;return vec3(p,pLeft,pTop);}
#endif
#if PREDICATION_MODE != 0
vec2 calculatePredicatedThreshold(){vec3 neighbours=gatherNeighbors();vec2 delta=abs(neighbours.xx-neighbours.yz);vec2 edges=step(PREDICATION_THRESHOLD,delta);return PREDICATION_SCALE*EDGE_THRESHOLD*(1.0-PREDICATION_STRENGTH*edges);}
#endif
#if EDGE_DETECTION_MODE != 0
uniform sampler2D inputBuffer;
#endif
void main(){
#if EDGE_DETECTION_MODE == 0
const vec2 threshold=vec2(DEPTH_THRESHOLD);
#elif PREDICATION_MODE != 0
vec2 threshold=calculatePredicatedThreshold();
#else
const vec2 threshold=vec2(EDGE_THRESHOLD);
#endif
#if EDGE_DETECTION_MODE == 0
vec3 neighbors=gatherNeighbors();vec2 delta=abs(neighbors.xx-vec2(neighbors.y,neighbors.z));vec2 edges=step(threshold,delta);if(dot(edges,vec2(1.0))==0.0){discard;}gl_FragColor=vec4(edges,0.0,1.0);
#elif EDGE_DETECTION_MODE == 1
float l=luminance(texture2D(inputBuffer,vUv).rgb);float lLeft=luminance(texture2D(inputBuffer,vUv0).rgb);float lTop=luminance(texture2D(inputBuffer,vUv1).rgb);vec4 delta;delta.xy=abs(l-vec2(lLeft,lTop));vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}float lRight=luminance(texture2D(inputBuffer,vUv2).rgb);float lBottom=luminance(texture2D(inputBuffer,vUv3).rgb);delta.zw=abs(l-vec2(lRight,lBottom));vec2 maxDelta=max(delta.xy,delta.zw);float lLeftLeft=luminance(texture2D(inputBuffer,vUv4).rgb);float lTopTop=luminance(texture2D(inputBuffer,vUv5).rgb);delta.zw=abs(vec2(lLeft,lTop)-vec2(lLeftLeft,lTopTop));maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges.xy*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);
#elif EDGE_DETECTION_MODE == 2
vec4 delta;vec3 c=texture2D(inputBuffer,vUv).rgb;vec3 cLeft=texture2D(inputBuffer,vUv0).rgb;vec3 t=abs(c-cLeft);delta.x=max(max(t.r,t.g),t.b);vec3 cTop=texture2D(inputBuffer,vUv1).rgb;t=abs(c-cTop);delta.y=max(max(t.r,t.g),t.b);vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}vec3 cRight=texture2D(inputBuffer,vUv2).rgb;t=abs(c-cRight);delta.z=max(max(t.r,t.g),t.b);vec3 cBottom=texture2D(inputBuffer,vUv3).rgb;t=abs(c-cBottom);delta.w=max(max(t.r,t.g),t.b);vec2 maxDelta=max(delta.xy,delta.zw);vec3 cLeftLeft=texture2D(inputBuffer,vUv4).rgb;t=abs(c-cLeftLeft);delta.z=max(max(t.r,t.g),t.b);vec3 cTopTop=texture2D(inputBuffer,vUv5).rgb;t=abs(c-cTopTop);delta.w=max(max(t.r,t.g),t.b);maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);
#endif
}`,l9=`uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;
#if EDGE_DETECTION_MODE != 0
varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;
#endif
void main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,0.0);vUv1=vUv+texelSize*vec2(0.0,-1.0);
#if EDGE_DETECTION_MODE != 0
vUv2=vUv+texelSize*vec2(1.0,0.0);vUv3=vUv+texelSize*vec2(0.0,1.0);vUv4=vUv+texelSize*vec2(-2.0,0.0);vUv5=vUv+texelSize*vec2(0.0,-2.0);
#endif
gl_Position=vec4(position.xy,1.0,1.0);}`,c9=class extends Bt{constructor(n=new te,e=sT.COLOR){super({name:"EdgeDetectionMaterial",defines:{THREE_REVISION:nh.replace(/\D+/g,""),LOCAL_CONTRAST_ADAPTATION_FACTOR:"2.0",EDGE_THRESHOLD:"0.1",DEPTH_THRESHOLD:"0.01",PREDICATION_MODE:"0",PREDICATION_THRESHOLD:"0.01",PREDICATION_SCALE:"2.0",PREDICATION_STRENGTH:"1.0",DEPTH_PACKING:"0"},uniforms:{inputBuffer:new xe(null),depthBuffer:new xe(null),predicationBuffer:new xe(null),texelSize:new xe(n)},blending:qi,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:a9,vertexShader:l9}),this.edgeDetectionMode=e}set depthBuffer(n){this.uniforms.depthBuffer.value=n}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer(n,e=hs){this.depthBuffer=n,this.depthPacking=e}get edgeDetectionMode(){return Number(this.defines.EDGE_DETECTION_MODE)}set edgeDetectionMode(n){this.defines.EDGE_DETECTION_MODE=n.toFixed(0),this.needsUpdate=!0}getEdgeDetectionMode(){return this.edgeDetectionMode}setEdgeDetectionMode(n){this.edgeDetectionMode=n}get localContrastAdaptationFactor(){return Number(this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR)}set localContrastAdaptationFactor(n){this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR=n.toFixed("6"),this.needsUpdate=!0}getLocalContrastAdaptationFactor(){return this.localContrastAdaptationFactor}setLocalContrastAdaptationFactor(n){this.localContrastAdaptationFactor=n}get edgeDetectionThreshold(){return Number(this.defines.EDGE_THRESHOLD)}set edgeDetectionThreshold(n){this.defines.EDGE_THRESHOLD=n.toFixed("6"),this.defines.DEPTH_THRESHOLD=(n*.1).toFixed("6"),this.needsUpdate=!0}getEdgeDetectionThreshold(){return this.edgeDetectionThreshold}setEdgeDetectionThreshold(n){this.edgeDetectionThreshold=n}get predicationMode(){return Number(this.defines.PREDICATION_MODE)}set predicationMode(n){this.defines.PREDICATION_MODE=n.toFixed(0),this.needsUpdate=!0}getPredicationMode(){return this.predicationMode}setPredicationMode(n){this.predicationMode=n}set predicationBuffer(n){this.uniforms.predicationBuffer.value=n}setPredicationBuffer(n){this.uniforms.predicationBuffer.value=n}get predicationThreshold(){return Number(this.defines.PREDICATION_THRESHOLD)}set predicationThreshold(n){this.defines.PREDICATION_THRESHOLD=n.toFixed("6"),this.needsUpdate=!0}getPredicationThreshold(){return this.predicationThreshold}setPredicationThreshold(n){this.predicationThreshold=n}get predicationScale(){return Number(this.defines.PREDICATION_SCALE)}set predicationScale(n){this.defines.PREDICATION_SCALE=n.toFixed("6"),this.needsUpdate=!0}getPredicationScale(){return this.predicationScale}setPredicationScale(n){this.predicationScale=n}get predicationStrength(){return Number(this.defines.PREDICATION_STRENGTH)}set predicationStrength(n){this.defines.PREDICATION_STRENGTH=n.toFixed("6"),this.needsUpdate=!0}getPredicationStrength(){return this.predicationStrength}setPredicationStrength(n){this.predicationStrength=n}setSize(n,e){this.uniforms.texelSize.value.set(1/n,1/e)}},h9=`#include <common>
#include <packing>
#include <dithering_pars_fragment>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#if DEPTH_PACKING == 3201
uniform lowp sampler2D depthBuffer;
#elif defined(GL_FRAGMENT_PRECISION_HIGH)
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#if THREE_REVISION >= 137
vec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNear,cameraFar);
#else
return orthographicDepthToViewZ(depth,cameraNear,cameraFar);
#endif
}vec3 RGBToHCV(const in vec3 RGB){vec4 P=mix(vec4(RGB.bg,-1.0,2.0/3.0),vec4(RGB.gb,0.0,-1.0/3.0),step(RGB.b,RGB.g));vec4 Q=mix(vec4(P.xyw,RGB.r),vec4(RGB.r,P.yzx),step(P.x,RGB.r));float C=Q.x-min(Q.w,Q.y);float H=abs((Q.w-Q.y)/(6.0*C+EPSILON)+Q.z);return vec3(H,C,Q.x);}vec3 RGBToHSL(const in vec3 RGB){vec3 HCV=RGBToHCV(RGB);float L=HCV.z-HCV.y*0.5;float S=HCV.y/(1.0-abs(L*2.0-1.0)+EPSILON);return vec3(HCV.x,S,L);}vec3 HueToRGB(const in float H){float R=abs(H*6.0-3.0)-1.0;float G=2.0-abs(H*6.0-2.0);float B=2.0-abs(H*6.0-4.0);return clamp(vec3(R,G,B),0.0,1.0);}vec3 HSLToRGB(const in vec3 HSL){vec3 RGB=HueToRGB(HSL.x);float C=(1.0-abs(2.0*HSL.z-1.0))*HSL.y;return(RGB-0.5)*C+HSL.z;}FRAGMENT_HEAD void main(){FRAGMENT_MAIN_UV vec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGE color0.a=clamp(color0.a,0.0,1.0);gl_FragColor=color0;
#ifdef ENCODE_OUTPUT
#include <colorspace_fragment>
#endif
#include <dithering_fragment>
}`,u9="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEAD void main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORT gl_Position=vec4(position.xy,1.0,1.0);}",d9=class extends Bt{constructor(n,e,t,i,s=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:nh.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new xe(null),depthBuffer:new xe(null),resolution:new xe(new te),texelSize:new xe(new te),cameraNear:new xe(.3),cameraFar:new xe(1e3),aspect:new xe(1),time:new xe(0)},blending:qi,toneMapped:!1,depthWrite:!1,depthTest:!1,dithering:s}),n&&this.setShaderParts(n),e&&this.setDefines(e),t&&this.setUniforms(t),this.copyCameraSettings(i)}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(n){this.uniforms.depthBuffer.value=n}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer(n,e=hs){this.depthBuffer=n,this.depthPacking=e}setShaderData(n){this.setShaderParts(n.shaderParts),this.setDefines(n.defines),this.setUniforms(n.uniforms),this.setExtensions(n.extensions)}setShaderParts(n){return this.fragmentShader=h9.replace(oi.FRAGMENT_HEAD,n.get(oi.FRAGMENT_HEAD)||"").replace(oi.FRAGMENT_MAIN_UV,n.get(oi.FRAGMENT_MAIN_UV)||"").replace(oi.FRAGMENT_MAIN_IMAGE,n.get(oi.FRAGMENT_MAIN_IMAGE)||""),this.vertexShader=u9.replace(oi.VERTEX_HEAD,n.get(oi.VERTEX_HEAD)||"").replace(oi.VERTEX_MAIN_SUPPORT,n.get(oi.VERTEX_MAIN_SUPPORT)||""),this.fragmentShader=np(this.fragmentShader),this.needsUpdate=!0,this}setDefines(n){for(const e of n.entries())this.defines[e[0]]=e[1];return this.needsUpdate=!0,this}setUniforms(n){for(const e of n.entries())this.uniforms[e[0]]=e[1];return this}setExtensions(n){this.extensions={};for(const e of n)this.extensions[e]=!0;return this}get encodeOutput(){return this.defines.ENCODE_OUTPUT!==void 0}set encodeOutput(n){this.encodeOutput!==n&&(n?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(n){return this.encodeOutput}setOutputEncodingEnabled(n){this.encodeOutput=n}get time(){return this.uniforms.time.value}set time(n){this.uniforms.time.value=n}setDeltaTime(n){this.uniforms.time.value+=n}adoptCameraSettings(n){this.copyCameraSettings(n)}copyCameraSettings(n){n&&(this.uniforms.cameraNear.value=n.near,this.uniforms.cameraFar.value=n.far,n instanceof qt?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(n,e){const t=this.uniforms;t.resolution.value.set(n,e),t.texelSize.value.set(1/n,1/e),t.aspect.value=n/e}static get Section(){return oi}},f9=`#include <common>
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef RANGE
uniform vec2 range;
#elif defined(THRESHOLD)
uniform float threshold;uniform float smoothing;
#endif
varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);float l=luminance(texel.rgb);
#ifdef RANGE
float low=step(range.x,l);float high=step(l,range.y);l*=low*high;
#elif defined(THRESHOLD)
l=smoothstep(threshold,threshold+smoothing,l);
#endif
#ifdef COLOR
gl_FragColor=vec4(texel.rgb*l,l);
#else
gl_FragColor=vec4(l);
#endif
}`,p9=class extends Bt{constructor(n=!1,e=null){super({name:"LuminanceMaterial",defines:{THREE_REVISION:nh.replace(/\D+/g,"")},uniforms:{inputBuffer:new xe(null),threshold:new xe(0),smoothing:new xe(1),range:new xe(null)},blending:qi,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:f9,vertexShader:ip}),this.colorOutput=n,this.luminanceRange=e}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}get threshold(){return this.uniforms.threshold.value}set threshold(n){this.smoothing>0||n>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.threshold.value=n}getThreshold(){return this.threshold}setThreshold(n){this.threshold=n}get smoothing(){return this.uniforms.smoothing.value}set smoothing(n){this.threshold>0||n>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.smoothing.value=n}getSmoothingFactor(){return this.smoothing}setSmoothingFactor(n){this.smoothing=n}get useThreshold(){return this.threshold>0||this.smoothing>0}set useThreshold(n){}get colorOutput(){return this.defines.COLOR!==void 0}set colorOutput(n){n?this.defines.COLOR="1":delete this.defines.COLOR,this.needsUpdate=!0}isColorOutputEnabled(n){return this.colorOutput}setColorOutputEnabled(n){this.colorOutput=n}get useRange(){return this.luminanceRange!==null}set useRange(n){this.luminanceRange=null}get luminanceRange(){return this.uniforms.range.value}set luminanceRange(n){n!==null?this.defines.RANGE="1":delete this.defines.RANGE,this.uniforms.range.value=n,this.needsUpdate=!0}getLuminanceRange(){return this.luminanceRange}setLuminanceRange(n){this.luminanceRange=n}},g9=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef MASK_PRECISION_HIGH
uniform mediump sampler2D maskTexture;
#else
uniform lowp sampler2D maskTexture;
#endif
#if MASK_FUNCTION != 0
uniform float strength;
#endif
varying vec2 vUv;void main(){
#if COLOR_CHANNEL == 0
float mask=texture2D(maskTexture,vUv).r;
#elif COLOR_CHANNEL == 1
float mask=texture2D(maskTexture,vUv).g;
#elif COLOR_CHANNEL == 2
float mask=texture2D(maskTexture,vUv).b;
#else
float mask=texture2D(maskTexture,vUv).a;
#endif
#if MASK_FUNCTION == 0
#ifdef INVERTED
mask=step(mask,0.0);
#else
mask=1.0-step(mask,0.0);
#endif
#else
mask=clamp(mask*strength,0.0,1.0);
#ifdef INVERTED
mask=1.0-mask;
#endif
#endif
#if MASK_FUNCTION == 3
vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=vec4(mask*texel.rgb,texel.a);
#elif MASK_FUNCTION == 2
gl_FragColor=vec4(mask*texture2D(inputBuffer,vUv).rgb,mask);
#else
gl_FragColor=mask*texture2D(inputBuffer,vUv);
#endif
}`,m9=class extends Bt{constructor(n=null){super({name:"MaskMaterial",uniforms:{maskTexture:new xe(n),inputBuffer:new xe(null),strength:new xe(1)},blending:qi,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:g9,vertexShader:ip}),this.colorChannel=Y2.RED,this.maskFunction=K2.DISCARD}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}set maskTexture(n){this.uniforms.maskTexture.value=n,delete this.defines.MASK_PRECISION_HIGH,n.type!==fi&&(this.defines.MASK_PRECISION_HIGH="1"),this.needsUpdate=!0}setMaskTexture(n){this.maskTexture=n}set colorChannel(n){this.defines.COLOR_CHANNEL=n.toFixed(0),this.needsUpdate=!0}setColorChannel(n){this.colorChannel=n}set maskFunction(n){this.defines.MASK_FUNCTION=n.toFixed(0),this.needsUpdate=!0}setMaskFunction(n){this.maskFunction=n}get inverted(){return this.defines.INVERTED!==void 0}set inverted(n){this.inverted&&!n?delete this.defines.INVERTED:n&&(this.defines.INVERTED="1"),this.needsUpdate=!0}isInverted(){return this.inverted}setInverted(n){this.inverted=n}get strength(){return this.uniforms.strength.value}set strength(n){this.uniforms.strength.value=n}getStrength(){return this.strength}setStrength(n){this.strength=n}},A9=`#define sampleLevelZeroOffset(t, coord, offset) texture2D(t, coord + offset * texelSize)
#if __VERSION__ < 300
#define round(v) floor(v + 0.5)
#endif
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform lowp sampler2D areaTexture;uniform lowp sampler2D searchTexture;uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}vec2 decodeDiagBilinearAccess(in vec2 e){e.r=e.r*abs(5.0*e.r-5.0*0.75);return round(e);}vec4 decodeDiagBilinearAccess(in vec4 e){e.rb=e.rb*abs(5.0*e.rb-5.0*0.75);return round(e);}vec2 searchDiag1(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 searchDiag2(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);coord.x+=0.25*texelSize.x;vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;e=decodeDiagBilinearAccess(e);coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 areaDiag(const in vec2 dist,const in vec2 e,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE_DIAG,AREATEX_MAX_DISTANCE_DIAG)*e+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.x+=0.5;texCoord.y+=AREATEX_SUBTEX_SIZE*offset;return texture2D(areaTexture,texCoord).rg;}vec2 calculateDiagWeights(const in vec2 texCoord,const in vec2 e,const in vec4 subsampleIndices){vec2 weights=vec2(0.0);vec4 d;vec2 end;if(e.r>0.0){d.xz=searchDiag1(texCoord,vec2(-1.0,1.0),end);d.x+=float(end.y>0.9);}else{d.xz=vec2(0.0);}d.yw=searchDiag1(texCoord,vec2(1.0,-1.0),end);if(d.x+d.y>2.0){vec4 coords=vec4(-d.x+0.25,d.x,d.y,-d.y-0.25)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.xy=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).rg;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).rg;c.yxwz=decodeDiagBilinearAccess(c.xyzw);vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.z);}d.xz=searchDiag2(texCoord,vec2(-1.0,-1.0),end);if(sampleLevelZeroOffset(inputBuffer,texCoord,vec2(1,0)).r>0.0){d.yw=searchDiag2(texCoord,vec2(1.0),end);d.y+=float(end.y>0.9);}else{d.yw=vec2(0.0);}if(d.x+d.y>2.0){vec4 coords=vec4(-d.x,-d.x,d.y,d.y)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.x=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).g;c.y=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(0,-1)).r;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).gr;vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.w).gr;}return weights;}float searchLength(const in vec2 e,const in float offset){vec2 scale=SEARCHTEX_SIZE*vec2(0.5,-1.0);vec2 bias=SEARCHTEX_SIZE*vec2(offset,1.0);scale+=vec2(-1.0,1.0);bias+=vec2(0.5,-0.5);scale*=1.0/SEARCHTEX_PACKED_SIZE;bias*=1.0/SEARCHTEX_PACKED_SIZE;return texture2D(searchTexture,scale*e+bias).r;}float searchXLeft(in vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x>end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(-2.0,0.0)*texelSize+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.0)+3.25;return texelSize.x*offset+texCoord.x;}float searchXRight(vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x<end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(2.0,0.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.5)+3.25;return-texelSize.x*offset+texCoord.x;}float searchYUp(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.y>end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=-vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.0)+3.25;return texelSize.y*offset+texCoord.y;}float searchYDown(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;i++){if(!(texCoord.y<end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.5)+3.25;return-texelSize.y*offset+texCoord.y;}vec2 area(const in vec2 dist,const in float e1,const in float e2,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE)*round(4.0*vec2(e1,e2))+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.y=AREATEX_SUBTEX_SIZE*offset+texCoord.y;return texture2D(areaTexture,texCoord).rg;}void detectHorizontalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){
#if !defined(DISABLE_CORNER_DETECTION)
vec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,1)).r;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).r;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,-2)).r;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,-2)).r;weights*=clamp(factor,0.0,1.0);
#endif
}void detectVerticalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){
#if !defined(DISABLE_CORNER_DETECTION)
vec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(1,0)).g;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).g;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(-2,0)).g;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(-2,1)).g;weights*=clamp(factor,0.0,1.0);
#endif
}void main(){vec4 weights=vec4(0.0);vec4 subsampleIndices=vec4(0.0);vec2 e=texture2D(inputBuffer,vUv).rg;if(e.g>0.0){
#if !defined(DISABLE_DIAG_DETECTION)
weights.rg=calculateDiagWeights(vUv,e,subsampleIndices);if(weights.r==-weights.g){
#endif
vec2 d;vec3 coords;coords.x=searchXLeft(vOffset[0].xy,vOffset[2].x);coords.y=vOffset[1].y;d.x=coords.x;float e1=texture2D(inputBuffer,coords.xy).r;coords.z=searchXRight(vOffset[0].zw,vOffset[2].y);d.y=coords.z;d=round(resolution.xx*d+-vPixCoord.xx);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.zy,vec2(1,0)).r;weights.rg=area(sqrtD,e1,e2,subsampleIndices.y);coords.y=vUv.y;detectHorizontalCornerPattern(weights.rg,coords.xyzy,d);
#if !defined(DISABLE_DIAG_DETECTION)
}else{e.r=0.0;}
#endif
}if(e.r>0.0){vec2 d;vec3 coords;coords.y=searchYUp(vOffset[1].xy,vOffset[2].z);coords.x=vOffset[0].x;d.x=coords.y;float e1=texture2D(inputBuffer,coords.xy).g;coords.z=searchYDown(vOffset[1].zw,vOffset[2].w);d.y=coords.z;d=round(resolution.yy*d-vPixCoord.yy);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.xz,vec2(0,1)).g;weights.ba=area(sqrtD,e1,e2,subsampleIndices.x);coords.x=vUv.x;detectVerticalCornerPattern(weights.ba,coords.xyxz,d);}gl_FragColor=weights;}`,v9="uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void main(){vUv=position.xy*0.5+0.5;vPixCoord=vUv*resolution;vOffset[0]=vUv.xyxy+texelSize.xyxy*vec4(-0.25,-0.125,1.25,-0.125);vOffset[1]=vUv.xyxy+texelSize.xyxy*vec4(-0.125,-0.25,-0.125,1.25);vOffset[2]=vec4(vOffset[0].xz,vOffset[1].yw)+vec4(-2.0,2.0,-2.0,2.0)*texelSize.xxyy*MAX_SEARCH_STEPS_FLOAT;gl_Position=vec4(position.xy,1.0,1.0);}",y9=class extends Bt{constructor(n=new te,e=new te){super({name:"SMAAWeightsMaterial",defines:{MAX_SEARCH_STEPS_INT:"16",MAX_SEARCH_STEPS_FLOAT:"16.0",MAX_SEARCH_STEPS_DIAG_INT:"8",MAX_SEARCH_STEPS_DIAG_FLOAT:"8.0",CORNER_ROUNDING:"25",CORNER_ROUNDING_NORM:"0.25",AREATEX_MAX_DISTANCE:"16.0",AREATEX_MAX_DISTANCE_DIAG:"20.0",AREATEX_PIXEL_SIZE:"(1.0 / vec2(160.0, 560.0))",AREATEX_SUBTEX_SIZE:"(1.0 / 7.0)",SEARCHTEX_SIZE:"vec2(66.0, 33.0)",SEARCHTEX_PACKED_SIZE:"vec2(64.0, 16.0)"},uniforms:{inputBuffer:new xe(null),searchTexture:new xe(null),areaTexture:new xe(null),resolution:new xe(e),texelSize:new xe(n)},blending:qi,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:A9,vertexShader:v9})}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}get searchTexture(){return this.uniforms.searchTexture.value}set searchTexture(n){this.uniforms.searchTexture.value=n}get areaTexture(){return this.uniforms.areaTexture.value}set areaTexture(n){this.uniforms.areaTexture.value=n}setLookupTextures(n,e){this.searchTexture=n,this.areaTexture=e}get orthogonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_INT)}set orthogonalSearchSteps(n){const e=Math.min(Math.max(n,0),112);this.defines.MAX_SEARCH_STEPS_INT=e.toFixed("0"),this.defines.MAX_SEARCH_STEPS_FLOAT=e.toFixed("1"),this.needsUpdate=!0}setOrthogonalSearchSteps(n){this.orthogonalSearchSteps=n}get diagonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_DIAG_INT)}set diagonalSearchSteps(n){const e=Math.min(Math.max(n,0),20);this.defines.MAX_SEARCH_STEPS_DIAG_INT=e.toFixed("0"),this.defines.MAX_SEARCH_STEPS_DIAG_FLOAT=e.toFixed("1"),this.needsUpdate=!0}setDiagonalSearchSteps(n){this.diagonalSearchSteps=n}get diagonalDetection(){return this.defines.DISABLE_DIAG_DETECTION===void 0}set diagonalDetection(n){n?delete this.defines.DISABLE_DIAG_DETECTION:this.defines.DISABLE_DIAG_DETECTION="1",this.needsUpdate=!0}isDiagonalDetectionEnabled(){return this.diagonalDetection}setDiagonalDetectionEnabled(n){this.diagonalDetection=n}get cornerRounding(){return Number(this.defines.CORNER_ROUNDING)}set cornerRounding(n){const e=Math.min(Math.max(n,0),100);this.defines.CORNER_ROUNDING=e.toFixed("4"),this.defines.CORNER_ROUNDING_NORM=(e/100).toFixed("4"),this.needsUpdate=!0}setCornerRounding(n){this.cornerRounding=n}get cornerDetection(){return this.defines.DISABLE_CORNER_DETECTION===void 0}set cornerDetection(n){n?delete this.defines.DISABLE_CORNER_DETECTION:this.defines.DISABLE_CORNER_DETECTION="1",this.needsUpdate=!0}isCornerRoundingEnabled(){return this.cornerDetection}setCornerRoundingEnabled(n){this.cornerDetection=n}setSize(n,e){const t=this.uniforms;t.texelSize.value.set(1/n,1/e),t.resolution.value.set(n,e)}},b9=`#include <common>
#include <packing>
#ifdef NORMAL_DEPTH
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D normalDepthBuffer;
#else
uniform mediump sampler2D normalDepthBuffer;
#endif
float readDepth(const in vec2 uv){return texture2D(normalDepthBuffer,uv).a;}
#else
uniform lowp sampler2D normalBuffer;
#if DEPTH_PACKING == 3201
uniform lowp sampler2D depthBuffer;
#elif defined(GL_FRAGMENT_PRECISION_HIGH)
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}
#endif
uniform lowp sampler2D noiseTexture;uniform mat4 inverseProjectionMatrix;uniform mat4 projectionMatrix;uniform vec2 texelSize;uniform vec2 cameraNearFar;uniform float intensity;uniform float minRadiusScale;uniform float fade;uniform float bias;uniform vec2 distanceCutoff;uniform vec2 proximityCutoff;varying vec2 vUv;varying vec2 vUv2;float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#else
return orthographicDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#endif
}vec3 getViewPosition(const in vec2 screenPosition,const in float depth,const in float viewZ){vec4 clipPosition=vec4(vec3(screenPosition,depth)*2.0-1.0,1.0);float clipW=projectionMatrix[2][3]*viewZ+projectionMatrix[3][3];clipPosition*=clipW;return(inverseProjectionMatrix*clipPosition).xyz;}float getAmbientOcclusion(const in vec3 p,const in vec3 n,const in float depth,const in vec2 uv){float radiusScale=1.0-smoothstep(0.0,distanceCutoff.y,depth);radiusScale=radiusScale*(1.0-minRadiusScale)+minRadiusScale;float radius=RADIUS*radiusScale;float noise=texture2D(noiseTexture,vUv2).r;float baseAngle=noise*PI2;float rings=SPIRAL_TURNS*PI2;float occlusion=0.0;int taps=0;for(int i=0;i<SAMPLES_INT;++i){float alpha=(float(i)+0.5)*INV_SAMPLES_FLOAT;float angle=alpha*rings+baseAngle;vec2 rotation=vec2(cos(angle),sin(angle));vec2 coords=alpha*radius*rotation*texelSize+uv;if(coords.s<0.0||coords.s>1.0||coords.t<0.0||coords.t>1.0){continue;}float sampleDepth=readDepth(coords);float viewZ=getViewZ(sampleDepth);
#ifdef PERSPECTIVE_CAMERA
float linearSampleDepth=viewZToOrthographicDepth(viewZ,cameraNearFar.x,cameraNearFar.y);
#else
float linearSampleDepth=sampleDepth;
#endif
float proximity=abs(depth-linearSampleDepth);if(proximity<proximityCutoff.y){float falloff=1.0-smoothstep(proximityCutoff.x,proximityCutoff.y,proximity);vec3 Q=getViewPosition(coords,sampleDepth,viewZ);vec3 v=Q-p;float vv=dot(v,v);float vn=dot(v,n)-bias;float f=max(RADIUS_SQ-vv,0.0)/RADIUS_SQ;occlusion+=(f*f*f*max(vn/(fade+vv),0.0))*falloff;}++taps;}return occlusion/(4.0*max(float(taps),1.0));}void main(){
#ifdef NORMAL_DEPTH
vec4 normalDepth=texture2D(normalDepthBuffer,vUv);
#else
vec4 normalDepth=vec4(texture2D(normalBuffer,vUv).xyz,readDepth(vUv));
#endif
float ao=0.0;float depth=normalDepth.a;float viewZ=getViewZ(depth);
#ifdef PERSPECTIVE_CAMERA
float linearDepth=viewZToOrthographicDepth(viewZ,cameraNearFar.x,cameraNearFar.y);
#else
float linearDepth=depth;
#endif
if(linearDepth<distanceCutoff.y){vec3 viewPosition=getViewPosition(vUv,depth,viewZ);vec3 viewNormal=unpackRGBToNormal(normalDepth.rgb);ao+=getAmbientOcclusion(viewPosition,viewNormal,linearDepth,vUv);float d=smoothstep(distanceCutoff.x,distanceCutoff.y,linearDepth);ao=mix(ao,0.0,d);
#ifdef LEGACY_INTENSITY
ao=clamp(1.0-pow(1.0-ao,abs(intensity)),0.0,1.0);
#endif
}gl_FragColor.r=ao;}`,_9="uniform vec2 noiseScale;varying vec2 vUv;varying vec2 vUv2;void main(){vUv=position.xy*0.5+0.5;vUv2=vUv*noiseScale;gl_Position=vec4(position.xy,1.0,1.0);}",x9=class extends Bt{constructor(n){super({name:"SSAOMaterial",defines:{SAMPLES_INT:"0",INV_SAMPLES_FLOAT:"0.0",SPIRAL_TURNS:"0.0",RADIUS:"1.0",RADIUS_SQ:"1.0",DISTANCE_SCALING:"1",DEPTH_PACKING:"0"},uniforms:{depthBuffer:new xe(null),normalBuffer:new xe(null),normalDepthBuffer:new xe(null),noiseTexture:new xe(null),inverseProjectionMatrix:new xe(new Ie),projectionMatrix:new xe(new Ie),texelSize:new xe(new te),cameraNearFar:new xe(new te),distanceCutoff:new xe(new te),proximityCutoff:new xe(new te),noiseScale:new xe(new te),minRadiusScale:new xe(.33),intensity:new xe(1),fade:new xe(.01),bias:new xe(0)},blending:qi,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:b9,vertexShader:_9}),this.copyCameraSettings(n),this.resolution=new te,this.r=1}get near(){return this.uniforms.cameraNearFar.value.x}get far(){return this.uniforms.cameraNearFar.value.y}set normalDepthBuffer(n){this.uniforms.normalDepthBuffer.value=n,n!==null?this.defines.NORMAL_DEPTH="1":delete this.defines.NORMAL_DEPTH,this.needsUpdate=!0}setNormalDepthBuffer(n){this.normalDepthBuffer=n}set normalBuffer(n){this.uniforms.normalBuffer.value=n}setNormalBuffer(n){this.uniforms.normalBuffer.value=n}set depthBuffer(n){this.uniforms.depthBuffer.value=n}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer(n,e=hs){this.depthBuffer=n,this.depthPacking=e}set noiseTexture(n){this.uniforms.noiseTexture.value=n}setNoiseTexture(n){this.uniforms.noiseTexture.value=n}get samples(){return Number(this.defines.SAMPLES_INT)}set samples(n){this.defines.SAMPLES_INT=n.toFixed(0),this.defines.INV_SAMPLES_FLOAT=(1/n).toFixed(9),this.needsUpdate=!0}getSamples(){return this.samples}setSamples(n){this.samples=n}get rings(){return Number(this.defines.SPIRAL_TURNS)}set rings(n){this.defines.SPIRAL_TURNS=n.toFixed(1),this.needsUpdate=!0}getRings(){return this.rings}setRings(n){this.rings=n}get intensity(){return this.uniforms.intensity.value}set intensity(n){this.uniforms.intensity.value=n,this.defines.LEGACY_INTENSITY===void 0&&(this.defines.LEGACY_INTENSITY="1",this.needsUpdate=!0)}getIntensity(){return this.uniforms.intensity.value}setIntensity(n){this.uniforms.intensity.value=n}get fade(){return this.uniforms.fade.value}set fade(n){this.uniforms.fade.value=n}getFade(){return this.uniforms.fade.value}setFade(n){this.uniforms.fade.value=n}get bias(){return this.uniforms.bias.value}set bias(n){this.uniforms.bias.value=n}getBias(){return this.uniforms.bias.value}setBias(n){this.uniforms.bias.value=n}get minRadiusScale(){return this.uniforms.minRadiusScale.value}set minRadiusScale(n){this.uniforms.minRadiusScale.value=n}getMinRadiusScale(){return this.uniforms.minRadiusScale.value}setMinRadiusScale(n){this.uniforms.minRadiusScale.value=n}updateRadius(){const n=this.r*this.resolution.height;this.defines.RADIUS=n.toFixed(11),this.defines.RADIUS_SQ=(n*n).toFixed(11),this.needsUpdate=!0}get radius(){return this.r}set radius(n){this.r=Math.min(Math.max(n,1e-6),1),this.updateRadius()}getRadius(){return this.radius}setRadius(n){this.radius=n}get distanceScaling(){return!0}set distanceScaling(n){}isDistanceScalingEnabled(){return this.distanceScaling}setDistanceScalingEnabled(n){this.distanceScaling=n}get distanceThreshold(){return this.uniforms.distanceCutoff.value.x}set distanceThreshold(n){this.uniforms.distanceCutoff.value.set(Math.min(Math.max(n,0),1),Math.min(Math.max(n+this.distanceFalloff,0),1))}get worldDistanceThreshold(){return-qd(this.distanceThreshold,this.near,this.far)}set worldDistanceThreshold(n){this.distanceThreshold=au(-n,this.near,this.far)}get distanceFalloff(){return this.uniforms.distanceCutoff.value.y-this.distanceThreshold}set distanceFalloff(n){this.uniforms.distanceCutoff.value.y=Math.min(Math.max(this.distanceThreshold+n,0),1)}get worldDistanceFalloff(){return-qd(this.distanceFalloff,this.near,this.far)}set worldDistanceFalloff(n){this.distanceFalloff=au(-n,this.near,this.far)}setDistanceCutoff(n,e){this.uniforms.distanceCutoff.value.set(Math.min(Math.max(n,0),1),Math.min(Math.max(n+e,0),1))}get proximityThreshold(){return this.uniforms.proximityCutoff.value.x}set proximityThreshold(n){this.uniforms.proximityCutoff.value.set(Math.min(Math.max(n,0),1),Math.min(Math.max(n+this.proximityFalloff,0),1))}get worldProximityThreshold(){return-qd(this.proximityThreshold,this.near,this.far)}set worldProximityThreshold(n){this.proximityThreshold=au(-n,this.near,this.far)}get proximityFalloff(){return this.uniforms.proximityCutoff.value.y-this.proximityThreshold}set proximityFalloff(n){this.uniforms.proximityCutoff.value.y=Math.min(Math.max(this.proximityThreshold+n,0),1)}get worldProximityFalloff(){return-qd(this.proximityFalloff,this.near,this.far)}set worldProximityFalloff(n){this.proximityFalloff=au(-n,this.near,this.far)}setProximityCutoff(n,e){this.uniforms.proximityCutoff.value.set(Math.min(Math.max(n,0),1),Math.min(Math.max(n+e,0),1))}setTexelSize(n,e){this.uniforms.texelSize.value.set(n,e)}adoptCameraSettings(n){this.copyCameraSettings(n)}copyCameraSettings(n){n&&(this.uniforms.cameraNearFar.value.set(n.near,n.far),this.uniforms.projectionMatrix.value.copy(n.projectionMatrix),this.uniforms.inverseProjectionMatrix.value.copy(n.projectionMatrix).invert(),n instanceof qt?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(n,e){const t=this.uniforms,i=t.noiseTexture.value;i!==null&&t.noiseScale.value.set(n/i.image.width,e/i.image.height),t.texelSize.value.set(1/n,1/e),this.resolution.set(n,e),this.updateRadius()}},w9=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform vec4 maskParams;varying vec2 vUv;varying vec2 vUv2;varying vec2 vOffset;float linearGradientMask(const in float x){return smoothstep(maskParams.x,maskParams.y,x)-smoothstep(maskParams.w,maskParams.z,x);}void main(){vec2 dUv=vOffset*(1.0-linearGradientMask(vUv2.y));vec4 sum=texture2D(inputBuffer,vec2(vUv.x-dUv.x,vUv.y+dUv.y));sum+=texture2D(inputBuffer,vec2(vUv.x+dUv.x,vUv.y+dUv.y));sum+=texture2D(inputBuffer,vec2(vUv.x+dUv.x,vUv.y-dUv.y));sum+=texture2D(inputBuffer,vec2(vUv.x-dUv.x,vUv.y-dUv.y));gl_FragColor=sum*0.25;
#include <colorspace_fragment>
}`,S9="uniform vec4 texelSize;uniform float kernel;uniform float scale;uniform float aspect;uniform vec2 rotation;varying vec2 vUv;varying vec2 vUv2;varying vec2 vOffset;void main(){vec2 uv=position.xy*0.5+0.5;vUv=uv;vUv2=(uv-0.5)*2.0*vec2(aspect,1.0);vUv2=vec2(dot(rotation,vUv2),dot(rotation,vec2(vUv2.y,-vUv2.x)));vOffset=(texelSize.xy*vec2(kernel)+texelSize.zw)*scale;gl_Position=vec4(position.xy,1.0,1.0);}",C9=class extends eF{constructor({kernelSize:n=Ql.MEDIUM,offset:e=0,rotation:t=0,focusArea:i=.4,feather:s=.3}={}){super(),this.fragmentShader=w9,this.vertexShader=S9,this.kernelSize=n,this.fragmentShader=np(this.fragmentShader),this.uniforms.aspect=new xe(1),this.uniforms.rotation=new xe(new te),this.uniforms.maskParams=new xe(new Ke),this._offset=e,this._focusArea=i,this._feather=s,this.rotation=t,this.updateParams()}updateParams(){const n=this.uniforms.maskParams.value,e=Math.max(this.focusArea,0),t=Math.max(e-this.feather,0);n.set(this.offset-e,this.offset-t,this.offset+e,this.offset+t)}get rotation(){return Math.acos(this.uniforms.rotation.value.x)}set rotation(n){this.uniforms.rotation.value.set(Math.cos(n),Math.sin(n))}get offset(){return this._offset}set offset(n){this._offset=n,this.updateParams()}get focusArea(){return this._focusArea}set focusArea(n){this._focusArea=n,this.updateParams()}get feather(){return this._feather}set feather(n){this._feather=n,this.updateParams()}setSize(n,e){super.setSize(n,e),this.uniforms.aspect.value=n/e}},E9=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;uniform mediump sampler2D supportBuffer;
#else
uniform lowp sampler2D inputBuffer;uniform lowp sampler2D supportBuffer;
#endif
uniform float radius;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vec4 c=vec4(0.0);c+=texture2D(inputBuffer,vUv0)*0.0625;c+=texture2D(inputBuffer,vUv1)*0.125;c+=texture2D(inputBuffer,vUv2)*0.0625;c+=texture2D(inputBuffer,vUv3)*0.125;c+=texture2D(inputBuffer,vUv)*0.25;c+=texture2D(inputBuffer,vUv4)*0.125;c+=texture2D(inputBuffer,vUv5)*0.0625;c+=texture2D(inputBuffer,vUv6)*0.125;c+=texture2D(inputBuffer,vUv7)*0.0625;vec4 baseColor=texture2D(supportBuffer,vUv);gl_FragColor=mix(baseColor,c,radius);
#include <colorspace_fragment>
}`,M9="uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,1.0);vUv1=vUv+texelSize*vec2(0.0,1.0);vUv2=vUv+texelSize*vec2(1.0,1.0);vUv3=vUv+texelSize*vec2(-1.0,0.0);vUv4=vUv+texelSize*vec2(1.0,0.0);vUv5=vUv+texelSize*vec2(-1.0,-1.0);vUv6=vUv+texelSize*vec2(0.0,-1.0);vUv7=vUv+texelSize*vec2(1.0,-1.0);gl_Position=vec4(position.xy,1.0,1.0);}",T9=class extends Bt{constructor(){super({name:"UpsamplingMaterial",uniforms:{inputBuffer:new xe(null),supportBuffer:new xe(null),texelSize:new xe(new te),radius:new xe(.85)},blending:qi,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:E9,vertexShader:M9}),this.fragmentShader=np(this.fragmentShader)}set inputBuffer(n){this.uniforms.inputBuffer.value=n}set supportBuffer(n){this.uniforms.supportBuffer.value=n}get radius(){return this.uniforms.radius.value}set radius(n){this.uniforms.radius.value=n}setSize(n,e){this.uniforms.texelSize.value.set(1/n,1/e)}},I9=new qf,hc=null;function R9(){if(hc===null){const n=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),e=new Float32Array([0,0,2,0,0,2]);hc=new ft,hc.setAttribute!==void 0?(hc.setAttribute("position",new ot(n,3)),hc.setAttribute("uv",new ot(e,2))):(hc.addAttribute("position",new ot(n,3)),hc.addAttribute("uv",new ot(e,2)))}return hc}var Ps=class iF{constructor(e="Pass",t=new mr,i=I9){this.name=e,this.renderer=null,this.scene=t,this.camera=i,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(e){if(this.rtt===e){const t=this.fullscreenMaterial;t!==null&&(t.needsUpdate=!0),this.rtt=!e}}set mainScene(e){}set mainCamera(e){}setRenderer(e){this.renderer=e}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}get fullscreenMaterial(){return this.screen!==null?this.screen.material:null}set fullscreenMaterial(e){let t=this.screen;t!==null?t.material=e:(t=new ye(R9(),e),t.frustumCulled=!1,this.scene===null&&(this.scene=new mr),this.scene.add(t),this.screen=t)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(e){this.fullscreenMaterial=e}getDepthTexture(){return null}setDepthTexture(e,t=hs){}render(e,t,i,s,r){throw new Error("Render method not implemented!")}setSize(e,t){}initialize(e,t,i){}dispose(){for(const e of Object.keys(this)){const t=this[e];(t instanceof ni||t instanceof Pt||t instanceof Rt||t instanceof iF)&&this[e].dispose()}}},P9=class extends Ps{constructor(n,e=!0){super("CopyPass"),this.fullscreenMaterial=new tF,this.needsSwap=!1,this.renderTarget=n,n===void 0&&(this.renderTarget=new ni(1,1,{minFilter:Dt,magFilter:Dt,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=e}get resize(){return this.autoResize}set resize(n){this.autoResize=n}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(n){this.autoResize=n}render(n,e,t,i,s){this.fullscreenMaterial.inputBuffer=e.texture,n.setRenderTarget(this.renderToScreen?null:this.renderTarget),n.render(this.scene,this.camera)}setSize(n,e){this.autoResize&&this.renderTarget.setSize(n,e)}initialize(n,e,t){t!==void 0&&(this.renderTarget.texture.type=t,t!==fi?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":Wl(n)===vi&&lr(this.renderTarget.texture,vi))}},B9=class extends Ps{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(n,e,t,i,s){const r=n.state.buffers.stencil;r.setLocked(!1),r.setTest(!1)}},UP=new _e,f_=class extends Ps{constructor(n=!0,e=!0,t=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=n,this.depth=e,this.stencil=t,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(n,e,t){this.color=n,this.depth=e,this.stencil=t}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(n){this.overrideClearColor=n}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(n){this.overrideClearAlpha=n}render(n,e,t,i,s){const r=this.overrideClearColor,o=this.overrideClearAlpha,a=n.getClearAlpha(),l=r!==null,c=o>=0;l?(n.getClearColor(UP),n.setClearColor(r,c?o:a)):c&&n.setClearAlpha(o),n.setRenderTarget(this.renderToScreen?null:e),n.clear(this.color,this.depth,this.stencil),l?n.setClearColor(UP,a):c&&n.setClearAlpha(a)}},p_=class extends Ps{constructor(n,e,t=null){super("RenderPass",n,e),this.needsSwap=!1,this.clearPass=new f_,this.overrideMaterialManager=t===null?null:new GP(t),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}set mainScene(n){this.scene=n}set mainCamera(n){this.camera=n}get renderToScreen(){return super.renderToScreen}set renderToScreen(n){super.renderToScreen=n,this.clearPass.renderToScreen=n}get overrideMaterial(){const n=this.overrideMaterialManager;return n!==null?n.material:null}set overrideMaterial(n){const e=this.overrideMaterialManager;n!==null?e!==null?e.setMaterial(n):this.overrideMaterialManager=new GP(n):e!==null&&(e.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(n){this.overrideMaterial=n}get clear(){return this.clearPass.enabled}set clear(n){this.clearPass.enabled=n}getSelection(){return this.selection}setSelection(n){this.selection=n}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(n){this.ignoreBackground=n}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(n){this.skipShadowMapUpdate=n}getClearPass(){return this.clearPass}render(n,e,t,i,s){const r=this.scene,o=this.camera,a=this.selection,l=o.layers.mask,c=r.background,u=n.shadowMap.autoUpdate,d=this.renderToScreen?null:e;a!==null&&o.layers.set(a.getLayer()),this.skipShadowMapUpdate&&(n.shadowMap.autoUpdate=!1),(this.ignoreBackground||this.clearPass.overrideClearColor!==null)&&(r.background=null),this.clearPass.enabled&&this.clearPass.render(n,e),n.setRenderTarget(d),this.overrideMaterialManager!==null?this.overrideMaterialManager.render(n,r,o):n.render(r,o),o.layers.mask=l,r.background=c,n.shadowMap.autoUpdate=u}},D9=class extends Ps{constructor(n,e,{renderTarget:t,resolutionScale:i=1,width:s=gi.AUTO_SIZE,height:r=gi.AUTO_SIZE,resolutionX:o=s,resolutionY:a=r}={}){super("DepthPass"),this.needsSwap=!1,this.renderPass=new p_(n,e,new Tb({depthPacking:_b}));const l=this.renderPass;l.skipShadowMapUpdate=!0,l.ignoreBackground=!0;const c=l.clearPass;c.overrideClearColor=new _e(16777215),c.overrideClearAlpha=1,this.renderTarget=t,this.renderTarget===void 0&&(this.renderTarget=new ni(1,1,{minFilter:Ft,magFilter:Ft}),this.renderTarget.texture.name="DepthPass.Target");const u=this.resolution=new gi(this,o,a,i);u.addEventListener("change",d=>this.setSize(u.baseWidth,u.baseHeight))}set mainScene(n){this.renderPass.mainScene=n}set mainCamera(n){this.renderPass.mainCamera=n}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(n){this.resolution.scale=n}render(n,e,t,i,s){const r=this.renderToScreen?null:this.renderTarget;this.renderPass.render(n,r)}setSize(n,e){const t=this.resolution;t.setBaseSize(n,e),this.renderTarget.setSize(t.width,t.height)}},rT=class extends Ps{constructor({normalBuffer:n=null,resolutionScale:e=.5,width:t=gi.AUTO_SIZE,height:i=gi.AUTO_SIZE,resolutionX:s=t,resolutionY:r=i}={}){super("DepthDownsamplingPass");const o=new t9;o.normalBuffer=n,this.fullscreenMaterial=o,this.needsDepthTexture=!0,this.needsSwap=!1,this.renderTarget=new ni(1,1,{minFilter:Ft,magFilter:Ft,depthBuffer:!1,type:sn}),this.renderTarget.texture.name="DepthDownsamplingPass.Target",this.renderTarget.texture.generateMipmaps=!1;const a=this.resolution=new gi(this,s,r,e);a.addEventListener("change",l=>this.setSize(a.baseWidth,a.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}setDepthTexture(n,e=hs){this.fullscreenMaterial.depthBuffer=n,this.fullscreenMaterial.depthPacking=e}render(n,e,t,i,s){n.setRenderTarget(this.renderToScreen?null:this.renderTarget),n.render(this.scene,this.camera)}setSize(n,e){const t=this.resolution;t.setBaseSize(n,e),this.renderTarget.setSize(t.width,t.height),this.fullscreenMaterial.setSize(n,e)}initialize(n,e,t){const i=n.getContext();if(!(i.getExtension("EXT_color_buffer_float")||i.getExtension("EXT_color_buffer_half_float")))throw new Error("Rendering to float texture is not supported.")}};function NP(n,e,t){for(const i of e){const s="$1"+n+i.charAt(0).toUpperCase()+i.slice(1),r=new RegExp("([^\\.])(\\b"+i+"\\b)","g");for(const o of t.entries())o[1]!==null&&t.set(o[0],o[1].replace(r,s))}}function O9(n,e,t){let i=e.getFragmentShader(),s=e.getVertexShader();const r=i!==void 0&&/mainImage/.test(i),o=i!==void 0&&/mainUv/.test(i);if(t.attributes|=e.getAttributes(),i===void 0)throw new Error(`Missing fragment shader (${e.name})`);if(o&&t.attributes&Ur.CONVOLUTION)throw new Error(`Effects that transform UVs are incompatible with convolution effects (${e.name})`);if(!r&&!o)throw new Error(`Could not find mainImage or mainUv function (${e.name})`);{const a=/\w+\s+(\w+)\([\w\s,]*\)\s*{/g,l=t.shaderParts;let c=l.get(oi.FRAGMENT_HEAD)||"",u=l.get(oi.FRAGMENT_MAIN_UV)||"",d=l.get(oi.FRAGMENT_MAIN_IMAGE)||"",f=l.get(oi.VERTEX_HEAD)||"",p=l.get(oi.VERTEX_MAIN_SUPPORT)||"";const g=new Set,A=new Set;if(o&&(u+=`	${n}MainUv(UV);
`,t.uvTransformation=!0),s!==null&&/mainSupport/.test(s)){const b=/mainSupport *\([\w\s]*?uv\s*?\)/.test(s);p+=`	${n}MainSupport(`,p+=b?`vUv);
`:`);
`;for(const y of s.matchAll(/(?:varying\s+\w+\s+([\S\s]*?);)/g))for(const _ of y[1].split(/\s*,\s*/))t.varyings.add(_),g.add(_),A.add(_);for(const y of s.matchAll(a))A.add(y[1])}for(const b of i.matchAll(a))A.add(b[1]);for(const b of e.defines.keys())A.add(b.replace(/\([\w\s,]*\)/g,""));for(const b of e.uniforms.keys())A.add(b);A.delete("while"),A.delete("for"),A.delete("if"),e.uniforms.forEach((b,y)=>t.uniforms.set(n+y.charAt(0).toUpperCase()+y.slice(1),b)),e.defines.forEach((b,y)=>t.defines.set(n+y.charAt(0).toUpperCase()+y.slice(1),b));const v=new Map([["fragment",i],["vertex",s]]);NP(n,A,t.defines),NP(n,A,v),i=v.get("fragment"),s=v.get("vertex");const m=e.blendMode;if(t.blendModes.set(m.blendFunction,m),r){e.inputColorSpace!==null&&e.inputColorSpace!==t.colorSpace&&(d+=e.inputColorSpace===vi?`color0 = LinearTosRGB(color0);
	`:`color0 = sRGBToLinear(color0);
	`),e.outputColorSpace!==J2?t.colorSpace=e.outputColorSpace:e.inputColorSpace!==null&&(t.colorSpace=e.inputColorSpace);const b=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/;d+=`${n}MainImage(color0, UV, `,t.attributes&Ur.DEPTH&&b.test(i)&&(d+="depth, ",t.readDepth=!0),d+=`color1);
	`;const y=n+"BlendOpacity";t.uniforms.set(y,m.opacity),d+=`color0 = blend${m.blendFunction}(color0, color1, ${y});

	`,c+=`uniform float ${y};

`}if(c+=i+`
`,s!==null&&(f+=s+`
`),l.set(oi.FRAGMENT_HEAD,c),l.set(oi.FRAGMENT_MAIN_UV,u),l.set(oi.FRAGMENT_MAIN_IMAGE,d),l.set(oi.VERTEX_HEAD,f),l.set(oi.VERTEX_MAIN_SUPPORT,p),e.extensions!==null)for(const b of e.extensions)t.extensions.add(b)}}var zP=class extends Ps{constructor(n,...e){super("EffectPass"),this.fullscreenMaterial=new d9(null,null,null,n),this.listener=t=>this.handleEvent(t),this.effects=[],this.setEffects(e),this.skipRendering=!1,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY,this.timeScale=1}set mainScene(n){for(const e of this.effects)e.mainScene=n}set mainCamera(n){this.fullscreenMaterial.copyCameraSettings(n);for(const e of this.effects)e.mainCamera=n}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(n){this.fullscreenMaterial.encodeOutput=n}get dithering(){return this.fullscreenMaterial.dithering}set dithering(n){const e=this.fullscreenMaterial;e.dithering=n,e.needsUpdate=!0}setEffects(n){for(const e of this.effects)e.removeEventListener("change",this.listener);this.effects=n.sort((e,t)=>t.attributes-e.attributes);for(const e of this.effects)e.addEventListener("change",this.listener)}updateMaterial(){const n=new G9;let e=0;for(const o of this.effects)if(o.blendMode.blendFunction===Ot.DST)n.attributes|=o.getAttributes()&Ur.DEPTH;else{if(n.attributes&o.getAttributes()&Ur.CONVOLUTION)throw new Error(`Convolution effects cannot be merged (${o.name})`);O9("e"+e++,o,n)}let t=n.shaderParts.get(oi.FRAGMENT_HEAD),i=n.shaderParts.get(oi.FRAGMENT_MAIN_IMAGE),s=n.shaderParts.get(oi.FRAGMENT_MAIN_UV);const r=/\bblend\b/g;for(const o of n.blendModes.values())t+=o.getShaderCode().replace(r,`blend${o.blendFunction}`)+`
`;n.attributes&Ur.DEPTH?(n.readDepth&&(i=`float depth = readDepth(UV);

	`+i),this.needsDepthTexture=this.getDepthTexture()===null):this.needsDepthTexture=!1,n.colorSpace===vi&&(i+=`color0 = sRGBToLinear(color0);
	`),n.uvTransformation?(s=`vec2 transformedUv = vUv;
`+s,n.defines.set("UV","transformedUv")):n.defines.set("UV","vUv"),n.shaderParts.set(oi.FRAGMENT_HEAD,t),n.shaderParts.set(oi.FRAGMENT_MAIN_IMAGE,i),n.shaderParts.set(oi.FRAGMENT_MAIN_UV,s);for(const[o,a]of n.shaderParts)a!==null&&n.shaderParts.set(o,a.trim().replace(/^#/,`
#`));this.skipRendering=e===0,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderData(n)}recompile(){this.updateMaterial()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(n,e=hs){this.fullscreenMaterial.depthBuffer=n,this.fullscreenMaterial.depthPacking=e;for(const t of this.effects)t.setDepthTexture(n,e)}render(n,e,t,i,s){for(const r of this.effects)r.update(n,e,i);if(!this.skipRendering||this.renderToScreen){const r=this.fullscreenMaterial;r.inputBuffer=e.texture,r.time+=i*this.timeScale,n.setRenderTarget(this.renderToScreen?null:t),n.render(this.scene,this.camera)}}setSize(n,e){this.fullscreenMaterial.setSize(n,e);for(const t of this.effects)t.setSize(n,e)}initialize(n,e,t){this.renderer=n;for(const i of this.effects)i.initialize(n,e,t);this.updateMaterial(),t!==void 0&&t!==fi&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(const n of this.effects)n.removeEventListener("change",this.listener),n.dispose()}handleEvent(n){switch(n.type){case"change":this.recompile();break}}},oT=class extends Ps{constructor({kernelSize:n=Ql.MEDIUM,resolutionScale:e=.5,width:t=gi.AUTO_SIZE,height:i=gi.AUTO_SIZE,resolutionX:s=t,resolutionY:r=i}={}){super("KawaseBlurPass"),this.renderTargetA=new ni(1,1,{depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="Blur.Target.B";const o=this.resolution=new gi(this,s,r,e);o.addEventListener("change",a=>this.setSize(o.baseWidth,o.baseHeight)),this._blurMaterial=new eF,this._blurMaterial.kernelSize=n,this.copyMaterial=new tF}getResolution(){return this.resolution}get blurMaterial(){return this._blurMaterial}set blurMaterial(n){this._blurMaterial=n}get dithering(){return this.copyMaterial.dithering}set dithering(n){this.copyMaterial.dithering=n}get kernelSize(){return this.blurMaterial.kernelSize}set kernelSize(n){this.blurMaterial.kernelSize=n}get width(){return this.resolution.width}set width(n){this.resolution.preferredWidth=n}get height(){return this.resolution.height}set height(n){this.resolution.preferredHeight=n}get scale(){return this.blurMaterial.scale}set scale(n){this.blurMaterial.scale=n}getScale(){return this.blurMaterial.scale}setScale(n){this.blurMaterial.scale=n}getKernelSize(){return this.kernelSize}setKernelSize(n){this.kernelSize=n}getResolutionScale(){return this.resolution.scale}setResolutionScale(n){this.resolution.scale=n}render(n,e,t,i,s){const r=this.scene,o=this.camera,a=this.renderTargetA,l=this.renderTargetB,c=this.blurMaterial,u=c.kernelSequence;let d=e;this.fullscreenMaterial=c;for(let f=0,p=u.length;f<p;++f){const g=f&1?l:a;c.kernel=u[f],c.inputBuffer=d.texture,n.setRenderTarget(g),n.render(r,o),d=g}this.fullscreenMaterial=this.copyMaterial,this.copyMaterial.inputBuffer=d.texture,n.setRenderTarget(this.renderToScreen?null:t),n.render(r,o)}setSize(n,e){const t=this.resolution;t.setBaseSize(n,e);const i=t.width,s=t.height;this.renderTargetA.setSize(i,s),this.renderTargetB.setSize(i,s),this.blurMaterial.setSize(n,e)}initialize(n,e,t){t!==void 0&&(this.renderTargetA.texture.type=t,this.renderTargetB.texture.type=t,t!==fi?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.copyMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):Wl(n)===vi&&(lr(this.renderTargetA.texture,vi),lr(this.renderTargetB.texture,vi)))}static get AUTO_SIZE(){return gi.AUTO_SIZE}},k9=class extends Ps{constructor({renderTarget:n,luminanceRange:e,colorOutput:t,resolutionScale:i=1,width:s=gi.AUTO_SIZE,height:r=gi.AUTO_SIZE,resolutionX:o=s,resolutionY:a=r}={}){super("LuminancePass"),this.fullscreenMaterial=new p9(t,e),this.needsSwap=!1,this.renderTarget=n,this.renderTarget===void 0&&(this.renderTarget=new ni(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="LuminancePass.Target");const l=this.resolution=new gi(this,o,a,i);l.addEventListener("change",c=>this.setSize(l.baseWidth,l.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}render(n,e,t,i,s){const r=this.fullscreenMaterial;r.inputBuffer=e.texture,n.setRenderTarget(this.renderToScreen?null:this.renderTarget),n.render(this.scene,this.camera)}setSize(n,e){const t=this.resolution;t.setBaseSize(n,e),this.renderTarget.setSize(t.width,t.height)}initialize(n,e,t){t!==void 0&&t!==fi&&(this.renderTarget.texture.type=t,this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},L9=class extends Ps{constructor(n,e){super("MaskPass",n,e),this.needsSwap=!1,this.clearPass=new f_(!1,!1,!0),this.inverse=!1}set mainScene(n){this.scene=n}set mainCamera(n){this.camera=n}get inverted(){return this.inverse}set inverted(n){this.inverse=n}get clear(){return this.clearPass.enabled}set clear(n){this.clearPass.enabled=n}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(n){this.inverted=n}render(n,e,t,i,s){const r=n.getContext(),o=n.state.buffers,a=this.scene,l=this.camera,c=this.clearPass,u=this.inverted?0:1,d=1-u;o.color.setMask(!1),o.depth.setMask(!1),o.color.setLocked(!0),o.depth.setLocked(!0),o.stencil.setTest(!0),o.stencil.setOp(r.REPLACE,r.REPLACE,r.REPLACE),o.stencil.setFunc(r.ALWAYS,u,4294967295),o.stencil.setClear(d),o.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?c.render(n,null):(c.render(n,e),c.render(n,t))),this.renderToScreen?(n.setRenderTarget(null),n.render(a,l)):(n.setRenderTarget(e),n.render(a,l),n.setRenderTarget(t),n.render(a,l)),o.color.setLocked(!1),o.depth.setLocked(!1),o.stencil.setLocked(!1),o.stencil.setFunc(r.EQUAL,1,4294967295),o.stencil.setOp(r.KEEP,r.KEEP,r.KEEP),o.stencil.setLocked(!0)}},F9=class extends Ps{constructor(){super("MipmapBlurPass"),this.needsSwap=!1,this.renderTarget=new ni(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Upsampling.Mipmap0",this.downsamplingMipmaps=[],this.upsamplingMipmaps=[],this.downsamplingMaterial=new o9,this.upsamplingMaterial=new T9,this.resolution=new te}get texture(){return this.renderTarget.texture}get levels(){return this.downsamplingMipmaps.length}set levels(n){if(this.levels!==n){const e=this.renderTarget;this.dispose(),this.downsamplingMipmaps=[],this.upsamplingMipmaps=[];for(let t=0;t<n;++t){const i=e.clone();i.texture.name="Downsampling.Mipmap"+t,this.downsamplingMipmaps.push(i)}this.upsamplingMipmaps.push(e);for(let t=1,i=n-1;t<i;++t){const s=e.clone();s.texture.name="Upsampling.Mipmap"+t,this.upsamplingMipmaps.push(s)}this.setSize(this.resolution.x,this.resolution.y)}}get radius(){return this.upsamplingMaterial.radius}set radius(n){this.upsamplingMaterial.radius=n}render(n,e,t,i,s){const{scene:r,camera:o}=this,{downsamplingMaterial:a,upsamplingMaterial:l}=this,{downsamplingMipmaps:c,upsamplingMipmaps:u}=this;let d=e;this.fullscreenMaterial=a;for(let f=0,p=c.length;f<p;++f){const g=c[f];a.setSize(d.width,d.height),a.inputBuffer=d.texture,n.setRenderTarget(g),n.render(r,o),d=g}this.fullscreenMaterial=l;for(let f=u.length-1;f>=0;--f){const p=u[f];l.setSize(d.width,d.height),l.inputBuffer=d.texture,l.supportBuffer=c[f].texture,n.setRenderTarget(p),n.render(r,o),d=p}}setSize(n,e){const t=this.resolution;t.set(n,e);let i=t.width,s=t.height;for(let r=0,o=this.downsamplingMipmaps.length;r<o;++r)i=Math.round(i*.5),s=Math.round(s*.5),this.downsamplingMipmaps[r].setSize(i,s),r<this.upsamplingMipmaps.length&&this.upsamplingMipmaps[r].setSize(i,s)}initialize(n,e,t){if(t!==void 0){const i=this.downsamplingMipmaps.concat(this.upsamplingMipmaps);for(const s of i)s.texture.type=t;if(t!==fi)this.downsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.upsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1";else if(Wl(n)===vi)for(const s of i)lr(s.texture,vi)}}dispose(){super.dispose();for(const n of this.downsamplingMipmaps.concat(this.upsamplingMipmaps))n.dispose()}},nF=class extends Ps{constructor(n,e,{renderTarget:t,resolutionScale:i=1,width:s=gi.AUTO_SIZE,height:r=gi.AUTO_SIZE,resolutionX:o=s,resolutionY:a=r}={}){super("NormalPass"),this.needsSwap=!1,this.renderPass=new p_(n,e,new yM);const l=this.renderPass;l.ignoreBackground=!0,l.skipShadowMapUpdate=!0;const c=l.getClearPass();c.overrideClearColor=new _e(7829503),c.overrideClearAlpha=1,this.renderTarget=t,this.renderTarget===void 0&&(this.renderTarget=new ni(1,1,{minFilter:Ft,magFilter:Ft}),this.renderTarget.texture.name="NormalPass.Target");const u=this.resolution=new gi(this,o,a,i);u.addEventListener("change",d=>this.setSize(u.baseWidth,u.baseHeight))}set mainScene(n){this.renderPass.mainScene=n}set mainCamera(n){this.renderPass.mainCamera=n}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(n){this.resolution.scale=n}render(n,e,t,i,s){const r=this.renderToScreen?null:this.renderTarget;this.renderPass.render(n,r,r)}setSize(n,e){const t=this.resolution;t.setBaseSize(n,e),this.renderTarget.setSize(t.width,t.height)}},_a=class extends Ps{constructor(n,e="inputBuffer"){super("ShaderPass"),this.fullscreenMaterial=n,this.input=e}setInput(n){this.input=n}render(n,e,t,i,s){const r=this.fullscreenMaterial.uniforms;e!==null&&r!==void 0&&r[this.input]!==void 0&&(r[this.input].value=e.texture),n.setRenderTarget(this.renderToScreen?null:t),n.render(this.scene,this.camera)}initialize(n,e,t){t!==void 0&&t!==fi&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},U9=class extends oT{constructor({offset:n=0,rotation:e=0,focusArea:t=.4,feather:i=.3,kernelSize:s=Ql.MEDIUM,resolutionScale:r=.5,resolutionX:o=gi.AUTO_SIZE,resolutionY:a=gi.AUTO_SIZE}={}){super({kernelSize:s,resolutionScale:r,resolutionX:o,resolutionY:a}),this.blurMaterial=new C9({kernelSize:s,offset:n,rotation:e,focusArea:t,feather:i})}},dw=1/1e3,N9=1e3,z9=class{constructor(){this.startTime=performance.now(),this.previousTime=0,this.currentTime=0,this._delta=0,this._elapsed=0,this._fixedDelta=1e3/60,this.timescale=1,this.useFixedDelta=!1,this._autoReset=!1}get autoReset(){return this._autoReset}set autoReset(n){typeof document<"u"&&document.hidden!==void 0&&(n?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this._autoReset=n)}get delta(){return this._delta*dw}get fixedDelta(){return this._fixedDelta*dw}set fixedDelta(n){this._fixedDelta=n*N9}get elapsed(){return this._elapsed*dw}update(n){this.useFixedDelta?this._delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=(n!==void 0?n:performance.now())-this.startTime,this._delta=this.currentTime-this.previousTime),this._delta*=this.timescale,this._elapsed+=this._delta}reset(){this._delta=0,this._elapsed=0,this.currentTime=performance.now()-this.startTime}handleEvent(n){document.hidden||(this.currentTime=performance.now()-this.startTime)}dispose(){this.autoReset=!1}},aT=class{constructor(n=null,{depthBuffer:e=!0,stencilBuffer:t=!1,multisampling:i=0,frameBufferType:s}={}){this.renderer=null,this.inputBuffer=this.createBuffer(e,t,s,i),this.outputBuffer=this.inputBuffer.clone(),this.copyPass=new P9,this.depthTexture=null,this.passes=[],this.timer=new z9,this.autoRenderToScreen=!0,this.setRenderer(n)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(n){const e=this.inputBuffer,t=this.multisampling;t>0&&n>0?(this.inputBuffer.samples=n,this.outputBuffer.samples=n,this.inputBuffer.dispose(),this.outputBuffer.dispose()):t!==n&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),this.inputBuffer=this.createBuffer(e.depthBuffer,e.stencilBuffer,e.texture.type,n),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(n){if(this.renderer=n,n!==null){const e=n.getSize(new te),t=n.getContext().getContextAttributes().alpha,i=this.inputBuffer.texture.type;i===fi&&Wl(n)===vi&&(lr(this.inputBuffer.texture,vi),lr(this.outputBuffer.texture,vi),this.inputBuffer.dispose(),this.outputBuffer.dispose()),n.autoClear=!1,this.setSize(e.width,e.height);for(const s of this.passes)s.initialize(n,t,i)}}replaceRenderer(n,e=!0){const t=this.renderer,i=t.domElement.parentNode;return this.setRenderer(n),e&&i!==null&&(i.removeChild(t.domElement),i.appendChild(n.domElement)),t}createDepthTexture(){const n=this.depthTexture=new Ib;return this.inputBuffer.depthTexture=n,this.inputBuffer.dispose(),this.inputBuffer.stencilBuffer?(n.format=Yc,n.type=Dl):n.type=Pa,n}deleteDepthTexture(){if(this.depthTexture!==null){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(const n of this.passes)n.setDepthTexture(null)}}createBuffer(n,e,t,i){const s=this.renderer,r=s===null?new te:s.getDrawingBufferSize(new te),o={minFilter:Dt,magFilter:Dt,stencilBuffer:e,depthBuffer:n,type:t},a=new ni(r.width,r.height,o);return i>0&&(a.ignoreDepthForMultisampleCopy=!1,a.samples=i),t===fi&&Wl(s)===vi&&lr(a.texture,vi),a.texture.name="EffectComposer.Buffer",a.texture.generateMipmaps=!1,a}setMainScene(n){for(const e of this.passes)e.mainScene=n}setMainCamera(n){for(const e of this.passes)e.mainCamera=n}addPass(n,e){const t=this.passes,i=this.renderer,s=i.getDrawingBufferSize(new te),r=i.getContext().getContextAttributes().alpha,o=this.inputBuffer.texture.type;if(n.setRenderer(i),n.setSize(s.width,s.height),n.initialize(i,r,o),this.autoRenderToScreen&&(t.length>0&&(t[t.length-1].renderToScreen=!1),n.renderToScreen&&(this.autoRenderToScreen=!1)),e!==void 0?t.splice(e,0,n):t.push(n),this.autoRenderToScreen&&(t[t.length-1].renderToScreen=!0),n.needsDepthTexture||this.depthTexture!==null)if(this.depthTexture===null){const a=this.createDepthTexture();for(n of t)n.setDepthTexture(a)}else n.setDepthTexture(this.depthTexture)}removePass(n){const e=this.passes,t=e.indexOf(n);if(t!==-1&&e.splice(t,1).length>0){if(this.depthTexture!==null){const r=(a,l)=>a||l.needsDepthTexture;e.reduce(r,!1)||(n.getDepthTexture()===this.depthTexture&&n.setDepthTexture(null),this.deleteDepthTexture())}this.autoRenderToScreen&&t===e.length&&(n.renderToScreen=!1,e.length>0&&(e[e.length-1].renderToScreen=!0))}}removeAllPasses(){const n=this.passes;this.deleteDepthTexture(),n.length>0&&(this.autoRenderToScreen&&(n[n.length-1].renderToScreen=!1),this.passes=[])}render(n){const e=this.renderer,t=this.copyPass;let i=this.inputBuffer,s=this.outputBuffer,r=!1,o,a,l;n===void 0&&(this.timer.update(),n=this.timer.delta);for(const c of this.passes)c.enabled&&(c.render(e,i,s,n,r),c.needsSwap&&(r&&(t.renderToScreen=c.renderToScreen,o=e.getContext(),a=e.state.buffers.stencil,a.setFunc(o.NOTEQUAL,1,4294967295),t.render(e,i,s,n,r),a.setFunc(o.EQUAL,1,4294967295)),l=i,i=s,s=l),c instanceof L9?r=!0:c instanceof B9&&(r=!1))}setSize(n,e,t){const i=this.renderer,s=i.getSize(new te);(n===void 0||e===void 0)&&(n=s.width,e=s.height),(s.width!==n||s.height!==e)&&i.setSize(n,e,t);const r=i.getDrawingBufferSize(new te);this.inputBuffer.setSize(r.width,r.height),this.outputBuffer.setSize(r.width,r.height);for(const o of this.passes)o.setSize(r.width,r.height)}reset(){const n=this.timer.autoReset;this.dispose(),this.autoRenderToScreen=!0,this.timer.autoReset=n}dispose(){for(const n of this.passes)n.dispose();this.passes=[],this.inputBuffer!==null&&this.inputBuffer.dispose(),this.outputBuffer!==null&&this.outputBuffer.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose()}},G9=class{constructor(){this.shaderParts=new Map([[oi.FRAGMENT_HEAD,null],[oi.FRAGMENT_MAIN_UV,null],[oi.FRAGMENT_MAIN_IMAGE,null],[oi.VERTEX_HEAD,null],[oi.VERTEX_MAIN_SUPPORT,null]]),this.defines=new Map,this.uniforms=new Map,this.blendModes=new Map,this.extensions=new Set,this.attributes=Ur.NONE,this.varyings=new Set,this.uvTransformation=!1,this.readDepth=!1,this.colorSpace=d_}},fw=!1,GP=class{constructor(n=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(n),this.meshCount=0,this.replaceMaterial=e=>{if(e.isMesh){let t;if(e.material.flatShading)switch(e.material.side){case wi:t=this.materialsFlatShadedDoubleSide;break;case fn:t=this.materialsFlatShadedBackSide;break;default:t=this.materialsFlatShaded;break}else switch(e.material.side){case wi:t=this.materialsDoubleSide;break;case fn:t=this.materialsBackSide;break;default:t=this.materials;break}this.originalMaterials.set(e,e.material),e.isSkinnedMesh?e.material=t[2]:e.isInstancedMesh?e.material=t[1]:e.material=t[0],++this.meshCount}}}cloneMaterial(n){if(!(n instanceof Bt))return n.clone();const e=n.uniforms,t=new Map;for(const s in e){const r=e[s].value;r.isRenderTargetTexture&&(e[s].value=null,t.set(s,r))}const i=n.clone();for(const s of t)e[s[0]].value=s[1],i.uniforms[s[0]].value=s[1];return i}setMaterial(n){if(this.disposeMaterials(),this.material=n,n!==null){const e=this.materials=[this.cloneMaterial(n),this.cloneMaterial(n),this.cloneMaterial(n)];for(const t of e)t.uniforms=Object.assign({},n.uniforms),t.side=Es;e[2].skinning=!0,this.materialsBackSide=e.map(t=>{const i=this.cloneMaterial(t);return i.uniforms=Object.assign({},n.uniforms),i.side=fn,i}),this.materialsDoubleSide=e.map(t=>{const i=this.cloneMaterial(t);return i.uniforms=Object.assign({},n.uniforms),i.side=wi,i}),this.materialsFlatShaded=e.map(t=>{const i=this.cloneMaterial(t);return i.uniforms=Object.assign({},n.uniforms),i.flatShading=!0,i}),this.materialsFlatShadedBackSide=e.map(t=>{const i=this.cloneMaterial(t);return i.uniforms=Object.assign({},n.uniforms),i.flatShading=!0,i.side=fn,i}),this.materialsFlatShadedDoubleSide=e.map(t=>{const i=this.cloneMaterial(t);return i.uniforms=Object.assign({},n.uniforms),i.flatShading=!0,i.side=wi,i})}}render(n,e,t){const i=n.shadowMap.enabled;if(n.shadowMap.enabled=!1,fw){const s=this.originalMaterials;this.meshCount=0,e.traverse(this.replaceMaterial),n.render(e,t);for(const r of s)r[0].material=r[1];this.meshCount!==s.size&&s.clear()}else{const s=e.overrideMaterial;e.overrideMaterial=this.material,n.render(e,t),e.overrideMaterial=s}n.shadowMap.enabled=i}disposeMaterials(){if(this.material!==null){const n=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(const e of n)e.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return fw}static set workaroundEnabled(n){fw=n}},uc=-1,gi=class extends Fn{constructor(n,e=uc,t=uc,i=1){super(),this.resizable=n,this.baseSize=new te(1,1),this.preferredSize=new te(e,t),this.target=this.preferredSize,this.s=i,this.effectiveSize=new te,this.addEventListener("change",()=>this.updateEffectiveSize()),this.updateEffectiveSize()}updateEffectiveSize(){const n=this.baseSize,e=this.preferredSize,t=this.effectiveSize,i=this.scale;e.width!==uc?t.width=e.width:e.height!==uc?t.width=Math.round(e.height*(n.width/Math.max(n.height,1))):t.width=Math.round(n.width*i),e.height!==uc?t.height=e.height:e.width!==uc?t.height=Math.round(e.width/Math.max(n.width/Math.max(n.height,1),1)):t.height=Math.round(n.height*i)}get width(){return this.effectiveSize.width}set width(n){this.preferredWidth=n}get height(){return this.effectiveSize.height}set height(n){this.preferredHeight=n}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(n){this.s!==n&&(this.s=n,this.preferredSize.setScalar(uc),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getScale(){return this.scale}setScale(n){this.scale=n}get baseWidth(){return this.baseSize.width}set baseWidth(n){this.baseSize.width!==n&&(this.baseSize.width=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseWidth(){return this.baseWidth}setBaseWidth(n){this.baseWidth=n}get baseHeight(){return this.baseSize.height}set baseHeight(n){this.baseSize.height!==n&&(this.baseSize.height=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(n){this.baseHeight=n}setBaseSize(n,e){(this.baseSize.width!==n||this.baseSize.height!==e)&&(this.baseSize.set(n,e),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}get preferredWidth(){return this.preferredSize.width}set preferredWidth(n){this.preferredSize.width!==n&&(this.preferredSize.width=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(n){this.preferredWidth=n}get preferredHeight(){return this.preferredSize.height}set preferredHeight(n){this.preferredSize.height!==n&&(this.preferredSize.height=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(n){this.preferredHeight=n}setPreferredSize(n,e){(this.preferredSize.width!==n||this.preferredSize.height!==e)&&(this.preferredSize.set(n,e),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}copy(n){this.s=n.scale,this.baseSize.set(n.baseWidth,n.baseHeight),this.preferredSize.set(n.preferredWidth,n.preferredHeight),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height)}static get AUTO_SIZE(){return uc}},V9=class extends Set{constructor(n,e=10){super(),this.l=e,this.exclusive=!1,n!==void 0&&this.set(n)}get layer(){return this.l}set layer(n){const e=this.l;for(const t of this)t.layers.disable(e),t.layers.enable(n);this.l=n}getLayer(){return this.layer}setLayer(n){this.layer=n}isExclusive(){return this.exclusive}setExclusive(n){this.exclusive=n}clear(){const n=this.layer;for(const e of this)e.layers.disable(n);return super.clear()}set(n){this.clear();for(const e of n)this.add(e);return this}indexOf(n){return this.has(n)?0:-1}add(n){return this.exclusive?n.layers.set(this.layer):n.layers.enable(this.layer),super.add(n)}delete(n){return this.has(n)&&n.layers.disable(this.layer),super.delete(n)}toggle(n){let e;return this.has(n)?(this.delete(n),e=!1):(this.add(n),e=!0),e}setVisible(n){for(const e of this)n?e.layers.enable(0):e.layers.disable(0);return this}},H9="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y,opacity);}",Q9="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,min(y.a,opacity));}",W9="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y)*0.5,opacity);}",j9="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.rg,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",q9="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(step(0.0,y)*(1.0-min(vec4(1.0),(1.0-x)/y)),vec4(1.0),step(1.0,x));return mix(x,z,opacity);}",X9="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=step(0.0,x)*mix(min(vec4(1.0),x/max(1.0-y,1e-9)),vec4(1.0),step(1.0,y));return mix(x,z,opacity);}",Y9="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x,y),opacity);}",J9="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,abs(x-y),opacity);}",K9="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x/max(y,1e-12),opacity);}",Z9="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y-2.0*x*y),opacity);}",$9="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 a=min(x,1.0),b=min(y,1.0);vec4 z=mix(2.0*a*b,1.0-2.0*(1.0-a)*(1.0-b),step(0.5,y));return mix(x,z,opacity);}",e6="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,step(1.0,x+y),opacity);}",t6="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.r,xHSL.gb));return vec4(mix(x.rgb,z,opacity),y.a);}",i6="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-y,opacity);}",n6="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y*(1.0-x),opacity);}",s6="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x,y),opacity);}",r6="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(y+x-1.0,0.0,1.0),opacity);}",o6="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x+y,1.0),opacity);}",a6="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(2.0*y+x-1.0,0.0,1.0),opacity);}",l6="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.rg,yHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",c6="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x*y,opacity);}",h6="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-abs(1.0-x-y),opacity);}",u6="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,opacity);}",d6="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(2.0*y*x,1.0-2.0*(1.0-y)*(1.0-x),step(0.5,x));return mix(x,z,opacity);}",f6="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 z=mix(mix(y2,x,step(0.5*x,y)),max(vec4(0.0),y2-1.0),step(x,(y2-1.0)));return mix(x,z,opacity);}",p6="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(min(x*x/max(1.0-y,1e-12),1.0),y,step(1.0,y));return mix(x,z,opacity);}",g6="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.r,yHSL.g,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",m6="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y-min(x*y,1.0),opacity);}",A6="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 w=step(0.5,y);vec4 z=mix(x-(1.0-y2)*x*(1.0-x),mix(x+(y2-1.0)*(sqrt(x)-x),x+(y2-1.0)*x*((16.0*x-12.0)*x+3.0),w*(1.0-step(0.25,x))),w);return mix(x,z,opacity);}",v6="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y;}",y6="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x+y-1.0,0.0),opacity);}",b6="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(max(1.0-min((1.0-x)/(2.0*y),1.0),0.0),min(x/(2.0*(1.0-y)),1.0),step(0.5,y));return mix(x,z,opacity);}",_6=new Map([[Ot.ADD,H9],[Ot.ALPHA,Q9],[Ot.AVERAGE,W9],[Ot.COLOR,j9],[Ot.COLOR_BURN,q9],[Ot.COLOR_DODGE,X9],[Ot.DARKEN,Y9],[Ot.DIFFERENCE,J9],[Ot.DIVIDE,K9],[Ot.DST,null],[Ot.EXCLUSION,Z9],[Ot.HARD_LIGHT,$9],[Ot.HARD_MIX,e6],[Ot.HUE,t6],[Ot.INVERT,i6],[Ot.INVERT_RGB,n6],[Ot.LIGHTEN,s6],[Ot.LINEAR_BURN,r6],[Ot.LINEAR_DODGE,o6],[Ot.LINEAR_LIGHT,a6],[Ot.LUMINOSITY,l6],[Ot.MULTIPLY,c6],[Ot.NEGATION,h6],[Ot.NORMAL,u6],[Ot.OVERLAY,d6],[Ot.PIN_LIGHT,f6],[Ot.REFLECT,p6],[Ot.SATURATION,g6],[Ot.SCREEN,m6],[Ot.SOFT_LIGHT,A6],[Ot.SRC,v6],[Ot.SUBTRACT,y6],[Ot.VIVID_LIGHT,b6]]),x6=class extends Fn{constructor(n,e=1){super(),this._blendFunction=n,this.opacity=new xe(e)}getOpacity(){return this.opacity.value}setOpacity(n){this.opacity.value=n}get blendFunction(){return this._blendFunction}set blendFunction(n){this._blendFunction=n,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(n){this.blendFunction=n}getShaderCode(){return _6.get(this.blendFunction)}},$o=class extends Fn{constructor(n,e,{attributes:t=Ur.NONE,blendFunction:i=Ot.NORMAL,defines:s=new Map,uniforms:r=new Map,extensions:o=null,vertexShader:a=null}={}){super(),this.name=n,this.renderer=null,this.attributes=t,this.fragmentShader=e,this.vertexShader=a,this.defines=s,this.uniforms=r,this.extensions=o,this.blendMode=new x6(i),this.blendMode.addEventListener("change",l=>this.setChanged()),this._inputColorSpace=d_,this._outputColorSpace=J2}get inputColorSpace(){return this._inputColorSpace}set inputColorSpace(n){this._inputColorSpace=n,this.setChanged()}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(n){this._outputColorSpace=n,this.setChanged()}set mainScene(n){}set mainCamera(n){}getName(){return this.name}setRenderer(n){this.renderer=n}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(n){this.attributes=n,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(n){this.fragmentShader=n,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(n){this.vertexShader=n,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(n,e=hs){}update(n,e,t){}setSize(n,e){}initialize(n,e,t){}dispose(){for(const n of Object.keys(this)){const e=this[n];(e instanceof ni||e instanceof Pt||e instanceof Rt||e instanceof Ps)&&this[n].dispose()}}},w6=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D map;
#else
uniform lowp sampler2D map;
#endif
uniform float intensity;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 texel=texture2D(map,uv);outputColor=vec4(texel.rgb*intensity,texel.a);}`,lT=class extends $o{constructor({blendFunction:n=Ot.SCREEN,luminanceThreshold:e=.9,luminanceSmoothing:t=.025,mipmapBlur:i=!1,intensity:s=1,radius:r=.85,levels:o=8,kernelSize:a=Ql.LARGE,resolutionScale:l=.5,width:c=gi.AUTO_SIZE,height:u=gi.AUTO_SIZE,resolutionX:d=c,resolutionY:f=u}={}){super("BloomEffect",w6,{blendFunction:n,uniforms:new Map([["map",new xe(null)],["intensity",new xe(s)]])}),this.renderTarget=new ni(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Bloom.Target",this.blurPass=new oT({kernelSize:a}),this.luminancePass=new k9({colorOutput:!0}),this.luminanceMaterial.threshold=e,this.luminanceMaterial.smoothing=t,this.mipmapBlurPass=new F9,this.mipmapBlurPass.enabled=i,this.mipmapBlurPass.radius=r,this.mipmapBlurPass.levels=o,this.uniforms.get("map").value=i?this.mipmapBlurPass.texture:this.renderTarget.texture;const p=this.resolution=new gi(this,d,f,l);p.addEventListener("change",g=>this.setSize(p.baseWidth,p.baseHeight))}get texture(){return this.mipmapBlurPass.enabled?this.mipmapBlurPass.texture:this.renderTarget.texture}getTexture(){return this.texture}getResolution(){return this.resolution}getBlurPass(){return this.blurPass}getLuminancePass(){return this.luminancePass}get luminanceMaterial(){return this.luminancePass.fullscreenMaterial}getLuminanceMaterial(){return this.luminancePass.fullscreenMaterial}get width(){return this.resolution.width}set width(n){this.resolution.preferredWidth=n}get height(){return this.resolution.height}set height(n){this.resolution.preferredHeight=n}get dithering(){return this.blurPass.dithering}set dithering(n){this.blurPass.dithering=n}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(n){this.blurPass.kernelSize=n}get distinction(){return console.warn(this.name,"distinction was removed"),1}set distinction(n){console.warn(this.name,"distinction was removed")}get intensity(){return this.uniforms.get("intensity").value}set intensity(n){this.uniforms.get("intensity").value=n}getIntensity(){return this.intensity}setIntensity(n){this.intensity=n}getResolutionScale(){return this.resolution.scale}setResolutionScale(n){this.resolution.scale=n}update(n,e,t){const i=this.renderTarget,s=this.luminancePass;s.enabled?(s.render(n,e),this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(n,s.renderTarget):this.blurPass.render(n,s.renderTarget,i)):this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(n,e):this.blurPass.render(n,e,i)}setSize(n,e){const t=this.resolution;t.setBaseSize(n,e),this.renderTarget.setSize(t.width,t.height),this.blurPass.resolution.copy(t),this.luminancePass.setSize(n,e),this.mipmapBlurPass.setSize(n,e)}initialize(n,e,t){this.blurPass.initialize(n,e,t),this.luminancePass.initialize(n,e,t),this.mipmapBlurPass.initialize(n,e,t),t!==void 0&&(this.renderTarget.texture.type=t,Wl(n)===vi&&lr(this.renderTarget.texture,vi))}},S6="uniform float brightness;uniform float contrast;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=inputColor.rgb+vec3(brightness-0.5);if(contrast>0.0){color/=vec3(1.0-contrast);}else{color*=vec3(1.0+contrast);}outputColor=vec4(color+vec3(0.5),inputColor.a);}",sF=class extends $o{constructor({blendFunction:n=Ot.SRC,brightness:e=0,contrast:t=0}={}){super("BrightnessContrastEffect",S6,{blendFunction:n,uniforms:new Map([["brightness",new xe(e)],["contrast",new xe(t)]])}),this.inputColorSpace=vi}get brightness(){return this.uniforms.get("brightness").value}set brightness(n){this.uniforms.get("brightness").value=n}getBrightness(){return this.brightness}setBrightness(n){this.brightness=n}get contrast(){return this.uniforms.get("contrast").value}set contrast(n){this.uniforms.get("contrast").value=n}getContrast(){return this.contrast}setContrast(n){this.contrast=n}},C6=`#ifdef RADIAL_MODULATION
uniform float modulationOffset;
#endif
varying float vActive;varying vec2 vUvR;varying vec2 vUvB;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec2 ra=inputColor.ra;vec2 ba=inputColor.ba;
#ifdef RADIAL_MODULATION
const vec2 center=vec2(0.5);float d=distance(uv,center)*2.0;d=max(d-modulationOffset,0.0);if(vActive>0.0&&d>0.0){ra=texture2D(inputBuffer,mix(uv,vUvR,d)).ra;ba=texture2D(inputBuffer,mix(uv,vUvB,d)).ba;}
#else
if(vActive>0.0){ra=texture2D(inputBuffer,vUvR).ra;ba=texture2D(inputBuffer,vUvB).ba;}
#endif
outputColor=vec4(ra.x,inputColor.g,ba.x,max(max(ra.y,ba.y),inputColor.a));}`,E6="uniform vec2 offset;varying float vActive;varying vec2 vUvR;varying vec2 vUvB;void mainSupport(const in vec2 uv){vec2 shift=offset*vec2(1.0,aspect);vActive=(shift.x!=0.0||shift.y!=0.0)?1.0:0.0;vUvR=uv+shift;vUvB=uv-shift;}",rF=class extends $o{constructor({offset:n=new te(.001,5e-4),radialModulation:e=!1,modulationOffset:t=.15}={}){super("ChromaticAberrationEffect",C6,{vertexShader:E6,attributes:Ur.CONVOLUTION,uniforms:new Map([["offset",new xe(n)],["modulationOffset",new xe(t)]])}),this.radialModulation=e}get offset(){return this.uniforms.get("offset").value}set offset(n){this.uniforms.get("offset").value=n}get radialModulation(){return this.defines.has("RADIAL_MODULATION")}set radialModulation(n){n?this.defines.set("RADIAL_MODULATION","1"):this.defines.delete("RADIAL_MODULATION"),this.setChanged()}get modulationOffset(){return this.uniforms.get("modulationOffset").value}set modulationOffset(n){this.uniforms.get("modulationOffset").value=n}getOffset(){return this.offset}setOffset(n){this.offset=n}},M6=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D nearColorBuffer;uniform mediump sampler2D farColorBuffer;
#else
uniform lowp sampler2D nearColorBuffer;uniform lowp sampler2D farColorBuffer;
#endif
uniform lowp sampler2D nearCoCBuffer;uniform lowp sampler2D farCoCBuffer;uniform float scale;void mainImage(const in vec4 inputColor,const in vec2 uv,const in float depth,out vec4 outputColor){vec4 colorNear=texture2D(nearColorBuffer,uv);vec4 colorFar=texture2D(farColorBuffer,uv);
#if MASK_FUNCTION == 1
vec2 cocNearFar=vec2(texture2D(nearCoCBuffer,uv).r,colorFar.a);cocNearFar.x=min(cocNearFar.x*scale,1.0);
#else
vec2 cocNearFar=vec2(texture2D(nearCoCBuffer,uv).r,texture2D(farCoCBuffer,uv).g);cocNearFar=min(cocNearFar*scale,1.0);
#endif
vec4 result=inputColor*(1.0-cocNearFar.y)+colorFar;result=mix(result,colorNear,cocNearFar.x);outputColor=result;}`,oF=class extends $o{constructor(n,{blendFunction:e,worldFocusDistance:t,worldFocusRange:i,focusDistance:s=0,focalLength:r=.1,focusRange:o=r,bokehScale:a=1,resolutionScale:l=1,width:c=gi.AUTO_SIZE,height:u=gi.AUTO_SIZE,resolutionX:d=c,resolutionY:f=u}={}){super("DepthOfFieldEffect",M6,{blendFunction:e,attributes:Ur.DEPTH,uniforms:new Map([["nearColorBuffer",new xe(null)],["farColorBuffer",new xe(null)],["nearCoCBuffer",new xe(null)],["farCoCBuffer",new xe(null)],["scale",new xe(1)]])}),this.camera=n,this.renderTarget=new ni(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="DoF.Intermediate",this.renderTargetMasked=this.renderTarget.clone(),this.renderTargetMasked.texture.name="DoF.Masked.Far",this.renderTargetNear=this.renderTarget.clone(),this.renderTargetNear.texture.name="DoF.Bokeh.Near",this.uniforms.get("nearColorBuffer").value=this.renderTargetNear.texture,this.renderTargetFar=this.renderTarget.clone(),this.renderTargetFar.texture.name="DoF.Bokeh.Far",this.uniforms.get("farColorBuffer").value=this.renderTargetFar.texture,this.renderTargetCoC=this.renderTarget.clone(),this.renderTargetCoC.texture.name="DoF.CoC",this.uniforms.get("farCoCBuffer").value=this.renderTargetCoC.texture,this.renderTargetCoCBlurred=this.renderTargetCoC.clone(),this.renderTargetCoCBlurred.texture.name="DoF.CoC.Blurred",this.uniforms.get("nearCoCBuffer").value=this.renderTargetCoCBlurred.texture,this.cocPass=new _a(new Xj(n));const p=this.cocMaterial;p.focusDistance=s,p.focusRange=o,t!==void 0&&(p.worldFocusDistance=t),i!==void 0&&(p.worldFocusRange=i),this.blurPass=new oT({resolutionScale:l,resolutionX:d,resolutionY:f,kernelSize:Ql.MEDIUM}),this.maskPass=new _a(new m9(this.renderTargetCoC.texture));const g=this.maskPass.fullscreenMaterial;g.colorChannel=Y2.GREEN,this.maskFunction=K2.MULTIPLY_RGB,this.bokehNearBasePass=new _a(new Fv(!1,!0)),this.bokehNearBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehNearFillPass=new _a(new Fv(!0,!0)),this.bokehNearFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehFarBasePass=new _a(new Fv(!1,!1)),this.bokehFarBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.bokehFarFillPass=new _a(new Fv(!0,!1)),this.bokehFarFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.target=null;const A=this.resolution=new gi(this,d,f,l);A.addEventListener("change",v=>this.setSize(A.baseWidth,A.baseHeight)),this.bokehScale=a}set mainCamera(n){this.camera=n,this.cocMaterial.copyCameraSettings(n)}get cocTexture(){return this.renderTargetCoC.texture}get maskFunction(){return this.maskPass.fullscreenMaterial.maskFunction}set maskFunction(n){this.maskFunction!==n&&(this.defines.set("MASK_FUNCTION",n.toFixed(0)),this.maskPass.fullscreenMaterial.maskFunction=n,this.setChanged())}get cocMaterial(){return this.cocPass.fullscreenMaterial}get circleOfConfusionMaterial(){return this.cocMaterial}getCircleOfConfusionMaterial(){return this.cocMaterial}getBlurPass(){return this.blurPass}getResolution(){return this.resolution}get bokehScale(){return this.uniforms.get("scale").value}set bokehScale(n){this.bokehNearBasePass.fullscreenMaterial.scale=n,this.bokehNearFillPass.fullscreenMaterial.scale=n,this.bokehFarBasePass.fullscreenMaterial.scale=n,this.bokehFarFillPass.fullscreenMaterial.scale=n,this.maskPass.fullscreenMaterial.strength=n,this.uniforms.get("scale").value=n}getBokehScale(){return this.bokehScale}setBokehScale(n){this.bokehScale=n}getTarget(){return this.target}setTarget(n){this.target=n}calculateFocusDistance(n){const e=this.camera,t=e.position.distanceTo(n);return au(-t,e.near,e.far)}setDepthTexture(n,e=hs){this.cocMaterial.depthBuffer=n,this.cocMaterial.depthPacking=e}update(n,e,t){const i=this.renderTarget,s=this.renderTargetCoC,r=this.renderTargetCoCBlurred,o=this.renderTargetMasked;if(this.target!==null){const a=this.calculateFocusDistance(this.target);this.cocMaterial.focusDistance=a}this.cocPass.render(n,null,s),this.blurPass.render(n,s,r),this.maskPass.render(n,e,o),this.bokehFarBasePass.render(n,o,i),this.bokehFarFillPass.render(n,i,this.renderTargetFar),this.bokehNearBasePass.render(n,e,i),this.bokehNearFillPass.render(n,i,this.renderTargetNear)}setSize(n,e){const t=this.resolution;t.setBaseSize(n,e);const i=t.width,s=t.height;this.cocPass.setSize(n,e),this.blurPass.setSize(n,e),this.maskPass.setSize(n,e),this.renderTargetFar.setSize(n,e),this.renderTargetCoC.setSize(n,e),this.renderTargetMasked.setSize(n,e),this.renderTarget.setSize(i,s),this.renderTargetNear.setSize(i,s),this.renderTargetCoCBlurred.setSize(i,s),this.bokehNearBasePass.fullscreenMaterial.setSize(n,e),this.bokehNearFillPass.fullscreenMaterial.setSize(n,e),this.bokehFarBasePass.fullscreenMaterial.setSize(n,e),this.bokehFarFillPass.fullscreenMaterial.setSize(n,e)}initialize(n,e,t){this.cocPass.initialize(n,e,t),this.maskPass.initialize(n,e,t),this.bokehNearBasePass.initialize(n,e,t),this.bokehNearFillPass.initialize(n,e,t),this.bokehFarBasePass.initialize(n,e,t),this.bokehFarFillPass.initialize(n,e,t),this.blurPass.initialize(n,e,fi),n.capabilities.logarithmicDepthBuffer&&(this.cocPass.fullscreenMaterial.defines.LOG_DEPTH="1"),t!==void 0&&(this.renderTarget.texture.type=t,this.renderTargetNear.texture.type=t,this.renderTargetFar.texture.type=t,this.renderTargetMasked.texture.type=t,Wl(n)===vi&&(lr(this.renderTarget.texture,vi),lr(this.renderTargetNear.texture,vi),lr(this.renderTargetFar.texture,vi),lr(this.renderTargetMasked.texture,vi)))}};function T6(n,e,t){const i=new Map([[yb,1],[wl,1],[iu,2],[Ti,4]]);let s;if(i.has(e)||console.error("Invalid noise texture format"),t===fi){s=new Uint8Array(n*i.get(e));for(let r=0,o=s.length;r<o;++r)s[r]=Math.random()*255+.5}else{s=new Float32Array(n*i.get(e));for(let r=0,o=s.length;r<o;++r)s[r]=Math.random()}return s}var I6=class extends Ao{constructor(n,e,t=yb,i=fi){super(T6(n*e,t,i),n,e,t,i),this.needsUpdate=!0}},R6="uniform vec3 hue;uniform float saturation;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=vec3(dot(inputColor.rgb,hue.xyz),dot(inputColor.rgb,hue.zxy),dot(inputColor.rgb,hue.yzx));float average=(color.r+color.g+color.b)/3.0;vec3 diff=average-color;if(saturation>0.0){color+=diff*(1.0-1.0/(1.001-saturation));}else{color+=diff*-saturation;}outputColor=vec4(min(color,1.0),inputColor.a);}",aF=class extends $o{constructor({blendFunction:n=Ot.SRC,hue:e=0,saturation:t=0}={}){super("HueSaturationEffect",R6,{blendFunction:n,uniforms:new Map([["hue",new xe(new w)],["saturation",new xe(t)]])}),this.hue=e}get saturation(){return this.uniforms.get("saturation").value}set saturation(n){this.uniforms.get("saturation").value=n}getSaturation(){return this.saturation}setSaturation(n){this.saturation=n}get hue(){const n=this.uniforms.get("hue").value;return Math.acos((n.x*3-1)/2)}set hue(n){const e=Math.sin(n),t=Math.cos(n);this.uniforms.get("hue").value.set((2*t+1)/3,(-Math.sqrt(3)*e-t+1)/3,(Math.sqrt(3)*e-t+1)/3)}getHue(){return this.hue}setHue(n){this.hue=n}},P6="uniform bool active;uniform vec4 d;void mainUv(inout vec2 uv){if(active){uv=d.xy*(floor(uv*d.zw)+0.5);}}",lF=class extends $o{constructor(e=30){super("PixelationEffect",P6,{uniforms:new Map([["active",new xe(!1)],["d",new xe(new Ke)]])}),this.resolution=new te,this._granularity=0,this.granularity=e}get granularity(){return this._granularity}set granularity(e){let t=Math.floor(e);t%2>0&&(t+=1),this._granularity=t,this.uniforms.get("active").value=t>0,this.setSize(this.resolution.width,this.resolution.height)}getGranularity(){return this.granularity}setGranularity(e){this.granularity=e}setSize(e,t){const i=this.resolution;i.set(e,t);const s=this.granularity,r=s/i.x,o=s/i.y;this.uniforms.get("d").value.set(r,o,1/r,1/o)}},cF=class extends lT{constructor(n,e,t){super(t),this.setAttributes(this.getAttributes()|Ur.DEPTH),this.camera=e,this.depthPass=new D9(n,e),this.clearPass=new f_(!0,!1,!1),this.clearPass.overrideClearColor=new _e(0),this.depthMaskPass=new _a(new n9);const i=this.depthMaskMaterial;i.copyCameraSettings(e),i.depthBuffer1=this.depthPass.texture,i.depthPacking1=_b,i.depthMode=If,this.renderTargetMasked=new ni(1,1,{depthBuffer:!1}),this.renderTargetMasked.texture.name="Bloom.Masked",this.selection=new V9,this.selection.layer=11,this._inverted=!1,this._ignoreBackground=!1}set mainScene(n){this.depthPass.mainScene=n}set mainCamera(n){this.camera=n,this.depthPass.mainCamera=n,this.depthMaskMaterial.copyCameraSettings(n)}getSelection(){return this.selection}get depthMaskMaterial(){return this.depthMaskPass.fullscreenMaterial}get inverted(){return this._inverted}set inverted(n){this._inverted=n,this.depthMaskMaterial.depthMode=n?Xm:If}isInverted(){return this.inverted}setInverted(n){this.inverted=n}get ignoreBackground(){return this._ignoreBackground}set ignoreBackground(n){this._ignoreBackground=n,this.depthMaskMaterial.maxDepthStrategy=n?Og.DISCARD_MAX_DEPTH:Og.KEEP_MAX_DEPTH}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(n){this.ignoreBackground=n}setDepthTexture(n,e=hs){this.depthMaskMaterial.depthBuffer0=n,this.depthMaskMaterial.depthPacking0=e}update(n,e,t){const i=this.camera,s=this.selection,r=this.inverted;let o=e;if(this.ignoreBackground||!r||s.size>0){const a=i.layers.mask;i.layers.set(s.layer),this.depthPass.render(n),i.layers.mask=a,o=this.renderTargetMasked,this.clearPass.render(n,o),this.depthMaskPass.render(n,e,o)}super.update(n,o,t)}setSize(n,e){super.setSize(n,e),this.renderTargetMasked.setSize(n,e),this.depthPass.setSize(n,e)}initialize(n,e,t){super.initialize(n,e,t),this.clearPass.initialize(n,e,t),this.depthPass.initialize(n,e,t),this.depthMaskPass.initialize(n,e,t),n.capabilities.logarithmicDepthBuffer&&(this.depthMaskPass.fullscreenMaterial.defines.LOG_DEPTH="1"),t!==void 0&&(this.renderTargetMasked.texture.type=t,Wl(n)===vi&&lr(this.renderTargetMasked.texture,vi))}},VP="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAAQCAYAAACm53kpAAAAeElEQVRYR+2XSwqAMAxEJ168ePEqwRSKhIIiuHjJqiU0gWE+1CQdApcVAMUAuARaMGCX1MIL/Ow13++9lW2s3mW9MWvsnWc/2fvGygwPAN4E8QzAA4CXAB6AHjG4JTHYI1ey3pcx6FHnEfhLDOIBKAmUBK6/ANUDTlROXAHd9EC1AAAAAElFTkSuQmCC",HP="data:image/png;base64,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",B6="uniform sampler2D weightMap;varying vec2 vOffset0;varying vec2 vOffset1;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 a;a.x=texture2D(weightMap,vOffset0).a;a.y=texture2D(weightMap,vOffset1).g;a.wz=texture2D(weightMap,uv).rb;vec4 color=inputColor;if(dot(a,vec4(1.0))>=1e-5){bool h=max(a.x,a.z)>max(a.y,a.w);vec4 blendingOffset=vec4(0.0,a.y,0.0,a.w);vec2 blendingWeight=a.yw;movec(bvec4(h),blendingOffset,vec4(a.x,0.0,a.z,0.0));movec(bvec2(h),blendingWeight,a.xz);blendingWeight/=dot(blendingWeight,vec2(1.0));vec4 blendingCoord=blendingOffset*vec4(texelSize,-texelSize)+uv.xyxy;color=blendingWeight.x*texture2D(inputBuffer,blendingCoord.xy);color+=blendingWeight.y*texture2D(inputBuffer,blendingCoord.zw);}outputColor=color;}",D6="varying vec2 vOffset0;varying vec2 vOffset1;void mainSupport(const in vec2 uv){vOffset0=uv+texelSize*vec2(1.0,0.0);vOffset1=uv+texelSize*vec2(0.0,1.0);}",O6=class extends $o{constructor({blendFunction:n=Ot.SRC,preset:e=Fd.MEDIUM,edgeDetectionMode:t=sT.COLOR,predicationMode:i=Qj.DISABLED}={}){super("SMAAEffect",B6,{vertexShader:D6,blendFunction:n,attributes:Ur.CONVOLUTION|Ur.DEPTH,uniforms:new Map([["weightMap",new xe(null)]])});let s,r;arguments.length>1&&(s=arguments[0],r=arguments[1],arguments.length>2&&(e=arguments[2]),arguments.length>3&&(t=arguments[3])),this.renderTargetEdges=new ni(1,1,{depthBuffer:!1}),this.renderTargetEdges.texture.name="SMAA.Edges",this.renderTargetWeights=this.renderTargetEdges.clone(),this.renderTargetWeights.texture.name="SMAA.Weights",this.uniforms.get("weightMap").value=this.renderTargetWeights.texture,this.clearPass=new f_(!0,!1,!1),this.clearPass.overrideClearColor=new _e(0),this.clearPass.overrideClearAlpha=1,this.edgeDetectionPass=new _a(new c9),this.edgeDetectionMaterial.edgeDetectionMode=t,this.edgeDetectionMaterial.predicationMode=i,this.weightsPass=new _a(new y9);const o=new qb;o.onLoad=()=>{const a=new Rt(s);a.name="SMAA.Search",a.magFilter=Ft,a.minFilter=Ft,a.generateMipmaps=!1,a.needsUpdate=!0,a.flipY=!0,this.weightsMaterial.searchTexture=a;const l=new Rt(r);l.name="SMAA.Area",l.magFilter=Dt,l.minFilter=Dt,l.generateMipmaps=!1,l.needsUpdate=!0,l.flipY=!1,this.weightsMaterial.areaTexture=l,this.dispatchEvent({type:"load"})},o.itemStart("search"),o.itemStart("area"),s!==void 0&&r!==void 0?(o.itemEnd("search"),o.itemEnd("area")):typeof Image<"u"&&(s=new Image,r=new Image,s.addEventListener("load",()=>o.itemEnd("search")),r.addEventListener("load",()=>o.itemEnd("area")),s.src=VP,r.src=HP),this.applyPreset(e)}get edgesTexture(){return this.renderTargetEdges.texture}getEdgesTexture(){return this.edgesTexture}get weightsTexture(){return this.renderTargetWeights.texture}getWeightsTexture(){return this.weightsTexture}get edgeDetectionMaterial(){return this.edgeDetectionPass.fullscreenMaterial}get colorEdgesMaterial(){return this.edgeDetectionMaterial}getEdgeDetectionMaterial(){return this.edgeDetectionMaterial}get weightsMaterial(){return this.weightsPass.fullscreenMaterial}getWeightsMaterial(){return this.weightsMaterial}setEdgeDetectionThreshold(n){this.edgeDetectionMaterial.edgeDetectionThreshold=n}setOrthogonalSearchSteps(n){this.weightsMaterial.orthogonalSearchSteps=n}applyPreset(n){const e=this.edgeDetectionMaterial,t=this.weightsMaterial;switch(n){case Fd.LOW:e.edgeDetectionThreshold=.15,t.orthogonalSearchSteps=4,t.diagonalDetection=!1,t.cornerDetection=!1;break;case Fd.MEDIUM:e.edgeDetectionThreshold=.1,t.orthogonalSearchSteps=8,t.diagonalDetection=!1,t.cornerDetection=!1;break;case Fd.HIGH:e.edgeDetectionThreshold=.1,t.orthogonalSearchSteps=16,t.diagonalSearchSteps=8,t.cornerRounding=25,t.diagonalDetection=!0,t.cornerDetection=!0;break;case Fd.ULTRA:e.edgeDetectionThreshold=.05,t.orthogonalSearchSteps=32,t.diagonalSearchSteps=16,t.cornerRounding=25,t.diagonalDetection=!0,t.cornerDetection=!0;break}}setDepthTexture(n,e=hs){this.edgeDetectionMaterial.depthBuffer=n,this.edgeDetectionMaterial.depthPacking=e}update(n,e,t){this.clearPass.render(n,this.renderTargetEdges),this.edgeDetectionPass.render(n,e,this.renderTargetEdges),this.weightsPass.render(n,this.renderTargetEdges,this.renderTargetWeights)}setSize(n,e){this.edgeDetectionMaterial.setSize(n,e),this.weightsMaterial.setSize(n,e),this.renderTargetEdges.setSize(n,e),this.renderTargetWeights.setSize(n,e)}dispose(){const{searchTexture:n,areaTexture:e}=this.weightsMaterial;n!==null&&e!==null&&(n.dispose(),e.dispose()),super.dispose()}static get searchImageDataURL(){return VP}static get areaImageDataURL(){return HP}},k6=`uniform lowp sampler2D aoBuffer;uniform float luminanceInfluence;uniform float intensity;
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#if defined(DEPTH_AWARE_UPSAMPLING) && defined(NORMAL_DEPTH)
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D normalDepthBuffer;
#else
uniform mediump sampler2D normalDepthBuffer;
#endif
#endif
#ifdef COLORIZE
uniform vec3 color;
#endif
void mainImage(const in vec4 inputColor,const in vec2 uv,const in float depth,out vec4 outputColor){float aoLinear=texture2D(aoBuffer,uv).r;
#if defined(DEPTH_AWARE_UPSAMPLING) && defined(NORMAL_DEPTH) && __VERSION__ == 300
vec4 normalDepth[4];normalDepth[0]=textureOffset(normalDepthBuffer,uv,ivec2(0,0));normalDepth[1]=textureOffset(normalDepthBuffer,uv,ivec2(0,1));normalDepth[2]=textureOffset(normalDepthBuffer,uv,ivec2(1,0));normalDepth[3]=textureOffset(normalDepthBuffer,uv,ivec2(1,1));float dot01=dot(normalDepth[0].rgb,normalDepth[1].rgb);float dot02=dot(normalDepth[0].rgb,normalDepth[2].rgb);float dot03=dot(normalDepth[0].rgb,normalDepth[3].rgb);float minDot=min(dot01,min(dot02,dot03));float s=step(THRESHOLD,minDot);float smallestDistance=1.0;int index;for(int i=0;i<4;++i){float distance=abs(depth-normalDepth[i].a);if(distance<smallestDistance){smallestDistance=distance;index=i;}}ivec2 offsets[4];offsets[0]=ivec2(0,0);offsets[1]=ivec2(0,1);offsets[2]=ivec2(1,0);offsets[3]=ivec2(1,1);ivec2 coord=ivec2(uv*vec2(textureSize(aoBuffer,0)))+offsets[index];float aoNearest=texelFetch(aoBuffer,coord,0).r;float ao=mix(aoNearest,aoLinear,s);
#else
float ao=aoLinear;
#endif
float l=luminance(inputColor.rgb);ao=mix(ao,0.0,l*luminanceInfluence);ao=clamp(ao*intensity,0.0,1.0);
#ifdef COLORIZE
outputColor=vec4(1.0-ao*(1.0-color),inputColor.a);
#else
outputColor=vec4(vec3(1.0-ao),inputColor.a);
#endif
}`,QP=64,hF=class extends $o{constructor(n,e,{blendFunction:t=Ot.MULTIPLY,samples:i=9,rings:s=7,normalDepthBuffer:r=null,depthAwareUpsampling:o=!0,worldDistanceThreshold:a,worldDistanceFalloff:l,worldProximityThreshold:c,worldProximityFalloff:u,distanceThreshold:d=.97,distanceFalloff:f=.03,rangeThreshold:p=5e-4,rangeFalloff:g=.001,minRadiusScale:A=.1,luminanceInfluence:v=.7,radius:m=.1825,intensity:b=1,bias:y=.025,fade:_=.01,color:E=null,resolutionScale:M=1,width:I=gi.AUTO_SIZE,height:R=gi.AUTO_SIZE,resolutionX:C=I,resolutionY:T=R}={}){super("SSAOEffect",k6,{blendFunction:t,attributes:Ur.DEPTH,defines:new Map([["THRESHOLD","0.997"]]),uniforms:new Map([["aoBuffer",new xe(null)],["normalDepthBuffer",new xe(r)],["luminanceInfluence",new xe(v)],["color",new xe(null)],["intensity",new xe(b)],["scale",new xe(0)]])}),this.renderTarget=new ni(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="AO.Target",this.uniforms.get("aoBuffer").value=this.renderTarget.texture;const O=this.resolution=new gi(this,C,T,M);O.addEventListener("change",H=>this.setSize(O.baseWidth,O.baseHeight)),this.camera=n,this.depthDownsamplingPass=new rT({normalBuffer:e,resolutionScale:M}),this.depthDownsamplingPass.enabled=r===null,this.ssaoPass=new _a(new x9(n));const J=new I6(QP,QP,Ti);J.wrapS=J.wrapT=vo;const V=this.ssaoMaterial;V.normalBuffer=e,V.noiseTexture=J,V.minRadiusScale=A,V.samples=i,V.radius=m,V.rings=s,V.fade=_,V.bias=y,V.distanceThreshold=d,V.distanceFalloff=f,V.proximityThreshold=p,V.proximityFalloff=g,a!==void 0&&(V.worldDistanceThreshold=a),l!==void 0&&(V.worldDistanceFalloff=l),c!==void 0&&(V.worldProximityThreshold=c),u!==void 0&&(V.worldProximityFalloff=u),r!==null&&(this.ssaoMaterial.normalDepthBuffer=r,this.defines.set("NORMAL_DEPTH","1")),this.depthAwareUpsampling=o,this.color=E}set mainCamera(n){this.camera=n,this.ssaoMaterial.copyCameraSettings(n)}get normalBuffer(){return this.ssaoMaterial.normalBuffer}set normalBuffer(n){this.ssaoMaterial.normalBuffer=n,this.depthDownsamplingPass.fullscreenMaterial.normalBuffer=n}getResolution(){return this.resolution}get ssaoMaterial(){return this.ssaoPass.fullscreenMaterial}getSSAOMaterial(){return this.ssaoMaterial}get samples(){return this.ssaoMaterial.samples}set samples(n){this.ssaoMaterial.samples=n}get rings(){return this.ssaoMaterial.rings}set rings(n){this.ssaoMaterial.rings=n}get radius(){return this.ssaoMaterial.radius}set radius(n){this.ssaoMaterial.radius=n}get depthAwareUpsampling(){return this.defines.has("DEPTH_AWARE_UPSAMPLING")}set depthAwareUpsampling(n){this.depthAwareUpsampling!==n&&(n?this.defines.set("DEPTH_AWARE_UPSAMPLING","1"):this.defines.delete("DEPTH_AWARE_UPSAMPLING"),this.setChanged())}isDepthAwareUpsamplingEnabled(){return this.depthAwareUpsampling}setDepthAwareUpsamplingEnabled(n){this.depthAwareUpsampling=n}get distanceScaling(){return!0}set distanceScaling(n){}get color(){return this.uniforms.get("color").value}set color(n){const e=this.uniforms,t=this.defines;n!==null?t.has("COLORIZE")?e.get("color").value.set(n):(t.set("COLORIZE","1"),e.get("color").value=new _e(n),this.setChanged()):t.has("COLORIZE")&&(t.delete("COLORIZE"),e.get("color").value=null,this.setChanged())}get luminanceInfluence(){return this.uniforms.get("luminanceInfluence").value}set luminanceInfluence(n){this.uniforms.get("luminanceInfluence").value=n}get intensity(){return this.uniforms.get("intensity").value}set intensity(n){this.uniforms.get("intensity").value=n}getColor(){return this.color}setColor(n){this.color=n}setDistanceCutoff(n,e){this.ssaoMaterial.distanceThreshold=n,this.ssaoMaterial.distanceFalloff=e}setProximityCutoff(n,e){this.ssaoMaterial.proximityThreshold=n,this.ssaoMaterial.proximityFalloff=e}setDepthTexture(n,e=hs){this.depthDownsamplingPass.setDepthTexture(n,e),this.ssaoMaterial.depthBuffer=n,this.ssaoMaterial.depthPacking=e}update(n,e,t){const i=this.renderTarget;this.depthDownsamplingPass.enabled&&this.depthDownsamplingPass.render(n),this.ssaoPass.render(n,null,i)}setSize(n,e){const t=this.resolution;t.setBaseSize(n,e);const i=t.width,s=t.height;this.ssaoMaterial.copyCameraSettings(this.camera),this.ssaoMaterial.setSize(i,s),this.renderTarget.setSize(i,s),this.depthDownsamplingPass.resolution.scale=t.scale,this.depthDownsamplingPass.setSize(n,e)}initialize(n,e,t){try{let i=this.uniforms.get("normalDepthBuffer").value;i===null&&(this.depthDownsamplingPass.initialize(n,e,t),i=this.depthDownsamplingPass.texture,this.uniforms.get("normalDepthBuffer").value=i,this.ssaoMaterial.normalDepthBuffer=i,this.defines.set("NORMAL_DEPTH","1"))}catch{this.depthDownsamplingPass.enabled=!1}}},L6=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D map;
#else
uniform lowp sampler2D map;
#endif
uniform vec2 maskParams;varying vec2 vUv2;float linearGradientMask(const in float x){return step(maskParams.x,x)-step(maskParams.y,x);}void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){float mask=linearGradientMask(vUv2.y);vec4 texel=texture2D(map,uv);outputColor=mix(texel,inputColor,mask);}`,F6="uniform vec2 rotation;varying vec2 vUv2;void mainSupport(const in vec2 uv){vUv2=(uv-0.5)*2.0*vec2(aspect,1.0);vUv2=vec2(dot(rotation,vUv2),dot(rotation,vec2(vUv2.y,-vUv2.x)));}",U6=class extends $o{constructor({blendFunction:e,offset:t=0,rotation:i=0,focusArea:s=.4,feather:r=.3,kernelSize:o=Ql.MEDIUM,resolutionScale:a=.5,resolutionX:l=gi.AUTO_SIZE,resolutionY:c=gi.AUTO_SIZE}={}){super("TiltShiftEffect",L6,{vertexShader:F6,blendFunction:e,uniforms:new Map([["rotation",new xe(new te)],["maskParams",new xe(new te)],["map",new xe(null)]])}),this._offset=t,this._focusArea=s,this._feather=r,this.renderTarget=new ni(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="TiltShift.Target",this.uniforms.get("map").value=this.renderTarget.texture,this.blurPass=new U9({kernelSize:o,resolutionScale:a,resolutionX:l,resolutionY:c,offset:t,rotation:i,focusArea:s,feather:r});const u=this.resolution=new gi(this,l,c,a);u.addEventListener("change",d=>this.setSize(u.baseWidth,u.baseHeight)),this.rotation=i,this.updateParams()}updateParams(){const e=this.uniforms.get("maskParams").value,t=Math.max(this.focusArea-this.feather,0);e.set(this.offset-t,this.offset+t)}get rotation(){return Math.acos(this.uniforms.get("rotation").value.x)}set rotation(e){this.uniforms.get("rotation").value.set(Math.cos(e),Math.sin(e)),this.blurPass.blurMaterial.rotation=e}get offset(){return this._offset}set offset(e){this._offset=e,this.blurPass.blurMaterial.offset=e,this.updateParams()}get focusArea(){return this._focusArea}set focusArea(e){this._focusArea=e,this.blurPass.blurMaterial.focusArea=e,this.updateParams()}get feather(){return this._feather}set feather(e){this._feather=e,this.blurPass.blurMaterial.feather=e,this.updateParams()}get bias(){return 0}set bias(e){}update(e,t,i){this.blurPass.render(e,t,this.renderTarget)}setSize(e,t){const i=this.resolution;i.setBaseSize(e,t),this.renderTarget.setSize(i.width,i.height),this.blurPass.resolution.copy(i)}initialize(e,t,i){this.blurPass.initialize(e,t,i),i!==void 0&&(this.renderTarget.texture.type=i,Wl(e)===vi&&lr(this.renderTarget.texture,vi))}},N6=`uniform float offset;uniform float darkness;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){const vec2 center=vec2(0.5);vec3 color=inputColor.rgb;
#if VIGNETTE_TECHNIQUE == 0
float d=distance(uv,center);color*=smoothstep(0.8,offset*0.799,d*(darkness+offset));
#else
vec2 coord=(uv-center)*vec2(offset);color=mix(color,vec3(1.0-darkness),dot(coord,coord));
#endif
outputColor=vec4(color,inputColor.a);}`,uF=class extends $o{constructor({blendFunction:n,technique:e=Uv.DEFAULT,eskil:t=!1,offset:i=.5,darkness:s=.5}={}){super("VignetteEffect",N6,{blendFunction:n,defines:new Map([["VIGNETTE_TECHNIQUE",e.toFixed(0)]]),uniforms:new Map([["offset",new xe(i)],["darkness",new xe(s)]])})}get technique(){return Number(this.defines.get("VIGNETTE_TECHNIQUE"))}set technique(n){this.technique!==n&&(this.defines.set("VIGNETTE_TECHNIQUE",n.toFixed(0)),this.setChanged())}get eskil(){return this.technique===Uv.ESKIL}set eskil(n){this.technique=n?Uv.ESKIL:Uv.DEFAULT}getTechnique(){return this.technique}setTechnique(n){this.technique=n}get offset(){return this.uniforms.get("offset").value}set offset(n){this.uniforms.get("offset").value=n}getOffset(){return this.offset}setOffset(n){this.offset=n}get darkness(){return this.uniforms.get("darkness").value}set darkness(n){this.uniforms.get("darkness").value=n}getDarkness(){return this.darkness}setDarkness(n){this.darkness=n}},kg=function(){var n=0,e=document.createElement("div");e.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",e.addEventListener("click",function(u){u.preventDefault(),i(++n%e.children.length)},!1);function t(u){return e.appendChild(u.dom),u}function i(u){for(var d=0;d<e.children.length;d++)e.children[d].style.display=d===u?"block":"none";n=u}var s=(performance||Date).now(),r=s,o=0,a=t(new kg.Panel("FPS","#0ff","#002")),l=t(new kg.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=t(new kg.Panel("MB","#f08","#201"));return i(0),{REVISION:16,dom:e,addPanel:t,showPanel:i,begin:function(){s=(performance||Date).now()},end:function(){o++;var u=(performance||Date).now();if(l.update(u-s,200),u>=r+1e3&&(a.update(o*1e3/(u-r),100),r=u,o=0,c)){var d=performance.memory;c.update(d.usedJSHeapSize/1048576,d.jsHeapSizeLimit/1048576)}return u},update:function(){s=this.end()},domElement:e,setMode:i}};kg.Panel=function(n,e,t){var i=1/0,s=0,r=Math.round,o=r(window.devicePixelRatio||1),a=80*o,l=48*o,c=3*o,u=2*o,d=3*o,f=15*o,p=74*o,g=30*o,A=document.createElement("canvas");A.width=a,A.height=l,A.style.cssText="width:80px;height:48px";var v=A.getContext("2d");return v.font="bold "+9*o+"px Helvetica,Arial,sans-serif",v.textBaseline="top",v.fillStyle=t,v.fillRect(0,0,a,l),v.fillStyle=e,v.fillText(n,c,u),v.fillRect(d,f,p,g),v.fillStyle=t,v.globalAlpha=.9,v.fillRect(d,f,p,g),{dom:A,update:function(m,b){i=Math.min(i,m),s=Math.max(s,m),v.fillStyle=t,v.globalAlpha=1,v.fillRect(0,0,a,f),v.fillStyle=e,v.fillText(r(m)+" "+n+" ("+r(i)+"-"+r(s)+")",c,u),v.drawImage(A,d+o,f,p-o,g,d,f,p-o,g),v.fillRect(d+p-o,f,o,g),v.fillStyle=t,v.globalAlpha=.9,v.fillRect(d+p-o,f,o,r((1-m/b)*g))}}};class z6{static fromCubeTexture(e){let t=0;const i=new w,s=new w,r=new _e,o=[0,0,0,0,0,0,0,0,0],a=new jd,l=a.coefficients;for(let u=0;u<6;u++){const d=e.image[u],f=d.width,p=d.height,g=document.createElement("canvas");g.width=f,g.height=p;const A=g.getContext("2d");A.drawImage(d,0,0,f,p);const v=A.getImageData(0,0,f,p),m=v.data,b=v.width,y=2/b;for(let _=0,E=m.length;_<E;_+=4){r.setRGB(m[_]/255,m[_+1]/255,m[_+2]/255),WP(r,e.colorSpace);const M=_/4,I=-1+(M%b+.5)*y,R=1-(Math.floor(M/b)+.5)*y;switch(u){case 0:i.set(-1,R,-I);break;case 1:i.set(1,R,I);break;case 2:i.set(-I,1,-R);break;case 3:i.set(-I,-1,R);break;case 4:i.set(-I,R,1);break;case 5:i.set(I,R,-1);break}const C=i.lengthSq(),T=4/(Math.sqrt(C)*C);t+=T,s.copy(i).normalize(),jd.getBasisAt(s,o);for(let O=0;O<9;O++)l[O].x+=o[O]*r.r*T,l[O].y+=o[O]*r.g*T,l[O].z+=o[O]*r.b*T}}const c=4*Math.PI/t;for(let u=0;u<9;u++)l[u].x*=c,l[u].y*=c,l[u].z*=c;return new Of(a)}static fromCubeRenderTarget(e,t){let i=0;const s=new w,r=new w,o=new _e,a=[0,0,0,0,0,0,0,0,0],l=new jd,c=l.coefficients;for(let d=0;d<6;d++){const f=t.width,p=new Uint8Array(f*f*4);e.readRenderTargetPixels(t,0,0,f,f,p,d);const g=2/f;for(let A=0,v=p.length;A<v;A+=4){o.setRGB(p[A]/255,p[A+1]/255,p[A+2]/255),WP(o,t.texture.colorSpace);const m=A/4,b=-1+(m%f+.5)*g,y=1-(Math.floor(m/f)+.5)*g;switch(d){case 0:s.set(1,y,-b);break;case 1:s.set(-1,y,b);break;case 2:s.set(b,1,-y);break;case 3:s.set(b,-1,y);break;case 4:s.set(b,y,1);break;case 5:s.set(-b,y,-1);break}const _=s.lengthSq(),E=4/(Math.sqrt(_)*_);i+=E,r.copy(s).normalize(),jd.getBasisAt(r,a);for(let M=0;M<9;M++)c[M].x+=a[M]*o.r*E,c[M].y+=a[M]*o.g*E,c[M].z+=a[M]*o.b*E}}const u=4*Math.PI/i;for(let d=0;d<9;d++)c[d].x*=u,c[d].y*=u,c[d].z*=u;return new Of(l)}}function WP(n,e){switch(e){case Je:n.convertSRGBToLinear();break;case gn:case ur:break;default:console.warn("WARNING: LightProbeGenerator convertColorToLinear() encountered an unsupported color space.");break}return n}new Dn;const lA=new Uint8Array(4);lA[0]=255;lA[1]=255;lA[2]=255;lA[3]=255;const G6=new Ao(lA,1,1,Ti);function dF(n,e=1){const t="alpha"in n,i=e*e,s=new Uint8Array(4*i),r=Math.floor(n.r*255),o=Math.floor(n.g*255),a=Math.floor(n.b*255);for(let c=0;c<i;c++){const u=c*4;s[u+0]=r,s[u+1]=o,s[u+2]=a,t?s[u+3]=Math.floor(n.alpha*255):s[u+3]=255}const l=new Ao(s,e,e);return l.needsUpdate=!0,l}function V6(n,e,t,i=1,s=3){const o=i*s,a=[n,e,t],l=a.length,c=new Uint8Array(4*l*o),u=new _e;for(let f=0;f<s;f++){const p=Math.floor(f/s*l),g=tt.clamp(p+1,0,l-1),A=a[p],v=a[g],m=f/s*l%1;u.lerpColors(A,v,m);const b=Math.floor(u.r*255),y=Math.floor(u.g*255),_=Math.floor(u.b*255);for(let E=0;E<i;E++){const M=(f*i+E)*4;c[M+0]=b,c[M+1]=y,c[M+2]=_,c[M+3]=255}}const d=new Ao(c,i,s);return d.needsUpdate=!0,d}var jP;(function(n){n[n.Vertex=0]="Vertex",n[n.Fragment=1]="Fragment"})(jP||(jP={}));function b0(n,e){const t=n.elements;e||(e=[]),e.length=0;for(let i=0;i<16;i+=4){const s=t[i],r=t[i+1],o=t[i+2],a=t[i+3],l=new Ke(s,r,o,a);e.push(l)}return e}const pw=[],qP=[];function fF(n,e){if(pw.length===0)for(let t=0;t<27;t++)pw.push(0);e||(e=pw);for(let t=0;t<27;t++)qP[t]=e[t];e=qP,n.unity_SHAr={value:new Ke(e[9],e[3],e[6],e[0])},n.unity_SHBr={value:new Ke(e[12],e[15],e[18],e[21])},n.unity_SHAg={value:new Ke(e[10],e[4],e[7],e[1])},n.unity_SHBg={value:new Ke(e[13],e[16],e[19],e[22])},n.unity_SHAb={value:new Ke(e[11],e[5],e[8],e[2])},n.unity_SHBb={value:new Ke(e[14],e[17],e[20],e[23])},n.unity_SHC={value:new Ke(e[24],e[25],e[26],1)}}class H6{constructor(e,t,i){h(this,"vertexShader");h(this,"fragmentShader");h(this,"technique");this.vertexShader=e,this.fragmentShader=t,this.technique=i}}async function Q6(n,e){if(!n)return console.error("Can not find technique: no shader data"),null;const t=n.programs[e],i=t.vertexShader,s=t.fragmentShader;if(i!==void 0&&s!==void 0){const r=n.shaders[i],o=n.shaders[s];if(r.uri&&o.uri||r.code&&o.code){if(!r.code&&r.uri&&await XP(r),!o.code&&o.uri&&await XP(o),!r.code||!o.code)return null;const a=n.techniques[e];return new H6(r.code,o.code,a)}}return console.error("Shader technique not found",e),null}async function XP(n){const e=n.uri;if(e)if(e.endsWith(".glsl")){const i=await new Dn().loadAsync(e);n.code=i.toString()}else n.code=W6(n.uri)}function W6(n){return decodeURIComponent(Array.prototype.map.call(atob(n),function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join(""))}var pF={exports:{}},gF={exports:{}};(function(){var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e={rotl:function(t,i){return t<<i|t>>>32-i},rotr:function(t,i){return t<<32-i|t>>>i},endian:function(t){if(t.constructor==Number)return e.rotl(t,8)&16711935|e.rotl(t,24)&4278255360;for(var i=0;i<t.length;i++)t[i]=e.endian(t[i]);return t},randomBytes:function(t){for(var i=[];t>0;t--)i.push(Math.floor(Math.random()*256));return i},bytesToWords:function(t){for(var i=[],s=0,r=0;s<t.length;s++,r+=8)i[r>>>5]|=t[s]<<24-r%32;return i},wordsToBytes:function(t){for(var i=[],s=0;s<t.length*32;s+=8)i.push(t[s>>>5]>>>24-s%32&255);return i},bytesToHex:function(t){for(var i=[],s=0;s<t.length;s++)i.push((t[s]>>>4).toString(16)),i.push((t[s]&15).toString(16));return i.join("")},hexToBytes:function(t){for(var i=[],s=0;s<t.length;s+=2)i.push(parseInt(t.substr(s,2),16));return i},bytesToBase64:function(t){for(var i=[],s=0;s<t.length;s+=3)for(var r=t[s]<<16|t[s+1]<<8|t[s+2],o=0;o<4;o++)s*8+o*6<=t.length*8?i.push(n.charAt(r>>>6*(3-o)&63)):i.push("=");return i.join("")},base64ToBytes:function(t){t=t.replace(/[^A-Z0-9+\/]/ig,"");for(var i=[],s=0,r=0;s<t.length;r=++s%4)r!=0&&i.push((n.indexOf(t.charAt(s-1))&Math.pow(2,-2*r+8)-1)<<r*2|n.indexOf(t.charAt(s))>>>6-r*2);return i}};gF.exports=e})();var j6=gF.exports,NC={utf8:{stringToBytes:function(n){return NC.bin.stringToBytes(unescape(encodeURIComponent(n)))},bytesToString:function(n){return decodeURIComponent(escape(NC.bin.bytesToString(n)))}},bin:{stringToBytes:function(n){for(var e=[],t=0;t<n.length;t++)e.push(n.charCodeAt(t)&255);return e},bytesToString:function(n){for(var e=[],t=0;t<n.length;t++)e.push(String.fromCharCode(n[t]));return e.join("")}}},YP=NC;/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var q6=function(n){return n!=null&&(mF(n)||X6(n)||!!n._isBuffer)};function mF(n){return!!n.constructor&&typeof n.constructor.isBuffer=="function"&&n.constructor.isBuffer(n)}function X6(n){return typeof n.readFloatLE=="function"&&typeof n.slice=="function"&&mF(n.slice(0,0))}(function(){var n=j6,e=YP.utf8,t=q6,i=YP.bin,s=function(r,o){r.constructor==String?o&&o.encoding==="binary"?r=i.stringToBytes(r):r=e.stringToBytes(r):t(r)?r=Array.prototype.slice.call(r,0):!Array.isArray(r)&&r.constructor!==Uint8Array&&(r=r.toString());for(var a=n.bytesToWords(r),l=r.length*8,c=1732584193,u=-271733879,d=-1732584194,f=271733878,p=0;p<a.length;p++)a[p]=(a[p]<<8|a[p]>>>24)&16711935|(a[p]<<24|a[p]>>>8)&4278255360;a[l>>>5]|=128<<l%32,a[(l+64>>>9<<4)+14]=l;for(var g=s._ff,A=s._gg,v=s._hh,m=s._ii,p=0;p<a.length;p+=16){var b=c,y=u,_=d,E=f;c=g(c,u,d,f,a[p+0],7,-680876936),f=g(f,c,u,d,a[p+1],12,-389564586),d=g(d,f,c,u,a[p+2],17,606105819),u=g(u,d,f,c,a[p+3],22,-1044525330),c=g(c,u,d,f,a[p+4],7,-176418897),f=g(f,c,u,d,a[p+5],12,1200080426),d=g(d,f,c,u,a[p+6],17,-1473231341),u=g(u,d,f,c,a[p+7],22,-45705983),c=g(c,u,d,f,a[p+8],7,1770035416),f=g(f,c,u,d,a[p+9],12,-1958414417),d=g(d,f,c,u,a[p+10],17,-42063),u=g(u,d,f,c,a[p+11],22,-1990404162),c=g(c,u,d,f,a[p+12],7,1804603682),f=g(f,c,u,d,a[p+13],12,-40341101),d=g(d,f,c,u,a[p+14],17,-1502002290),u=g(u,d,f,c,a[p+15],22,1236535329),c=A(c,u,d,f,a[p+1],5,-165796510),f=A(f,c,u,d,a[p+6],9,-1069501632),d=A(d,f,c,u,a[p+11],14,643717713),u=A(u,d,f,c,a[p+0],20,-373897302),c=A(c,u,d,f,a[p+5],5,-701558691),f=A(f,c,u,d,a[p+10],9,38016083),d=A(d,f,c,u,a[p+15],14,-660478335),u=A(u,d,f,c,a[p+4],20,-405537848),c=A(c,u,d,f,a[p+9],5,568446438),f=A(f,c,u,d,a[p+14],9,-1019803690),d=A(d,f,c,u,a[p+3],14,-187363961),u=A(u,d,f,c,a[p+8],20,1163531501),c=A(c,u,d,f,a[p+13],5,-1444681467),f=A(f,c,u,d,a[p+2],9,-51403784),d=A(d,f,c,u,a[p+7],14,1735328473),u=A(u,d,f,c,a[p+12],20,-1926607734),c=v(c,u,d,f,a[p+5],4,-378558),f=v(f,c,u,d,a[p+8],11,-2022574463),d=v(d,f,c,u,a[p+11],16,1839030562),u=v(u,d,f,c,a[p+14],23,-35309556),c=v(c,u,d,f,a[p+1],4,-1530992060),f=v(f,c,u,d,a[p+4],11,1272893353),d=v(d,f,c,u,a[p+7],16,-155497632),u=v(u,d,f,c,a[p+10],23,-1094730640),c=v(c,u,d,f,a[p+13],4,681279174),f=v(f,c,u,d,a[p+0],11,-358537222),d=v(d,f,c,u,a[p+3],16,-722521979),u=v(u,d,f,c,a[p+6],23,76029189),c=v(c,u,d,f,a[p+9],4,-640364487),f=v(f,c,u,d,a[p+12],11,-421815835),d=v(d,f,c,u,a[p+15],16,530742520),u=v(u,d,f,c,a[p+2],23,-995338651),c=m(c,u,d,f,a[p+0],6,-198630844),f=m(f,c,u,d,a[p+7],10,1126891415),d=m(d,f,c,u,a[p+14],15,-1416354905),u=m(u,d,f,c,a[p+5],21,-57434055),c=m(c,u,d,f,a[p+12],6,1700485571),f=m(f,c,u,d,a[p+3],10,-1894986606),d=m(d,f,c,u,a[p+10],15,-1051523),u=m(u,d,f,c,a[p+1],21,-2054922799),c=m(c,u,d,f,a[p+8],6,1873313359),f=m(f,c,u,d,a[p+15],10,-30611744),d=m(d,f,c,u,a[p+6],15,-1560198380),u=m(u,d,f,c,a[p+13],21,1309151649),c=m(c,u,d,f,a[p+4],6,-145523070),f=m(f,c,u,d,a[p+11],10,-1120210379),d=m(d,f,c,u,a[p+2],15,718787259),u=m(u,d,f,c,a[p+9],21,-343485551),c=c+b>>>0,u=u+y>>>0,d=d+_>>>0,f=f+E>>>0}return n.endian([c,u,d,f])};s._ff=function(r,o,a,l,c,u,d){var f=r+(o&a|~o&l)+(c>>>0)+d;return(f<<u|f>>>32-u)+o},s._gg=function(r,o,a,l,c,u,d){var f=r+(o&l|a&~l)+(c>>>0)+d;return(f<<u|f>>>32-u)+o},s._hh=function(r,o,a,l,c,u,d){var f=r+(o^a^l)+(c>>>0)+d;return(f<<u|f>>>32-u)+o},s._ii=function(r,o,a,l,c,u,d){var f=r+(a^(o|~l))+(c>>>0)+d;return(f<<u|f>>>32-u)+o},s._blocksize=16,s._digestsize=16,pF.exports=function(r,o){if(r==null)throw new Error("Illegal argument "+r);var a=n.wordsToBytes(s(r,o));return o&&o.asBytes?a:o&&o.asString?i.bytesToString(a):n.bytesToHex(a)}})();var Y6=pF.exports;const J6=i_(Y6);class JP{constructor(e,t,i,s){h(this,"success");h(this,"filename");h(this,"hash");h(this,"size");h(this,"url");this.success=e,this.filename=t,this.hash=i,this.size=s}}async function K6(n,e){const t=await n.arrayBuffer(),i=AF(t),s=n.name.split(".").pop(),r=i+"."+s,o=n.name.split(".").shift();console.assert(o!==void 0);const a={alias:o,filename:r},c=await(await fetch(e+"/exists",{method:"POST",body:JSON.stringify(a)})).json();if(c.success||console.warn("exists check did fail"),c.exists)return console.log("file already exists",i),new JP(!0,r,i,n.size);console.log("begin uploading file",o,n.size);const u=new FormData;u.append("file",n);const d={};d.filesize=n.size,o&&(d.alias=o);const p=await(await fetch(e+"/upload/file",{method:"POST",body:u,headers:d})).json();if((p==null?void 0:p.success)===!1)return p.message!==void 0?console.error("Upload failed:",p.message):console.error("Upload failed"),null;console.assert(p.hash_sum===i,"hash sum did not match","received:",p.hash_sum,"expected:",i),p.success&&console.log("successfully uploaded",i,p.id);const g=new JP(p.success,r,i,n.size);return g.url=e,g}function AF(n){return J6(new Uint8Array(n))}async function vF(n,e,t,i,s=!1){try{const r=await fetch(i+"/download/file",{method:"POST",body:n});if(r.status!==200)return console.error("download failed",r),null;const o=await r.blob(),a=await o.arrayBuffer();s||console.assert(o.size===t,"size mismatch","expected:",t,"got:",o.size);const l=AF(a);return s||console.assert(l===e,"hash mismatch, downloaded file is invalid"),o.arrayBuffer()}catch(r){console.error(r)}return null}async function Z6(n,e){var u;const t=await fetch(n),i=(u=t.body)==null?void 0:u.getReader(),s=t.headers.get("Content-Length"),r=s?parseInt(s):0;if(!i)return null;let o=0;const a=[];for(;;){const{done:d,value:f}=await i.read();if(f&&(a.push(f),o+=f.length,e.call(null,new ProgressEvent("progress",{loaded:o,total:r}))),d)break}const l=new Uint8Array(o);let c=0;for(const d of a)l.set(d,c),c+=d.length;return l}let yF,KP=null;function Ga(){return yF}function bF(n){if(n==null){console.warn("Oh no: someone tried registering a non-existend gltf-loader. When you see this log it might mean that needle-engine is being imported multiple times. Please check your project setup.");return}KP!==n&&(KP=n,yF=new n)}const dc=re("debugaddressables");class $6{constructor(e){h(this,"_context");h(this,"_assetReferences",{});this._context=e,this._context.pre_update_callbacks.push(this.preUpdate.bind(this))}preUpdate(){}findAssetReference(e){return this._assetReferences[e]||null}registerAssetReference(e){return e.uri&&(this._assetReferences[e.uri]?console.warn("Asset reference already registered",e):this._assetReferences[e.uri]=e),e}dispose(){for(const e in this._assetReferences){const t=this._assetReferences[e];t==null||t.unload()}this._assetReferences={}}unregisterAssetReference(e){e.uri&&delete this._assetReferences[e.uri]}}const gw=Symbol("assetReference"),rf=class{constructor(e,t,i=null){h(this,"_loading");h(this,"_asset");h(this,"_glbRoot");h(this,"_url");h(this,"_progressListeners",[]);h(this,"_hash");h(this,"_hashedUri");h(this,"_isLoadingRawBinary",!1);h(this,"_rawBinary");this._url=e,this._hash=t,e.includes("?v=")?this._hashedUri=e:this._hashedUri=t?e+"?v="+t:e,i!==null&&(this.asset=i),ZW(this._url,this.onResolvePrefab.bind(this))}static getOrCreate(e,t,i){if(typeof e=="string"){if(!i&&(i=Lt.Current,!i))throw new Error('Context is required when sourceId is a string. When you call this method from a component you can call it with "getOrCreate(this, url)" where "this" is the component.')}else i=e.context,e=e.sourceId;const s=Nu(e,t);dc&&console.log("GetOrCreate Addressable from",e,t,"FinalPath=",s);const r=i.addressables,o=r.findAssetReference(s);if(o)return o;const a=new rf(s,i.hash);return r.registerAssetReference(a),a}get asset(){return this._glbRoot??this._asset}set asset(e){this._asset=e}get uri(){return this._url}get rawAsset(){return this._asset}async onResolvePrefab(e){return e===this.uri&&(this.mustLoad&&await this.loadAssetAsync(),this.asset)?this.asset:null}get mustLoad(){return!this.asset||this.asset.__destroyed===!0||nT(this.asset)===!0}isLoaded(){return this._rawBinary||this.asset!==void 0}unload(){this.asset&&(dc&&console.log("Unload",this.asset),this.asset.scene&&Zc(this.asset.scene,!0,!0),Zc(this.asset,!0,!0)),this.asset=null,this._rawBinary=void 0,this._glbRoot=null,this._loading=void 0,Lt.Current&&Lt.Current.addressables.unregisterAssetReference(this)}async preload(){if(!this.mustLoad||this._isLoadingRawBinary)return null;if(this._rawBinary!==void 0)return this._rawBinary;this._isLoadingRawBinary=!0,dc&&console.log("Preload",this._hashedUri);const e=await Z6(this._hashedUri,t=>{this.raiseProgressEvent(t)});return this._rawBinary=(e==null?void 0:e.buffer)??null,this._isLoadingRawBinary=!1,this._rawBinary}async loadAssetAsync(e){if(dc&&console.log("loadAssetAsync",this.uri),!this.mustLoad)return this.asset;if(e&&this._progressListeners.push(e),this._loading!==void 0)return this._loading;const t=Lt.Current;this._rawBinary?(this._loading=Ga().parseSync(t,this._rawBinary,this.uri,null),this.raiseProgressEvent(new ProgressEvent("progress",{loaded:this._rawBinary.byteLength,total:this._rawBinary.byteLength}))):(dc&&console.log("Load async",this.uri),this._loading=Ga().loadSync(t,this._hashedUri,this.uri,null,s=>{this.raiseProgressEvent(s)}));const i=await this._loading;if(this._progressListeners.length=0,this._glbRoot=this.tryGetActualGameObjectRoot(i),this._loading=void 0,i)return i[gw]=this,this._glbRoot&&(this._glbRoot[gw]=this),this.asset&&(this.asset[gw]=this),y0(t),i.scene!==void 0&&(this.asset=i),this.asset}async instantiate(e){return this.onInstantiate(e,!1)}async instantiateSynced(e,t=!0){return this.onInstantiate(e,!0,t)}beginListenDownload(e){this._progressListeners.indexOf(e)<0&&this._progressListeners.push(e)}endListenDownload(e){const t=this._progressListeners.indexOf(e);t>=0&&this._progressListeners.splice(t,1)}raiseProgressEvent(e){for(const t of this._progressListeners)t(this,e)}async onInstantiate(e,t=!1,i){const s=Lt.Current;if(this.mustLoad&&await this.loadAssetAsync(),dc&&console.log("Instantiate",this.uri,"parent:",e),this.asset){dc&&console.log("Add to scene",this.asset);let r=e instanceof Hl?e:null;r||(r=new Hl),typeof e=="object"&&(e instanceof Me?r.parent=e:Object.assign(r,e)),r.parent||(r.parent=s.scene);let o=rf.currentlyInstantiating.get(this.uri);if(o!==void 0&&o>=1e4)return console.error("Recursive or too many instantiations of "+this.uri+" in the same frame ("+o+")"),null;try{if(o===void 0&&(o=0),o+=1,rf.currentlyInstantiating.set(this.uri,o),t){r.context=s;const a=this.asset;a.guid=this.uri;const l=_2(a,r,void 0,i);if(l)return l}else{const a=u_(this.asset,r);if(a)return a}}finally{s.post_render_callbacks.push(()=>{o===void 0||o<0?o=0:o-=1,rf.currentlyInstantiating.set(this.uri,o)})}}else dc&&console.warn("Failed to load asset",this.uri);return null}tryGetActualGameObjectRoot(e){if(e&&e.scene){const t=e.scene;return t.isGroup&&t.children.length===1&&t.children[0].name+"glb"===t.name?t.children[0]:t}return null}};let wn=rf;h(wn,"currentlyInstantiating",new Map);class eq extends hh{constructor(){super([wn])}onSerialize(e,t){if(e&&e.uri!==void 0&&typeof e.uri=="string")return e.uri}onDeserialize(e,t){if(typeof e=="string")return t.context?t.gltfId?wn.getOrCreate(t.gltfId,e,t.context):(console.error("Missing source id"),null):(console.error("Missing context"),null);if(e instanceof Me){if(!t.context)return console.error("Missing context"),null;if(!t.gltfId)return console.error("Missing source id"),null;const i=e,s=t.context,r=i.guid??i.uuid,o=s.addressables.findAssetReference(r);if(o)return o;const a=new wn(r,void 0,i);return s.addressables.registerAssetReference(a),a}return null}}new eq;const tq=Promise.resolve(null),sm=class{constructor(e){h(this,"url");h(this,"_bitmap");h(this,"_bitmapObject");h(this,"loader",null);this.url=e}static getOrCreate(e){let t=sm.imageReferences.get(e);return t||(t=new sm(e),sm.imageReferences.set(e,t)),t}dispose(){this._bitmapObject&&this._bitmapObject.close(),this._bitmap=void 0}createHTMLImage(){const e=new Image;return e.src=this.url,e}createTexture(){return this.url?(this.loader||(this.loader=new kl),this.loader.setCrossOrigin("anonymous"),this.loader.loadAsync(this.url)):tq}getBitmap(){return this._bitmap?this._bitmap:(this._bitmap=new Promise((e,t)=>{const i=document.createElement("img");i.addEventListener("load",()=>{this._bitmap=createImageBitmap(i).then(s=>(this._bitmapObject=s,e(s),s))}),i.addEventListener("error",s=>{console.error("Failed to load image:"+this.url,s),e(null)}),i.src=this.url}),this._bitmap)}};let Lg=sm;h(Lg,"imageReferences",new Map);class iq extends hh{constructor(){super([Lg])}onSerialize(e,t){return null}onDeserialize(e,t){if(typeof e=="string"){const i=Nu(t.gltfId,e);return Lg.getOrCreate(i)}}}new iq;const no=re("debugenvlight");var Ea;(function(n){n[n.Skybox=0]="Skybox",n[n.Trilight=1]="Trilight",n[n.Flat=3]="Flat",n[n.Custom=4]="Custom"})(Ea||(Ea={}));var Im;(function(n){n[n.Skybox=0]="Skybox",n[n.Custom=1]="Custom"})(Im||(Im={}));class nq{constructor(e){h(this,"context");h(this,"_currentLightSettingsId");h(this,"_sceneLightSettings");h(this,"_timevec4",new Ke);h(this,"__currentReflectionId",null);h(this,"_waitPromise");h(this,"_lighting",{});this.context=e,this.context.pre_update_callbacks.push(this.preUpdate.bind(this))}preUpdate(){const e=this.context.time;this._timevec4.x=e.time,this._timevec4.y=Math.sin(e.time),this._timevec4.z=Math.cos(e.time),this._timevec4.w=e.deltaTime}get timeVec4(){return this._timevec4}get environmentIntensity(){if(!this._sceneLightSettings||!this._currentLightSettingsId)return 1;const e=this._sceneLightSettings.get(this._currentLightSettingsId);return e?e.ambientIntensity:1}get sceneLightSettings(){var e;return(e=this._sceneLightSettings)==null?void 0:e.values()}enable(e){var i;e instanceof wn&&(e=e.uri);const t=(i=this._sceneLightSettings)==null?void 0:i.get(e);return t?(no&&console.log("Enable scene light settings",e,t),e!==this._currentLightSettingsId&&this._currentLightSettingsId&&this.disable(this._currentLightSettingsId),this._currentLightSettingsId=e,t.enabled=!0,!0):!1}disable(e){var i;if(e instanceof wn&&(e=e.uri),e==null)return!1;const t=(i=this._sceneLightSettings)==null?void 0:i.get(e);return t?(no&&console.log("Disable scene light settings",e,t),t.enabled=!1,!0):!1}disableCurrent(){if(this._currentLightSettingsId){const e=this._currentLightSettingsId;return this.disable(this._currentLightSettingsId),e}return null}internalRegisterSceneLightSettings(e){const t=e.sourceId;if(!t){console.error("Missing source id for scene light settings, can not register:",e);return}no&&console.log("Register "+(e==null?void 0:e.sourceId)+" lighting",e),this._sceneLightSettings||(this._sceneLightSettings=new Map),this._sceneLightSettings.set(t,e)}internalUnregisterSceneLightSettings(e){const t=e.sourceId;if(!t){console.error("Missing source id for scene light settings, can not unregister:",e);return}no&&console.log("Unregister "+(e==null?void 0:e.sourceId)+" lighting",e),this._sceneLightSettings&&this._sceneLightSettings.delete(t)}internalRegisterReflection(e,t){no&&console.log("Register reflection",e,t);const i=new sq(this.context,t,1);this._lighting[e]=i}internalGetReflection(e){return this._lighting[e]}internalEnableReflection(e){var i;this.__currentReflectionId=e;const t=(i=this._sceneLightSettings)==null?void 0:i.get(e);switch(no&&console.log("Enable reflection",e,t?Ea[t.ambientMode]:"Unknown ambient mode"),t==null?void 0:t.ambientMode){case Ea.Skybox:case Ea.Custom:const s=this.internalGetReflection(e);if(s&&s.Source){no&&console.log("Setting environment reflection",s);const r=this.context.scene,o=s.Source;o.colorSpace=Je,o.mapping=mo,r.environment=o;return}else no&&console.warn("Could not find reflection for source",e);break}if((t==null?void 0:t.environmentReflectionSource)===Im.Custom)switch(t==null?void 0:t.ambientMode){case Ea.Trilight:if(t.ambientTrilight){const s=t.ambientTrilight,r=V6(s[0],s[1],s[2],64,64);r.colorSpace=Je,r.mapping=mo,this.context.scene.environment=r}else console.error("Missing ambient trilight",t.sourceId);return;case Ea.Flat:if(t.ambientLight){const s=dF(t.ambientLight,64);s.colorSpace=Je,s.mapping=mo,this.context.scene.environment=s}else console.error("Missing ambientlight",t.sourceId);return;default:return}}internalDisableReflection(e){if(e&&e!==this.__currentReflectionId){no&&console.log("Not disabling reflection for",e,"because it is not the current light settings id",this.__currentReflectionId);return}no&&console.log("Disable reflection",e);const t=this.context.scene;t.environment=null}async internalGetSceneLightingData(e){return no&&console.log("GET SCENE LIGHT DATA",e),this._waitPromise?this._waitPromise:(this._waitPromise=new Promise((t,i)=>{const s=setInterval(async()=>{const r=this.internalGetReflection(e);r&&(clearInterval(s),t(r.getSphericalHarmonicsArray(this.environmentIntensity??1)))},10)}),this._waitPromise)}}class sq{constructor(e,t,i=1){h(this,"_context");h(this,"_source");h(this,"_sphericalHarmonics",null);h(this,"_sphericalHarmonicsArray");h(this,"_ambientScale",1);h(this,"_lightProbe");this._context=e,this._source=t,this._ambientScale=i,t.mapping=mo,t.colorSpace=Je}get Source(){return this._source}get Array(){return this._sphericalHarmonicsArray}getSphericalHarmonicsArray(e=1){var t;if((t=this._sphericalHarmonicsArray)!=null&&t.length&&this._source)return{array:this._sphericalHarmonicsArray,texture:this._source,lightProbe:this._lightProbe};try{const i=this._source;let s=null;if(i){no&&console.log("GENERATING LIGHT PROBE",i,this.Source);const r=Math.min(i.image.width,512);s=new Cb(r).fromEquirectangularTexture(this._context.renderer,i)}if(this._sphericalHarmonicsArray=[],s){const r=z6.fromCubeRenderTarget(this._context.renderer,s);this._lightProbe=r;const o=this._ambientScale*(e*e*Math.PI*.5)-1;if(this._sphericalHarmonics=r.sh,this._sphericalHarmonicsArray=this._sphericalHarmonics.toArray(),this._sphericalHarmonicsArray){const a=e/(Math.PI*.5);for(let l=0;l<this._sphericalHarmonicsArray.length;l++)this._sphericalHarmonicsArray[l]*=a;if(r.sh.scale(o),this._source)return{array:this._sphericalHarmonicsArray,texture:this._source,lightProbe:r}}}}catch(i){console.error(i)}return null}}var Au;(function(n){n.Visible="application-visible",n.Hidden="application-hidden",n.MuteChanged="application-mutechanged"})(Au||(Au={}));class rq extends EventTarget{constructor(t){super();h(this,"_mute",!1);h(this,"context");h(this,"_isVisible",!0);this.context=t,window.addEventListener("visibilitychange",this.onVisiblityChanged.bind(this),!1)}get muted(){return this._mute}set muted(t){t!==this._mute&&(this._mute=t,this.dispatchEvent(new Event(Au.MuteChanged)))}get hasFocus(){return document.hasFocus()}get isVisible(){return this._isVisible}onVisiblityChanged(t){switch(t.target.visibilityState){case"hidden":this._isVisible=!1,this.dispatchEvent(new Event(Au.Hidden));break;case"visible":this._isVisible=!0,this.dispatchEvent(new Event(Au.Visible));break}}}/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.6.9
*/var ZP=function(n){return URL.createObjectURL(new Blob([n],{type:"text/javascript"}))};try{URL.revokeObjectURL(ZP(""))}catch{ZP=function(e){return"data:application/javascript;charset=UTF-8,"+encodeURI(e)}}var _n=Uint8Array,Hs=Uint16Array,Uf=Uint32Array,g_=new _n([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),m_=new _n([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),zC=new _n([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),_F=function(n,e){for(var t=new Hs(31),i=0;i<31;++i)t[i]=e+=1<<n[i-1];for(var s=new Uf(t[30]),i=1;i<30;++i)for(var r=t[i];r<t[i+1];++r)s[r]=r-t[i]<<5|i;return[t,s]},xF=_F(g_,2),wF=xF[0],GC=xF[1];wF[28]=258,GC[258]=28;var SF=_F(m_,0),oq=SF[0],$P=SF[1],VC=new Hs(32768);for(var Di=0;Di<32768;++Di){var fc=(Di&43690)>>>1|(Di&21845)<<1;fc=(fc&52428)>>>2|(fc&13107)<<2,fc=(fc&61680)>>>4|(fc&3855)<<4,VC[Di]=((fc&65280)>>>8|(fc&255)<<8)>>>1}var Ua=function(n,e,t){for(var i=n.length,s=0,r=new Hs(e);s<i;++s)++r[n[s]-1];var o=new Hs(e);for(s=0;s<e;++s)o[s]=o[s-1]+r[s-1]<<1;var a;if(t){a=new Hs(1<<e);var l=15-e;for(s=0;s<i;++s)if(n[s])for(var c=s<<4|n[s],u=e-n[s],d=o[n[s]-1]++<<u,f=d|(1<<u)-1;d<=f;++d)a[VC[d]>>>l]=c}else for(a=new Hs(i),s=0;s<i;++s)n[s]&&(a[s]=VC[o[n[s]-1]++]>>>15-n[s]);return a},$c=new _n(288);for(var Di=0;Di<144;++Di)$c[Di]=8;for(var Di=144;Di<256;++Di)$c[Di]=9;for(var Di=256;Di<280;++Di)$c[Di]=7;for(var Di=280;Di<288;++Di)$c[Di]=8;var Rm=new _n(32);for(var Di=0;Di<32;++Di)Rm[Di]=5;var aq=Ua($c,9,0),lq=Ua($c,9,1),cq=Ua(Rm,5,0),hq=Ua(Rm,5,1),mw=function(n){for(var e=n[0],t=1;t<n.length;++t)n[t]>e&&(e=n[t]);return e},Do=function(n,e,t){var i=e/8|0;return(n[i]|n[i+1]<<8)>>(e&7)&t},Aw=function(n,e){var t=e/8|0;return(n[t]|n[t+1]<<8|n[t+2]<<16)>>(e&7)},cT=function(n){return(n/8|0)+(n&7&&1)},hT=function(n,e,t){(e==null||e<0)&&(e=0),(t==null||t>n.length)&&(t=n.length);var i=new(n instanceof Hs?Hs:n instanceof Uf?Uf:_n)(t-e);return i.set(n.subarray(e,t)),i},uq=function(n,e,t){var i=n.length;if(!i||t&&!t.l&&i<5)return e||new _n(0);var s=!e||t,r=!t||t.i;t||(t={}),e||(e=new _n(i*3));var o=function(Ee){var Ne=e.length;if(Ee>Ne){var Ve=new _n(Math.max(Ne*2,Ee));Ve.set(e),e=Ve}},a=t.f||0,l=t.p||0,c=t.b||0,u=t.l,d=t.d,f=t.m,p=t.n,g=i*8;do{if(!u){t.f=a=Do(n,l,1);var A=Do(n,l+1,3);if(l+=3,A)if(A==1)u=lq,d=hq,f=9,p=5;else if(A==2){var y=Do(n,l,31)+257,_=Do(n,l+10,15)+4,E=y+Do(n,l+5,31)+1;l+=14;for(var M=new _n(E),I=new _n(19),R=0;R<_;++R)I[zC[R]]=Do(n,l+R*3,7);l+=_*3;for(var C=mw(I),T=(1<<C)-1,O=Ua(I,C,1),R=0;R<E;){var J=O[Do(n,l,T)];l+=J&15;var v=J>>>4;if(v<16)M[R++]=v;else{var V=0,H=0;for(v==16?(H=3+Do(n,l,3),l+=2,V=M[R-1]):v==17?(H=3+Do(n,l,7),l+=3):v==18&&(H=11+Do(n,l,127),l+=7);H--;)M[R++]=V}}var Y=M.subarray(0,y),N=M.subarray(y);f=mw(Y),p=mw(N),u=Ua(Y,f,1),d=Ua(N,p,1)}else throw"invalid block type";else{var v=cT(l)+4,m=n[v-4]|n[v-3]<<8,b=v+m;if(b>i){if(r)throw"unexpected EOF";break}s&&o(c+m),e.set(n.subarray(v,b),c),t.b=c+=m,t.p=l=b*8;continue}if(l>g){if(r)throw"unexpected EOF";break}}s&&o(c+131072);for(var L=(1<<f)-1,G=(1<<p)-1,ee=l;;ee=l){var V=u[Aw(n,l)&L],$=V>>>4;if(l+=V&15,l>g){if(r)throw"unexpected EOF";break}if(!V)throw"invalid length/literal";if($<256)e[c++]=$;else if($==256){ee=l,u=null;break}else{var j=$-254;if($>264){var R=$-257,ie=g_[R];j=Do(n,l,(1<<ie)-1)+wF[R],l+=ie}var Ae=d[Aw(n,l)&G],ge=Ae>>>4;if(!Ae)throw"invalid distance";l+=Ae&15;var N=oq[ge];if(ge>3){var ie=m_[ge];N+=Aw(n,l)&(1<<ie)-1,l+=ie}if(l>g){if(r)throw"unexpected EOF";break}s&&o(c+131072);for(var Ce=c+j;c<Ce;c+=4)e[c]=e[c-N],e[c+1]=e[c+1-N],e[c+2]=e[c+2-N],e[c+3]=e[c+3-N];c=Ce}}t.l=u,t.p=ee,t.b=c,u&&(a=1,t.m=f,t.d=d,t.n=p)}while(!a);return c==e.length?e:hT(e,0,c)},ol=function(n,e,t){t<<=e&7;var i=e/8|0;n[i]|=t,n[i+1]|=t>>>8},Gp=function(n,e,t){t<<=e&7;var i=e/8|0;n[i]|=t,n[i+1]|=t>>>8,n[i+2]|=t>>>16},vw=function(n,e){for(var t=[],i=0;i<n.length;++i)n[i]&&t.push({s:i,f:n[i]});var s=t.length,r=t.slice();if(!s)return[uT,0];if(s==1){var o=new _n(t[0].s+1);return o[t[0].s]=1,[o,1]}t.sort(function(E,M){return E.f-M.f}),t.push({s:-1,f:25001});var a=t[0],l=t[1],c=0,u=1,d=2;for(t[0]={s:-1,f:a.f+l.f,l:a,r:l};u!=s-1;)a=t[t[c].f<t[d].f?c++:d++],l=t[c!=u&&t[c].f<t[d].f?c++:d++],t[u++]={s:-1,f:a.f+l.f,l:a,r:l};for(var f=r[0].s,i=1;i<s;++i)r[i].s>f&&(f=r[i].s);var p=new Hs(f+1),g=HC(t[u-1],p,0);if(g>e){var i=0,A=0,v=g-e,m=1<<v;for(r.sort(function(M,I){return p[I.s]-p[M.s]||M.f-I.f});i<s;++i){var b=r[i].s;if(p[b]>e)A+=m-(1<<g-p[b]),p[b]=e;else break}for(A>>>=v;A>0;){var y=r[i].s;p[y]<e?A-=1<<e-p[y]++-1:++i}for(;i>=0&&A;--i){var _=r[i].s;p[_]==e&&(--p[_],++A)}g=e}return[new _n(p),g]},HC=function(n,e,t){return n.s==-1?Math.max(HC(n.l,e,t+1),HC(n.r,e,t+1)):e[n.s]=t},eB=function(n){for(var e=n.length;e&&!n[--e];);for(var t=new Hs(++e),i=0,s=n[0],r=1,o=function(l){t[i++]=l},a=1;a<=e;++a)if(n[a]==s&&a!=e)++r;else{if(!s&&r>2){for(;r>138;r-=138)o(32754);r>2&&(o(r>10?r-11<<5|28690:r-3<<5|12305),r=0)}else if(r>3){for(o(s),--r;r>6;r-=6)o(8304);r>2&&(o(r-3<<5|8208),r=0)}for(;r--;)o(s);r=1,s=n[a]}return[t.subarray(0,i),e]},Vp=function(n,e){for(var t=0,i=0;i<e.length;++i)t+=n[i]*e[i];return t},Ly=function(n,e,t){var i=t.length,s=cT(e+2);n[s]=i&255,n[s+1]=i>>>8,n[s+2]=n[s]^255,n[s+3]=n[s+1]^255;for(var r=0;r<i;++r)n[s+r+4]=t[r];return(s+4+i)*8},tB=function(n,e,t,i,s,r,o,a,l,c,u){ol(e,u++,t),++s[256];for(var d=vw(s,15),f=d[0],p=d[1],g=vw(r,15),A=g[0],v=g[1],m=eB(f),b=m[0],y=m[1],_=eB(A),E=_[0],M=_[1],I=new Hs(19),R=0;R<b.length;++R)I[b[R]&31]++;for(var R=0;R<E.length;++R)I[E[R]&31]++;for(var C=vw(I,7),T=C[0],O=C[1],J=19;J>4&&!T[zC[J-1]];--J);var V=c+5<<3,H=Vp(s,$c)+Vp(r,Rm)+o,Y=Vp(s,f)+Vp(r,A)+o+14+3*J+Vp(I,T)+(2*I[16]+3*I[17]+7*I[18]);if(V<=H&&V<=Y)return Ly(e,u,n.subarray(l,l+c));var N,L,G,ee;if(ol(e,u,1+(Y<H)),u+=2,Y<H){N=Ua(f,p,0),L=f,G=Ua(A,v,0),ee=A;var $=Ua(T,O,0);ol(e,u,y-257),ol(e,u+5,M-1),ol(e,u+10,J-4),u+=14;for(var R=0;R<J;++R)ol(e,u+3*R,T[zC[R]]);u+=3*J;for(var j=[b,E],ie=0;ie<2;++ie)for(var Ae=j[ie],R=0;R<Ae.length;++R){var ge=Ae[R]&31;ol(e,u,$[ge]),u+=T[ge],ge>15&&(ol(e,u,Ae[R]>>>5&127),u+=Ae[R]>>>12)}}else N=aq,L=$c,G=cq,ee=Rm;for(var R=0;R<a;++R)if(i[R]>255){var ge=i[R]>>>18&31;Gp(e,u,N[ge+257]),u+=L[ge+257],ge>7&&(ol(e,u,i[R]>>>23&31),u+=g_[ge]);var Ce=i[R]&31;Gp(e,u,G[Ce]),u+=ee[Ce],Ce>3&&(Gp(e,u,i[R]>>>5&8191),u+=m_[Ce])}else Gp(e,u,N[i[R]]),u+=L[i[R]];return Gp(e,u,N[256]),u+L[256]},dq=new Uf([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),uT=new _n(0),fq=function(n,e,t,i,s,r){var o=n.length,a=new _n(i+o+5*(1+Math.ceil(o/7e3))+s),l=a.subarray(i,a.length-s),c=0;if(!e||o<8)for(var u=0;u<=o;u+=65535){var d=u+65535;d<o?c=Ly(l,c,n.subarray(u,d)):(l[u]=r,c=Ly(l,c,n.subarray(u,o)))}else{for(var f=dq[e-1],p=f>>>13,g=f&8191,A=(1<<t)-1,v=new Hs(32768),m=new Hs(A+1),b=Math.ceil(t/3),y=2*b,_=function(me){return(n[me]^n[me+1]<<b^n[me+2]<<y)&A},E=new Uf(25e3),M=new Hs(288),I=new Hs(32),R=0,C=0,u=0,T=0,O=0,J=0;u<o;++u){var V=_(u),H=u&32767,Y=m[V];if(v[H]=Y,m[V]=H,O<=u){var N=o-u;if((R>7e3||T>24576)&&N>423){c=tB(n,l,0,E,M,I,C,T,J,u-J,c),T=R=C=0,J=u;for(var L=0;L<286;++L)M[L]=0;for(var L=0;L<30;++L)I[L]=0}var G=2,ee=0,$=g,j=H-Y&32767;if(N>2&&V==_(u-j))for(var ie=Math.min(p,N)-1,Ae=Math.min(32767,u),ge=Math.min(258,N);j<=Ae&&--$&&H!=Y;){if(n[u+G]==n[u+G-j]){for(var Ce=0;Ce<ge&&n[u+Ce]==n[u+Ce-j];++Ce);if(Ce>G){if(G=Ce,ee=j,Ce>ie)break;for(var Ee=Math.min(j,Ce-2),Ne=0,L=0;L<Ee;++L){var Ve=u-j+L+32768&32767,lt=v[Ve],xt=Ve-lt+32768&32767;xt>Ne&&(Ne=xt,Y=Ve)}}}H=Y,Y=v[H],j+=H-Y+32768&32767}if(ee){E[T++]=268435456|GC[G]<<18|$P[ee];var et=GC[G]&31,W=$P[ee]&31;C+=g_[et]+m_[W],++M[257+et],++I[W],O=u+G,++R}else E[T++]=n[u],++M[n[u]]}}c=tB(n,l,r,E,M,I,C,T,J,u-J,c),!r&&c&7&&(c=Ly(l,c+1,uT))}return hT(a,0,i+cT(c)+s)},pq=function(){for(var n=new Uf(256),e=0;e<256;++e){for(var t=e,i=9;--i;)t=(t&1&&3988292384)^t>>>1;n[e]=t}return n}(),gq=function(){var n=-1;return{p:function(e){for(var t=n,i=0;i<e.length;++i)t=pq[t&255^e[i]]^t>>>8;n=t},d:function(){return~n}}},mq=function(n,e,t,i,s){return fq(n,e.level==null?6:e.level,e.mem==null?Math.ceil(Math.max(8,Math.min(13,Math.log(n.length)))*1.5):12+e.mem,t,i,!s)},CF=function(n,e){var t={};for(var i in n)t[i]=n[i];for(var i in e)t[i]=e[i];return t},is=function(n,e,t){for(;t;++e)n[e]=t,t>>>=8},Aq=function(n){if((n[0]&15)!=8||n[0]>>>4>7||(n[0]<<8|n[1])%31)throw"invalid zlib data";if(n[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function vq(n,e){return mq(n,e||{},0,0)}function Nv(n,e){return uq((Aq(n),n.subarray(2,-4)),e)}var EF=function(n,e,t,i){for(var s in n){var r=n[s],o=e+s;r instanceof _n?t[o]=[r,i]:Array.isArray(r)?t[o]=[r[0],CF(i,r[1])]:EF(r,o+"/",t,i)}},iB=typeof TextEncoder<"u"&&new TextEncoder,yq=typeof TextDecoder<"u"&&new TextDecoder,bq=0;try{yq.decode(uT,{stream:!0}),bq=1}catch{}function _0(n,e){if(e){for(var t=new _n(n.length),i=0;i<n.length;++i)t[i]=n.charCodeAt(i);return t}if(iB)return iB.encode(n);for(var s=n.length,r=new _n(n.length+(n.length>>1)),o=0,a=function(u){r[o++]=u},i=0;i<s;++i){if(o+5>r.length){var l=new _n(o+8+(s-i<<1));l.set(r),r=l}var c=n.charCodeAt(i);c<128||e?a(c):c<2048?(a(192|c>>6),a(128|c&63)):c>55295&&c<57344?(c=65536+(c&1047552)|n.charCodeAt(++i)&1023,a(240|c>>18),a(128|c>>12&63),a(128|c>>6&63),a(128|c&63)):(a(224|c>>12),a(128|c>>6&63),a(128|c&63))}return hT(r,0,o)}var QC=function(n){var e=0;if(n)for(var t in n){var i=n[t].length;if(i>65535)throw"extra field too long";e+=i+4}return e},nB=function(n,e,t,i,s,r,o,a){var l=i.length,c=t.extra,u=a&&a.length,d=QC(c);is(n,e,o!=null?33639248:67324752),e+=4,o!=null&&(n[e++]=20,n[e++]=t.os),n[e]=20,e+=2,n[e++]=t.flag<<1|(r==null&&8),n[e++]=s&&8,n[e++]=t.compression&255,n[e++]=t.compression>>8;var f=new Date(t.mtime==null?Date.now():t.mtime),p=f.getFullYear()-1980;if(p<0||p>119)throw"date not in range 1980-2099";if(is(n,e,p<<25|f.getMonth()+1<<21|f.getDate()<<16|f.getHours()<<11|f.getMinutes()<<5|f.getSeconds()>>>1),e+=4,r!=null&&(is(n,e,t.crc),is(n,e+4,r),is(n,e+8,t.size)),is(n,e+12,l),is(n,e+14,d),e+=16,o!=null&&(is(n,e,u),is(n,e+6,t.attrs),is(n,e+10,o),e+=14),n.set(i,e),e+=l,d)for(var g in c){var A=c[g],v=A.length;is(n,e,+g),is(n,e+2,v),n.set(A,e+4),e+=4+v}return u&&(n.set(a,e),e+=u),e},_q=function(n,e,t,i,s){is(n,e,101010256),is(n,e+8,t),is(n,e+10,t),is(n,e+12,i),is(n,e+16,s)};function xq(n,e){e||(e={});var t={},i=[];EF(n,"",t,e);var s=0,r=0;for(var o in t){var a=t[o],l=a[0],c=a[1],u=c.level==0?0:8,d=_0(o),f=d.length,p=c.comment,g=p&&_0(p),A=g&&g.length,v=QC(c.extra);if(f>65535)throw"filename too long";var m=u?vq(l,c):l,b=m.length,y=gq();y.p(l),i.push(CF(c,{size:l.length,crc:y.d(),c:m,f:d,m:g,u:f!=o.length||g&&p.length!=A,o:s,compression:u})),s+=30+f+v+b,r+=76+2*(f+v)+(A||0)+b}for(var _=new _n(r+22),E=s,M=r-s,I=0;I<i.length;++I){var d=i[I];nB(_,d.o,d,d.f,d.u,d.c.length);var R=30+d.f.length+QC(d.extra);_.set(d.c,d.o+R),nB(_,s,d,d.f,d.u,d.c.length,d.o,d.m),s+=16+R+(d.m?d.m.length:0)}return _q(_,s,i.length,M,E),_}class x0 extends SM{constructor(e){super(e),this.type=xn}parse(e){const C=Math.pow(2.7182818,2.2);function T(P,S){let B=0;for(let U=0;U<65536;++U)(U==0||P[U>>3]&1<<(U&7))&&(S[B++]=U);const F=B-1;for(;B<65536;)S[B++]=0;return F}function O(P){for(let S=0;S<16384;S++)P[S]={},P[S].len=0,P[S].lit=0,P[S].p=null}const J={l:0,c:0,lc:0};function V(P,S,B,F,U){for(;B<P;)S=S<<8|Oe(F,U),B+=8;B-=P,J.l=S>>B&(1<<P)-1,J.c=S,J.lc=B}const H=new Array(59);function Y(P){for(let B=0;B<=58;++B)H[B]=0;for(let B=0;B<65537;++B)H[P[B]]+=1;let S=0;for(let B=58;B>0;--B){const F=S+H[B]>>1;H[B]=S,S=F}for(let B=0;B<65537;++B){const F=P[B];F>0&&(P[B]=F|H[F]++<<6)}}function N(P,S,B,F,U,Q){const oe=S;let pe=0,ve=0;for(;F<=U;F++){if(oe.value-S.value>B)return!1;V(6,pe,ve,P,oe);const ce=J.l;if(pe=J.c,ve=J.lc,Q[F]=ce,ce==63){if(oe.value-S.value>B)throw new Error("Something wrong with hufUnpackEncTable");V(8,pe,ve,P,oe);let be=J.l+6;if(pe=J.c,ve=J.lc,F+be>U+1)throw new Error("Something wrong with hufUnpackEncTable");for(;be--;)Q[F++]=0;F--}else if(ce>=59){let be=ce-59+2;if(F+be>U+1)throw new Error("Something wrong with hufUnpackEncTable");for(;be--;)Q[F++]=0;F--}}Y(Q)}function L(P){return P&63}function G(P){return P>>6}function ee(P,S,B,F){for(;S<=B;S++){const U=G(P[S]),Q=L(P[S]);if(U>>Q)throw new Error("Invalid table entry");if(Q>14){const oe=F[U>>Q-14];if(oe.len)throw new Error("Invalid table entry");if(oe.lit++,oe.p){const pe=oe.p;oe.p=new Array(oe.lit);for(let ve=0;ve<oe.lit-1;++ve)oe.p[ve]=pe[ve]}else oe.p=new Array(1);oe.p[oe.lit-1]=S}else if(Q){let oe=0;for(let pe=1<<14-Q;pe>0;pe--){const ve=F[(U<<14-Q)+oe];if(ve.len||ve.p)throw new Error("Invalid table entry");ve.len=Q,ve.lit=S,oe++}}}return!0}const $={c:0,lc:0};function j(P,S,B,F){P=P<<8|Oe(B,F),S+=8,$.c=P,$.lc=S}const ie={c:0,lc:0};function Ae(P,S,B,F,U,Q,oe,pe,ve){if(P==S){F<8&&(j(B,F,U,Q),B=$.c,F=$.lc),F-=8;let ce=B>>F;if(ce=new Uint8Array([ce])[0],pe.value+ce>ve)return!1;const be=oe[pe.value-1];for(;ce-- >0;)oe[pe.value++]=be}else if(pe.value<ve)oe[pe.value++]=P;else return!1;ie.c=B,ie.lc=F}function ge(P){return P&65535}function Ce(P){const S=ge(P);return S>32767?S-65536:S}const Ee={a:0,b:0};function Ne(P,S){const B=Ce(P),U=Ce(S),Q=B+(U&1)+(U>>1),oe=Q,pe=Q-U;Ee.a=oe,Ee.b=pe}function Ve(P,S){const B=ge(P),F=ge(S),U=B-(F>>1)&65535,Q=F+U-32768&65535;Ee.a=Q,Ee.b=U}function lt(P,S,B,F,U,Q,oe){const pe=oe<16384,ve=B>U?U:B;let ce=1,be,Be;for(;ce<=ve;)ce<<=1;for(ce>>=1,be=ce,ce>>=1;ce>=1;){Be=0;const De=Be+Q*(U-be),Ye=Q*ce,ht=Q*be,$e=F*ce,at=F*be;let ut,dt,Ri,ri;for(;Be<=De;Be+=ht){let ei=Be;const Wt=Be+F*(B-be);for(;ei<=Wt;ei+=at){const Pi=ei+$e,gs=ei+Ye,$t=gs+$e;pe?(Ne(P[ei+S],P[gs+S]),ut=Ee.a,Ri=Ee.b,Ne(P[Pi+S],P[$t+S]),dt=Ee.a,ri=Ee.b,Ne(ut,dt),P[ei+S]=Ee.a,P[Pi+S]=Ee.b,Ne(Ri,ri),P[gs+S]=Ee.a,P[$t+S]=Ee.b):(Ve(P[ei+S],P[gs+S]),ut=Ee.a,Ri=Ee.b,Ve(P[Pi+S],P[$t+S]),dt=Ee.a,ri=Ee.b,Ve(ut,dt),P[ei+S]=Ee.a,P[Pi+S]=Ee.b,Ve(Ri,ri),P[gs+S]=Ee.a,P[$t+S]=Ee.b)}if(B&ce){const Pi=ei+Ye;pe?Ne(P[ei+S],P[Pi+S]):Ve(P[ei+S],P[Pi+S]),ut=Ee.a,P[Pi+S]=Ee.b,P[ei+S]=ut}}if(U&ce){let ei=Be;const Wt=Be+F*(B-be);for(;ei<=Wt;ei+=at){const Pi=ei+$e;pe?Ne(P[ei+S],P[Pi+S]):Ve(P[ei+S],P[Pi+S]),ut=Ee.a,P[Pi+S]=Ee.b,P[ei+S]=ut}}be=ce,ce>>=1}return Be}function xt(P,S,B,F,U,Q,oe,pe,ve){let ce=0,be=0;const Be=oe,De=Math.trunc(F.value+(U+7)/8);for(;F.value<De;)for(j(ce,be,B,F),ce=$.c,be=$.lc;be>=14;){const ht=ce>>be-14&16383,$e=S[ht];if($e.len)be-=$e.len,Ae($e.lit,Q,ce,be,B,F,pe,ve,Be),ce=ie.c,be=ie.lc;else{if(!$e.p)throw new Error("hufDecode issues");let at;for(at=0;at<$e.lit;at++){const ut=L(P[$e.p[at]]);for(;be<ut&&F.value<De;)j(ce,be,B,F),ce=$.c,be=$.lc;if(be>=ut&&G(P[$e.p[at]])==(ce>>be-ut&(1<<ut)-1)){be-=ut,Ae($e.p[at],Q,ce,be,B,F,pe,ve,Be),ce=ie.c,be=ie.lc;break}}if(at==$e.lit)throw new Error("hufDecode issues")}}const Ye=8-U&7;for(ce>>=Ye,be-=Ye;be>0;){const ht=S[ce<<14-be&16383];if(ht.len)be-=ht.len,Ae(ht.lit,Q,ce,be,B,F,pe,ve,Be),ce=ie.c,be=ie.lc;else throw new Error("hufDecode issues")}return!0}function et(P,S,B,F,U,Q){const oe={value:0},pe=B.value,ve=Ge(S,B),ce=Ge(S,B);B.value+=4;const be=Ge(S,B);if(B.value+=4,ve<0||ve>=65537||ce<0||ce>=65537)throw new Error("Something wrong with HUF_ENCSIZE");const Be=new Array(65537),De=new Array(16384);O(De);const Ye=F-(B.value-pe);if(N(P,B,Ye,ve,ce,Be),be>8*(F-(B.value-pe)))throw new Error("Something wrong with hufUncompress");ee(Be,ve,ce,De),xt(Be,De,P,B,be,ce,Q,U,oe)}function W(P,S,B){for(let F=0;F<B;++F)S[F]=P[S[F]]}function Le(P){for(let S=1;S<P.length;S++){const B=P[S-1]+P[S]-128;P[S]=B}}function me(P,S){let B=0,F=Math.floor((P.length+1)/2),U=0;const Q=P.length-1;for(;!(U>Q||(S[U++]=P[B++],U>Q));)S[U++]=P[F++]}function ke(P){let S=P.byteLength;const B=new Array;let F=0;const U=new DataView(P);for(;S>0;){const Q=U.getInt8(F++);if(Q<0){const oe=-Q;S-=oe+1;for(let pe=0;pe<oe;pe++)B.push(U.getUint8(F++))}else{const oe=Q;S-=2;const pe=U.getUint8(F++);for(let ve=0;ve<oe+1;ve++)B.push(pe)}}return B}function we(P,S,B,F,U,Q){let oe=new DataView(Q.buffer);const pe=B[P.idx[0]].width,ve=B[P.idx[0]].height,ce=3,be=Math.floor(pe/8),Be=Math.ceil(pe/8),De=Math.ceil(ve/8),Ye=pe-(Be-1)*8,ht=ve-(De-1)*8,$e={value:0},at=new Array(ce),ut=new Array(ce),dt=new Array(ce),Ri=new Array(ce),ri=new Array(ce);for(let Wt=0;Wt<ce;++Wt)ri[Wt]=S[P.idx[Wt]],at[Wt]=Wt<1?0:at[Wt-1]+Be*De,ut[Wt]=new Float32Array(64),dt[Wt]=new Uint16Array(64),Ri[Wt]=new Uint16Array(Be*64);for(let Wt=0;Wt<De;++Wt){let Pi=8;Wt==De-1&&(Pi=ht);let gs=8;for(let Vt=0;Vt<Be;++Vt){Vt==Be-1&&(gs=Ye);for(let hi=0;hi<ce;++hi)dt[hi].fill(0),dt[hi][0]=U[at[hi]++],Ze($e,F,dt[hi]),We(dt[hi],ut[hi]),qe(ut[hi]);pt(ut);for(let hi=0;hi<ce;++hi)wt(ut[hi],Ri[hi],Vt*64)}let $t=0;for(let Vt=0;Vt<ce;++Vt){const hi=B[P.idx[Vt]].type;for(let Hi=8*Wt;Hi<8*Wt+Pi;++Hi){$t=ri[Vt][Hi];for(let Ka=0;Ka<be;++Ka){const Yr=Ka*64+(Hi&7)*8;oe.setUint16($t+0*2*hi,Ri[Vt][Yr+0],!0),oe.setUint16($t+1*2*hi,Ri[Vt][Yr+1],!0),oe.setUint16($t+2*2*hi,Ri[Vt][Yr+2],!0),oe.setUint16($t+3*2*hi,Ri[Vt][Yr+3],!0),oe.setUint16($t+4*2*hi,Ri[Vt][Yr+4],!0),oe.setUint16($t+5*2*hi,Ri[Vt][Yr+5],!0),oe.setUint16($t+6*2*hi,Ri[Vt][Yr+6],!0),oe.setUint16($t+7*2*hi,Ri[Vt][Yr+7],!0),$t+=8*2*hi}}if(be!=Be)for(let Hi=8*Wt;Hi<8*Wt+Pi;++Hi){const Ka=ri[Vt][Hi]+8*be*2*hi,Yr=be*64+(Hi&7)*8;for(let _h=0;_h<gs;++_h)oe.setUint16(Ka+_h*2*hi,Ri[Vt][Yr+_h],!0)}}}const ei=new Uint16Array(pe);oe=new DataView(Q.buffer);for(let Wt=0;Wt<ce;++Wt){B[P.idx[Wt]].decoded=!0;const Pi=B[P.idx[Wt]].type;if(B[Wt].type==2)for(let gs=0;gs<ve;++gs){const $t=ri[Wt][gs];for(let Vt=0;Vt<pe;++Vt)ei[Vt]=oe.getUint16($t+Vt*2*Pi,!0);for(let Vt=0;Vt<pe;++Vt)oe.setFloat32($t+Vt*2*Pi,ue(ei[Vt]),!0)}}}function Ze(P,S,B){let F,U=1;for(;U<64;)F=S[P.value],F==65280?U=64:F>>8==255?U+=F&255:(B[U]=F,U++),P.value++}function We(P,S){S[0]=ue(P[0]),S[1]=ue(P[1]),S[2]=ue(P[5]),S[3]=ue(P[6]),S[4]=ue(P[14]),S[5]=ue(P[15]),S[6]=ue(P[27]),S[7]=ue(P[28]),S[8]=ue(P[2]),S[9]=ue(P[4]),S[10]=ue(P[7]),S[11]=ue(P[13]),S[12]=ue(P[16]),S[13]=ue(P[26]),S[14]=ue(P[29]),S[15]=ue(P[42]),S[16]=ue(P[3]),S[17]=ue(P[8]),S[18]=ue(P[12]),S[19]=ue(P[17]),S[20]=ue(P[25]),S[21]=ue(P[30]),S[22]=ue(P[41]),S[23]=ue(P[43]),S[24]=ue(P[9]),S[25]=ue(P[11]),S[26]=ue(P[18]),S[27]=ue(P[24]),S[28]=ue(P[31]),S[29]=ue(P[40]),S[30]=ue(P[44]),S[31]=ue(P[53]),S[32]=ue(P[10]),S[33]=ue(P[19]),S[34]=ue(P[23]),S[35]=ue(P[32]),S[36]=ue(P[39]),S[37]=ue(P[45]),S[38]=ue(P[52]),S[39]=ue(P[54]),S[40]=ue(P[20]),S[41]=ue(P[22]),S[42]=ue(P[33]),S[43]=ue(P[38]),S[44]=ue(P[46]),S[45]=ue(P[51]),S[46]=ue(P[55]),S[47]=ue(P[60]),S[48]=ue(P[21]),S[49]=ue(P[34]),S[50]=ue(P[37]),S[51]=ue(P[47]),S[52]=ue(P[50]),S[53]=ue(P[56]),S[54]=ue(P[59]),S[55]=ue(P[61]),S[56]=ue(P[35]),S[57]=ue(P[36]),S[58]=ue(P[48]),S[59]=ue(P[49]),S[60]=ue(P[57]),S[61]=ue(P[58]),S[62]=ue(P[62]),S[63]=ue(P[63])}function qe(P){const S=.5*Math.cos(.7853975),B=.5*Math.cos(3.14159/16),F=.5*Math.cos(3.14159/8),U=.5*Math.cos(3*3.14159/16),Q=.5*Math.cos(5*3.14159/16),oe=.5*Math.cos(3*3.14159/8),pe=.5*Math.cos(7*3.14159/16),ve=new Array(4),ce=new Array(4),be=new Array(4),Be=new Array(4);for(let De=0;De<8;++De){const Ye=De*8;ve[0]=F*P[Ye+2],ve[1]=oe*P[Ye+2],ve[2]=F*P[Ye+6],ve[3]=oe*P[Ye+6],ce[0]=B*P[Ye+1]+U*P[Ye+3]+Q*P[Ye+5]+pe*P[Ye+7],ce[1]=U*P[Ye+1]-pe*P[Ye+3]-B*P[Ye+5]-Q*P[Ye+7],ce[2]=Q*P[Ye+1]-B*P[Ye+3]+pe*P[Ye+5]+U*P[Ye+7],ce[3]=pe*P[Ye+1]-Q*P[Ye+3]+U*P[Ye+5]-B*P[Ye+7],be[0]=S*(P[Ye+0]+P[Ye+4]),be[3]=S*(P[Ye+0]-P[Ye+4]),be[1]=ve[0]+ve[3],be[2]=ve[1]-ve[2],Be[0]=be[0]+be[1],Be[1]=be[3]+be[2],Be[2]=be[3]-be[2],Be[3]=be[0]-be[1],P[Ye+0]=Be[0]+ce[0],P[Ye+1]=Be[1]+ce[1],P[Ye+2]=Be[2]+ce[2],P[Ye+3]=Be[3]+ce[3],P[Ye+4]=Be[3]-ce[3],P[Ye+5]=Be[2]-ce[2],P[Ye+6]=Be[1]-ce[1],P[Ye+7]=Be[0]-ce[0]}for(let De=0;De<8;++De)ve[0]=F*P[16+De],ve[1]=oe*P[16+De],ve[2]=F*P[48+De],ve[3]=oe*P[48+De],ce[0]=B*P[8+De]+U*P[24+De]+Q*P[40+De]+pe*P[56+De],ce[1]=U*P[8+De]-pe*P[24+De]-B*P[40+De]-Q*P[56+De],ce[2]=Q*P[8+De]-B*P[24+De]+pe*P[40+De]+U*P[56+De],ce[3]=pe*P[8+De]-Q*P[24+De]+U*P[40+De]-B*P[56+De],be[0]=S*(P[De]+P[32+De]),be[3]=S*(P[De]-P[32+De]),be[1]=ve[0]+ve[3],be[2]=ve[1]-ve[2],Be[0]=be[0]+be[1],Be[1]=be[3]+be[2],Be[2]=be[3]-be[2],Be[3]=be[0]-be[1],P[0+De]=Be[0]+ce[0],P[8+De]=Be[1]+ce[1],P[16+De]=Be[2]+ce[2],P[24+De]=Be[3]+ce[3],P[32+De]=Be[3]-ce[3],P[40+De]=Be[2]-ce[2],P[48+De]=Be[1]-ce[1],P[56+De]=Be[0]-ce[0]}function pt(P){for(let S=0;S<64;++S){const B=P[0][S],F=P[1][S],U=P[2][S];P[0][S]=B+1.5747*U,P[1][S]=B-.1873*F-.4682*U,P[2][S]=B+1.8556*F}}function wt(P,S,B){for(let F=0;F<64;++F)S[B+F]=ru.toHalfFloat(Qt(P[F]))}function Qt(P){return P<=1?Math.sign(P)*Math.pow(Math.abs(P),2.2):Math.sign(P)*Math.pow(C,Math.abs(P)-1)}function z(P){return new DataView(P.array.buffer,P.offset.value,P.size)}function k(P){const S=P.viewer.buffer.slice(P.offset.value,P.offset.value+P.size),B=new Uint8Array(ke(S)),F=new Uint8Array(B.length);return Le(B),me(B,F),new DataView(F.buffer)}function he(P){const S=P.array.slice(P.offset.value,P.offset.value+P.size),B=Nv(S),F=new Uint8Array(B.length);return Le(B),me(B,F),new DataView(F.buffer)}function Re(P){const S=P.viewer,B={value:P.offset.value},F=new Uint16Array(P.width*P.scanlineBlockSize*(P.channels*P.type)),U=new Uint8Array(8192);let Q=0;const oe=new Array(P.channels);for(let ht=0;ht<P.channels;ht++)oe[ht]={},oe[ht].start=Q,oe[ht].end=oe[ht].start,oe[ht].nx=P.width,oe[ht].ny=P.lines,oe[ht].size=P.type,Q+=oe[ht].nx*oe[ht].ny*oe[ht].size;const pe=fe(S,B),ve=fe(S,B);if(ve>=8192)throw new Error("Something is wrong with PIZ_COMPRESSION BITMAP_SIZE");if(pe<=ve)for(let ht=0;ht<ve-pe+1;ht++)U[ht+pe]=it(S,B);const ce=new Uint16Array(65536),be=T(U,ce),Be=Ge(S,B);et(P.array,S,B,Be,F,Q);for(let ht=0;ht<P.channels;++ht){const $e=oe[ht];for(let at=0;at<oe[ht].size;++at)lt(F,$e.start+at,$e.nx,$e.size,$e.ny,$e.nx*$e.size,be)}W(ce,F,Q);let De=0;const Ye=new Uint8Array(F.buffer.byteLength);for(let ht=0;ht<P.lines;ht++)for(let $e=0;$e<P.channels;$e++){const at=oe[$e],ut=at.nx*at.size,dt=new Uint8Array(F.buffer,at.end*2,ut*2);Ye.set(dt,De),De+=ut*2,at.end+=ut}return new DataView(Ye.buffer)}function Pe(P){const S=P.array.slice(P.offset.value,P.offset.value+P.size),B=Nv(S),F=P.lines*P.channels*P.width,U=P.type==1?new Uint16Array(F):new Uint32Array(F);let Q=0,oe=0;const pe=new Array(4);for(let ve=0;ve<P.lines;ve++)for(let ce=0;ce<P.channels;ce++){let be=0;switch(P.type){case 1:pe[0]=Q,pe[1]=pe[0]+P.width,Q=pe[1]+P.width;for(let Be=0;Be<P.width;++Be){const De=B[pe[0]++]<<8|B[pe[1]++];be+=De,U[oe]=be,oe++}break;case 2:pe[0]=Q,pe[1]=pe[0]+P.width,pe[2]=pe[1]+P.width,Q=pe[2]+P.width;for(let Be=0;Be<P.width;++Be){const De=B[pe[0]++]<<24|B[pe[1]++]<<16|B[pe[2]++]<<8;be+=De,U[oe]=be,oe++}break}}return new DataView(U.buffer)}function Fe(P){const S=P.viewer,B={value:P.offset.value},F=new Uint8Array(P.width*P.lines*(P.channels*P.type*2)),U={version:gt(S,B),unknownUncompressedSize:gt(S,B),unknownCompressedSize:gt(S,B),acCompressedSize:gt(S,B),dcCompressedSize:gt(S,B),rleCompressedSize:gt(S,B),rleUncompressedSize:gt(S,B),rleRawSize:gt(S,B),totalAcUncompressedCount:gt(S,B),totalDcUncompressedCount:gt(S,B),acCompression:gt(S,B)};if(U.version<2)throw new Error("EXRLoader.parse: "+ra.compression+" version "+U.version+" is unsupported");const Q=new Array;let oe=fe(S,B)-2;for(;oe>0;){const $e=X(S.buffer,B),at=it(S,B),ut=at>>2&3,dt=(at>>4)-1,Ri=new Int8Array([dt])[0],ri=it(S,B);Q.push({name:$e,index:Ri,type:ri,compression:ut}),oe-=$e.length+3}const pe=ra.channels,ve=new Array(P.channels);for(let $e=0;$e<P.channels;++$e){const at=ve[$e]={},ut=pe[$e];at.name=ut.name,at.compression=0,at.decoded=!1,at.type=ut.pixelType,at.pLinear=ut.pLinear,at.width=P.width,at.height=P.lines}const ce={idx:new Array(3)};for(let $e=0;$e<P.channels;++$e){const at=ve[$e];for(let ut=0;ut<Q.length;++ut){const dt=Q[ut];at.name==dt.name&&(at.compression=dt.compression,dt.index>=0&&(ce.idx[dt.index]=$e),at.offset=$e)}}let be,Be,De;if(U.acCompressedSize>0)switch(U.acCompression){case 0:be=new Uint16Array(U.totalAcUncompressedCount),et(P.array,S,B,U.acCompressedSize,be,U.totalAcUncompressedCount);break;case 1:const $e=P.array.slice(B.value,B.value+U.totalAcUncompressedCount),at=Nv($e);be=new Uint16Array(at.buffer),B.value+=U.totalAcUncompressedCount;break}if(U.dcCompressedSize>0){const $e={array:P.array,offset:B,size:U.dcCompressedSize};Be=new Uint16Array(he($e).buffer),B.value+=U.dcCompressedSize}if(U.rleRawSize>0){const $e=P.array.slice(B.value,B.value+U.rleCompressedSize),at=Nv($e);De=ke(at.buffer),B.value+=U.rleCompressedSize}let Ye=0;const ht=new Array(ve.length);for(let $e=0;$e<ht.length;++$e)ht[$e]=new Array;for(let $e=0;$e<P.lines;++$e)for(let at=0;at<ve.length;++at)ht[at].push(Ye),Ye+=ve[at].width*P.type*2;we(ce,ht,ve,be,Be,F);for(let $e=0;$e<ve.length;++$e){const at=ve[$e];if(!at.decoded)switch(at.compression){case 2:let ut=0,dt=0;for(let Ri=0;Ri<P.lines;++Ri){let ri=ht[$e][ut];for(let ei=0;ei<at.width;++ei){for(let Wt=0;Wt<2*at.type;++Wt)F[ri++]=De[dt+Wt*at.width*at.height];dt++}ut++}break;case 1:default:throw new Error("EXRLoader.parse: unsupported channel compression")}}return new DataView(F.buffer)}function X(P,S){const B=new Uint8Array(P);let F=0;for(;B[S.value+F]!=0;)F+=1;const U=new TextDecoder().decode(B.slice(S.value,S.value+F));return S.value=S.value+F+1,U}function de(P,S,B){const F=new TextDecoder().decode(new Uint8Array(P).slice(S.value,S.value+B));return S.value=S.value+B,F}function le(P,S){const B=je(P,S),F=Ge(P,S);return[B,F]}function Qe(P,S){const B=Ge(P,S),F=Ge(P,S);return[B,F]}function je(P,S){const B=P.getInt32(S.value,!0);return S.value=S.value+4,B}function Ge(P,S){const B=P.getUint32(S.value,!0);return S.value=S.value+4,B}function Oe(P,S){const B=P[S.value];return S.value=S.value+1,B}function it(P,S){const B=P.getUint8(S.value);return S.value=S.value+1,B}const gt=function(P,S){let B;return"getBigInt64"in DataView.prototype?B=Number(P.getBigInt64(S.value,!0)):B=P.getUint32(S.value+4,!0)+Number(P.getUint32(S.value,!0)<<32),S.value+=8,B};function yt(P,S){const B=P.getFloat32(S.value,!0);return S.value+=4,B}function Z(P,S){return ru.toHalfFloat(yt(P,S))}function ue(P){const S=(P&31744)>>10,B=P&1023;return(P>>15?-1:1)*(S?S===31?B?NaN:1/0:Math.pow(2,S-15)*(1+B/1024):6103515625e-14*(B/1024))}function fe(P,S){const B=P.getUint16(S.value,!0);return S.value+=2,B}function He(P,S){return ue(fe(P,S))}function Xe(P,S,B,F){const U=B.value,Q=[];for(;B.value<U+F-1;){const oe=X(S,B),pe=je(P,B),ve=it(P,B);B.value+=3;const ce=je(P,B),be=je(P,B);Q.push({name:oe,pixelType:pe,pLinear:ve,xSampling:ce,ySampling:be})}return B.value+=1,Q}function Zt(P,S){const B=yt(P,S),F=yt(P,S),U=yt(P,S),Q=yt(P,S),oe=yt(P,S),pe=yt(P,S),ve=yt(P,S),ce=yt(P,S);return{redX:B,redY:F,greenX:U,greenY:Q,blueX:oe,blueY:pe,whiteX:ve,whiteY:ce}}function Ii(P,S){const B=["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"],F=it(P,S);return B[F]}function mn(P,S){const B=Ge(P,S),F=Ge(P,S),U=Ge(P,S),Q=Ge(P,S);return{xMin:B,yMin:F,xMax:U,yMax:Q}}function qr(P,S){const B=["INCREASING_Y"],F=it(P,S);return B[F]}function ki(P,S){const B=yt(P,S),F=yt(P,S);return[B,F]}function Xr(P,S){const B=yt(P,S),F=yt(P,S),U=yt(P,S);return[B,F,U]}function Jn(P,S,B,F,U){if(F==="string"||F==="stringvector"||F==="iccProfile")return de(S,B,U);if(F==="chlist")return Xe(P,S,B,U);if(F==="chromaticities")return Zt(P,B);if(F==="compression")return Ii(P,B);if(F==="box2i")return mn(P,B);if(F==="lineOrder")return qr(P,B);if(F==="float")return yt(P,B);if(F==="v2f")return ki(P,B);if(F==="v3f")return Xr(P,B);if(F==="int")return je(P,B);if(F==="rational")return le(P,B);if(F==="timecode")return Qe(P,B);if(F==="preview")return B.value+=U,"skipped";B.value+=U}function zA(P,S,B){const F={};if(P.getUint32(0,!0)!=20000630)throw new Error("THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.");F.version=P.getUint8(4);const U=P.getUint8(5);F.spec={singleTile:!!(U&2),longName:!!(U&4),deepFormat:!!(U&8),multiPart:!!(U&16)},B.value=8;let Q=!0;for(;Q;){const oe=X(S,B);if(oe==0)Q=!1;else{const pe=X(S,B),ve=Ge(P,B),ce=Jn(P,S,B,pe,ve);ce===void 0?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${pe}'.`):F[oe]=ce}}if(U&-5)throw console.error("EXRHeader:",F),new Error("THREE.EXRLoader: provided file is currently unsupported.");return F}function GA(P,S,B,F,U){const Q={size:0,viewer:S,array:B,offset:F,width:P.dataWindow.xMax-P.dataWindow.xMin+1,height:P.dataWindow.yMax-P.dataWindow.yMin+1,channels:P.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:P.channels[0].pixelType,uncompress:null,getter:null,format:null,colorSpace:gn};switch(P.compression){case"NO_COMPRESSION":Q.lines=1,Q.uncompress=z;break;case"RLE_COMPRESSION":Q.lines=1,Q.uncompress=k;break;case"ZIPS_COMPRESSION":Q.lines=1,Q.uncompress=he;break;case"ZIP_COMPRESSION":Q.lines=16,Q.uncompress=he;break;case"PIZ_COMPRESSION":Q.lines=32,Q.uncompress=Re;break;case"PXR24_COMPRESSION":Q.lines=16,Q.uncompress=Pe;break;case"DWAA_COMPRESSION":Q.lines=32,Q.uncompress=Fe;break;case"DWAB_COMPRESSION":Q.lines=256,Q.uncompress=Fe;break;default:throw new Error("EXRLoader.parse: "+P.compression+" is unsupported")}if(Q.scanlineBlockSize=Q.lines,Q.type==1)switch(U){case sn:Q.getter=He,Q.inputSize=2;break;case xn:Q.getter=fe,Q.inputSize=2;break}else if(Q.type==2)switch(U){case sn:Q.getter=yt,Q.inputSize=4;break;case xn:Q.getter=Z,Q.inputSize=4}else throw new Error("EXRLoader.parse: unsupported pixelType "+Q.type+" for "+P.compression+".");Q.blockCount=(P.dataWindow.yMax+1)/Q.scanlineBlockSize;for(let pe=0;pe<Q.blockCount;pe++)gt(S,F);Q.outputChannels=Q.channels==3?4:Q.channels;const oe=Q.width*Q.height*Q.outputChannels;switch(U){case sn:Q.byteArray=new Float32Array(oe),Q.channels<Q.outputChannels&&Q.byteArray.fill(1,0,oe);break;case xn:Q.byteArray=new Uint16Array(oe),Q.channels<Q.outputChannels&&Q.byteArray.fill(15360,0,oe);break;default:console.error("THREE.EXRLoader: unsupported type: ",U);break}return Q.bytesPerLine=Q.width*Q.inputSize*Q.channels,Q.outputChannels==4?(Q.format=Ti,Q.colorSpace=gn):(Q.format=wl,Q.colorSpace=ur),Q}const ed=new DataView(e),td=new Uint8Array(e),nc={value:0},ra=zA(ed,e,nc),Gt=GA(ra,ed,td,nc,this.type),VA={value:0},yx={R:0,G:1,B:2,A:3,Y:0};for(let P=0;P<Gt.height/Gt.scanlineBlockSize;P++){const S=Ge(ed,nc);Gt.size=Ge(ed,nc),Gt.lines=S+Gt.scanlineBlockSize>Gt.height?Gt.height-S:Gt.scanlineBlockSize;const F=Gt.size<Gt.lines*Gt.bytesPerLine?Gt.uncompress(Gt):z(Gt);nc.value+=Gt.size;for(let U=0;U<Gt.scanlineBlockSize;U++){const Q=U+P*Gt.scanlineBlockSize;if(Q>=Gt.height)break;for(let oe=0;oe<Gt.channels;oe++){const pe=yx[ra.channels[oe].name];for(let ve=0;ve<Gt.width;ve++){VA.value=(U*(Gt.channels*Gt.width)+oe*Gt.width+ve)*Gt.inputSize;const ce=(Gt.height-1-Q)*(Gt.width*Gt.outputChannels)+ve*Gt.outputChannels+pe;Gt.byteArray[ce]=Gt.getter(F,VA)}}}}return{header:ra,width:Gt.width,height:Gt.height,data:Gt.byteArray,format:Gt.format,colorSpace:Gt.colorSpace,type:this.type}}setDataType(e){return this.type=e,this}load(e,t,i,s){function r(o,a){o.colorSpace=a.colorSpace,o.minFilter=Dt,o.magFilter=Dt,o.generateMipmaps=!1,o.flipY=!1,t&&t(o,a)}return super.load(e,r,i,s)}}class WC extends SM{constructor(e){super(e),this.type=xn}parse(e){const a=function(y,_){switch(y){case 1:console.error("THREE.RGBELoader Read Error: "+(_||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(_||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(_||""));break;default:case 4:console.error("THREE.RGBELoader: Error: "+(_||""))}return-1},d=`
`,f=function(y,_,E){_=_||1024;let I=y.pos,R=-1,C=0,T="",O=String.fromCharCode.apply(null,new Uint16Array(y.subarray(I,I+128)));for(;0>(R=O.indexOf(d))&&C<_&&I<y.byteLength;)T+=O,C+=O.length,I+=128,O+=String.fromCharCode.apply(null,new Uint16Array(y.subarray(I,I+128)));return-1<R?(E!==!1&&(y.pos+=C+R+1),T+O.slice(0,R)):!1},p=function(y){const _=/^#\?(\S+)/,E=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,M=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,I=/^\s*FORMAT=(\S+)\s*$/,R=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,C={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let T,O;if(y.pos>=y.byteLength||!(T=f(y)))return a(1,"no header found");if(!(O=T.match(_)))return a(3,"bad initial token");for(C.valid|=1,C.programtype=O[1],C.string+=T+`
`;T=f(y),T!==!1;){if(C.string+=T+`
`,T.charAt(0)==="#"){C.comments+=T+`
`;continue}if((O=T.match(E))&&(C.gamma=parseFloat(O[1])),(O=T.match(M))&&(C.exposure=parseFloat(O[1])),(O=T.match(I))&&(C.valid|=2,C.format=O[1]),(O=T.match(R))&&(C.valid|=4,C.height=parseInt(O[1],10),C.width=parseInt(O[2],10)),C.valid&2&&C.valid&4)break}return C.valid&2?C.valid&4?C:a(3,"missing image size specifier"):a(3,"missing format specifier")},g=function(y,_,E){const M=_;if(M<8||M>32767||y[0]!==2||y[1]!==2||y[2]&128)return new Uint8Array(y);if(M!==(y[2]<<8|y[3]))return a(3,"wrong scanline width");const I=new Uint8Array(4*_*E);if(!I.length)return a(4,"unable to allocate buffer space");let R=0,C=0;const T=4*M,O=new Uint8Array(4),J=new Uint8Array(T);let V=E;for(;V>0&&C<y.byteLength;){if(C+4>y.byteLength)return a(1);if(O[0]=y[C++],O[1]=y[C++],O[2]=y[C++],O[3]=y[C++],O[0]!=2||O[1]!=2||(O[2]<<8|O[3])!=M)return a(3,"bad rgbe scanline format");let H=0,Y;for(;H<T&&C<y.byteLength;){Y=y[C++];const L=Y>128;if(L&&(Y-=128),Y===0||H+Y>T)return a(3,"bad scanline data");if(L){const G=y[C++];for(let ee=0;ee<Y;ee++)J[H++]=G}else J.set(y.subarray(C,C+Y),H),H+=Y,C+=Y}const N=M;for(let L=0;L<N;L++){let G=0;I[R]=J[L+G],G+=M,I[R+1]=J[L+G],G+=M,I[R+2]=J[L+G],G+=M,I[R+3]=J[L+G],R+=4}V--}return I},A=function(y,_,E,M){const I=y[_+3],R=Math.pow(2,I-128)/255;E[M+0]=y[_+0]*R,E[M+1]=y[_+1]*R,E[M+2]=y[_+2]*R,E[M+3]=1},v=function(y,_,E,M){const I=y[_+3],R=Math.pow(2,I-128)/255;E[M+0]=ru.toHalfFloat(Math.min(y[_+0]*R,65504)),E[M+1]=ru.toHalfFloat(Math.min(y[_+1]*R,65504)),E[M+2]=ru.toHalfFloat(Math.min(y[_+2]*R,65504)),E[M+3]=ru.toHalfFloat(1)},m=new Uint8Array(e);m.pos=0;const b=p(m);if(b!==-1){const y=b.width,_=b.height,E=g(m.subarray(m.pos),y,_);if(E!==-1){let M,I,R;switch(this.type){case sn:R=E.length/4;const C=new Float32Array(R*4);for(let O=0;O<R;O++)A(E,O*4,C,O*4);M=C,I=sn;break;case xn:R=E.length/4;const T=new Uint16Array(R*4);for(let O=0;O<R;O++)v(E,O*4,T,O*4);M=T,I=xn;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type);break}return{width:y,height:_,data:M,header:b.string,gamma:b.gamma,exposure:b.exposure,type:I}}}return null}setDataType(e){return this.type=e,this}load(e,t,i,s){function r(o,a){switch(o.type){case sn:case xn:o.colorSpace=gn,o.minFilter=Dt,o.magFilter=Dt,o.generateMipmaps=!1,o.flipY=!0;break}t&&t(o,a)}return super.load(e,r,i,s)}}const sB="NEEDLE_lightmaps",Hp=re("debuglightmapsextension")||re("debuglightmaps");var Oa;(function(n){n[n.Lightmap=0]="Lightmap",n[n.Skybox=1]="Skybox",n[n.Reflection=2]="Reflection"})(Oa||(Oa={}));class wq{constructor(e,t,i){h(this,"parser");h(this,"registry");h(this,"source");this.parser=e,this.registry=t,this.source=i}get name(){return sB}afterRoot(e){const t=this.parser.json.extensions;if(t){const i=t[sB];if(i){const s=i.textures;return s!=null&&s.length?(Hp&&console.log(i),new Promise(async(r,o)=>{const a=[];for(const c of s)if(c.pointer){Hp&&console.log(c);let u=null;if(c.pointer.startsWith("/textures/"))Hp&&console.log("Load texture from gltf",c.pointer),u=eT(this.parser,c.pointer).then(d=>this.resolveTexture(c,d));else if(typeof c.pointer=="string"){Hp&&console.log("Load texture from path",c.pointer);const d=Nu(this.source,c.pointer);let f;d.endsWith(".exr")?f=new x0(this.parser.options.manager):d.endsWith(".hdr")?f=new WC(this.parser.options.manager):f=new kl(this.parser.options.manager),u=f.loadAsync(d,void 0).then(p=>this.resolveTexture(c,p))}else c.pointer;u&&a.push(u)}const l=await UM(a);l!=null&&l.anyFailed&&si()&&console.error("Failed to load lightmap extension",l),r()})):null}}return null}resolveTexture(e,t){const i=t;Hp&&console.log("Lightmap loaded:",i),i!=null&&i.isTexture&&(this.registry?(e.type!==Oa.Lightmap?i.colorSpace=Je:i.colorSpace=gn,this.registry.registerTexture(this.source,e.type,i,e.index)):console.log(Oa[e.type],e.pointer,i))}}const rB=!!re("debuglightmaps");class Sq{constructor(e){h(this,"_context");h(this,"_lightmaps",new Map);this._context=e}clear(){this._lightmaps.clear()}registerTexture(e,t,i,s){rB&&console.log("Registering ",Oa[t]+' "'+e+'"',i),this._lightmaps.has(e)||this._lightmaps.set(e,new Map);const r=this._lightmaps.get(e),o=(r==null?void 0:r.get(t))??[];o.length<s&&(o.length=s+1),o[s]=i,r==null||r.set(t,o)}tryGetLightmap(e,t=0){return this.tryGet(e,Oa.Lightmap,t)}tryGetSkybox(e){return this.tryGet(e,Oa.Skybox,0)}tryGetReflection(e){return this.tryGet(e,Oa.Reflection,0)}tryGet(e,t,i){var r;if(!e)return rB&&console.warn("Missing source id"),null;const s=((r=this._lightmaps.get(e))==null?void 0:r.get(t))??null;return!(s!=null&&s.length)||s.length<=i?null:s[i]}}Tt.lights_fragment_maps=Tt.lights_fragment_maps.replace("vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );",`
    vec2 lUv = vLightMapUv.xy * lightmapScaleOffset.xy + vec2(lightmapScaleOffset.z, (1. - (lightmapScaleOffset.y + lightmapScaleOffset.w)));
    vec4 lightMapTexel = texture2D( lightMap, lUv);
    // The range of RGBM lightmaps goes from 0 to 34.49 (5^2.2) in linear space, and from 0 to 5 in gamma space.
    lightMapTexel.rgb *= lightMapTexel.a * 8.; // no idea where that "8" comes from... heuristically derived
    lightMapTexel.a = 1.;
    lightMapTexel = conv_sRGBToLinear(lightMapTexel);
    `);Tt.lightmap_pars_fragment=`
    #ifdef USE_LIGHTMAP
        uniform sampler2D lightMap;
        uniform float lightMapIntensity;
        uniform vec4 lightmapScaleOffset;
        
        // took from threejs 05fc79cd52b79e8c3e8dec1e7dca72c5c39983a4
        vec4 conv_sRGBToLinear( in vec4 value ) {
            return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
        }
    #endif
    `;Tt.lights_fragment_begin=Tt.lights_fragment_begin.replace("irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );",`
#if defined(USE_LIGHTMAP)
irradiance += 0.;
#else
irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
#endif`);Ue.lightmap.lightmapScaleOffset={value:new Ke(1,1,0,0)};const Cq=re("debugplayerview");var jo;(function(n){n.Browser="browser",n.Headset="headset",n.Handheld="handheld"})(jo||(jo={}));class Eq{constructor(e,t){h(this,"userId");h(this,"context");h(this,"viewDevice",jo.Browser);h(this,"removed",!1);h(this,"_object");this.userId=e,this.context=t}get currentObject(){return this._object}set currentObject(e){this._object=e}get isConnected(){return this.context.connection.userIsInRoom(this.userId)}}class Mq{constructor(e){h(this,"context");h(this,"playerViews",new Map);this.context=e}setPlayerView(e,t,i){let s=this.playerViews.get(e);s||(s=new Eq(e,this.context),this.playerViews.set(e,s)),s.viewDevice=i,s.currentObject=t,s.removed=!1}getPlayerView(e){if(!e)return;if(!this.context.connection.userIsInRoom(e)){this.playerViews.delete(e);return}return this.playerViews.get(e)}removePlayerView(e,t){const i=this.playerViews.get(e);(i==null?void 0:i.viewDevice)===t&&(Cq&&console.log("REMOVE",e),i.removed=!0,this.playerViews.delete(e))}}function*Tq(n,e=null){const t=e?e.time:Lt.Current.time,i=t.time;for(;t.time-i<n;)yield}function*Iq(n){let e=!0;for(n.then(()=>e=!1),n.catch(()=>e=!1);e;)yield}const bc=re("debugcontext"),Rq=re("stats"),Pq=re("debugactive"),Bq=re("debugframerate"),Dq=re("debugcoroutine");var li;(function(n){n[n.EarlyUpdate=0]="EarlyUpdate",n[n.Update=1]="Update",n[n.LateUpdate=2]="LateUpdate",n[n.OnBeforeRender=3]="OnBeforeRender",n[n.OnAfterRender=4]="OnAfterRender",n[n.PrePhysicsStep=9]="PrePhysicsStep",n[n.PostPhysicsStep=10]="PostPhysicsStep",n[n.Undefined=-1]="Undefined"})(li||(li={}));var Ru;(function(n){n.ImmersiveVR="immersive-vr",n.ImmersiveAR="immersive-ar"})(Ru||(Ru={}));function dT(n,e){if(!n)return;if(!n.isComponent){(si()||bc)&&console.error(`Registered script is not a Needle Engine component. 
The script will be ignored. Please make sure your component extends "Behaviour" imported from "@needle-tools/engine"
`,n);return}const t=(e==null?void 0:e.new_scripts)??Lt.Current.new_scripts;t.includes(n)||t.push(n)}const Qi=class{constructor(e){h(this,"name");h(this,"alias");h(this,"isManagedExternally",!1);h(this,"isPaused",!1);h(this,"runInBackground",!1);h(this,"targetFrameRate");h(this,"hash");h(this,"domElement");h(this,"_resolutionScaleFactor",1);h(this,"_boundingClientRectFrame",-1);h(this,"_boundingClientRect",null);h(this,"_domX");h(this,"_domY");h(this,"xrSessionMode");h(this,"_xrFrame",null);h(this,"_currentFrameEvent",li.Undefined);h(this,"scene");h(this,"renderer");h(this,"composer",null);h(this,"scripts",[]);h(this,"scripts_pausedChanged",[]);h(this,"scripts_earlyUpdate",[]);h(this,"scripts_update",[]);h(this,"scripts_lateUpdate",[]);h(this,"scripts_onBeforeRender",[]);h(this,"scripts_onAfterRender",[]);h(this,"scripts_WithCorroutines",[]);h(this,"coroutines",{});h(this,"mainCameraComponent");h(this,"_camera",null);h(this,"post_setup_callbacks",[]);h(this,"pre_update_callbacks",[]);h(this,"pre_render_callbacks",[]);h(this,"post_render_callbacks",[]);h(this,"new_scripts",[]);h(this,"new_script_start",[]);h(this,"new_scripts_pre_setup_callbacks",[]);h(this,"new_scripts_post_setup_callbacks",[]);h(this,"application");h(this,"time");h(this,"input");h(this,"physics");h(this,"connection");h(this,"assets");h(this,"mainLight",null);h(this,"sceneLighting");h(this,"addressables");h(this,"lightmaps");h(this,"players");h(this,"_sizeChanged",!1);h(this,"_isCreated",!1);h(this,"_isCreating",!1);h(this,"_isVisible",!1);h(this,"_stats",Rq?new kg:null);h(this,"_intersectionObserver",null);h(this,"_disposeCallbacks",[]);h(this,"onUnhandledRejection",e=>{this.domElement.dispatchEvent(new CustomEvent("error",{detail:e.reason}))});h(this,"_cameraStack",[]);h(this,"_onBeforeRenderListeners",new Map);h(this,"_onAfterRenderListeners",new Map);h(this,"_requireDepthTexture",!1);h(this,"_requireColorTexture",!1);h(this,"_renderTarget");h(this,"_isRendering",!1);h(this,"_createId",0);h(this,"_lastTimestamp",0);h(this,"_accumulatedTime",0);h(this,"_dispatchReadyAfterFrame",!1);h(this,"_wasPaused",!1);this.name=(e==null?void 0:e.name)||"",this.alias=e==null?void 0:e.alias,this.domElement=(e==null?void 0:e.domElement)||document.body,this.hash=e==null?void 0:e.hash,e!=null&&e.renderer&&(this.renderer=e.renderer,this.isManagedExternally=!0),(e==null?void 0:e.runInBackground)!==void 0&&(this.runInBackground=e.runInBackground),e!=null&&e.scene?this.scene=e.scene:this.scene=new mr,e!=null&&e.camera&&(this._camera=e.camera),this.application=new rq(this),this.time=new Q8,this.input=new T8(this),this.physics=new H8(this),this.connection=new kW(this),this.assets=new Mj,this.sceneLighting=new nq(this),this.addressables=new $6(this),this.lightmaps=new Sq(this),this.players=new Mq(this);const t=()=>this._sizeChanged=!0;window.addEventListener("resize",t),this._disposeCallbacks.push(()=>window.removeEventListener("resize",t));const i=new ResizeObserver(s=>this._sizeChanged=!0);i.observe(this.domElement),this._disposeCallbacks.push(()=>i.disconnect()),this._intersectionObserver=new IntersectionObserver(s=>{this._isVisible=s[0].isIntersecting}),this._disposeCallbacks.push(()=>{var s;return(s=this._intersectionObserver)==null?void 0:s.disconnect()}),en.register(this)}static get DefaultTargetFrameRate(){return Qi._defaultTargetFramerate.value}static set DefaultTargetFrameRate(e){Qi._defaultTargetFramerate.value=e}static get DefaultWebGLRendererParameters(){return Qi._defaultWebglRendererParameters}get version(){return Ml}static get Current(){return en.Current}static set Current(e){en.Current=e}appendHTMLElement(e){return this.domElement.shadowRoot?this.domElement.shadowRoot.appendChild(e):this.domElement.appendChild(e)}get resolutionScaleFactor(){return this._resolutionScaleFactor}set resolutionScaleFactor(e){if(e!==this._resolutionScaleFactor&&typeof e=="number"){if(e<=0){console.error("Invalid resolution scale factor",e);return}this._resolutionScaleFactor=e,this.updateSize()}}calculateBoundingClientRect(){if(this.isInAR){this._domX=0,this._domY=0;return}this._boundingClientRectFrame!==this.time.frame&&(this._boundingClientRectFrame=this.time.frame,this._boundingClientRect=this.domElement.getBoundingClientRect(),this._domX=this._boundingClientRect.x,this._domY=this._boundingClientRect.y)}get domWidth(){return this.isInAR?window.innerWidth:this.domElement.clientWidth}get domHeight(){return this.isInAR?window.innerHeight:this.domElement.clientHeight}get domX(){return this.calculateBoundingClientRect(),this._domX}get domY(){return this.calculateBoundingClientRect(),this._domY}get isInXR(){var e,t;return((t=(e=this.renderer)==null?void 0:e.xr)==null?void 0:t.isPresenting)||!1}get isInVR(){return this.xrSessionMode===Ru.ImmersiveVR}get isInAR(){return this.xrSessionMode===Ru.ImmersiveAR}get xrSession(){var e,t;return(t=(e=this.renderer)==null?void 0:e.xr)==null?void 0:t.getSession()}get xrFrame(){return this._xrFrame}get xrCamera(){var e,t;return(t=(e=this.renderer)==null?void 0:e.xr)==null?void 0:t.getCamera()}get arOverlayElement(){const e=this.domElement;return typeof e.getAROverlayContainer=="function"?e.getAROverlayContainer():this.domElement}get currentFrameEvent(){return this._currentFrameEvent}get mainCamera(){if(this._camera)return this._camera;if(this.mainCameraComponent){const e=this.mainCameraComponent;return e.cam||e.buildCamera(),e.cam}return null}set mainCamera(e){this._camera=e}get rendererData(){return this.sceneLighting}get isCreated(){return this._isCreated}createNewRenderer(){var t,i,s;(t=this.renderer)==null||t.dispose();const e=Qi.DefaultWebGLRendererParameters;if(!e.canvas){const r=(s=(i=this.domElement)==null?void 0:i.shadowRoot)==null?void 0:s.querySelector("canvas");r&&(e.canvas=r)}this.renderer=new oh(e),this.renderer.debug.checkShaderErrors=si()||re("checkshadererrors")===!0,this.renderer.toneMappingExposure=1,this.renderer.toneMapping=Qs,this.renderer.setClearColor(new _e("lightgrey"),0),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=LE,this.renderer.setSize(this.domWidth,this.domHeight),this.renderer.outputColorSpace=Je,this.renderer.useLegacyLights=!1}internalOnUpdateVisible(){var e,t;(e=this._intersectionObserver)==null||e.disconnect(),(t=this._intersectionObserver)==null||t.observe(this.domElement)}updateSize(){var e,t,i;if(!this.isManagedExternally&&((e=this.renderer.xr)==null?void 0:e.isPresenting)===!1){this._sizeChanged=!1;const s=this.resolutionScaleFactor,r=this.domWidth*s,o=this.domHeight*s,a=this.mainCamera;this.updateAspect(a),this.renderer.setSize(r,o,!0),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.domElement.style.width="100%",this.renderer.domElement.style.height="100%",this.composer&&((t=this.composer.setSize)==null||t.call(this.composer,r,o),"setPixelRatio"in this.composer&&typeof this.composer.setPixelRatio=="function"&&((i=this.composer.setPixelRatio)==null||i.call(this.composer,window.devicePixelRatio)))}}updateAspect(e,t,i){if(!e)return;t===void 0&&(t=this.domWidth),i===void 0&&(i=this.domHeight);const s=e.aspect;e.aspect=t/i,s!==e.aspect&&e.updateProjectionMatrix()}async onCreate(e){return this.create(e)}async create(e){try{return this._isCreating=!0,window.addEventListener("unhandledrejection",this.onUnhandledRejection),await this.internalOnCreate(e)}finally{window.removeEventListener("unhandledrejection",this.onUnhandledRejection),this._isCreating=!1}}clear(){var e,t,i,s;en.dispatchCallback(Qn.ContextClearing,this),Zc(this.scene,!0,!0),this.scene=new mr,(e=this.addressables)==null||e.dispose(),(t=this.lightmaps)==null||t.clear(),(s=(i=this.physics)==null?void 0:i.engine)==null||s.clearCaches(),this.isManagedExternally||this.renderer&&(this.renderer.renderLists.dispose(),this.renderer.state.reset(),this.renderer.resetState()),en.dispatchCallback(Qn.ContextCleared,this)}dispose(){this.internalOnDestroy()}onDestroy(){this.internalOnDestroy()}internalOnDestroy(){var e,t;this.clear(),(e=this.renderer)==null||e.setAnimationLoop(null),this.renderer&&(this.renderer.setClearAlpha(0),this.renderer.clear()),this.isManagedExternally||this.renderer.dispose(),this.scene=null,this.renderer=null,this.input.dispose();for(const i of this._disposeCallbacks)try{i()}catch(s){console.error("Error in on dispose callback:",s,i)}(t=this.domElement)!=null&&t.parentElement&&this.domElement.parentElement.removeChild(this.domElement),en.dispatchCallback(Qn.ContextDestroyed,this),en.unregister(this)}registerCoroutineUpdate(e,t,i){return this.coroutines[i]||(this.coroutines[i]=[]),this.coroutines[i].push({comp:e,main:t}),t}unregisterCoroutineUpdate(e,t){if(!this.coroutines[t])return;const i=this.coroutines[t].findIndex(s=>s.main===e);i>=0&&this.coroutines[t].splice(i,1)}stopAllCoroutinesFrom(e){for(const t in this.coroutines){const i=this.coroutines[t];for(let s=i.length-1;s>=0;s--)i[s].comp===e&&i.splice(s,1)}}setCurrentCamera(e){var s;if(!e)return;if(e.cam||e.buildCamera(),!e.cam){console.warn("Camera component is missing camera",e);return}const t=this._cameraStack.indexOf(e);t>=0&&this._cameraStack.splice(t,1),this._cameraStack.push(e),this.mainCameraComponent=e;const i=e.cam;i.isPerspectiveCamera&&this.updateAspect(i),(s=this.mainCameraComponent)==null||s.applyClearFlagsIfIsActiveCamera()}removeCamera(e){if(!e)return;const t=this._cameraStack.indexOf(e);if(t>=0&&this._cameraStack.splice(t,1),this.mainCameraComponent===e&&(this.mainCameraComponent=void 0,this._cameraStack.length>0)){const i=this._cameraStack[this._cameraStack.length-1];this.setCurrentCamera(i)}}addBeforeRenderListener(e,t){this._onBeforeRenderListeners.has(e.uuid)||(this._onBeforeRenderListeners.set(e.uuid,[]),e.onBeforeRender=this._createRenderCallbackWrapper(e,this._onBeforeRenderListeners)),this._onBeforeRenderListeners.get(e.uuid).push(t)}removeBeforeRenderListener(e,t){if(this._onBeforeRenderListeners.has(e.uuid)){const i=this._onBeforeRenderListeners.get(e.uuid),s=i.indexOf(t);s>=0&&i.splice(s,1)}}addAfterRenderListener(e,t){var i;this._onAfterRenderListeners.has(e.uuid)||(this._onAfterRenderListeners.set(e.uuid,[]),e.onAfterRender=this._createRenderCallbackWrapper(e,this._onAfterRenderListeners)),(i=this._onAfterRenderListeners.get(e.uuid))==null||i.push(t)}removeAfterRenderListener(e,t){if(this._onAfterRenderListeners.has(e.uuid)){const i=this._onAfterRenderListeners.get(e.uuid),s=i.indexOf(t);s>=0&&i.splice(s,1)}}_createRenderCallbackWrapper(e,t){return(i,s,r,o,a,l)=>{const c=t.get(e.uuid);if(c)for(let u=0;u<c.length;u++){const d=c[u];d(i,s,r,o,a,l)}}}get isRendering(){return this._isRendering}setRequireDepth(e){this._requireDepthTexture=e}setRequireColor(e){this._requireColorTexture=e}get depthTexture(){var e;return((e=this._renderTarget)==null?void 0:e.depthTexture)||null}get opaqueColorTexture(){var e;return((e=this._renderTarget)==null?void 0:e.texture)||null}get isVisibleToUser(){if(this.isInXR)return!0;if(!this._isVisible)return!1;const e=getComputedStyle(this.domElement);return e.visibility!=="hidden"&&e.display!=="none"&&e.opacity!=="0"}async internalOnCreate(e){var o,a,l,c,u;const t=++this._createId;this.clear(),this.isManagedExternally===!1&&(this.createNewRenderer(),(o=this.renderer)==null||o.setAnimationLoop(null)),await Tu(1),Qi.Current=this,await en.dispatchCallback(Qn.ContextCreationStart,this);let i=!0,s;try{Qi.Current=this,e?s=await this.internalLoadInitialContent(t,e):s=[]}catch(d){console.error(d),i=!1}if(!i||t!==this._createId)return!1;if(this.internalOnUpdateVisible(),!this.renderer)return bc&&console.warn("Context has no renderer (perhaps it was disconnected?",this.domElement.isConnected),!1;!this.isManagedExternally&&!this.domElement.shadowRoot&&this.domElement.prepend(this.renderer.domElement),Qi.Current=this,Qi.Current=this;for(let d=0;d<this.new_scripts.length;d++){const f=this.new_scripts[d];if(f.gameObject!==void 0&&f.gameObject!==null){f.gameObject.userData===void 0&&(f.gameObject.userData={}),f.gameObject.userData.components===void 0&&(f.gameObject.userData.components=[]);const p=f.gameObject.userData.components;p.includes(f)||p.push(f)}}if(this.post_setup_callbacks)for(let d=0;d<this.post_setup_callbacks.length;d++)Qi.Current=this,await this.post_setup_callbacks[d](this);if(!this.mainCamera){Qi.Current=this;let d=null;v0(this.scene,f=>{const p=f;if(p!=null&&p.isCamera){if(Dg(p.gameObject),!p.activeAndEnabled)return;if(p.tag==="MainCamera")return d=p,!0;d=p}}),d?this.setCurrentCamera(d):!en.dispatchCallback(Qn.MissingCamera,this,{files:s})&&!this.mainCamera&&!this.isManagedExternally&&console.warn("Missing camera in main scene",this)}if(Qi.Current=this,y0(this),this.physics.engine&&((a=this.physics.engine)==null||a.step(0),(l=this.physics.engine)==null||l.postStep()),!this.isManagedExternally&&this.composer&&this.mainCamera){const d=new p_(this.scene,this.mainCamera);this.renderer.setSize(this.domWidth,this.domHeight),this.composer.addPass(d),this.composer.setSize(this.domWidth,this.domHeight)}this._sizeChanged=!0,this._stats&&(this._stats.showPanel(0),(c=this.domElement.shadowRoot)==null||c.appendChild(this._stats.dom)),bc&&pC(this.scene,!0),this.targetFrameRate===void 0?(bc&&console.warn("No target framerate set, using default",Qi.DefaultTargetFrameRate),this.targetFrameRate=Qi._defaultTargetFramerate):bc&&console.log("Target framerate set to",this.targetFrameRate),this._dispatchReadyAfterFrame=!0;const r=en.dispatchCallback(Qn.ContextCreated,this,{files:s});return r&&("internalSetLoadingMessage"in this.domElement&&typeof this.domElement.internalSetLoadingMessage=="function"&&((u=this.domElement)==null||u.internalSetLoadingMessage("finish loading")),await r),this._isCreating=!1,this.isManagedExternally||this.restartRenderLoop(),r}async internalLoadInitialContent(e,t){var l,c;const i=new Array;if(t.files.length===0)return i;const s=[...t.files],r={name:"",progress:null,index:0,count:s.length},o=Ga();let a=0;this.hash&&(a=Number.parseInt(this.hash)??0);for(let u=0;u<s.length;u++){if(e!==this._createId){bc&&console.log("Aborting loading because create id changed",e,this._createId);break}const d=s[u];if(!d.includes(".glb")&&!d.includes(".gltf")){const p=`Needle Engine: found suspicious src "${d}"`;console.warn(p),Ar()&&Rs(p)}(l=t==null?void 0:t.onLoadingStart)==null||l.call(this,u,d);const f=await o.loadSync(this,d,d,a,p=>{var g;r.name=d,r.progress=p,r.index=u,r.count=s.length,(g=t.onLoadingProgress)==null||g.call(this,r)});(c=t==null?void 0:t.onLoadingFinished)==null||c.call(this,u,d,f??null),f?i.push({src:d,file:f}):console.warn("Could not load file: "+d)}if(e!==this._createId){for(const u of i)if(u&&u.file)for(const d of u.file.scenes)Zc(d,!0,!0)}else for(const u of i)u&&u.file&&this.scene.add(u.file.scene);return i}restartRenderLoop(){return this.renderer?this._isCreating?(console.warn("Can not start render loop while creating context"),!1):(this.renderer.setAnimationLoop((e,t)=>{this.isManagedExternally||this.update(e,t)}),!0):(console.error("Can not start render loop without renderer"),!1)}update(e,t){if(t===void 0&&(t=null),si()||bc||Nj())try{this.internalStep(e,t)}catch(i){(si()||bc)&&i instanceof Error&&bn("Exception during render-loop.<br/>See console for details.",jn.Error),console.error(i),console.warn("Stopping render loop due to error"),this.renderer.setAnimationLoop(null),this.domElement.dispatchEvent(new CustomEvent("error",{detail:i}))}else this.internalStep(e,t)}internalStep(e,t){this.internalOnBeforeRender(e,t)!==!1&&(this.internalOnRender(),this.internalOnAfterRender())}internalOnBeforeRender(e,t){var i;if(this._xrFrame=t,this._currentFrameEvent=li.Undefined,this.isManagedExternally===!1&&this.isInXR===!1&&this.targetFrameRate!==void 0){this._lastTimestamp===0&&(this._lastTimestamp=e),this._accumulatedTime+=(e-this._lastTimestamp)/1e3,this._lastTimestamp=e;let s=this.targetFrameRate;if(typeof s=="object"&&(s=s.value),this._accumulatedTime<1/(s+1))return!1;this._accumulatedTime=0}if((i=this._stats)==null||i.begin(),Qi.Current=this,this.onHandlePaused())return!1;for(Qi.Current=this,this.time.update(),Bq&&console.log("FPS",this.time.smoothedFps.toFixed(0)),y0(this),Oy(this.scene),Q2(this);this._cameraStack.length>0&&(!this.mainCameraComponent||this.mainCameraComponent.destroyed);){this._cameraStack.splice(this._cameraStack.length-1,1);const s=this._cameraStack[this._cameraStack.length-1];this.setCurrentCamera(s)}if(this.pre_update_callbacks)for(const s in this.pre_update_callbacks)this.pre_update_callbacks[s]();this._currentFrameEvent=li.EarlyUpdate;for(let s=0;s<this.scripts_earlyUpdate.length;s++){const r=this.scripts_earlyUpdate[s];r.activeAndEnabled&&r.earlyUpdate!==void 0&&(Qi.Current=this,r.earlyUpdate())}if(this.executeCoroutines(li.EarlyUpdate),this.onHandlePaused())return!1;this._currentFrameEvent=li.Update;for(let s=0;s<this.scripts_update.length;s++){const r=this.scripts_update[s];r.activeAndEnabled&&r.update!==void 0&&(Qi.Current=this,r.update())}if(this.executeCoroutines(li.Update),this.onHandlePaused())return!1;this._currentFrameEvent=li.LateUpdate;for(let s=0;s<this.scripts_lateUpdate.length;s++){const r=this.scripts_lateUpdate[s];r.activeAndEnabled&&r.lateUpdate!==void 0&&(Qi.Current=this,r.lateUpdate())}if(this.executeCoroutines(li.LateUpdate),this.onHandlePaused())return!1;if(this.physics.engine){const r=this.time.deltaTime/1;for(let o=0;o<1;o++)this._currentFrameEvent=li.PrePhysicsStep,this.executeCoroutines(li.PrePhysicsStep),this.physics.engine.step(r),this._currentFrameEvent=li.PostPhysicsStep,this.executeCoroutines(li.PostPhysicsStep);this.physics.engine.postStep()}if(this.onHandlePaused())return!1;if(this.isVisibleToUser||this.runInBackground){this._currentFrameEvent=li.OnBeforeRender;for(let s=0;s<this.scripts_onBeforeRender.length;s++){const r=this.scripts_onBeforeRender[s];r.activeAndEnabled&&r.onBeforeRender!==void 0&&(Qi.Current=this,r.onBeforeRender(t))}if(this.executeCoroutines(li.OnBeforeRender),this._sizeChanged&&this.updateSize(),this.pre_render_callbacks)for(const s in this.pre_render_callbacks)this.pre_render_callbacks[s]()}return!0}internalOnRender(){this.isManagedExternally||(Vj(this),this._currentFrameEvent=li.Undefined,this.renderNow(),this._currentFrameEvent=li.OnAfterRender)}internalOnAfterRender(){if(this.isVisibleToUser||this.runInBackground){for(let e=0;e<this.scripts_onAfterRender.length;e++){const t=this.scripts_onAfterRender[e];t.activeAndEnabled&&t.onAfterRender!==void 0&&(Qi.Current=this,t.onAfterRender())}if(this.executeCoroutines(li.OnAfterRender),this.post_render_callbacks)for(const e in this.post_render_callbacks)this.post_render_callbacks[e]()}this._currentFrameEvent=-1,this.connection.sendBufferedMessagesNow(),this._stats&&(this._stats.end(),this.time.frameCount%150===0&&console.log({...this.renderer.info.memory},{...this.renderer.info.render})),this._dispatchReadyAfterFrame&&(this._dispatchReadyAfterFrame=!1,this.domElement.dispatchEvent(new CustomEvent("ready")))}renderNow(e){return!e&&(e=this.mainCamera,!e)?!1:(this._isRendering=!0,this.renderRequiredTextures(),this.composer&&!this.isInXR?this.composer.render(this.time.deltaTime):e&&this.renderer.render(this.scene,e),this._isRendering=!1,!0)}onHandlePaused(){const e=this.evaluatePaused();if(this._wasPaused!==e){Pq&&console.log("Paused?",e,"context:"+this.alias);for(let t=0;t<this.scripts_pausedChanged.length;t++){const i=this.scripts_pausedChanged[t];i.activeAndEnabled&&i.onPausedChanged!==void 0&&(Qi.Current=this,i.onPausedChanged(e,this._wasPaused))}}return this._wasPaused=e,e}evaluatePaused(){return this.isInXR?!1:this.isPaused?!0:this.runInBackground?!1:!this.isVisibleToUser}renderRequiredTextures(){if(!this.mainCamera||!this._requireDepthTexture&&!this._requireColorTexture)return;if(!this._renderTarget){if(this._renderTarget=new ni(this.domWidth,this.domHeight),this._requireDepthTexture){const i=new Ib(this.domWidth,this.domHeight);this._renderTarget.depthTexture=i}this._requireColorTexture&&(this._renderTarget.texture=new Rt,this._renderTarget.texture.generateMipmaps=!1,this._renderTarget.texture.minFilter=Ft,this._renderTarget.texture.magFilter=Ft,this._renderTarget.texture.format=Ti)}const e=this._renderTarget;e.texture&&(e.texture.colorSpace=this.renderer.outputColorSpace);const t=this.renderer.getRenderTarget();this.renderer.setRenderTarget(e),this.renderer.render(this.scene,this.mainCamera),this.renderer.setRenderTarget(t)}executeCoroutines(e){var i;if(this.coroutines[e]){const s=this.coroutines[e];for(let r=0;r<s.length;r++)try{const o=s[r];if(!o.comp||o.comp.destroyed||!o.main||o.comp.enabled===!1){Dq&&console.log("Removing coroutine",o.comp,o.comp.enabled),s.splice(r,1),--r;continue}const l=o.chained;if(l&&l.length>0){const f=l[l.length-1].next();if(f.done&&l.pop(),t(f)&&(o.chained||(o.chained=[]),o.chained.push(f.value)),!f.done)continue}const c=o.main.next();if(c.done===!0){s.splice(r,1),--r;continue}const u=c.value;if(t(u)){if(u.next().done)continue;o.chained||(o.chained=[]),o.chained.push(u)}else if(u instanceof Promise){const d=u;o.chained||(o.chained=[]);const f=Iq(d);(i=o.chained)==null||i.push(f);continue}}catch(o){console.error(o)}}function t(s){return!!(s&&s.next&&s.return)}}};let Lt=Qi;h(Lt,"_defaultTargetFramerate",{value:60}),h(Lt,"_defaultWebglRendererParameters",{antialias:!0,alpha:!1});const Qp=re("debugoverlay"),MF="ar",Oq="quit-ar";class kq{constructor(){h(this,"arContainer",null);h(this,"currentSession",null);h(this,"_createdAROnlyElements",[]);h(this,"_reparentedObjects",[]);h(this,"contentElement",null);h(this,"requestEndAR",()=>{this.onRequestedEndAR()})}get ARContainer(){return this.arContainer}onBegin(e,t,i){var s;if(this.currentSession=i,this.arContainer=t,cC()){const r=e.domElement.children;for(let o=0;o<(r==null?void 0:r.length);o++){const a=r[o];if(!a||a===this.arContainer)return;this._reparentedObjects.push({el:a,previousParent:a.parentElement}),(s=this.arContainer)==null||s.appendChild(a)}}this.ensureQuitARButton(this.arContainer)}onEnd(e){var t;for(const i of this._createdAROnlyElements)i.remove&&i.remove();for(const i of this._reparentedObjects){const s=i.el;(t=i.previousParent)==null||t.appendChild(s)}this._reparentedObjects.length=0,cC()&&setTimeout(()=>{var o;const i=e.renderer.domElement;i&&((o=e.domElement.shadowRoot)==null||o.prepend(i));const s=document.querySelectorAll("*");for(var r=0;r<s.length;r++){const a=s[r];a&&a._displayChanged!==void 0&&a._displayWas!==void 0&&(a.style.display=a._displayWas)}},10)}createOverlayContainer(e){if(this.contentElement)return this.contentElement;Qp&&console.log("Setup overlay container");const t=e.shadowRoot.querySelector(".content");this.contentElement=t;const i=e.shadowRoot.querySelector(".overlay-content");return i&&t.appendChild(i),Qp&&!ch()&&this.ensureQuitARButton(t),t}onRequestedEndAR(){this.currentSession&&(this.currentSession.end(),this.currentSession=null)}ensureQuitARButton(e){const t=document.createElement("slot");t.setAttribute("name","quit-ar"),this.appendElement(t,e),this._createdAROnlyElements.push(t),t.style.pointerEvents="auto";const i=document.querySelector(`.${Oq}`);if(i){i.addEventListener("click",this.requestEndAR),Qp&&i.addEventListener("click",()=>console.log("Clicked quit-ar button"));return}t.addEventListener("click",this.requestEndAR),Qp&&t.addEventListener("click",()=>console.log("Clicked fallback close button"));const s=document.createElement("div");s.style.cssText=`
            position: fixed;
            top: 0;
            right: 0;
            z-index: 600;
            pointer-events: all;
        `,this.appendElement(s,t);var r=document.createElementNS("http://www.w3.org/2000/svg","svg");r.classList.add("quit-ar-button"),r.setAttribute("width","38px"),r.setAttribute("height","38px"),r.style.cssText=`
            background: radial-gradient(circle, rgba(0,0,0,.05) 70%, rgba(0,0,0,0) 100%);
            border-radius: 50%;
        `,s.appendChild(r);var o=document.createElementNS("http://www.w3.org/2000/svg","path");o.setAttribute("d","M 12,12 L 28,28 M 28,12 12,28"),o.setAttribute("stroke","#fff"),o.setAttribute("stroke-width","3px"),o.style.cssText=`
            filter: drop-shadow(0 0px 1.2px rgba(0,0,0,.7));
        `,r.appendChild(o),Qp&&console.log("Created fallback close button",r,e)}appendElement(e,t){return t.shadowRoot?t.shadowRoot.appendChild(e):t.appendChild(e)}}class ne extends Me{constructor(){super(...arguments);h(this,"guid")}static isDestroyed(t){return nT(t)}static setActive(t,i,s=!0){t&&(Dy(t,i),Oy(t),i&&s&&Q2(Lt.Current,t))}static isActiveSelf(t){return aA(t)}static isActiveInHierarchy(t){return Dj(t)}static markAsInstancedRendered(t,i){Oj(t,i)}static isUsingInstancing(t){return iT(t)}static foreachComponent(t,i,s=!0){return v0(t,i,s)}static instantiateSynced(t,i){return t?_2(t,i):null}static instantiate(t,i=null){return u_(t,i)}static destroySynced(t,i,s=!0){if(!t)return;const r=t;i=i??Lt.Current,YM(r,i.connection,s)}static destroy(t,i=!0,s=!0){return Zc(t,i,s)}static add(t,i,s){if(!(!t||!i)){if(t===i){console.warn("Can not add object to self",t);return}s||(s=Lt.Current),i.add(t),Dy(t,!0),Oy(t),s?ne.foreachComponent(t,r=>{W2(r,s),!r.__internalDidAwakeAndStart&&s.new_script_start.includes(r)===!1&&s.new_script_start.push(r)},!0):console.warn("Missing context")}}static remove(t){var i;t&&((i=t.parent)==null||i.remove(t),Dy(t,!1),Oy(t),ne.foreachComponent(t,s=>{zj(s)},!0))}static invokeOnChildren(t,i,...s){this.invoke(t,i,!0,s)}static invoke(t,i,s=!1,...r){t&&this.foreachComponent(t,o=>{const a=o[i];a&&typeof a=="function"&&(a==null||a.call(o,...r))},s)}static addNewComponent(t,i,s=!0){const r=new i;return zu(t,r,s),r}static addComponent(t,i){return this.moveComponent(t,i)}static moveComponent(t,i){return M2(t,i)}static removeComponent(t){return C2(t.gameObject,t),t}static getOrAddComponent(t,i){return KM(t,i)}static getComponent(t,i){return t===null?null:rA(t,i)}static getComponents(t,i,s=null){return t===null?s??[]:o_(t,i,s)}static findByGuid(t,i){return h_(t,i)}static findObjectOfType(t,i,s=!0){return oj(t,i??Lt.Current,s)}static findObjectsOfType(t,i){const s=[];return aj(t,s,i),s}static getComponentInChildren(t,i){return a_(t,i)}static getComponentsInChildren(t,i,s=null){return l_(t,i,s??void 0)}static getComponentInParent(t,i){return p0(t,i)}static getComponentsInParent(t,i,s=null){return ZM(t,i,s)}static getAllComponents(t){var r;return[...(r=t.userData)==null?void 0:r.components]}static*iterateComponents(t){var s;const i=(s=t==null?void 0:t.userData)==null?void 0:s.components;if(i&&Array.isArray(i))for(let r=0;r<i.length;r++)yield i[r]}}var $i;let Gu=($i=class{constructor(){h(this,"__context");h(this,"__name");h(this,"gameObject");h(this,"guid","invalid");h(this,"sourceId");h(this,"__didAwake",!1);h(this,"__didStart",!1);h(this,"__didEnable",!1);h(this,"__isEnabled");h(this,"__destroyed",!1);h(this,"_worldPosition");h(this,"_worldQuaternion");h(this,"_worldEuler");h(this,"_worldRotation");h(this,"_eventListeners",new Map);this.__internalNewInstanceCreated()}get isComponent(){return!0}get context(){return this.__context??Lt.Current}set context(e){this.__context=e}get scene(){return this.context.scene}get layer(){var e,t;return(t=(e=this.gameObject)==null?void 0:e.userData)==null?void 0:t.layer}get name(){var e,t;return(e=this.gameObject)!=null&&e.name?this.gameObject.name:(t=this.gameObject)==null?void 0:t.userData.name}set name(e){this.gameObject?(this.gameObject.userData||(this.gameObject.userData={}),this.gameObject.userData.name=e,this.__name=e):this.__name=e}get tag(){var e;return(e=this.gameObject)==null?void 0:e.userData.tag}set tag(e){this.gameObject&&(this.gameObject.userData||(this.gameObject.userData={}),this.gameObject.userData.tag=e)}get static(){var e;return(e=this.gameObject)==null?void 0:e.userData.static}get hideFlags(){var e;return(e=this.gameObject)==null?void 0:e.userData.hideFlags}get activeAndEnabled(){return!(this.destroyed||this.__isEnabled===!1||!this.__isActiveInHierarchy)}get __isActive(){return this.gameObject.visible}get __isActiveInHierarchy(){if(!this.gameObject)return!1;const e=this.gameObject[zc];return e===void 0?!0:e}set __isActiveInHierarchy(e){this.gameObject&&(this.gameObject[zc]=e)}awake(){}onEnable(){}onDisable(){}onDestroy(){this.__destroyed=!0}startCoroutine(e,t=li.Update){return this.context.registerCoroutineUpdate(this,e,t)}stopCoroutine(e,t=li.Update){this.context.unregisterCoroutineUpdate(e,t)}get destroyed(){return this.__destroyed}destroy(){this.__destroyed||this.__internalDestroy()}get __internalDidAwakeAndStart(){return this.__didAwake&&this.__didStart}__internalNewInstanceCreated(){this.__didAwake=!1,this.__didStart=!1,this.__didEnable=!1,this.__isEnabled=void 0,this.__destroyed=!1}__internalAwake(){this.__didAwake||(this.__didAwake=!0,this.awake())}__internalStart(){this.__didStart||(this.__didStart=!0,this.start&&this.start())}__internalEnable(e){return this.__destroyed?(si()&&console.warn("[Needle Engine Dev] Trying to enable destroyed component"),!1):this.__didAwake?this.__didEnable?(e!==!0&&(this.__isEnabled=!0),!1):(this.__didEnable=!0,this.__isEnabled=!0,this.onEnable(),!0):!1}__internalDisable(e){if(this.__didAwake){if(!this.__didEnable){e!==!0&&(this.__isEnabled=!1);return}this.__didEnable=!1,this.__isEnabled=!1,this.onDisable()}}__internalDestroy(){var e;this.__destroyed||(this.__destroyed=!0,this.__didAwake&&((e=this.onDestroy)==null||e.call(this),this.dispatchEvent(new CustomEvent("destroyed",{detail:this}))),rj(this))}get enabled(){return typeof this.__isEnabled=="boolean"?this.__isEnabled:!0}set enabled(e){if(this.__destroyed){si()&&console.warn(`[Needle Engine Dev] Trying to ${e?"enable":"disable"} destroyed component`);return}if(typeof e=="number"&&(e>=.5?e=!0:e=!1),!this.__didAwake){this.__isEnabled=e;return}e?this.__internalEnable():this.__internalDisable()}get worldPosition(){return this._worldPosition||(this._worldPosition=new w),Mt(this.gameObject,this._worldPosition),this._worldPosition}set worldPosition(e){On(this.gameObject,e)}setWorldPosition(e,t,i){$i._worldPositionBuffer.set(e,t,i),this.worldPosition=$i._worldPositionBuffer}get worldQuaternion(){return this._worldQuaternion||(this._worldQuaternion=new Se),Gr(this.gameObject,this._worldQuaternion)}set worldQuaternion(e){_o(this.gameObject,e)}setWorldQuaternion(e,t,i,s){$i._worldQuaternionBuffer.set(e,t,i,s),this.worldQuaternion=$i._worldQuaternionBuffer}get worldEuler(){return this._worldEuler||(this._worldEuler=new pn),this._worldEuler.setFromQuaternion(this.worldQuaternion),this._worldEuler}set worldEuler(e){var t;this._worldQuaternion||(this._worldQuaternion=new Se),(t=this._worldQuaternion)==null||t.setFromEuler(e),this.worldQuaternion=this._worldQuaternion}get worldRotation(){const e=this.worldEuler;this._worldRotation||(this._worldRotation=new w);const t=this._worldRotation;return t.set(e.x,e.y,e.z),t.x=tt.toDegrees(t.x),t.y=tt.toDegrees(t.y),t.z=tt.toDegrees(t.z),t}set worldRotation(e){this.setWorldRotation(e.x,e.y,e.z,!0)}setWorldRotation(e,t,i,s=!0){s&&(e=tt.toRadians(e),t=tt.toRadians(t),i=tt.toRadians(i)),$i._worldEulerBuffer.set(e,t,i),$i._worldQuaternionBuffer.setFromEuler($i._worldEulerBuffer),this.worldQuaternion=$i._worldQuaternionBuffer}get forward(){return $i._forward.set(0,0,-1).applyQuaternion(this.worldQuaternion)}get right(){return $i._right.set(1,0,0).applyQuaternion(this.worldQuaternion)}get up(){return $i._up.set(0,1,0).applyQuaternion(this.worldQuaternion)}addEventListener(e,t){this._eventListeners[e]=this._eventListeners[e]||[],this._eventListeners[e].push(t)}removeEventListener(e,t){if(!this._eventListeners[e])return;const i=this._eventListeners[e].indexOf(t);i>=0&&this._eventListeners[e].splice(i,1)}dispatchEvent(e){if(!e||!this._eventListeners[e.type])return!1;const t=this._eventListeners[e.type];for(let i=0;i<t.length;i++)t[i](e);return!1}},h($i,"_worldPositionBuffer",new w),h($i,"_worldQuaternionBuffer",new Se),h($i,"_worldEulerBuffer",new pn),h($i,"_tempQuaternionBuffer2",new Se),h($i,"_forward",new w),h($i,"_right",new w),h($i,"_up",new w),$i);class Te extends Gu{}const Lq=Object.freeze(Object.defineProperty({__proto__:null,Behaviour:Te,Component:Gu,GameObject:ne},Symbol.toStringTag,{value:"Module"})),Fq='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 160 187.74"><defs><linearGradient id="a" x1="89.64" y1="184.81" x2="90.48" y2="21.85" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#62d399"/><stop offset=".51" stop-color="#acd842"/><stop offset=".9" stop-color="#d7db0a"/></linearGradient><linearGradient id="b" x1="69.68" y1="178.9" x2="68.08" y2="16.77" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#0ba398"/><stop offset=".5" stop-color="#4ca352"/><stop offset="1" stop-color="#76a30a"/></linearGradient><linearGradient id="c" x1="36.6" y1="152.17" x2="34.7" y2="84.19" gradientUnits="userSpaceOnUse"><stop offset=".19" stop-color="#36a382"/><stop offset=".54" stop-color="#49a459"/><stop offset="1" stop-color="#76a30b"/></linearGradient><linearGradient id="d" x1="15.82" y1="153.24" x2="18" y2="90.86" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#267880"/><stop offset=".51" stop-color="#457a5c"/><stop offset="1" stop-color="#717516"/></linearGradient><linearGradient id="e" x1="135.08" y1="135.43" x2="148.93" y2="63.47" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#b0d939"/><stop offset="1" stop-color="#eadb04"/></linearGradient><linearGradient id="f" x1="-4163.25" y1="2285.12" x2="-4160.81" y2="2215.34" gradientTransform="rotate(20 4088.49 13316.712)" gradientUnits="userSpaceOnUse"><stop offset=".17" stop-color="#74af52"/><stop offset=".48" stop-color="#99be32"/><stop offset="1" stop-color="#c0c40a"/></linearGradient><symbol id="g" viewBox="0 0 160 187.74"><path style="fill:url(#a)" d="M79.32 36.98v150.76L95 174.54l6.59-156.31-22.27 18.75z"/><path style="fill:url(#b)" d="M79.32 36.98 57.05 18.23l6.59 156.31 15.68 13.2V36.98z"/><path style="fill:url(#c)" d="m25.19 104.83 8.63 49.04 12.5-14.95-2.46-56.42-18.67 22.33z"/><path style="fill:url(#d)" d="M25.19 104.83 0 90.24l16.97 53.86 16.85 9.77-8.63-49.04z"/><path style="fill:#9c3" d="M43.86 82.5 18.69 67.98 0 90.24l25.18 14.59L43.86 82.5z"/><path style="fill:url(#e)" d="m134.82 78.69-9.97 56.5 15.58-9.04L160 64.1l-25.18 14.59z"/><path style="fill:url(#f)" d="m134.82 78.69-18.68-22.33-2.86 65 11.57 13.83 9.97-56.5z"/><path style="fill:#ffe113" d="m160 64.1-18.69-22.26-25.17 14.52 18.67 22.33L160 64.1z"/><path style="fill:#f3e600" d="M101.59 18.23 79.32 0 57.05 18.23l22.27 18.75 22.27-18.75z"/></symbol></defs><use width="160" height="187.74" xlink:href="#g"/></svg>',Uq=new Blob([Fq],{type:"image/svg+xml;charset=utf-8"}),Nq=URL.createObjectURL(Uq),Fy=Nq,Ho=re("debuglicense");let vu="basic";Ho&&console.log("License Type: "+vu);function Fg(){switch(vu){case"pro":case"enterprise":return!0}return!1}function TF(){switch(vu){case"indie":return!0}return!1}function Nf(){return Fg()||TF()}en.registerCallback(Qn.ContextRegistered,n=>{Vq(n.context),jq(),Gq(n.context)});let Gc,jC=!1,fg="";async function zq(){if(Gc)return Gc;if(vu==="basic")try{const n="https://engine.needle.tools/licensing/check?location="+encodeURIComponent(window.location.href)+"&version="+Ml+"&generator="+encodeURIComponent(XM),e=await fetch(n,{method:"GET"}).catch();(e==null?void 0:e.status)===200?(jC=!1,Ho&&console.log("License check succeeded"),vu="pro"):e.status===403?(jC=!0,fg=await e.text()):Ho&&console.log("License check failed with status "+e.status)}catch(n){Ho&&console.error("License check failed",n)}else Ho&&console.log('Runtime license check is skipped because license is already applied as "'+vu+'"')}Gc=zq();async function Gq(n){function e(){const s=document.createElement("div");s.className="needle-forbidden",s.style.cssText=`
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: all;
        zIndex: 2147483647;
        background-color: rgba(0,0,0,0.3);
        backdrop-filter: blur(10px);
        webkitBackdropFilter: blur(10px);
        line-height: 1.5;
        `;const r=document.createElement("div");s.appendChild(r),r.style.cssText=`
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: white;
        font-size: 24px;
        font-family: sans-serif;
        text-align: center;
        user-select: none;
        `;const o=(fg==null?void 0:fg.length)>1?fg:"Needle Engine<br/>This application is not allowed to run on this domain!";return r.innerHTML=o,s}let t=e();const i=t.style.cssText;setInterval(()=>{var s;jC===!0&&(t.style.cssText!==i&&(t=e()),"isPaused"in n&&(n.isPaused=!0),t.parentNode!==n.domElement.shadowRoot&&((s=n.domElement.shadowRoot)==null||s.appendChild(t)))},500)}async function Vq(n){try{if(Nf()!==!0)return yw(n)}catch(e){return Ho&&console.log("License check failed",e),yw(n)}Ho&&yw(n)}const IF="needle-license-element",qC=1e4,XC=1200;async function yw(n){await(Gc==null?void 0:Gc.catch(()=>{})),!Nf()&&(Hq(),n.domElement.addEventListener("ready",()=>{RF(n)}))}function RF(n){const e=Qq(),t=Wq(),i=document.createElement("img");i.src=Fy,i.classList.add("logo"),i.style.cssText="width: 40px; height: 40px; margin-right: 2px; vertical-align: middle; margin-bottom: 2px;",e.appendChild(i);const s=()=>{if(!e)return;const a=n.domElement.shadowRoot||n.domElement;e.parentNode!==a&&(a.appendChild(e),t&&a.appendChild(t)),i.parentElement!==e&&e.appendChild(i),i.src!==Fy&&(i.setAttribute("src",Fy),i.style.cssText="width: 40px; height: 40px; margin-right: 2px; vertical-align: middle; margin-bottom: 2px;")};s();const r=setInterval(()=>{s()},1e3),o=document.createElement("div");if(o.classList.add("text"),e.appendChild(o),e.title="Needle Engine",Nf()||(e.title+=" No active license found - Non Commercial Use"),e.addEventListener("click",()=>{globalThis.open("https://needle.tools","_blank")}),TF()){const a=qC+XC;setTimeout(()=>{clearInterval(r),e==null||e.remove(),t==null||t.remove();const l=5;setTimeout(()=>{n.domElement.parentNode&&RF(n)},1e3*60*l)},a)}}let oB=0;async function Hq(n){const e=Date.now();if(e-oB<2e3)return;oB=e;const i=`
        position: relative;
        display: block;
        font-size: 18px;
        background-size: 20px;
        background-position: 10px 5px;
        background-repeat:no-repeat;
        background-image:url('data:image/webp;base64,UklGRrABAABXRUJQVlA4WAoAAAAQAAAAHwAAHwAAQUxQSKEAAAARN6CmbSM4WR7vdARON11EBDq3fLiNbVtVzpMCPlKAEzsx0Y/x+Ovuv4dn0EFE/ydAvz6YggXzgh5sVgXM/zOC/4sii7qgGvB5N7hmuQYwkvazWAu1JPW41FXSHq6pnaQWvqYH18Fc0j1hO/BFTtIeSBlJi5w6qIIO7IOrwhFsB2Yxukif0FTRLpXswHR8MxbslKe9VZsn/Ub5C7YFOpqSTABWUDgg6AAAAFAGAJ0BKiAAIAA+7VyoTqmkpCI3+qgBMB2JbACdMt69DwMIQBLhkTO6XwY00UEDK6cNIDnuNibPf0EgAP7Y1myuiQHLDsF/0h5unrGh6WAbv7aegg2ZMd3uRKfT/3SJztcaujYfTvMXspfCTmYcoO6a+vhC3ss4M8uM58t4siiu59I4aOl59e9Sr6xoxYlHf2v+NnBNpJYeJf8jABQAId/PXuBkLEFkiCucgSGEcfhvajql/j3reCGl0M5/9gQWy7ayNPs+wlvIxFnNfSlfuND4CZOCyxOHhRqOmHN4ULHo3tCSrUNvgAA=');
        background-max-size: 40px;
        margin-bottom: 5px;
        margin-top: .3em;
        margin-bottom: .5em;
        padding: .2em;
        padding-left: 25px;
        border-radius: .5em;
        border: 2px solid rgba(160,160,160,.3);
    `,r=`Needle Engine  No license active, commercial use is not allowed. Visit https://needle.tools/pricing for more information and licensing options! v${Ml}`;console.log("%c "+r,i)}function Qq(){const n=document.createElement("div");n.setAttribute(IF,""),n.style.position="absolute",n.style.bottom="12px",n.style.right="15px";const e=2147483647;return n.style.zIndex=`${e}`,n}function Wq(){const n=document.createElement("style"),e=`div[${IF}]`;return n.innerHTML=`
    ${e} {
        font-family: 'Roboto', sans-serif !important;
        font-weight: 300;
        transition: all 0.1s ease-in-out !important;
        pointer-events: all;
        overflow: hidden;
    }

    ${e}:hover {
        cursor: pointer;
        transition: all 0.3s ease-in-out !important;
    }

    ${e}, ${e} > * {
        display: inline-block !important;
        visibility: visible !important;
        border: none !important;
        text-decoration: none !important;
        vertical-align: middle !important;
    }
    
    @keyframes license-animation-text {
        1% {
            opacity: 0;
        }
        2.5% {
            opacity: 1;
        }
        100% {
            opacity: 1;
        }
    }
    ${e} .text {
        position: relative;
        display: inline-block;
        opacity: 0;
        animation: license-animation-text;
        animation-duration: ${qC/1e3}s;
        animation-delay: ${XC/1e3}s;
        animation-fill-mode: forwards;
        line-height: 1em;
        margin-left: -3px;
        color: rgba(20,20,20,1);
        font-size: 14px;
        font-weight: 800;
        background-color: rgba(220, 220, 220, .8);
        // padding: .51em .6em .43em .6em;
        border-radius: .7em;
    }

    ${e} .text .non-commercial {
        font-size: 0.8em;
        font-weight: 600;
        text-transform: uppercase;
    }
    
    @keyframes logo-animation {
        0% {
            transform: translate(0px, 10px);
            pointer-events: none;
        }
        3% {
            transform: translate(0, 0px);
            pointer-events: all;
            opacity: 1;
            transform: scale(1.1)
        }
        12% {
            transform: scale(1)
        }
        100% {
            opacity: 1;
            pointer-events: all;
            transform: scale(1)
        }
    }

    ${e} .logo {
        opacity: 0;
        pointer-events: none;
        animation: logo-animation;
        animation-duration: ${qC/1e3}s;
        animation-delay: ${XC/1e3}s;
        animation-easing: ease-in-out;
        animation-fill-mode: forwards;
    }

    ${e} .logo {
        position: relative !important;
        display: inline-block !important;
        border-radius: 50% !important;
        background-color: transparent !important;
        padding: 5px !important;
        transition: all 0.2s ease-in-out !important;
    }

    ${e}:hover .logo {
        transition: all 0.2s ease-in-out !important;
        transform: scale(1.1) !important;
        cursor: pointer !important;
    }

    @media (prefers-reduced-motion: reduce) {
        ${e} .text {
            animation: none !important;
            transition: none !important;
            /* animation end state */
            opacity: 1;
        }

        ${e} .logo {
            animation: none !important;
            transition: none !important;
            /* animation end state */
            opacity: 1;
            pointer-events: all;
            transform: scale(1)
        }
        ${e} .logo:hover { 
            transition: none !important; 
        }
    }
    `,n}async function jq(){try{const n="https://needle-engine-analytics-v2-r26roub2hq-lz.a.run.app";if(n){Ho&&console.log("Analytics backend url",n);const e=window.location.href;let t="api/v2/new/request";n.endsWith("/")||(t="/"+t);const s=`${n}${t}?license=${vu}&url=${encodeURIComponent(e)}&hostname=${encodeURIComponent(window.location.hostname)}&pathname=${encodeURIComponent(window.location.pathname)}&search=${encodeURIComponent(window.location.search)}&hash=${encodeURIComponent(window.location.hash)}&version=${Ml}&generator=${XM}`;Ho&&console.log("Sending non-commercial usage message to analytics backend",s),fetch(s,{mode:"no-cors"}).catch(r=>{Ho&&console.log("Failed to send non-commercial usage message to analytics backend",r)})}}catch(n){Ho&&console.log("Failed to send non-commercial usage message to analytics backend",n)}}const jh=re("debugloading"),Wp=re("debugloadingrendering"),aB=re("debuglicense");let jp=0,lB;function PF(n){jh&&console.log(n.progress.loaded.toFixed(0)+"/"+n.progress.total.toFixed(0),n);const e=n.count,t=n.progress.total;t===0||t===void 0?(lB!==n.name&&(jp=0),lB=n.name,jp+=(1-jp)*.001,jh&&Rs("Loading "+n.name+" did not report total size")):jp=n.progress.loaded/t;const i=n.index/e+jp/e;return tt.clamp01(i)}const rb=class{constructor(e,t){h(this,"loadingProgress",0);h(this,"_element");h(this,"_progress",0);h(this,"_allowCustomLoadingElement",!0);h(this,"_loadingElement");h(this,"_loadingTextContainer",null);h(this,"_loadingBar",null);h(this,"_messageContainer",null);h(this,"_loadingElementOptions");h(this,"_progressLoop");this._element=e,this._loadingElementOptions=t}async onLoadingBegin(e){const t=this._element.shadowRoot||this._element;if(jh&&console.warn("Begin Loading"),!this._loadingElement){for(let i=0;i<t.children.length;i++){const s=t.children[i];if(s.classList.contains(rb.LoadingContainerClassName)){if(!this._allowCustomLoadingElement){jh&&console.warn("Remove custom loading container"),t.removeChild(s);continue}this._loadingElement=this.createLoadingElement(s)}}this._loadingElement||(this._loadingElement=this.createLoadingElement())}this._progress=0,this.loadingProgress=0,this._loadingElement.style.display="flex",t.appendChild(this._loadingElement),this.smoothProgressLoop(),this.setMessage(e??"")}onLoadingUpdate(e,t){var s;if(!((s=this._loadingElement)!=null&&s.parentNode))return;let i=0;typeof e=="number"?i=e:("index"in e&&(i=PF(e)),!t&&"name"in e&&this.setMessage("loading "+e.name)),this.loadingProgress=i,t&&this.setMessage(t),this.updateDisplay()}onLoadingFinished(){jh&&console.warn("Finished Loading"),Wp||(this.loadingProgress=1,this.onDoneLoading())}setMessage(e){this._messageContainer&&(this._messageContainer.innerText=e)}smoothProgressLoop(){if(this._progressLoop)return;let e=1/12;Wp&&(e=1/500,typeof Wp=="number"&&(e*=Wp)),this._progressLoop=setInterval(()=>{this.loadingProgress>=.95&&!Wp&&(e=.9),this._progress=tt.lerp(this._progress,this.loadingProgress,e*this.loadingProgress),this.updateDisplay()},e)}onDoneLoading(){this._loadingElement&&(jh&&console.log("Hiding loading element"),this._loadingElement.style.display="none",this._loadingElement.remove()),this._progressLoop&&clearInterval(this._progressLoop),this._progressLoop=null}updateDisplay(){const e=this._progress,t=(e*100).toFixed(0)+"%";this._loadingBar&&(this._loadingBar.style.width=e*100+"%"),this._loadingTextContainer&&(this._loadingTextContainer.textContent=t)}createLoadingElement(e){var f,p;jh&&!e&&console.log("Creating loading element"),this._loadingElement=e||document.createElement("div");let t=this._element.getAttribute("loading-style");t==="auto"&&(window.matchMedia("(prefers-color-scheme: dark)").matches?t="dark":t="light");const i=Fg();if(!e&&(this._loadingElement.style.position="absolute",this._loadingElement.style.width="100%",this._loadingElement.style.height="100%",this._loadingElement.style.left="0",this._loadingElement.style.top="0",t==="light"?this._loadingElement.style.backgroundColor="#ddd":this._loadingElement.style.backgroundColor="#222",this._loadingElement.style.display="flex",this._loadingElement.style.alignItems="center",this._loadingElement.style.justifyContent="center",this._loadingElement.style.zIndex=Number.MAX_SAFE_INTEGER.toString(),this._loadingElement.style.flexDirection="column",this._loadingElement.style.pointerEvents="none",this._loadingElement.style.color="white",t==="light"?this._loadingElement.style.color="rgba(0,0,0,.8)":this._loadingElement.style.color="rgba(255,255,255,.5)",i&&this._element)){const g=this._element.getAttribute("loading-background-color");g&&(this._loadingElement.style.backgroundColor=g);const A=this._element.getAttribute("loading-text-color");A&&(this._loadingElement.style.color=A)}const s=((f=this._loadingElementOptions)==null?void 0:f.className)??rb.LoadingContainerClassName;if(this._loadingElement.classList.add(s),(p=this._loadingElementOptions)!=null&&p.additionalClasses)for(const g of this._loadingElementOptions.additionalClasses)this._loadingElement.classList.add(g);const r=document.createElement("div"),o=30;r.style.display="flex",r.style.width=o+"%",r.style.height="2px",t==="light"?r.style.backgroundColor="rgba(0,0,0,.2)":r.style.backgroundColor="rgba(255,255,255,.2)";const a=document.createElement("img"),l=64;a.style.width=`${l}px`,a.style.height=`${l}px`,a.style.marginBottom="20px",a.style.userSelect="none",a.style.objectFit="contain",a.src=Fy;let c=!1;if(i&&this._element){const g=this._element.getAttribute("loading-logo-src");g&&(c=!0,a.src=g)}c||(a.style.cursor="pointer",a.style.pointerEvents="all",a.addEventListener("click",()=>window.open("https://needle.tools","_blank"))),this._loadingElement.appendChild(a),this._loadingElement.appendChild(r),this._loadingBar=document.createElement("div"),r.appendChild(this._loadingBar);const u=function(g){return tt.lerp(o*.5,100-o*.5,g)+"%"};if(this._loadingBar.style.background=`linear-gradient(90deg, #02022B ${u(0)}, #0BA398 ${u(.4)}, #99CC33 ${u(.5)}, #D7DB0A ${u(1)})`,this._loadingBar.style.backgroundAttachment="fixed",this._loadingBar.style.width="0%",this._loadingBar.style.height="100%",i&&this._element){const g=this._element.getAttribute("primary-color"),A=this._element.getAttribute("secondary-color");g&&A?this._loadingBar.style.background=`linear-gradient(90deg, ${g} ${u(0)}, ${A} ${u(1)})`:g?this._loadingBar.style.background=g:A&&(this._loadingBar.style.background=A)}this._loadingTextContainer=document.createElement("div"),this._loadingTextContainer.style.display="flex",this._loadingTextContainer.style.justifyContent="center",this._loadingTextContainer.style.marginTop="1.2em",this._loadingElement.appendChild(this._loadingTextContainer);const d=document.createElement("div");if(this._messageContainer=d,d.style.display="flex",d.style.fontSize=".8em",d.style.paddingTop=".5em",d.style.fontWeight="200",d.style.fontFamily="Roboto, sans-serif, Arial",d.style.justifyContent="center",this._loadingElement.appendChild(d),i&&this._element){const g=this._element.getAttribute("loading-text-color");g&&(d.style.color=g)}return this.handleRuntimeLicense(this._loadingElement),this._loadingElement}async handleRuntimeLicense(e){let t=Nf();if(t||(Gc&&(aB&&console.log("Waiting for runtime license check"),await Gc,t=Nf()),t))return;aB&&console.log("Loading UI has commercial license?",t);const i=document.createElement("div");i.style.paddingTop=".6em",i.style.fontSize=".8em",i.innerText="NON COMMERCIAL",e.appendChild(i)}};let Uy=rb;h(Uy,"LoadingContainerClassName","loading");const bw=new WeakMap;class fT extends ds{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,i,s){const r=new Dn(this.manager);r.setPath(this.path),r.setResponseType("arraybuffer"),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,o=>{this.parse(o,t,s)},i,s)}parse(e,t,i){this.decodeDracoFile(e,t,null,null,Je).catch(i)}decodeDracoFile(e,t,i,s,r=gn){const o={attributeIDs:i||this.defaultAttributeIDs,attributeTypes:s||this.defaultAttributeTypes,useUniqueIDs:!!i,vertexColorSpace:r};return this.decodeGeometry(e,o).then(t)}decodeGeometry(e,t){const i=JSON.stringify(t);if(bw.has(e)){const l=bw.get(e);if(l.key===i)return l.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let s;const r=this.workerNextTaskID++,o=e.byteLength,a=this._getWorker(r,o).then(l=>(s=l,new Promise((c,u)=>{s._callbacks[r]={resolve:c,reject:u},s.postMessage({type:"decode",id:r,taskConfig:t,buffer:e},[e])}))).then(l=>this._createGeometry(l.geometry));return a.catch(()=>!0).then(()=>{s&&r&&this._releaseTask(s,r)}),bw.set(e,{key:i,promise:a}),a}_createGeometry(e){const t=new ft;e.index&&t.setIndex(new ot(e.index.array,1));for(let i=0;i<e.attributes.length;i++){const s=e.attributes[i],r=s.name,o=s.array,a=s.itemSize,l=new ot(o,a);r==="color"&&(this._assignVertexColorSpace(l,s.vertexColorSpace),l.normalized=!(o instanceof Float32Array)),t.setAttribute(r,l)}return t}_assignVertexColorSpace(e,t){if(t!==Je)return;const i=new _e;for(let s=0,r=e.count;s<r;s++)i.fromBufferAttribute(e,s).convertSRGBToLinear(),e.setXYZ(s,i.r,i.g,i.b)}_loadLibrary(e,t){const i=new Dn(this.manager);return i.setPath(this.decoderPath),i.setResponseType(t),i.setWithCredentials(this.withCredentials),new Promise((s,r)=>{i.load(e,s,void 0,r)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(i=>{const s=i[0];e||(this.decoderConfig.wasmBinary=i[1]);const r=qq.toString(),o=["/* draco decoder */",s,"","/* worker */",r.substring(r.indexOf("{")+1,r.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([o]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const s=new Worker(this.workerSourceURL);s._callbacks={},s._taskCosts={},s._taskLoad=0,s.postMessage({type:"init",decoderConfig:this.decoderConfig}),s.onmessage=function(r){const o=r.data;switch(o.type){case"decode":s._callbacks[o.id].resolve(o);break;case"error":s._callbacks[o.id].reject(o);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+o.type+'"')}},this.workerPool.push(s)}else this.workerPool.sort(function(s,r){return s._taskLoad>r._taskLoad?-1:1});const i=this.workerPool[this.workerPool.length-1];return i._taskCosts[e]=t,i._taskLoad+=t,i})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}function qq(){let n,e;onmessage=function(o){const a=o.data;switch(a.type){case"init":n=a.decoderConfig,e=new Promise(function(u){n.onModuleLoaded=function(d){u({draco:d})},DracoDecoderModule(n)});break;case"decode":const l=a.buffer,c=a.taskConfig;e.then(u=>{const d=u.draco,f=new d.Decoder;try{const p=t(d,f,new Int8Array(l),c),g=p.attributes.map(A=>A.array.buffer);p.index&&g.push(p.index.array.buffer),self.postMessage({type:"decode",id:a.id,geometry:p},g)}catch(p){console.error(p),self.postMessage({type:"error",id:a.id,error:p.message})}finally{d.destroy(f)}});break}};function t(o,a,l,c){const u=c.attributeIDs,d=c.attributeTypes;let f,p;const g=a.GetEncodedGeometryType(l);if(g===o.TRIANGULAR_MESH)f=new o.Mesh,p=a.DecodeArrayToMesh(l,l.byteLength,f);else if(g===o.POINT_CLOUD)f=new o.PointCloud,p=a.DecodeArrayToPointCloud(l,l.byteLength,f);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!p.ok()||f.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+p.error_msg());const A={index:null,attributes:[]};for(const v in u){const m=self[d[v]];let b,y;if(c.useUniqueIDs)y=u[v],b=a.GetAttributeByUniqueId(f,y);else{if(y=a.GetAttributeId(f,o[u[v]]),y===-1)continue;b=a.GetAttribute(f,y)}const _=s(o,a,f,v,m,b);v==="color"&&(_.vertexColorSpace=c.vertexColorSpace),A.attributes.push(_)}return g===o.TRIANGULAR_MESH&&(A.index=i(o,a,f)),o.destroy(f),A}function i(o,a,l){const u=l.num_faces()*3,d=u*4,f=o._malloc(d);a.GetTrianglesUInt32Array(l,d,f);const p=new Uint32Array(o.HEAPF32.buffer,f,u).slice();return o._free(f),{array:p,itemSize:1}}function s(o,a,l,c,u,d){const f=d.num_components(),g=l.num_points()*f,A=g*u.BYTES_PER_ELEMENT,v=r(o,u),m=o._malloc(A);a.GetAttributeDataArrayForAllPoints(l,d,v,A,m);const b=new u(o.HEAPF32.buffer,m,g).slice();return o._free(m),{name:c,array:b,itemSize:f}}function r(o,a){switch(a){case Float32Array:return o.DT_FLOAT32;case Int8Array:return o.DT_INT8;case Int16Array:return o.DT_INT16;case Int32Array:return o.DT_INT32;case Uint8Array:return o.DT_UINT8;case Uint16Array:return o.DT_UINT16;case Uint32Array:return o.DT_UINT32}}}class Xq{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){const t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,t){const i=this.workersResolve[e];if(i&&i(t),this.queue.length){const{resolve:s,msg:r,transfer:o}=this.queue.shift();this.workersResolve[e]=s,this.workers[e].postMessage(r,o)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,t){return new Promise(i=>{const s=this._getIdleWorker();s!==-1?(this._initWorker(s),this.workerStatus|=1<<s,this.workersResolve[s]=i,this.workers[s].postMessage(e,t)):this.queue.push({resolve:i,msg:e,transfer:t})})}dispose(){this.workers.forEach(e=>e.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}const Yq=0,Jq=2,Kq=1,Zq=2,$q=0,BF=9,pT=15,DF=16,gT=22,OF=37,mT=43,kF=76,LF=83,FF=97,UF=100,NF=103,zF=109;class eX{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class qp{constructor(e,t,i,s){this._dataView=new DataView(e.buffer,e.byteOffset+t,i),this._littleEndian=s,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+4294967296*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_skip(e){return this._offset+=e,this}_scan(e,t=0){const i=this._offset;let s=0;for(;this._dataView.getUint8(this._offset)!==t&&s<e;)s++,this._offset++;return s<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+i,s)}}const Fs=[171,75,84,88,32,50,48,187,13,10,26,10];function cB(n){return typeof TextDecoder<"u"?new TextDecoder().decode(n):Buffer.from(n).toString("utf8")}function tX(n){const e=new Uint8Array(n.buffer,n.byteOffset,Fs.length);if(e[0]!==Fs[0]||e[1]!==Fs[1]||e[2]!==Fs[2]||e[3]!==Fs[3]||e[4]!==Fs[4]||e[5]!==Fs[5]||e[6]!==Fs[6]||e[7]!==Fs[7]||e[8]!==Fs[8]||e[9]!==Fs[9]||e[10]!==Fs[10]||e[11]!==Fs[11])throw new Error("Missing KTX 2.0 identifier.");const t=new eX,i=17*Uint32Array.BYTES_PER_ELEMENT,s=new qp(n,Fs.length,i,!0);t.vkFormat=s._nextUint32(),t.typeSize=s._nextUint32(),t.pixelWidth=s._nextUint32(),t.pixelHeight=s._nextUint32(),t.pixelDepth=s._nextUint32(),t.layerCount=s._nextUint32(),t.faceCount=s._nextUint32();const r=s._nextUint32();t.supercompressionScheme=s._nextUint32();const o=s._nextUint32(),a=s._nextUint32(),l=s._nextUint32(),c=s._nextUint32(),u=s._nextUint64(),d=s._nextUint64(),f=new qp(n,Fs.length+i,3*r*8,!0);for(let L=0;L<r;L++)t.levels.push({levelData:new Uint8Array(n.buffer,n.byteOffset+f._nextUint64(),f._nextUint64()),uncompressedByteLength:f._nextUint64()});const p=new qp(n,o,a,!0),g={vendorId:p._skip(4)._nextUint16(),descriptorType:p._nextUint16(),versionNumber:p._nextUint16(),descriptorBlockSize:p._nextUint16(),colorModel:p._nextUint8(),colorPrimaries:p._nextUint8(),transferFunction:p._nextUint8(),flags:p._nextUint8(),texelBlockDimension:[p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8()],bytesPlane:[p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8()],samples:[]},A=(g.descriptorBlockSize/4-6)/4;for(let L=0;L<A;L++){const G={bitOffset:p._nextUint16(),bitLength:p._nextUint8(),channelType:p._nextUint8(),samplePosition:[p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&G.channelType?(G.sampleLower=p._nextInt32(),G.sampleUpper=p._nextInt32()):(G.sampleLower=p._nextUint32(),G.sampleUpper=p._nextUint32()),g.samples[L]=G}t.dataFormatDescriptor.length=0,t.dataFormatDescriptor.push(g);const v=new qp(n,l,c,!0);for(;v._offset<c;){const L=v._nextUint32(),G=v._scan(L),ee=cB(G),$=v._scan(L-G.byteLength);t.keyValue[ee]=ee.match(/^ktx/i)?cB($):$,v._offset%4&&v._skip(4-v._offset%4)}if(d<=0)return t;const m=new qp(n,u,d,!0),b=m._nextUint16(),y=m._nextUint16(),_=m._nextUint32(),E=m._nextUint32(),M=m._nextUint32(),I=m._nextUint32(),R=[];for(let L=0;L<r;L++)R.push({imageFlags:m._nextUint32(),rgbSliceByteOffset:m._nextUint32(),rgbSliceByteLength:m._nextUint32(),alphaSliceByteOffset:m._nextUint32(),alphaSliceByteLength:m._nextUint32()});const C=u+m._offset,T=C+_,O=T+E,J=O+M,V=new Uint8Array(n.buffer,n.byteOffset+C,_),H=new Uint8Array(n.buffer,n.byteOffset+T,E),Y=new Uint8Array(n.buffer,n.byteOffset+O,M),N=new Uint8Array(n.buffer,n.byteOffset+J,I);return t.globalData={endpointCount:b,selectorCount:y,imageDescs:R,endpointsData:V,selectorsData:H,tablesData:Y,extendedData:N},t}let _w,hl,YC;const xw={env:{emscripten_notify_memory_growth:function(n){YC=new Uint8Array(hl.exports.memory.buffer)}}};class iX{init(){return _w||(_w=typeof fetch<"u"?fetch("data:application/wasm;base64,"+hB).then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,xw)).then(this._init):WebAssembly.instantiate(Buffer.from(hB,"base64"),xw).then(this._init),_w)}_init(e){hl=e.instance,xw.env.emscripten_notify_memory_growth(0)}decode(e,t=0){if(!hl)throw new Error("ZSTDDecoder: Await .init() before decoding.");const i=e.byteLength,s=hl.exports.malloc(i);YC.set(e,s),t=t||Number(hl.exports.ZSTD_findDecompressedSize(s,i));const r=hl.exports.malloc(t),o=hl.exports.ZSTD_decompress(r,t,s,i),a=YC.slice(r,r+o);return hl.exports.free(s),hl.exports.free(r),a}}const hB="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IAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQh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ASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigCACACaiAAQQZ2IgFBAnRBsB5qKAIAaiAAQSBxIgBFaiABRSAAQQV2cWoFQbh/CwsdACAAKAKQ4gEQWiAAQQA2AqDiASAAQgA3A5DiAQu1AwEFfyMAQZACayIKJABBuH8hBgJAIAVFDQAgBCwAACIIQf8BcSEHAkAgCEF/TARAIAdBgn9qQQF2IgggBU8NAkFsIQYgB0GBf2oiBUGAAk8NAiAEQQFqIQdBACEGA0AgBiAFTwRAIAUhBiAIIQcMAwUgACAGaiAHIAZBAXZqIgQtAABBBHY6AAAgACAGQQFyaiAELQAAQQ9xOgAAIAZBAmohBgwBCwAACwALIAcgBU8NASAAIARBAWogByAKEFMiBhADDQELIAYhBEEAIQYgAUEAQTQQECEJQQAhBQNAIAQgBkcEQCAAIAZqIggtAAAiAUELSwRAQWwhBgwDBSAJIAFBAnRqIgEgASgCAEEBajYCACAGQQFqIQZBASAILQAAdEEBdSAFaiEFDAILAAsLQWwhBiAFRQ0AIAUQFEEBaiIBQQxLDQAgAyABNgIAQQFBASABdCAFayIDEBQiAXQgA0cNACAAIARqIAFBAWoiADoAACAJIABBAnRqIgAgACgCAEEBajYCACAJKAIEIgBBAkkgAEEBcXINACACIARBAWo2AgAgB0EBaiEGCyAKQZACaiQAIAYLxhEBDH8jAEHwAGsiBSQAQWwhCwJAIANBCkkNACACLwAAIQogAi8AAiEJIAIvAAQhByAFQQhqIAQQDgJAIAMgByAJIApqakEGaiIMSQ0AIAUtAAohCCAFQdgAaiACQQZqIgIgChAGIgsQAw0BIAVBQGsgAiAKaiICIAkQBiILEAMNASAFQShqIAIgCWoiAiAHEAYiCxADDQEgBUEQaiACIAdqIAMgDGsQBiILEAMNASAAIAFqIg9BfWohECAEQQRqIQZBASELIAAgAUEDakECdiIDaiIMIANqIgIgA2oiDiEDIAIhBCAMIQcDQCALIAMgEElxBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgCS0AAyELIAcgBiAFQUBrIAgQAkECdGoiCS8BADsAACAFQUBrIAktAAIQASAJLQADIQogBCAGIAVBKGogCBACQQJ0aiIJLwEAOwAAIAVBKGogCS0AAhABIAktAAMhCSADIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgDS0AAyENIAAgC2oiCyAGIAVB2ABqIAgQAkECdGoiAC8BADsAACAFQdgAaiAALQACEAEgAC0AAyEAIAcgCmoiCiAGIAVBQGsgCBACQQJ0aiIHLwEAOwAAIAVBQGsgBy0AAhABIActAAMhByAEIAlqIgkgBiAFQShqIAgQAkECdGoiBC8BADsAACAFQShqIAQtAAIQASAELQADIQQgAyANaiIDIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgACALaiEAIAcgCmohByAEIAlqIQQgAyANLQADaiEDIAVB2ABqEA0gBUFAaxANciAFQShqEA1yIAVBEGoQDXJFIQsMAQsLIAQgDksgByACS3INAEFsIQsgACAMSw0BIAxBfWohCQNAQQAgACAJSSAFQdgAahAEGwRAIAAgBiAFQdgAaiAIEAJBAnRqIgovAQA7AAAgBUHYAGogCi0AAhABIAAgCi0AA2oiACAGIAVB2ABqIAgQAkECdGoiCi8BADsAACAFQdgAaiAKLQACEAEgACAKLQADaiEADAEFIAxBfmohCgNAIAVB2ABqEAQgACAKS3JFBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgACAJLQADaiEADAELCwNAIAAgCk0EQCAAIAYgBUHYAGogCBACQQJ0aiIJLwEAOwAAIAVB2ABqIAktAAIQASAAIAktAANqIQAMAQsLAkAgACAMTw0AIAAgBiAFQdgAaiAIEAIiAEECdGoiDC0AADoAACAMLQADQQFGBEAgBUHYAGogDC0AAhABDAELIAUoAlxBH0sNACAFQdgAaiAGIABBAnRqLQACEAEgBSgCXEEhSQ0AIAVBIDYCXAsgAkF9aiEMA0BBACAHIAxJIAVBQGsQBBsEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiIAIAYgBUFAayAIEAJBAnRqIgcvAQA7AAAgBUFAayAHLQACEAEgACAHLQADaiEHDAEFIAJBfmohDANAIAVBQGsQBCAHIAxLckUEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwNAIAcgDE0EQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwJAIAcgAk8NACAHIAYgBUFAayAIEAIiAEECdGoiAi0AADoAACACLQADQQFGBEAgBUFAayACLQACEAEMAQsgBSgCREEfSw0AIAVBQGsgBiAAQQJ0ai0AAhABIAUoAkRBIUkNACAFQSA2AkQLIA5BfWohAgNAQQAgBCACSSAFQShqEAQbBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2oiACAGIAVBKGogCBACQQJ0aiIELwEAOwAAIAVBKGogBC0AAhABIAAgBC0AA2ohBAwBBSAOQX5qIQIDQCAFQShqEAQgBCACS3JFBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsDQCAEIAJNBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsCQCAEIA5PDQAgBCAGIAVBKGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBKGogAi0AAhABDAELIAUoAixBH0sNACAFQShqIAYgAEECdGotAAIQASAFKAIsQSFJDQAgBUEgNgIsCwNAQQAgAyAQSSAFQRBqEAQbBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2oiACAGIAVBEGogCBACQQJ0aiICLwEAOwAAIAVBEGogAi0AAhABIAAgAi0AA2ohAwwBBSAPQX5qIQIDQCAFQRBqEAQgAyACS3JFBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsDQCADIAJNBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsCQCADIA9PDQAgAyAGIAVBEGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBEGogAi0AAhABDAELIAUoAhRBH0sNACAFQRBqIAYgAEECdGotAAIQASAFKAIUQSFJDQAgBUEgNgIUCyABQWwgBUHYAGoQCiAFQUBrEApxIAVBKGoQCnEgBUEQahAKcRshCwwJCwAACwALAAALAAsAAAsACwAACwALQWwhCwsgBUHwAGokACALC7UEAQ5/IwBBEGsiBiQAIAZBBGogABAOQVQhBQJAIARB3AtJDQAgBi0ABCEHIANB8ARqQQBB7AAQECEIIAdBDEsNACADQdwJaiIJIAggBkEIaiAGQQxqIAEgAhAxIhAQA0UEQCAGKAIMIgQgB0sNASADQdwFaiEPIANBpAVqIREgAEEEaiESIANBqAVqIQEgBCEFA0AgBSICQX9qIQUgCCACQQJ0aigCAEUNAAsgAkEBaiEOQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgASALaiAKNgIAIAVBAWohBSAKIAxqIQoMAQsLIAEgCjYCAEEAIQUgBigCCCELA0AgBSALRkUEQCABIAUgCWotAAAiDEECdGoiDSANKAIAIg1BAWo2AgAgDyANQQF0aiINIAw6AAEgDSAFOgAAIAVBAWohBQwBCwtBACEBIANBADYCqAUgBEF/cyAHaiEJQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgAyALaiABNgIAIAwgBSAJanQgAWohASAFQQFqIQUMAQsLIAcgBEEBaiIBIAJrIgRrQQFqIQgDQEEBIQUgBCAIT0UEQANAIAUgDk9FBEAgBUECdCIJIAMgBEE0bGpqIAMgCWooAgAgBHY2AgAgBUEBaiEFDAELCyAEQQFqIQQMAQsLIBIgByAPIAogESADIAIgARBkIAZBAToABSAGIAc6AAYgACAGKAIENgIACyAQIQULIAZBEGokACAFC8ENAQt/IwBB8ABrIgUkAEFsIQkCQCADQQpJDQAgAi8AACEKIAIvAAIhDCACLwAEIQYgBUEIaiAEEA4CQCADIAYgCiAMampBBmoiDUkNACAFLQAKIQcgBUHYAGogAkEGaiICIAoQBiIJEAMNASAFQUBrIAIgCmoiAiAMEAYiCRADDQEgBUEoaiACIAxqIgIgBhAGIgkQAw0BIAVBEGogAiAGaiADIA1rEAYiCRADDQEgACABaiIOQX1qIQ8gBEEEaiEGQQEhCSAAIAFBA2pBAnYiAmoiCiACaiIMIAJqIg0hAyAMIQQgCiECA0AgCSADIA9JcQRAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAACAGIAVBQGsgBxACQQF0aiIILQAAIQsgBUFAayAILQABEAEgAiALOgAAIAYgBUEoaiAHEAJBAXRqIggtAAAhCyAFQShqIAgtAAEQASAEIAs6AAAgBiAFQRBqIAcQAkEBdGoiCC0AACELIAVBEGogCC0AARABIAMgCzoAACAGIAVB2ABqIAcQAkEBdGoiCC0AACELIAVB2ABqIAgtAAEQASAAIAs6AAEgBiAFQUBrIAcQAkEBdGoiCC0AACELIAVBQGsgCC0AARABIAIgCzoAASAGIAVBKGogBxACQQF0aiIILQAAIQsgBUEoaiAILQABEAEgBCALOgABIAYgBUEQaiAHEAJBAXRqIggtAAAhCyAFQRBqIAgtAAEQASADIAs6AAEgA0ECaiEDIARBAmohBCACQQJqIQIgAEECaiEAIAkgBUHYAGoQDUVxIAVBQGsQDUVxIAVBKGoQDUVxIAVBEGoQDUVxIQkMAQsLIAQgDUsgAiAMS3INAEFsIQkgACAKSw0BIApBfWohCQNAIAVB2ABqEAQgACAJT3JFBEAgBiAFQdgAaiAHEAJBAXRqIggtAAAhCyAFQdgAaiAILQABEAEgACALOgAAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAASAAQQJqIQAMAQsLA0AgBUHYAGoQBCAAIApPckUEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCwNAIAAgCkkEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCyAMQX1qIQADQCAFQUBrEAQgAiAAT3JFBEAgBiAFQUBrIAcQAkEBdGoiCi0AACEJIAVBQGsgCi0AARABIAIgCToAACAGIAVBQGsgBxACQQF0aiIKLQAAIQkgBUFAayAKLQABEAEgAiAJOgABIAJBAmohAgwBCwsDQCAFQUBrEAQgAiAMT3JFBEAgBiAFQUBrIAcQAkEBdGoiAC0AACEKIAVBQGsgAC0AARABIAIgCjoAACACQQFqIQIMAQsLA0AgAiAMSQRAIAYgBUFAayAHEAJBAXRqIgAtAAAhCiAFQUBrIAAtAAEQASACIAo6AAAgAkEBaiECDAELCyANQX1qIQADQCAFQShqEAQgBCAAT3JFBEAgBiAFQShqIAcQAkEBdGoiAi0AACEKIAVBKGogAi0AARABIAQgCjoAACAGIAVBKGogBxACQQF0aiICLQAAIQogBUEoaiACLQABEAEgBCAKOgABIARBAmohBAwBCwsDQCAFQShqEAQgBCANT3JFBEAgBiAFQShqIAcQAkEBdGoiAC0AACECIAVBKGogAC0AARABIAQgAjoAACAEQQFqIQQMAQsLA0AgBCANSQRAIAYgBUEoaiAHEAJBAXRqIgAtAAAhAiAFQShqIAAtAAEQASAEIAI6AAAgBEEBaiEEDAELCwNAIAVBEGoQBCADIA9PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIAYgBUEQaiAHEAJBAXRqIgAtAAAhAiAFQRBqIAAtAAEQASADIAI6AAEgA0ECaiEDDAELCwNAIAVBEGoQBCADIA5PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIANBAWohAwwBCwsDQCADIA5JBEAgBiAFQRBqIAcQAkEBdGoiAC0AACECIAVBEGogAC0AARABIAMgAjoAACADQQFqIQMMAQsLIAFBbCAFQdgAahAKIAVBQGsQCnEgBUEoahAKcSAFQRBqEApxGyEJDAELQWwhCQsgBUHwAGokACAJC8oCAQR/IwBBIGsiBSQAIAUgBBAOIAUtAAIhByAFQQhqIAIgAxAGIgIQA0UEQCAEQQRqIQIgACABaiIDQX1qIQQDQCAFQQhqEAQgACAET3JFBEAgAiAFQQhqIAcQAkEBdGoiBi0AACEIIAVBCGogBi0AARABIAAgCDoAACACIAVBCGogBxACQQF0aiIGLQAAIQggBUEIaiAGLQABEAEgACAIOgABIABBAmohAAwBCwsDQCAFQQhqEAQgACADT3JFBEAgAiAFQQhqIAcQAkEBdGoiBC0AACEGIAVBCGogBC0AARABIAAgBjoAACAAQQFqIQAMAQsLA0AgACADT0UEQCACIAVBCGogBxACQQF0aiIELQAAIQYgBUEIaiAELQABEAEgACAGOgAAIABBAWohAAwBCwsgAUFsIAVBCGoQChshAgsgBUEgaiQAIAILtgMBCX8jAEEQayIGJAAgBkEANgIMIAZBADYCCEFUIQQCQAJAIANBQGsiDCADIAZBCGogBkEMaiABIAIQMSICEAMNACAGQQRqIAAQDiAGKAIMIgcgBi0ABEEBaksNASAAQQRqIQogBkEAOgAFIAYgBzoABiAAIAYoAgQ2AgAgB0EBaiEJQQEhBANAIAQgCUkEQCADIARBAnRqIgEoAgAhACABIAU2AgAgACAEQX9qdCAFaiEFIARBAWohBAwBCwsgB0EBaiEHQQAhBSAGKAIIIQkDQCAFIAlGDQEgAyAFIAxqLQAAIgRBAnRqIgBBASAEdEEBdSILIAAoAgAiAWoiADYCACAHIARrIQhBACEEAkAgC0EDTQRAA0AgBCALRg0CIAogASAEakEBdGoiACAIOgABIAAgBToAACAEQQFqIQQMAAALAAsDQCABIABPDQEgCiABQQF0aiIEIAg6AAEgBCAFOgAAIAQgCDoAAyAEIAU6AAIgBCAIOgAFIAQgBToABCAEIAg6AAcgBCAFOgAGIAFBBGohAQwAAAsACyAFQQFqIQUMAAALAAsgAiEECyAGQRBqJAAgBAutAQECfwJAQYQgKAIAIABHIAAoAgBBAXYiAyABa0F4aiICQXhxQQhHcgR/IAIFIAMQJ0UNASACQQhqC0EQSQ0AIAAgACgCACICQQFxIAAgAWpBD2pBeHEiASAAa0EBdHI2AgAgASAANgIEIAEgASgCAEEBcSAAIAJBAXZqIAFrIgJBAXRyNgIAQYQgIAEgAkH/////B3FqQQRqQYQgKAIAIABGGyABNgIAIAEQJQsLygIBBX8CQAJAAkAgAEEIIABBCEsbZ0EfcyAAaUEBR2oiAUEESSAAIAF2cg0AIAFBAnRB/B5qKAIAIgJFDQADQCACQXhqIgMoAgBBAXZBeGoiBSAATwRAIAIgBUEIIAVBCEsbZ0Efc0ECdEGAH2oiASgCAEYEQCABIAIoAgQ2AgALDAMLIARBHksNASAEQQFqIQQgAigCBCICDQALC0EAIQMgAUEgTw0BA0AgAUECdEGAH2ooAgAiAkUEQCABQR5LIQIgAUEBaiEBIAJFDQEMAwsLIAIgAkF4aiIDKAIAQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgBGBEAgASACKAIENgIACwsgAigCACIBBEAgASACKAIENgIECyACKAIEIgEEQCABIAIoAgA2AgALIAMgAygCAEEBcjYCACADIAAQNwsgAwvhCwINfwV+IwBB8ABrIgckACAHIAAoAvDhASIINgJcIAEgAmohDSAIIAAoAoDiAWohDwJAAkAgBUUEQCABIQQMAQsgACgCxOABIRAgACgCwOABIREgACgCvOABIQ4gAEEBNgKM4QFBACEIA0AgCEEDRwRAIAcgCEECdCICaiAAIAJqQazQAWooAgA2AkQgCEEBaiEIDAELC0FsIQwgB0EYaiADIAQQBhADDQEgB0EsaiAHQRhqIAAoAgAQEyAHQTRqIAdBGGogACgCCBATIAdBPGogB0EYaiAAKAIEEBMgDUFgaiESIAEhBEEAIQwDQCAHKAIwIAcoAixBA3RqKQIAIhRCEIinQf8BcSEIIAcoAkAgBygCPEEDdGopAgAiFUIQiKdB/wFxIQsgBygCOCAHKAI0QQN0aikCACIWQiCIpyEJIBVCIIghFyAUQiCIpyECAkAgFkIQiKdB/wFxIgNBAk8EQAJAIAZFIANBGUlyRQRAIAkgB0EYaiADQSAgBygCHGsiCiAKIANLGyIKEAUgAyAKayIDdGohCSAHQRhqEAQaIANFDQEgB0EYaiADEAUgCWohCQwBCyAHQRhqIAMQBSAJaiEJIAdBGGoQBBoLIAcpAkQhGCAHIAk2AkQgByAYNwNIDAELAkAgA0UEQCACBEAgBygCRCEJDAMLIAcoAkghCQwBCwJAAkAgB0EYakEBEAUgCSACRWpqIgNBA0YEQCAHKAJEQX9qIgMgA0VqIQkMAQsgA0ECdCAHaigCRCIJIAlFaiEJIANBAUYNAQsgByAHKAJINgJMCwsgByAHKAJENgJIIAcgCTYCRAsgF6chAyALBEAgB0EYaiALEAUgA2ohAwsgCCALakEUTwRAIAdBGGoQBBoLIAgEQCAHQRhqIAgQBSACaiECCyAHQRhqEAQaIAcgB0EYaiAUQhiIp0H/AXEQCCAUp0H//wNxajYCLCAHIAdBGGogFUIYiKdB/wFxEAggFadB//8DcWo2AjwgB0EYahAEGiAHIAdBGGogFkIYiKdB/wFxEAggFqdB//8DcWo2AjQgByACNgJgIAcoAlwhCiAHIAk2AmggByADNgJkAkACQAJAIAQgAiADaiILaiASSw0AIAIgCmoiEyAPSw0AIA0gBGsgC0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdB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IAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY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wOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEE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",ww=new WeakMap;let Sw=0,Cw;class Qo extends ds{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new Xq,this.workerSourceURL="",this.workerConfig=null,typeof MSC_TRANSCODER<"u"&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}detectSupport(e){return e.isWebGPURenderer===!0?this.workerConfig={astcSupported:e.hasFeature("texture-compression-astc"),etc1Supported:!1,etc2Supported:e.hasFeature("texture-compression-etc2"),dxtSupported:e.hasFeature("texture-compression-bc"),bptcSupported:!1,pvrtcSupported:!1}:(this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},e.capabilities.isWebGL2&&(this.workerConfig.etc1Supported=!1)),this}init(){if(!this.transcoderPending){const e=new Dn(this.manager);e.setPath(this.transcoderPath),e.setWithCredentials(this.withCredentials);const t=e.loadAsync("basis_transcoder.js"),i=new Dn(this.manager);i.setPath(this.transcoderPath),i.setResponseType("arraybuffer"),i.setWithCredentials(this.withCredentials);const s=i.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([t,s]).then(([r,o])=>{const a=Qo.BasisWorker.toString(),l=["/* constants */","let _EngineFormat = "+JSON.stringify(Qo.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(Qo.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(Qo.BasisFormat),"/* basis_transcoder.js */",r,"/* worker */",a.substring(a.indexOf("{")+1,a.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([l])),this.transcoderBinary=o,this.workerPool.setWorkerCreator(()=>{const c=new Worker(this.workerSourceURL),u=this.transcoderBinary.slice(0);return c.postMessage({type:"init",config:this.workerConfig,transcoderBinary:u},[u]),c})}),Sw>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),Sw++}return this.transcoderPending}load(e,t,i,s){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const r=new Dn(this.manager);r.setResponseType("arraybuffer"),r.setWithCredentials(this.withCredentials),r.load(e,o=>{if(ww.has(o))return ww.get(o).promise.then(t).catch(s);this._createTexture(o).then(a=>t?t(a):null).catch(s)},i,s)}_createTextureFrom(e,t){const{faces:i,width:s,height:r,format:o,type:a,error:l,dfdTransferFn:c,dfdFlags:u}=e;if(a==="error")return Promise.reject(l);let d;if(t.faceCount===6)d=new Ol,d.image=i,d.format=o,d.type=fi;else{const f=i[0].mipmaps;d=t.layerCount>1?new Vk(f,s,r,t.layerCount,o,fi):new Ol(f,s,r,o,fi)}return d.minFilter=i[0].mipmaps.length===1?Dt:yo,d.magFilter=Dt,d.generateMipmaps=!1,d.needsUpdate=!0,d.colorSpace=c===Zq?Je:ur,d.premultiplyAlpha=!!(u&Kq),d}async _createTexture(e,t={}){const i=tX(new Uint8Array(e));if(i.vkFormat!==$q){const o=[],a=[];for(let c=0;c<i.levels.length;c++)a.push(sX(i,c).then(function(u){o[c]=u}));await Promise.all(a);const l=o[0];return l.mipmaps=o.map(c=>({data:c.source.data,width:c.source.data.width,height:c.source.data.height,depth:c.source.data.depth})),l}const s=t,r=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffer:e,taskConfig:s},[e])).then(o=>this._createTextureFrom(o.data,i));return ww.set(e,{promise:r}),r}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),Sw--,this}}Qo.BasisFormat={ETC1S:0,UASTC_4x4:1};Qo.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16};Qo.EngineFormat={RGBAFormat:Ti,RGBA_ASTC_4x4_Format:t0,RGBA_BPTC_Format:wg,RGBA_ETC2_EAC_Format:e0,RGBA_PVRTC_4BPPV1_Format:Zy,RGBA_S3TC_DXT5_Format:xg,RGB_ETC1_Format:XE,RGB_ETC2_Format:$y,RGB_PVRTC_4BPPV1_Format:Ky,RGB_S3TC_DXT1_Format:_g};Qo.BasisWorker=function(){let n,e,t;const i=_EngineFormat,s=_TranscoderFormat,r=_BasisFormat;self.addEventListener("message",function(g){const A=g.data;switch(A.type){case"init":n=A.config,o(A.transcoderBinary);break;case"transcode":e.then(()=>{try{const{faces:v,buffers:m,width:b,height:y,hasAlpha:_,format:E,dfdTransferFn:M,dfdFlags:I}=a(A.buffer);self.postMessage({type:"transcode",id:A.id,faces:v,width:b,height:y,hasAlpha:_,format:E,dfdTransferFn:M,dfdFlags:I},m)}catch(v){console.error(v),self.postMessage({type:"error",id:A.id,error:v.message})}});break}});function o(g){e=new Promise(A=>{t={wasmBinary:g,onRuntimeInitialized:A},BASIS(t)}).then(()=>{t.initializeBasis(),t.KTX2File===void 0&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")})}function a(g){const A=new t.KTX2File(new Uint8Array(g));function v(){A.close(),A.delete()}if(!A.isValid())throw v(),new Error("THREE.KTX2Loader:	Invalid or unsupported .ktx2 file");const m=A.isUASTC()?r.UASTC_4x4:r.ETC1S,b=A.getWidth(),y=A.getHeight(),_=A.getLayers()||1,E=A.getLevels(),M=A.getFaces(),I=A.getHasAlpha(),R=A.getDFDTransferFunc(),C=A.getDFDFlags(),{transcoderFormat:T,engineFormat:O}=d(m,b,y,I);if(!b||!y||!E)throw v(),new Error("THREE.KTX2Loader:	Invalid texture");if(!A.startTranscoding())throw v(),new Error("THREE.KTX2Loader: .startTranscoding failed");const J=[],V=[];for(let H=0;H<M;H++){const Y=[];for(let N=0;N<E;N++){const L=[];let G,ee;for(let j=0;j<_;j++){const ie=A.getImageLevelInfo(N,j,H);H===0&&N===0&&j===0&&(ie.origWidth%4!==0||ie.origHeight%4!==0)&&console.warn("THREE.KTX2Loader: ETC1S and UASTC textures should use multiple-of-four dimensions."),E>1?(G=ie.origWidth,ee=ie.origHeight):(G=ie.width,ee=ie.height);const Ae=new Uint8Array(A.getImageTranscodedSizeInBytes(N,j,0,T));if(!A.transcodeImage(Ae,N,j,H,T,0,-1,-1))throw v(),new Error("THREE.KTX2Loader: .transcodeImage failed.");L.push(Ae)}const $=p(L);Y.push({data:$,width:G,height:ee}),V.push($.buffer)}J.push({mipmaps:Y,width:b,height:y,format:O})}return v(),{faces:J,buffers:V,width:b,height:y,hasAlpha:I,format:O,dfdTransferFn:R,dfdFlags:C}}const l=[{if:"astcSupported",basisFormat:[r.UASTC_4x4],transcoderFormat:[s.ASTC_4x4,s.ASTC_4x4],engineFormat:[i.RGBA_ASTC_4x4_Format,i.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[r.ETC1S,r.UASTC_4x4],transcoderFormat:[s.BC7_M5,s.BC7_M5],engineFormat:[i.RGBA_BPTC_Format,i.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[r.ETC1S,r.UASTC_4x4],transcoderFormat:[s.BC1,s.BC3],engineFormat:[i.RGB_S3TC_DXT1_Format,i.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[r.ETC1S,r.UASTC_4x4],transcoderFormat:[s.ETC1,s.ETC2],engineFormat:[i.RGB_ETC2_Format,i.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[r.ETC1S,r.UASTC_4x4],transcoderFormat:[s.ETC1],engineFormat:[i.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[r.ETC1S,r.UASTC_4x4],transcoderFormat:[s.PVRTC1_4_RGB,s.PVRTC1_4_RGBA],engineFormat:[i.RGB_PVRTC_4BPPV1_Format,i.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],c=l.sort(function(g,A){return g.priorityETC1S-A.priorityETC1S}),u=l.sort(function(g,A){return g.priorityUASTC-A.priorityUASTC});function d(g,A,v,m){let b,y;const _=g===r.ETC1S?c:u;for(let E=0;E<_.length;E++){const M=_[E];if(n[M.if]&&M.basisFormat.includes(g)&&!(m&&M.transcoderFormat.length<2)&&!(M.needsPowerOfTwo&&!(f(A)&&f(v))))return b=M.transcoderFormat[m?1:0],y=M.engineFormat[m?1:0],{transcoderFormat:b,engineFormat:y}}return console.warn("THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32."),b=s.RGBA32,y=i.RGBAFormat,{transcoderFormat:b,engineFormat:y}}function f(g){return g<=2?!0:(g&g-1)===0&&g!==0}function p(g){if(g.length===1)return g[0];let A=0;for(let b=0;b<g.length;b++){const y=g[b];A+=y.byteLength}const v=new Uint8Array(A);let m=0;for(let b=0;b<g.length;b++){const y=g[b];v.set(y,m),m+=y.byteLength}return v}};const uB={[zF]:Ti,[FF]:Ti,[OF]:Ti,[mT]:Ti,[NF]:iu,[LF]:iu,[DF]:iu,[gT]:iu,[UF]:wl,[kF]:wl,[pT]:wl,[BF]:wl},Ew={[zF]:sn,[FF]:xn,[OF]:fi,[mT]:fi,[NF]:sn,[LF]:xn,[DF]:fi,[gT]:fi,[UF]:sn,[kF]:xn,[pT]:fi,[BF]:fi},nX={[mT]:Je,[gT]:Je,[pT]:Je};async function sX(n,e=0){const{vkFormat:t}=n,i=Math.max(1,n.pixelWidth>>e),s=Math.max(1,n.pixelHeight>>e),r=Math.max(1,n.pixelDepth>>e);if(uB[t]===void 0)throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");const o=n.levels[e];let a,l;if(n.supercompressionScheme===Yq)a=o.levelData;else if(n.supercompressionScheme===Jq)Cw||(Cw=new Promise(async u=>{const d=new iX;await d.init(),u(d)})),a=(await Cw).decode(o.levelData,o.uncompressedByteLength);else throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");Ew[t]===sn?l=new Float32Array(a.buffer,a.byteOffset,a.byteLength/Float32Array.BYTES_PER_ELEMENT):Ew[t]===xn?l=new Uint16Array(a.buffer,a.byteOffset,a.byteLength/Uint16Array.BYTES_PER_ELEMENT):l=a;const c=r===0?new Ao(l,i,s):new wb(l,i,s,r);return c.type=Ew[t],c.format=uB[t],c.colorSpace=nX[t]||ur,c.needsUpdate=!0,Promise.resolve(c)}var rX=function(){var n="b9H79Tebbbe8Fv9Gbb9Gvuuuuueu9Giuuub9Geueu9Giuuueuikqbeeedddillviebeoweuec:q;iekr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbeY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVbdE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbiL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtblK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbol79IV9Rbrq:P8Yqdbk;3sezu8Jjjjjbcj;eb9Rgv8Kjjjjbc9:hodnadcefal0mbcuhoaiRbbc:Ge9hmbavaialfgrad9Radz1jjjbhwcj;abad9UhoaicefhldnadTmbaoc;WFbGgocjdaocjd6EhDcbhqinaqae9pmeaDaeaq9RaqaDfae6Egkcsfgocl4cifcd4hxdndndndnaoc9WGgmTmbcbhPcehsawcjdfhzalhHinaraH9Rax6midnaraHaxfgl9RcK6mbczhoinawcj;cbfaogifgoc9WfhOdndndndndnaHaic9WfgAco4fRbbaAci4coG4ciGPlbedibkaO9cb83ibaOcwf9cb83ibxikaOalRblalRbbgAco4gCaCciSgCE86bbaocGfalclfaCfgORbbaAcl4ciGgCaCciSgCE86bbaocVfaOaCfgORbbaAcd4ciGgCaCciSgCE86bbaoc7faOaCfgORbbaAciGgAaAciSgAE86bbaoctfaOaAfgARbbalRbegOco4gCaCciSgCE86bbaoc91faAaCfgARbbaOcl4ciGgCaCciSgCE86bbaoc4faAaCfgARbbaOcd4ciGgCaCciSgCE86bbaoc93faAaCfgARbbaOciGgOaOciSgOE86bbaoc94faAaOfgARbbalRbdgOco4gCaCciSgCE86bbaoc95faAaCfgARbbaOcl4ciGgCaCciSgCE86bbaoc96faAaCfgARbbaOcd4ciGgCaCciSgCE86bbaoc97faAaCfgARbbaOciGgOaOciSgOE86bbaoc98faAaOfgORbbalRbiglco4gAaAciSgAE86bbaoc99faOaAfgORbbalcl4ciGgAaAciSgAE86bbaoc9:faOaAfgORbbalcd4ciGgAaAciSgAE86bbaocufaOaAfgoRbbalciGglalciSglE86bbaoalfhlxdkaOalRbwalRbbgAcl4gCaCcsSgCE86bbaocGfalcwfaCfgORbbaAcsGgAaAcsSgAE86bbaocVfaOaAfgORbbalRbegAcl4gCaCcsSgCE86bbaoc7faOaCfgORbbaAcsGgAaAcsSgAE86bbaoctfaOaAfgORbbalRbdgAcl4gCaCcsSgCE86bbaoc91faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc4faOaAfgORbbalRbigAcl4gCaCcsSgCE86bbaoc93faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc94faOaAfgORbbalRblgAcl4gCaCcsSgCE86bbaoc95faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc96faOaAfgORbbalRbvgAcl4gCaCcsSgCE86bbaoc97faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc98faOaAfgORbbalRbogAcl4gCaCcsSgCE86bbaoc99faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc9:faOaAfgORbbalRbrglcl4gAaAcsSgAE86bbaocufaOaAfgoRbbalcsGglalcsSglE86bbaoalfhlxekaOal8Pbb83bbaOcwfalcwf8Pbb83bbalczfhlkdnaiam9pmbaiczfhoaral9RcL0mekkaiam6mialTmidnakTmbawaPfRbbhOcbhoazhiinaiawcj;cbfaofRbbgAce4cbaAceG9R7aOfgO86bbaiadfhiaocefgoak9hmbkkazcefhzaPcefgPad6hsalhHaPad9hmexvkkcbhlasceGmdxikalaxad2fhCdnakTmbcbhHcehsawcjdfhminaral9Rax6mialTmdalaxfhlawaHfRbbhOcbhoamhiinaiawcj;cbfaofRbbgAce4cbaAceG9R7aOfgO86bbaiadfhiaocefgoak9hmbkamcefhmaHcefgHad6hsaHad9hmbkaChlxikcbhocehsinaral9Rax6mdalTmealaxfhlaocefgoad6hsadao9hmbkaChlxdkcbhlasceGTmekc9:hoxikabaqad2fawcjdfakad2z1jjjb8Aawawcjdfakcufad2fadz1jjjb8Aakaqfhqalmbkc9:hoxekcbc99aral9Radcaadca0ESEhokavcj;ebf8Kjjjjbaok;yzeHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgDce0mbavc;abfcFecjez:jjjjb8AavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhqaicefgwarfhodnaeTmbcmcsaDceSEhkcbhxcbhmcbhDcbhicbhlindnaoaq9nmbc9:hoxikdndnawRbbgrc;Ve0mbavc;abfalarcl4cu7fcsGcitfgPydlhsaPydbhzdnarcsGgPak9pmbavaiarcu7fcsGcdtfydbaxaPEhraPThPdndnadcd9hmbabaDcetfgHaz87ebaHcdfas87ebaHclfar87ebxekabaDcdtfgHazBdbaHclfasBdbaHcwfarBdbkaxaPfhxavc;abfalcitfgHarBdbaHasBdlavaicdtfarBdbavc;abfalcefcsGglcitfgHazBdbaHarBdlaiaPfhialcefhlxdkdndnaPcsSmbamaPfaPc987fcefhmxekaocefhrao8SbbgPcFeGhHdndnaPcu9mmbarhoxekaocvfhoaHcFbGhHcrhPdninar8SbbgOcFbGaPtaHVhHaOcu9kmearcefhraPcrfgPc8J9hmbxdkkarcefhokaHce4cbaHceG9R7amfhmkdndnadcd9hmbabaDcetfgraz87ebarcdfas87ebarclfam87ebxekabaDcdtfgrazBdbarclfasBdbarcwfamBdbkavc;abfalcitfgramBdbarasBdlavaicdtfamBdbavc;abfalcefcsGglcitfgrazBdbaramBdlaicefhialcefhlxekdnarcpe0mbaxcefgOavaiaqarcsGfRbbgPcl49RcsGcdtfydbaPcz6gHEhravaiaP9RcsGcdtfydbaOaHfgsaPcsGgOEhPaOThOdndnadcd9hmbabaDcetfgzax87ebazcdfar87ebazclfaP87ebxekabaDcdtfgzaxBdbazclfarBdbazcwfaPBdbkavaicdtfaxBdbavc;abfalcitfgzarBdbazaxBdlavaicefgicsGcdtfarBdbavc;abfalcefcsGcitfgzaPBdbazarBdlavaiaHfcsGgicdtfaPBdbavc;abfalcdfcsGglcitfgraxBdbaraPBdlalcefhlaiaOfhiasaOfhxxekaxcbaoRbbgzEgAarc;:eSgrfhsazcsGhCazcl4hXdndnazcs0mbascefhOxekashOavaiaX9RcsGcdtfydbhskdndnaCmbaOcefhxxekaOhxavaiaz9RcsGcdtfydbhOkdndnarTmbaocefhrxekaocdfhrao8SbegHcFeGhPdnaHcu9kmbaocofhAaPcFbGhPcrhodninar8SbbgHcFbGaotaPVhPaHcu9kmearcefhraocrfgoc8J9hmbkaAhrxekarcefhrkaPce4cbaPceG9R7amfgmhAkdndnaXcsSmbarhPxekarcefhPar8SbbgocFeGhHdnaocu9kmbarcvfhsaHcFbGhHcrhodninaP8SbbgrcFbGaotaHVhHarcu9kmeaPcefhPaocrfgoc8J9hmbkashPxekaPcefhPkaHce4cbaHceG9R7amfgmhskdndnaCcsSmbaPhoxekaPcefhoaP8SbbgrcFeGhHdnarcu9kmbaPcvfhOaHcFbGhHcrhrdninao8SbbgPcFbGartaHVhHaPcu9kmeaocefhoarcrfgrc8J9hmbkaOhoxekaocefhokaHce4cbaHceG9R7amfgmhOkdndnadcd9hmbabaDcetfgraA87ebarcdfas87ebarclfaO87ebxekabaDcdtfgraABdbarclfasBdbarcwfaOBdbkavc;abfalcitfgrasBdbaraABdlavaicdtfaABdbavc;abfalcefcsGcitfgraOBdbarasBdlavaicefgicsGcdtfasBdbavc;abfalcdfcsGcitfgraABdbaraOBdlavaiazcz6aXcsSVfgicsGcdtfaOBdbaiaCTaCcsSVfhialcifhlkawcefhwalcsGhlaicsGhiaDcifgDae6mbkkcbc99aoaqSEhokavc;aef8Kjjjjbaok:llevu8Jjjjjbcz9Rhvc9:hodnaecvfal0mbcuhoaiRbbc;:eGc;qe9hmbav9cb83iwaicefhraialfc98fhwdnaeTmbdnadcdSmbcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcdtfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfglBdbaoalBdbaDcefgDae9hmbxdkkcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcetfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfgl87ebaoalBdbaDcefgDae9hmbkkcbc99arawSEhokaok:Lvoeue99dud99eud99dndnadcl9hmbaeTmeindndnabcdfgd8Sbb:Yab8Sbbgi:Ygl:l:tabcefgv8Sbbgo:Ygr:l:tgwJbb;:9cawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai86bbdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad86bbdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad86bbabclfhbaecufgembxdkkaeTmbindndnabclfgd8Ueb:Yab8Uebgi:Ygl:l:tabcdfgv8Uebgo:Ygr:l:tgwJb;:FSawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai87ebdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad87ebdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad87ebabcwfhbaecufgembkkk;siliui99iue99dnaeTmbcbhiabhlindndnJ;Zl81Zalcof8UebgvciV:Y:vgoal8Ueb:YNgrJb;:FSNJbbbZJbbb:;arJbbbb9GEMgw:lJbbb9p9DTmbaw:OhDxekcjjjj94hDkalclf8Uebhqalcdf8UebhkabavcefciGaiVcetfaD87ebdndnaoak:YNgwJb;:FSNJbbbZJbbb:;awJbbbb9GEMgx:lJbbb9p9DTmbax:Ohkxekcjjjj94hkkabavcdfciGaiVcetfak87ebdndnaoaq:YNgoJb;:FSNJbbbZJbbb:;aoJbbbb9GEMgx:lJbbb9p9DTmbax:Ohqxekcjjjj94hqkabavcufciGaiVcetfaq87ebdndnJbbjZararN:tawawN:taoaoN:tgrJbbbbarJbbbb9GE:rJb;:FSNJbbbZMgr:lJbbb9p9DTmbar:Ohqxekcjjjj94hqkabavciGaiVcetfaq87ebalcwfhlaiclfhiaecufgembkkk9mbdnadcd4ae2geTmbinababydbgdcwtcw91:Yadce91cjjj;8ifcjjj98G::NUdbabclfhbaecufgembkkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaik;LeeeudndnaeabVciGTmbabhixekdndnadcz9pmbabhixekabhiinaiaeydbBdbaiclfaeclfydbBdbaicwfaecwfydbBdbaicxfaecxfydbBdbaiczfhiaeczfheadc9Wfgdcs0mbkkadcl6mbinaiaeydbBdbaeclfheaiclfhiadc98fgdci0mbkkdnadTmbinaiaeRbb86bbaicefhiaecefheadcufgdmbkkabk;aeedudndnabciGTmbabhixekaecFeGc:b:c:ew2hldndnadcz9pmbabhixekabhiinaialBdbaicxfalBdbaicwfalBdbaiclfalBdbaiczfhiadc9Wfgdcs0mbkkadcl6mbinaialBdbaiclfhiadc98fgdci0mbkkdnadTmbinaiae86bbaicefhiadcufgdmbkkabkkkebcjwklz9Kbb",e="b9H79TebbbeKl9Gbb9Gvuuuuueu9Giuuub9Geueuikqbbebeedddilve9Weeeviebeoweuec:q;Aekr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbdY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVblE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtboK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbrL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbwl79IV9RbDq;t9tqlbzik9:evu8Jjjjjbcz9Rhbcbheincbhdcbhiinabcwfadfaicjuaead4ceGglE86bbaialfhiadcefgdcw9hmbkaec:q:yjjbfai86bbaecitc:q1jjbfab8Piw83ibaecefgecjd9hmbkk;h8JlHud97euo978Jjjjjbcj;kb9Rgv8Kjjjjbc9:hodnadcefal0mbcuhoaiRbbc:Ge9hmbavaialfgrad9Rad;8qbbcj;abad9UhoaicefhldnadTmbaoc;WFbGgocjdaocjd6EhwcbhDinaDae9pmeawaeaD9RaDawfae6Egqcsfgoc9WGgkci2hxakcethmaocl4cifcd4hPabaDad2fhscbhzdnincehHalhOcbhAdninaraO9RaP6miavcj;cbfaAak2fhCaOaPfhlcbhidnakc;ab6mbaral9Rc;Gb6mbcbhoinaCaofhidndndndndnaOaoco4fRbbgXciGPlbedibkaipxbbbbbbbbbbbbbbbbpklbxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklbalczfhlkdndndndndnaXcd4ciGPlbedibkaipxbbbbbbbbbbbbbbbbpklzxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklzalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklzalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklzalczfhlkdndndndndnaXcl4ciGPlbedibkaipxbbbbbbbbbbbbbbbbpklaxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklaalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklaalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklaalczfhlkdndndndndnaXco4Plbedibkaipxbbbbbbbbbbbbbbbbpkl8WxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibaXc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkl8WalclfaYpQbfaXc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibaXc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkl8WalcwfaYpQbfaXc:q:yjjbfRbbfhlxekaialpbbbpkl8Walczfhlkaoc;abfhiaocjefak0meaihoaral9Rc;Fb0mbkkdndnaiak9pmbaici4hoinaral9RcK6mdaCaifhXdndndndndnaOaico4fRbbaocoG4ciGPlbedibkaXpxbbbbbbbbbbbbbbbbpklbxikaXalpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaXalpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaXalpbbbpklbalczfhlkaocdfhoaiczfgiak6mbkkalTmbaAci6hHalhOaAcefgohAaoclSmdxekkcbhlaHceGmdkdnakTmbavcjdfazfhiavazfpbdbhYcbhXinaiavcj;cbfaXfgopblbgLcep9TaLpxeeeeeeeeeeeeeeeegQp9op9Hp9rgLaoakfpblbg8Acep9Ta8AaQp9op9Hp9rg8ApmbzeHdOiAlCvXoQrLgEaoamfpblbg3cep9Ta3aQp9op9Hp9rg3aoaxfpblbg5cep9Ta5aQp9op9Hp9rg5pmbzeHdOiAlCvXoQrLg8EpmbezHdiOAlvCXorQLgQaQpmbedibedibedibediaYp9UgYp9AdbbaiadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaEa8EpmwDKYqk8AExm35Ps8E8FgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaLa8ApmwKDYq8AkEx3m5P8Es8FgLa3a5pmwKDYq8AkEx3m5P8Es8Fg8ApmbezHdiOAlvCXorQLgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaLa8ApmwDKYqk8AExm35Ps8E8FgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfhiaXczfgXak6mbkkazclfgzad6mbkasavcjdfaqad2;8qbbavavcjdfaqcufad2fad;8qbbaqaDfhDc9:hoalmexikkc9:hoxekcbc99aral9Radcaadca0ESEhokavcj;kbf8Kjjjjbaokwbz:bjjjbk;uzeHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgDce0mbavc;abfcFecje;8kbavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhqaicefgwarfhodnaeTmbcmcsaDceSEhkcbhxcbhmcbhDcbhicbhlindnaoaq9nmbc9:hoxikdndnawRbbgrc;Ve0mbavc;abfalarcl4cu7fcsGcitfgPydlhsaPydbhzdnarcsGgPak9pmbavaiarcu7fcsGcdtfydbaxaPEhraPThPdndnadcd9hmbabaDcetfgHaz87ebaHcdfas87ebaHclfar87ebxekabaDcdtfgHazBdbaHclfasBdbaHcwfarBdbkaxaPfhxavc;abfalcitfgHarBdbaHasBdlavaicdtfarBdbavc;abfalcefcsGglcitfgHazBdbaHarBdlaiaPfhialcefhlxdkdndnaPcsSmbamaPfaPc987fcefhmxekaocefhrao8SbbgPcFeGhHdndnaPcu9mmbarhoxekaocvfhoaHcFbGhHcrhPdninar8SbbgOcFbGaPtaHVhHaOcu9kmearcefhraPcrfgPc8J9hmbxdkkarcefhokaHce4cbaHceG9R7amfhmkdndnadcd9hmbabaDcetfgraz87ebarcdfas87ebarclfam87ebxekabaDcdtfgrazBdbarclfasBdbarcwfamBdbkavc;abfalcitfgramBdbarasBdlavaicdtfamBdbavc;abfalcefcsGglcitfgrazBdbaramBdlaicefhialcefhlxekdnarcpe0mbaxcefgOavaiaqarcsGfRbbgPcl49RcsGcdtfydbaPcz6gHEhravaiaP9RcsGcdtfydbaOaHfgsaPcsGgOEhPaOThOdndnadcd9hmbabaDcetfgzax87ebazcdfar87ebazclfaP87ebxekabaDcdtfgzaxBdbazclfarBdbazcwfaPBdbkavaicdtfaxBdbavc;abfalcitfgzarBdbazaxBdlavaicefgicsGcdtfarBdbavc;abfalcefcsGcitfgzaPBdbazarBdlavaiaHfcsGgicdtfaPBdbavc;abfalcdfcsGglcitfgraxBdbaraPBdlalcefhlaiaOfhiasaOfhxxekaxcbaoRbbgzEgAarc;:eSgrfhsazcsGhCazcl4hXdndnazcs0mbascefhOxekashOavaiaX9RcsGcdtfydbhskdndnaCmbaOcefhxxekaOhxavaiaz9RcsGcdtfydbhOkdndnarTmbaocefhrxekaocdfhrao8SbegHcFeGhPdnaHcu9kmbaocofhAaPcFbGhPcrhodninar8SbbgHcFbGaotaPVhPaHcu9kmearcefhraocrfgoc8J9hmbkaAhrxekarcefhrkaPce4cbaPceG9R7amfgmhAkdndnaXcsSmbarhPxekarcefhPar8SbbgocFeGhHdnaocu9kmbarcvfhsaHcFbGhHcrhodninaP8SbbgrcFbGaotaHVhHarcu9kmeaPcefhPaocrfgoc8J9hmbkashPxekaPcefhPkaHce4cbaHceG9R7amfgmhskdndnaCcsSmbaPhoxekaPcefhoaP8SbbgrcFeGhHdnarcu9kmbaPcvfhOaHcFbGhHcrhrdninao8SbbgPcFbGartaHVhHaPcu9kmeaocefhoarcrfgrc8J9hmbkaOhoxekaocefhokaHce4cbaHceG9R7amfgmhOkdndnadcd9hmbabaDcetfgraA87ebarcdfas87ebarclfaO87ebxekabaDcdtfgraABdbarclfasBdbarcwfaOBdbkavc;abfalcitfgrasBdbaraABdlavaicdtfaABdbavc;abfalcefcsGcitfgraOBdbarasBdlavaicefgicsGcdtfasBdbavc;abfalcdfcsGcitfgraABdbaraOBdlavaiazcz6aXcsSVfgicsGcdtfaOBdbaiaCTaCcsSVfhialcifhlkawcefhwalcsGhlaicsGhiaDcifgDae6mbkkcbc99aoaqSEhokavc;aef8Kjjjjbaok:llevu8Jjjjjbcz9Rhvc9:hodnaecvfal0mbcuhoaiRbbc;:eGc;qe9hmbav9cb83iwaicefhraialfc98fhwdnaeTmbdnadcdSmbcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcdtfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfglBdbaoalBdbaDcefgDae9hmbxdkkcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcetfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfgl87ebaoalBdbaDcefgDae9hmbkkcbc99arawSEhokaok:EPliuo97eue978Jjjjjbca9Rhidndnadcl9hmbdnaec98GglTmbcbhvabhdinadadpbbbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDpxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpkbbadczfhdavclfgval6mbkkalae9pmeaiaeciGgvcdtgdVcbczad9R;8kbaiabalcdtfglad;8qbbdnavTmbaiaipblbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDpxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpklbkalaiad;8qbbskdnaec98GgxTmbcbhvabhdinadczfglalpbbbgopxbbbbbbFFbbbbbbFFgkp9oadpbbbgDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;6eaDaopmbediwDqkzHOAKY8AEgoczp:Sep;6egrp;Geaoczp:Reczp:Sep;6egwp;Gep;Kep;Legopxb;:FSb;:FSb;:FSb;:FSawaopxbbbbbbbbbbbbbbbbp:2egqawpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegwawp;Meaoaop;Mearaqaramp9op9rp;Kegoaop;Mep;Kep;Kep;Jep;Negrp;Mepxbbn0bbn0bbn0bbn0gqp;Keczp:Reawarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9op9qgwaoarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogopmwDKYqk8AExm35Ps8E8Fp9qpkbbadaDakp9oawaopmbezHdiOAlvCXorQLp9qpkbbadcafhdavclfgvax6mbkkaxae9pmbaiaeciGgvcitgdfcbcaad9R;8kbaiabaxcitfglad;8qbbdnavTmbaiaipblzgopxbbbbbbFFbbbbbbFFgkp9oaipblbgDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;6eaDaopmbediwDqkzHOAKY8AEgoczp:Sep;6egrp;Geaoczp:Reczp:Sep;6egwp;Gep;Kep;Legopxb;:FSb;:FSb;:FSb;:FSawaopxbbbbbbbbbbbbbbbbp:2egqawpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegwawp;Meaoaop;Mearaqaramp9op9rp;Kegoaop;Mep;Kep;Kep;Jep;Negrp;Mepxbbn0bbn0bbn0bbn0gqp;Keczp:Reawarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9op9qgwaoarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogopmwDKYqk8AExm35Ps8E8Fp9qpklzaiaDakp9oawaopmbezHdiOAlvCXorQLp9qpklbkalaiad;8qbbkk;4wllue97euv978Jjjjjbc8W9Rhidnaec98GglTmbcbhvabhoinaiaopbbbgraoczfgwpbbbgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklbaopxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaqakp;Mearp;Keczp:ReaDakp;Mearp;Keamp9op9qgkpmbezHdiOAlvCXorQLgrp5baipblbpEb:T:j83ibaocwfarp5eaipblbpEe:T:j83ibawaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblbpEd:T:j83ibaocKfakp5eaipblbpEi:T:j83ibaocafhoavclfgval6mbkkdnalae9pmbaiaeciGgvcitgofcbcaao9R;8kbaiabalcitfgwao;8qbbdnavTmbaiaipblbgraipblzgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklaaipxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaqakp;Mearp;Keczp:ReaDakp;Mearp;Keamp9op9qgkpmbezHdiOAlvCXorQLgrp5baipblapEb:T:j83ibaiarp5eaipblapEe:T:j83iwaiaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblapEd:T:j83izaiakp5eaipblapEi:T:j83iKkawaiao;8qbbkk:Pddiue978Jjjjjbc;ab9Rhidnadcd4ae2glc98GgvTmbcbhdabheinaeaepbbbgocwp:Recwp:Sep;6eaocep:SepxbbjZbbjZbbjZbbjZp:UepxbbjFbbjFbbjFbbjFp9op;Mepkbbaeczfheadclfgdav6mbkkdnaval9pmbaialciGgdcdtgeVcbc;abae9R;8kbaiabavcdtfgvae;8qbbdnadTmbaiaipblbgocwp:Recwp:Sep;6eaocep:SepxbbjZbbjZbbjZbbjZp:UepxbbjFbbjFbbjFbbjFp9op;Mepklbkavaiae;8qbbkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaikkkebcjwklz9Tbb",t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),i=new Uint8Array([32,0,65,2,1,106,34,33,3,128,11,4,13,64,6,253,10,7,15,116,127,5,8,12,40,16,19,54,20,9,27,255,113,17,42,67,24,23,146,148,18,14,22,45,70,69,56,114,101,21,25,63,75,136,108,28,118,29,73,115]);if(typeof WebAssembly!="object")return{supported:!1};var s=WebAssembly.validate(t)?e:n,r,o=WebAssembly.instantiate(a(s),{}).then(function(m){r=m.instance,r.exports.__wasm_call_ctors()});function a(m){for(var b=new Uint8Array(m.length),y=0;y<m.length;++y){var _=m.charCodeAt(y);b[y]=_>96?_-97:_>64?_-39:_+4}for(var E=0,y=0;y<m.length;++y)b[E++]=b[y]<60?i[b[y]]:(b[y]-60)*64+b[++y];return b.buffer.slice(0,E)}function l(m,b,y,_,E,M){var I=r.exports.sbrk,R=y+3&-4,C=I(R*_),T=I(E.length),O=new Uint8Array(r.exports.memory.buffer);O.set(E,T);var J=m(C,y,_,T,E.length);if(J==0&&M&&M(C,R,_),b.set(O.subarray(C,C+y*_)),I(C-I(0)),J!=0)throw new Error("Malformed buffer data: "+J)}var c={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},u={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"},d=[],f=0;function p(m){var b={object:new Worker(m),pending:0,requests:{}};return b.object.onmessage=function(y){var _=y.data;b.pending-=_.count,b.requests[_.id][_.action](_.value),delete b.requests[_.id]},b}function g(m){for(var b="var instance; var ready = WebAssembly.instantiate(new Uint8Array(["+new Uint8Array(a(s))+"]), {}).then(function(result) { instance = result.instance; instance.exports.__wasm_call_ctors(); });self.onmessage = workerProcess;"+l.toString()+v.toString(),y=new Blob([b],{type:"text/javascript"}),_=URL.createObjectURL(y),E=0;E<m;++E)d[E]=p(_);URL.revokeObjectURL(_)}function A(m,b,y,_,E){for(var M=d[0],I=1;I<d.length;++I)d[I].pending<M.pending&&(M=d[I]);return new Promise(function(R,C){var T=new Uint8Array(y),O=f++;M.pending+=m,M.requests[O]={resolve:R,reject:C},M.object.postMessage({id:O,count:m,size:b,source:T,mode:_,filter:E},[T.buffer])})}function v(m){o.then(function(){var b=m.data;try{var y=new Uint8Array(b.count*b.size);l(r.exports[b.mode],y,b.count,b.size,b.source,r.exports[b.filter]),self.postMessage({id:b.id,count:b.count,action:"resolve",value:y},[y.buffer])}catch(_){self.postMessage({id:b.id,count:b.count,action:"reject",value:_})}})}return{ready:o,supported:!0,useWorkers:function(m){g(m)},decodeVertexBuffer:function(m,b,y,_,E){l(r.exports.meshopt_decodeVertexBuffer,m,b,y,_,r.exports[c[E]])},decodeIndexBuffer:function(m,b,y,_){l(r.exports.meshopt_decodeIndexBuffer,m,b,y,_)},decodeIndexSequence:function(m,b,y,_){l(r.exports.meshopt_decodeIndexSequence,m,b,y,_)},decodeGltfBuffer:function(m,b,y,_,E,M){l(r.exports[u[E]],m,b,y,_,r.exports[c[M]])},decodeGltfBufferAsync:function(m,b,y,_,E){return d.length>0?A(m,b,y,u[_],c[E]):o.then(function(){var M=new Uint8Array(m*b);return l(r.exports[u[_]],M,m,b,y,r.exports[c[E]]),M})}}}();const gf=re("debugdecoders"),dB="https://www.gstatic.com/draco/versioned/decoders/1.4.1/",fB="https://www.gstatic.com/basis-universal/versioned/2021-04-15-ba1c3e4/";let No,Mw,Ic;function pB(n){n!==void 0&&typeof n=="string"&&(No||(No=new fT),gf&&console.log("Setting draco decoder path to",n),No.setDecoderPath(n))}function gB(n){n!==void 0&&typeof n=="string"&&(No||(No=new fT),gf&&console.log("Setting draco decoder type to",n),No.setDecoderConfig({type:n}))}function mB(n){n!==void 0&&typeof n=="string"&&(Ic||(Ic=new Qo),gf&&console.log("Setting ktx2 transcoder path to",n),Ic.setTranscoderPath(n))}function cA(n,e){No||(No=new fT,No.setDecoderPath(dB),No.setDecoderConfig({type:"js"}),gf&&console.log("Setting draco decoder path to",dB)),Ic||(Ic=new Qo,Ic.setTranscoderPath(fB),gf&&console.log("Setting ktx2 transcoder path to",fB)),Mw||(Mw=rX,gf&&console.log("Using the default meshopt decoder")),e.renderer?Ic.detectSupport(e.renderer):console.warn("No renderer provided to detect ktx2 support - loading KTX2 textures will probably fail"),n.setDRACOLoader(No),n.setKTX2Loader(Ic),n.setMeshoptDecoder(Mw)}function AB(n,e){if(e===ik)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),n;if(e===i0||e===KE){let t=n.getIndex();if(t===null){const o=[],a=n.getAttribute("position");if(a!==void 0){for(let l=0;l<a.count;l++)o.push(l);n.setIndex(o),t=n.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),n}const i=t.count-2,s=[];if(e===i0)for(let o=1;o<=i;o++)s.push(t.getX(0)),s.push(t.getX(o)),s.push(t.getX(o+1));else for(let o=0;o<i;o++)o%2===0?(s.push(t.getX(o)),s.push(t.getX(o+1)),s.push(t.getX(o+2))):(s.push(t.getX(o+2)),s.push(t.getX(o+1)),s.push(t.getX(o)));s.length/3!==i&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const r=n.clone();return r.setIndex(s),r.clearGroups(),r}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),n}class sp extends ds{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new hX(t)}),this.register(function(t){return new vX(t)}),this.register(function(t){return new yX(t)}),this.register(function(t){return new bX(t)}),this.register(function(t){return new dX(t)}),this.register(function(t){return new fX(t)}),this.register(function(t){return new pX(t)}),this.register(function(t){return new gX(t)}),this.register(function(t){return new cX(t)}),this.register(function(t){return new mX(t)}),this.register(function(t){return new uX(t)}),this.register(function(t){return new AX(t)}),this.register(function(t){return new aX(t)}),this.register(function(t){return new _X(t)}),this.register(function(t){return new xX(t)})}load(e,t,i,s){const r=this;let o;this.resourcePath!==""?o=this.resourcePath:this.path!==""?o=this.path:o=kf.extractUrlBase(e),this.manager.itemStart(e);const a=function(c){s?s(c):console.error(c),r.manager.itemError(e),r.manager.itemEnd(e)},l=new Dn(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(c){try{r.parse(c,o,function(u){t(u),r.manager.itemEnd(e)},a)}catch(u){a(u)}},i,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,i,s){let r;const o={},a={},l=new TextDecoder;if(typeof e=="string")r=JSON.parse(e);else if(e instanceof ArrayBuffer)if(l.decode(new Uint8Array(e,0,4))===GF){try{o[Jt.KHR_BINARY_GLTF]=new wX(e)}catch(d){s&&s(d);return}r=JSON.parse(o[Jt.KHR_BINARY_GLTF].content)}else r=JSON.parse(l.decode(e));else r=e;if(r.asset===void 0||r.asset.version[0]<2){s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const c=new LX(r,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});c.fileLoader.setRequestHeader(this.requestHeader);for(let u=0;u<this.pluginCallbacks.length;u++){const d=this.pluginCallbacks[u](c);a[d.name]=d,o[d.name]=!0}if(r.extensionsUsed)for(let u=0;u<r.extensionsUsed.length;++u){const d=r.extensionsUsed[u],f=r.extensionsRequired||[];switch(d){case Jt.KHR_MATERIALS_UNLIT:o[d]=new lX;break;case Jt.KHR_DRACO_MESH_COMPRESSION:o[d]=new SX(r,this.dracoLoader);break;case Jt.KHR_TEXTURE_TRANSFORM:o[d]=new CX;break;case Jt.KHR_MESH_QUANTIZATION:o[d]=new EX;break;default:f.indexOf(d)>=0&&a[d]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+d+'".')}}c.setExtensions(o),c.setPlugins(a),c.parse(i,s)}parseAsync(e,t){const i=this;return new Promise(function(s,r){i.parse(e,t,s,r)})}}function oX(){let n={};return{get:function(e){return n[e]},add:function(e,t){n[e]=t},remove:function(e){delete n[e]},removeAll:function(){n={}}}}const Jt={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class aX{constructor(e){this.parser=e,this.name=Jt.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let i=0,s=t.length;i<s;i++){const r=t[i];r.extensions&&r.extensions[this.name]&&r.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,r.extensions[this.name].light)}}_loadLight(e){const t=this.parser,i="light:"+e;let s=t.cache.get(i);if(s)return s;const r=t.json,l=((r.extensions&&r.extensions[this.name]||{}).lights||[])[e];let c;const u=new _e(16777215);l.color!==void 0&&u.fromArray(l.color);const d=l.range!==void 0?l.range:0;switch(l.type){case"directional":c=new Jb(u),c.target.position.set(0,0,-1),c.add(c.target);break;case"point":c=new Yb(u),c.distance=d;break;case"spot":c=new Xb(u),c.distance=d,l.spot=l.spot||{},l.spot.innerConeAngle=l.spot.innerConeAngle!==void 0?l.spot.innerConeAngle:0,l.spot.outerConeAngle=l.spot.outerConeAngle!==void 0?l.spot.outerConeAngle:Math.PI/4,c.angle=l.spot.outerConeAngle,c.penumbra=1-l.spot.innerConeAngle/l.spot.outerConeAngle,c.target.position.set(0,0,-1),c.add(c.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+l.type)}return c.position.set(0,0,0),c.decay=2,Sc(c,l),l.intensity!==void 0&&(c.intensity=l.intensity),c.name=t.createUniqueName(l.name||"light_"+e),s=Promise.resolve(c),t.cache.add(i,s),s}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,i=this.parser,r=i.json.nodes[e],a=(r.extensions&&r.extensions[this.name]||{}).light;return a===void 0?null:this._loadLight(a).then(function(l){return i._getNodeRef(t.cache,a,l)})}}let lX=class{constructor(){this.name=Jt.KHR_MATERIALS_UNLIT}getMaterialType(){return ai}extendParams(e,t,i){const s=[];e.color=new _e(1,1,1),e.opacity=1;const r=t.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){const o=r.baseColorFactor;e.color.fromArray(o),e.opacity=o[3]}r.baseColorTexture!==void 0&&s.push(i.assignTexture(e,"map",r.baseColorTexture,Je))}return Promise.all(s)}},cX=class{constructor(e){this.parser=e,this.name=Jt.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=s.extensions[this.name].emissiveStrength;return r!==void 0&&(t.emissiveIntensity=r),Promise.resolve()}},hX=class{constructor(e){this.parser=e,this.name=Jt.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:bo}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];if(o.clearcoatFactor!==void 0&&(t.clearcoat=o.clearcoatFactor),o.clearcoatTexture!==void 0&&r.push(i.assignTexture(t,"clearcoatMap",o.clearcoatTexture)),o.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=o.clearcoatRoughnessFactor),o.clearcoatRoughnessTexture!==void 0&&r.push(i.assignTexture(t,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),o.clearcoatNormalTexture!==void 0&&(r.push(i.assignTexture(t,"clearcoatNormalMap",o.clearcoatNormalTexture)),o.clearcoatNormalTexture.scale!==void 0)){const a=o.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new te(a,a)}return Promise.all(r)}},uX=class{constructor(e){this.parser=e,this.name=Jt.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:bo}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];return o.iridescenceFactor!==void 0&&(t.iridescence=o.iridescenceFactor),o.iridescenceTexture!==void 0&&r.push(i.assignTexture(t,"iridescenceMap",o.iridescenceTexture)),o.iridescenceIor!==void 0&&(t.iridescenceIOR=o.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),o.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),o.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),o.iridescenceThicknessTexture!==void 0&&r.push(i.assignTexture(t,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(r)}},dX=class{constructor(e){this.parser=e,this.name=Jt.KHR_MATERIALS_SHEEN}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:bo}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[];t.sheenColor=new _e(0,0,0),t.sheenRoughness=0,t.sheen=1;const o=s.extensions[this.name];return o.sheenColorFactor!==void 0&&t.sheenColor.fromArray(o.sheenColorFactor),o.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=o.sheenRoughnessFactor),o.sheenColorTexture!==void 0&&r.push(i.assignTexture(t,"sheenColorMap",o.sheenColorTexture,Je)),o.sheenRoughnessTexture!==void 0&&r.push(i.assignTexture(t,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(r)}},fX=class{constructor(e){this.parser=e,this.name=Jt.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:bo}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];return o.transmissionFactor!==void 0&&(t.transmission=o.transmissionFactor),o.transmissionTexture!==void 0&&r.push(i.assignTexture(t,"transmissionMap",o.transmissionTexture)),Promise.all(r)}},pX=class{constructor(e){this.parser=e,this.name=Jt.KHR_MATERIALS_VOLUME}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:bo}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];t.thickness=o.thicknessFactor!==void 0?o.thicknessFactor:0,o.thicknessTexture!==void 0&&r.push(i.assignTexture(t,"thicknessMap",o.thicknessTexture)),t.attenuationDistance=o.attenuationDistance||1/0;const a=o.attenuationColor||[1,1,1];return t.attenuationColor=new _e(a[0],a[1],a[2]),Promise.all(r)}},gX=class{constructor(e){this.parser=e,this.name=Jt.KHR_MATERIALS_IOR}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:bo}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=s.extensions[this.name];return t.ior=r.ior!==void 0?r.ior:1.5,Promise.resolve()}},mX=class{constructor(e){this.parser=e,this.name=Jt.KHR_MATERIALS_SPECULAR}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:bo}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];t.specularIntensity=o.specularFactor!==void 0?o.specularFactor:1,o.specularTexture!==void 0&&r.push(i.assignTexture(t,"specularIntensityMap",o.specularTexture));const a=o.specularColorFactor||[1,1,1];return t.specularColor=new _e(a[0],a[1],a[2]),o.specularColorTexture!==void 0&&r.push(i.assignTexture(t,"specularColorMap",o.specularColorTexture,Je)),Promise.all(r)}},AX=class{constructor(e){this.parser=e,this.name=Jt.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:bo}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];return o.anisotropyStrength!==void 0&&(t.anisotropy=o.anisotropyStrength),o.anisotropyRotation!==void 0&&(t.anisotropyRotation=o.anisotropyRotation),o.anisotropyTexture!==void 0&&r.push(i.assignTexture(t,"anisotropyMap",o.anisotropyTexture)),Promise.all(r)}};class vX{constructor(e){this.parser=e,this.name=Jt.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,i=t.json,s=i.textures[e];if(!s.extensions||!s.extensions[this.name])return null;const r=s.extensions[this.name],o=t.options.ktx2Loader;if(!o){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,r.source,o)}}class yX{constructor(e){this.parser=e,this.name=Jt.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,s=i.json,r=s.textures[e];if(!r.extensions||!r.extensions[t])return null;const o=r.extensions[t],a=s.images[o.source];let l=i.textureLoader;if(a.uri){const c=i.options.manager.getHandler(a.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return i.loadTextureImage(e,o.source,l);if(s.extensionsRequired&&s.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class bX{constructor(e){this.parser=e,this.name=Jt.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,s=i.json,r=s.textures[e];if(!r.extensions||!r.extensions[t])return null;const o=r.extensions[t],a=s.images[o.source];let l=i.textureLoader;if(a.uri){const c=i.options.manager.getHandler(a.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return i.loadTextureImage(e,o.source,l);if(s.extensionsRequired&&s.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class _X{constructor(e){this.name=Jt.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,i=t.bufferViews[e];if(i.extensions&&i.extensions[this.name]){const s=i.extensions[this.name],r=this.parser.getDependency("buffer",s.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return r.then(function(a){const l=s.byteOffset||0,c=s.byteLength||0,u=s.count,d=s.byteStride,f=new Uint8Array(a,l,c);return o.decodeGltfBufferAsync?o.decodeGltfBufferAsync(u,d,f,s.mode,s.filter).then(function(p){return p.buffer}):o.ready.then(function(){const p=new ArrayBuffer(u*d);return o.decodeGltfBuffer(new Uint8Array(p),u,d,f,s.mode,s.filter),p})})}else return null}}class xX{constructor(e){this.name=Jt.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,i=t.nodes[e];if(!i.extensions||!i.extensions[this.name]||i.mesh===void 0)return null;const s=t.meshes[i.mesh];for(const c of s.primitives)if(c.mode!==lo.TRIANGLES&&c.mode!==lo.TRIANGLE_STRIP&&c.mode!==lo.TRIANGLE_FAN&&c.mode!==void 0)return null;const o=i.extensions[this.name].attributes,a=[],l={};for(const c in o)a.push(this.parser.getDependency("accessor",o[c]).then(u=>(l[c]=u,l[c])));return a.length<1?null:(a.push(this.parser.createNodeMesh(e)),Promise.all(a).then(c=>{const u=c.pop(),d=u.isGroup?u.children:[u],f=c[0].count,p=[];for(const g of d){const A=new Ie,v=new w,m=new Se,b=new w(1,1,1),y=new Pb(g.geometry,g.material,f);for(let _=0;_<f;_++)l.TRANSLATION&&v.fromBufferAttribute(l.TRANSLATION,_),l.ROTATION&&m.fromBufferAttribute(l.ROTATION,_),l.SCALE&&b.fromBufferAttribute(l.SCALE,_),y.setMatrixAt(_,A.compose(v,m,b));for(const _ in l)_!=="TRANSLATION"&&_!=="ROTATION"&&_!=="SCALE"&&g.geometry.setAttribute(_,l[_]);Me.prototype.copy.call(y,g),this.parser.assignFinalMaterial(y),p.push(y)}return u.isGroup?(u.clear(),u.add(...p),u):p[0]}))}}const GF="glTF",Xp=12,vB={JSON:1313821514,BIN:5130562};class wX{constructor(e){this.name=Jt.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,Xp),i=new TextDecoder;if(this.header={magic:i.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==GF)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const s=this.header.length-Xp,r=new DataView(e,Xp);let o=0;for(;o<s;){const a=r.getUint32(o,!0);o+=4;const l=r.getUint32(o,!0);if(o+=4,l===vB.JSON){const c=new Uint8Array(e,Xp+o,a);this.content=i.decode(c)}else if(l===vB.BIN){const c=Xp+o;this.body=e.slice(c,c+a)}o+=a}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class SX{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Jt.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const i=this.json,s=this.dracoLoader,r=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,a={},l={},c={};for(const u in o){const d=JC[u]||u.toLowerCase();a[d]=o[u]}for(const u in e.attributes){const d=JC[u]||u.toLowerCase();if(o[u]!==void 0){const f=i.accessors[e.attributes[u]],p=mf[f.componentType];c[d]=p.name,l[d]=f.normalized===!0}}return t.getDependency("bufferView",r).then(function(u){return new Promise(function(d){s.decodeDracoFile(u,function(f){for(const p in f.attributes){const g=f.attributes[p],A=l[p];A!==void 0&&(g.normalized=A)}d(f)},a,c)})})}}class CX{constructor(){this.name=Jt.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord===void 0||t.texCoord===e.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class EX{constructor(){this.name=Jt.KHR_MESH_QUANTIZATION}}class VF extends Kf{constructor(e,t,i,s){super(e,t,i,s)}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,s=this.valueSize,r=e*s*3+s;for(let o=0;o!==s;o++)t[o]=i[r+o];return t}interpolate_(e,t,i,s){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=a*2,c=a*3,u=s-t,d=(i-t)/u,f=d*d,p=f*d,g=e*c,A=g-c,v=-2*p+3*f,m=p-f,b=1-v,y=m-f+d;for(let _=0;_!==a;_++){const E=o[A+_+a],M=o[A+_+l]*u,I=o[g+_+a],R=o[g+_]*u;r[_]=b*E+y*M+v*I+m*R}return r}}const MX=new Se;class TX extends VF{interpolate_(e,t,i,s){const r=super.interpolate_(e,t,i,s);return MX.fromArray(r).normalize().toArray(r),r}}const lo={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},mf={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},yB={9728:Ft,9729:Dt,9984:Pf,9985:Jm,9986:fu,9987:yo},bB={33071:Wn,33648:wu,10497:vo},Tw={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},JC={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},pc={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},IX={CUBICSPLINE:void 0,LINEAR:Jc,STEP:Su},Iw={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function RX(n){return n.DefaultMaterial===void 0&&(n.DefaultMaterial=new Yo({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Es})),n.DefaultMaterial}function Dh(n,e,t){for(const i in t.extensions)n[i]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[i]=t.extensions[i])}function Sc(n,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(n.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function PX(n,e,t){let i=!1,s=!1,r=!1;for(let c=0,u=e.length;c<u;c++){const d=e[c];if(d.POSITION!==void 0&&(i=!0),d.NORMAL!==void 0&&(s=!0),d.COLOR_0!==void 0&&(r=!0),i&&s&&r)break}if(!i&&!s&&!r)return Promise.resolve(n);const o=[],a=[],l=[];for(let c=0,u=e.length;c<u;c++){const d=e[c];if(i){const f=d.POSITION!==void 0?t.getDependency("accessor",d.POSITION):n.attributes.position;o.push(f)}if(s){const f=d.NORMAL!==void 0?t.getDependency("accessor",d.NORMAL):n.attributes.normal;a.push(f)}if(r){const f=d.COLOR_0!==void 0?t.getDependency("accessor",d.COLOR_0):n.attributes.color;l.push(f)}}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l)]).then(function(c){const u=c[0],d=c[1],f=c[2];return i&&(n.morphAttributes.position=u),s&&(n.morphAttributes.normal=d),r&&(n.morphAttributes.color=f),n.morphTargetsRelative=!0,n})}function BX(n,e){if(n.updateMorphTargets(),e.weights!==void 0)for(let t=0,i=e.weights.length;t<i;t++)n.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(n.morphTargetInfluences.length===t.length){n.morphTargetDictionary={};for(let i=0,s=t.length;i<s;i++)n.morphTargetDictionary[t[i]]=i}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function DX(n){let e;const t=n.extensions&&n.extensions[Jt.KHR_DRACO_MESH_COMPRESSION];if(t?e="draco:"+t.bufferView+":"+t.indices+":"+Rw(t.attributes):e=n.indices+":"+Rw(n.attributes)+":"+n.mode,n.targets!==void 0)for(let i=0,s=n.targets.length;i<s;i++)e+=":"+Rw(n.targets[i]);return e}function Rw(n){let e="";const t=Object.keys(n).sort();for(let i=0,s=t.length;i<s;i++)e+=t[i]+":"+n[t[i]]+";";return e}function KC(n){switch(n){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function OX(n){return n.search(/\.jpe?g($|\?)/i)>0||n.search(/^data\:image\/jpeg/)===0?"image/jpeg":n.search(/\.webp($|\?)/i)>0||n.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const kX=new Ie;class LX{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new oX,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let i=!1,s=!1,r=-1;typeof navigator<"u"&&(i=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,s=navigator.userAgent.indexOf("Firefox")>-1,r=s?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||i||s&&r<98?this.textureLoader=new kl(this.options.manager):this.textureLoader=new uL(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Dn(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const i=this,s=this.json,r=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(o){return o._markDefs&&o._markDefs()}),Promise.all(this._invokeAll(function(o){return o.beforeRoot&&o.beforeRoot()})).then(function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])}).then(function(o){const a={scene:o[0][s.scene||0],scenes:o[0],animations:o[1],cameras:o[2],asset:s.asset,parser:i,userData:{}};Dh(r,a,s),Sc(a,s),Promise.all(i._invokeAll(function(l){return l.afterRoot&&l.afterRoot(a)})).then(function(){e(a)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],i=this.json.meshes||[];for(let s=0,r=t.length;s<r;s++){const o=t[s].joints;for(let a=0,l=o.length;a<l;a++)e[o[a]].isBone=!0}for(let s=0,r=e.length;s<r;s++){const o=e[s];o.mesh!==void 0&&(this._addNodeRef(this.meshCache,o.mesh),o.skin!==void 0&&(i[o.mesh].isSkinnedMesh=!0)),o.camera!==void 0&&this._addNodeRef(this.cameraCache,o.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,i){if(e.refs[t]<=1)return i;const s=i.clone(),r=(o,a)=>{const l=this.associations.get(o);l!=null&&this.associations.set(a,l);for(const[c,u]of o.children.entries())r(u,a.children[c])};return r(i,s),s.name+="_instance_"+e.uses[t]++,s}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let i=0;i<t.length;i++){const s=e(t[i]);if(s)return s}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const i=[];for(let s=0;s<t.length;s++){const r=e(t[s]);r&&i.push(r)}return i}getDependency(e,t){const i=e+":"+t;let s=this.cache.get(i);if(!s){switch(e){case"scene":s=this.loadScene(t);break;case"node":s=this._invokeOne(function(r){return r.loadNode&&r.loadNode(t)});break;case"mesh":s=this._invokeOne(function(r){return r.loadMesh&&r.loadMesh(t)});break;case"accessor":s=this.loadAccessor(t);break;case"bufferView":s=this._invokeOne(function(r){return r.loadBufferView&&r.loadBufferView(t)});break;case"buffer":s=this.loadBuffer(t);break;case"material":s=this._invokeOne(function(r){return r.loadMaterial&&r.loadMaterial(t)});break;case"texture":s=this._invokeOne(function(r){return r.loadTexture&&r.loadTexture(t)});break;case"skin":s=this.loadSkin(t);break;case"animation":s=this._invokeOne(function(r){return r.loadAnimation&&r.loadAnimation(t)});break;case"camera":s=this.loadCamera(t);break;default:if(s=this._invokeOne(function(r){return r!=this&&r.getDependency&&r.getDependency(e,t)}),!s)throw new Error("Unknown type: "+e);break}this.cache.add(i,s)}return s}getDependencies(e){let t=this.cache.get(e);if(!t){const i=this,s=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(s.map(function(r,o){return i.getDependency(e,o)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],i=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[Jt.KHR_BINARY_GLTF].body);const s=this.options;return new Promise(function(r,o){i.load(kf.resolveURL(t.uri,s.path),r,void 0,function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(i){const s=t.byteLength||0,r=t.byteOffset||0;return i.slice(r,r+s)})}loadAccessor(e){const t=this,i=this.json,s=this.json.accessors[e];if(s.bufferView===void 0&&s.sparse===void 0){const o=Tw[s.type],a=mf[s.componentType],l=s.normalized===!0,c=new a(s.count*o);return Promise.resolve(new ot(c,o,l))}const r=[];return s.bufferView!==void 0?r.push(this.getDependency("bufferView",s.bufferView)):r.push(null),s.sparse!==void 0&&(r.push(this.getDependency("bufferView",s.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",s.sparse.values.bufferView))),Promise.all(r).then(function(o){const a=o[0],l=Tw[s.type],c=mf[s.componentType],u=c.BYTES_PER_ELEMENT,d=u*l,f=s.byteOffset||0,p=s.bufferView!==void 0?i.bufferViews[s.bufferView].byteStride:void 0,g=s.normalized===!0;let A,v;if(p&&p!==d){const m=Math.floor(f/p),b="InterleavedBuffer:"+s.bufferView+":"+s.componentType+":"+m+":"+s.count;let y=t.cache.get(b);y||(A=new c(a,m*p,s.count*p/u),y=new $m(A,p/u),t.cache.add(b,y)),v=new Gl(y,l,f%p/u,g)}else a===null?A=new c(s.count*l):A=new c(a,f,s.count*l),v=new ot(A,l,g);if(s.sparse!==void 0){const m=Tw.SCALAR,b=mf[s.sparse.indices.componentType],y=s.sparse.indices.byteOffset||0,_=s.sparse.values.byteOffset||0,E=new b(o[1],y,s.sparse.count*m),M=new c(o[2],_,s.sparse.count*l);a!==null&&(v=new ot(v.array.slice(),v.itemSize,v.normalized));for(let I=0,R=E.length;I<R;I++){const C=E[I];if(v.setX(C,M[I*l]),l>=2&&v.setY(C,M[I*l+1]),l>=3&&v.setZ(C,M[I*l+2]),l>=4&&v.setW(C,M[I*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return v})}loadTexture(e){const t=this.json,i=this.options,r=t.textures[e].source,o=t.images[r];let a=this.textureLoader;if(o.uri){const l=i.manager.getHandler(o.uri);l!==null&&(a=l)}return this.loadTextureImage(e,r,a)}loadTextureImage(e,t,i){const s=this,r=this.json,o=r.textures[e],a=r.images[t],l=(a.uri||a.bufferView)+":"+o.sampler;if(this.textureCache[l])return this.textureCache[l];const c=this.loadImageSource(t,i).then(function(u){u.flipY=!1,u.name=o.name||a.name||"",u.name===""&&typeof a.uri=="string"&&a.uri.startsWith("data:image/")===!1&&(u.name=a.uri);const f=(r.samplers||{})[o.sampler]||{};return u.magFilter=yB[f.magFilter]||Dt,u.minFilter=yB[f.minFilter]||yo,u.wrapS=bB[f.wrapS]||vo,u.wrapT=bB[f.wrapT]||vo,u.anisotropy=4,s.associations.set(u,{textures:e}),u}).catch(function(){return null});return this.textureCache[l]=c,c}loadImageSource(e,t){const i=this,s=this.json,r=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(d=>d.clone());const o=s.images[e],a=self.URL||self.webkitURL;let l=o.uri||"",c=!1;if(o.bufferView!==void 0)l=i.getDependency("bufferView",o.bufferView).then(function(d){c=!0;const f=new Blob([d],{type:o.mimeType});return l=a.createObjectURL(f),l});else if(o.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const u=Promise.resolve(l).then(function(d){return new Promise(function(f,p){let g=f;t.isImageBitmapLoader===!0&&(g=function(A){const v=new Rt(A);v.needsUpdate=!0,f(v)}),t.load(kf.resolveURL(d,r.path),g,void 0,p)})}).then(function(d){return c===!0&&a.revokeObjectURL(l),d.userData.mimeType=o.mimeType||OX(o.uri),d}).catch(function(d){throw console.error("THREE.GLTFLoader: Couldn't load texture",l),d});return this.sourceCache[e]=u,u}assignTexture(e,t,i,s){const r=this;return this.getDependency("texture",i.index).then(function(o){if(!o)return null;if(i.texCoord!==void 0&&i.texCoord>0&&(o=o.clone(),o.channel=i.texCoord),r.extensions[Jt.KHR_TEXTURE_TRANSFORM]){const a=i.extensions!==void 0?i.extensions[Jt.KHR_TEXTURE_TRANSFORM]:void 0;if(a){const l=r.associations.get(o);o=r.extensions[Jt.KHR_TEXTURE_TRANSFORM].extendTexture(o,a),r.associations.set(o,l)}}return s!==void 0&&(o.colorSpace=s),e[t]=o,o})}assignFinalMaterial(e){const t=e.geometry;let i=e.material;const s=t.attributes.tangent===void 0,r=t.attributes.color!==void 0,o=t.attributes.normal===void 0;if(e.isPoints){const a="PointsMaterial:"+i.uuid;let l=this.cache.get(a);l||(l=new Bb,Pt.prototype.copy.call(l,i),l.color.copy(i.color),l.map=i.map,l.sizeAttenuation=!1,this.cache.add(a,l)),i=l}else if(e.isLine){const a="LineBasicMaterial:"+i.uuid;let l=this.cache.get(a);l||(l=new Sn,Pt.prototype.copy.call(l,i),l.color.copy(i.color),l.map=i.map,this.cache.add(a,l)),i=l}if(s||r||o){let a="ClonedMaterial:"+i.uuid+":";s&&(a+="derivative-tangents:"),r&&(a+="vertex-colors:"),o&&(a+="flat-shading:");let l=this.cache.get(a);l||(l=i.clone(),r&&(l.vertexColors=!0),o&&(l.flatShading=!0),s&&(l.normalScale&&(l.normalScale.y*=-1),l.clearcoatNormalScale&&(l.clearcoatNormalScale.y*=-1)),this.cache.add(a,l),this.associations.set(l,this.associations.get(i))),i=l}e.material=i}getMaterialType(){return Yo}loadMaterial(e){const t=this,i=this.json,s=this.extensions,r=i.materials[e];let o;const a={},l=r.extensions||{},c=[];if(l[Jt.KHR_MATERIALS_UNLIT]){const d=s[Jt.KHR_MATERIALS_UNLIT];o=d.getMaterialType(),c.push(d.extendParams(a,r,t))}else{const d=r.pbrMetallicRoughness||{};if(a.color=new _e(1,1,1),a.opacity=1,Array.isArray(d.baseColorFactor)){const f=d.baseColorFactor;a.color.fromArray(f),a.opacity=f[3]}d.baseColorTexture!==void 0&&c.push(t.assignTexture(a,"map",d.baseColorTexture,Je)),a.metalness=d.metallicFactor!==void 0?d.metallicFactor:1,a.roughness=d.roughnessFactor!==void 0?d.roughnessFactor:1,d.metallicRoughnessTexture!==void 0&&(c.push(t.assignTexture(a,"metalnessMap",d.metallicRoughnessTexture)),c.push(t.assignTexture(a,"roughnessMap",d.metallicRoughnessTexture))),o=this._invokeOne(function(f){return f.getMaterialType&&f.getMaterialType(e)}),c.push(Promise.all(this._invokeAll(function(f){return f.extendMaterialParams&&f.extendMaterialParams(e,a)})))}r.doubleSided===!0&&(a.side=wi);const u=r.alphaMode||Iw.OPAQUE;if(u===Iw.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,u===Iw.MASK&&(a.alphaTest=r.alphaCutoff!==void 0?r.alphaCutoff:.5)),r.normalTexture!==void 0&&o!==ai&&(c.push(t.assignTexture(a,"normalMap",r.normalTexture)),a.normalScale=new te(1,1),r.normalTexture.scale!==void 0)){const d=r.normalTexture.scale;a.normalScale.set(d,d)}return r.occlusionTexture!==void 0&&o!==ai&&(c.push(t.assignTexture(a,"aoMap",r.occlusionTexture)),r.occlusionTexture.strength!==void 0&&(a.aoMapIntensity=r.occlusionTexture.strength)),r.emissiveFactor!==void 0&&o!==ai&&(a.emissive=new _e().fromArray(r.emissiveFactor)),r.emissiveTexture!==void 0&&o!==ai&&c.push(t.assignTexture(a,"emissiveMap",r.emissiveTexture,Je)),Promise.all(c).then(function(){const d=new o(a);return r.name&&(d.name=r.name),Sc(d,r),t.associations.set(d,{materials:e}),r.extensions&&Dh(s,d,r),d})}createUniqueName(e){const t=kt.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,i=this.extensions,s=this.primitiveCache;function r(a){return i[Jt.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,t).then(function(l){return _B(l,a,t)})}const o=[];for(let a=0,l=e.length;a<l;a++){const c=e[a],u=DX(c),d=s[u];if(d)o.push(d.promise);else{let f;c.extensions&&c.extensions[Jt.KHR_DRACO_MESH_COMPRESSION]?f=r(c):f=_B(new ft,c,t),s[u]={primitive:c,promise:f},o.push(f)}}return Promise.all(o)}loadMesh(e){const t=this,i=this.json,s=this.extensions,r=i.meshes[e],o=r.primitives,a=[];for(let l=0,c=o.length;l<c;l++){const u=o[l].material===void 0?RX(this.cache):this.getDependency("material",o[l].material);a.push(u)}return a.push(t.loadGeometries(o)),Promise.all(a).then(function(l){const c=l.slice(0,l.length-1),u=l[l.length-1],d=[];for(let p=0,g=u.length;p<g;p++){const A=u[p],v=o[p];let m;const b=c[p];if(v.mode===lo.TRIANGLES||v.mode===lo.TRIANGLE_STRIP||v.mode===lo.TRIANGLE_FAN||v.mode===void 0)m=r.isSkinnedMesh===!0?new Yf(A,b):new ye(A,b),m.isSkinnedMesh===!0&&m.normalizeSkinWeights(),v.mode===lo.TRIANGLE_STRIP?m.geometry=AB(m.geometry,KE):v.mode===lo.TRIANGLE_FAN&&(m.geometry=AB(m.geometry,i0));else if(v.mode===lo.LINES)m=new wo(A,b);else if(v.mode===lo.LINE_STRIP)m=new dn(A,b);else if(v.mode===lo.LINE_LOOP)m=new hM(A,b);else if(v.mode===lo.POINTS)m=new uM(A,b);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+v.mode);Object.keys(m.geometry.morphAttributes).length>0&&BX(m,r),m.name=t.createUniqueName(r.name||"mesh_"+e),Sc(m,r),v.extensions&&Dh(s,m,v),t.assignFinalMaterial(m),d.push(m)}for(let p=0,g=d.length;p<g;p++)t.associations.set(d[p],{meshes:e,primitives:p});if(d.length===1)return r.extensions&&Dh(s,d[0],r),d[0];const f=new ar;r.extensions&&Dh(s,f,r),t.associations.set(f,{meshes:e});for(let p=0,g=d.length;p<g;p++)f.add(d[p]);return f})}loadCamera(e){let t;const i=this.json.cameras[e],s=i[i.type];if(!s){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return i.type==="perspective"?t=new qt(cs.radToDeg(s.yfov),s.aspectRatio||1,s.znear||1,s.zfar||2e6):i.type==="orthographic"&&(t=new rh(-s.xmag,s.xmag,s.ymag,-s.ymag,s.znear,s.zfar)),i.name&&(t.name=this.createUniqueName(i.name)),Sc(t,i),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],i=[];for(let s=0,r=t.joints.length;s<r;s++)i.push(this._loadNodeShallow(t.joints[s]));return t.inverseBindMatrices!==void 0?i.push(this.getDependency("accessor",t.inverseBindMatrices)):i.push(null),Promise.all(i).then(function(s){const r=s.pop(),o=s,a=[],l=[];for(let c=0,u=o.length;c<u;c++){const d=o[c];if(d){a.push(d);const f=new Ie;r!==null&&f.fromArray(r.array,c*16),l.push(f)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[c])}return new Jf(a,l)})}loadAnimation(e){const t=this.json,i=this,s=t.animations[e],r=s.name?s.name:"animation_"+e,o=[],a=[],l=[],c=[],u=[];let d=0,f=s.channels.length;for(d=0,f=s.channels.length;d<f;d++){const p=s.channels[d],g=s.samplers[p.sampler],A=p.target,v=A.node,m=s.parameters!==void 0?s.parameters[g.input]:g.input,b=s.parameters!==void 0?s.parameters[g.output]:g.output;A.node!==void 0&&(o.push(this.getDependency("node",v)),a.push(this.getDependency("accessor",m)),l.push(this.getDependency("accessor",b)),c.push(g),u.push(A))}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l),Promise.all(c),Promise.all(u)]).then(function(p){const g=p[0],A=p[1],v=p[2],m=p[3],b=p[4],y=[];for(d=0,f=g.length;d<f;d++){const _=g[d],E=A[d],M=v[d],I=m[d],R=b[d];if(_===void 0)continue;_.updateMatrix&&(_.updateMatrix(),_.matrixAutoUpdate=!0);const C=i._createAnimationTracks(_,E,M,I,R);if(C)for(let T=0;T<C.length;T++)y.push(C[T])}return new fr(r,void 0,y)})}createNodeMesh(e){const t=this.json,i=this,s=t.nodes[e];return s.mesh===void 0?null:i.getDependency("mesh",s.mesh).then(function(r){const o=i._getNodeRef(i.meshCache,s.mesh,r);return s.weights!==void 0&&o.traverse(function(a){if(a.isMesh)for(let l=0,c=s.weights.length;l<c;l++)a.morphTargetInfluences[l]=s.weights[l]}),o})}loadNode(e){const t=this.json,i=this,s=t.nodes[e],r=i._loadNodeShallow(e),o=[],a=s.children||[];for(let c=0,u=a.length;c<u;c++)o.push(i.getDependency("node",a[c]));const l=s.skin===void 0?Promise.resolve(null):i.getDependency("skin",s.skin);return Promise.all([r,Promise.all(o),l]).then(function(c){const u=c[0],d=c[1],f=c[2];f!==null&&u.traverse(function(p){p.isSkinnedMesh&&p.bind(f,kX)});for(let p=0,g=d.length;p<g;p++)u.add(d[p]);return u})}_loadNodeShallow(e){const t=this.json,i=this.extensions,s=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const r=t.nodes[e],o=r.name?s.createUniqueName(r.name):"",a=[],l=s._invokeOne(function(c){return c.createNodeMesh&&c.createNodeMesh(e)});return l&&a.push(l),r.camera!==void 0&&a.push(s.getDependency("camera",r.camera).then(function(c){return s._getNodeRef(s.cameraCache,r.camera,c)})),s._invokeAll(function(c){return c.createNodeAttachment&&c.createNodeAttachment(e)}).forEach(function(c){a.push(c)}),this.nodeCache[e]=Promise.all(a).then(function(c){let u;if(r.isBone===!0?u=new eA:c.length>1?u=new ar:c.length===1?u=c[0]:u=new Me,u!==c[0])for(let d=0,f=c.length;d<f;d++)u.add(c[d]);if(r.name&&(u.userData.name=r.name,u.name=o),Sc(u,r),r.extensions&&Dh(i,u,r),r.matrix!==void 0){const d=new Ie;d.fromArray(r.matrix),u.applyMatrix4(d)}else r.translation!==void 0&&u.position.fromArray(r.translation),r.rotation!==void 0&&u.quaternion.fromArray(r.rotation),r.scale!==void 0&&u.scale.fromArray(r.scale);return s.associations.has(u)||s.associations.set(u,{}),s.associations.get(u).nodes=e,u}),this.nodeCache[e]}loadScene(e){const t=this.extensions,i=this.json.scenes[e],s=this,r=new ar;i.name&&(r.name=s.createUniqueName(i.name)),Sc(r,i),i.extensions&&Dh(t,r,i);const o=i.nodes||[],a=[];for(let l=0,c=o.length;l<c;l++)a.push(s.getDependency("node",o[l]));return Promise.all(a).then(function(l){for(let u=0,d=l.length;u<d;u++)r.add(l[u]);const c=u=>{const d=new Map;for(const[f,p]of s.associations)(f instanceof Pt||f instanceof Rt)&&d.set(f,p);return u.traverse(f=>{const p=s.associations.get(f);p!=null&&d.set(f,p)}),d};return s.associations=c(r),r})}_createAnimationTracks(e,t,i,s,r){const o=[],a=e.name?e.name:e.uuid,l=[];pc[r.path]===pc.weights?e.traverse(function(f){f.morphTargetInfluences&&l.push(f.name?f.name:f.uuid)}):l.push(a);let c;switch(pc[r.path]){case pc.weights:c=Eu;break;case pc.rotation:c=Vl;break;case pc.position:case pc.scale:c=Kc;break;default:switch(i.itemSize){case 1:c=Eu;break;case 2:case 3:default:c=Kc;break}break}const u=s.interpolation!==void 0?IX[s.interpolation]:Jc,d=this._getArrayFromAccessor(i);for(let f=0,p=l.length;f<p;f++){const g=new c(l[f]+"."+pc[r.path],t.array,d,u);s.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(g),o.push(g)}return o}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const i=KC(t.constructor),s=new Float32Array(t.length);for(let r=0,o=t.length;r<o;r++)s[r]=t[r]*i;t=s}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(i){const s=this instanceof Vl?TX:VF;return new s(this.times,this.values,this.getValueSize()/3,i)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function FX(n,e,t){const i=e.attributes,s=new Bn;if(i.POSITION!==void 0){const a=t.json.accessors[i.POSITION],l=a.min,c=a.max;if(l!==void 0&&c!==void 0){if(s.set(new w(l[0],l[1],l[2]),new w(c[0],c[1],c[2])),a.normalized){const u=KC(mf[a.componentType]);s.min.multiplyScalar(u),s.max.multiplyScalar(u)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const r=e.targets;if(r!==void 0){const a=new w,l=new w;for(let c=0,u=r.length;c<u;c++){const d=r[c];if(d.POSITION!==void 0){const f=t.json.accessors[d.POSITION],p=f.min,g=f.max;if(p!==void 0&&g!==void 0){if(l.setX(Math.max(Math.abs(p[0]),Math.abs(g[0]))),l.setY(Math.max(Math.abs(p[1]),Math.abs(g[1]))),l.setZ(Math.max(Math.abs(p[2]),Math.abs(g[2]))),f.normalized){const A=KC(mf[f.componentType]);l.multiplyScalar(A)}a.max(l)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}s.expandByVector(a)}n.boundingBox=s;const o=new Ys;s.getCenter(o.center),o.radius=s.min.distanceTo(s.max)/2,n.boundingSphere=o}function _B(n,e,t){const i=e.attributes,s=[];function r(o,a){return t.getDependency("accessor",o).then(function(l){n.setAttribute(a,l)})}for(const o in i){const a=JC[o]||o.toLowerCase();a in n.attributes||s.push(r(i[o],a))}if(e.indices!==void 0&&!n.index){const o=t.getDependency("accessor",e.indices).then(function(a){n.setIndex(a)});s.push(o)}return Sc(n,e),FX(n,e,t),Promise.all(s).then(function(){return e.targets!==void 0?PX(n,e.targets,t):n})}var xB;(function(n){n[n.Fragment=35632]="Fragment",n[n.Vertex=35633]="Vertex"})(xB||(xB={}));var ZC;(function(n){n[n.INT=5124]="INT",n[n.FLOAT=5126]="FLOAT",n[n.FLOAT_VEC2=35664]="FLOAT_VEC2",n[n.FLOAT_VEC3=35665]="FLOAT_VEC3",n[n.FLOAT_VEC4=35666]="FLOAT_VEC4",n[n.INT_VEC2=35667]="INT_VEC2",n[n.INT_VEC3=35668]="INT_VEC3",n[n.INT_VEC4=35669]="INT_VEC4",n[n.BOOL=35670]="BOOL",n[n.BOOL_VEC2=35671]="BOOL_VEC2",n[n.BOOL_VEC3=35672]="BOOL_VEC3",n[n.BOOL_VEC4=35673]="BOOL_VEC4",n[n.FLOAT_MAT2=35674]="FLOAT_MAT2",n[n.FLOAT_MAT3=35675]="FLOAT_MAT3",n[n.FLOAT_MAT4=35676]="FLOAT_MAT4",n[n.SAMPLER_2D=35678]="SAMPLER_2D",n[n.SAMPLER_3D=35680]="SAMPLER_3D",n[n.SAMPLER_CUBE=35681]="SAMPLER_CUBE",n[n.UNKNOWN=0]="UNKNOWN"})(ZC||(ZC={}));const xa=re("debugcustomshader"),Cd="NEEDLE_techniques_webgl";var wB;(function(n){n[n.INT=5124]="INT",n[n.FLOAT=5126]="FLOAT",n[n.FLOAT_VEC2=35664]="FLOAT_VEC2",n[n.FLOAT_VEC3=35665]="FLOAT_VEC3",n[n.FLOAT_VEC4=35666]="FLOAT_VEC4",n[n.INT_VEC2=35667]="INT_VEC2",n[n.INT_VEC3=35668]="INT_VEC3",n[n.INT_VEC4=35669]="INT_VEC4",n[n.BOOL=35670]="BOOL",n[n.BOOL_VEC2=35671]="BOOL_VEC2",n[n.BOOL_VEC3=35672]="BOOL_VEC3",n[n.BOOL_VEC4=35673]="BOOL_VEC4",n[n.FLOAT_MAT2=35674]="FLOAT_MAT2",n[n.FLOAT_MAT3=35675]="FLOAT_MAT3",n[n.FLOAT_MAT4=35676]="FLOAT_MAT4",n[n.SAMPLER_2D=35678]="SAMPLER_2D",n[n.SAMPLER_3D=35680]="SAMPLER_3D",n[n.SAMPLER_CUBE=35681]="SAMPLER_CUBE",n[n.UNKNOWN=0]="UNKNOWN"})(wB||(wB={}));class UX{constructor(){h(this,"objectToWorldMatrix",new Ie);h(this,"worldToObjectMatrix",new Ie);h(this,"objectToWorld",new Array);h(this,"worldToObject",new Array)}updateFrom(e){this.objectToWorldMatrix.copy(e.matrixWorld),b0(this.objectToWorldMatrix,this.objectToWorld),this.worldToObjectMatrix.copy(e.matrixWorld).invert(),b0(this.worldToObjectMatrix,this.worldToObject)}}var Ug;(function(n){n[n.Off=0]="Off",n[n.Front=1]="Front",n[n.Back=2]="Back"})(Ug||(Ug={}));var fl;(function(n){n[n.Never=1]="Never",n[n.Less=2]="Less",n[n.Equal=3]="Equal",n[n.LEqual=4]="LEqual",n[n.Greater=5]="Greater",n[n.NotEqual=6]="NotEqual",n[n.GEqual=7]="GEqual",n[n.Always=8]="Always"})(fl||(fl={}));const Fi=class extends jb{constructor(t,...i){super(...i);h(this,"identifier");h(this,"onBeforeRenderSceneCallback",this.onBeforeRenderScene.bind(this));h(this,"_sphericalHarmonicsName","unity_SpecCube0");h(this,"_objToWorldName","hlslcc_mtx4x4unity_ObjectToWorld");h(this,"_worldToObjectName","hlslcc_mtx4x4unity_WorldToObject");h(this,"_viewProjectionName","hlslcc_mtx4x4unity_MatrixVP");h(this,"_viewMatrixName","hlslcc_mtx4x4unity_MatrixV");h(this,"_rendererData",new UX);this.identifier=t,xa&&console.log(this),this.type="NEEDLE_CUSTOM_SHADER",this.uniforms[this._objToWorldName]||(this.uniforms[this._objToWorldName]={value:[]}),this.uniforms[this._worldToObjectName]||(this.uniforms[this._worldToObjectName]={value:[]}),this.uniforms[this._viewProjectionName]||(this.uniforms[this._viewProjectionName]={value:[]}),this.uniforms[this._sphericalHarmonicsName]&&this.waitForLighting(),(this.depthTextureUniform||this.opaqueTextureUniform)&&Lt.Current.pre_render_callbacks.push(this.onBeforeRenderSceneCallback)}clone(){const t=super.clone();return HF(t),t}dispose(){super.dispose();const t=Lt.Current.pre_render_callbacks.indexOf(this.onBeforeRenderSceneCallback);t>=0&&Lt.Current.pre_render_callbacks.splice(t,1)}async waitForLighting(){const t=Lt.Current;if(!t){console.error("Missing context");return}const i=await t.sceneLighting.internalGetSceneLightingData(this.identifier);if(!i||!i.array){console.warn("Missing lighting data for custom shader, getSceneLightingData did not return anything");return}xa&&console.log(i);const s=i.array,r=i.texture;this.uniforms.unity_SpecCube0={value:r},fF(this.uniforms,s);const o=Math.sqrt(Math.PI*.5);this.uniforms.unity_SpecCube0_HDR={value:new Ke(o,o,o,o)},xa&&console.log("Set environment lighting",this.uniforms)}get depthTextureUniform(){if(this.uniforms)return this.uniforms._CameraDepthTexture}get opaqueTextureUniform(){if(this.uniforms)return this.uniforms._CameraOpaqueTexture}onBeforeRenderScene(){this.opaqueTextureUniform&&Lt.Current.setRequireColor(!0),this.depthTextureUniform&&Lt.Current.setRequireDepth(!0)}onBeforeRender(t,i,s,r,o,a){r.attributes.tangent||r.computeTangents(),this.onUpdateUniforms(s,o)}onUpdateUniforms(t,i){const s=Lt.Current;if(t&&(Fi.viewProjection&&this.uniforms[this._viewProjectionName]&&(Fi.viewProjection.copy(t.projectionMatrix).multiply(t.matrixWorldInverse),b0(Fi.viewProjection,Fi._viewProjectionValues)),Fi.viewMatrix&&this.uniforms[this._viewMatrixName]&&(Fi.viewMatrix.copy(t.matrixWorldInverse),b0(Fi.viewMatrix,Fi._viewMatrixValues)),this.uniforms[Fi._worldSpaceCameraPosName]&&Fi._worldSpaceCameraPos.setFromMatrixPosition(t.matrixWorld)),this.uniforms._TimeParameters&&(this.uniforms._TimeParameters.value=s.sceneLighting.timeVec4),this.uniforms._Time){const l=this.uniforms._Time.value;l.x=s.sceneLighting.timeVec4.x/20,l.y=s.sceneLighting.timeVec4.x,l.z=s.sceneLighting.timeVec4.x*2,l.w=s.sceneLighting.timeVec4.x*3}if(this.uniforms._SinTime){const l=this.uniforms._SinTime.value;l.x=Math.sin(s.sceneLighting.timeVec4.x/8),l.y=Math.sin(s.sceneLighting.timeVec4.x/4),l.z=Math.sin(s.sceneLighting.timeVec4.x/2),l.w=Math.sin(s.sceneLighting.timeVec4.x)}if(this.uniforms._CosTime){const l=this.uniforms._CosTime.value;l.x=Math.cos(s.sceneLighting.timeVec4.x/8),l.y=Math.cos(s.sceneLighting.timeVec4.x/4),l.z=Math.cos(s.sceneLighting.timeVec4.x/2),l.w=Math.cos(s.sceneLighting.timeVec4.x)}if(this.uniforms.unity_DeltaTime){const l=this.uniforms.unity_DeltaTime.value;l.x=s.time.deltaTime,l.y=1/s.time.deltaTime,l.z=s.time.smoothedDeltaTime,l.w=1/s.time.smoothedDeltaTime}const r=s.mainLight;if(r){const l=Mt(r.gameObject,Fi._mainLightPosition);this.uniforms._MainLightPosition={value:l.normalize()},Fi._mainLightColor.set(r.color.r,r.color.g,r.color.b,0),this.uniforms._MainLightColor={value:Fi._mainLightColor};const c=r.intensity;Fi._lightData.z=c,this.uniforms.unity_LightData={value:Fi._lightData}}if(t&&(Fi.viewProjection&&this.uniforms[this._viewProjectionName]&&(this.uniforms[this._viewProjectionName].value=Fi._viewProjectionValues),Fi.viewMatrix&&this.uniforms[this._viewMatrixName]&&(this.uniforms[this._viewMatrixName].value=Fi._viewMatrixValues),this.uniforms[Fi._worldSpaceCameraPosName]&&(this.uniforms[Fi._worldSpaceCameraPosName]={value:Fi._worldSpaceCameraPos}),s.mainCameraComponent)){if(this.uniforms._ProjectionParams){const l=this.uniforms._ProjectionParams.value;l.x=1,l.y=s.mainCameraComponent.nearClipPlane,l.z=s.mainCameraComponent.farClipPlane,l.w=1/l.z,this.uniforms._ProjectionParams.value=l}if(this.uniforms._ZBufferParams){const l=this.uniforms._ZBufferParams.value,c=s.mainCameraComponent;l.x=1-c.farClipPlane/c.nearClipPlane,l.y=c.farClipPlane/c.nearClipPlane,l.z=l.x/c.farClipPlane,l.w=l.y/c.farClipPlane,this.uniforms._ZBufferParams.value=l}if(this.uniforms._ScreenParams){const l=this.uniforms._ScreenParams.value;l.x=s.domWidth,l.y=s.domHeight,l.z=1+1/l.x,l.w=1+1/l.y,this.uniforms._ScreenParams.value=l}}const o=this.depthTextureUniform;o&&(o.value=s.depthTexture);const a=this.opaqueTextureUniform;if(a&&(a.value=s.opaqueColorTexture),i){const l=this._rendererData;l.updateFrom(i),this.uniforms[this._worldToObjectName].value=l.worldToObject,this.uniforms[this._objToWorldName].value=l.objectToWorld}this.uniformsNeedUpdate=!0}};let so=Fi;h(so,"viewProjection",new Ie),h(so,"_viewProjectionValues",[]),h(so,"viewMatrix",new Ie),h(so,"_viewMatrixValues",[]),h(so,"_worldSpaceCameraPosName","_WorldSpaceCameraPos"),h(so,"_worldSpaceCameraPos",new w),h(so,"_mainLightColor",new Ke),h(so,"_mainLightPosition",new w),h(so,"_lightData",new Ke);class NX{constructor(e,t){h(this,"parser");h(this,"identifier");this.parser=e,this.identifier=t}get name(){return Cd}loadMaterial(e){const t=this.parser.json.materials[e];if(!t)return xa&&console.log(e,this.parser.json.materials),null;if(!t.extensions||!t.extensions[Cd])return xa&&console.log("material "+e+" does not use NEEDLE_techniques_webgl"),null;const i=t.extensions[Cd].technique;if(i<0)return null;const s=this.parser.json.extensions[Cd];if(!s)return null;xa&&console.log(s);const r=s.techniques[i];return r?new Promise(async(o,a)=>{var m,b,y;const l=await Q6(s,r.program),c=l==null?void 0:l.fragmentShader,u=l==null?void 0:l.vertexShader;if(!c||!u)return a();xa&&console.log("loadMaterial",t,l);const d={},f=r.uniforms;(u.includes("_Time")||c.includes("_Time"))&&(d._Time={value:new Ke(0,0,0,0)}),(u.includes("_SinTime")||c.includes("_SinTime"))&&(d._SinTime={value:new Ke(0,0,0,0)}),(u.includes("_CosTime")||c.includes("_CosTime"))&&(d._CosTime={value:new Ke(0,0,0,0)}),(u.includes("unity_DeltaTime")||c.includes("unity_DeltaTime"))&&(d.unity_DeltaTime={value:new Ke(0,0,0,0)});for(const _ in f){const E=_;switch(E){case"_TimeParameters":const M=new Ke;d[E]={value:M};break;case"hlslcc_mtx4x4unity_MatrixV":case"hlslcc_mtx4x4unity_MatrixVP":d[E]={value:[]};break;case"_MainLightPosition":case"_MainLightColor":case"_WorldSpaceCameraPos":d[E]={value:[0,0,0,1]};break;case"unity_OrthoParams":break;case"unity_SpecCube0":d[E]={value:null};break;default:case"_ScreenParams":case"_ZBufferParams":case"_ProjectionParams":d[E]={value:[0,0,0,0]};break;case"_CameraOpaqueTexture":case"_CameraDepthTexture":d[E]={value:null};break}}let p=!1;if(t.extensions&&t.extensions[Cd]){const _=t.extensions[Cd];if(_.technique===i){xa&&console.log(t.name,"Material Properties",_);for(const E in _.values){const M=_.values[E];if(typeof M=="string"){if(M.startsWith("/textures/")){const I=M.substring(10),R=Number.parseInt(I);if(R>=0){const C=await this.parser.getDependency("texture",R);C instanceof Rt&&(C.colorSpace=gn,C.needsUpdate=!0),d[E]={value:C};continue}}switch(E){case"alphaMode":M==="BLEND"&&(p=!0);continue}}if(Array.isArray(M)&&M.length===4){d[E]={value:new Ke(M[0],M[1],M[2],M[3])};continue}d[E]={value:M}}}}const g=new so(this.identifier,{name:t.name??"",uniforms:d,vertexShader:u,fragmentShader:c,lights:!1});switch(g.glslVersion=n0,g.vertexShader=g.vertexShader.replace("#version 300 es",""),g.fragmentShader=g.fragmentShader.replace("#version 300 es",""),(m=d._Cull)==null?void 0:m.value){case Ug.Off:g.side=wi;break;case Ug.Front:g.side=fn;break;case Ug.Back:g.side=Es;break;default:g.side=Es;break}switch((b=d._ZTest)==null?void 0:b.value){case fl.Equal:g.depthTest=!0,g.depthFunc=If;break;case fl.NotEqual:g.depthTest=!0,g.depthFunc=Xm;break;case fl.Less:g.depthTest=!0,g.depthFunc=um;break;case fl.LEqual:g.depthTest=!0,g.depthFunc=Tf;break;case fl.Greater:g.depthTest=!0,g.depthFunc=mb;break;case fl.GEqual:g.depthTest=!0,g.depthFunc=gb;break;case fl.Always:g.depthTest=!1,g.depthFunc=pb;break}g.transparent=p,p&&(g.depthWrite=!1),fF(d),g.onUpdateUniforms();for(const _ in f){const E=_,M=f[_].type;if(((y=d[E])==null?void 0:y.value)===void 0)switch(M){case ZC.SAMPLER_2D:d[E]={value:G6},console.warn("Missing/unassigned texture, fallback to white: "+E);break;default:E==="unity_OrthoParams"||console.warn("TODO: EXPECTED UNIFORM / fallback NOT SET: "+E,f[_]);break}}xa&&console.log(g.uuid,d),HF(g),o(g)}):null}}function HF(n){if(n.uniforms){xa&&console.log("Uniforms:",n.uniforms);for(const t in n.uniforms)switch(e(t,t),t){case"_Color":e("color",t);break}}function e(t,i){Object.getOwnPropertyDescriptor(n,t)||Object.defineProperty(n,t,{get:()=>n.uniforms[i].value,set:s=>{n.uniforms[i].value=s,n.needsUpdate=!0}})}}const al=ws,zv="$___Export_Components",zX="NEEDLE_components";var ese;class GX{constructor(){h(this,ese)}}ese=Ld;class VX{constructor(e,t,i){h(this,"node");h(this,"nodeIndex");h(this,"nodeDef");this.node=e,this.nodeIndex=t,this.nodeDef=i}}class QF{constructor(){h(this,"parser");h(this,"nodeToObjectMap",{});h(this,"exportContext");h(this,"objectToNodeMap",{});h(this,"context");h(this,"writer")}get name(){return zX}registerExport(e){e.register(t=>{if("serializeUserData"in t){const i=t.serializeUserData.bind(t);this.writer=t,t.serializeUserData=(s,r)=>{try{this.serializeUserData(s,r),i(s,r)}finally{this.afterSerializeUserData(s,r)}}}return this})}beforeParse(){this.exportContext={},this.objectToNodeMap={}}serializeUserData(e,t){var s;const i=(s=e.userData)==null?void 0:s.components;!i||i.length<=0||(delete e.userData.components,e[zv]=i)}afterSerializeUserData(e,t){if(e.type==="Scene"&&al&&console.log("DONE",JSON.stringify(t)),e[zv]===void 0)return;const i=e[zv];delete e[zv],i!==null&&(e.userData.components=i)}writeNode(e,t){const i=this.writer.json.nodes.length;al&&console.log(e.name,i,e.uuid);const s=new VX(e,i,t);this.exportContext[i]=s,this.objectToNodeMap[e.uuid]=i}afterParse(e){var t;al&&console.log("AFTER",e);for(const i in this.exportContext){const s=this.exportContext[i],r=s.node,o=s.nodeDef,a=s.nodeIndex,l=(t=r.userData)==null?void 0:t.components;if(!l||l.length<=0)continue;const c=new GX;o.extensions=o.extensions||{},o.extensions[this.name]=c,this.context.object=r,this.context.nodeId=a,this.context.objectToNode=this.objectToNodeMap;const u=[];for(const d of l){this.context.target=d;const f=Ga().writeBuiltinComponentData(d,this.context);f!==null&&u.push(f)}u.length>0&&(c[Ld]=u,al&&console.log("DID WRITE",r,"nodeIndex",a,u))}}beforeRoot(){return al&&console.log("BEGIN LOAD"),this.nodeToObjectMap={},null}async afterRoot(e){const t=e.parser,i=t==null?void 0:t.extensions;if(!i)return;const s=i[this.name];al&&console.log("After root",e,this.parser,i);const r=[];if(s===!0){const o=t.json.nodes;if(o){for(let a=0;a<o.length;a++){const l=await t.getDependency("node",a);this.nodeToObjectMap[a]=l}for(let a=0;a<o.length;a++){const l=o[a],c=a,u=l.extensions;if(!u)continue;const d=u[this.name];if(!d)continue;al&&console.log("NODE",l);const f=this.nodeToObjectMap[c];if(!f){console.error("Could not find object for node index: "+c,l,t);continue}$M(f),r.push(this.createComponents(f,d))}}}await Promise.all(r)}async createComponents(e,t){if(!t)return;const i=t[Ld];if(i){const s=new Array;al&&console.log(e.name,i);for(const r in i){const o=i[r];al&&console.log("Serialized data",JSON.parse(JSON.stringify(o))),o&&this.parser&&s.push(eT(this.parser,o).catch(a=>console.error(`Error while resolving references (see console for details)
`,a,e,o))),e.userData=e.userData||{},e.userData[Ld]=e.userData[Ld]||[],e.userData[Ld].push(o)}await Promise.all(s).catch(r=>{console.error("Error while loading components",r)})}}}const Pw=re("debugexr");class HX{constructor(e){h(this,"parser");this.parser=e,Pw&&console.log(e)}get name(){return"EXT_texture_exr"}loadTexture(e){const t=this.name,i=this.parser,r=i.json.textures[e];if(Pw&&console.log("EXT_texture_exr.loadTexture",e,r),!r.extensions||!r.extensions[t])return null;const o=r.extensions[t],a=new x0(i.options.manager);return Pw&&console.log("EXT_texture_exr.loadTexture",o),i.loadTextureImage(e,o.source,a)}}typeof window<"u"&&window.addEventListener("unhandledrejection",n=>{});const SB="NEEDLE_gameobject_data";class QX{constructor(e){h(this,"parser");this.parser=e}get name(){return SB}afterRoot(e){var i;const t=[];for(let s=0;s<((i=this.parser.json.nodes)==null?void 0:i.length);s++){const r=this.parser.json.nodes[s];if(r&&r.extensions){const o=r.extensions[SB];if(o){const a=this.findAndApplyExtensionData(s,o);t.push(a)}}}return Promise.all(t).then(()=>{})}async findAndApplyExtensionData(e,t){const i=await this.parser.getDependency("node",e);i&&this.applyExtensionData(i,t)}applyExtensionData(e,t){t.layers===void 0&&(t.layers=0),e.userData.layer=t.layers,e.layers.disableAll(),e.layers.set(t.layers),e.userData.tag=t.tag??"none",e.userData.hideFlags=t.hideFlags??0,e.userData.static=t.static??!1,e.visible=t.activeSelf??!0,e.guid=t.guid}}const CB="NEEDLE_lighting_settings",Gh=re("debugenvlight");class WX{constructor(e,t,i){h(this,"parser");h(this,"sourceId");h(this,"context");this.parser=e,this.sourceId=t,this.context=i}get name(){return CB}afterRoot(e){const t=this.parser.json.extensions;if(t){const i=t[CB];if(i){Gh&&console.log('Loaded "'+this.name+'", src: "'+this.sourceId+'"',i);let s;if(e.scene.children.length===1){const r=e.scene.children[0];s=ne.addNewComponent(r,$C,!1)}else{const r=new Me;r.name="LightSettings "+this.sourceId,e.scene.add(r),s=ne.addNewComponent(r,$C,!1)}s.sourceId=this.sourceId,s.ambientIntensity=i.ambientIntensity,s.ambientLight=new _e().fromArray(i.ambientLight),Array.isArray(i.ambientTrilight)&&(s.ambientTrilight=i.ambientTrilight.map(r=>new _e().fromArray(r))),s.ambientMode=i.ambientMode,s.environmentReflectionSource=i.environmentReflectionSource}}return null}}en.registerCallback(Qn.ContextCreated,n=>{const e=n.context,t=ne.findObjectOfType($C,e);t!=null&&t.sourceId&&(t.enabled=!0)});class $C extends Te{constructor(){super(...arguments);h(this,"ambientMode",Ea.Skybox);h(this,"ambientLight");h(this,"ambientTrilight");h(this,"ambientIntensity",1);h(this,"environmentReflectionSource",Im.Skybox);h(this,"_hasReflection",!1);h(this,"_ambientLightObj");h(this,"_hemisphereLightObj");h(this,"_lightProbeObj")}awake(){var i;if(this.sourceId){const s=this.environmentReflectionSource===Im.Skybox?Oa.Skybox:Oa.Reflection,r=this.context.lightmaps.tryGet(this.sourceId,s,0);this._hasReflection=r!=null,r&&this.context.sceneLighting.internalRegisterReflection(this.sourceId,r)}this.enabled=!1,this.context.sceneLighting.internalRegisterSceneLightSettings(this),Gh&&window.addEventListener("keydown",s=>{if(!this.destroyed)switch(s.key){case"l":this.enabled=!this.enabled;break}});const t=(i=this.gameObject.userData)==null?void 0:i.components;if(t){const s=t.indexOf(this);t.splice(s,1),t.push(this)}}onDestroy(){this.context.sceneLighting.internalUnregisterSceneLightSettings(this)}calculateIntensityFactor(t){const i=Math.max(t.r,t.g,t.b);return 2.2*tt.lerp(0,1.33,i)}onEnable(){if(Gh&&console.warn(" >>> Enable lighting",this.sourceId,this.enabled,this),this.ambientMode==Ea.Flat){if(this.ambientLight&&!this._ambientLightObj){const t=this.calculateIntensityFactor(this.ambientLight);this._ambientLightObj=new MM(this.ambientLight,this.ambientIntensity*t),Gh&&console.log("Created ambient light",this.sourceId,this._ambientLightObj,this.ambientIntensity,t)}this._ambientLightObj&&this.gameObject.add(this._ambientLightObj),this._lightProbeObj&&this._lightProbeObj.removeFromParent()}else if(this.ambientMode===Ea.Trilight){if(this.ambientTrilight){const t=this.ambientTrilight[0],i=this.ambientTrilight[this.ambientTrilight.length-1],s=this.calculateIntensityFactor(i);this._hemisphereLightObj=new CM(i,t,this.ambientIntensity*s),this.gameObject.add(this._hemisphereLightObj),Gh&&console.log("Created hemisphere ambient light",this.sourceId,this._hemisphereLightObj,this.ambientIntensity,s)}}else this._ambientLightObj&&this._ambientLightObj.removeFromParent(),this._hemisphereLightObj&&this._hemisphereLightObj.removeFromParent(),this._lightProbeObj?this.enabled&&this.destroyed&&this._lightProbeObj&&this.gameObject.add(this._lightProbeObj):this.sourceId&&this.context.sceneLighting.internalGetSceneLightingData(this.sourceId).then(t=>{t&&(this._lightProbeObj=t.lightProbe,this.enabled&&!this.destroyed&&this._lightProbeObj&&(Gh&&console.log("Add",this.sourceId,t),this.gameObject.add(this._lightProbeObj)))});this.sourceId&&this.context.sceneLighting.internalEnableReflection(this.sourceId)}onDisable(){Gh&&console.warn(" <<< Disable lighting:",this.sourceId,this),this._lightProbeObj&&this._lightProbeObj.removeFromParent(),this._ambientLightObj&&this._ambientLightObj.removeFromParent(),this._hemisphereLightObj&&this._hemisphereLightObj.removeFromParent(),this.sourceId&&this.context.sceneLighting.internalDisableReflection(this.sourceId)}}const Bw=re("debugstencil");function jX(n,e){return(n&1<<e.layer)!=0}const qX=Symbol("stencils"),$h=class{constructor(e,t){h(this,"parser");h(this,"source");this.parser=e,this.source=t}get name(){return"NEEDLE_render_objects"}static applyStencil(e){if(!e)return;const t=e.sourceId;if(Bw&&console.log(t,$h.stencils),!t)return;const i=$h.stencils[t];if(i)for(let s=i.length-1;s>=0;s--){const r=i[s];if(jX(r.layer,e)){Bw&&console.log(r),setTimeout(()=>{Ar()&&iT(e.gameObject)&&(Rs("Stencil not supported on instanced objects"),console.warn("Stencil not supported on instanced objects",e))},500);for(let o=0;o<e.sharedMaterials.length;o++){let a=e.sharedMaterials[o];a&&(a=a.clone(),a[qX]=!0,a.stencilWrite=!0,a.stencilWriteMask=255,a.stencilFuncMask=255,a.stencilRef=r.value,a.stencilFunc=r.compareFunc,a.stencilZPass=r.passOp,a.stencilFail=r.failOp,a.stencilZFail=r.zFailOp,e.sharedMaterials[o]=a)}e.gameObject.renderOrder=r.event*1e3+r.index*50;break}}}afterRoot(e){const t=this.parser.json.extensions;if(t){const i=t[YX];if(i){Bw&&console.log(i);const s=i.stencil;if(s&&Array.isArray(s))for(const r of s){const o={...r};o.compareFunc=XX(o.compareFunc),o.passOp=Dw(o.passOp),o.failOp=Dw(o.failOp),o.zFailOp=Dw(o.zFailOp),$h.stencils[this.source]||($h.stencils[this.source]=[]),$h.stencils[this.source].push(o)}}}return null}};let Ng=$h;h(Ng,"stencils",{});var ua;(function(n){n[n.Keep=0]="Keep",n[n.Zero=1]="Zero",n[n.Replace=2]="Replace",n[n.IncrementSaturate=3]="IncrementSaturate",n[n.DecrementSaturate=4]="DecrementSaturate",n[n.Invert=5]="Invert",n[n.IncrementWrap=6]="IncrementWrap",n[n.DecrementWrap=7]="DecrementWrap"})(ua||(ua={}));var da;(function(n){n[n.Disabled=0]="Disabled",n[n.Never=1]="Never",n[n.Less=2]="Less",n[n.Equal=3]="Equal",n[n.LessEqual=4]="LessEqual",n[n.Greater=5]="Greater",n[n.NotEqual=6]="NotEqual",n[n.GreaterEqual=7]="GreaterEqual",n[n.Always=8]="Always"})(da||(da={}));function Dw(n){switch(n){case ua.Keep:return Sg;case ua.Zero:return sk;case ua.Replace:return rk;case ua.IncrementSaturate:return ok;case ua.DecrementSaturate:return ak;case ua.IncrementWrap:return lk;case ua.DecrementWrap:return ck;case ua.Invert:return hk}return 0}function XX(n){switch(n){case da.Never:return KS;case da.Less:return uk;case da.Equal:return dk;case da.LessEqual:return fk;case da.Greater:return pk;case da.NotEqual:return gk;case da.GreaterEqual:return mk;case da.Always:return $E}return KS}const YX="NEEDLE_render_objects",Ow="NEEDLE_progressive",Tn=re("debugprogressive"),kw=Symbol("needle-progressive-texture"),eE=new Map;let Lw=!1;Tn&&window.addEventListener("keyup",n=>{n.key==="p"&&(eE.forEach((e,t)=>{Object.entries(e).forEach(([i,s])=>{Lw?t[i]=s.lod0:t[i]=s.original,t.needsUpdate=!0})}),Lw=!Lw)});const rm=class{constructor(e,t,i){h(this,"parser");h(this,"sourceId");h(this,"context");this.parser=e,this.sourceId=t,this.context=i}get name(){return Ow}static assignTextureLOD(e,t,i,s=0){if(!i)return Promise.resolve(null);const r=[];if(i instanceof jb)for(const o of Object.keys(i.uniforms)){const a=i.uniforms[o].value;if(a instanceof Rt){const l=this.assignTextureLODForSlot(e,t,i,s,o,a);r.push(l)}}else for(const o of Object.keys(i)){const a=i[o];if(a instanceof Rt){const l=this.assignTextureLODForSlot(e,t,i,s,o,a);r.push(l)}}return UM(r)}static assignTextureLODForSlot(e,t,i,s,r,o){return(o==null?void 0:o.isTexture)!==!0?Promise.resolve(null):(Tn&&console.log(`-----------
`,"FIND",i.name,r,o==null?void 0:o.name,o==null?void 0:o.userData,o,i),rm.getOrLoadTexture(e,t,i,r,o,s).then(a=>{if((a==null?void 0:a.isTexture)===!0){if(Tn&&console.warn("Assign LOD",i.name,r,a.name,a.guid,i,"Prev:",o,"Now:",a,`
--------------`),i[r]=a,a.needsUpdate=!0,i.needsUpdate=!0,Tn){let l=eE.get(i);l||(l={},eE.set(i,l));let c=l[r];c||(c=l[r]={original:o,lod0:a}),c.lod0=a}return a}return null}))}afterRoot(e){var t;return Tn&&console.log("AFTER",this.sourceId,e),(t=this.parser.json.textures)==null||t.forEach((i,s)=>{if(i!=null&&i.extensions){const r=i==null?void 0:i.extensions[Ow];r&&this.parser.getDependency("texture",s).then(a=>{Tn&&console.log("> Progressive: register",a.name,a.uuid,r),a.source&&(a.source[kw]=r),rm.cache.set(a.uuid,r)})}}),null}static async getOrLoadTexture(e,t,i,s,r,o){var c,u;const a=r.uuid;let l;if(r.source&&r.source[kw]&&(l=r.source[kw]),l||(l=rm.cache.get(a)),l){Tn&&console.log(a,l.uri,l.guid);const d=Nu(t,l.uri);if(d.endsWith(".glb")||d.endsWith(".gltf")){if(!l.guid)return console.warn("missing pointer for glb/gltf texture",l),null;const f=d+"_"+l.guid;if(this.resolved[f]){let g=this.resolved[f];if((c=g.image)!=null&&c.data||(u=g.source)!=null&&u.data)return Tn&&console.log("Texture has already been loaded: "+f,i.name,s,r.name,g),g=this.copySettings(r,g),g;g&&Tn&&console.warn("Texture has been disposed, will load again: "+f,i.name,s,r.name,g.source.data)}const p=this.onProgressiveLoadStart(e,t,d,i,s);try{if(this.currentlyLoading[f]!==void 0){Tn&&console.log("Already loading:",i.name+"."+s,f);let m=await this.currentlyLoading[f];return m&&(m=this.copySettings(r,m)),m}const g=l,A=new Promise(async(m,b)=>{var C;const y=new sp;cA(y,e),Tn&&console.warn("Start loading "+d,i.name,s,g.guid),Tn&&await Tu(Math.random()*1e3);const _=await y.loadAsync(d),E=_.parser;Tn&&console.log("Loading finished "+d,i.name,s,g.guid);let M=-1,I=!1;if(!((C=_.parser.json)!=null&&C.textures))return Tn&&console.warn("No textures in glTF "+d+" - may be a bug",i.name,s,g.guid),m(null);for(const T of _.parser.json.textures)if(M++,T!=null&&T.extensions){const O=T==null?void 0:T.extensions[Ow];if(O!=null&&O.guid&&O.guid===g.guid){I=!0;break}}if(!I)return m(null);let R=await E.getDependency("texture",M);R=this.copySettings(r,R),R&&(R.guid=g.guid),this.resolved[f]=R,Tn&&console.log(i.name,s,'change "'+r.name+'"  "'+R.name+'"',d,M,R,i,f),m(R)});return this.currentlyLoading[f]=A,await A}finally{delete this.currentlyLoading[f],this.onProgressiveLoadEnd(p)}}else{const f=this.onProgressiveLoadStart(e,t,d,i,s);try{Tn&&console.log("Load texture from uri: "+d);const g=await new kl().loadAsync(d);return g?(g.guid=l.guid,g.flipY=!1,g.needsUpdate=!0,g.colorSpace=r.colorSpace,Tn&&console.log(l,g)):Tn&&console.warn("failed loading",d),g}finally{this.onProgressiveLoadEnd(f)}}}else Tn&&console.warn("unknown texture",r.name,r.uuid,r);return null}static copySettings(e,t){const i=e.clone(),s=t.source,r=t.mipmaps;return i.copy(e),i.source=s,i.mipmaps=r,i}static beginListenStart(e,t){this._progressiveEventListeners.has(e)||this._progressiveEventListeners.set(e,new EB),this._progressiveEventListeners.get(e).start.push(t)}static stopListenStart(e,t){if(!this._progressiveEventListeners.has(e))return;const i=this._progressiveEventListeners.get(e).start,s=i.indexOf(t);s>=0&&i.splice(s,1)}static beginListenEnd(e,t){this._progressiveEventListeners.has(e)||this._progressiveEventListeners.set(e,new EB),this._progressiveEventListeners.get(e).end.push(t)}static stopListenEnd(e,t){if(!this._progressiveEventListeners.has(e))return;const i=this._progressiveEventListeners.get(e).end,s=i.indexOf(t);s>=0&&i.splice(s,1)}static onProgressiveLoadStart(e,t,i,s,r){this._currentProgressiveLoadingInfo.has(e)||this._currentProgressiveLoadingInfo.set(e,[]);const o=new JX(e,t,i,s,r),a=this._currentProgressiveLoadingInfo.get(e),l=this._progressiveEventListeners.get(e);return l&&l.onStart(o),a.push(o),o}static onProgressiveLoadEnd(e){if(!e)return;const t=e.context;if(!this._currentProgressiveLoadingInfo.has(t))return;const i=this._currentProgressiveLoadingInfo.get(t),s=i.indexOf(e);if(s<0)return;i.splice(s,1);const r=this._progressiveEventListeners.get(t);r&&r.onEnd(e)}};let fo=rm;h(fo,"cache",new Map),h(fo,"resolved",{}),h(fo,"currentlyLoading",{}),h(fo,"_progressiveEventListeners",new Map),h(fo,"_currentProgressiveLoadingInfo",new Map);class JX{constructor(e,t,i,s,r){h(this,"context");h(this,"source");h(this,"uri");h(this,"material");h(this,"slot");this.context=e,this.source=t,this.uri=i,this.material=s,this.slot=r}}class EB{constructor(){h(this,"start",[]);h(this,"end",[])}onStart(e){for(const t of this.start)t(e)}onEnd(e){for(const t of this.end)t(e)}}const KX=re("debugextensions");let w0;const ZX=e_(()=>import("./GLTFLoaderAnimationPointer-5b3e7b46.js"),[],import.meta.url).then(async n=>(w0=n.GLTFAnimationPointerExtension,w0)).catch(n=>{console.warn("Failed to import GLTFLoaderAnimationPointer. Please use @needle-tools/three for full KHR_animation support",n)}),$X=new Array;function WF(n){const e=new QF;return n.register(t=>(e.parser=t,e)),e}class eY{resolvePath(e){return e.includes("/extensions/builtin_components/")?e.replace("/extensions/builtin_components/","/userData/components/"):e.includes("extensions/builtin_components/")?e.replace("extensions/builtin_components/","/userData/components/"):e}}async function tY(n,e,t){const i=t.lastIndexOf("?");i>=0&&(t=t.substring(0,i)),n.register(s=>new QX(s)),n.register(s=>new pj(s)),n.register(s=>new wq(s,e.lightmaps,t)),n.register(s=>new WX(s,t,e)),n.register(s=>new NX(s,t)),n.register(s=>new Ng(s,t)),n.register(s=>new fo(s,t,e)),n.register(s=>new HX(s)),Tj()&&n.register(s=>new Bg(s));for(const s of $X)n.register(r=>new s(r));await ZX.catch(s=>{}),n.register(s=>{if(w0){const r=new w0(s);return r.setAnimationPointerResolver.bind(r)(new eY),r}else return(KX||si())&&console.error("Missing KHR_animation_pointer extension..."),{name:"KHR_animation_pointer_NOT_AVAILABLE"}})}const Fw=re("debuglightmaps");class S0{constructor(e,t){h(this,"lightmapIndex",-1);h(this,"lightmapScaleOffset",new Ke(1,1,0,0));h(this,"context");h(this,"gameObject");h(this,"lightmapTexture",null);h(this,"lightmapScaleOffsetUniform",{value:new Ke(1,1,0,0)});h(this,"lightmapUniform",{value:null});h(this,"onBeforeCompile",(e,t)=>{Fw&&console.log("Lightmaps, before compile",e),e.lightMapUv="uv1",this.lightmapScaleOffsetUniform.value=this.lightmapScaleOffset,this.lightmapUniform.value=this.lightmapTexture,e.uniforms.lightmapScaleOffset=this.lightmapScaleOffsetUniform});this.gameObject=e,this.context=t}get lightmap(){return this.lightmapTexture}set lightmap(e){e!==this.lightmapTexture&&(this.lightmapTexture=e,this.applyLightmap())}init(e,t,i){console.assert(this.gameObject!==void 0&&this.gameObject!==null,"Missing gameobject",this),this.lightmapIndex=e,!(this.lightmapIndex<0)&&(this.lightmapScaleOffset=t,this.lightmapTexture=i,Fw&&(console.log("Lightmap:",this.gameObject.name,e,`
ScaleOffset:`,t,`
Texture:`,i),this.setLightmapDebugMaterial()),this.applyLightmap())}updateLightmapUniforms(e){const t=e.uniforms;t&&t.lightmap&&(this.lightmapScaleOffsetUniform.value=this.lightmapScaleOffset,t.lightmapScaleOffset=this.lightmapScaleOffsetUniform)}applyLightmap(){if(this.gameObject.type==="Object3D"){Fw&&console.warn("Can not add lightmap. Is this object missing a renderer?",this.gameObject.name);return}if(this.gameObject.type==="Group"){console.warn("Lightmap on multimaterial object is not supported yet... please open a feature request on https://github.com/needle-tools/needle-engine-support if your project requires it");return}console.assert(this.gameObject.type==="Mesh","Lightmap only works on meshes",this);const e=this.gameObject;if(e.geometry.getAttribute("uv1")||e.geometry.setAttribute("uv1",e.geometry.getAttribute("uv")),Array.isArray(this.gameObject.material)){const t=this.gameObject.material;for(let i=0;i<t.length;i++){const r=t[i].clone();t[i]=r,r.onBeforeCompile=this.onBeforeCompile}}else{const t=this.gameObject.material.clone();this.gameObject.material=t,this.gameObject.material.onBeforeCompile=this.onBeforeCompile}if(this.lightmapIndex>=0&&this.lightmapTexture){const t=this.gameObject.material;t&&(t.lightMap=this.lightmapTexture,t.needsUpdate=!0)}}setLightmapDebugMaterial(){this.gameObject.material=new Bt({vertexShader:`
                varying vec2 vUv1;
                void main()
                {
                    vUv1 = uv1;
                    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
                }
                `,fragmentShader:`
                uniform sampler2D lightMap;
                uniform float lightMapIntensity;
                uniform vec4 lightmapScaleOffset;
                varying vec2 vUv1;

                // took from threejs 05fc79cd52b79e8c3e8dec1e7dca72c5c39983a4
                vec4 conv_sRGBToLinear( in vec4 value ) {
                    return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
                }

                void main() {
                    vec2 lUv = vUv1.xy * lightmapScaleOffset.xy + vec2(lightmapScaleOffset.z, (1. - (lightmapScaleOffset.y + lightmapScaleOffset.w)));
                    
                    vec4 lightMapTexel = texture2D( lightMap, lUv);
                    gl_FragColor = lightMapTexel;
                    gl_FragColor.a = 1.;
                }
                `,defines:{USE_LIGHTMAP:""}})}}const hA=function(n){return x(n)},x=function(n){if(n===void 0&&(n=null),!Array.isArray(n))n=MB(n);else for(let e=0;e<n.length;e++){const t=n[e];n[e]=MB(t)}return function(e,t){typeof t!="string"&&(t=t.name),Object.getOwnPropertyDescriptor(e,"$serializedTypes")||(e.$serializedTypes={});const i=e.$serializedTypes=e.$serializedTypes||{};i[t]=n}};function MB(n){var e,t;switch((t=(e=n==null?void 0:n.prototype)==null?void 0:e.constructor)==null?void 0:t.name){case"Number":case"String":case"Boolean":return null}return n}class Si extends _e{constructor(t,i,s,r){super(t,i,s);h(this,"alpha",1);this.alpha=r}get isRGBAColor(){return!0}set a(t){this.alpha=t}get a(){return this.alpha}clone(){const t=super.clone();return t.alpha=this.alpha,t}copy(t){return super.copy(t),"alpha"in t&&typeof t.alpha=="number"?this.alpha=t.alpha:typeof t.a=="number"&&(this.alpha=t.a),this}lerp(t,i){const s=t;return s.alpha&&(this.alpha=tt.lerp(this.alpha,s.alpha,i)),super.lerp(t,i)}lerpColors(t,i,s){const r=t,o=i;return r.alpha&&o.alpha&&(this.alpha=tt.lerp(r.alpha,o.alpha,s)),super.lerpColors(t,i,s)}multiply(t){const i=t;return i.alpha&&(this.alpha=this.alpha*i.alpha),super.multiply(t)}fromArray(t,i=0){return this.alpha=t[i+3],super.fromArray(t,i)}}class Pm{constructor(e,t){h(this,"method");h(this,"enabled");this.method=e,this.enabled=t!==void 0?t:!0}invoke(...e){if(this.enabled!==!1){if(!this.method){console.warn("No function. Please check you assigned a method to invoke on export",this);return}this.method(...e)}}}const iY=n=>/^[A-Z]*$/.test(n);class AT extends Event{constructor(){super(...arguments);h(this,"args")}}class qn{constructor(e){h(this,"isEventList",!0);h(this,"target");h(this,"key");h(this,"_isInvoking",!1);h(this,"methods",[]);this.methods=e??[]}setEventTarget(e,t){if(this.key=e,this.target=t,this.key!==void 0){let i="",s=!1;for(const r of this.key)s&&iY(r)&&(i+="-"),s=!0,i+=r.toLowerCase();this.key=i}}get listenerCount(){var e;return((e=this.methods)==null?void 0:e.length)??0}get isInvoking(){return this._isInvoking}invoke(...e){var t;if(this._isInvoking)return console.warn("Circular event invocation detected. Please check your event listeners for circular references.",this),!1;if(((t=this.methods)==null?void 0:t.length)<=0)return!1;this._isInvoking=!0;try{for(const i of this.methods)i.invoke(...e);if(typeof this.target=="object"&&typeof this.key=="string"){const i=this.target.dispatchEvent;if(typeof i=="function"){const s=new AT(this.key);s.args=e,i.call(this.target,s)}}}finally{this._isInvoking=!1}return!0}addEventListener(e){return this.methods.push(new Pm(e,!0)),e}removeEventListener(e){if(e)for(let t=this.methods.length-1;t>=0;t--)this.methods[t].method===e&&(this.methods[t].enabled=!1,this.methods.splice(t,1))}removeAllEventListeners(){this.methods.length=0}}const TB=Symbol("previous-visibility"),of=class extends ni{render(e,t,i){if(i instanceof aT)this._unsupported_effectcomposer_warning||(console.warn("RenderTexture.render() does not yet support EffectComposer"),this._unsupported_effectcomposer_warning=!0);else{this.onBeforeRender();const s=i.getRenderTarget(),r=i.xr.enabled;i.xr.enabled=!1,i.setRenderTarget(this),i.clear(!0,!0,!0),i.render(e,t),i.setRenderTarget(s),i.xr.enabled=r,this.onAfterRender()}}onBeforeRender(){of._userSet.clear();const e=U2(this.texture,!0,null,of._userSet);for(const t of e)t instanceof ye&&(t[TB]=t.visible,t.visible=!1)}onAfterRender(){for(const e of of._userSet)e instanceof ye&&(e.visible=e[TB]);of._userSet.clear()}};let yu=of;h(yu,"_userSet",new Set);class nY extends hh{constructor(){super([_e,Si])}onDeserialize(e){if(e!=null)return e.a!==void 0?new Si(e.r,e.g,e.b,e.a):e.alpha!==void 0?new Si(e.r,e.g,e.b,e.alpha):new _e(e.r,e.g,e.b)}onSerialize(e){if(e!=null)return e.a!==void 0?{r:e.r,g:e.g,b:e.b,a:e.a}:{r:e.r,g:e.g,b:e.b}}}new nY;class sY extends hh{constructor(){super(Me)}onSerialize(e,t){if(t.objectToNode!==void 0&&e.uuid){const i=t.objectToNode[e.uuid];return ws&&console.log(i,e.name,e.uuid),{node:i}}}onDeserialize(e,t){var i,s,r;if(typeof e=="string"){if(e.endsWith(".glb")||e.endsWith(".gltf")){if(t.serializable instanceof Array&&t.serializable.includes(wn))return;si()&&Rs("Detected wrong usage of @serializable with Object3D or GameObject. Instead you should use AssetReference here! Please see the console for details.");const o=(s=(i=t.target)==null?void 0:i.constructor)==null?void 0:s.name;console.warn(`Wrong usage of @serializable detected in your script "${o}"

It looks like you used @serializable(Object3D) or @serializable(GameObject) for a prefab or scene reference which is exported to a separate glTF file.

To fix this please change your code to:

@serializable(AssetReference)
${t.path}! : AssetReference;
\0`)}return}if(e){if(e.node!==void 0&&t.nodeToObject){const o=t.nodeToObject[e.node];return ws&&console.log("Deserialized object reference?",e,o,t==null?void 0:t.nodeToObject),o||console.warn("Did not find node: "+e.node,t.nodeToObject,t.object),o}else if(e.guid){if(!t.context){console.error("Missing context");return}let o;const a=(r=t.gltf)==null?void 0:r.scene;return a&&(o=ne.findByGuid(e.guid,a)),o||(o=ne.findByGuid(e.guid,t.context.scene)),o?ws&&console.log("Deserialized object reference?",e,o,t==null?void 0:t.nodeToObject):((si()||ws)&&console.warn("Could not resolve object reference",t.path,e,t.target,t.context.scene),e.could_not_resolve=!0),o}}}}const rY=new sY;class oY extends hh{constructor(){super([Gu,Te])}onSerialize(e,t){if(e!=null&&e.guid)return{guid:e.guid}}onDeserialize(e,t){var i;if(e!=null&&e.guid){ws&&console.log(e.guid,t.root,t.object,t.target);let s=this.findObjectForGuid(e.guid,t.root);if(s||t.context&&(s=this.findObjectForGuid(e.guid,(i=t.context)==null?void 0:i.scene),s))return s;(si()||ws)&&console.warn("Could not resolve component reference",t.path,e,t.target),e.could_not_resolve=!0;return}}findObjectForGuid(e,t){if(t.guid===e)return t;const i=ne.foreachComponent(t,s=>{if(s.guid===e)return s},!1);if(i!==void 0)return i;for(let s=0;s<t.children.length;s++){const r=t.children[s],o=this.findObjectForGuid(e,r);if(o)return o}}}const Uw=new oY,aY=Symbol("eventListDebugInfo");class lY extends hh{constructor(){super([qn])}onSerialize(e,t){console.log("TODO: SERIALIZE EVENT")}onDeserialize(e,t){var i,s,r,o;if(typeof e=="function")return new qn([new Pm(e,!0)]);if(e&&e.type==="EventList"){ws&&console.log("DESERIALIZE EVENT",e);const a=new Array;if(e.calls&&Array.isArray(e.calls))for(const u of e.calls){ws&&console.log(u);let d=Uw.findObjectForGuid(u.target,t.root);!d&&((i=t.context)!=null&&i.scene)&&(d=Uw.findObjectForGuid(u.target,(s=t.context)==null?void 0:s.scene));const f=((r=u.method)==null?void 0:r.length)>0;if(d&&f){const v=()=>{const b=u.method[0].toUpperCase()+u.method.slice(1);if(typeof d[b]=="function"){console.warn(`EventList method:
Could not find method ${u.method} on object ${d.name}. Please rename ${u.method} to ${b}?
`,d[b],`
 in script: `,d),Rs("EventList methods must start with lowercase letter, see console for details");return}else console.warn(`EventList method:
Could not find method ${u.method} on object ${d.name}`,d,typeof d[u.method])};if(typeof d[u.method]!="function"){let b=!1,y=d;for(;y;){const _=Object.getOwnPropertyDescriptor(y,u.method);if(_&&(_.writable===!0||_.set)){b=!0;break}y=Object.getPrototypeOf(y)}!b&&(si()||ws)&&v()}}let p=u.argument;if(p!==void 0&&typeof p=="object"){let v=rY.onDeserialize(u.argument,t);v||(v=Uw.onDeserialize(u.argument,t)),v&&(p=v)}const g=f?this.createEventMethod(d,u.method,p):void 0,A=new Pm(g,u.enabled);if(A.method||(A[aY]=(o=t.object)==null?void 0:o.name),!d||!A.method){const v=t.object?"Current object: "+t.object.name+", "+t.object.guid:null;d?console.warn('EventList method not found: "'+u.method+'" on',d):console.warn("EventList is missing target - will be ignored",u.target,v,e)}else a.push(A)}const l=new qn(a);ws&&console.log(l);const c=t.target;return c!==void 0&&t.path!==void 0&&l.setEventTarget(t.path,c),l}}createEventMethod(e,t,i){return(...s)=>{const r=e[t];typeof r=="function"?i!==void 0?r==null||r.call(e,i):r==null||r.call(e,...s):e[t]=i}}}new lY;class cY extends hh{constructor(){super([yu,ni])}onSerialize(e,t){}onDeserialize(e,t){if(e instanceof Rt&&t.type===yu){const i=e,s=new yu(i.image.width,i.image.height,{colorSpace:gn});return s.texture=i,i.isRenderTargetTexture=!0,i.flipY=!0,i.offset.y=1,i.repeat.y=-1,i.needsUpdate=!0,i instanceof Ol&&(i.isCompressedTexture=!1,i.format=Ti),s}}}new cY;class hY extends hh{constructor(){super([URL])}onSerialize(e,t){return null}onDeserialize(e,t){if(typeof e=="string"&&e.length>0)return Nu(t.gltfId,e)}}new hY;const Us=new w,IB=new w,RB=new Se,gc=8947848;class lu{static DrawRay(e,t,i=gc,s=0,r=!0){const o=Gs.getLine(s),a=o.geometry.getAttribute("position");a.setXYZ(0,e.x,e.y,e.z),Us.set(t.x,t.y,t.z).multiplyScalar(999999999),a.setXYZ(1,e.x+Us.x,e.y+Us.y,e.z+Us.z),a.needsUpdate=!0,o.material.color.set(i),o.material.depthTest=r,o.material.depthWrite=!1}static DrawDirection(e,t,i=gc,s=0,r=!0,o=1){const a=Gs.getLine(s),l=a.geometry.getAttribute("position");l.setXYZ(0,e.x,e.y,e.z),t.w!==void 0?(Us.set(0,0,-o),RB.set(t.x,t.y,t.z,t.w),Us.applyQuaternion(RB)):(Us.set(t.x,t.y,t.z),Us.multiplyScalar(o)),l.setXYZ(1,e.x+Us.x,e.y+Us.y,e.z+Us.z),l.needsUpdate=!0,a.material.color.set(i),a.material.depthTest=r,a.material.depthWrite=!1}static DrawLine(e,t,i=gc,s=0,r=!0){const o=Gs.getLine(s),a=o.geometry.getAttribute("position");a.setXYZ(0,e.x,e.y,e.z),a.setXYZ(1,t.x,t.y,t.z),a.needsUpdate=!0,o.material.color.set(i),o.material.depthTest=r,o.material.depthWrite=!1}static DrawWireSphere(e,t,i=gc,s=0,r=!0){const o=Gs.getSphere(t,s,!0);c0(o,e.x,e.y,e.z),o.material.color.set(i),o.material.depthTest=r,o.material.depthWrite=!1}static DrawSphere(e,t,i=gc,s=0,r=!0){const o=Gs.getSphere(t,s,!1);c0(o,e.x,e.y,e.z),o.material.color.set(i),o.material.depthTest=r,o.material.depthWrite=!1}static DrawBox(e,t,i=gc,s=0,r=!0){const o=Gs.getBox(s);o.position.set(e.x,e.y,e.z),o.scale.set(t.x,t.y,t.z),o.material.color.set(i),o.material.depthTest=r,o.material.wireframe=!0,o.material.depthWrite=!1}static DrawBox3(e,t=gc,i=0,s=!0){const r=Gs.getBox(i);r.position.copy(e.getCenter(Us)),r.scale.copy(e.getSize(Us)),r.material.color.set(t),r.material.depthTest=s,r.material.wireframe=!0,r.material.depthWrite=!1}static DrawArrow(e,t,i=gc,s=0,r=!0,o=!1){const a=Gs.getArrowHead(s);a.position.set(t.x,t.y,t.z),a.quaternion.setFromUnitVectors(this._up.set(0,1,0),Us.set(t.x,t.y,t.z).sub(IB.set(e.x,e.y,e.z)).normalize());const c=Us.set(t.x,t.y,t.z).sub(IB.set(e.x,e.y,e.z)).length()*.1;a.scale.set(c,c,c),a.material.color.set(i),a.material.depthTest=r,a.material.wireframe=o,this.DrawLine(e,t,i,s,r)}}h(lu,"_up",new w(0,1,0));const uY=new Ei(1,1,1);function jF(n=null){const e=new _e(n??14540253),t=new vM(uY);return new wo(t,new Sn({color:e}))}const PB=Symbol("GizmoCache");class Gs{static getBox(e){let t=this.boxesCache.pop();if(!t){const i=new Ei(1,1,1);t=new ye(i)}return this.registerTimedObject(Lt.Current,t,e,this.boxesCache),t}static getLine(e){let t=this.linesCache.pop();if(!t){t=new dn;let i=t.geometry.getAttribute("position");i||(i=new ot(new Float32Array(2*3),3),t.geometry.setAttribute("position",i))}return this.registerTimedObject(Lt.Current,t,e,this.linesCache),t}static getSphere(e,t,i){let s=this.spheresCache.pop();return s||(s=new ye(new So(1,8,8))),s.scale.set(e,e,e),s.material.wireframe=i,this.registerTimedObject(Lt.Current,s,t,this.spheresCache),s}static getArrowHead(e){let t=this.arrowHeadsCache.pop();return t||(t=new ye(new cn(0,.5,1,8))),this.registerTimedObject(Lt.Current,t,e,this.arrowHeadsCache),t}static registerTimedObject(e,t,i,s){if(!this.contextPostRenderCallbacks.get(e)){const r=()=>{this.onPostRender(e,this.timedObjectsBuffer,this.timesBuffer)};this.contextPostRenderCallbacks.set(e,r),e.post_render_callbacks.push(r)}t.layers.disableAll(),t.layers.enable(2),t[PB]=s,this.timedObjectsBuffer.push(t),this.timesBuffer.push(Lt.Current.time.time+i),e.scene.add(t)}static onPostRender(e,t,i){const s=e.time.time;for(let r=0;r<t.length;r++)if(s>i[r]){const o=t[r];o[PB].push(o),e.scene.remove(o),t.splice(r,1),i.splice(r,1)}}}h(Gs,"linesCache",[]),h(Gs,"spheresCache",[]),h(Gs,"boxesCache",[]),h(Gs,"arrowHeadsCache",[]),h(Gs,"timedObjectsBuffer",new Array),h(Gs,"timesBuffer",new Array),h(Gs,"contextPostRenderCallbacks",new Map);const dY=re("gizmos"),fY=re("debugboxhelper"),oo=class extends Te{constructor(){super(...arguments);h(this,"box",null);h(this,"_lastMatrixUpdateFrame",-1);h(this,"_helper",null);h(this,"_color",null)}isInBox(t,i){var r;if(!t)return;if(this.box||(this.box=new Bn),t.type==="Mesh")oo.testBox.setFromObject(t);else if(t.type==="Group"){if(oo.testBox.makeEmpty(),t.children.length>0)for(let o=0;o<t.children.length;o++)t.children[o].type==="Mesh"&&oo.testBox.expandByObject(t)}else{const o=Mt(t,oo._position),a=Jo(t,oo._size);i!==void 0&&a.multiplyScalar(i),oo.testBox.setFromCenterAndSize(o,a)}this.updateBox();const s=(r=this.box)==null?void 0:r.intersectsBox(oo.testBox);return s&&fY&&lu.DrawBox3(oo.testBox,16711680,5),s}intersects(t){return t?this.updateBox(!1).intersectsBox(t):!1}updateBox(t=!1){if(this.box||(this.box=new Bn),t||this.context.time.frameCount!=this._lastMatrixUpdateFrame){const i=this._lastMatrixUpdateFrame<0;this._lastMatrixUpdateFrame=this.context.time.frameCount;const s=i,r=Mt(this.gameObject,oo._position,s),o=Jo(this.gameObject,oo._size);this.box.setFromCenterAndSize(r,o)}return this.box}awake(){this._helper=null,this._color=null,this.box=null}showHelper(t=null,i=!1){var s;if(!(!dY&&!i)){if(this._helper){t&&((s=this._color)==null||s.set(t)),this.gameObject.add(this._helper);return}this._helper=jF(t),this.gameObject.add(this._helper)}}};let zo=oo;h(zo,"testBox",new Bn),h(zo,"_position",new w),h(zo,"_size",new w(.01,.01,.01));var qF=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const Yp=re("debugreflectionprobe"),BB=re("noreflectionprobe"),pY=Symbol("reflectionProbeKey"),gY=Symbol("original material"),ga=class extends Te{constructor(){var t;super();h(this,"_texture");h(this,"center");h(this,"size");h(this,"_boxHelper");ga._probes.has(this.context)||ga._probes.set(this.context,[]),(t=ga._probes.get(this.context))==null||t.push(this)}static get(t,i,s,r){if(!t||t.isObject3D!==!0||BB)return null;const o=ga._probes.get(i);if(o){for(const a of o)if(a.__didAwake||a.__internalAwake(),a.enabled){if(r){if(a.gameObject===r)return a}else if(a.isInBox(t,void 0))return Yp&&console.log("Found reflection probe",t.name,a.name),a}}return Yp&&console.debug("Did not find reflection probe",t.name,s,t),null}set texture(t){if(t&&!(t instanceof Rt)){console.error("ReflectionProbe.texture must be a Texture",t);return}this._texture=t,t&&(t.mapping=mo,t.colorSpace=Je,t.needsUpdate=!0)}get texture(){return this._texture}isInBox(t,i){var s;return(s=this._boxHelper)==null?void 0:s.isInBox(t,i)}awake(){this._boxHelper=this.gameObject.addNewComponent(zo),this._boxHelper.updateBox(!0),Yp&&this._boxHelper.showHelper(5592320,!0),this.texture&&(this.texture.mapping=mo,this.texture.colorSpace=Je,this.texture.needsUpdate=!0)}onDestroy(){const t=ga._probes.get(this.context);if(t){const i=t.indexOf(this);i>=0&&t.splice(i,1)}}onSet(t){var s;if(BB||!this.enabled||((s=t.sharedMaterials)==null?void 0:s.length)<=0||!this.texture)return;let i=ga._rendererMaterialsCache.get(t);i||(i=[],ga._rendererMaterialsCache.set(t,i));for(let r=0;r<t.sharedMaterials.length;r++){const o=t.sharedMaterials[r];if(!o||o.envMap===void 0)continue;let a=i[r];const l=o===(a==null?void 0:a.copy),c=!a||a.material.uuid!==o.uuid||a.copy.version!==o.version;if(!l&&c){if(Yp){let f="";a?a.material!==o?f="reference changed; cached instance?: "+l:a.copy.version!==o.version&&(f="version changed"):f="not cached",console.warn("Cloning material",o.name,o.version,"Reason:",f,`
`,o.uuid,`
`,a==null?void 0:a.copy.uuid,`
`,t.name)}const d=o.clone();d.version=o.version,a?(a.copy=d,a.material=o):(a={material:o,copy:d},i.push(a)),d[pY]=this,d[gY]=o,Yp&&console.log("Set reflection",t.name,t.guid)}const u=a==null?void 0:a.copy;u.envMap=this.texture,t.sharedMaterials[r]=u}}onUnset(t){const i=ga._rendererMaterialsCache.get(t);if(i)for(let s=0;s<i.length;s++){const r=i[s];t.sharedMaterials[s]=r.material}}};let Tl=ga;h(Tl,"_probes",new Map),h(Tl,"_rendererMaterialsCache",new Map);qF([x(w)],Tl.prototype,"center",void 0);qF([x(w)],Tl.prototype,"size",void 0);const XF=Symbol("customVisibilityFlag");function Nw(n,e){n.layers[XF]=e}const DB=Symbol("DidPatchLayers");function mY(){const n=Ss.prototype;if(n[DB])return;n[DB]=!0;const e=n.test;n.test=function(t){return this[XF]===!1?!1:e.call(this,t)}}mY();var Xl=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const Ny=re("debugrenderer"),OB=re("noInstancing"),YF=re("debuginstancing"),AY=re("debugprogressive"),vY=re("noprogressive"),yY=re("wireframe");var Xd;(function(n){n[n.Off=0]="Off",n[n.BlendProbes=1]="BlendProbes",n[n.BlendProbesAndSkybox=2]="BlendProbesAndSkybox",n[n.Simple=3]="Simple"})(Xd||(Xd={}));class JF{constructor(){h(this,"path",null);h(this,"asset",null);h(this,"default")}}var kB;(function(n){n[n.Both=0]="Both",n[n.Back=1]="Back",n[n.Front=2]="Front"})(kB||(kB={}));class bY{constructor(e,t){h(this,"_renderer");h(this,"_targets",[]);h(this,"_indexMapMaxIndex");h(this,"_indexMap");h(this,"_changed",!1);this._renderer=e;const i=this.setMaterial.bind(this),s=this.getMaterial.bind(this),r=e.gameObject;if(this._targets=[],r)switch(r.type){case"Group":this._targets=[...r.children];break;case"SkinnedMesh":case"Mesh":this._targets.push(r);break}let o=!1,a,l=0;for(let c=0;c<this._targets.length;c++){const u=this._targets[c];if(!u)continue;const d=u.material;if(d){d.shadowSide=d.side;for(let f=0;f<t.length;f++){const p=t[f];if(!p){o=!0;continue}if(d.name===p.name){a===void 0&&(a=new Map),a.set(f,c),l=Math.max(l,f);break}}}}if(o){this._indexMapMaxIndex=l,this._indexMap=a;const c=`Renderer ${e.name} was initialized with missing materials - this may lead to unexpected behaviour when trying to access sharedMaterials by index.`;console.warn(c),Ar()&&Rs("Found renderer with missing materials: please check the console for details.")}return new Proxy(this,{get(c,u){if(typeof u=="string"){const d=parseInt(u);if(!isNaN(d))return s(d)}return c[u]},set(c,u,d){return typeof u=="string"&&i(d,Number.parseInt(u)),Reflect.set(c,u,d)?(d instanceof Pt&&(c.changed=!0),!0):!1}})}get changed(){return this._changed}set changed(e){e===!0&&Ny&&console.warn("SharedMaterials have changed: "+this._renderer.name,this),this._changed=e}is(e){return this._renderer===e}get length(){return this._indexMapMaxIndex!==void 0?this._indexMapMaxIndex+1:this._targets.length}*[Symbol.iterator](){for(let e=0;e<this.length;e++)yield this.getMaterial(e)}resolveIndex(e){const t=this._indexMap;return t&&t.has(e)?t.get(e):e}setMaterial(e,t){if(t=this.resolveIndex(t),t<0||t>=this._targets.length)return;const i=this._targets[t];!i||i.material===void 0||(i.material=e,this.changed=!0)}getMaterial(e){if(e=this.resolveIndex(e),e<0)return null;const t=this._targets;if(e>=t.length)return null;const i=t[e];return i?i.material:null}}class Ci extends Te{constructor(){super(...arguments);h(this,"receiveShadows",!1);h(this,"shadowCastingMode",C0.Off);h(this,"lightmapIndex",-1);h(this,"lightmapScaleOffset",new Ke(1,1,0,0));h(this,"enableInstancing");h(this,"renderOrder");h(this,"allowOcclusionWhenDynamic",!0);h(this,"probeAnchor");h(this,"reflectionProbeUsage",Xd.Off);h(this,"_lightmaps");h(this,"_sharedMaterials");h(this,"_originalMaterials");h(this,"_lightmapTextureOverride");h(this,"allowProgressiveLoading",!0);h(this,"_isInstancingEnabled",!1);h(this,"handles");h(this,"prevLayers");h(this,"onBeforeRenderThree",(t,i,s,r,o,a)=>{var l;if(o.envMapIntensity!==void 0){const c=this.hasLightmap?Math.PI:1,u=((l=this.context.mainCameraComponent)==null?void 0:l.environmentIntensity)??1;o.envMapIntensity=Math.max(0,u*this.context.sceneLighting.environmentIntensity/c)}if(this._lightmaps)for(const c of this._lightmaps)c.updateLightmapUniforms(o)});h(this,"_reflectionProbe",null)}static setVisible(t,i){Nw(t,i)}get sharedMesh(){if(this.gameObject.type==="Mesh")return this.gameObject;if(this.gameObject.type==="SkinnesMesh")return this.gameObject;if(this.gameObject.type==="Group")return this.gameObject.children[0]}get sharedMaterial(){return this.sharedMaterials[0]}set sharedMaterial(t){this.sharedMaterials[0]!==t&&(this.sharedMaterials[0]=t,this.applyLightmapping())}get material(){return this.sharedMaterials[0]}set material(t){this.sharedMaterial=t}set sharedMaterials(t){if(!this._originalMaterials)this._originalMaterials=t;else if(t){let i=!1;for(let s=0;s<this._sharedMaterials.length;s++){const r=s<t.length?t[s]:null;r&&r instanceof Pt?this.sharedMaterials[s]=r:i||(i=!0,console.warn("Can not assign null as material: "+this.name,r))}}}get sharedMaterials(){return(!this._sharedMaterials||!this._sharedMaterials.is(this))&&(this._originalMaterials||(this._originalMaterials=[]),this._sharedMaterials=new bY(this,this._originalMaterials)),this._sharedMaterials}static get shouldSuppressInstancing(){return OB}get lightmap(){var t;return(t=this._lightmaps)!=null&&t.length?this._lightmaps[0].lightmap:null}set lightmap(t){var i;if(this._lightmapTextureOverride=t,t===void 0&&(t=this.context.lightmaps.tryGetLightmap(this.sourceId,this.lightmapIndex)),(i=this._lightmaps)!=null&&i.length)for(const s of this._lightmaps)s.lightmap=t}get hasLightmap(){const t=this.lightmap;return t!=null}registering(){this.enabled||this.setVisibility(!1)}awake(){if(Ny&&console.log("Renderer ",this.name,this),this.clearInstancingState(),this.probeAnchor&&Ny&&this.probeAnchor.add(new Zf(.2)),this._reflectionProbe=null,this.isMultiMaterialObject(this.gameObject)){for(const t of this.gameObject.children)this.context.addBeforeRenderListener(t,this.onBeforeRenderThree),t.layers.mask=this.gameObject.layers.mask;if(this.renderOrder!==void 0){let t=0;for(let i=0;i<this.gameObject.children.length;i++){const s=this.gameObject.children[i];if(!(!this.isMeshOrSkinnedMesh(s)||ne.getComponent(s,Ci))){if(this.renderOrder.length<=t){console.warn("Incorrect renderOrder element count",this,this.renderOrder.length+" but expected "+this.gameObject.children.length,"Index: "+t,"ChildElement:",s);continue}s.renderOrder=this.renderOrder[t],t+=1}}}}else this.isMeshOrSkinnedMesh(this.gameObject)?(this.context.addBeforeRenderListener(this.gameObject,this.onBeforeRenderThree),this.renderOrder!==void 0&&this.renderOrder.length>0&&(this.gameObject.renderOrder=this.renderOrder[0])):this.context.addBeforeRenderListener(this.gameObject,this.onBeforeRenderThree);if(this.applyLightmapping(),yY)for(let t=0;t<this.sharedMaterials.length;t++){const i=this.sharedMaterials[t];i&&(i.wireframe=!0)}}applyLightmapping(){var t;if(this.lightmapIndex>=0){const i=this.gameObject.type,s=this._lightmapTextureOverride!==void 0?this._lightmapTextureOverride:this.context.lightmaps.tryGetLightmap(this.sourceId,this.lightmapIndex);if(s){if(this._lightmaps||(this._lightmaps=[]),i==="Mesh"){const r=this.gameObject.material;if(r!=null&&r.isMeshBasicMaterial)r&&console.warn("Lightmapping is not supported on MeshBasicMaterial",r.name);else{if(this._lightmaps.length<=0){const a=new S0(this.gameObject,this.context);this._lightmaps.push(a)}this._lightmaps[0].init(this.lightmapIndex,this.lightmapScaleOffset,s)}}else if(this.isMultiMaterialObject(this.gameObject)&&this.sharedMaterials.length>0)for(let r=0;r<this.gameObject.children.length;r++){const o=this.gameObject.children[r];if(!((t=o.material)!=null&&t.isMeshBasicMaterial)){let a;r>=this._lightmaps.length?(a=new S0(o,this.context),this._lightmaps.push(a)):a=this._lightmaps[r],a.init(this.lightmapIndex,this.lightmapScaleOffset,s)}}}else Ny&&console.warn("Lightmap not found",this.sourceId,this.lightmapIndex)}}clearInstancingState(){this._isInstancingEnabled=!1,this.handles=void 0,this.prevLayers=void 0}setInstancingEnabled(t){if(this._isInstancingEnabled===t)return t&&(this.handles===void 0||this.handles!=null&&this.handles.length>0);if(this._isInstancingEnabled=t,t){if(this.handles===void 0){if(this.handles=xY.setup(this,this.gameObject,this.context,null,{rend:this,foundMeshes:0,useMatrixWorldAutoUpdate:this.useInstanceMatrixWorldAutoUpdate()}),this.handles)return ne.markAsInstancedRendered(this.gameObject,!0),!0}else if(this.handles!==null){for(const i of this.handles)i.updateInstanceMatrix(!0),i.add();return ne.markAsInstancedRendered(this.gameObject,!0),!0}}else{if(this.handles)for(const i of this.handles)i.remove();return!0}return!1}useInstanceMatrixWorldAutoUpdate(){return!0}start(){if(this.enableInstancing&&!OB&&this.setInstancingEnabled(!0),this.gameObject.frustumCulled=this.allowOcclusionWhenDynamic,this.isMultiMaterialObject(this.gameObject))for(let t=0;t<this.gameObject.children.length;t++){const i=this.gameObject.children[t];i.frustumCulled=this.allowOcclusionWhenDynamic}}onEnable(){this.setVisibility(!0),this._isInstancingEnabled?this.setInstancingEnabled(!0):this.enabled&&this.applyStencil(),this.updateReflectionProbe()}onDisable(){this.setVisibility(!1),this.handles&&this.handles.length>0&&this.setInstancingEnabled(!1)}onDestroy(){if(this.handles=null,this.isMultiMaterialObject(this.gameObject))for(const t of this.gameObject.children)this.context.removeBeforeRenderListener(t,this.onBeforeRenderThree);else this.context.removeBeforeRenderListener(this.gameObject,this.onBeforeRenderThree)}applyStencil(){Ng.applyStencil(this)}onBeforeRender(){var t,i;if(this.gameObject){if(this.isMultiMaterialObject(this.gameObject)&&((t=this.gameObject.children)==null?void 0:t.length)>0)for(const s of this.gameObject.children)this.applySettings(s);else this.applySettings(this.gameObject);if(this.sharedMaterials.changed&&(this.sharedMaterials.changed=!1,this.applyLightmapping()),(i=this.handles)!=null&&i.length&&this.gameObject[Mm]===!0){YF&&console.log("UPDATE INSTANCED MATRICES",this.context.time.frame),this.gameObject[Mm]=!1;for(let r=this.handles.length-1;r>=0;r--)this.handles[r].updateInstanceMatrix();this.gameObject.matrixWorldNeedsUpdate=!1}if(this.handles&&this.handles.length<=0&&ne.markAsInstancedRendered(this.gameObject,!1),this._isInstancingEnabled&&this.handles)for(let s=0;s<this.handles.length;s++){const r=this.handles[s];this.prevLayers||(this.prevLayers=[]);const o=r.object.layers.mask;s>=this.prevLayers.length?this.prevLayers.push(o):this.prevLayers[s]=o,r.object.layers.disableAll()}for(const s of this.sharedMaterials)s&&this.loadProgressiveTextures(s);this.reflectionProbeUsage!==Xd.Off&&this._reflectionProbe&&this._reflectionProbe.onSet(this)}}onAfterRender(){if(this._isInstancingEnabled&&this.handles&&this.prevLayers&&this.prevLayers.length>=this.handles.length)for(let t=0;t<this.handles.length;t++){const i=this.handles[t];i.object.layers.mask=this.prevLayers[t]}this.reflectionProbeUsage!==Xd.Off&&this._reflectionProbe&&this._reflectionProbe.onUnset(this)}loadProgressiveTextures(t){return!vY&&t&&t._didRequestTextureLOD===void 0&&this.allowProgressiveLoading?(t._didRequestTextureLOD=0,AY&&console.log("Load material LOD",t.name),fo.assignTextureLOD(this.context,this.sourceId,t)):Promise.resolve(!0)}applySettings(t){t.receiveShadow=this.receiveShadows,this.shadowCastingMode==C0.On?t.castShadow=!0:t.castShadow=!1}updateReflectionProbe(){if(this._reflectionProbe=null,this.reflectionProbeUsage!==Xd.Off){if(!this.probeAnchor)return;this.startCoroutine(this._updateReflectionProbe(),li.LateUpdate)}}*_updateReflectionProbe(){const t=this.probeAnchor||this.gameObject,i=!!this.probeAnchor;this._reflectionProbe=Tl.get(t,this.context,i,this.probeAnchor)}setVisibility(t){if(!this.isMultiMaterialObject(this.gameObject))Nw(this.gameObject,t);else for(const i of this.gameObject.children)this.isMeshOrSkinnedMesh(i)&&Nw(i,t)}isMultiMaterialObject(t){return t.type==="Group"}isMeshOrSkinnedMesh(t){return t.type==="Mesh"||t.type==="SkinnedMesh"}}Xl([x()],Ci.prototype,"receiveShadows",void 0);Xl([x()],Ci.prototype,"shadowCastingMode",void 0);Xl([x()],Ci.prototype,"lightmapIndex",void 0);Xl([x(Ke)],Ci.prototype,"lightmapScaleOffset",void 0);Xl([x()],Ci.prototype,"enableInstancing",void 0);Xl([x()],Ci.prototype,"renderOrder",void 0);Xl([x()],Ci.prototype,"allowOcclusionWhenDynamic",void 0);Xl([x(Me)],Ci.prototype,"probeAnchor",void 0);Xl([x()],Ci.prototype,"reflectionProbeUsage",void 0);class vT extends Ci{}class KF extends vT{awake(){super.awake(),this.allowOcclusionWhenDynamic=!1}}var C0;(function(n){n[n.Off=0]="Off",n[n.On=1]="On",n[n.TwoSided=2]="TwoSided",n[n.ShadowsOnly=3]="ShadowsOnly"})(C0||(C0={}));class _Y{constructor(){h(this,"objs",[])}setup(e,t,i,s,r,o=0){e.applySettings(t);const a=this.tryCreateOrAddInstance(t,i,r);if(a)e.loadProgressiveTextures(a.instancer.material),s===null&&(s=[]),s.push(a);else if(o<=0&&t.type!=="Mesh"){const l=o+1;for(const c of t.children)s=this.setup(e,c,i,s,r,l)}return o===0&&r.useMatrixWorldAutoUpdate&&s&&s.length>=0&&this.autoUpdateInstanceMatrix(t),s}tryCreateOrAddInstance(e,t,i){if(e.type==="Mesh"){const s=i.foundMeshes;if(i.foundMeshes+=1,!i.rend.enableInstancing||s>=i.rend.enableInstancing.length||!i.rend.enableInstancing[s])return null;const r=e,o=r.geometry,a=r.material;for(const u of this.objs)if(!u.isFull()&&u.geo===o&&u.material===a)return u.addInstance(r);const l=new zy(e.name,o,a,200,t);return this.objs.push(l),l.addInstance(r)}return null}autoUpdateInstanceMatrix(e){const t=e.matrixWorld.multiplyMatrices.bind(e.matrixWorld),i=e.matrixWorld.clone(),s=(r,o)=>{const a=t(r,o);return(e[Mm]||i.equals(a)===!1)&&(i.copy(a),e[Mm]=!0),a};e.matrixWorld.multiplyMatrices=s}}const xY=new _Y;class wY{constructor(e,t,i){h(this,"instanceIndex",-1);h(this,"object");h(this,"instancer");this.instanceIndex=e,this.object=t,this.instancer=i,ne.markAsInstancedRendered(t,!0)}get name(){return this.object.name}updateInstanceMatrix(e=!1){this.instanceIndex<0||(this.object.updateWorldMatrix(!0,e),this.instancer.updateInstance(this.object.matrixWorld,this.instanceIndex))}setMatrix(e){this.instanceIndex<0||this.instancer.updateInstance(e,this.instanceIndex)}add(){this.instanceIndex>=0||this.instancer.add(this)}remove(){this.instanceIndex<0||this.instancer.remove(this)}}const eI=class{constructor(e,t,i,s,r){h(this,"name","");h(this,"geo");h(this,"material");h(this,"context");h(this,"inst");h(this,"handles",[]);h(this,"maxCount");this.name=e,this.geo=t,this.material=i,this.context=r,this.maxCount=s,YF&&(i=new ai({color:this.randomColor()})),this.inst=new Pb(t,i,s),this.inst.count=0,this.inst.layers.set(2),this.inst.visible=!0,this.context.scene.add(this.inst)}set castShadow(e){this.inst.castShadow=e}set receiveShadow(e){this.inst.receiveShadow=e}get currentCount(){return this.inst.count}isFull(){return this.currentCount>=this.maxCount}randomColor(){return new _e(Math.random(),Math.random(),Math.random())}addInstance(e){if(this.currentCount>=this.maxCount)return console.error("TOO MANY INSTANCES - resize is not yet implemented!",this.inst.count),null;const t=new wY(-1,e,this);return e.castShadow===!0&&this.inst.castShadow===!1&&(this.inst.castShadow=!0),e.receiveShadow===!0&&this.inst.receiveShadow===!1&&(this.inst.receiveShadow=!0),this.add(t),t}add(e){e.instanceIndex<0&&(e.instanceIndex=this.currentCount,e.instanceIndex>=this.handles.length?this.handles.push(e):this.handles[e.instanceIndex]=e),e.object.updateWorldMatrix(!0,!0),this.inst.setMatrixAt(e.instanceIndex,e.object.matrixWorld),this.inst.instanceMatrix.needsUpdate=!0,this.inst.count+=1,this.inst.count>0&&(this.inst.visible=!0)}remove(e){if(!e||e.instanceIndex<0||e.instanceIndex>=this.handles.length||this.inst.count<=0)return;if(this.handles[e.instanceIndex]!==e){console.error("instance handle is not part of renderer, was it removed before?",e.instanceIndex,this.name);const i=this.handles.indexOf(e);if(i<0)return;e.instanceIndex=i}if(this.handles[e.instanceIndex]=null,this.inst.setMatrixAt(e.instanceIndex,eI.nullMatrix),!(e.instanceIndex>=this.currentCount-1)&&this.currentCount>0){const i=this.handles[this.currentCount-1];i&&(i.instanceIndex=e.instanceIndex,i.updateInstanceMatrix(),this.handles[e.instanceIndex]=i,this.handles[this.currentCount-1]=null)}this.inst.count>0&&(this.inst.count-=1),e.instanceIndex=-1,this.inst.count<=0&&(this.inst.visible=!1),this.inst.instanceMatrix.needsUpdate=!0}updateInstance(e,t){this.inst.setMatrixAt(t,e),this.inst.instanceMatrix.needsUpdate=!0}};let zy=eI;h(zy,"nullMatrix",new Ie);function yT(n){return n=n.replace(/[^a-zA-Z0-9_]/g,""),n.match(/^[a-zA-Z_]/)||(n="_"+n),n}const eu=class{constructor(e,t,i,s=null,r=null,o=null){h(this,"uuid");h(this,"name");h(this,"matrix");h(this,"_isDynamic");h(this,"geometry");h(this,"material");h(this,"camera");h(this,"parent");h(this,"children",[]);h(this,"_eventListeners");this.uuid=e,this.name=yT(t),this.matrix=i,this.geometry=s,this.material=r,this.camera=o,this.parent=null,this.children=[],this._eventListeners={},this._isDynamic=!1}get isDynamic(){return this._isDynamic}set isDynamic(e){this._isDynamic=e}static createEmptyParent(e){const t=new eu(cs.generateUUID(),e.name+"_empty_"+eu.USDObject_export_id++,e.matrix);return e.parent.add(t),t.add(e),t.isDynamic=!0,e.matrix=new Ie().identity(),t}static createEmpty(){const e=new eu(cs.generateUUID(),"Empty_"+eu.USDObject_export_id++,new Ie);return e.isDynamic=!0,e}is(e){return e?this.uuid===e.uuid:!1}isEmpty(){return!this.geometry}clone(){const e=new eu(cs.generateUUID(),this.name,this.matrix,this.geometry,this.material);return e.isDynamic=this.isDynamic,e}getPath(){let e=this.parent,t=this.name;for(;e;)t=e.name+"/"+t,e=e.parent;return"</"+t+">"}add(e){e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e)}remove(e){const t=this.children.indexOf(e);t>=0&&(e.parent===this&&(e.parent=null),this.children.splice(t,1))}addEventListener(e,t){this._eventListeners[e]||(this._eventListeners[e]=[]),this._eventListeners[e].push(t)}removeEventListener(e,t){if(!this._eventListeners[e])return;const i=this._eventListeners[e].indexOf(t);i>=0&&this._eventListeners[e].splice(i,1)}onSerialize(e,t){const i=this._eventListeners.serialize;i&&i.forEach(s=>s(e,t))}};let Or=eu;h(Or,"USDObject_export_id",0);class ZF extends Or{constructor(){super(void 0,"StageRoot",new Ie,null,null,null);h(this,"stageLength");this.children=[],this.stageLength=200}get isDocumentRoot(){return!0}get isDynamic(){return!1}add(t){t.parent=this,this.children.push(t)}remove(t){const i=this.children.indexOf(t);i>=0&&(t.parent===this&&(t.parent=null),this.children.splice(i,1))}traverse(t,i=null){if(i!==null?t(i):i=this,i.children)for(const s of i.children)this.traverse(t,s)}findById(t){let i=!1;function s(r){if(!i){if(r.uuid===t)return i=!0,r;if(r.children)for(const o of r.children){const a=s(o);if(a)return a}}}return s(this)}buildHeader(){return`#usda 1.0
(
	customLayerData = {
		string creator = "Needle Engine USDZExporter"
	}
	defaultPrim = "${yT(this.name)}"
	metersPerUnit = 1
	upAxis = "Y"
	startTimeCode = 0
	endTimeCode = ${this.stageLength}
	timeCodesPerSecond = 60
	framesPerSecond = 60
)
`}}const Ed=`
`;class SY{constructor(){h(this,"str");h(this,"indent");this.str="",this.indent=0}clear(){this.str="",this.indent=0}beginBlock(e){e=this.applyIndent(e),this.str+=e,this.str+=Ed,this.str+=this.applyIndent("{"),this.str+=Ed,this.indent+=1}closeBlock(){this.indent-=1,this.str+=this.applyIndent("}")+Ed}beginArray(e){e=this.applyIndent(e+" = ["),this.str+=e,this.str+=Ed,this.indent+=1}closeArray(){this.indent-=1,this.str+=this.applyIndent("]")+Ed}appendLine(e=""){e=this.applyIndent(e),this.str+=e,this.str+=Ed}toString(){return this.str}applyIndent(e){let t="";for(let i=0;i<this.indent;i++)t+="	";return t+e}}class CY{constructor(e,t,i){h(this,"root");h(this,"exporter");h(this,"extensions");h(this,"materials");h(this,"textures");h(this,"files");h(this,"document");h(this,"output");this.root=e,this.exporter=t,i&&(this.extensions=i),this.materials={},this.textures={},this.files={},this.document=new ZF,this.output=""}}class LB{constructor(){h(this,"ar",{anchoring:{type:"plane"},planeAnchoring:{alignment:"horizontal"}});h(this,"quickLookCompatible",!1);h(this,"extensions",[])}}let EY=class{constructor(){h(this,"debug");h(this,"sceneAnchoringOptions",{});h(this,"extensions");this.debug=!1}async parse(e,t=new LB){t=Object.assign(new LB,t),this.sceneAnchoringOptions=t;const i=new CY(e,this,t.extensions);this.extensions=i.extensions;const s=i.files,r="model.usda";s[r]=null;const o=i.materials,a=i.textures;await Gy(i,"onBeforeBuildDocument"),$F(e,i.document,i),await Gy(i,"onAfterBuildDocument"),MY(i),await Gy(i,"onAfterSerialize"),i.output+=LY(o,a,t.quickLookCompatible);const c=i.document.buildHeader()+`
`+i.output;this.debug&&console.log(c),s[r]=_0(c),i.output="";const u=new oh({antialias:!1,alpha:!0});for(const f in a){let p=a[f];const g=sU.includes(p.format);p.isCompressedTexture&&(p=TY(p,4096,u));const A=await tU(p.image);if(A){const v=await new Promise(m=>A.toBlob(m,g?"image/png":"image/jpeg",.95));s[`textures/Texture_${f}.${g?"png":"jpg"}`]=new Uint8Array(await v.arrayBuffer())}else console.warn("Can`t export texture: ",p)}u.dispose();let d=0;for(const f in s){const p=s[f],g=34+f.length;d+=g;const A=d&63;if(A!==4){const v=64-A,m=new Uint8Array(v);s[f]=[p,{extra:{12345:m}}]}d=p.length}return xq(s,{level:0})}};function $F(n,e,t){if(!n.visible)return;let i,s,r;n instanceof ye&&(s=n.geometry,r=n.material);const o=ne.getComponent(n,Ci);if(o&&!o.enabled&&(s=void 0,r=void 0),n instanceof ye&&r&&(r instanceof Yo||r instanceof ai)&&!(n instanceof Yf)){const a=Hv(n);i=new Or(n.uuid,a,n.matrix,s,r)}else if(n instanceof qf){const a=Hv(n);i=new Or(n.uuid,a,n.matrix,void 0,void 0,n)}else{const a=Hv(n);i=new Or(n.uuid,a,n.matrix)}if(i){if(e&&e.add(i),e=i,t.extensions)for(const a of t.extensions)a.onExportObject&&a.onExportObject.call(a,n,i,t)}else{const a=Hv(n),l=new Or(n.uuid,a,n.matrix);e&&e.add(l),e=l}for(const a of n.children)$F(a,e,t)}async function MY(n){for(const t of n.document.children)eU(t,n);const e=new SY;e.beginBlock(`def Xform "${n.document.name}"`),e.beginBlock(`def Scope "Scenes" (
			kind = "sceneLibrary"
		)`),e.beginBlock(`def Xform "Scene" (
			apiSchemas = ["Preliminary_AnchoringAPI"]
			customData = {
				bool preliminary_collidesWithEnvironment = 0
				string sceneName = "Scene"
			}
			sceneName = "Scene"
		)`),e.appendLine(`token preliminary:anchoring:type = "${n.exporter.sceneAnchoringOptions.ar.anchoring.type}"`),n.exporter.sceneAnchoringOptions.ar.anchoring.type==="plane"&&e.appendLine(`token preliminary:planeAnchoring:alignment = "${n.exporter.sceneAnchoringOptions.ar.planeAnchoring.alignment}"`),n.exporter.sceneAnchoringOptions.ar.anchoring.type==="image"&&e.appendLine(`rel preliminary:imageAnchoring:referenceImage = </${n.document.name}/Scenes/Scene/AnchoringReferenceImage>`),e.appendLine();for(const t of n.document.children)iU(t,e,n);Gy(n,"onAfterHierarchy",e),e.closeBlock(),e.closeBlock(),e.closeBlock(),n.output+=e.toString()}function eU(n,e){const t=n.geometry,i=n.material;if(t)if(i.isMeshStandardMaterial||i.isMeshBasicMaterial){const s="geometries/Geometry_"+t.id+".usd";if(!(s in e.files)){const r=BY(t);e.files[s]=PY(r)}}else console.warn("THREE.USDZExporter: Unsupported material type (USDZ only supports MeshStandardMaterial)",name);i&&(i.uuid in e.materials||(e.materials[i.uuid]=i));for(const s of n.children)eU(s,e)}async function Gy(n,e,t=null){if(n.extensions){for(const i of n.extensions)if(i&&typeof i[e]=="function"){const r=i[e].call(i,n,t);r instanceof Promise&&await r}}}let Gv=null,zw,Md,Vv;function TY(n,e=1/0,t=null){zw||(zw=new us(2,2,1,1)),Md||(Md=new Bt({uniforms:{blitTexture:new xe(n)},vertexShader:`
            varying vec2 vUv;
            void main(){
                vUv = uv;
				vUv.y = 1. - vUv.y;
                gl_Position = vec4(position.xy * 1.0,0.,.999999);
            }`,fragmentShader:`
            uniform sampler2D blitTexture; 
            varying vec2 vUv;

            void main(){ 
                gl_FragColor = vec4(vUv.xy, 0, 1);
                
                #ifdef IS_SRGB
                gl_FragColor = LinearTosRGB( texture2D( blitTexture, vUv) );
                #else
                gl_FragColor = texture2D( blitTexture, vUv);
                #endif
            }`})),Md.uniforms.blitTexture.value=n,Md.defines.IS_SRGB=n.colorSpace==Je,Md.needsUpdate=!0,Vv||(Vv=new ye(zw,Md),Vv.frustumCulled=!1);const i=new qt,s=new mr;s.add(Vv),t||(t=Gv=new oh({antialias:!1,alpha:!0})),t.setSize(Math.min(n.image.width,e),Math.min(n.image.height,e)),t.clear(),t.render(s,i);const r=new Rt(t.domElement);return r.minFilter=n.minFilter,r.magFilter=n.magFilter,r.wrapS=n.wrapS,r.wrapT=n.wrapT,r.name=n.name,Gv&&(Gv.dispose(),Gv=null),r}function IY(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas||typeof ImageBitmap<"u"&&n instanceof ImageBitmap}async function tU(n,e=void 0,t=!1){if(IY(n)){const i=4096/Math.max(n.width,n.height),s=document.createElement("canvas");s.width=n.width*Math.min(1,i),s.height=n.height*Math.min(1,i);const r=s.getContext("2d");if(!r)throw new Error("Could not get canvas 2D context");if(t===!0&&(r.translate(0,s.height),r.scale(1,-1)),r.drawImage(n,0,0,s.width,s.height),e!==void 0){const o=parseInt(e,16),a=(o>>16&255)/255,l=(o>>8&255)/255,c=(o&255)/255,u=r.getImageData(0,0,s.width,s.height),d=u.data;for(let f=0;f<d.length;f+=4)d[f+0]=d[f+0]*a,d[f+1]=d[f+1]*l,d[f+2]=d[f+2]*c;r.putImageData(u,0,0)}return s}else throw new Error("THREE.USDZExporter: No valid image data found. Unable to process texture.")}const ss=7;function RY(){return`#usda 1.0
(
    customLayerData = {
        string creator = "Three.js USDZExporter"
    }
    metersPerUnit = 1
    upAxis = "Y"
)
`}function PY(n,e){let t=RY();return t+=n,_0(t)}function Hv(n){return n.name.replace(/[-<>\(\)\[\]$%&\/\\\=\?\,\;]/g,"")+"_"+n.id}function iU(n,e,t){const i=n.matrix,s=n.geometry,r=n.material,o=n.camera,a=n.name;n.onBeforeSerialize&&n.onBeforeSerialize(e,t);const l=nU(i);if(i.determinant()<0&&console.warn("THREE.USDZExporter: USDZ does not support negative scales",a),s?e.beginBlock(`def Xform "${a}" (
prepend references = @./geometries/Geometry_${s.id}.usd@</Geometry>
prepend apiSchemas = ["MaterialBindingAPI"]
		)`):o?e.beginBlock(`def Camera "${a}"`):e.beginBlock(`def Xform "${a}"`),r&&e.appendLine(`rel material:binding = </Materials/Material_${r.id}>`),e.appendLine(`matrix4d xformOp:transform = ${l}`),e.appendLine('uniform token[] xformOpOrder = ["xformOp:transform"]'),o&&(o.isOrthographicCamera?(e.appendLine(`float2 clippingRange = (${o.near}, ${o.far})`),e.appendLine(`float horizontalAperture = ${((Math.abs(o.left)+Math.abs(o.right))*10).toPrecision(ss)}`),e.appendLine(`float verticalAperture = ${((Math.abs(o.top)+Math.abs(o.bottom))*10).toPrecision(ss)}`),e.appendLine('token projection = "orthographic"')):(e.appendLine(`float2 clippingRange = (${o.near.toPrecision(ss)}, ${o.far.toPrecision(ss)})`),e.appendLine(`float focalLength = ${o.getFocalLength().toPrecision(ss)}`),e.appendLine(`float focusDistance = ${o.focus.toPrecision(ss)}`),e.appendLine(`float horizontalAperture = ${o.getFilmWidth().toPrecision(ss)}`),e.appendLine('token projection = "perspective"'),e.appendLine(`float verticalAperture = ${o.getFilmHeight().toPrecision(ss)}`))),n.onSerialize&&n.onSerialize(e,t),n.children){e.appendLine();for(const c of n.children)iU(c,e,t)}e.closeBlock()}function Qv(n){return n.toFixed(10)}function nU(n){const e=n.elements;return`( ${Wv(e,0)}, ${Wv(e,4)}, ${Wv(e,8)}, ${Wv(e,12)} )`}function Wv(n,e){return`(${Qv(n[e+0])}, ${Qv(n[e+1])}, ${Qv(n[e+2])}, ${Qv(n[e+3])})`}function BY(n){return`
def "Geometry"
{
  ${DY(n)}
}
`}function DY(n){const e="Geometry",t=n.attributes,i=t.position.count;return`
    def Mesh "${e}"
    {
        int[] faceVertexCounts = [${OY(n)}]
        int[] faceVertexIndices = [${kY(n)}]
        normal3f[] normals = [${FB(t.normal,i)}] (
            interpolation = "vertex"
        )
        point3f[] points = [${FB(t.position,i)}]
        ${t.uv?`texCoord2f[] primvars:st = [${UB(t.uv,i)}] (
            interpolation = "vertex"
        )`:""}
		${t.uv2?`texCoord2f[] primvars:st2 = [${UB(t.uv2,i)}] (
            interpolation = "vertex"
        )`:""}
        uniform token subdivisionScheme = "none"
    }
`}function OY(n){const e=n.index!==null?n.index.count:n.attributes.position.count;return Array(e/3).fill(3).join(", ")}function kY(n){const e=n.index,t=[];if(e!==null)for(let i=0;i<e.count;i++)t.push(e.getX(i));else{const i=n.attributes.position.count;for(let s=0;s<i;s++)t.push(s)}return t.join(", ")}function FB(n,e){if(n===void 0)return console.warn("USDZExporter: Normals missing."),Array(e).fill("(0, 0, 0)").join(", ");const t=[];for(let i=0;i<n.count;i++){const s=n.getX(i),r=n.getY(i),o=n.getZ(i);t.push(`(${s.toPrecision(ss)}, ${r.toPrecision(ss)}, ${o.toPrecision(ss)})`)}return t.join(", ")}function UB(n,e){if(n===void 0)return console.warn("USDZExporter: UVs missing."),Array(e).fill("(0, 0)").join(", ");const t=[];for(let i=0;i<n.count;i++){const s=n.getX(i),r=n.getY(i);t.push(`(${s.toPrecision(ss)}, ${1-r.toPrecision(ss)})`)}return t.join(", ")}function LY(n,e,t=!1){const i=[];for(const s in n){const r=n[s];i.push(FY(r,e,t))}return`def "Materials"
{
${i.join("")}
}

`}function FY(n,e,t=!1){var l;const i="            ",s=[],r=[];function o(c,u,d=void 0,f=void 0){const p=c.id+(d?"_"+d.getHexString():"")+(f!==void 0?"_"+f:"");e[p]=c;const g=c.channel>0?"st"+c.channel:"st",A=sU.includes(c.format),v={1e3:"repeat",1001:"clamp",1002:"mirror"},m=c.repeat.clone(),b=c.offset.clone(),y=c.rotation,_=Math.sin(y),E=Math.cos(y);b.y=1-b.y-m.y,t?(b.x=b.x/m.x,b.y=b.y/m.y,b.x+=_/m.x,b.y+=E-1):(b.x+=_*m.x,b.y+=(1-E)*m.y);const M=m.x!=1||m.y!=1||b.x!=0||b.y!=0||y!=0,I=`</Materials/Material_${n.id}/${"uvReader_"+g}.outputs:result>`,R=`</Materials/Material_${n.id}/Transform2d_${u}.outputs:result>`,C=u!=="normal"&&d&&(d.r!==1||d.g!==1||d.b!==1||f!==1)||!1,T=u==="normal",O=n instanceof Yo&&n.normalScale?n.normalScale.x*2:2,J=O.toFixed(ss),V=(-1*(O/2)).toFixed(ss),H=(1-O).toFixed(ss);return`
        ${M?`def Shader "Transform2d_${u}" (
            sdrMetadata = {
                string role = "math"
            }
        )
        {
            uniform token info:id = "UsdTransform2d"
            float2 inputs:in.connect = ${I}
            float2 inputs:scale = ${zB(m)}
            float2 inputs:translation = ${zB(b)}
			float inputs:rotation = ${(y/Math.PI*180).toFixed(ss)}
            float2 outputs:result
        }
		`:""}
		def Shader "Texture_${c.id}_${u}"
        {
            uniform token info:id = "UsdUVTexture"
            asset inputs:file = @textures/Texture_${p}.${A?"png":"jpg"}@
			token inputs:sourceColorSpace = "${c.colorSpace==="srgb"?"sRGB":"raw"}"
            float2 inputs:st.connect = ${M?R:I}
			${C?`
			float4 inputs:scale = (${d?d.r+", "+d.g+", "+d.b:"1, 1, 1"}, ${f!==void 0?f:"1"})
			`:""}
			${T?`
			float4 inputs:scale = (${J}, ${J}, ${J}, 1)
			float4 inputs:bias = (${V}, ${V}, ${H}, 0)
			`:""}
			token inputs:wrapS = "${v[c.wrapS]}"
			token inputs:wrapT = "${v[c.wrapT]}"
            float outputs:r
            float outputs:g
            float outputs:b
            float3 outputs:rgb
            ${n.transparent||n.alphaTest>0?"float outputs:a":""}
        }`}let a=n.transparent||n.alphaTest?n.opacity:1;return n instanceof bo&&n.transmission!==void 0&&(a*=1-n.transmission*(1-n.roughness*.5)),n.side===wi&&console.warn("THREE.USDZExporter: USDZ does not support double sided materials",n),n.map!==null?(s.push(`${i}color3f inputs:diffuseColor.connect = </Materials/Material_${n.id}/Texture_${n.map.id}_diffuse.outputs:rgb>`),n.transparent?s.push(`${i}float inputs:opacity.connect = </Materials/Material_${n.id}/Texture_${n.map.id}_diffuse.outputs:a>`):n.alphaTest>0&&(s.push(`${i}float inputs:opacity.connect = </Materials/Material_${n.id}/Texture_${n.map.id}_diffuse.outputs:a>`),s.push(`${i}float inputs:opacityThreshold = ${n.alphaTest}`)),r.push(o(n.map,"diffuse",n.color,a))):s.push(`${i}color3f inputs:diffuseColor = ${NB(n.color)}`),n.aoMap&&(s.push(`${i}float inputs:occlusion.connect = </Materials/Material_${n.id}/Texture_${n.aoMap.id}_occlusion.outputs:r>`),r.push(o(n.aoMap,"occlusion"))),n.alphaMap?(s.push(`${i}float inputs:opacity.connect = </Materials/Material_${n.id}/Texture_${n.alphaMap.id}_opacity.outputs:r>`),s.push(`${i}float inputs:opacityThreshold = 0.0001`),r.push(o(n.alphaMap,"opacity"))):(s.push(`${i}float inputs:opacity = ${a}`),n.alphaTest>0&&s.push(`${i}float inputs:opacityThreshold = ${n.alphaTest}`)),n instanceof Yo&&(n.emissiveMap?(s.push(`${i}color3f inputs:emissiveColor.connect = </Materials/Material_${n.id}/Texture_${n.emissiveMap.id}_emissive.outputs:rgb>`),r.push(o(n.emissiveMap,"emissive"))):((l=n.emissive)==null?void 0:l.getHex())>0?s.push(`${i}color3f inputs:emissiveColor = ${NB(n.emissive)}`):s.push(`${i}color3f inputs:emissiveColor = (0, 0, 0)`),n.normalMap&&(s.push(`${i}normal3f inputs:normal.connect = </Materials/Material_${n.id}/Texture_${n.normalMap.id}_normal.outputs:rgb>`),r.push(o(n.normalMap,"normal"))),n.roughnessMap&&n.roughness===1?(s.push(`${i}float inputs:roughness.connect = </Materials/Material_${n.id}/Texture_${n.roughnessMap.id}_roughness.outputs:g>`),r.push(o(n.roughnessMap,"roughness"))):s.push(`${i}float inputs:roughness = ${n.roughness!==void 0?n.roughness:1}`),n.metalnessMap&&n.metalness===1?(s.push(`${i}float inputs:metallic.connect = </Materials/Material_${n.id}/Texture_${n.metalnessMap.id}_metallic.outputs:b>`),r.push(o(n.metalnessMap,"metallic"))):s.push(`${i}float inputs:metallic = ${n.metalness!==void 0?n.metalness:0}`)),n instanceof bo&&(s.push(`${i}float inputs:clearcoat = ${n.clearcoat}`),s.push(`${i}float inputs:clearcoatRoughness = ${n.clearcoatRoughness}`),s.push(`${i}float inputs:ior = ${n.ior}`),!n.transparent&&!(n.alphaTest>0)&&n.transmissionMap&&(s.push(`${i}float inputs:opacity.connect = </Materials/Material_${n.id}/Texture_${n.transmissionMap.id}_transmission.outputs:r>`),r.push(o(n.transmissionMap,"transmission")))),`
    def Material "Material_${n.id}"
    {
        def Shader "PreviewSurface"
        {
            uniform token info:id = "UsdPreviewSurface"
${s.join(`
`)}
            int inputs:useSpecularWorkflow = 0
            token outputs:surface
        }

        token outputs:surface.connect = </Materials/Material_${n.id}/PreviewSurface.outputs:surface>

        def Shader "uvReader_st"
        {
            uniform token info:id = "UsdPrimvarReader_float2"
            token inputs:varname = "st"
            float2 inputs:fallback = (0.0, 0.0)
            float2 outputs:result
        }

		def Shader "uvReader_st2"
        {
            uniform token info:id = "UsdPrimvarReader_float2"
            token inputs:varname = "st2"
            float2 inputs:fallback = (0.0, 0.0)
            float2 outputs:result
        }

${r.join(`
`)}

    }
`}function NB(n){return`(${n.r}, ${n.g}, ${n.b})`}function zB(n){return`(${n.x}, ${n.y})`}const sU=[1023,33777,33778,33779,35842,35843,37496,37808,37809,37810,37811,37812,37813,37814,37815,37816,37817,37818,37819,37820,37821,36492],UY=re("debugusdz"),tI=class{constructor(e,t,i){h(this,"id");h(this,"trigger");h(this,"action");h(this,"exclusive",!1);this.id="Behavior_"+yT(e)+"_"+tI.global_id++,this.trigger=t,this.action=i}makeExclusive(e){return this.exclusive=e,this}writeTo(e,t,i){if(!this.trigger||!this.action)return;i.beginBlock(`def Preliminary_Behavior "${this.id}"`),i.appendLine(`rel actions = <${this.action.id}>`),i.appendLine(`uniform bool exclusive = ${this.exclusive}`);let s="";if(Array.isArray(this.trigger)){s="[";for(let r=0;r<this.trigger.length;r++){const o=this.trigger[r];s+="<"+o.id+">",r+1<this.trigger.length&&(s+=", ")}s+="]"}else s=`<${this.trigger.id}>`;if(i.appendLine(`rel triggers = ${s} `),i.appendLine(),Array.isArray(this.trigger))for(const r of this.trigger)r.writeTo(t,i),i.appendLine();else this.trigger.writeTo(t,i);i.appendLine(),this.action.writeTo(t,i),i.closeBlock()}};let Cs=tI;h(Cs,"global_id",0);function tE(n,e){var i,s;let t="";if(Array.isArray(n)){let r="[ ";for(let o=0;o<n.length;o++){let a=n[o];if(typeof a=="string")r+=a;else if(typeof a=="object"){a.isObject3D&&(a=e.findById(a.uuid));const l=(i=a.getPath)==null?void 0:i.call(a);r+=l}o+1<n.length&&(r+=", ")}r+=" ]",t=r}else typeof n=="object"&&(n.isObject3D&&(n=e.findById(n.uuid)),t=(s=n.getPath)==null?void 0:s.call(n));return t=t.replace(e.name,e.name+"/Scenes/Scene"),t}const iI=class{constructor(e,t){h(this,"id");h(this,"targetId");h(this,"tokenId");h(this,"type");h(this,"distance");e&&(this.targetId=e),t?this.id=t:this.id="Trigger_"+iI.global_id++}writeTo(e,t){t.beginBlock(`def Preliminary_Trigger "${this.id}"`),this.targetId&&(typeof this.targetId!="string"&&(this.targetId=tE(this.targetId,e)),t.appendLine("rel affectedObjects = "+this.targetId)),this.tokenId&&t.appendLine(`token info:id = "${this.tokenId}"`),this.type&&t.appendLine(`token type = "${this.type}"`),typeof this.distance=="number"&&t.appendLine(`double distance = ${this.distance}`),t.closeBlock()}};let Vc=iI;h(Vc,"global_id",0);class Nr{static sceneStartTrigger(){const e=new Vc;return e.targetId=void 0,e.tokenId="SceneTransition",e.type="enter",e}static tapTrigger(e){const t=new Vc(e);return t.tokenId="TapGesture",t}static isTapTrigger(e){return(e==null?void 0:e.tokenId)==="TapGesture"}static proximityToCameraTrigger(e,t){const i=new Vc(e);return i.tokenId="ProximityToCamera",i.distance=t,i}}class cu{constructor(e,t){h(this,"id");h(this,"actions");h(this,"loops",0);h(this,"performCount",1);h(this,"type","serial");this.id=e,this.actions=t}static getId(){return this.global_id++}addAction(e){return this.actions.push(e),this}makeParallel(){return this.type="parallel",this}makeSequence(){return this.type="serial",this}makeLooping(){return this.loops=1,this}makeRepeat(e){return this.performCount=e,this}writeTo(e,t){t.beginBlock(`def Preliminary_Action "${this.id}"`),t.beginArray("rel actions");for(const i of this.actions)i&&t.appendLine("<"+i.id+">,");t.closeArray(),t.appendLine(),t.appendLine('token info:id = "Group"'),t.appendLine(`bool loops = ${this.loops} `),t.appendLine(`int performCount = ${this.performCount} `),t.appendLine(`token type = "${this.type}"`),t.appendLine();for(const i of this.actions)i&&(i.writeTo(e,t),t.appendLine());t.closeBlock()}}h(cu,"global_id",0);var Bm;(function(n){n[n.pop=0]="pop",n[n.blink=1]="blink",n[n.bounce=2]="bounce",n[n.flip=3]="flip",n[n.float=4]="float",n[n.jiggle=5]="jiggle",n[n.pulse=6]="pulse",n[n.spin=7]="spin"})(Bm||(Bm={}));var E0;(function(n){n.Relative="relative",n.Absolute="absolute"})(E0||(E0={}));var iE;(function(n){n.Allow="allow",n.Ignore="ignore",n.Stop="stop"})(iE||(iE={}));const ob=class{constructor(e,t){h(this,"id");h(this,"tokenId");h(this,"affectedObjects");h(this,"easeType");h(this,"motionType");h(this,"duration");h(this,"moveDistance");h(this,"style");h(this,"type");h(this,"front");h(this,"up");h(this,"start");h(this,"animationSpeed");h(this,"reversed");h(this,"pingPong");h(this,"xFormTarget");h(this,"audio");h(this,"gain");h(this,"auralMode");h(this,"multiplePerformOperation");e&&(this.affectedObjects=e),t?this.id=t:this.id="Action",this.id+="_"+ob.global_id++}clone(){const e=new ob,t=e.id;return Object.assign(e,this),e.id=t,e}writeTo(e,t){t.beginBlock(`def Preliminary_Action "${this.id}"`),this.affectedObjects&&(typeof this.affectedObjects!="string"&&(this.affectedObjects=tE(this.affectedObjects,e)),t.appendLine("rel affectedObjects = "+this.affectedObjects)),typeof this.duration=="number"&&t.appendLine(`double duration = ${this.duration} `),this.easeType&&t.appendLine(`token easeType = "${this.easeType}"`),this.tokenId&&t.appendLine(`token info:id = "${this.tokenId}"`),this.motionType&&t.appendLine(`token motionType = "${this.motionType}"`),typeof this.moveDistance=="number"&&t.appendLine(`double moveDistance = ${this.moveDistance} `),this.style&&t.appendLine(`token style = "${this.style}"`),this.type&&t.appendLine(`token type = "${this.type}"`),this.front&&t.appendLine(`vector3d front = (${this.front.x}, ${this.front.y}, ${this.front.z})`),this.up&&t.appendLine(`vector3d upVector = (${this.up.x}, ${this.up.y}, ${this.up.z})`),typeof this.start=="number"&&t.appendLine(`double start = ${this.start} `),typeof this.animationSpeed=="number"&&t.appendLine(`double animationSpeed = ${this.animationSpeed} `),typeof this.reversed=="boolean"&&t.appendLine(`bool reversed = ${this.reversed}`),typeof this.pingPong=="boolean"&&t.appendLine(`bool reverses = ${this.pingPong}`),this.xFormTarget&&(typeof this.xFormTarget!="string"&&(this.xFormTarget=tE(this.xFormTarget,e)),t.appendLine(`rel xformTarget = ${this.xFormTarget}`)),typeof this.audio=="string"&&t.appendLine(`asset audio = @${this.audio}@`),typeof this.gain=="number"&&t.appendLine(`double gain = ${this.gain}`),typeof this.auralMode=="string"&&t.appendLine(`token auralMode = "${this.auralMode}"`),typeof this.multiplePerformOperation=="string"&&t.appendLine(`token multiplePerformOperation = "${this.multiplePerformOperation}"`),t.closeBlock()}};let po=ob;h(po,"global_id",0);let Yd=class Ud{constructor(e,t,i){h(this,"x",0);h(this,"y",0);h(this,"z",0);this.x=e,this.y=t,this.z=i}static get up(){return new Ud(0,1,0)}static get right(){return new Ud(1,0,0)}static get forward(){return new Ud(0,0,1)}static get back(){return new Ud(0,0,-1)}static get zero(){return new Ud(0,0,0)}};var M0;(function(n){n.Play="play",n.Pause="pause",n.Stop="stop"})(M0||(M0={}));var Dm;(function(n){n.Spatial="spatial",n.NonSpatial="nonSpatial",n.Ambient="ambient"})(Dm||(Dm={}));class di{static sequence(...e){return new cu("group_"+cu.getId(),e).makeSequence()}static parallel(...e){return new cu("group_"+cu.getId(),e).makeParallel()}static fadeAction(e,t,i){const s=new po(e);return s.tokenId="Visibility",s.type=i?"show":"hide",s.duration=t,s.style="basic",s.motionType="none",s.moveDistance=0,s.easeType="none",s}static startAnimationAction(e,t,i=0,s=1,r=!1,o=!1){const a=new po(e);if(a.tokenId="StartAnimation",a.start=t,a.duration=i,a.animationSpeed=s,a.reversed=r,a.pingPong=o,r&&(a.start-=i),o){a.pingPong=!1;const l=a.clone();return l.reversed=!r,l.start=a.start,l.reversed&&(l.start-=i),di.sequence(a,l)}return UY&&console.log("Start Animation Action",a),a}static waitAction(e){const t=new po;return t.tokenId="Wait",t.duration=e,t}static lookAtCameraAction(e,t=9999999999999,i,s){const r=new po(e);return r.tokenId="LookAtCamera",r.duration=t,r.front=i??Yd.forward,r.up=s??Yd.up,r}static emphasize(e,t,i=Bm.bounce,s=1,r="basic"){const o=new po(e);return o.tokenId="Emphasize",o.duration=t,o.style=r??"basic",o.motionType=Bm[i],o.moveDistance=s,o}static transformAction(e,t,i,s,r="inout"){const o=new po(e);return o.tokenId="Transform",o.duration=i,o.type=s,o.easeType=r,Array.isArray(t)&&console.error("Transform target must not be an array",t),o.xFormTarget=t,o}static playAudioAction(e,t,i=M0.Play,s=1,r=Dm.Spatial){const o=new po(e);return o.tokenId="Audio",o.type=i,o.audio=t,o.gain=s,o.auralMode=r,o.multiplePerformOperation=iE.Allow,o}}class NY{constructor(e){h(this,"object");h(this,"model");this.object=e}get id(){return this.object.uuid}apply(e){if(!this.model&&(this.model=e.findById(this.object.uuid),!this.model)){console.error("could not find model with id "+this.object.uuid);return}this.onApply(e)}}class rU extends NY{constructor(t,i,s,r){super(t);h(this,"matrix");h(this,"material");h(this,"geometry");h(this,"_enableAction");h(this,"_disableAction");this.matrix=i,this.material=s,this.geometry=r}onApply(t){var r,o;const i=this.model;if(!i)return;(r=i.parent)!=null&&r.isDynamic||Or.createEmptyParent(i);const s=i.clone();this.matrix&&(s.matrix=this.matrix),this.material&&(s.material=this.material),this.geometry&&(s.geometry=this.geometry),(o=i.parent)==null||o.add(s)}enable(){return this._enableAction?this._enableAction:(this._enableAction=di.fadeAction(this.object,0,!0),this._enableAction)}disable(){return this._disableAction?this._disableAction:(this._disableAction=di.fadeAction(this.object,0,!1),this._disableAction)}}class oU{constructor(e){h(this,"actions");h(this,"sortedActions");this.actions=[...e]}organize(){this.sortedActions={};for(const e of this.actions){const t=e.id;this.sortedActions[t]||(this.sortedActions[t]=[]),this.sortedActions[t].push(e)}}getActions(e){return this.sortedActions||this.organize(),this.sortedActions[e.uuid]}}var aU=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};class A_ extends Te{constructor(){super(...arguments);h(this,"from");h(this,"to");h(this,"width",0);h(this,"centered",!0);h(this,"_centerPos")}awake(){this._centerPos=new w}update(){if(!this.from||!this.to)return;const t=Mt(this.from).clone(),i=Mt(this.to).clone(),s=t.distanceTo(i);this._centerPos.copy(t),this._centerPos.add(i),this._centerPos.multiplyScalar(.5),On(this.gameObject,this.centered?this._centerPos:t),this.gameObject.lookAt(Mt(this.to).clone()),this.gameObject.scale.set(this.width,this.width,s)}}aU([x(ne)],A_.prototype,"from",void 0);aU([x(ne)],A_.prototype,"to",void 0);var uA=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const Td=re("debuganimation");class xo extends Te{constructor(){super(...arguments);h(this,"playAutomatically",!0);h(this,"randomStartTime",!0);h(this,"minMaxSpeed");h(this,"minMaxOffsetNormalized");h(this,"loop",!0);h(this,"clampWhenFinished",!1);h(this,"_tempAnimationClipBeforeGameObjectExisted",null);h(this,"_tempAnimationsArray");h(this,"mixer");h(this,"_actions",[]);h(this,"_currentActions",[]);h(this,"_handles",[]);h(this,"_didInit",!1)}get clip(){var t;return(t=this.animations)!=null&&t.length?this.animations[0]:null}set clip(t){if(!this.__didAwake){Td&&console.warn("Assign clip during serialization",t),this._tempAnimationClipBeforeGameObjectExisted=t;return}t&&(this.gameObject.animations||(this.gameObject.animations=[]),!this.animations.includes(t)&&(this.animations.length>0?this.animations.splice(0,0,t):this.animations.push(t)))}set clips(t){this.animations=t}set animations(t){t==null||!Array.isArray(t)||(this.gameObject?this.gameObject.animations=t:this._tempAnimationsArray=t)}get animations(){return this.gameObject.animations||this._tempAnimationsArray||[]}get currentAction(){return this._currentActions[0]}get currentActions(){return this._currentActions}get actions(){return this._actions}set actions(t){this._actions=t}awake(){Td&&console.log("Animation Awake",this.name,this),this._tempAnimationsArray&&(this.animations=this._tempAnimationsArray,this._tempAnimationsArray=void 0),this._tempAnimationClipBeforeGameObjectExisted&&(this.clip=this._tempAnimationClipBeforeGameObjectExisted,this._tempAnimationClipBeforeGameObjectExisted=null),this.playAutomatically&&this.init()}onEnable(){var t;if(this.playAutomatically&&((t=this.animations)==null?void 0:t.length)>0&&this.currentActions.length<=0){const i=Math.floor(Math.random()*this.actions.length);this.play(i)}}start(){this.randomStartTime&&this.currentAction&&(this.currentAction.time=Math.random()*this.currentAction.getClip().duration)}update(){this.mixer&&this.mixer.update(this.context.time.deltaTime)}getAction(t){var i;return(i=this.actions)==null?void 0:i.find(s=>s.getClip().name===t)}get isPlaying(){for(let t=0;t<this.actions.length;t++)if(this.actions[t].isRunning())return!0;return!1}play(t=0,i){if(Td&&console.log("PLAY",t),this.init(),!this.mixer){Td&&console.warn("Missing mixer",this);return}t===void 0&&(t=0);let s=t;if(typeof t=="number"){if(t>=this.animations.length){Td&&console.log("No animation at index",t);return}s=this.animations[t]}else typeof t=="string"&&(s=this.animations.find(o=>o.name===t));if(!s){console.error("Could not find clip",t);return}i||(i={}),i.minMaxOffsetNormalized||(i.minMaxOffsetNormalized=this.minMaxOffsetNormalized),i.minMaxSpeed||(i.minMaxSpeed=this.minMaxSpeed),i.loop===void 0&&(i.loop=this.loop),i.clampWhenFinished===void 0&&(i.clampWhenFinished=this.clampWhenFinished);for(const o of this.actions)if(o.getClip()===s)return this.internalOnPlay(o,i);if(!(s instanceof fr)){console.warn("Clip is no AnimationClip",s,"on object: "+this.name);return}const r=this.mixer.clipAction(s);return this.actions.push(r),this.internalOnPlay(r,i)}internalOnPlay(t,i){var s=this.currentAction;if(s===t&&s.isRunning()&&s.time<s.getClip().duration){const l=this.tryFindHandle(t);if(l)return l.getPromise()}const r=(i==null?void 0:i.exclusive)??!0;i!=null&&i.fadeDuration?(r&&(s==null||s.fadeOut(i.fadeDuration)),t.fadeIn(i.fadeDuration)):r&&(s==null||s.stop()),t.reset(),t.enabled=!0,t.time=0,t.timeScale=1;const o=t.getClip();i!=null&&i.minMaxOffsetNormalized&&(t.time=tt.lerp(i.minMaxOffsetNormalized.x,i.minMaxOffsetNormalized.y,Math.random())*o.duration),i!=null&&i.minMaxSpeed&&(t.timeScale=tt.lerp(i.minMaxSpeed.x,i.minMaxSpeed.y,Math.random())),i!=null&&i.clampWhenFinished&&(t.clampWhenFinished=!0),(i==null?void 0:i.startTime)!==void 0&&(t.time=i.startTime),(i==null?void 0:i.loop)!==void 0?t.loop=i.loop?YE:fm:t.loop=fm,t.play(),Td&&console.log("PLAY",t.getClip().name,t);const a=new zY(t,this.mixer,i,l=>{this._handles.splice(this._handles.indexOf(a),1)});return this._handles.push(a),a.getPromise()}tryFindHandle(t){for(const i of this._handles)if(i.action===t)return i}init(){this._didInit||(this._didInit=!0,this.gameObject&&(this.actions=[],this.mixer=new Zb(this.gameObject)))}}uA([x()],xo.prototype,"playAutomatically",void 0);uA([x()],xo.prototype,"randomStartTime",void 0);uA([x()],xo.prototype,"loop",void 0);uA([x()],xo.prototype,"clampWhenFinished",void 0);uA([x(fr)],xo.prototype,"clips",null);class zY{constructor(e,t,i,s){h(this,"mixer");h(this,"action");h(this,"promise",null);h(this,"resolve",null);h(this,"reject",null);h(this,"_options");h(this,"_resolveCallback",null);h(this,"_rejectCallback",null);h(this,"_loopCallback");h(this,"_finishedCallback");h(this,"_resolvedOrRejectedCallback");this.action=e,this.mixer=t,this._resolvedOrRejectedCallback=s,this._options=i}getPromise(){return this.promise?this.promise:(this.promise=new Promise((e,t)=>{this._resolveCallback=e,this._rejectCallback=t,this.resolve=this.onResolve.bind(this),this.reject=this.onReject.bind(this)}),this._loopCallback=this.onLoop.bind(this),this._finishedCallback=this.onFinished.bind(this),this.mixer.addEventListener("loop",this._loopCallback),this.mixer.addEventListener("finished",this._finishedCallback),this.promise)}_update(){this._options&&this._options.endTime!==void 0&&this.action.time>this._options.endTime&&(this._options.loop===!0?this.action.time=this._options.startTime??0:(this.action.time=this._options.endTime,this.action.timeScale=0,this.onResolve()))}onResolve(){var e,t;this.dispose(),(e=this._resolvedOrRejectedCallback)==null||e.call(this,this),(t=this._resolveCallback)==null||t.call(this,this.action)}onReject(e){var t,i;this.dispose(),(t=this._resolvedOrRejectedCallback)==null||t.call(this,this),(i=this._rejectCallback)==null||i.call(this,e)}onLoop(e){}onFinished(e){e.action===this.action&&this.onResolve()}dispose(){this._loopCallback&&this.mixer.removeEventListener("loop",this._loopCallback),this._finishedCallback&&this.mixer.removeEventListener("finished",this._finishedCallback),this._loopCallback=void 0,this._finishedCallback=void 0}}var uh=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};class dh{constructor(){h(this,"time");h(this,"value");h(this,"inTangent");h(this,"inWeight");h(this,"outTangent");h(this,"outWeight");h(this,"weightedMode")}}uh([x()],dh.prototype,"time",void 0);uh([x()],dh.prototype,"value",void 0);uh([x()],dh.prototype,"inTangent",void 0);uh([x()],dh.prototype,"inWeight",void 0);uh([x()],dh.prototype,"outTangent",void 0);uh([x()],dh.prototype,"outWeight",void 0);uh([x()],dh.prototype,"weightedMode",void 0);class fh{constructor(){h(this,"keys")}get duration(){return!this.keys||this.keys.length==0?0:this.keys[this.keys.length-1].time}evaluate(e){if(!this.keys||this.keys.length==0)return 0;if(this.keys[0].time>=e)return this.keys[0].value;for(let t=0;t<this.keys.length;t++){const i=this.keys[t];if(i.time<=e)if(t+1<this.keys.length){const r=this.keys[t+1];if(r.time<e)continue;return!isFinite(i.outTangent)||!isFinite(r.inTangent)?i.value:fh.interpolateValue(e,i,r)}else return i.value}return this.keys[this.keys.length-1].value}static interpolateValue(e,t,i){const s=t.time,r=t.value,o=t.outTangent,a=i.time,l=i.value,c=i.inTangent,u=a-s,d=u*u,f=d*u,p=((o+c)*u-2*(l-r))/f,g=(3*(l-r)-(c+2*o)*u)/d,A=o,v=r,m=e-s,b=m*m,y=b*m;return p*y+g*b+A*m+v}}uh([x(dh)],fh.prototype,"keys",void 0);const hu=re("debugusdzanimation"),nE=re("debugusdzanimationserialization");class bT{constructor(e,t,i){h(this,"ext");h(this,"root");h(this,"clip");this.ext=e,this.root=t,this.clip=i}get start(){return this.ext.getStartTime01(this.root,this.clip)}get duration(){return this.clip.duration}}const nI=class{constructor(e,t,i,s){h(this,"clip");h(this,"pos");h(this,"rot");h(this,"scale");h(this,"ext");h(this,"root");h(this,"target");h(this,"duration",0);this.ext=e,this.root=t,this.target=i,this.clip=s}get frameRate(){return 60}addTrack(e){e.name.endsWith("position")&&(this.pos=e),e.name.endsWith("quaternion")&&(this.rot=e),e.name.endsWith("scale")&&(this.scale=e),this.duration=this.clip.duration}getFrames(){var e,t,i,s,r,o;return Math.max(((t=(e=this.pos)==null?void 0:e.times)==null?void 0:t.length)??0,((s=(i=this.rot)==null?void 0:i.times)==null?void 0:s.length)??0,((o=(r=this.scale)==null?void 0:r.times)==null?void 0:o.length)??0)}getDuration(){return this.duration}getStartTime(e){const t=[];for(const[s,r]of e)for(const o of r)t.includes(o.clip)||t.push(o.clip);hu&&console.log(t,this.clip);let i=0;for(const s of t){if(s===this.clip)break;i+=s.duration+nI.animationDurationPadding}return i}};let bu=nI;h(bu,"animationDurationPadding",1);class _T{constructor(){h(this,"dict",new Map);h(this,"rootTargetMap",new Map);h(this,"serializers",[])}get extensionName(){return"animation"}getStartTime01(e,t){const i=this.rootTargetMap.get(e);if(!i)return 1/0;let s=-1;for(const r of i){hu&&console.log("  "+r.name);const o=this.dict.get(r);let a=0;if(o!=null&&o.length){let l=!1;for(const c of o){if(hu&&console.log("    ",c.clip.name,c.getDuration()),c.clip===t){l=!0;break}a+=c.getDuration()+bu.animationDurationPadding}l&&(s=Math.max(s,a))}else console.warn("No animation found on root",e,t,o)}return hu&&console.log("getStartTime01 for "+t.name+": "+s,e,t,i),s}registerAnimation(e,t){if(!t||!e)return null;if(this.rootTargetMap.has(e)||this.rootTargetMap.set(e,[]),t.tracks)for(const s of t.tracks){const r=kt.parseTrackName(s.name),o=kt.findNode(e,r.nodeName);if(!o){console.warn("no object found for track",s.name,"using "+e.name+" instead");continue}this.dict.has(o)||this.dict.set(o,[]);const a=this.dict.get(o);if(!a)continue;let l=a.find(u=>u.clip===t);l||(l=new bu(this,e,o,t),a.push(l)),l.addTrack(s);const c=this.rootTargetMap.get(e);c!=null&&c.includes(o)||c==null||c.push(o)}return new bT(this,e,t)}onAfterHierarchy(e){hu&&console.log("Animation clips per animation target node",this.dict)}onAfterBuildDocument(e){var t,i;for(const s of this.serializers){const r=(t=s.model)==null?void 0:t.parent,o=(r==null?void 0:r.isDynamic)===!0;nE&&console.log(o,(i=s.model)==null?void 0:i.parent),o&&s.registerCallback(r)}}onExportObject(e,t,i){ne.foreachComponent(e,r=>{const o=r;typeof o.createAnimation=="function"&&o.createAnimation(this,t,i)},!1);const s=new GY(e,this.dict);this.serializers.push(s),s.registerCallback(t)}}class GY{constructor(e,t){h(this,"object");h(this,"dict");h(this,"model");h(this,"callback");this.object=e,this.dict=t}registerCallback(e){this.model&&this.callback&&this.model.removeEventListener("serialize",this.callback),this.callback||(this.callback=this.onSerialize.bind(this)),nE&&console.log("REPARENT",e),this.model=e,this.model.addEventListener("serialize",this.callback)}onSerialize(e,t){var c,u,d,f,p,g;if(!this.model)return;const i=this.object,s=this.dict.get(i);if(!s)return;nE&&console.log("SERIALIZE",this.model.name,this.object.type,s);const r=new Ie,o=new w,a=new Se,l=new w(1,1,1);e.appendLine("matrix4d xformOp:transform.timeSamples = {"),e.indent++;for(const A of s){const v=(c=A.pos)==null?void 0:c.times,m=(u=A.rot)==null?void 0:u.times,b=(d=A.scale)==null?void 0:d.times;let y=[];if(v)for(const R of v)y.push(R);if(m)for(const R of m)y.push(R);if(b)for(const R of b)y.push(R);if(y.includes(0)||y.push(0),y.sort((R,C)=>R-C),y=[...new Set(y)],!y||y.length===0){console.error("got an animated object but no time values?",i,A);continue}const _=A.getStartTime(this.dict);if(hu){const R=A.clip.name,C=A.getDuration();console.log("Write .timeSamples:",R,_,C,s),e.appendLine("# "+R+": start="+(_*A.frameRate).toFixed(3)+", length="+(C*A.frameRate).toFixed(3)+", frames="+A.getFrames())}const E=(f=A.pos)==null?void 0:f.createInterpolant(),M=(p=A.rot)==null?void 0:p.createInterpolant(),I=(g=A.scale)==null?void 0:g.createInterpolant();E||o.set(i.position.x,i.position.y,i.position.z),M||a.set(i.quaternion.x,i.quaternion.y,i.quaternion.z,i.quaternion.w),I||l.set(i.scale.x,i.scale.y,i.scale.z);for(let R=0;R<y.length;R++){const C=y[R];if(E){const O=E.evaluate(C);o.set(O[0],O[1],O[2])}if(M){const O=M.evaluate(C);a.set(O[0],O[1],O[2],O[3])}if(I){const O=I.evaluate(C);l.set(O[0],O[1],O[2])}r.compose(o,a,l);const T=`${(_+C)*A.frameRate}: ${nU(r)},`;hu&&e.appendLine("# "+R),e.appendLine(T)}}e.indent--,e.appendLine("}")}}class Gw{constructor(e,t,i,s){h(this,"_name");h(this,"_nameHash");h(this,"_normalizedTime");h(this,"_length");h(this,"_speed");this._name=e.name,this._nameHash=e.hash,this._normalizedTime=t,this._length=i,this._speed=s}get name(){return this._name}get nameHash(){return this._nameHash}get normalizedTime(){return this._normalizedTime}get length(){return this._length}get speed(){return this._speed}}function VY(n,e){return{name:"",isLooping:!1,guid:(e==null?void 0:e.generateUUID())??cs.generateUUID(),index:-1,clip:new fr(n,1,[])}}var Cc;(function(n){n[n.If=1]="If",n[n.IfNot=2]="IfNot",n[n.Greater=3]="Greater",n[n.Less=4]="Less",n[n.Equals=6]="Equals",n[n.NotEqual=7]="NotEqual"})(Cc||(Cc={}));var sE;(function(n){n[n.Float=1]="Float",n[n.Int=3]="Int",n[n.Bool=4]="Bool",n[n.Trigger=9]="Trigger"})(sE||(sE={}));const Oo=re("debuganimatorcontroller"),jv=re("debugrootmotion");class Pu{constructor(e){h(this,"normalizedStartOffset",0);h(this,"_speed",1);h(this,"animator");h(this,"model");h(this,"_mixer");h(this,"_activeState");h(this,"_activeStates",[]);h(this,"rootMotionHandler");this.model=e,Oo&&console.log(this)}static createFromClips(e,t={looping:!1,autoTransition:!0,transitionDuration:0}){const i=[];for(let o=0;o<e.length;o++){const a=e[o],l=[];if(t.autoTransition!==!1){const u=t.transitionDuration??0,d=u/a.duration;let f=o;(t.autoTransition===void 0||t.autoTransition===!0)&&(f=(o+1)%e.length),l.push({exitTime:1-d,offset:0,duration:u,hasExitTime:!0,destinationState:f,conditions:[]})}const c={name:a.name,hash:o,motion:{name:a.name,clip:a,isLooping:(t==null?void 0:t.looping)??!1},transitions:l,behaviours:[]};i.push(c)}const s={name:"AnimatorController",guid:new Ws(Date.now()).generateUUID(),parameters:[],layers:[{name:"Base Layer",stateMachine:{defaultState:0,states:i}}]};return new Pu(s)}play(e,t=-1,i=Number.NEGATIVE_INFINITY,s=0){if(t<0)t=0;else if(t>=this.model.layers.length){console.warn("invalid layer");return}const o=this.model.layers[t].stateMachine;for(const a of o.states)if(a.name===e||a.hash===e){Oo&&console.log("transition to ",a),this.transitionTo(a,s,i);return}console.warn("Could not find "+e+" to play")}reset(){this.setStartTransition()}setBool(e,t){var s,r;const i=typeof e=="string"?"name":"hash";return(r=(s=this.model)==null?void 0:s.parameters)==null?void 0:r.filter(o=>o[i]===e).forEach(o=>o.value=t)}getBool(e){var i,s,r;const t=typeof e=="string"?"name":"hash";return((r=(s=(i=this.model)==null?void 0:i.parameters)==null?void 0:s.find(o=>o[t]===e))==null?void 0:r.value)??!1}setFloat(e,t){var s,r;const i=typeof e=="string"?"name":"hash";return(r=(s=this.model)==null?void 0:s.parameters)==null?void 0:r.filter(o=>o[i]===e).forEach(o=>o.value=t)}getFloat(e){var i,s,r;const t=typeof e=="string"?"name":"hash";return((r=(s=(i=this.model)==null?void 0:i.parameters)==null?void 0:s.find(o=>o[t]===e))==null?void 0:r.value)??0}setInteger(e,t){var s,r;const i=typeof e=="string"?"name":"hash";return(r=(s=this.model)==null?void 0:s.parameters)==null?void 0:r.filter(o=>o[i]===e).forEach(o=>o.value=t)}getInteger(e){var i,s,r;const t=typeof e=="string"?"name":"hash";return((r=(s=(i=this.model)==null?void 0:i.parameters)==null?void 0:s.find(o=>o[t]===e))==null?void 0:r.value)??0}setTrigger(e){var i,s;Oo&&console.log("SET TRIGGER",e);const t=typeof e=="string"?"name":"hash";return(s=(i=this.model)==null?void 0:i.parameters)==null?void 0:s.filter(r=>r[t]===e).forEach(r=>r.value=!0)}resetTrigger(e){var i,s;const t=typeof e=="string"?"name":"hash";return(s=(i=this.model)==null?void 0:i.parameters)==null?void 0:s.filter(r=>r[t]===e).forEach(r=>r.value=!1)}getTrigger(e){var i,s,r;const t=typeof e=="string"?"name":"hash";return((r=(s=(i=this.model)==null?void 0:i.parameters)==null?void 0:s.find(o=>o[t]===e))==null?void 0:r.value)??!1}isInTransition(){return this._activeStates.length>1}setSpeed(e){this._speed=e}FindState(e){return this.findState(e)}findState(e){if(!e)return null;if(Array.isArray(this.model.layers)){for(const t of this.model.layers)for(const i of t.stateMachine.states)if(i.name===e||i.hash==e)return i}return null}get context(){var e;return(e=this.animator)==null?void 0:e.context}get mixer(){return this._mixer}bind(e){this.animator!==e&&(this.animator=e,this._mixer=new Zb(this.animator.gameObject),this.createActions(this.animator))}clone(){if(typeof this.model=="string")return console.warn("AnimatorController has not been resolved, can not create model from string",this.model),null;const e=FM(this.model,(i,s,r)=>r==null?!0:!(r.type==="Object3D"||r.isObject3D===!0||U8(r)||r.tracks!==void 0));return console.assert(e!==this.model),new Pu(e)}update(e){var i,s;if(!this.animator)return;this.evaluateTransitions(),this.updateActiveStates(e);const t=this.animator.context.time.deltaTime;this.animator.applyRootMotion&&((i=this.rootMotionHandler)==null||i.onBeforeUpdate(e)),this._mixer.update(t),this.animator.applyRootMotion&&((s=this.rootMotionHandler)==null||s.onAfterUpdate(e))}get activeState(){return this._activeState}updateActiveStates(e){for(let t=0;t<this._activeStates.length;t++){const i=this._activeStates[t],s=i.motion;if(!s.action)this._activeStates.splice(t,1),t--;else{const r=s.action;r.weight=e,r.getEffectiveWeight()<=0&&!r.isRunning()&&(Oo&&console.debug("REMOVE",i.name,r.getEffectiveWeight(),r.isRunning(),r.isScheduled()),this._activeStates.splice(t,1),t--)}}}setStartTransition(){for(const e of this.model.layers){const t=e.stateMachine;t.defaultState===void 0&&(Oo&&console.warn("AnimatorController default state is undefined, will assign state 0 as default",e),t.defaultState=0);const i=t.states[t.defaultState];this.transitionTo(i,0,this.normalizedStartOffset)}}evaluateTransitions(){var r;let e=!1;if(!this._activeState){if(this.setStartTransition(),!this._activeState)return;e=!0}const t=this._activeState,i=t.motion.action;for(const o of t.transitions){if(!o.hasExitTime&&o.conditions.length<=0)continue;let a=!0;for(const l of o.conditions)if(!this.evaluateCondition(l)){a=!1;break}if(a)if(i){const l=t.motion.clip.duration,c=l<=0?1:Math.abs(i.time/l);let u=!1;if(o.hasExitTime?i.timeScale>0?u=c>=o.exitTime:i.timeScale<0&&(u=1-c>=o.exitTime):u=!0,u){for(const d of o.conditions){const f=this.model.parameters.find(p=>p.name===d.parameter);(f==null?void 0:f.type)===sE.Trigger&&f.value&&(f.value=!1)}i.clampWhenFinished=!0,Oo&&console.log("transition to "+o.destinationState,o,c,o.exitTime,o.hasExitTime),this.transitionTo(o.destinationState,o.duration,o.offset);return}}else{this.transitionTo(o.destinationState,o.duration,o.offset);return}}let s=!1;if(t.motion.isLooping&&i&&(i.time>=i.getClip().duration?(s=!0,i.reset(),i.time=0,i.play()):i.time<=0&&i.timeScale<0&&(s=!0,i.reset(),i.time=i.getClip().duration,i.play())),!s&&t&&!e&&i&&this.animator&&t.behaviours){const o=i==null?void 0:i.getClip().duration,a=i.time/o,l=new Gw(this._activeState,a,o,this._speed);for(const c of t.behaviours)c.instance&&((r=c.instance.onStateUpdate)==null||r.call(c.instance,this.animator,l,0))}}getState(e,t){return typeof e=="number"&&(e==-1&&(e=this.model.layers[t].stateMachine.defaultState,e===void 0&&(Oo&&console.warn("AnimatorController default state is undefined: ",this.model,"Layer: "+t),e=0)),e=this.model.layers[t].stateMachine.states[e]),e}transitionTo(e,t,i){var c,u,d,f,p,g,A,v;if(!this.animator)return;const s=0;if(e=this.getState(e,s),!(e!=null&&e.motion)||!e.motion.clip||!(e.motion.clip instanceof fr))return;const r=this._activeState===e;if(r){const m=e.motion;if(!m.action_loopback&&m.clip){const b=this.rootMotionHandler?this.animator.gameObject.matrix.clone():null;this._mixer.uncacheAction(m.clip,this.animator.gameObject),b&&b.decompose(this.animator.gameObject.position,this.animator.gameObject.quaternion,this.animator.gameObject.scale),m.action_loopback=this.createAction(m.clip)}}if((c=this._activeState)!=null&&c.behaviours&&this._activeState.motion.action){const m=(u=this._activeState)==null?void 0:u.motion.clip.duration,b=this._activeState.motion.action.time/m,y=new Gw(this._activeState,b,m,this._speed);for(const _ of this._activeState.behaviours)(f=(d=_.instance)==null?void 0:d.onStateExit)==null||f.call(_.instance,this.animator,y,s)}const o=(p=this._activeState)==null?void 0:p.motion.action;o&&o.fadeOut(t),r&&(e.motion.action=e.motion.action_loopback,e.motion.action_loopback=o);const a=this._activeState;this._activeState=e;const l=(g=e.motion)==null?void 0:g.action;if(l){i=Math.max(0,Math.min(1,i)),l.isRunning()&&l.stop(),l.reset(),l.timeScale=this._speed,e.speed!==void 0&&(l.timeScale*=e.speed),l.enabled=!0;const m=e.motion.clip.duration;if(l.time=i*m,l.timeScale<0&&(l.time=m-l.time),l.clampWhenFinished=!0,l.setLoop(fm,0),t>0?l.fadeIn(t):l.weight=1,l.play(),this.rootMotionHandler&&this.rootMotionHandler.onStart(l),this._activeStates.includes(e)||this._activeStates.push(e),this._activeState.behaviours){const b=new Gw(e,i,m,this._speed);for(const y of this._activeState.behaviours)(v=(A=y.instance)==null?void 0:A.onStateEnter)==null||v.call(y.instance,this.animator,b,s)}}else Oo&&(e.__warned_no_motion||(e.__warned_no_motion=!0,console.warn("No action",e.motion,this)));Oo&&console.log("TRANSITION FROM "+(a==null?void 0:a.name)+" TO "+e.name,t,o,l,l==null?void 0:l.getEffectiveTimeScale(),l==null?void 0:l.getEffectiveWeight(),l==null?void 0:l.isRunning(),l==null?void 0:l.isScheduled(),l==null?void 0:l.paused)}createAction(e){var i,s;if(this._mixer.existingAction(e)&&this._mixer.uncacheAction(e,(i=this.animator)==null?void 0:i.gameObject),(s=this.animator)!=null&&s.applyRootMotion){this.rootMotionHandler||(this.rootMotionHandler=new HY(this));const r=this.animator.gameObject;return this.rootMotionHandler.createClip(this._mixer,r,e)}else return this._mixer.clipAction(e)}evaluateCondition(e){const t=this.model.parameters.find(i=>i.name===e.parameter);if(!t)return!1;switch(e.mode){case Cc.If:return t.value===!0;case Cc.IfNot:return t.value===!1;case Cc.Greater:return t.value>e.threshold;case Cc.Less:return t.value<e.threshold;case Cc.Equals:return t.value===e.threshold;case Cc.NotEqual:return t.value!==e.threshold}return!1}createActions(e){var t,i;for(const s of this.model.layers){const r=s.stateMachine;for(let o=0;o<r.states.length;o++){const a=r.states[o];a.transitions||(a.transitions=[]);for(const l of a.transitions)l.conditions||(l.conditions=[]);if(a.motion||(a.motion=VY(a.name)),this.animator&&a.motion.clips){const l=(t=a.motion.clips)==null?void 0:t.find(c=>{var u,d;return c.node.name===((d=(u=this.animator)==null?void 0:u.gameObject)==null?void 0:d.name)});a.motion.clip=l==null?void 0:l.clip}if(!a.motion.clip){const l=new fr(void 0,void 0,[]);a.motion.clip=l}if((i=a.motion)!=null&&i.clip){const l=a.motion.clip;if(l instanceof fr){const c=this.createAction(l);a.motion.action=c}else(Oo||si())&&console.warn("No valid animationclip assigned",a)}if(a.behaviours&&Array.isArray(a.behaviours))for(const l of a.behaviours){if(!(l!=null&&l.typeName))continue;const c=q.get(l.typeName),u=new c;u.isStateMachineBehaviour&&(u._context=this.context??void 0,Ff(u,l.properties),l.instance=u),Oo&&console.log("Created animator controller behaviour",a.name,l.typeName,l.properties,u)}}}}*enumerateActions(){if(this.model.layers)for(const e of this.model.layers){const t=e.stateMachine;for(let i=0;i<t.states.length;i++){const s=t.states[i];s!=null&&s.motion&&(s.motion.action&&(yield s.motion.action),s.motion.action_loopback&&(yield s.motion.action_loopback))}}}}class GB{constructor(e,t){h(this,"track");h(this,"createdInterpolant");h(this,"originalEvaluate");h(this,"customEvaluate");this.track=e;const i=e,s=i.createInterpolant.bind(e);i.createInterpolant=()=>(i.createInterpolant=s,this.createdInterpolant=s(),this.originalEvaluate=this.createdInterpolant.evaluate.bind(this.createdInterpolant),this.customEvaluate=r=>{if(!this.originalEvaluate)return;const o=this.originalEvaluate(r);return t(r,o)},this.createdInterpolant.evaluate=this.customEvaluate,this.createdInterpolant)}dispose(){this.createdInterpolant&&this.originalEvaluate&&(this.createdInterpolant.evaluate=this.originalEvaluate),this.track=void 0,this.createdInterpolant=null,this.originalEvaluate=void 0,this.customEvaluate=void 0}}const In=class{constructor(e,t,i,s,r){h(this,"_action");h(this,"root");h(this,"clip");h(this,"positionWrapper",null);h(this,"rotationWrapper",null);h(this,"context");h(this,"positionChange",new w);h(this,"rotationChange",new Se);h(this,"_prevTime",0);if(this.context=e,this.root=t,this.clip=i,In.firstKeyframeRotation[this.cacheId]||(In.firstKeyframeRotation[this.cacheId]=new Se),r){const o=r.values;In.firstKeyframeRotation[this.cacheId].set(o[0],o[1],o[2],o[3])}In.spaceRotation[this.cacheId]||(In.spaceRotation[this.cacheId]=new Se),In.effectiveSpaceRotation[this.cacheId]||(In.effectiveSpaceRotation[this.cacheId]=new Se),In.clipOffsetRotation[this.cacheId]=new Se,r&&In.clipOffsetRotation[this.cacheId].set(r.values[0],r.values[1],r.values[2],r.values[3]).invert(),this.handlePosition(i,s),this.handleRotation(i,r)}set action(e){this._action=e}get action(){return this._action}get cacheId(){return this.root.uuid}onStart(e){if(e.getClip()!==this.clip)return;In.lastObjRotation[this.cacheId]||(In.lastObjRotation[this.cacheId]=this.root.quaternion.clone());const t=In.lastObjRotation[this.cacheId];if(In.spaceRotation[this.cacheId].copy(t),jv){const i=new pn().setFromQuaternion(t);console.log("START",this.clip.name,tt.toDegrees(i.y),this.root.position.z)}}getClipRotationOffset(){return In.clipOffsetRotation[this.cacheId]}handlePosition(e,t){if(t){const i=this.root;jv&&i.add(new Zf),In.lastObjPosition[this.cacheId]||(In.lastObjPosition[this.cacheId]=this.root.position.clone());const s=new w,r=new w;this.positionWrapper=new GB(t,(o,a)=>{const l=this.action.getEffectiveWeight();return jv&&i.position.length()>8&&i.position.set(0,i.position.y,0),o>this._prevTime&&(s.set(a[0],a[1],a[2]),s.sub(r),s.multiplyScalar(l),s.applyQuaternion(this.getClipRotationOffset()),s.applyQuaternion(i.quaternion),this.positionChange.copy(s)),r.fromArray(a),this._prevTime=o,a[0]=0,a[1]=0,a[2]=0,a})}}handleRotation(e,t){if(t){if(jv){const o=t.values,a=new pn().setFromQuaternion(new Se(o[0],o[1],o[2],o[3]));console.log(e.name,t.name,"FIRST ROTATION IN TRACK",tt.toDegrees(a.y));const l=t.values.length-4,c=new Se().set(o[l],o[l+1],o[l+2],o[l+3]),u=new pn().setFromQuaternion(c);console.log(e.name,t.name,"LAST ROTATION IN TRACK",tt.toDegrees(u.y))}let i=0;const s=new Se,r=new Se;this.rotationWrapper=new GB(t,(o,a)=>(o>i&&(r.set(a[0],a[1],a[2],a[3]),s.invert(),r.multiply(s),this.rotationChange.copy(r)),s.fromArray(a),i=o,a[0]=0,a[1]=0,a[2]=0,a[3]=1,a))}}onBeforeUpdate(e){this.positionChange.set(0,0,0),this.rotationChange.set(0,0,0,1)}onAfterUpdate(e){return!this.action||(e*=this.action.getEffectiveWeight(),e<=0)?!1:(this.positionChange.multiplyScalar(e),this.rotationChange.slerp(In.identityQuaternion,1-e),!0)}};let ca=In;h(ca,"lastObjPosition",{}),h(ca,"lastObjRotation",{}),h(ca,"firstKeyframeRotation",{}),h(ca,"spaceRotation",{}),h(ca,"effectiveSpaceRotation",{}),h(ca,"clipOffsetRotation",{}),h(ca,"identityQuaternion",new Se);class HY{constructor(e){h(this,"controller");h(this,"handler",[]);h(this,"root");h(this,"basePosition",new w);h(this,"baseQuaternion",new Se);h(this,"baseRotation",new pn);h(this,"summedPosition",new w);h(this,"summedRotation",new Se);this.controller=e}createClip(e,t,i){this.root=t,t&&"name"in t&&t.name;const s=this.findRootTrack(i,".position"),r=this.findRootTrack(i,".quaternion"),o=new ca(this.controller.context,t,i,s,r);this.handler.push(o);const a=e.clipAction(i);return o.action=a,a}onStart(e){for(const t of this.handler)t.onStart(e)}onBeforeUpdate(e){this.basePosition.copy(this.root.position),this.baseQuaternion.copy(this.root.quaternion);for(const t of this.handler)t.onBeforeUpdate(e)}onAfterUpdate(e){if(!(e<=0)){this.root.position.copy(this.basePosition),this.root.quaternion.copy(this.baseQuaternion),this.summedPosition.set(0,0,0),this.summedRotation.set(0,0,0,1);for(const t of this.handler)t.onAfterUpdate(e)&&(this.summedPosition.add(t.positionChange),this.summedRotation.multiply(t.rotationChange));this.root.position.add(this.summedPosition),this.root.quaternion.multiply(this.summedRotation)}}findRootTrack(e,t){const i=e.tracks;if(!i)return null;for(const s of i)if(s.name.endsWith(t))return s;return null}}const Vy=Symbol("objectIsAnimatedData");function VB(n,e,t){if(!n)return;if(n[Vy]===void 0){if(!t)return;n[Vy]=new Set}const i=n[Vy];t?i.add(e):i.has(e)&&i.delete(e)}function QY(n){if(!n)return!1;const e=n[Vy];return e!==void 0&&e.size>0}en.registerCallback(Qn.ContextCreated,n=>{const e=n.context.domElement.getAttribute("autoplay");if(e!==void 0&&(e===""||e==="true")&&n.files)for(const t of n.files)ne.foreachComponent(t.file.scene,s=>{if(s.enabled!==!1){if(s instanceof xo&&s.playAutomatically||s instanceof Xs||s instanceof Qc&&s.playOnAwake===!0)return!0;if(s instanceof xo)return s.playAutomatically=!0,!0;if(s instanceof Qc)return s.playOnAwake=!0,!0}},!0)!==!0&&WY(t.file)});function WY(n){if(!n||!n.animations)return;for(let t=0;t<n.animations.length;t++){const i=n.animations[t];if(!(!i.tracks||i.tracks.length<=0))for(const s in i.tracks){const r=i.tracks[s],o=r.__objectName??r.name.substring(0,r.name.indexOf("."));let a=n.scene.getObjectByName(o);if(!a&&(a=n.scene.getObjectByProperty("uuid",o),!a))continue;let l=e(a);l||(l=zu(n.scene,new xo));const c=l.animations=l.animations||[];i.name_animator=l.name,c.indexOf(i)<0&&c.push(i)}}function e(t){var s;if(!t)return;const i=(s=t.userData)==null?void 0:s.components;if(i&&i.length>0)for(let r=0;r<i.length;r++){const o=i[r];if(o instanceof Xs||o instanceof xo)return t}return e(t.parent)}}var v_=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const HB=re("debuganimator");class Xs extends Te{constructor(){super(...arguments);h(this,"applyRootMotion",!1);h(this,"hasRootMotion",!1);h(this,"keepAnimatorControllerStateOnDisable",!1);h(this,"_parametersAreDirty",!1);h(this,"_isDirty",!1);h(this,"speed",1);h(this,"normalizedStartOffset",0);h(this,"_animatorController",null);h(this,"_initializeWithRuntimeAnimatorController")}set runtimeAnimatorController(t){this._animatorController&&this._animatorController.model===t||(t?t instanceof Pu?this._animatorController=t:(HB&&console.log("Assign animator controller",t,this),this._animatorController=new Pu(t)):this._animatorController=null)}get runtimeAnimatorController(){return this._animatorController}get parametersAreDirty(){return this._parametersAreDirty}get isDirty(){return this._isDirty}Play(t,i=-1,s=Number.NEGATIVE_INFINITY,r=0){this.play(t,i,s,r)}play(t,i=-1,s=Number.NEGATIVE_INFINITY,r=0){var o;(o=this.runtimeAnimatorController)==null||o.play(t,i,s,r),this._isDirty=!0}Reset(){this.reset()}reset(){var t;(t=this._animatorController)==null||t.reset(),this._isDirty=!0}SetBool(t,i){this.setBool(t,i)}setBool(t,i){var s;(s=this.runtimeAnimatorController)==null||s.setBool(t,i),this._parametersAreDirty=!0}GetBool(t){return this.getBool(t)}getBool(t){var i;return((i=this.runtimeAnimatorController)==null?void 0:i.getBool(t))??!1}SetFloat(t,i){this.setFloat(t,i)}setFloat(t,i){var s;(s=this.runtimeAnimatorController)==null||s.setFloat(t,i),this._parametersAreDirty=!0}GetFloat(t){return this.getFloat(t)}getFloat(t){var i;return((i=this.runtimeAnimatorController)==null?void 0:i.getFloat(t))??-1}SetInteger(t,i){this.setInteger(t,i)}setInteger(t,i){var s;(s=this.runtimeAnimatorController)==null||s.setInteger(t,i),this._parametersAreDirty=!0}GetInteger(t){return this.getInteger(t)}getInteger(t){var i;return((i=this.runtimeAnimatorController)==null?void 0:i.getInteger(t))??-1}SetTrigger(t){this.setTrigger(t)}setTrigger(t){var i;(i=this.runtimeAnimatorController)==null||i.setTrigger(t),this._parametersAreDirty=!0}ResetTrigger(t){this.resetTrigger(t)}resetTrigger(t){var i;(i=this.runtimeAnimatorController)==null||i.resetTrigger(t),this._parametersAreDirty=!0}GetTrigger(t){this.getTrigger(t)}getTrigger(t){var i;(i=this.runtimeAnimatorController)==null||i.getTrigger(t)}IsInTransition(){return this.isInTransition()}isInTransition(){var t;return((t=this.runtimeAnimatorController)==null?void 0:t.isInTransition())??!1}SetSpeed(t){return this.setSpeed(t)}setSpeed(t){var i;t!==this.speed&&(this.speed=t,(i=this._animatorController)==null||i.setSpeed(t))}set minMaxSpeed(t){this.speed=tt.lerp(t.x,t.y,Math.random())}set minMaxOffsetNormalized(t){this.normalizedStartOffset=tt.lerp(t.x,t.y,Math.random()),this.runtimeAnimatorController&&(this.runtimeAnimatorController.normalizedStartOffset=this.normalizedStartOffset)}awake(){HB&&console.log("ANIMATOR",this.name,this),this.gameObject&&this.initializeRuntimeAnimatorController()}initializeRuntimeAnimatorController(t=!1){const i=t||this.runtimeAnimatorController!==this._initializeWithRuntimeAnimatorController;if(this.runtimeAnimatorController&&i){const s=this.runtimeAnimatorController.clone();this._initializeWithRuntimeAnimatorController=s,s?(console.assert(this.runtimeAnimatorController!==s),this.runtimeAnimatorController=s,console.assert(this.runtimeAnimatorController===s),this.runtimeAnimatorController.bind(this),this.runtimeAnimatorController.setSpeed(this.speed),this.runtimeAnimatorController.normalizedStartOffset=this.normalizedStartOffset):console.warn("Could not clone animator controller",this.runtimeAnimatorController)}}onDisable(){var t;this.keepAnimatorControllerStateOnDisable||(t=this._animatorController)==null||t.reset()}onBeforeRender(){this._isDirty=!1,this._parametersAreDirty=!1,!QY(this.gameObject)&&this._animatorController&&this._animatorController.update(1)}}v_([x()],Xs.prototype,"applyRootMotion",void 0);v_([x()],Xs.prototype,"hasRootMotion",void 0);v_([x()],Xs.prototype,"keepAnimatorControllerStateOnDisable",void 0);v_([x()],Xs.prototype,"runtimeAnimatorController",null);class jY extends dn{constructor(e,t=1,i=16,s=2){const r=new ft,o=i+s*2,a=new Float32Array((o*3+3)*3);r.setAttribute("position",new ot(a,3));const l=new Sn({color:65280}),c=new Sn({color:16776960});super(r,[c,l]),this.audio=e,this.range=t,this.divisionsInnerAngle=i,this.divisionsOuterAngle=s,this.type="PositionalAudioHelper",this.update()}update(){const e=this.audio,t=this.range,i=this.divisionsInnerAngle,s=this.divisionsOuterAngle,r=cs.degToRad(e.panner.coneInnerAngle),o=cs.degToRad(e.panner.coneOuterAngle),a=r/2,l=o/2;let c=0,u=0,d,f;const p=this.geometry,g=p.attributes.position;p.clearGroups();function A(v,m,b,y){const _=(m-v)/b;for(g.setXYZ(c,0,0,0),u++,d=v;d<m;d+=_)f=c+u,g.setXYZ(f,Math.sin(d)*t,0,Math.cos(d)*t),g.setXYZ(f+1,Math.sin(Math.min(d+_,m))*t,0,Math.cos(Math.min(d+_,m))*t),g.setXYZ(f+2,0,0,0),u+=3;p.addGroup(c,u,y),c+=u,u=0}A(-l,-a,s,0),A(-a,a,i,1),A(a,l,s,0),g.needsUpdate=!0,r===o&&(this.material[0].visible=!1)}dispose(){this.geometry.dispose(),this.material[0].dispose(),this.material[1].dispose()}}var Yl=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const Kn=re("debugaudio");var zg;(function(n){n[n.Logarithmic=0]="Logarithmic",n[n.Linear=1]="Linear",n[n.Custom=2]="Custom"})(zg||(zg={}));const Rn=class extends Te{constructor(){super(...arguments);h(this,"clip","");h(this,"playOnAwake",!1);h(this,"_spatialBlend",0);h(this,"_minDistance",1);h(this,"_maxDistance",100);h(this,"_volume",1);h(this,"rollOffMode",0);h(this,"playInBackground",!0);h(this,"_loop",!1);h(this,"sound",null);h(this,"helper",null);h(this,"wasPlaying",!1);h(this,"audioLoader",null);h(this,"shouldPlay",!1);h(this,"_lastClipStartedLoading",null);h(this,"_audioElement",null);h(this,"onVisibilityChanged",()=>{switch(document.visibilityState){case"hidden":(this.playInBackground===!1||ch())&&(this.wasPlaying=this.isPlaying,this.isPlaying&&this.pause());break;case"visible":Kn&&console.log("visible",this.enabled,this.playOnAwake,!this.isPlaying,Rn._userInteractionRegistered,this.wasPlaying),this.enabled&&this.playOnAwake&&!this.isPlaying&&Rn._userInteractionRegistered&&this.wasPlaying&&this.play();break}});h(this,"onApplicationMuteChanged",()=>{var t,i;this.context.application.muted?(t=this.sound)==null||t.setVolume(0):(i=this.sound)==null||i.setVolume(this.volume)});h(this,"lerp",(t,i,s)=>t*(1-s)+i*s);h(this,"createAudio",t=>{Kn&&console.log("audio buffer loaded"),Rn.registerWaitForAllowAudio(()=>{Kn&&console.log("finished loading",t);const i=this.Sound;if(!i){console.warn("Failed getting sound",this.name);return}i.isPlaying&&i.stop(),t&&i.setBuffer(t),i.loop=this._loop,this.context.application.muted?i.setVolume(0):i.setVolume(this.volume),i.autoplay=this.shouldPlay,this.applySpatialDistanceSettings(),i.isPlaying&&i.stop(),Kn&&console.log(this.name,this.shouldPlay,Rn.userInteractionRegistered,this),this.shouldPlay&&Rn._userInteractionRegistered&&this.play()})});h(this,"_lastContextTime",0);h(this,"_hasEnded",!0);h(this,"_needUpdateSpatialDistanceSettings",!1)}static get userInteractionRegistered(){return Rn._didCallBeginWaitForUserInteraction||(Rn._didCallBeginWaitForUserInteraction=!0,Rn._beginWaitForUserInteraction()),Rn._userInteractionRegistered}static registerWaitForAllowAudio(t){if(t!==null){if(this._userInteractionRegistered){t();return}this.callbacks.indexOf(t)===-1&&this.callbacks.push(t),Rn._didCallBeginWaitForUserInteraction||(Rn._didCallBeginWaitForUserInteraction=!0,Rn._beginWaitForUserInteraction())}}static _beginWaitForUserInteraction(t=null){if(this._userInteractionRegistered){t&&t();return}t!==null&&this.registerWaitForAllowAudio(t);const s=(()=>{if(s!=null&&!Rn._userInteractionRegistered){Rn._userInteractionRegistered=!0,Kn&&console.log(" registered interaction, can play audio now"),document.removeEventListener("pointerdown",s),document.removeEventListener("click",s),document.removeEventListener("dragstart",s),document.removeEventListener("touchstart",s);for(const r of this.callbacks)r();this.callbacks.length=0}}).bind(this);document.addEventListener("pointerdown",s),document.addEventListener("click",s),document.addEventListener("dragstart",s),document.addEventListener("touchstart",s)}get loop(){return this.sound&&(this._loop=this.sound.getLoop()),this._loop}set loop(t){this._loop=t,this.sound&&this.sound.setLoop(t)}get spatialBlend(){return this._spatialBlend}set spatialBlend(t){t!==this._spatialBlend&&(this._spatialBlend=t,this._needUpdateSpatialDistanceSettings=!0)}get minDistance(){return this._minDistance}set minDistance(t){this._minDistance!==t&&(this._minDistance=t,this._needUpdateSpatialDistanceSettings=!0)}get maxDistance(){return this._maxDistance}set maxDistance(t){this._maxDistance!==t&&(this._maxDistance=t,this._needUpdateSpatialDistanceSettings=!0)}get volume(){return this._volume}set volume(t){this._volume=t,this.sound&&!this.context.application.muted&&(Kn&&console.log(this.name,"audio set volume",t),this.sound.setVolume(t))}get Sound(){if(!this.sound&&Rn._userInteractionRegistered){let t=ne.getComponent(this.context.mainCamera,Af)??ne.findObjectOfType(Af,this.context);!t&&this.context.mainCamera&&(t=ne.addNewComponent(this.context.mainCamera,Af)),t!=null&&t.listener?(this.sound=new fL(t.listener),this.gameObject.add(this.sound)):Kn&&console.warn("No audio listener found in scene - can not play audio")}return this.sound}get ShouldPlay(){return this.shouldPlay}awake(){this.audioLoader=new o0,this.playOnAwake&&(this.shouldPlay=!0)}onEnable(){Rn._userInteractionRegistered?this.playOnAwake&&this.context.application.isVisible&&this.play():Rn._beginWaitForUserInteraction(()=>{this.enabled&&!this.destroyed&&this.shouldPlay&&this.onNewClip(this.clip)}),globalThis.addEventListener("visibilitychange",this.onVisibilityChanged),this.context.application.addEventListener(Au.MuteChanged,this.onApplicationMuteChanged)}onDisable(){globalThis.removeEventListener("visibilitychange",this.onVisibilityChanged),this.context.application.removeEventListener(Au.MuteChanged,this.onApplicationMuteChanged),this.pause()}applySpatialDistanceSettings(){const t=this.sound;if(!t)return;this._needUpdateSpatialDistanceSettings=!1;const i=this.lerp(10*this._maxDistance/Math.max(1e-4,this.spatialBlend),this._minDistance,this.spatialBlend);switch(Kn&&console.log(this.name,this._minDistance,this._maxDistance,this.spatialBlend,"Ref distance="+i),t.setRefDistance(i),t.setMaxDistance(Math.max(.01,this._maxDistance)),this.rollOffMode){case zg.Logarithmic:t.setDistanceModel("exponential");break;case zg.Linear:t.setDistanceModel("linear");break;case zg.Custom:break}this.spatialBlend>0?Kn&&!this.helper&&(this.helper=new jY(t,t.getRefDistance()),t.add(this.helper)):this.helper&&this.helper.parent&&this.helper.removeFromParent()}onNewClip(t){if(t&&(this.clip=t),typeof t=="string")if(Kn&&console.log(t),t.endsWith(".mp3")||t.endsWith(".wav")){if(this.audioLoader||(this.audioLoader=new o0),this.shouldPlay=!0,this._lastClipStartedLoading===t){Kn&&console.log("Is currently loading:",this._lastClipStartedLoading,this);return}this._lastClipStartedLoading=t,Kn&&console.log("load audio",t),this.audioLoader.load(t,this.createAudio,()=>{},console.error)}else console.warn("Unsupported audio clip type",t);else this.shouldPlay=!0,this.createAudio()}play(t=void 0){var s,r;t!==void 0&&typeof t!="string"&&!(t instanceof MediaStream)&&(console.warn("Called play on AudioSource with unknown argument type",t),t=void 0);let i=!this.sound||t&&t!==this.clip;if(typeof t=="string"&&!this.audioLoader&&(i=!0),(t instanceof MediaStream||typeof t=="string")&&(this.clip=t),i){this.shouldPlay=!0,this.onNewClip(t);return}if(this.shouldPlay=!0,this._hasEnded=!1,Kn&&console.log("play",(s=this.sound)==null?void 0:s.getVolume(),this.sound),this.sound&&!this.sound.isPlaying){const o=this.context.application.muted;o&&this.sound.setVolume(0),this.clip instanceof MediaStream?(this.sound.setMediaStreamSource(this.clip),this._audioElement||(this._audioElement=document.createElement("audio"),this._audioElement.style.display="none"),this._audioElement.parentNode||(r=this.context.domElement.shadowRoot)==null||r.append(this._audioElement),this._audioElement.srcObject=this.clip,this._audioElement.autoplay=!1):(this._audioElement&&this._audioElement.remove(),this.sound.play(o?.1:0))}}pause(){var t,i;Kn&&console.log("Pause",this),this._hasEnded=!0,this.shouldPlay=!1,this.sound&&this.sound.isPlaying&&this.sound.source&&(this._lastContextTime=(t=this.sound)==null?void 0:t.context.currentTime,this.sound.pause()),(i=this._audioElement)==null||i.remove()}stop(){var t,i;Kn&&console.log("Pause",this),this._hasEnded=!0,this.shouldPlay=!1,this.sound&&this.sound.source&&(this._lastContextTime=(t=this.sound)==null?void 0:t.context.currentTime,Kn&&console.log(this._lastContextTime),this.sound.stop()),(i=this._audioElement)==null||i.remove()}get isPlaying(){var t;return((t=this.sound)==null?void 0:t.isPlaying)??!1}set isPlaying(t){}get time(){var t,i;return(t=this.sound)!=null&&t.source?((i=this.sound.source)==null?void 0:i.context.currentTime)-this._lastContextTime+this.sound.offset:0}set time(t){if(this.sound){if(t===this.sound.offset)return;const i=this.isPlaying;this.stop(),this.sound.offset=t,i&&this.play()}}update(){this.helper&&(this.isPlaying&&this.helper.update(),this.helper.visible=this.isPlaying),this._needUpdateSpatialDistanceSettings&&this.applySpatialDistanceSettings(),this.sound&&!this.sound.isPlaying&&this.shouldPlay&&!this._hasEnded&&(this._hasEnded=!0,Kn&&console.log("Audio clip ended",this.clip),this.sound.dispatchEvent({type:"ended",target:this}))}};let Ni=Rn;h(Ni,"_didCallBeginWaitForUserInteraction",!1),h(Ni,"callbacks",[]),h(Ni,"_userInteractionRegistered",!1);Yl([x(URL)],Ni.prototype,"clip",void 0);Yl([x()],Ni.prototype,"playOnAwake",void 0);Yl([x()],Ni.prototype,"loop",null);Yl([x()],Ni.prototype,"spatialBlend",null);Yl([x()],Ni.prototype,"minDistance",null);Yl([x()],Ni.prototype,"maxDistance",null);Yl([x()],Ni.prototype,"volume",null);Yl([x()],Ni.prototype,"rollOffMode",void 0);Yl([x()],Ni.prototype,"playInBackground",void 0);var qY=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};class y_ extends Te{constructor(){super(...arguments);h(this,"constraintActive",!0);h(this,"locked",!1);h(this,"sources",[])}}qY([x(Me)],y_.prototype,"sources",void 0);const QB={type:"change"},Vw={type:"start"},WB={type:"end"};let XY=class extends Fn{constructor(e,t){super(),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new w,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:Uh.ROTATE,MIDDLE:Uh.DOLLY,RIGHT:Uh.PAN},this.touches={ONE:Nh.ROTATE,TWO:Nh.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return a.phi},this.getAzimuthalAngle=function(){return a.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(X){X.addEventListener("keydown",wt),this._domElementKeyEvents=X},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",wt),this._domElementKeyEvents=null},this.saveState=function(){i.target0.copy(i.target),i.position0.copy(i.object.position),i.zoom0=i.object.zoom},this.reset=function(){i.target.copy(i.target0),i.object.position.copy(i.position0),i.object.zoom=i.zoom0,i.object.updateProjectionMatrix(),i.dispatchEvent(QB),i.update(),r=s.NONE},this.update=function(){const X=new w,de=new Se().setFromUnitVectors(e.up,new w(0,1,0)),le=de.clone().invert(),Qe=new w,je=new Se,Ge=new w,Oe=2*Math.PI;return function(){const gt=i.object.getWorldPosition(e.position);X.copy(gt).sub(i.target),X.applyQuaternion(de),a.setFromVector3(X),i.autoRotate&&r===s.NONE&&T(R()),i.enableDamping?(a.theta+=l.theta*i.dampingFactor,a.phi+=l.phi*i.dampingFactor):(a.theta+=l.theta,a.phi+=l.phi);let yt=i.minAzimuthAngle,Z=i.maxAzimuthAngle;return isFinite(yt)&&isFinite(Z)&&(yt<-Math.PI?yt+=Oe:yt>Math.PI&&(yt-=Oe),Z<-Math.PI?Z+=Oe:Z>Math.PI&&(Z-=Oe),yt<=Z?a.theta=Math.max(yt,Math.min(Z,a.theta)):a.theta=a.theta>(yt+Z)/2?Math.max(yt,a.theta):Math.min(Z,a.theta)),a.phi=Math.max(i.minPolarAngle,Math.min(i.maxPolarAngle,a.phi)),a.makeSafe(),i.enableDamping?u=cs.lerp(u,c,i.dampingFactor):u=c,a.radius*=u,a.radius=Math.max(i.minDistance,Math.min(i.maxDistance,a.radius)),i.enableDamping===!0?i.target.addScaledVector(d,i.dampingFactor):i.target.add(d),X.setFromSpherical(a),X.applyQuaternion(le),gt.copy(i.target).add(X),i.object.parent?i.object.parent.worldToLocal(gt):i.object.position.copy(gt),i.object.lookAt(i.target),i.enableDamping===!0?(l.theta*=1-i.dampingFactor,l.phi*=1-i.dampingFactor,d.multiplyScalar(1-i.dampingFactor)):(l.set(0,0,0),d.set(0,0,0)),c=1,f||Qe.distanceToSquared(i.object.position)>o||8*(1-je.dot(i.object.quaternion))>o||Ge.distanceToSquared(i.target)>0?(i.dispatchEvent(QB),Qe.copy(i.object.position),je.copy(i.object.quaternion),Ge.copy(i.target),f=!1,!0):!1}}(),this.dispose=function(){i.domElement.removeEventListener("contextmenu",k),i.domElement.removeEventListener("pointerdown",ke),i.domElement.removeEventListener("pointercancel",Ze),i.domElement.removeEventListener("wheel",pt),i.domElement.removeEventListener("pointermove",we),i.domElement.removeEventListener("pointerup",Ze),i._domElementKeyEvents!==null&&(i._domElementKeyEvents.removeEventListener("keydown",wt),i._domElementKeyEvents=null)};const i=this,s={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let r=s.NONE;const o=1e-6,a=new oC,l=new oC;let c=1,u=1;const d=new w;let f=!1;const p=new te,g=new te,A=new te,v=new te,m=new te,b=new te,y=new te,_=new te,E=new te,M=[],I={};function R(){return 2*Math.PI/60/60*i.autoRotateSpeed}function C(){return Math.pow(.95,i.zoomSpeed)}function T(X){l.theta-=X}function O(X){l.phi-=X}const J=function(){const X=new w;return function(le,Qe){X.setFromMatrixColumn(Qe,0),X.multiplyScalar(-le),d.add(X)}}(),V=function(){const X=new w;return function(le,Qe){i.screenSpacePanning===!0?X.setFromMatrixColumn(Qe,1):(X.setFromMatrixColumn(Qe,0),X.crossVectors(i.object.up,X)),X.multiplyScalar(le),d.add(X)}}(),H=function(){const X=new w,de=new w;return function(Qe,je){const Ge=i.domElement;if(i.object.isPerspectiveCamera){i.object.getWorldPosition(de),X.copy(de).sub(i.target);let Oe=X.length();Oe*=Math.tan(i.object.fov/2*Math.PI/180),J(2*Qe*Oe/Ge.clientHeight,i.object.matrixWorld),V(2*je*Oe/Ge.clientHeight,i.object.matrixWorld)}else i.object.isOrthographicCamera?(J(Qe*(i.object.right-i.object.left)/i.object.zoom/Ge.clientWidth,i.object.matrixWorld),V(je*(i.object.top-i.object.bottom)/i.object.zoom/Ge.clientHeight,i.object.matrixWorld)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),i.enablePan=!1)}}();function Y(X){i.object.isPerspectiveCamera?c/=X:i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom*X)),i.object.updateProjectionMatrix(),f=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function N(X){i.object.isPerspectiveCamera?c*=X:i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/X)),i.object.updateProjectionMatrix(),f=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function L(X){p.set(X.clientX,X.clientY)}function G(X){y.set(X.clientX,X.clientY)}function ee(X){v.set(X.clientX,X.clientY)}function $(X){g.set(X.clientX,X.clientY),A.subVectors(g,p).multiplyScalar(i.rotateSpeed);const de=i.domElement;T(2*Math.PI*A.x/de.clientHeight),O(2*Math.PI*A.y/de.clientHeight),p.copy(g),i.update()}function j(X){_.set(X.clientX,X.clientY),E.subVectors(_,y),E.y>0?Y(C()):E.y<0&&N(C()),y.copy(_),i.update()}function ie(X){m.set(X.clientX,X.clientY),b.subVectors(m,v).multiplyScalar(i.panSpeed),H(b.x,b.y),v.copy(m),i.update()}function Ae(X){X.deltaY<0?N(C()):X.deltaY>0&&Y(C()),i.update()}function ge(X){let de=!1;switch(X.code){case i.keys.UP:X.ctrlKey||X.metaKey||X.shiftKey?O(2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):H(0,i.keyPanSpeed),de=!0;break;case i.keys.BOTTOM:X.ctrlKey||X.metaKey||X.shiftKey?O(-2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):H(0,-i.keyPanSpeed),de=!0;break;case i.keys.LEFT:X.ctrlKey||X.metaKey||X.shiftKey?T(2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):H(i.keyPanSpeed,0),de=!0;break;case i.keys.RIGHT:X.ctrlKey||X.metaKey||X.shiftKey?T(-2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):H(-i.keyPanSpeed,0),de=!0;break}de&&(X.preventDefault(),i.update())}function Ce(){if(M.length===1)p.set(M[0].pageX,M[0].pageY);else{const X=.5*(M[0].pageX+M[1].pageX),de=.5*(M[0].pageY+M[1].pageY);p.set(X,de)}}function Ee(){if(M.length===1)v.set(M[0].pageX,M[0].pageY);else{const X=.5*(M[0].pageX+M[1].pageX),de=.5*(M[0].pageY+M[1].pageY);v.set(X,de)}}function Ne(){const X=M[0].pageX-M[1].pageX,de=M[0].pageY-M[1].pageY,le=Math.sqrt(X*X+de*de);y.set(0,le)}function Ve(){i.enableZoom&&Ne(),i.enablePan&&Ee()}function lt(){i.enableZoom&&Ne(),i.enableRotate&&Ce()}function xt(X){if(M.length==1)g.set(X.pageX,X.pageY);else{const le=Fe(X),Qe=.5*(X.pageX+le.x),je=.5*(X.pageY+le.y);g.set(Qe,je)}A.subVectors(g,p).multiplyScalar(i.rotateSpeed);const de=i.domElement;T(2*Math.PI*A.x/de.clientHeight),O(2*Math.PI*A.y/de.clientHeight),p.copy(g)}function et(X){if(M.length===1)m.set(X.pageX,X.pageY);else{const de=Fe(X),le=.5*(X.pageX+de.x),Qe=.5*(X.pageY+de.y);m.set(le,Qe)}b.subVectors(m,v).multiplyScalar(i.panSpeed),H(b.x,b.y),v.copy(m)}function W(X){const de=Fe(X),le=X.pageX-de.x,Qe=X.pageY-de.y,je=Math.sqrt(le*le+Qe*Qe);_.set(0,je),E.set(0,Math.pow(_.y/y.y,i.zoomSpeed)),Y(E.y),y.copy(_)}function Le(X){i.enableZoom&&W(X),i.enablePan&&et(X)}function me(X){i.enableZoom&&W(X),i.enableRotate&&xt(X)}function ke(X){i.enabled!==!1&&(M.length===0&&(i.domElement.addEventListener("pointermove",we),i.domElement.addEventListener("pointerup",Ze)),he(X),X.pointerType==="touch"?Qt(X):We(X))}function we(X){i.enabled!==!1&&(X.pointerType==="touch"?z(X):qe(X))}function Ze(X){Re(X),M.length===0&&(i.domElement.removeEventListener("pointermove",we),i.domElement.removeEventListener("pointerup",Ze)),i.dispatchEvent(WB),r=s.NONE}function We(X){let de;switch(X.button){case 0:de=i.mouseButtons.LEFT;break;case 1:de=i.mouseButtons.MIDDLE;break;case 2:de=i.mouseButtons.RIGHT;break;default:de=-1}switch(de){case Uh.DOLLY:if(i.enableZoom===!1)return;G(X),r=s.DOLLY;break;case Uh.ROTATE:if(X.ctrlKey||X.metaKey||X.shiftKey){if(i.enablePan===!1)return;ee(X),r=s.PAN}else{if(i.enableRotate===!1)return;L(X),r=s.ROTATE}break;case Uh.PAN:if(X.ctrlKey||X.metaKey||X.shiftKey){if(i.enableRotate===!1)return;L(X),r=s.ROTATE}else{if(i.enablePan===!1)return;ee(X),r=s.PAN}break;default:r=s.NONE}r!==s.NONE&&i.dispatchEvent(Vw)}function qe(X){switch(r){case s.ROTATE:if(i.enableRotate===!1)return;$(X);break;case s.DOLLY:if(i.enableZoom===!1)return;j(X);break;case s.PAN:if(i.enablePan===!1)return;ie(X);break}}function pt(X){i.enabled===!1||i.enableZoom===!1||r!==s.NONE||(X.preventDefault(),i.dispatchEvent(Vw),Ae(X),i.dispatchEvent(WB))}function wt(X){i.enabled===!1||i.enablePan===!1||ge(X)}function Qt(X){switch(Pe(X),M.length){case 1:switch(i.touches.ONE){case Nh.ROTATE:if(i.enableRotate===!1)return;Ce(),r=s.TOUCH_ROTATE;break;case Nh.PAN:if(i.enablePan===!1)return;Ee(),r=s.TOUCH_PAN;break;default:r=s.NONE}break;case 2:switch(i.touches.TWO){case Nh.DOLLY_PAN:if(i.enableZoom===!1&&i.enablePan===!1)return;Ve(),r=s.TOUCH_DOLLY_PAN;break;case Nh.DOLLY_ROTATE:if(i.enableZoom===!1&&i.enableRotate===!1)return;lt(),r=s.TOUCH_DOLLY_ROTATE;break;default:r=s.NONE}break;default:r=s.NONE}r!==s.NONE&&i.dispatchEvent(Vw)}function z(X){switch(Pe(X),r){case s.TOUCH_ROTATE:if(i.enableRotate===!1)return;xt(X),i.update();break;case s.TOUCH_PAN:if(i.enablePan===!1)return;et(X),i.update();break;case s.TOUCH_DOLLY_PAN:if(i.enableZoom===!1&&i.enablePan===!1)return;Le(X),i.update();break;case s.TOUCH_DOLLY_ROTATE:if(i.enableZoom===!1&&i.enableRotate===!1)return;me(X),i.update();break;default:r=s.NONE}}function k(X){i.enabled!==!1&&X.preventDefault()}function he(X){M.push(X)}function Re(X){delete I[X.pointerId];for(let de=0;de<M.length;de++)if(M[de].pointerId==X.pointerId){M.splice(de,1);return}}function Pe(X){let de=I[X.pointerId];de===void 0&&(de=new te,I[X.pointerId]=de),de.set(X.pageX,X.pageY)}function Fe(X){const de=X.pointerId===M[0].pointerId?M[1]:M[0];return I[de.pointerId]}i.domElement.addEventListener("contextmenu",k),i.domElement.addEventListener("pointerdown",ke),i.domElement.addEventListener("pointercancel",Ze),i.domElement.addEventListener("wheel",pt,{passive:!1}),this.update()}};const YY="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles/generic-hand/";class JY{constructor(e,t,i,s,r=null){this.controller=t,this.handModel=e,this.bones=[],r===null&&(r=new sp,r.setPath(i||YY)),r.load(`${s}.glb`,o=>{const a=o.scene.children[0];this.handModel.add(a),a.layers.mask=this.handModel.layers.mask;const l=a.getObjectByProperty("type","SkinnedMesh");l.frustumCulled=!1,l.castShadow=!0,l.receiveShadow=!0,["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"].forEach(u=>{const d=a.getObjectByName(u);d!==void 0?d.jointName=u:console.warn(`Couldn't find ${u} in ${s} hand mesh`),this.bones.push(d)})})}updateMesh(){const e=this.controller.joints;for(let t=0;t<this.bones.length;t++){const i=this.bones[t];if(i){const s=e[i.jointName];if(s.visible){const r=s.position;i.position.copy(r),i.quaternion.copy(s.quaternion)}}}}}const KY=.01,ZY="index-finger-tip";class $Y extends Me{constructor(e,t=null){super(),this.controller=e,this.motionController=null,this.envMap=null,this.loader=t,this.mesh=null,e.addEventListener("connected",i=>{const s=i.data;s.hand&&!this.motionController&&(this.xrInputSource=s,this.motionController=new JY(this,e,this.path,s.handedness,this.loader))}),e.addEventListener("disconnected",()=>{this.clear(),this.motionController=null})}updateMatrixWorld(e){super.updateMatrixWorld(e),this.motionController&&this.motionController.updateMesh()}getPointerPosition(){const e=this.controller.joints[ZY];return e?e.position:null}intersectBoxObject(e){const t=this.getPointerPosition();if(t){const i=new Ys(t,KY),s=new Bn().setFromObject(e);return i.intersectsBox(s)}else return!1}checkButton(e){this.intersectBoxObject(e)?e.onPress():e.onClear(),e.isPressed()&&e.whilePressed()}}const e7=.05,jB=.02,qv=.01,qB=.02,XB=1,Id=.4,t7=.002,Jp=.01,Xv=.003,YB=.035,_i=16,Zr=12,Hw=110,i7=new w(0,1,0),n7=new w(0,0,1),s7=.02,r7=1.5;class o7 extends Me{constructor(e,t){super(),this.hand=e,this.controller=t,this.motionController=null,this.envMap=null,this.mesh=null,this.pointerGeometry=null,this.pointerMesh=null,this.pointerObject=null,this.pinched=!1,this.attached=!1,this.cursorObject=null,this.raycaster=null,this._onConnected=this._onConnected.bind(this),this._onDisconnected=this._onDisconnected.bind(this),this.hand.addEventListener("connected",this._onConnected),this.hand.addEventListener("disconnected",this._onDisconnected)}_onConnected(e){const t=e.data;t.hand&&(this.visible=!0,this.xrInputSource=t,this.createPointer())}_onDisconnected(){this.visible=!1,this.xrInputSource=null,this.pointerGeometry&&this.pointerGeometry.dispose(),this.pointerMesh&&this.pointerMesh.material&&this.pointerMesh.material.dispose(),this.clear()}_drawVerticesRing(e,t,i){const s=t.clone();for(let r=0;r<_i;r++){s.applyAxisAngle(n7,Math.PI*2/_i);const o=i*_i+r;e[3*o]=s.x,e[3*o+1]=s.y,e[3*o+2]=s.z}}_updatePointerVertices(e){const t=this.pointerGeometry.attributes.position.array,i=new w(t7,0,-1*(YB-e));this._drawVerticesRing(t,i,0);const s=new w(Math.sin(Math.PI*Hw/180)*e,Math.cos(Math.PI*Hw/180)*e,0);for(let c=0;c<Zr;c++)this._drawVerticesRing(t,s,c+1),s.applyAxisAngle(i7,Math.PI*Hw/180/(Zr*-2));const r=_i*(1+Zr),o=_i*(1+Zr)+1,a=new w(0,0,-1*(YB-e));t[r*3]=a.x,t[r*3+1]=a.y,t[r*3+2]=a.z;const l=new w(0,0,e);t[o*3]=l.x,t[o*3+1]=l.y,t[o*3+2]=l.z,this.pointerGeometry.setAttribute("position",new st(t,3))}createPointer(){let e,t;const i=new Array(((Zr+1)*_i+2)*3).fill(0),s=[];for(this.pointerGeometry=new ft,this.pointerGeometry.setAttribute("position",new st(i,3)),this._updatePointerVertices(Jp),e=0;e<Zr;e++){for(t=0;t<_i-1;t++)s.push(e*_i+t,e*_i+t+1,(e+1)*_i+t),s.push(e*_i+t+1,(e+1)*_i+t+1,(e+1)*_i+t);s.push((e+1)*_i-1,e*_i,(e+2)*_i-1),s.push(e*_i,(e+1)*_i,(e+2)*_i-1)}const r=_i*(1+Zr),o=_i*(1+Zr)+1;for(e=0;e<_i-1;e++)s.push(r,e+1,e),s.push(o,e+_i*Zr,e+_i*Zr+1);s.push(r,0,_i-1),s.push(o,_i*(Zr+1)-1,_i*Zr);const a=new ai;a.transparent=!0,a.opacity=Id,this.pointerGeometry.setIndex(s),this.pointerMesh=new ye(this.pointerGeometry,a),this.pointerMesh.position.set(0,0,-1*Jp),this.pointerObject=new Me,this.pointerObject.add(this.pointerMesh),this.raycaster=new Uu;const l=new So(s7,10,10),c=new ai;c.transparent=!0,c.opacity=Id,this.cursorObject=new ye(l,c),this.pointerObject.add(this.cursorObject),this.add(this.pointerObject),this.pointerObject.layers.mask=this.layers.mask,this.pointerMesh.layers.mask=this.layers.mask}_updateRaycaster(){if(this.raycaster){const e=this.pointerObject.matrixWorld,t=new Ie;t.identity().extractRotation(e),this.raycaster.ray.origin.setFromMatrixPosition(e),this.raycaster.ray.direction.set(0,0,-1).applyMatrix4(t)}}_updatePointer(){this.pointerObject.visible=this.controller.visible;const e=this.hand.joints["index-finger-tip"],t=this.hand.joints["thumb-tip"],i=e.position.distanceTo(t.position),s=e.position.clone().add(t.position).multiplyScalar(.5);this.pointerObject.position.copy(s),this.pointerObject.quaternion.copy(this.controller.quaternion),this.pinched=i<=jB;const r=(i-qv)/(e7-qv),o=(i-qv)/(jB-qv);if(r>1)this._updatePointerVertices(Jp),this.pointerMesh.position.set(0,0,-1*Jp),this.pointerMesh.material.opacity=Id;else if(r>0){const a=(Jp-Xv)*r+Xv;this._updatePointerVertices(a),o<1?(this.pointerMesh.position.set(0,0,-1*a-(1-o)*qB),this.pointerMesh.material.opacity=Id+(1-o)*(XB-Id)):(this.pointerMesh.position.set(0,0,-1*a),this.pointerMesh.material.opacity=Id)}else this._updatePointerVertices(Xv),this.pointerMesh.position.set(0,0,-1*Xv-qB),this.pointerMesh.material.opacity=XB;this.cursorObject.material.opacity=this.pointerMesh.material.opacity}updateMatrixWorld(e){super.updateMatrixWorld(e),this.pointerGeometry&&(this._updatePointer(),this._updateRaycaster())}isPinched(){return this.pinched}setAttached(e){this.attached=e}isAttached(){return this.attached}intersectObject(e,t=!0){if(this.raycaster)return this.raycaster.intersectObject(e,t)}intersectObjects(e,t=!0){if(this.raycaster)return this.raycaster.intersectObjects(e,t)}checkIntersections(e,t=!1){if(this.raycaster&&!this.attached){const i=this.raycaster.intersectObjects(e,t),s=new w(0,0,-1);if(i.length>0){const o=i[0].distance;this.cursorObject.position.copy(s.multiplyScalar(o))}else this.cursorObject.position.copy(s.multiplyScalar(r7))}}setCursor(e){const t=new w(0,0,-1);this.raycaster&&!this.attached&&this.cursorObject.position.copy(t.multiplyScalar(e))}dispose(){this._onDisconnected(),this.hand.removeEventListener("connected",this._onConnected),this.hand.removeEventListener("disconnected",this._onDisconnected)}}const Zi={Handedness:Object.freeze({NONE:"none",LEFT:"left",RIGHT:"right"}),ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})};async function lU(n){const e=await fetch(n);if(e.ok)return e.json();throw new Error(e.statusText)}async function a7(n){if(!n)throw new Error("No basePath supplied");return await lU(`${n}/profilesList.json`)}async function l7(n,e,t=null,i=!0){if(!n)throw new Error("No xrInputSource supplied");if(!e)throw new Error("No basePath supplied");const s=await a7(e);let r;if(n.profiles.some(l=>{const c=s[l];return c&&(r={profileId:l,profilePath:`${e}/${c.path}`,deprecated:!!c.deprecated}),!!r}),!r){if(!t)throw new Error("No matching profile name found");const l=s[t];if(!l)throw new Error(`No matching profile name found and default profile "${t}" missing.`);r={profileId:t,profilePath:`${e}/${l.path}`,deprecated:!!l.deprecated}}const o=await lU(r.profilePath);let a;if(i){let l;if(n.handedness==="any"?l=o.layouts[Object.keys(o.layouts)[0]]:l=o.layouts[n.handedness],!l)throw new Error(`No matching handedness, ${n.handedness}, in profile ${r.profileId}`);l.assetPath&&(a=r.profilePath.replace("profile.json",l.assetPath))}return{profile:o,assetPath:a}}const c7={xAxis:0,yAxis:0,button:0,state:Zi.ComponentState.DEFAULT};function h7(n=0,e=0){let t=n,i=e;if(Math.sqrt(n*n+e*e)>1){const o=Math.atan2(e,n);t=Math.cos(o),i=Math.sin(o)}return{normalizedXAxis:t*.5+.5,normalizedYAxis:i*.5+.5}}class u7{constructor(e){this.componentProperty=e.componentProperty,this.states=e.states,this.valueNodeName=e.valueNodeName,this.valueNodeProperty=e.valueNodeProperty,this.valueNodeProperty===Zi.VisualResponseProperty.TRANSFORM&&(this.minNodeName=e.minNodeName,this.maxNodeName=e.maxNodeName),this.value=0,this.updateFromComponent(c7)}updateFromComponent({xAxis:e,yAxis:t,button:i,state:s}){const{normalizedXAxis:r,normalizedYAxis:o}=h7(e,t);switch(this.componentProperty){case Zi.ComponentProperty.X_AXIS:this.value=this.states.includes(s)?r:.5;break;case Zi.ComponentProperty.Y_AXIS:this.value=this.states.includes(s)?o:.5;break;case Zi.ComponentProperty.BUTTON:this.value=this.states.includes(s)?i:0;break;case Zi.ComponentProperty.STATE:this.valueNodeProperty===Zi.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(s):this.value=this.states.includes(s)?1:0;break;default:throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}}class d7{constructor(e,t){if(!e||!t||!t.visualResponses||!t.gamepadIndices||Object.keys(t.gamepadIndices).length===0)throw new Error("Invalid arguments supplied");this.id=e,this.type=t.type,this.rootNodeName=t.rootNodeName,this.touchPointNodeName=t.touchPointNodeName,this.visualResponses={},Object.keys(t.visualResponses).forEach(i=>{const s=new u7(t.visualResponses[i]);this.visualResponses[i]=s}),this.gamepadIndices=Object.assign({},t.gamepadIndices),this.values={state:Zi.ComponentState.DEFAULT,button:this.gamepadIndices.button!==void 0?0:void 0,xAxis:this.gamepadIndices.xAxis!==void 0?0:void 0,yAxis:this.gamepadIndices.yAxis!==void 0?0:void 0}}get data(){return{id:this.id,...this.values}}updateFromGamepad(e){if(this.values.state=Zi.ComponentState.DEFAULT,this.gamepadIndices.button!==void 0&&e.buttons.length>this.gamepadIndices.button){const t=e.buttons[this.gamepadIndices.button];this.values.button=t.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,t.pressed||this.values.button===1?this.values.state=Zi.ComponentState.PRESSED:(t.touched||this.values.button>Zi.ButtonTouchThreshold)&&(this.values.state=Zi.ComponentState.TOUCHED)}this.gamepadIndices.xAxis!==void 0&&e.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=e.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===Zi.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>Zi.AxisTouchThreshold&&(this.values.state=Zi.ComponentState.TOUCHED)),this.gamepadIndices.yAxis!==void 0&&e.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=e.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===Zi.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>Zi.AxisTouchThreshold&&(this.values.state=Zi.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach(t=>{t.updateFromComponent(this.values)})}}class f7{constructor(e,t,i){if(!e)throw new Error("No xrInputSource supplied");if(!t)throw new Error("No profile supplied");this.xrInputSource=e,this.assetUrl=i,this.id=t.profileId,this.layoutDescription=t.layouts[e.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach(s=>{const r=this.layoutDescription.components[s];this.components[s]=new d7(s,r)}),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){const e=[];return Object.values(this.components).forEach(t=>{e.push(t.data)}),e}updateFromGamepad(){Object.values(this.components).forEach(e=>{e.updateFromGamepad(this.xrInputSource.gamepad)})}}const p7="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",g7="generic-trigger";class m7 extends Me{constructor(){super(),this.motionController=null,this.envMap=null}setEnvironmentMap(e){return this.envMap==e?this:(this.envMap=e,this.traverse(t=>{t.isMesh&&(t.material.envMap=this.envMap,t.material.needsUpdate=!0)}),this)}updateMatrixWorld(e){super.updateMatrixWorld(e),this.motionController&&(this.motionController.updateFromGamepad(),Object.values(this.motionController.components).forEach(t=>{Object.values(t.visualResponses).forEach(i=>{const{valueNode:s,minNode:r,maxNode:o,value:a,valueNodeProperty:l}=i;s&&(l===Zi.VisualResponseProperty.VISIBILITY?s.visible=a:l===Zi.VisualResponseProperty.TRANSFORM&&(s.quaternion.slerpQuaternions(r.quaternion,o.quaternion,a),s.position.lerpVectors(r.position,o.position,a)))})}))}}function A7(n,e){Object.values(n.components).forEach(t=>{const{type:i,touchPointNodeName:s,visualResponses:r}=t;if(i===Zi.ComponentType.TOUCHPAD)if(t.touchPointNode=e.getObjectByName(s),t.touchPointNode){const o=new So(.001),a=new ai({color:255}),l=new ye(o,a);t.touchPointNode.add(l)}else console.warn(`Could not find touch dot, ${t.touchPointNodeName}, in touchpad component ${t.id}`);Object.values(r).forEach(o=>{const{valueNodeName:a,minNodeName:l,maxNodeName:c,valueNodeProperty:u}=o;if(u===Zi.VisualResponseProperty.TRANSFORM){if(o.minNode=e.getObjectByName(l),o.maxNode=e.getObjectByName(c),!o.minNode){console.warn(`Could not find ${l} in the model`);return}if(!o.maxNode){console.warn(`Could not find ${c} in the model`);return}}o.valueNode=e.getObjectByName(a),o.valueNode||console.warn(`Could not find ${a} in the model`)})})}function JB(n,e){A7(n.motionController,e),n.envMap&&e.traverse(t=>{t.isMesh&&(t.material.envMap=n.envMap,t.material.needsUpdate=!0)}),n.layers.mask!=0&&e.traverse(t=>{t.layers.mask=n.layers.mask}),n.add(e)}class v7{constructor(e=null){this.gltfLoader=e,this.path=p7,this._assetCache={},this.gltfLoader||(this.gltfLoader=new sp)}createControllerModel(e){const t=new m7;let i=null;return e.addEventListener("connected",s=>{const r=s.data;r.targetRayMode!=="tracked-pointer"||!r.gamepad||l7(r,this.path,g7).then(({profile:o,assetPath:a})=>{t.motionController=new f7(r,o,a);const l=this._assetCache[t.motionController.assetUrl];if(l)i=l.scene.clone(),JB(t,i);else{if(!this.gltfLoader)throw new Error("GLTFLoader not set.");this.gltfLoader.setPath(""),this.gltfLoader.load(t.motionController.assetUrl,c=>{this._assetCache[t.motionController.assetUrl]=c,i=c.scene.clone(),JB(t,i)},null,()=>{throw new Error(`Asset ${t.motionController.assetUrl} missing or malformed.`)})}}).catch(o=>{console.warn(o)})}),e.addEventListener("disconnected",()=>{t.motionController=null,t.remove(i),i=null}),t}}const Kp=re("debugavatar");class xT{constructor(e,t,i,s){h(this,"root");h(this,"head");h(this,"leftHand");h(this,"rigthHand");var r;this.root=e,this.head=t,this.leftHand=i,this.rigthHand=s,(r=this.root)==null||r.traverse(o=>o.layers.set(2))}get isValid(){return this.head!==null&&this.head!==void 0}}class wT{constructor(){h(this,"avatarRegistryUrl",null)}async getOrCreateNewAvatarInstance(e,t){if(!t)return console.error("Can not create avatar: failed to provide id or root object"),null;let i=null;if(typeof t=="string"){if(i=await this.loadAvatar(e,t),!i){const r=new Hl;i=ne.instantiate(wm(t,e.scene),r)}}else i=t;if(!i)return null;const s=this.findAvatar(i);return s.isValid?(Kp&&console.log("[Custom Avatar] valid config",t,Kp?s:""),s):(console.warn("[Custom Avatar] config isn't valid",t,Kp?s:""),null)}async loadAvatar(e,t){if(console.assert(t!=null&&typeof t=="string","Avatar id must not be null"),t.length<=0||!t)return null;if(Kp&&console.log("[Custom Avatar] "+t+", loading..."),t.endsWith(".glb")||(t+=".glb"),this.avatarRegistryUrl===null){const s=await fetch("./"+t);let r=null;if(s.ok){const a=await s.blob();a&&(r=await a.arrayBuffer())}if(!r&&(r=await vF(t,t,0,"no url here go away",!0),!r))return null;const o=await Ga().parseSync(e,r,null,0);return(o==null?void 0:o.scene)??null}const i=new sp;return cA(i,e),new Promise((s,r)=>{const o=this.avatarRegistryUrl+"/"+t;i.load(o,async a=>{await Ga().createBuiltinComponents(e,o,a,null,void 0),s(a.scene)},a=>{Kp&&console.log("[Custom Avatar] "+a.loaded/a.total*100+"% loaded of "+a.total/1024+"kB")},a=>{console.error("[Custom Avatar] Error when loading: "+a),s(null)})})}cacheModel(e,t){}findAvatar(e){const t=e;let i=t;i.children.length==1&&(i=e.children[0]);let s=this.findAvatarPart(i,["head"]);const r=this.findAvatarPart(i,["left","hand"]),o=this.findAvatarPart(i,["right","hand"]);if(!s){s=t;const l=new w;new Bn().setFromObject(s).getSize(l);const c=Math.max(l.x,l.y,l.z);console.warn("[Custom Avatar] Normalizing head scale, it's too big: "+c+" meters! Should be < 0.3m"),c>.3&&s.scale.multiplyScalar(1/c*.3)}return new xT(t,s,r,o)}findAvatarPart(e,t){const i=e.name.toLowerCase();let s=!0;for(const r of t){if(!s)break;i.indexOf(r)===-1&&(s=!1)}if(s)return e;if(e.children)for(const r of e.children){const o=this.findAvatarPart(r,t);if(o)return o}return null}handleCustomAvatarErrors(e){if(!e.ok)throw Error(e.statusText);return e}}var y7=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const Nd=re("debugflags");var Wi;(function(n){n[n.Never=0]="Never",n[n.Browser=1]="Browser",n[n.AR=2]="AR",n[n.VR=4]="VR",n[n.FirstPerson=8]="FirstPerson",n[n.ThirdPerson=16]="ThirdPerson",n[n.All=4294967295]="All"})(Wi||(Wi={}));const sI=class{constructor(){h(this,"Mask",Wi.Browser|Wi.ThirdPerson)}Has(e){return(this.Mask&e)!==0}Set(e){Nd&&console.warn("Set XR flag state to",e),this.Mask=e,os.Apply()}Enable(e){this.Mask|=e,os.Apply()}Disable(e){this.Mask&=~e,os.Apply()}Toggle(e){this.Mask^=e,os.Apply()}EnableAll(){this.Mask=-1,os.Apply()}DisableAll(){this.Mask=0,os.Apply()}};let cr=sI;h(cr,"Global",new sI);const ma=class extends Te{constructor(){super(...arguments);h(this,"visibleIn")}static Apply(){for(const t of this.registry)t.UpdateVisible(cr.Global)}awake(){ma.registry.push(this)}onEnable(){ma.firstApply?this.UpdateVisible(cr.Global):(ma.firstApply=!0,ma.Apply())}onDestroy(){const t=ma.registry.indexOf(this);t>=0&&ma.registry.splice(t,1)}get isOn(){return this.gameObject.visible}UpdateVisible(t=null){let i;const s=t;s&&typeof s=="number"&&(console.assert(typeof s=="number","XRFlag.UpdateVisible: state must be a number",s),Nd&&console.log(s),ma.buffer.Mask=s,t=ma.buffer);const r=t;if(r?(Nd&&console.warn(this.name,"use passed in mask",r.Mask,this.visibleIn),i=r.Has(this.visibleIn)):(Nd&&console.log(this.name,"use global mask"),cr.Global.Has(this.visibleIn)),i!==void 0)if(i)Nd&&console.log(this.name,"is visible",this.gameObject.uuid),ne.setActive(this.gameObject,!0);else{if(Nd&&console.log(this.name,"is not visible",this.gameObject.uuid),!this.gameObject.visible)return;this.gameObject.visible=!1}}};let os=ma;h(os,"registry",[]),h(os,"firstApply"),h(os,"buffer",new cr);y7([x()],os.prototype,"visibleIn",void 0);const _c=re("debugavatar"),Fo=class extends Te{constructor(){super(...arguments);h(this,"connectionId");h(this,"avatar")}static getAvatar(t){return t>=0&&t<Fo.instances.length?Fo.instances[t]:null}static onAvatarMarkerCreated(t){return Fo._onNewAvatarMarkerAdded.push(t),t}static onAvatarMarkerDestroyed(t){return Fo._onAvatarMarkerDestroyed.push(t),t}awake(){Fo.instances.push(this),_c&&console.log(this);for(const t of Fo._onNewAvatarMarkerAdded)t({avatarMarker:this,gameObject:this.gameObject})}onDestroy(){Fo.instances.splice(Fo.instances.indexOf(this),1);for(const t of Fo._onAvatarMarkerDestroyed)t({avatarMarker:this,gameObject:this.gameObject})}isLocalAvatar(){return this.connectionId===this.context.connection.connectionId}setVisible(t){this.avatar&&("setVisible"in this.avatar?this.avatar.setVisible(t):ne.setActive(this.avatar,t))}};let as=Fo;h(as,"instances",[]),h(as,"_onNewAvatarMarkerAdded",[]),h(as,"_onAvatarMarkerDestroyed",[]);const om=class{constructor(e,t,i){h(this,"_isVisible",!0);h(this,"guid");h(this,"root",null);h(this,"head",null);h(this,"handLeft",null);h(this,"handRight",null);h(this,"lastUpdate",-1);h(this,"isLocalAvatar",!1);h(this,"flags",null);h(this,"headScale",new w(1,1,1));h(this,"handLeftScale",new w(1,1,1));h(this,"handRightScale",new w(1,1,1));h(this,"webxr");h(this,"lastAvatarId",null);h(this,"hasAvatarOverride",!1);h(this,"context");h(this,"avatarMarker",null);h(this,"_headTarget",new Me);h(this,"_handLeftTarget",new Me);h(this,"_handRightTarget",new Me);h(this,"_canInterpolate",!1);this.context=e,this.guid=t,this.webxr=i,this.setupCustomAvatar(this.webxr.defaultAvatar)}setVisible(e){this._isVisible=e,this.updateVisibility()}get isWebXRAvatar(){return!0}updateFlags(){if(!this.flags)return;let e=this.isLocalAvatar?Wi.FirstPerson:Wi.ThirdPerson;this.context.isInVR?e|=Wi.VR:this.context.isInAR?e|=Wi.AR:e|=Wi.Browser;for(const t of this.flags)t.gameObject.visible=!0,t.UpdateVisible(e)}async setAvatarOverride(e){return this.hasAvatarOverride=e!==null,this.hasAvatarOverride&&this.lastAvatarId!==e&&(this.lastAvatarId=e,e!=null&&e.length>0)?await this.setupCustomAvatar(e):null}tryUpdate(e,t){if(e.guid===this.guid&&(this.lastAvatarId!==e.avatarId&&e.avatarId&&e.avatarId.length>0&&(this.lastAvatarId=e.avatarId,this.setupCustomAvatar(e.avatarId)),this.lastUpdate=e.time,this.head)){const i=this.webxr.IsInAR?jo.Handheld:jo.Headset,s=this.head;this.context.players.setPlayerView(e.guid,s,i),Fr.markDirty(this.head),this._canInterpolate=!0;const r=this.isLocalAvatar?this.head:this._headTarget;if(r.position.set(e.position.x,e.position.y,e.position.z),r.quaternion.set(e.rotation.x,e.rotation.y,e.rotation.z,e.rotation.w),r.scale.set(e.scale,e.scale,e.scale),r.scale.multiply(this.headScale),this.handLeft){const o=this.isLocalAvatar?this.handLeft:this._handLeftTarget;o.position.set(e.posLeftHand.x,e.posLeftHand.y,e.posLeftHand.z),o.quaternion.set(e.rotLeftHand._x,e.rotLeftHand._y,e.rotLeftHand._z,e.rotLeftHand._w),o.quaternion.multiply(om.invertRotation),o.scale.set(e.scale,e.scale,e.scale),o.scale.multiply(this.handLeftScale),Fr.markDirty(this.handLeft)}if(this.handRight){const o=this.isLocalAvatar?this.handRight:this._handRightTarget;o.position.set(e.posRightHand.x,e.posRightHand.y,e.posRightHand.z),o.quaternion.set(e.rotRightHand._x,e.rotRightHand._y,e.rotRightHand._z,e.rotRightHand._w),o.quaternion.multiply(om.invertRotation),o.scale.set(e.scale,e.scale,e.scale),o.scale.multiply(this.handRightScale),Fr.markDirty(this.handRight)}}}update(){if(this.isLocalAvatar||!this._canInterpolate)return;const e=this.context.time.deltaTime/.1;this.head&&(this.head.position.lerp(this._headTarget.position,e),this.head.quaternion.slerp(this._headTarget.quaternion,e),this.head.scale.lerp(this._headTarget.scale,e)),this.handLeft&&this._handLeftTarget&&(this.handLeft.position.lerp(this._handLeftTarget.position,e),this.handLeft.quaternion.slerp(this._handLeftTarget.quaternion,e),this.handLeft.scale.lerp(this._handLeftTarget.scale,e)),this.handRight&&this._handRightTarget&&(this.handRight.position.lerp(this._handRightTarget.position,e),this.handRight.quaternion.slerp(this._handRightTarget.quaternion,e),this.handRight.scale.lerp(this._handRightTarget.scale,e))}destroy(){var e,t;_c&&console.log("Destroy avatar",this.guid),(e=this.root)==null||e.removeFromParent(),(t=this.avatarMarker)==null||t.destroy(),this.lastAvatarId=null,this.head&&pr.Remove(this.context,this.head)}updateVisibility(){const e=this.root;e&&ne.setActive(e,this._isVisible)}async setupCustomAvatar(e){var s,r,o;if(_c&&console.log("LOAD",e,this),!e||typeof e=="string"&&e.length<=0)return!1;this.head&&pr.Remove(this.context,this.head);const t=e;if((t==null?void 0:t.loadAssetAsync)!==void 0){await t.loadAssetAsync();const a=t.asset;ne.setActive(a,!1),e=ne.instantiate(a),ne.setActive(e,!0)}_c&&console.log(e);const i=await om.loader.getOrCreateNewAvatarInstance(this.context,e);if(_c&&console.log(i,i==null?void 0:i.isValid,this.lastAvatarId,e),i!=null&&i.isValid){if(this.root=i.root,this.root.position.set(0,0,0),this.root.quaternion.set(0,0,0,1),this.root.scale.set(1,1,1),this.avatarMarker=ne.addNewComponent(this.root,as),this.avatarMarker.connectionId=this.guid,this.avatarMarker.avatar=this,this.head&&this.head!==i.head&&((s=this.head)==null||s.removeFromParent()),this.head=i.head,this.headScale.copy(this.head.scale),this.head&&!this.isLocalAvatar&&pr.Add(this.context,this.head,this.avatarMarker),i.leftHand&&((r=this.handLeft)==null||r.removeFromParent()),this.handLeft=i.leftHand??this.handLeft,this.handLeft?this.handLeftScale.copy(this.handLeft.scale):this.handLeftScale.set(1,1,1),i.rigthHand&&((o=this.handRight)==null||o.removeFromParent()),this.handRight=i.rigthHand??this.handRight,this.handRight?this.handRightScale.copy(this.handRight.scale):this.handRightScale.set(1,1,1),this.context.scene.add(this.root),this.flags==null&&(this.flags=[]),this.flags.length=0,this.flags.push(...ne.getComponentsInChildren(this.root,os)),this.flags.length<=0&&this.head){const a=ne.addNewComponent(this.head,os);a.visibleIn=Wi.ThirdPerson|Wi.VR,this.flags.push(a),_c&&console.log("Added flag to head: "+a.visibleIn,this.head.name)}return _c&&console.log("[Avatar], is Local? ",this.isLocalAvatar,this.root),this.updateFlags(),this.updateVisibility(),!0}else return _c&&console.warn("build avatar failed"),!1}};let Il=om;h(Il,"loader",new wT),h(Il,"invertRotation",new Se().setFromAxisAngle(new w(0,1,0),Math.PI));class pr{static Add(e,t,i=null){if(t){for(const s of this.Pois)if(s.obj===t)return;this.Pois.push({obj:t,avatar:i}),this.LastChangeTime=e.time.time}}static Remove(e,t){var i;if(t){for(const s of this.Pois)if(s.obj===t){this.Pois.splice(this.Pois.indexOf(s),1),this.LastChangeTime=(e==null?void 0:e.time.time)??((i=Lt.Current)==null?void 0:i.time.time);return}}}}h(pr,"Pois",[]),h(pr,"LastChangeTime",0);var T0;(function(n){n.TargetChanged="avatar-look-target-changed"})(T0||(T0={}));class b7{constructor(){h(this,"guid");h(this,"position",new w)}}class I0 extends Te{constructor(){super(...arguments);h(this,"target",null);h(this,"avatar",null);h(this,"_model",null);h(this,"_targetModel",new b7);h(this,"_currentTargetObject",null);h(this,"_lastUpdateTime",0);h(this,"_lookDuration",0);h(this,"_lastPoiChangedTime",0)}set controlledTarget(t){this.target=t;const i=q.get("MoveRandom");if(i&&this.target){const s=ne.getComponent(this.target,i);s&&s.destroy()}}awake(){if(this.avatar=ne.getComponentInParent(this.gameObject,as),this.avatar){const t=ne.getComponentInParent(this.gameObject,as);this._model=new qM(this.context.connection,this.guid),t!=null&&t.isLocalAvatar&&this._model.requestOwnership()}this.context.connection.beginListen(T0.TargetChanged,t=>{var i;this.target&&t&&t.guid===((i=this.avatar)==null?void 0:i.guid)&&On(this.target,t.position)})}update(){var i;if((!this.context.connection.isConnected||(i=this._model)!=null&&i.hasOwnership)&&(pr.LastChangeTime!==this._lastPoiChangedTime&&(this._lastPoiChangedTime=pr.LastChangeTime,this._lookDuration=0),this.selectTarget(),this._currentTargetObject&&this.context.time.frameCount%10===0&&this.target)){const s=Mt(this._currentTargetObject);On(this.target,s),this.context.connection.isConnected&&this.avatar&&(this.context.connection.send(T0.TargetChanged,this._targetModel),this._targetModel.guid=this.avatar.guid,this._targetModel.position.copy(s))}}selectTarget(){if(this.context.time.time-this._lastUpdateTime>this._lookDuration){this._lastUpdateTime=this.context.time.time,this._lookDuration=Math.random()*.5+.2;const i=pr.Pois;if(i.length>0){const s=i[Math.floor(Math.random()*i.length)];if(s&&s.obj){if(s.avatar&&s.avatar===this.avatar)return;this._currentTargetObject=s.obj}}}}}class dA extends Te{constructor(){super(...arguments);h(this,"canGrab",!0)}onPointerClick(t){}}class fA extends Te{constructor(){super(...arguments);h(this,"isUsed",!0);h(this,"usedBy",null)}}var KB;(function(n){n[n.Average=0]="Average",n[n.Multiply=1]="Multiply",n[n.Minimum=2]="Minimum",n[n.Maximum=3]="Maximum"})(KB||(KB={}));var rE;(function(n){n[n.Discrete=0]="Discrete",n[n.Continuous=1]="Continuous"})(rE||(rE={}));var ln;(function(n){n[n.None=0]="None",n[n.FreezePositionX=2]="FreezePositionX",n[n.FreezePositionY=4]="FreezePositionY",n[n.FreezePositionZ=8]="FreezePositionZ",n[n.FreezePosition=14]="FreezePosition",n[n.FreezeRotationX=16]="FreezeRotationX",n[n.FreezeRotationY=32]="FreezeRotationY",n[n.FreezeRotationZ=64]="FreezeRotationZ",n[n.FreezeRotation=112]="FreezeRotation",n[n.FreezeAll=126]="FreezeAll"})(ln||(ln={}));var Jd;(function(n){n[n.None=0]="None",n[n.X=2]="X",n[n.Y=4]="Y",n[n.Z=8]="Z",n[n.All=-1]="All"})(Jd||(Jd={}));const Bs=function(n,e){return function(t,i,s){_7(t,i,s,n,e)}};function _7(n,e,t,i,s){if(!s&&!i&&!n.onValidate)return;if(t!==void 0){console.error("Invalid usage of validate decorator. Only fields can be validated.",n,e,t),bn("Invalid usage of validate decorator. Only fields can be validated. Property: "+e,jn.Error);return}let r="";if(typeof e=="string"?r=e:r=e.name,n.__internalAwake){const o=Symbol(r),a=n.__internalAwake;n.__internalAwake=function(){var l;if(!this.onValidate){si()&&console.warn('Usage of @validate decorate detected but there is no onValidate method in your class: "'+((l=n.constructor)==null?void 0:l.name)+'"');return}if(this[o]===void 0){this[o]=this[r];const c=this[r];if(c instanceof te||c instanceof w||c instanceof Ke||c instanceof Se){const u=this[r];_L(u,()=>{this.onValidate(r)})}Object.defineProperty(this,r,{set:function(u){var d;if(this[DC]===!0)this[o]=u;else{i==null||i.call(this,u);const f=this[o];this[o]=u,(d=this.onValidate)==null||d.call(this,r,f)}},get:function(){return s==null||s.call(this),this[o]}})}a.call(this)}}}var Co=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};class x7{constructor(e,t){h(this,"positionChanged",!1);h(this,"rotationChanged",!1);h(this,"position");h(this,"quaternion");h(this,"_positionKeys",["x","y","z"]);h(this,"_quaternionKeys",["_x","_y","_z","_w"]);h(this,"mute",!1);h(this,"context");h(this,"obj");h(this,"_positionWatch");h(this,"_rotationWatch");this.context=t,this.obj=e}get isDirty(){return this.positionChanged||this.rotationChanged}reset(e=!1){if(this.positionChanged=!1,this.rotationChanged=!1,this.mute=!1,e){if(this.position)for(const t of this._positionKeys)delete this.position[t];if(this.quaternion)for(const t of this._quaternionKeys)delete this.quaternion[t]}}syncValues(){for(const e of this._positionKeys)this.position[e]=this.obj.position[e];for(const e of this._quaternionKeys)this.quaternion[e]=this.obj.quaternion[e]}applyValues(){if(this.positionChanged&&this.position)for(const e of this._positionKeys){const t=this.position[e];t!==void 0&&(this.obj.position[e]=t)}if(this.rotationChanged&&this.quaternion)for(const e of this._quaternionKeys){const t=this.quaternion[e];t!==void 0&&(this.obj.quaternion[e]=t)}}start(e,t){this.reset(),e&&(this._positionWatch||(this._positionWatch=new Uc(this.obj.position,["x","y","z"])),this._positionWatch.apply(),this.position={},this._positionWatch.subscribeWrite((r,o)=>{var l;if((l=this.context.physics.engine)!=null&&l.isUpdating||this.mute)return;const a=this.position[o];Math.abs(a-r)<1e-5||(this.position[o]=r,this.positionChanged=!0)})),t&&(this._rotationWatch||(this._rotationWatch=new Uc(this.obj.quaternion,["_x","_y","_z","_w"])),this._rotationWatch.apply(),this.quaternion={},this._rotationWatch.subscribeWrite((r,o)=>{var l;if((l=this.context.physics.engine)!=null&&l.isUpdating||this.mute)return;const a=this.quaternion[o];Math.abs(a-r)<1e-5||(this.quaternion[o]=r,this.rotationChanged=!0)}));const i=this.obj.matrixWorld.multiplyMatrices.bind(this.obj.matrixWorld),s=new Ie;this.obj.matrixWorld.multiplyMatrices=(r,o)=>(s.equals(r)||(this.positionChanged=!0,this.rotationChanged=!0,s.copy(r)),i(r,o))}stop(){var e,t;(e=this._positionWatch)==null||e.revoke(),(t=this._rotationWatch)==null||t.revoke()}}const ab=class extends Te{constructor(){super(...arguments);h(this,"autoMass",!0);h(this,"_mass",0);h(this,"useGravity",!0);h(this,"constraints",ln.None);h(this,"isKinematic",!1);h(this,"drag",0);h(this,"angularDrag",1);h(this,"detectCollisions",!0);h(this,"sleepThreshold",.01);h(this,"collisionDetectionMode",rE.Discrete);h(this,"_gravityScale",1);h(this,"dominanceGroup",0);h(this,"_propertiesChanged",!1);h(this,"_currentVelocity",new w);h(this,"_smoothedVelocity",new w);h(this,"_smoothedVelocityGetter",new w);h(this,"_lastPosition",new w);h(this,"_watch")}set mass(t){t!==this._mass&&(this._mass=t,this._propertiesChanged=!0,this.__didAwake&&(this.autoMass=!1))}get mass(){var t,i;return this.autoMass?((i=(t=this.context.physics.engine)==null?void 0:t.getBody(this))==null?void 0:i.mass())??-1:this._mass}get lockPositionX(){return(this.constraints&ln.FreezePositionX)!==0}get lockPositionY(){return(this.constraints&ln.FreezePositionY)!==0}get lockPositionZ(){return(this.constraints&ln.FreezePositionZ)!==0}get lockRotationX(){return(this.constraints&ln.FreezeRotationX)!==0}get lockRotationY(){return(this.constraints&ln.FreezeRotationY)!==0}get lockRotationZ(){return(this.constraints&ln.FreezeRotationZ)!==0}set lockPositionX(t){t?this.constraints|=ln.FreezePositionX:this.constraints&=~ln.FreezePositionX}set lockPositionY(t){t?this.constraints|=ln.FreezePositionY:this.constraints&=~ln.FreezePositionY}set lockPositionZ(t){t?this.constraints|=ln.FreezePositionZ:this.constraints&=~ln.FreezePositionZ}set lockRotationX(t){t?this.constraints|=ln.FreezeRotationX:this.constraints&=~ln.FreezeRotationX}set lockRotationY(t){t?this.constraints|=ln.FreezeRotationY:this.constraints&=~ln.FreezeRotationY}set lockRotationZ(t){t?this.constraints|=ln.FreezeRotationZ:this.constraints&=~ln.FreezeRotationZ}set gravityScale(t){this._gravityScale=t}get gravityScale(){return this._gravityScale}awake(){this._watch=void 0,this._propertiesChanged=!1}onEnable(){this._watch||(this._watch=new x7(this.gameObject,this.context)),this._watch.start(!0,!0),this.startCoroutine(this.beforePhysics(),li.LateUpdate)}onDisable(){var t,i;(t=this._watch)==null||t.stop(),(i=this.context.physics.engine)==null||i.removeBody(this)}onDestroy(){var t;(t=this.context.physics.engine)==null||t.removeBody(this)}onValidate(){this._propertiesChanged=!0}*beforePhysics(){var t,i,s,r;for(;;)this._propertiesChanged&&(this._propertiesChanged=!1,(t=this.context.physics.engine)==null||t.updateProperties(this)),(i=this._watch)!=null&&i.isDirty?(this._watch.mute=!0,this._watch.applyValues(),(s=this.context.physics.engine)==null||s.updateBody(this,this._watch.positionChanged,this._watch.rotationChanged),this._watch.reset()):(r=this._watch)==null||r.syncValues(),this.captureVelocity(),yield}teleport(t,i=!0){var s;(s=this._watch)==null||s.reset(!0),i?this.gameObject.position.set(t.x,t.y,t.z):this.setWorldPosition(t.x,t.y,t.z),this.resetForcesAndTorques(),this.resetVelocities()}resetForces(t=!0){var i;(i=this.context.physics.engine)==null||i.resetForces(this,t)}resetTorques(t=!0){var i;(i=this.context.physics.engine)==null||i.resetTorques(this,t)}resetVelocities(){this.setVelocity(0,0,0),this.setAngularVelocity(0,0,0)}resetForcesAndTorques(){this.resetForces(),this.resetTorques()}wakeUp(){var t;(t=this.context.physics.engine)==null||t.wakeup(this)}applyForce(t,i,s=!0){var r;(r=this.context.physics.engine)==null||r.addForce(this,t,s)}applyImpulse(t,i=!0){var s;(s=this.context.physics.engine)==null||s.applyImpulse(this,t,i)}setForce(t,i,s,r=!0){var o,a,l;(o=this.context.physics.engine)==null||o.resetForces(this,r),typeof t=="number"?(i??(i=0),s??(s=0),(a=this.context.physics.engine)==null||a.addForce(this,{x:t,y:i,z:s},r)):(l=this.context.physics.engine)==null||l.addForce(this,t,r)}getVelocity(){var i;const t=(i=this.context.physics.engine)==null?void 0:i.getLinearVelocity(this);return t?(this._currentVelocity.x=t.x,this._currentVelocity.y=t.y,this._currentVelocity.z=t.z,this._currentVelocity):this._currentVelocity.set(0,0,0)}setVelocity(t,i,s,r=!0){var o,a;if(t instanceof w){const l=t;(o=this.context.physics.engine)==null||o.setLinearVelocity(this,l,r);return}i===void 0||s===void 0||(a=this.context.physics.engine)==null||a.setLinearVelocity(this,{x:t,y:i,z:s},r)}setAngularVelocity(t,i,s,r=!0){var o,a;if(t instanceof w){const l=t;(o=this.context.physics.engine)==null||o.setAngularVelocity(this,l,r);return}i===void 0||s===void 0||(a=this.context.physics.engine)==null||a.setAngularVelocity(this,{x:t,y:i,z:s},r)}getAngularVelocity(){var i;const t=(i=this.context.physics.engine)==null?void 0:i.getAngularVelocity(this);return t?(this._currentVelocity.x=t.x,this._currentVelocity.y=t.y,this._currentVelocity.z=t.z,this._currentVelocity):this._currentVelocity.set(0,0,0)}setTorque(t,i,s){this.setAngularVelocity(t,i,s)}get smoothedVelocity(){return this._smoothedVelocityGetter.copy(this._smoothedVelocity),this._smoothedVelocityGetter.multiplyScalar(1/this.context.time.deltaTime)}setBodyFromGameObject(t=null){}captureVelocity(){const t=Mt(this.gameObject);ab.tempPosition.copy(t);const i=t.sub(this._lastPosition);this._lastPosition.copy(ab.tempPosition),this._smoothedVelocity.lerp(i,this.context.time.deltaTime/.1)}};let bi=ab;h(bi,"tempPosition",new w);Co([Bs()],bi.prototype,"autoMass",void 0);Co([x()],bi.prototype,"mass",null);Co([Bs(),x()],bi.prototype,"useGravity",void 0);Co([Bs(),x()],bi.prototype,"constraints",void 0);Co([Bs(),x()],bi.prototype,"isKinematic",void 0);Co([Bs(),x()],bi.prototype,"drag",void 0);Co([Bs(),x()],bi.prototype,"angularDrag",void 0);Co([Bs(),x()],bi.prototype,"detectCollisions",void 0);Co([Bs(),x()],bi.prototype,"sleepThreshold",void 0);Co([Bs(),x()],bi.prototype,"collisionDetectionMode",void 0);Co([Bs()],bi.prototype,"_gravityScale",void 0);Co([Bs()],bi.prototype,"dominanceGroup",void 0);class zr{constructor(){h(this,"bb",null);h(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}x(){return this.bb.readFloat32(this.bb_pos)}y(){return this.bb.readFloat32(this.bb_pos+4)}z(){return this.bb.readFloat32(this.bb_pos+8)}static sizeOf(){return 12}static createVec3(e,t,i,s){return e.prep(4,12),e.writeFloat32(s),e.writeFloat32(i),e.writeFloat32(t),e.offset()}}class cU{constructor(){h(this,"bb",null);h(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}position(e){return(e||new zr).__init(this.bb_pos,this.bb)}rotation(e){return(e||new zr).__init(this.bb_pos+12,this.bb)}scale(e){return(e||new zr).__init(this.bb_pos+24,this.bb)}static sizeOf(){return 36}static createTransform(e,t,i,s,r,o,a,l,c,u){return e.prep(4,36),e.prep(4,12),e.writeFloat32(u),e.writeFloat32(c),e.writeFloat32(l),e.prep(4,12),e.writeFloat32(a),e.writeFloat32(o),e.writeFloat32(r),e.prep(4,12),e.writeFloat32(s),e.writeFloat32(i),e.writeFloat32(t),e.offset()}}class xl{constructor(){h(this,"bb",null);h(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsSyncedTransformModel(e,t){return(t||new xl).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsSyncedTransformModel(e,t){return e.setPosition(e.position()+t_),(t||new xl).__init(e.readInt32(e.position())+e.position(),e)}guid(e){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}fast(){const e=this.bb.__offset(this.bb_pos,6);return e?!!this.bb.readInt8(this.bb_pos+e):!1}transform(e){const t=this.bb.__offset(this.bb_pos,8);return t?(e||new cU).__init(this.bb_pos+t,this.bb):null}dontSave(){const e=this.bb.__offset(this.bb_pos,10);return e?!!this.bb.readInt8(this.bb_pos+e):!1}static startSyncedTransformModel(e){e.startObject(4)}static addGuid(e,t){e.addFieldOffset(0,t,0)}static addFast(e,t){e.addFieldInt8(1,+t,0)}static addTransform(e,t){e.addFieldStruct(2,t,0)}static addDontSave(e,t){e.addFieldInt8(3,+t,0)}static endSyncedTransformModel(e){return e.endObject()}static finishSyncedTransformModelBuffer(e,t){e.finish(t)}static finishSizePrefixedSyncedTransformModelBuffer(e,t){e.finish(t,void 0,!0)}}const mc=re("debugsync"),Om="STRS";VM(Om,xl.getRootAsSyncedTransformModel);const oa=new $f;function hU(n,e,t=!0){oa.clear();const i=oa.createString(n);xl.startSyncedTransformModel(oa),xl.addGuid(oa,i),xl.addFast(oa,t);const s=e.worldPosition,r=e.worldEuler,o=e.gameObject.scale;xl.addTransform(oa,cU.createTransform(oa,s.x,s.y,s.z,r.x,r.y,r.z,o.x,o.y,o.z));const a=xl.endSyncedTransformModel(oa);return oa.finish(a,Om),oa.asUint8Array()}class Bu extends Te{constructor(){super(...arguments);h(this,"overridePhysics",!0);h(this,"interpolatePosition",!0);h(this,"interpolateRotation",!0);h(this,"fastMode",!1);h(this,"syncDestroy",!1);h(this,"_model",null);h(this,"_needsUpdate",!0);h(this,"rb",null);h(this,"_wasKinematic",!1);h(this,"_receivedDataBefore",!1);h(this,"_targetPosition");h(this,"_targetRotation");h(this,"_receivedFastUpdate",!1);h(this,"_shouldRequestOwnership",!1);h(this,"joinedRoomCallback",null);h(this,"receivedDataCallback",null);h(this,"tempEuler",new pn);h(this,"receivedUpdate",!1);h(this,"lastWorldPos");h(this,"lastWorldRotation")}requestOwnership(){mc&&console.log("Request ownership"),this._model?this._model.requestOwnership():(this._shouldRequestOwnership=!0,this._needsUpdate=!0)}hasOwnership(){var t;return((t=this._model)==null?void 0:t.hasOwnership)??void 0}isOwned(){var t;return(t=this._model)==null?void 0:t.isOwned}awake(){mc&&console.log("new instance",this.guid,this),this._receivedDataBefore=!1,this._targetPosition=new w,this._targetRotation=new Se,this.lastWorldPos=new w,this.lastWorldRotation=new Se,this.rb=ne.getComponentInChildren(this.gameObject,bi),this.rb&&(this._wasKinematic=this.rb.isKinematic),this.receivedUpdate=!0,this._model=new qM(this.context.connection,this.guid),this.context.connection.isConnected&&this.tryGetLastState(),this.joinedRoomCallback=this.tryGetLastState.bind(this),this.context.connection.beginListen(pi.JoinedRoom,this.joinedRoomCallback),this.receivedDataCallback=this.onReceivedData.bind(this),this.context.connection.beginListenBinary(Om,this.receivedDataCallback)}onDestroy(){this.syncDestroy&&qW(this.guid,this.context.connection),this._model=null,this.context.connection.stopListen(pi.JoinedRoom,this.joinedRoomCallback),this.context.connection.stopListenBinary(Om,this.receivedDataCallback)}tryGetLastState(){const t=this.context.connection.tryGetState(this.guid);t&&this.onReceivedData(t)}onReceivedData(t){var i;if(!this.destroyed&&typeof t.guid=="function"&&t.guid()===this.guid){mc&&console.log("new data",this.context.connection.connectionId,this.context.time.frameCount,this.guid,t),this.receivedUpdate=!0,this._receivedFastUpdate=t.fast();const s=t.transform();if(s){Fr.markDirty(this.gameObject,!0);const r=s.position();r&&(this.interpolatePosition&&((i=this._targetPosition)==null||i.set(r.x(),r.y(),r.z())),(!this.interpolatePosition||!this._receivedDataBefore)&&this.setWorldPosition(r.x(),r.y(),r.z()));const o=s.rotation();o&&(this.tempEuler.set(o.x(),o.y(),o.z()),this.interpolateRotation&&this._targetRotation.setFromEuler(this.tempEuler),(!this.interpolateRotation||!this._receivedDataBefore)&&L8(this.gameObject,this.tempEuler))}this._receivedDataBefore=!0}}onEnable(){this.lastWorldPos.copy(this.worldPosition),this.lastWorldRotation.copy(this.worldQuaternion),this._needsUpdate=!0,this._model&&this._model.updateIsOwned()}onDisable(){this._model&&this._model.freeOwnership()}onBeforeRender(){if(!this.activeAndEnabled||!this.context.connection.isConnected)return;if(!this.context.connection.isInRoom||!this._model){mc&&console.log("no model or room",this.name,this.guid,this.context.connection.isInRoom);return}this._shouldRequestOwnership&&(this._shouldRequestOwnership=!1,this._model.requestOwnership());const t=this.worldPosition,i=this.worldQuaternion;if(this._model.isOwned&&!this.receivedUpdate){const o=t.distanceTo(this.lastWorldPos),a=i.angleTo(this.lastWorldRotation),l=this._model.hasOwnership||this.fastMode?1e-4:.001;(o>l||a>l)&&(this._model.hasOwnership?this._needsUpdate=!0:(mc&&console.log(this.guid,"reset because not owned but",this.gameObject.name,this.lastWorldPos),this.worldPosition=this.lastWorldPos,t.copy(this.lastWorldPos),this.worldQuaternion=this.lastWorldRotation,i.copy(this.lastWorldRotation),Fr.markDirty(this.gameObject,!0),this._needsUpdate=!1))}if(this._model&&!this._model.hasOwnership&&this._model.isOwned&&this._receivedDataBefore){const a=this._receivedFastUpdate||this.fastMode?.5:.3;let l=!1;if(this.interpolatePosition&&this._targetPosition){const c=this.worldPosition;c.lerp(this._targetPosition,a),this.worldPosition=c,l=!0}if(this.interpolateRotation&&this._targetRotation){const c=this.worldQuaternion;c.slerp(this._targetRotation,a),this.worldQuaternion=c,l=!0}l&&Fr.markDirty(this.gameObject,!0)}if(this.receivedUpdate=!1,this.lastWorldPos.copy(t),this.lastWorldRotation.copy(i),!this._model)return;if(!this._model||this._model.hasOwnership===void 0||!this._model.hasOwnership){this.rb&&(this.rb.isKinematic=this._model.isOwned??!1,this.rb.setVelocity(0,0,0));return}this.rb&&(this._wasKinematic!==void 0&&(mc&&console.log("reset kinematic",this.rb.name,this._wasKinematic),this.rb.isKinematic=this._wasKinematic),this.gameObject.position.distanceTo(new w(0,0,0))>1e3&&(mc&&console.log("RESET",this.name),this.gameObject.position.set(0,1,0),this.rb.setVelocity(0,0,0)));const s=10,r=this.rb||this.fastMode;if(this._needsUpdate&&(this.context.time.frameCount%s===0||r)){mc&&console.log("send update",this.context.connection.connectionId,this.guid,this.gameObject.name,this.gameObject.guid),this.overridePhysics&&this.rb,this._needsUpdate=!1;const o=hU(this.guid,this,!!r);this.context.connection.sendBinary(o)}}}var qo={};qo.d=(n,e)=>{for(var t in e)qo.o(e,t)&&!qo.o(n,t)&&Object.defineProperty(n,t,{enumerable:!0,get:e[t]})};qo.o=(n,e)=>Object.prototype.hasOwnProperty.call(n,e);qo.r=n=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})};var Cn={};qo.d(Cn,{w8:()=>mi,cg:()=>TN,gO:()=>Nm,wb:()=>ST,zV:()=>Du,HS:()=>pA,Ec:()=>Vu,gF:()=>Vf,ol:()=>Gm,pz:()=>wU,tx:()=>uo,hj:()=>CT,FV:()=>vA,sV:()=>hN,xv:()=>zm,mx:()=>bU,gE:()=>_U,ZP:()=>p$,Vx:()=>IN});var ST={};qo.r(ST);qo.d(ST,{get:()=>uU,set:()=>w7});var CT={};qo.r(CT);qo.d(CT,{alphaTestTransformer:()=>__,asPreprocessorValueTransformer:()=>SU,toPreprocessorTriggerTransformer:()=>LT,toUserDataTransformer:()=>OJ,uniformOrUserDataTransformer:()=>co});const oE={fontFamily:null,fontSize:.05,fontKerning:"auto",fontStyle:"normal",fontWeight:"normal",offset:.005,lineHeight:1.2,lineBreak:`- ,.:?!
`,whiteSpace:"pre-line",flexDirection:"column",justifyContent:"start",alignItems:"start",backgroundImage:null,textAlign:"left",boxSizing:"content-box",position:"static",color:16777215,fontColor:16777215,fontOpacity:1,opacity:1,fontPXRange:4,fontSupersampling:!0,fontSmooth:"antialiased",borderRadius:0,borderWidth:0,borderColor:"black",borderOpacity:1,backgroundSize:"cover",backgroundColor:0,backgroundOpacity:0,overflow:"visible",letterSpacing:0,invertAlpha:!1,segments:1},w7=function(n){for(const e in n)oE[e]=n[e]},uU=function(n){return Object.prototype.hasOwnProperty.call(oE,n)||console.warn(`ThreeMeshUI::DefaultValues is trying to retrieve non-existing property '${n}'`),oE[n]};class mi{constructor(e,t=null,i=!0){this._id=e,this._value=t,this._needsUpdate=!0,this._needsProcess=!1,this._needsRender=!1,this._isPrimitive=i}get id(){return this._id}get value(){return this._value}set value(e){this.isValid(e)&&this._value!==e&&(this._value=e,this._needsUpdate=!0)}update(e,t){this.output(t)}output(e){}_outputValue(e){e[this._id]=this._value}process(e){}render(e){}getInheritedInput(e){if(this._value!=="inherit")return this._value;const t=e._parent._value;return t&&t[`_${this._id}`]?t[`_${this._id}`].getInheritedInput(t):this.getDefaultValue()}getDefaultValue(){return uU(this._id)}isValid(e){return!0}emptyStrategyLogic(){throw new Error(`ThreeMeshUI::${this.constructor.name} has empty strategy. Update has not been processed.`)}requestUpdate(){this._needsUpdate=!0}requestProcess(){this._needsProcess=!1}requestRender(){this._needsRender=!1}}class S7 extends mi{constructor(){super("renderOrder","auto",!0),this.output=this._outputValue,this._actualValue=0}set value(e){this.isValid(e)&&(this._value=e,this._needsUpdate=!0)}update(e,t){if(this._value!=="auto")this._actualValue=this._value;else{const i=e._parent._value;if(i!==null){const s=i._renderOrder._actualValue,r=1+i._children._uis.indexOf(e);this._actualValue=s+r}}for(const i of e._children._uis)i._renderOrder._value==="auto"&&(i._renderOrder._needsUpdate=!0);this._outputValue(t)}_outputValue(e){e[this._id]=this._actualValue}get value(){return this._value}}class Vu extends mi{constructor(e,t=null,i=!0){super(e,t,i),this.output=this._outputValue,this._notInheritedValue=null}update(e,t){this._notInheritedValue=this._value,this._notInheritedValue==="inherit"&&(this._notInheritedValue=this.getInheritedInput(e)),this.propagate(e),this._outputValue(t)}propagate(e){for(const t of e._children._uis){const i=t[`_${this._id}`];i!==void 0&&i._value==="inherit"&&(t[`_${this._id}`]._needsUpdate=!0)}}_outputValue(e){e[this._id]=this._notInheritedValue}set value(e){this.isValid(e)&&this._value!==e&&(this._value=e,this._needsUpdate=!0)}get value(){return this._value==="inherit"?this._notInheritedValue:this._value}}class C7 extends Vu{constructor(){super("offset","inherit",!1)}update(e,t){super.update(e,t),e._parent._value!==null&&(e.position.z=this._notInheritedValue)}}class E7 extends Vu{constructor(){super("fontSmooth","inherit",!0),this._needsUpdate=!1,this.isValid=T7,this.output=this._outputValue}}const M7=["inherit","none","antialiased"];function T7(n){return M7.indexOf(n)===-1?(console.warn(`.fontSmoothing value '${n}' is not valid. Aborted`),!1):!0}var I7=n=>{var e={};return qo.d(e,n),e};const ze=I7({BackSide:()=>fn,BufferAttribute:()=>ot,BufferGeometry:()=>ft,Color:()=>_e,DoubleSide:()=>wi,EventDispatcher:()=>Fn,FileLoader:()=>Dn,FrontSide:()=>Es,LinearFilter:()=>Dt,Mesh:()=>ye,MeshBasicMaterial:()=>ai,Object3D:()=>Me,Plane:()=>Ir,PlaneGeometry:()=>us,ShaderMaterial:()=>Bt,Texture:()=>Rt,TextureLoader:()=>kl,Vector2:()=>te,Vector3:()=>w,Vector4:()=>Ke});class Vi extends mi{constructor(e,t,i=!0){super(e,"unset",i),this._input="inherit",this._allowsInherit=!0,this._inheritedInput=void 0,this._inline=void 0}update(e,t){this._allowsInherit||(this._inheritedInput=this.getInheritedInput(e)),this.computeOutputValue(e);for(const i of e._children._uis){const s=i[`_${this._id}`];(s._input?s._input:s._value)==="inherit"&&(i[`_${this._id}`]._needsUpdate=!0)}this.output(t)}computeOutputValue(e){this._value=this._input}_computeFromInherited(e){this._value=this._inheritedInput}set value(e){console.warn(".(style) sub-property cannot be directly set. It must comes from inline or computed setter.")}set inline(e){this.isValidValue(e)&&e!==this._inline&&(this._input=this._inline=e,this._needsUpdate=!0)}get inline(){return this._inline}isValidValue(e){return!0}getInheritedInput(e){if(this._input!=="inherit")return this._input;const t=e._parent._value;return t?t[`_${this._id}`].getInheritedInput(t):this.getDefaultValue()}}class b_ extends Vi{constructor(e,t){super(e,t,!1),this._input=new ze.Vector4(0,0,0,0),this._inline=null,this._value=new ze.Vector4(0,0,0,0)}get value(){return this._value}computeOutputValue(e){this._vector4ValueSetter(this._value,this._input)}set inline(e){this._vector4ValueSetter(this._input,e),!this._input.equals(this._value)&&(this._needsUpdate=!0)}set top(e){this._input.x!==e&&(this._input.x=e,this._needsUpdate=!0)}get top(){return this._input.x}set right(e){this._input.y!==e&&(this._input.y=e,this._needsUpdate=!0)}get right(){return this._input.y}set bottom(e){this._input.z!==e&&(this._input.z=e,this._needsUpdate=!0)}get bottom(){return this._input.z}set left(e){this._input.w!==e&&(this._input.w=e,this._needsUpdate=!0)}get left(){return this._input.w}dispose(){this._computed=null,this._inline=null,this._input=null,this._output=null}_vector4ValueSetter(e,t){if(t instanceof ze.Vector4){e.copy(t);return}if((typeof t=="string"||t instanceof String)&&(t=t.split(" ")),Array.isArray(t))switch(t=t.map(i=>parseFloat(i)),t.length){case 1:e.setScalar(t[0]);return;case 2:e.x=e.z=t[0],e.y=e.w=t[1];return;case 3:e.x=t[0],e.y=t[1],e.z=t[2];return;case 4:e.x=t[0],e.y=t[1],e.z=t[2],e.w=t[3];return;default:console.error("StyleVector4Property::set() Four Dimension property had more than four values");return}isNaN(t)||e.setScalar(t)}}class R7 extends b_{constructor(){super("padding",new ze.Vector4(0,0,0,0))}computeOutputValue(e){super.computeOutputValue(e),e._bounds._needsUpdate=!0,e._bounds._needsRender=!0,e._layouter._needsProcess=!0,e._renderer._needsRender=!0,e._parent._value&&(e._parent._value._layouter._needsProcess=!0)}}class P7 extends b_{constructor(){super("margin",new ze.Vector4(0,0,0,0))}computeOutputValue(e){super.computeOutputValue(e),e._renderer._needsRender=!0,e._parent._value&&(e._parent._value._flexDirection._needsProcess=!0)}}const ZB=function(n,e,t){n[e]=t},B7=function(n,e,t){t!==null&&(n[e]=t)};class Yv{constructor(e){this._definition=e}set definition(e){this._definition=e}mediate(e,t,i,s=null){for(const r in this._definition){const o=this._definition[r];if(i[r]!==void 0){const a=o.t?o.t:ZB;a(t,o.m,i[r]),s&&a(s,o.m,i[r])}}}static mediate(e,t,i,s,r=null){if(t)for(const o in s){const a=s[o];if(i[o]!==void 0){const l=a.t?a.t:ZB;l(t,a.m,i[o]),r&&l(r,a.m,i[o])}}}}class D7 extends mi{constructor(){super("parent",null,!1)}update(e,t){e.parent&&e.parent.isUI?this._value=e.parent:this._value=null}set value(e){console.warn("ParentProperty is readonly")}get value(){return this._value}find(e){return this._value?e(this._value)?this._value:this._value._parent.find(e):null}dispose(){this._value=null}}const aE=function(n,e,t=6){return n.toFixed(t)===e.toFixed(t)};class $B extends mi{constructor(e,t){super(e,t,!0),this.output=this._outputValue}set value(e){this.isValid(e)&&(aE(this._value,e)||(this._value=e,this._needsUpdate=!0))}get value(){return this._value}}class eD extends Vu{constructor(e){super(e,"inherit",!0),this.isValid=k7}}const O7=[ze.FrontSide,ze.BackSide,ze.DoubleSide];function k7(n){return O7.indexOf(n)===-1?(console.warn(`SideProperty value '${n}' is not valid. Abort`),!1):!0}const L7={light:"100",normal:"400",bold:"700",bolder:"900"};function ET(n){if(!isNaN(n))return n.toString();const e=L7[n];return e||n}class F7 extends ze.EventDispatcher{constructor(e,t){super(),this._isReady=!1,this._weight=ET(e),this._style=t,this._size=42,this._lineHeight=42,this._lineBase=42,this._font=null}get typographic(){return this._font}get isReady(){return this._isReady}get weight(){return this._weight}get style(){return this._style}get texture(){return this._texture}set fontMaterial(e){throw Error(`FontVariant('${this.id}')::fontMaterial - is abstract.`)}get fontMaterial(){throw Error(`FontVariant('${this.id}')::fontMaterial - is abstract.`)}get id(){return`${this._name}(w:${this.weight},s:${this.style})`}getTypographicGlyph(e){let t=this._chars[e];if(t)return t;if(e.match(/\s/))return this._chars[" "];const i=this._getFallbackCharacter(e);if(i&&(t=this._chars[i],t))return t;throw Error(`FontVariant('${this.id}')::getTypographicGlyph() - character('${e}') and/or fallback character were not found in provided msdf charset.`)}_getFallbackCharacter(e){throw new Error(`FontVariant(${typeof this})::_getFallbackCharacter() is abstract and should therefore be overridden.`)}getGeometricGlyph(e,t){throw new Error(`FontVariant(${typeof this})::getGeometryCharacter() is abstract and should therefore be overridden.`)}getKerningAmount(e){return this._kernings[e]?this._kernings[e]:0}adjustTypographicGlyphs(e){for(const t in e){const i=this.getTypographicGlyph(t),s=e[t];for(const r in s)i["_"+r]=e[t][r]}}_checkReadiness(){this._readyCondition()&&N7(this)}_alterElementProperties(e){throw new Error(`FontVariant(${typeof this})::_alterElementProperties() is abstract and should therefore be overridden.`)}_readyCondition(){throw new Error(`FontVariant(${typeof this})::_readyCondition() is abstract and should therefore be overridden.`)}}const U7={type:"ready"};function N7(n){n._isReady=!0,n.dispatchEvent(U7)}const pA=F7;class z7 extends mi{constructor(e=null){super("font",e,!1),this._needsUpdate=!1,this._fontVariant=null,this._handleFontReadyClosure=null,this.isValid=G7}output(e){e[this._id]=this._fontVariant}update(e,t){if(this._fontVariant&&!this._fontVariant.isReady&&this._fontVariant.removeEventListener("ready",this._handleFontReadyClosure),this._value&&this._value instanceof pA)this._fontVariant=this._value;else{const i=e._fontFamily._value;i&&(this._fontVariant=i.getVariant(e._fontWeight._value,e._fontStyle._value))}this._fontVariant&&(this._fontVariant._alterElementProperties(e),this._handleFontReadyClosure=V7(e,this),this._fontVariant.isReady?this._handleFontReadyClosure():this._fontVariant.addEventListener("ready",this._handleFontReadyClosure),(!e._fontMaterial._defaultMaterial||!(e._fontMaterial._defaultMaterial instanceof this._fontVariant.fontMaterial))&&(e._fontMaterial._defaultMaterial=new this._fontVariant.fontMaterial,e._fontMaterial._needsUpdate=!0))}set value(e){this.isValid(e)&&this._value!==e&&(this._value=e,this._needsUpdate=!0)}get value(){return this._value}get fontVariant(){return this._fontVariant}dispose(){this._handleFontReadyClosure&&(this._fontVariant.removeEventListener("ready",this._handleFontReadyClosure),this._handleFontReadyClosure=null),this._value=null,this._fontVariant=null}}function G7(n){return n instanceof pA?!0:(console.warn(`.font value '${n}' is not valid. It requires a FontVariant instance. Aborted`),!1)}function V7(n,e){return function(){e._needsUpdate=!0,n._glyphs._needsProcess=!0,e._fontVariant.removeEventListener("ready",e._handleFontReadyClosure),e._handleFontReadyClosure=null}}class H7 extends Vi{constructor(e){super("display",e),this._value="flex",this._allowsInherit=!1,this._needsUpdate=!1,this.isValidValue=W7}computeOutputValue(e){e._visible._value=this._output!=="none"}}const Q7=["none","flex"];function W7(n){return Q7.indexOf(n)===-1?(console.warn(`(.style) display value '${n}' is not valid. Aborted`),!1):!0}class j7 extends Vi{constructor(e){super("boxSizing",e),this._allowsInherit=!1,this.isValidValue=X7}computeOutputValue(e){this._value=this._inheritedInput,e._bounds._needsUpdate=!0}}const q7=["border-box","content-box"];function X7(n){return q7.indexOf(n)===-1?(console.warn(`(.style) boxSizing value '${n}' is not valid. Aborted`),!1):!0}class km extends Vi{constructor(e,t){super(e,t,!1),this._value=new ze.Color,this.output=this._outputValue}computeOutputValue(e){this._input!=="inherit"&&this._value.set(this._input)}set inline(e){this._input=this._inline=e,this._needsUpdate=!0}}class Qw extends Vi{constructor(e,t){super(e,t,!0),this.isValidValue=Y7,this._allowsInherit=!1,this._input=t,this._value=t,this.output=this._outputValue,this.computeOutputValue=this._computeFromInherited}_outputValue(e){e[this._id]=this._inheritedInput}}function Y7(n){return n<0&&n>1?(console.warn(`(.style) styleFactorProperty('${this.id}') value '${n}' is not valid)`),!1):!0}class J7 extends Vi{constructor(e){super("backgroundImage",e,!0),this._input=null,this._allowsInherit=!1,this._textureSize=new ze.Vector2(1,1),this.isValidValue=K7}get value(){return this._value}output(e){e[this._id]=this._value,e.tSize=this._textureSize}computeOutputValue(e){if(this._value=this._inheritedInput,this._value instanceof ze.Texture&&!this._value.image){console.warn("ThreeMeshUI - .backgroundImage :: Please provide preloaded texture in order to have accurate sizing.");return}this._needsProcess=!0}process(e){this._value?this._textureSize.set(this._value.image.width,this._value.image.height):this._textureSize.set(1,1)}}function K7(n){return!0}class Z7 extends Vi{constructor(e){super("backgroundSize",e,!0),this.isValidValue=eJ,this.output=this._outputValue}}const $7=["cover","contain","stretch"];function eJ(n){return $7.indexOf(n)===-1?(console.warn(`(.style) backgroundSize value '${n}' is not valid. Aborted`),!1):!0}class tJ extends Vi{constructor(e){super("overflow",e,!0),this.isValidValue=nJ,this._clippingPlanes=null,this._renderStrategy=this._emptyRender}update(e,t){this._inline!==void 0&&this._inline!=="unset"?this._input=this._inline:this._computed!==void 0&&(this._input=this._computed),this._allowsInherit||(this._inheritedInput=this.getInheritedInput(e)),this.computeOutputValue(e);for(const i of e._children._uis)i._overflow._needsUpdate=!0;this.output(t)}output(e){e.clippingPlanes=this._clippingPlanes}computeOutputValue(e){super.computeOutputValue(e),this._value==="hidden"?this._renderStrategy=this._propagateRender:(this._renderStrategy=this._emptyRender,this._clippingPlanes=null);const t=e._parent._value;if(t!==null){const i=t._overflow;if((i._value==="hidden"||i._clippingPlanes!==null)&&!this._clippingPlanes){this._clippingPlanes=[new ze.Plane(new ze.Vector3(0,-1,0),1),new ze.Plane(new ze.Vector3(-1,0,0),1),new ze.Plane(new ze.Vector3(0,1,0),1),new ze.Plane(new ze.Vector3(1,0,0),1)];for(let s=0;s<this._clippingPlanes.length;s++)this._clippingPlanes[s].parent=t;i._clippingPlanes!==null&&this._clippingPlanes.push(...i._clippingPlanes),this._renderStrategy=this._hiddenRender,this._needsRender=!0}else(i._value==="visible"||i._clippingPlanes===null)&&this._clippingPlanes!==null&&(this._clippingPlanes=null,this._renderStrategy=this._emptyRender,this._needsRender=!0)}}render(e){this._renderStrategy(e)}_emptyRender(e){}_hiddenRender(e){const t=e._parent._value,i=t._bounds._offsetHeight,s=t._bounds._offsetWidth,r=t._padding._value,o=t._borderWidth._value;for(let a=0;a<4&&a<this._clippingPlanes.length;a++){const l=this._clippingPlanes[a];switch(a%4){case 0:l.constant=i/2-(r.x+o.x);break;case 1:l.constant=s/2-(r.y+o.y);break;case 2:l.constant=i/2-(r.z+o.z);break;case 3:l.constant=s/2-(r.w+o.w);break}l.applyMatrix4(t.matrixWorld)}for(let a=0;a<e._children._uis.length;a++){const l=e._children._uis[a];l._overflow._needsRender=!0}}_propagateRender(e){for(let t=0;t<e._children._uis.length;t++){const i=e._children._uis[t];i._overflow._needsRender=!0}}}const iJ=["visible","hidden"];function nJ(n){return iJ.indexOf(n)===-1?(console.warn(`(.style) overflow value '${n}' is not valid. Aborted`),!1):!0}const zf="rem",dU="em",R0="%",sJ=[zf,dU,R0],fU=function(n){return sJ.indexOf(n)===-1?zf:n};class rJ extends b_{constructor(e){super("borderRadius",e),this._valueUV=this._value.clone(),this._input=new ze.Vector4(0,0,0,0),this._mediation=!0,this._cornerTL=new ze.Vector2(0,1),this._cornerTR=new ze.Vector2(1,1),this._cornerBR=new ze.Vector2(1,0),this._cornerBL=new ze.Vector2(0,0);const t=new Jv(this._valueUV,["x","y"]),i=new Jv(this._valueUV,["z","w"]),s=new Jv(this._valueUV,["x","w"]),r=new Jv(this._valueUV,["y","z"]);t.complementaryMediation=i,i.complementaryMediation=t,s.complementaryMediation=r,r.complementaryMediation=s,this._sideMediators=[t,i,s,r],this._units=zf}set units(e){this._units=fU(e),this._needsProcess=!0}get units(){return this._units}set mediation(e){e!==this._mediation&&(this._mediation=e,this._needsUpdate=!0)}get mediation(){return this._mediation}output(e){e.cornerTL=this._cornerTL,e.cornerTR=this._cornerTR,e.cornerBR=this._cornerBR,e.cornerBL=this._cornerBL}computeOutputValue(e){this._vector4ValueSetter(this._value,this._input),this._needsProcess=!0}process(e){this._needsRender=!0}render(e){this._valueUV.copy(this._value);const t=e._bounds._offsetWidth,i=e._bounds._offsetHeight;if(this._units===R0&&this._valueUV.divideScalar(100),this._units===zf&&this._valueUV.divideScalar(Math.min(t,i)),this._mediation)do this._sideMediators.forEach(o=>o.computeValue()),this._sideMediators.sort((o,a)=>o.value<a.value?1:-1),this._sideMediators[0].value>1&&this._sideMediators[0].mediate();while(this._sideMediators[0].value>1);let s=t>i?i/t:1,r=t<i?t/i:1;this._units===R0&&(s=r=1),this._cornerTL.x=this._valueUV.x*s,this._cornerTL.y=1-this._valueUV.x*r,this._cornerTR.x=1-this._valueUV.y*s,this._cornerTR.y=1-this._valueUV.y*r,this._cornerBR.x=1-this._valueUV.z*s,this._cornerBR.y=this._valueUV.z*r,this._cornerBL.x=this._valueUV.w*s,this._cornerBL.y=this._valueUV.w*r}dispose(){for(const e of this._sideMediators)e.dispose();this._sideMediators=null,this._cornerTL=null,this._cornerTR=null,this._cornerBR=null,this._cornerBL=null,super.dispose()}set topLeft(e){this._input.x!==e&&(this._input.x=e,this._needsUpdate=!0)}get topLeft(){return this._input.x}set topRight(e){this._input.y!==e&&(this._input.y=e,this._needsUpdate=!0)}get topRight(){return this._input.y}set bottomRight(e){this._input.z!==e&&(this._input.z=e,this._needsUpdate=!0)}get bottomRight(){return this._input.z}set bottomLeft(e){this._input.w!==e&&(this._input.w=e,this._needsUpdate=!0)}get bottomLeft(){return this._input.w}set top(e){this._input.x===e&&this._input.y===e||(this._input.x=this._input.y=e,this._needsUpdate=!0)}get top(){return(this._input.x+this._input.y)/2}set right(e){this._input.y===e&&this._input.z===e||(this._input.y=this._input.z=e,this._needsUpdate=!0)}get right(){return(this._input.y+this._input.z)/2}set bottom(e){this._input.z===e&&this._input.w===e||(this._input.z=this._input.w=e,this._needsUpdate=!0)}get bottom(){return(this._input.z+this._input.w)/2}set left(e){this._input.w===e&&this._input.x===e||(this._input.w=this._input.x=e,this._needsUpdate=!0)}get left(){return(this._input.w+this._input.x)/2}}class Jv{constructor(e,t){this._borderRadiuses=e,this._sideProperties=t,this._complementaryMediation=null,this._value=0}get value(){return this._value}set complementaryMediation(e){this._complementaryMediation=e}computeValue(){let e=0;for(const t of this._sideProperties)e+=this._borderRadiuses[t];this._value=e}mediate(e=!0){if(!(this._value<1)){for(const t of this._sideProperties)this._borderRadiuses[t]/=this._value;e&&this._complementaryMediation.mediate(!1)}}dispose(){this._complementaryMediation=null,this._borderRadiuses=null}}class oJ extends b_{constructor(e){super("borderWidth",e,!1),this._valueUV=this._value.clone(),this.output=this._outputValue,this._units=zf}set units(e){this._units=fU(e),this._needsUpdate=!0}get units(){return this._units}computeOutputValue(e){this._vector4ValueSetter(this._value,this._input),this._needsProcess=!0,e._bounds._needsUpdate=!0,e._layouter._needsUpdate=!0}_outputValue(e){e[this._id]=this._valueUV}process(e){this._needsRender=!0,e._borderRadius._needsRender=!0}render(e){this._valueUV.copy(this._value);const t=e._bounds._offsetWidth,i=e._bounds._offsetHeight;if(this._units===R0&&(console.log("Percent"),console.log(this._valueUV)),this._units===zf)t!==0&&(this._valueUV.w/=t,this._valueUV.y/=t),i!==0&&(this._valueUV.x/=i,this._valueUV.z/=i);else if(this._units===dU){if(t!==0){const s=t>i?i/t:1;this._valueUV.y*=s,this._valueUV.w*=s}if(i!==0){const s=t<i?t/i:1;this._valueUV.x*=s,this._valueUV.z*=s}}}}class aJ extends mi{constructor(e,t=!0){super("visible",t,!0),this._needsUpdate=!1}update(e,t){e.visible=this._value,e._parent._value&&(e._parent._value._children._needsUpdate=!0)}set value(e){this.isValid(e)&&this._value!==e&&(this._value=e,this._needsUpdate=!0)}get value(){return this._value}}class pU extends km{constructor(e){super("backgroundColor",e,!1),this._input="transparent",this._allowsInherit=!1}computeOutputValue(e){e._backgroundMesh.visible=!(this._input==="none"||this._input==="transparent"),this._input==="inherit"?this._value.set(this.getInheritedInput(e)):this._input==="transparent"||this._input==="none"||this._value.set(this._input)}}class ul extends mi{constructor(e="untitled"){super(e,void 0,!1)}update(e,t){}output(e){}}class lJ extends mi{constructor(){super("inlineJustificator",null,!1),this._value=null}update(e,t){}process(e){const t=e._bounds._innerHeight,i=e._layouter._value,s=Math.abs(i.height);let r=(()=>{switch(e._alignItems._value){case"inherit":case"start":return t/2;case"end":return s-t/2;case"stretch":case"center":return s/2}})();const o=e._padding._value,a=e._borderWidth._value;r+=(-o.x+o.z)/2+(-a.x+a.z)/2,i.forEach(l=>{l.y+=r,l.forEach(c=>{c.offsetY+=r})})}}const cJ=["start","center","end","stretch"],hJ=function(n){return cJ.indexOf(n)===-1?(console.warn(`(.style) alignItems value '${n}' is not valid. Aborted`),!1):!0};class MT extends Vi{constructor(){super("alignItems","inherit",!0),this.isValidValue=hJ}}class TT extends Vi{constructor(){super("textAlign","inherit",!0),this.isValidValue=dJ}}const uJ=["left","right","center","justify","justify-left","justify-right","justify-center"],dJ=function(n){return uJ.indexOf(n)===-1?(console.warn(`(.style) textAlign value '${n}' is not valid. Aborted`),!1):!0};class IT extends Vi{constructor(){super("flexDirection","inherit",!0),this.isValid=pJ}}const fJ=["row","row-reverse","column","column-reverse"];function pJ(n){return fJ.indexOf(n)===-1?(console.warn(`(.style) flexDirection value '${n}' is not valid. Aborted`),!1):!0}class RT extends Vi{constructor(){super("justifyContent","inherit",!0),this.isValidValue=mJ}}const gJ=["start","center","end","space-between","space-around","space-evenly"];function mJ(n){return gJ.indexOf(n)===-1?(console.warn(`(.style) justifyContent value '${n}' is not valid. Aborted`),!1):!0}class AJ extends Vi{constructor(){super("order",0,!0),this._value=0,this._input=0,this._allowsInherit=!1}computeOutputValue(e){this._value=this._inheritedInput,e._parent._value&&(e._parent._value._children._needsProcess=!0)}}class gU extends Vi{constructor(){super("position","static",!0),this._allowsInherit=!1,this._value="static",this._needsUpdate=!1,this.computeOutputValue=this._computeFromInherited,this.isValidValue=yJ}_computeFromInherited(e){super._computeFromInherited(e),e._parent._value&&(e._parent._value._children._needsProcess=!0)}}const vJ=["static","absolute"];function yJ(n){return vJ.indexOf(n)===-1?(console.warn(`(.style) position value '${n}' is not valid. Aborted`),!1):!0}class mU extends Vi{constructor(e,t=null){super(e,t,!0),this._input="auto",this._auto=!0,this._relative=!1,this._updateRequired=!0}set inline(e){this.isValidValue(e)&&e!==this._inline&&(this._inline=e,this._input!==this._inline&&this._parseInput())}get inline(){return this._inline}_parseInput(){let e=!0;if(this._inline!==void 0&&this._inline!=="unset"?this._input=this._inline:this._computed!==void 0?(this._computed===this._input&&(e=!1),this._input=this._computed):e=this._input==="inherit",e){if(this._auto=!this._input||this._input==="auto",this._auto)this._relative=!1;else if((typeof this._input=="string"||this._input instanceof String)&&this._input.endsWith("%")){this._relative=!0,this._value=0;const t=parseFloat(this._input.replace("%","").trim());isNaN(t)||(this._value=t/100)}else this._relative=!1,this._value=this._input;this._needsUpdate=this._updateRequired=e}}update(e,t){if(this._updateRequired){this._updateRequired=!1,this._allowsInherit||(this._inheritedInput=this.getInheritedInput(e)),this.computeOutputValue(e);for(const i of e._children._uis)i[`_${this._id}`]._needsUpdate=!0;this.output(t),e._parent._value&&(e._parent._value._layouter._needsProcess=!0)}}computeOutputValue(e){e._bounds._needsUpdate=!0,e._renderer._needsRender=!0}getInheritedInput(e){if(this._input!=="inherit"&&!this._auto)return this._input;const t=e._parent._value;return t?t[`_${this._id}`].getInheritedInput(t):this.getDefaultValue()}getDefaultValue(){return 0}get value(){return this._value}}class bJ extends mU{constructor(){super("width")}}class _J extends mU{constructor(){super("height")}computeOutputValue(e){super.computeOutputValue(e)}}class AU extends ul{constructor(){super("textContent"),this._needsUpdate=!1}set value(e){}process(e){let t="";for(let i=0;i<e.children.length;i++){const s=e.children[i];s.isUI&&(t+=s.textContent)}this._value=t}}class vU extends Vi{constructor(e){super("fontStyle",e,!0),this.isValidValue=wJ}}const xJ=["normal","italic"];function wJ(n){return xJ.indexOf(n)===-1?(console.warn(`(.style) fontStyle value '${n}' is not valid. Aborted`),!1):!0}class yU extends Vi{constructor(){super("fontWeight","inherit",!0),this.isValid=CJ}}const SJ=["100","200","300","400","500","600","700","800","900","light","normal","bold","bolder"];function CJ(n){return SJ.indexOf(n.toString())===-1?(console.warn(`(.style) fontWeight value '${n}' is not valid. Aborted`),!1):!0}class bU{constructor(){this._size=42,this._lineHeight=42,this._lineBase=38,this._name="-",this._charset=""}get size(){return this._size}get lineHeight(){return this._lineHeight}get lineBase(){return this._lineBase}get name(){return this._name}get charset(){return this._charset}}class EJ extends bU{constructor(e){super(),this._size=e.info.size,this._lineHeight=e.common.lineHeight,this._lineBase=e.common.base,this._name=e.info.face,this._textureWidth=e.common.scaleW,this._textureHeight=e.common.scaleH,this._charset=e.chars.map(t=>t.char).join("")}get textureWidth(){return this._textureWidth}get textureHeight(){return this._textureHeight}}class _U{constructor(e){this._char="",this._width=1,this._heigth=1,this._xadvance=1,this._xoffset=0,this._yoffset=0,this._font=e}get font(){return this._font}get char(){return this._char}get width(){return this._width}get height(){return this._heigth}get xadvance(){return this._xadvance}get xoffset(){return this._xoffset}get yoffset(){return this._yoffset}set yoffset(e){this._yoffset=e}clone(e){throw new Error("Abstract... Need to be implemented")}asInlineGlyph(){throw new Error("Abstract... Need to be implemented")}}class xU{constructor(){this._offsetX=0,this._offsetY=0,this._lineBreak=null,this._kerning=0,this._fontFactor=1,this._fontSize=0,this._cumulativeWidth=0,this._paddingLeft=0,this._paddingRight=0,this._marginLeft=0,this._marginRight=0}resetOffsets(){this._offsetX=this._offsetY=0,this._cumulativeWidth=0}get xadvance(){return 0}get xoffset(){return 0}get yoffset(){return 0}get width(){return 0}get height(){return 0}set lineBreak(e){this._lineBreak=e}get lineBreak(){return this._lineBreak}get anchor(){return 0}get kerning(){return this._kerning*this._fontFactor}set kerning(e){this._kerning=e}get fontSize(){return this._fontSize}set fontSize(e){this._fontSize=e}get lineHeight(){return 0}get offsetX(){return this._offsetX}set offsetX(e){this._offsetX=e}get offsetY(){return this._offsetY}set offsetY(e){this._offsetY=e}get cumulativeWidth(){return this._cumulativeWidth}set cumulativeWidth(e){this._cumulativeWidth=e}get marginLeft(){return this._marginLeft}set marginLeft(e){this._marginLeft=e}get marginRight(){return this._marginRight}set marginRight(e){this._marginRight=e}get paddingLeft(){return this._paddingLeft}set paddingLeft(e){this._paddingLeft=e}get paddingRight(){return this._paddingRight}set paddingRight(e){this._paddingRight=e}get lineBase(){return 0}set fontFactor(e){this._fontFactor=e}get fontFactor(){return this._fontFactor}}class wU extends xU{constructor(e){super(),this._typographic=e}get typographic(){return this._typographic}get xadvance(){return this._typographic.xadvance*this._fontFactor}get xoffset(){return this._typographic.xoffset*this._fontFactor}get yoffset(){return this._typographic.yoffset*this._fontFactor}get width(){return this._typographic.width*this._fontFactor}get height(){return this._typographic.height*this._fontFactor}get char(){return this._typographic.char}get anchor(){return this.yoffset}get lineHeight(){return this._typographic.font.lineHeight*this._fontFactor}get lineBase(){return this._typographic.font.lineBase*this._fontFactor}}class MJ extends wU{constructor(e){super(e)}get uv(){return this.typographic.uv}}class P0 extends _U{constructor(e,t){super(e),this._char=t.char,this._width=t.width,this._heigth=t.height,this._xadvance=t.xadvance?t.xadvance:this._width,this._xoffset=t.xoffset?t.xoffset:0,this._yoffset=t.yoffset?t.yoffset:0,this._uv=t.uv?t.uv:null,isNaN(t.x)||(this._uv={left:t.x/e.textureWidth,right:(t.x+t.width)/e.textureWidth,top:1-(t.y+t.height)/e.textureHeight,bottom:1-t.y/e.textureHeight})}get uv(){return this._uv}clone(e){return new P0(this._font,{char:e,width:this._width,height:this._heigth,xadvance:this._xadvance,xoffset:this._xoffset,yoffset:this._yoffset,uv:null})}asInlineGlyph(){return new MJ(this)}}class TJ extends ze.PlaneGeometry{constructor(e,t){let i=1,s=1;const r=e.typographic.font.size,o=t._segments.value;i=Math.ceil(e.typographic.width/r*o),s=Math.ceil(e.typographic.height/r*o),super(e.width,e.height,i,s),e.uv?(this._mapUVs(e),this._transformGeometry(e)):(this._nullifyUVs(),this.scale(0,0,1),this.translate(0,e.fontSize/2,0)),this.name="GlyphGeometry"}_mapUVs(e){const t=e.uv.right-e.uv.left,i=e.uv.bottom-e.uv.top,s=this.getAttribute("uv").array.slice(),r=[];for(let o=0;o<s.length;o+=2){const a=s[o],l=s[o+1];r.push(e.uv.left+t*a),r.push(e.uv.top+i*l)}this.setAttribute("uvG",new ze.BufferAttribute(new Float32Array(r),2))}_nullifyUVs(){const e=[],t=this.getAttribute("uv").array.length;for(let i=0;i<t;i++)e.push(0);this.setAttribute("uvG",new ze.BufferAttribute(new Float32Array(e),2))}_transformGeometry(e){this.translate(e.width/2,-e.height/2,0)}}const IJ=`
attribute vec2 uvG;
varying vec2 vUvG;
`,PT=IJ,RJ=`
vUvG = uvG;
`,BT=RJ,PJ=`
gl_Position.z -= 0.00001;
`,DT=PJ,BJ=`
varying vec2 vUvG;
uniform sampler2D glyphMap;
uniform vec2 unitRange;
// functions from the original msdf repo:
// https://github.com/Chlumsky/msdfgen#using-a-multi-channel-distance-field
float median(float r, float g, float b) {
	return max(min(r, g), min(max(r, g), b));
}
float screenPxRange() {

	// precomputed unitRange as recommended by Chlumsky
	// vec2 unitRange = vec2(pxRange)/vec2(textureSize(glyphMap, 0));
	vec2 screenTexSize = vec2(1.0)/fwidth(vUvG);
	return max(0.5*dot(unitRange, screenTexSize), 1.0);
}
float tap(vec2 offsetUV) {
	vec3 msd = texture( glyphMap, offsetUV ).rgb;
	float sd = median(msd.r, msd.g, msd.b);
	float screenPxDistance = screenPxRange() * (sd - 0.5);
	float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);
	return alpha;
}
`,OT=BJ,DJ=`
	float alpha;
#ifdef NO_RGSS

	alpha = tap( vUvG );

#else

	// shader-based supersampling based on https://bgolus.medium.com/sharper-mipmapping-using-shader-based-supersampling-ed7aadb47bec
	// per pixel partial derivatives
	vec2 dx = dFdx(vUvG);
	vec2 dy = dFdy(vUvG);
	// rotated grid uv offsets
	vec2 uvOffsets = vec2(0.125, 0.375);
	vec2 offsetUV = vec2(0.0, 0.0);
	// supersampled using 2x2 rotated grid
	alpha = 0.0;
	offsetUV.xy = vUvG + uvOffsets.x * dx + uvOffsets.y * dy;
	alpha += tap(offsetUV);
	offsetUV.xy = vUvG - uvOffsets.x * dx - uvOffsets.y * dy;
	alpha += tap(offsetUV);
	offsetUV.xy = vUvG + uvOffsets.y * dx - uvOffsets.x * dy;
	alpha += tap(offsetUV);
	offsetUV.xy = vUvG - uvOffsets.y * dx + uvOffsets.x * dy;
	alpha += tap(offsetUV);
	alpha *= 0.25;

#endif

	alpha = clamp( alpha, 0.0, 1.0 );

#ifdef INVERT_ALPHA

	alpha = 1.0 - alpha;

#endif

	diffuseColor.a *= alpha;
`,kT=DJ,__=function(n,e,t){n.alphaTest=t,LT(n,"USE_ALPHATEST",t>0)},LT=function(n,e,t){n.defines&&(t?n.defines[e]===void 0&&(n.defines[e]="",n.needsUpdate=!0):n.defines[e]!==void 0&&(delete n.defines[e],n.needsUpdate=!0))},SU=function(n,e,t){n.defines[e]&&n.defines[e]===t||(n.defines[e]=t,n.needsUpdate=!0)},co=function(n,e,t){n.userData[e]?n.userData[e].value=t:n.uniforms[e].value=t},OJ=function(n,e,t){n.userData[e].value=t};class uo{static ensureMaterialOptions(e){e.transparent=!0,e.alphaTest=e.alphaTest||.02}static ensureDefines(e){e.defines||(e.defines={})}static ensureUserData(e,t){e.userData.glyphMap={value:t.glyphMap},e.userData.unitRange={value:new ze.Vector2}}static bindUniformsWithUserData(e,t){e.uniforms.glyphMap=t.userData.glyphMap,e.uniforms.unitRange=t.userData.unitRange}static injectShaderChunks(e){uo.injectVertexShaderChunks(e),uo.injectFragmentShaderChunks(e)}static injectVertexShaderChunks(e){e.vertexShader=e.vertexShader.replace("#include <uv_pars_vertex>",`#include <uv_pars_vertex>
`+PT),e.vertexShader=e.vertexShader.replace("#include <uv_vertex>",`#include <uv_vertex>
`+BT),e.vertexShader=e.vertexShader.replace("#include <project_vertex>",`#include <project_vertex>
`+DT)}static injectFragmentShaderChunks(e){e.fragmentShader=e.fragmentShader.replace("#include <uv_pars_fragment>",`#include <uv_pars_fragment>
`+OT),e.fragmentShader=e.fragmentShader.replace("#include <alphamap_fragment>",`#include <alphamap_fragment>
`+kT)}static from(e){return class extends e{constructor(i={}){uo.ensureMaterialOptions(i);super(i);h(this,"_cumulativeOnBeforeCompile",i=>{uo.bindUniformsWithUserData(i,this),uo.injectShaderChunks(i),this._userDefinedOnBeforeCompile(i)});uo.ensureDefines(this),uo.ensureUserData(this,i),this._userDefinedOnBeforeCompile=s=>{},this._onBeforeCompile=this._cumulativeOnBeforeCompile}static get fontMaterialProperties(){return uo.mediation}set onBeforeCompile(i){this._userDefinedOnBeforeCompile=i}get onBeforeCompile(){return this._onBeforeCompile}}}static get mediation(){return FJ}}const kJ=function(n,e,t){const i=t?t.texture:null,s=t?t.unitRange:new ze.Vector2;if(n[e]!==void 0){n.glyphMap=i,n.unitRange=s;return}n.userData&&n.userData.glyphMap&&(n.userData.glyphMap.value=i,n.userData.unitRange.value=s)},LJ=function(n,e,t){t&&t!=="antialiased"?n.defines.NO_RGSS="":delete n.defines.NO_RGSS,n.needsUpdate=!0},FJ={clippingPlanes:{m:"clippingPlanes"},fontAlphaTest:{m:"alphaTest",t:__},fontSide:{m:"side"},font:{m:"glyphMap",t:kJ},color:{m:"color"},fontOpacity:{m:"opacity"},fontSmooth:{m:"NO_RGSS",t:LJ},invertAlpha:{m:"INVERT_ALPHA",t:LT}},UJ=`
${PT}
#include <clipping_planes_pars_vertex>
void main() {
	${BT}
	#include <begin_vertex>
	#include <project_vertex>
	${DT}
	#include <clipping_planes_vertex>
}
`,NJ=`
uniform vec3 diffuse;
uniform float opacity;
${OT}
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	// instead of <color_fragment> : vec4 diffuseColor
	vec4 diffuseColor = vec4( diffuse, opacity );
	${kT}
	#include <alphatest_fragment>
	// instead of <output_fragment>
	gl_FragColor = diffuseColor;
	#include <clipping_planes_fragment>
}
`,zJ=.02;class FT extends ze.ShaderMaterial{static get mediation(){return uo.mediation}constructor(e={}){super({uniforms:{glyphMap:{value:null},diffuse:{value:null},opacity:{value:1},unitRange:{value:new ze.Vector2(0,0)},alphaTest:{value:zJ}},transparent:!0,clipping:!0,vertexShader:UJ,fragmentShader:NJ,extensions:{derivatives:!0}}),this.defines.USE_ALPHATEST="",this.needsUpdate=!0,this.noRGSS=e.noRGSS||!1}get color(){return this.uniforms.diffuse.value}set color(e){this.uniforms.diffuse.value=e}set opacity(e){this.uniforms&&(this.uniforms.opacity.value=e)}get opacity(){return this.uniforms.opacity.value}get unitRange(){return this.uniforms.unitRange.value}set unitRange(e){this.uniforms.unitRange.value.copy(e)}get glyphMap(){return this.uniforms.glyphMap.value}set glyphMap(e){this.uniforms.glyphMap.value=e}get isDefault(){return this.constructor===FT}get alphaTest(){return this.uniforms.alphaTest.value}set alphaTest(e){this.uniforms.alphaTest.value=e}}class GJ extends pA{constructor(e,t,i,s){if(super(e,t),this._unitRange=new ze.Vector2(1,1),i.pages?this._buildData(i):VJ(this,i),s instanceof ze.Texture)this._texture=s,this._buildTexture(s);else if(typeof s=="string"||s instanceof String)HJ(this,s);else throw new Error(`ThreeMeshUI::MSDFVariant provided 'texture' parameter is '${typeof s}'. Only Texture and String allowed.`);this._defaultMaterialClass=FT,this._checkReadiness()}get texture(){return this._texture}get unitRange(){return this._unitRange}set fontMaterial(e){this._defaultMaterialClass=e}get fontMaterial(){return this._defaultMaterialClass}_buildData(e){this._font=new EJ(e),this._kernings=this._buildKerningPairs(e),this._chars=this._buildCharacters(e),this._chars[" "]=this._buildCharacterWhite(e),this._chars[`
`]=this._buildCharacterWhite(e,`
`,.001,1),this._chars["	"]=this._buildCharacterWhite(e,"	",4,1),this._size=e.info.size,this._lineHeight=e.common.lineHeight,this._lineBase=e.common.base,this._distanceRange=e.distanceField.distanceRange,this._unitRange=new ze.Vector2(this._distanceRange,this._distanceRange).divide(new ze.Vector2(e.common.scaleW,e.common.scaleH))}_buildTexture(e){e.generateMipmaps=!1,e.minFilter=ze.LinearFilter,e.magFilter=ze.LinearFilter,e.needsUpdate=!0}_getFallbackCharacter(e){return Du.missingCharacter(this,e)}getGeometricGlyph(e,t){return new TJ(e,t)}_readyCondition(){return this._chars&&this._texture&&this._texture.image}_buildKerningPairs(e){const t={};for(let i=0;i<e.kernings.length;i++){const s=e.kernings[i];if(s.amount===0)continue;const r=String.fromCharCode(s.first,s.second);t[r]=s.amount}return t}_buildCharacters(e){const t={};for(let i=0;i<e.chars.length;i++){const s=e.chars[i];t[s.char]=new P0(this._font,s)}return t}_buildCharacterWhite(e,t=" ",i=1,s=1){return new P0(this._font,{char:t,width:e.info.size/3*i,height:e.info.size*.7*s})}_alterElementProperties(e){}}function VJ(n,e){new ze.FileLoader().setResponseType("json").load(e,t=>{n._buildData(t),n._checkReadiness()})}function HJ(n,e){n._texture=new ze.TextureLoader().load(e,t=>{n._buildTexture(t),n._checkReadiness()})}class x_ extends ze.EventDispatcher{constructor(t){super();h(this,"_checkReadiness",()=>{this._variants.every(t=>t.isReady)&&WJ(this)});this._name=t,this._variants=[],this._isReady=!1}get isReady(){return this._isReady}addVariant(t,i,s,r,o=!1){if(o||!this.getVariant(t,i)){this._isReady=!1;const a=new GJ(t,i,s,r);this._variants.push(a),a.isReady?this._checkReadiness():a.addEventListener("ready",this._checkReadiness)}else console.warn(`FontFamily('${this._name}')::addVariant() - Variant(${t}, ${i}) already exists.`);return this}addCustomImplementationVariant(t,i=!1){return i||!this.getVariant(t.weight,t.style)?(this._isReady=!1,this._variants.push(t),t.isReady?this._checkReadiness():t.addEventListener("ready",this._checkReadiness)):console.warn(`FontFamily('${this._name}')::addCustomImplementationVariant() - Variant(${t.weight}, ${t.style}) already exists.`),this}getVariant(t,i){return t=ET(t),this._variants.find(s=>s.weight===t&&s.style===i)}get name(){return this._name}}const QJ={type:"ready"};function WJ(n){n._isReady=!0,n.dispatchEvent(QJ)}const Hy={},jJ=function(n){const e=[...arguments];e.forEach(i=>{if(!(i instanceof x_))throw new Error(`FontLibrary::prepare() - One of the provided parameter is not a FontFamily. Instead ${typeof i} given.`)});const t=function(){return e.every(i=>i.isReady)};return new Promise((i,s)=>{if(t())i();else for(let r=0;r<e.length;r++){const o=e[r];o.isReady||o.addEventListener("ready",()=>{t()&&i()})}})},qJ=function(n){return Hy[n]&&console.error(`FontLibrary::addFontFamily - Font('${n}') is already registered`),Hy[n]=new x_(n),Hy[n]},XJ=function(n){return Hy[n]},YJ=function(n){CU=n};let CU=function(n,e){return console.error(`The character '${e}' is not included in the font characters set.`)," "};function JJ(n,e){return CU(n,e)}const KJ={addFontFamily:qJ,getFontFamily:XJ,prepare:jJ,setMissingCharacterHandler:YJ,missingCharacter:JJ},Du=KJ;class EU extends Vi{constructor(){super("fontFamily","inherit",!0)}computeOutputValue(e){if(this._input instanceof x_)this._value=this._input;else if(this._input!=="inherit")if(typeof this._input=="string"){const t=Du.getFontFamily(this._input);t?this._value=t:console.warn(`(.style) fontFamily, the font '${this._input}' is not registered. Aborted.`)}else console.warn("(.style) fontFamily requires a registered fontFamily instance, or the id of a registered fontFamily."),console.warn("If you want to set a specific font, please use .font property instead.")}get value(){return this._value}getInheritedInput(e){if(this._input!=="inherit")return this._input;const t=e._parent._value;return t?t[`_${this._id}`].getInheritedInput(t):this.getDefaultValue()}}class MU extends Vi{constructor(){super("lineHeight","inherit",!0)}update(e,t){super.update(e,t),e._layouter._needsProcess=!0}}class TU extends Vi{constructor(){super("whiteSpace","inherit"),this.isValidValue=$J}}const ZJ=["normal","nowrap","pre","pre-line","pre-wrap"];function $J(n){return ZJ.indexOf(n)===-1?(console.warn(`(.style) whiteSpace value '${n}' is not valid. Aborted`),!1):!0}class IU extends Vi{constructor(){super("letterSpacing","inherit",!0)}}class eK extends Vi{constructor(){super("fontSize","inherit",!0)}}class RU extends mi{constructor(){super("segments",1,!1)}}class tK extends Vu{constructor(){super("invertAlpha","inherit")}}class w_ extends Vi{constructor(){super("fontKerning","inherit"),this.isValidValue=nK}}const iK=["normal","none","inherit"];function nK(n){return iK.indexOf(n)===-1?(console.warn(`(.style) fontKerning value '${n}' is not valid. Aborted`),!1):!0}class Kv extends Vu{constructor(e){super(e,"inherit",!0)}}class tD extends Vu{constructor(e){super(e,"inherit",!1),this._mediation={},this._defaultMaterial=null}update(e,t){this._notInheritedValue=this._value,this._notInheritedValue==="inherit"?this._notInheritedValue=this.getInheritedInput(e):this.propagate(e),this._notInheritedValue?this._notInheritedValue.constructor.mediation?this._mediation={...this._notInheritedValue.constructor.mediation}:this._mediation={clippingPlanes:{m:"clippingPlanes"},fontAlphaTest:{m:"alphaTest",t:__},fontSide:{m:"side"},color:{m:"color"},fontOpacity:{m:"opacity"}}:this._mediation={},e._transferToFontMaterial(),this._outputValue(t)}getInheritedInput(e){if(this._value!=="inherit")return this._value;let t=e,i=null;for(;t._parent._value;)if(t=t._parent._value,t[`_${this._id}`]._value!=="inherit"){i=t[`_${this._id}`]._value;break}return i!==null?i:this.getDefaultValue()}getDefaultValue(){return this._defaultMaterial}}var sK=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,370,1,154,10,50,3,123,2,54,14,32,10,3,1,11,3,46,10,8,0,46,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,87,9,39,4,60,6,26,9,1014,0,2,54,8,3,82,0,12,1,19628,1,4706,45,3,22,543,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,262,6,10,9,357,0,62,13,1495,6,110,6,6,9,4759,9,787719,239],PU=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,13,10,2,14,2,6,2,1,2,10,2,14,2,6,2,1,68,310,10,21,11,7,25,5,2,41,2,8,70,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,349,41,7,1,79,28,11,0,9,21,43,17,47,20,28,22,13,52,58,1,3,0,14,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,38,6,186,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,19,72,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,190,0,80,921,103,110,18,195,2637,96,16,1070,4050,582,8634,568,8,30,18,78,18,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,43,8,8936,3,2,6,2,1,2,290,46,2,18,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,1845,30,482,44,11,6,17,0,322,29,19,43,1269,6,2,3,2,1,2,14,2,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42719,33,4152,8,221,3,5761,15,7472,3104,541,1507,4938],rK="-----------------------------------------------------------------------------------------------------------------------------------------------------",BU="------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------",Ww={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},jw="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",oK={5:jw,"5module":jw+" export import",6:jw+" const class extends export import super"},aK=/^in(stanceof)?$/,lK=new RegExp("["+BU+"]"),cK=new RegExp("["+BU+rK+"]");function lE(n,e){for(var t=65536,i=0;i<e.length;i+=2){if(t+=e[i],t>n)return!1;if(t+=e[i+1],t>=n)return!0}}function jl(n,e){return n<65?n===36:n<91?!0:n<97?n===95:n<123?!0:n<=65535?n>=170&&lK.test(String.fromCharCode(n)):e===!1?!1:lE(n,PU)}function Gf(n,e){return n<48?n===36:n<58?!0:n<65?!1:n<91?!0:n<97?n===95:n<123?!0:n<=65535?n>=170&&cK.test(String.fromCharCode(n)):e===!1?!1:lE(n,PU)||lE(n,sK)}var ti=function(e,t){t===void 0&&(t={}),this.label=e,this.keyword=t.keyword,this.beforeExpr=!!t.beforeExpr,this.startsExpr=!!t.startsExpr,this.isLoop=!!t.isLoop,this.isAssign=!!t.isAssign,this.prefix=!!t.prefix,this.postfix=!!t.postfix,this.binop=t.binop||null,this.updateContext=null};function $r(n,e){return new ti(n,{beforeExpr:!0,binop:e})}var eo={beforeExpr:!0},tr={startsExpr:!0},UT={};function Yt(n,e){return e===void 0&&(e={}),e.keyword=n,UT[n]=new ti(n,e)}var D={num:new ti("num",tr),regexp:new ti("regexp",tr),string:new ti("string",tr),name:new ti("name",tr),privateId:new ti("privateId",tr),eof:new ti("eof"),bracketL:new ti("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new ti("]"),braceL:new ti("{",{beforeExpr:!0,startsExpr:!0}),braceR:new ti("}"),parenL:new ti("(",{beforeExpr:!0,startsExpr:!0}),parenR:new ti(")"),comma:new ti(",",eo),semi:new ti(";",eo),colon:new ti(":",eo),dot:new ti("."),question:new ti("?",eo),questionDot:new ti("?."),arrow:new ti("=>",eo),template:new ti("template"),invalidTemplate:new ti("invalidTemplate"),ellipsis:new ti("...",eo),backQuote:new ti("`",tr),dollarBraceL:new ti("${",{beforeExpr:!0,startsExpr:!0}),eq:new ti("=",{beforeExpr:!0,isAssign:!0}),assign:new ti("_=",{beforeExpr:!0,isAssign:!0}),incDec:new ti("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new ti("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:$r("||",1),logicalAND:$r("&&",2),bitwiseOR:$r("|",3),bitwiseXOR:$r("^",4),bitwiseAND:$r("&",5),equality:$r("==/!=/===/!==",6),relational:$r("</>/<=/>=",7),bitShift:$r("<</>>/>>>",8),plusMin:new ti("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:$r("%",10),star:$r("*",10),slash:$r("/",10),starstar:new ti("**",{beforeExpr:!0}),coalesce:$r("??",1),_break:Yt("break"),_case:Yt("case",eo),_catch:Yt("catch"),_continue:Yt("continue"),_debugger:Yt("debugger"),_default:Yt("default",eo),_do:Yt("do",{isLoop:!0,beforeExpr:!0}),_else:Yt("else",eo),_finally:Yt("finally"),_for:Yt("for",{isLoop:!0}),_function:Yt("function",tr),_if:Yt("if"),_return:Yt("return",eo),_switch:Yt("switch"),_throw:Yt("throw",eo),_try:Yt("try"),_var:Yt("var"),_const:Yt("const"),_while:Yt("while",{isLoop:!0}),_with:Yt("with"),_new:Yt("new",{beforeExpr:!0,startsExpr:!0}),_this:Yt("this",tr),_super:Yt("super",tr),_class:Yt("class",tr),_extends:Yt("extends",eo),_export:Yt("export"),_import:Yt("import",tr),_null:Yt("null",tr),_true:Yt("true",tr),_false:Yt("false",tr),_in:Yt("in",{beforeExpr:!0,binop:7}),_instanceof:Yt("instanceof",{beforeExpr:!0,binop:7}),_typeof:Yt("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:Yt("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:Yt("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},Eo=/\r\n?|\n|\u2028|\u2029/,hK=new RegExp(Eo.source,"g");function rp(n){return n===10||n===13||n===8232||n===8233}function DU(n,e,t){t===void 0&&(t=n.length);for(var i=e;i<t;i++){var s=n.charCodeAt(i);if(rp(s))return i<t-1&&s===13&&n.charCodeAt(i+1)===10?i+2:i+1}return-1}var OU=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,go=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,kU=Object.prototype,uK=kU.hasOwnProperty,dK=kU.toString,gA=Object.hasOwn||function(n,e){return uK.call(n,e)},iD=Array.isArray||function(n){return dK.call(n)==="[object Array]"};function uu(n){return new RegExp("^(?:"+n.replace(/ /g,"|")+")$")}function eh(n){return n<=65535?String.fromCharCode(n):(n-=65536,String.fromCharCode((n>>10)+55296,(n&1023)+56320))}var fK=/(?:[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])/,Lm=function(e,t){this.line=e,this.column=t};Lm.prototype.offset=function(e){return new Lm(this.line,this.column+e)};var S_=function(e,t,i){this.start=t,this.end=i,e.sourceFile!==null&&(this.source=e.sourceFile)};function LU(n,e){for(var t=1,i=0;;){var s=DU(n,i,e);if(s<0)return new Lm(t,e-i);++t,i=s}}var cE={ecmaVersion:null,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:null,allowSuperOutsideMethod:null,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1},nD=!1;function pK(n){var e={};for(var t in cE)e[t]=n&&gA(n,t)?n[t]:cE[t];if(e.ecmaVersion==="latest"?e.ecmaVersion=1e8:e.ecmaVersion==null?(!nD&&typeof console=="object"&&console.warn&&(nD=!0,console.warn(`Since Acorn 8.0.0, options.ecmaVersion is required.
Defaulting to 2020, but this will stop working in the future.`)),e.ecmaVersion=11):e.ecmaVersion>=2015&&(e.ecmaVersion-=2009),e.allowReserved==null&&(e.allowReserved=e.ecmaVersion<5),n.allowHashBang==null&&(e.allowHashBang=e.ecmaVersion>=14),iD(e.onToken)){var i=e.onToken;e.onToken=function(s){return i.push(s)}}return iD(e.onComment)&&(e.onComment=gK(e,e.onComment)),e}function gK(n,e){return function(t,i,s,r,o,a){var l={type:t?"Block":"Line",value:i,start:s,end:r};n.locations&&(l.loc=new S_(this,o,a)),n.ranges&&(l.range=[s,r]),e.push(l)}}var Fm=1,op=2,NT=4,FU=8,UU=16,NU=32,zT=64,zU=128,mA=256,GT=Fm|op|mA;function VT(n,e){return op|(n?NT:0)|(e?FU:0)}var B0=0,HT=1,Fl=2,GU=3,VU=4,HU=5,Xn=function(e,t,i){this.options=e=pK(e),this.sourceFile=e.sourceFile,this.keywords=uu(oK[e.ecmaVersion>=6?6:e.sourceType==="module"?"5module":5]);var s="";e.allowReserved!==!0&&(s=Ww[e.ecmaVersion>=6?6:e.ecmaVersion===5?5:3],e.sourceType==="module"&&(s+=" await")),this.reservedWords=uu(s);var r=(s?s+" ":"")+Ww.strict;this.reservedWordsStrict=uu(r),this.reservedWordsStrictBind=uu(r+" "+Ww.strictBind),this.input=String(t),this.containsEsc=!1,i?(this.pos=i,this.lineStart=this.input.lastIndexOf(`
`,i-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(Eo).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=D.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule=e.sourceType==="module",this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.potentialArrowInForAwait=!1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports=Object.create(null),this.pos===0&&e.allowHashBang&&this.input.slice(0,2)==="#!"&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(Fm),this.regexpState=null,this.privateNameStack=[]},ja={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},canAwait:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0},allowNewDotTarget:{configurable:!0},inClassStaticBlock:{configurable:!0}};Xn.prototype.parse=function(){var e=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(e)};ja.inFunction.get=function(){return(this.currentVarScope().flags&op)>0};ja.inGenerator.get=function(){return(this.currentVarScope().flags&FU)>0&&!this.currentVarScope().inClassFieldInit};ja.inAsync.get=function(){return(this.currentVarScope().flags&NT)>0&&!this.currentVarScope().inClassFieldInit};ja.canAwait.get=function(){for(var n=this.scopeStack.length-1;n>=0;n--){var e=this.scopeStack[n];if(e.inClassFieldInit||e.flags&mA)return!1;if(e.flags&op)return(e.flags&NT)>0}return this.inModule&&this.options.ecmaVersion>=13||this.options.allowAwaitOutsideFunction};ja.allowSuper.get=function(){var n=this.currentThisScope(),e=n.flags,t=n.inClassFieldInit;return(e&zT)>0||t||this.options.allowSuperOutsideMethod};ja.allowDirectSuper.get=function(){return(this.currentThisScope().flags&zU)>0};ja.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())};ja.allowNewDotTarget.get=function(){var n=this.currentThisScope(),e=n.flags,t=n.inClassFieldInit;return(e&(op|mA))>0||t};ja.inClassStaticBlock.get=function(){return(this.currentVarScope().flags&mA)>0};Xn.extend=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];for(var i=this,s=0;s<e.length;s++)i=e[s](i);return i};Xn.parse=function(e,t){return new this(t,e).parse()};Xn.parseExpressionAt=function(e,t,i){var s=new this(i,e,t);return s.nextToken(),s.parseExpression()};Xn.tokenizer=function(e,t){return new this(t,e)};Object.defineProperties(Xn.prototype,ja);var Js=Xn.prototype,mK=/^(?:'((?:\\.|[^'\\])*?)'|"((?:\\.|[^"\\])*?)")/;Js.strictDirective=function(n){if(this.options.ecmaVersion<5)return!1;for(;;){go.lastIndex=n,n+=go.exec(this.input)[0].length;var e=mK.exec(this.input.slice(n));if(!e)return!1;if((e[1]||e[2])==="use strict"){go.lastIndex=n+e[0].length;var t=go.exec(this.input),i=t.index+t[0].length,s=this.input.charAt(i);return s===";"||s==="}"||Eo.test(t[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(s)||s==="!"&&this.input.charAt(i+1)==="=")}n+=e[0].length,go.lastIndex=n,n+=go.exec(this.input)[0].length,this.input[n]===";"&&n++}};Js.eat=function(n){return this.type===n?(this.next(),!0):!1};Js.isContextual=function(n){return this.type===D.name&&this.value===n&&!this.containsEsc};Js.eatContextual=function(n){return this.isContextual(n)?(this.next(),!0):!1};Js.expectContextual=function(n){this.eatContextual(n)||this.unexpected()};Js.canInsertSemicolon=function(){return this.type===D.eof||this.type===D.braceR||Eo.test(this.input.slice(this.lastTokEnd,this.start))};Js.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0};Js.semicolon=function(){!this.eat(D.semi)&&!this.insertSemicolon()&&this.unexpected()};Js.afterTrailingComma=function(n,e){if(this.type===n)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),e||this.next(),!0};Js.expect=function(n){this.eat(n)||this.unexpected()};Js.unexpected=function(n){this.raise(n??this.start,"Unexpected token")};var C_=function(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1};Js.checkPatternErrors=function(n,e){if(n){n.trailingComma>-1&&this.raiseRecoverable(n.trailingComma,"Comma is not permitted after the rest element");var t=e?n.parenthesizedAssign:n.parenthesizedBind;t>-1&&this.raiseRecoverable(t,e?"Assigning to rvalue":"Parenthesized pattern")}};Js.checkExpressionErrors=function(n,e){if(!n)return!1;var t=n.shorthandAssign,i=n.doubleProto;if(!e)return t>=0||i>=0;t>=0&&this.raise(t,"Shorthand property assignments are valid only in destructuring patterns"),i>=0&&this.raiseRecoverable(i,"Redefinition of __proto__ property")};Js.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")};Js.isSimpleAssignTarget=function(n){return n.type==="ParenthesizedExpression"?this.isSimpleAssignTarget(n.expression):n.type==="Identifier"||n.type==="MemberExpression"};var Ct=Xn.prototype;Ct.parseTopLevel=function(n){var e=Object.create(null);for(n.body||(n.body=[]);this.type!==D.eof;){var t=this.parseStatement(null,!0,e);n.body.push(t)}if(this.inModule)for(var i=0,s=Object.keys(this.undefinedExports);i<s.length;i+=1){var r=s[i];this.raiseRecoverable(this.undefinedExports[r].start,"Export '"+r+"' is not defined")}return this.adaptDirectivePrologue(n.body),this.next(),n.sourceType=this.options.sourceType,this.finishNode(n,"Program")};var QT={kind:"loop"},AK={kind:"switch"};Ct.isLet=function(n){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;go.lastIndex=this.pos;var e=go.exec(this.input),t=this.pos+e[0].length,i=this.input.charCodeAt(t);if(i===91||i===92||i>55295&&i<56320)return!0;if(n)return!1;if(i===123)return!0;if(jl(i,!0)){for(var s=t+1;Gf(i=this.input.charCodeAt(s),!0);)++s;if(i===92||i>55295&&i<56320)return!0;var r=this.input.slice(t,s);if(!aK.test(r))return!0}return!1};Ct.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;go.lastIndex=this.pos;var n=go.exec(this.input),e=this.pos+n[0].length,t;return!Eo.test(this.input.slice(this.pos,e))&&this.input.slice(e,e+8)==="function"&&(e+8===this.input.length||!(Gf(t=this.input.charCodeAt(e+8))||t>55295&&t<56320))};Ct.parseStatement=function(n,e,t){var i=this.type,s=this.startNode(),r;switch(this.isLet(n)&&(i=D._var,r="let"),i){case D._break:case D._continue:return this.parseBreakContinueStatement(s,i.keyword);case D._debugger:return this.parseDebuggerStatement(s);case D._do:return this.parseDoStatement(s);case D._for:return this.parseForStatement(s);case D._function:return n&&(this.strict||n!=="if"&&n!=="label")&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(s,!1,!n);case D._class:return n&&this.unexpected(),this.parseClass(s,!0);case D._if:return this.parseIfStatement(s);case D._return:return this.parseReturnStatement(s);case D._switch:return this.parseSwitchStatement(s);case D._throw:return this.parseThrowStatement(s);case D._try:return this.parseTryStatement(s);case D._const:case D._var:return r=r||this.value,n&&r!=="var"&&this.unexpected(),this.parseVarStatement(s,r);case D._while:return this.parseWhileStatement(s);case D._with:return this.parseWithStatement(s);case D.braceL:return this.parseBlock(!0,s);case D.semi:return this.parseEmptyStatement(s);case D._export:case D._import:if(this.options.ecmaVersion>10&&i===D._import){go.lastIndex=this.pos;var o=go.exec(this.input),a=this.pos+o[0].length,l=this.input.charCodeAt(a);if(l===40||l===46)return this.parseExpressionStatement(s,this.parseExpression())}return this.options.allowImportExportEverywhere||(e||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),i===D._import?this.parseImport(s):this.parseExport(s,t);default:if(this.isAsyncFunction())return n&&this.unexpected(),this.next(),this.parseFunctionStatement(s,!0,!n);var c=this.value,u=this.parseExpression();return i===D.name&&u.type==="Identifier"&&this.eat(D.colon)?this.parseLabeledStatement(s,c,u,n):this.parseExpressionStatement(s,u)}};Ct.parseBreakContinueStatement=function(n,e){var t=e==="break";this.next(),this.eat(D.semi)||this.insertSemicolon()?n.label=null:this.type!==D.name?this.unexpected():(n.label=this.parseIdent(),this.semicolon());for(var i=0;i<this.labels.length;++i){var s=this.labels[i];if((n.label==null||s.name===n.label.name)&&(s.kind!=null&&(t||s.kind==="loop")||n.label&&t))break}return i===this.labels.length&&this.raise(n.start,"Unsyntactic "+e),this.finishNode(n,t?"BreakStatement":"ContinueStatement")};Ct.parseDebuggerStatement=function(n){return this.next(),this.semicolon(),this.finishNode(n,"DebuggerStatement")};Ct.parseDoStatement=function(n){return this.next(),this.labels.push(QT),n.body=this.parseStatement("do"),this.labels.pop(),this.expect(D._while),n.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(D.semi):this.semicolon(),this.finishNode(n,"DoWhileStatement")};Ct.parseForStatement=function(n){this.next();var e=this.options.ecmaVersion>=9&&this.canAwait&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(QT),this.enterScope(0),this.expect(D.parenL),this.type===D.semi)return e>-1&&this.unexpected(e),this.parseFor(n,null);var t=this.isLet();if(this.type===D._var||this.type===D._const||t){var i=this.startNode(),s=t?"let":this.value;return this.next(),this.parseVar(i,!0,s),this.finishNode(i,"VariableDeclaration"),(this.type===D._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&i.declarations.length===1?(this.options.ecmaVersion>=9&&(this.type===D._in?e>-1&&this.unexpected(e):n.await=e>-1),this.parseForIn(n,i)):(e>-1&&this.unexpected(e),this.parseFor(n,i))}var r=this.isContextual("let"),o=!1,a=new C_,l=this.parseExpression(e>-1?"await":!0,a);return this.type===D._in||(o=this.options.ecmaVersion>=6&&this.isContextual("of"))?(this.options.ecmaVersion>=9&&(this.type===D._in?e>-1&&this.unexpected(e):n.await=e>-1),r&&o&&this.raise(l.start,"The left-hand side of a for-of loop may not start with 'let'."),this.toAssignable(l,!1,a),this.checkLValPattern(l),this.parseForIn(n,l)):(this.checkExpressionErrors(a,!0),e>-1&&this.unexpected(e),this.parseFor(n,l))};Ct.parseFunctionStatement=function(n,e,t){return this.next(),this.parseFunction(n,Gg|(t?0:hE),!1,e)};Ct.parseIfStatement=function(n){return this.next(),n.test=this.parseParenExpression(),n.consequent=this.parseStatement("if"),n.alternate=this.eat(D._else)?this.parseStatement("if"):null,this.finishNode(n,"IfStatement")};Ct.parseReturnStatement=function(n){return!this.inFunction&&!this.options.allowReturnOutsideFunction&&this.raise(this.start,"'return' outside of function"),this.next(),this.eat(D.semi)||this.insertSemicolon()?n.argument=null:(n.argument=this.parseExpression(),this.semicolon()),this.finishNode(n,"ReturnStatement")};Ct.parseSwitchStatement=function(n){this.next(),n.discriminant=this.parseParenExpression(),n.cases=[],this.expect(D.braceL),this.labels.push(AK),this.enterScope(0);for(var e,t=!1;this.type!==D.braceR;)if(this.type===D._case||this.type===D._default){var i=this.type===D._case;e&&this.finishNode(e,"SwitchCase"),n.cases.push(e=this.startNode()),e.consequent=[],this.next(),i?e.test=this.parseExpression():(t&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),t=!0,e.test=null),this.expect(D.colon)}else e||this.unexpected(),e.consequent.push(this.parseStatement(null));return this.exitScope(),e&&this.finishNode(e,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(n,"SwitchStatement")};Ct.parseThrowStatement=function(n){return this.next(),Eo.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),n.argument=this.parseExpression(),this.semicolon(),this.finishNode(n,"ThrowStatement")};var vK=[];Ct.parseTryStatement=function(n){if(this.next(),n.block=this.parseBlock(),n.handler=null,this.type===D._catch){var e=this.startNode();if(this.next(),this.eat(D.parenL)){e.param=this.parseBindingAtom();var t=e.param.type==="Identifier";this.enterScope(t?NU:0),this.checkLValPattern(e.param,t?VU:Fl),this.expect(D.parenR)}else this.options.ecmaVersion<10&&this.unexpected(),e.param=null,this.enterScope(0);e.body=this.parseBlock(!1),this.exitScope(),n.handler=this.finishNode(e,"CatchClause")}return n.finalizer=this.eat(D._finally)?this.parseBlock():null,!n.handler&&!n.finalizer&&this.raise(n.start,"Missing catch or finally clause"),this.finishNode(n,"TryStatement")};Ct.parseVarStatement=function(n,e){return this.next(),this.parseVar(n,!1,e),this.semicolon(),this.finishNode(n,"VariableDeclaration")};Ct.parseWhileStatement=function(n){return this.next(),n.test=this.parseParenExpression(),this.labels.push(QT),n.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(n,"WhileStatement")};Ct.parseWithStatement=function(n){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),n.object=this.parseParenExpression(),n.body=this.parseStatement("with"),this.finishNode(n,"WithStatement")};Ct.parseEmptyStatement=function(n){return this.next(),this.finishNode(n,"EmptyStatement")};Ct.parseLabeledStatement=function(n,e,t,i){for(var s=0,r=this.labels;s<r.length;s+=1){var o=r[s];o.name===e&&this.raise(t.start,"Label '"+e+"' is already declared")}for(var a=this.type.isLoop?"loop":this.type===D._switch?"switch":null,l=this.labels.length-1;l>=0;l--){var c=this.labels[l];if(c.statementStart===n.start)c.statementStart=this.start,c.kind=a;else break}return this.labels.push({name:e,kind:a,statementStart:this.start}),n.body=this.parseStatement(i?i.indexOf("label")===-1?i+"label":i:"label"),this.labels.pop(),n.label=t,this.finishNode(n,"LabeledStatement")};Ct.parseExpressionStatement=function(n,e){return n.expression=e,this.semicolon(),this.finishNode(n,"ExpressionStatement")};Ct.parseBlock=function(n,e,t){for(n===void 0&&(n=!0),e===void 0&&(e=this.startNode()),e.body=[],this.expect(D.braceL),n&&this.enterScope(0);this.type!==D.braceR;){var i=this.parseStatement(null);e.body.push(i)}return t&&(this.strict=!1),this.next(),n&&this.exitScope(),this.finishNode(e,"BlockStatement")};Ct.parseFor=function(n,e){return n.init=e,this.expect(D.semi),n.test=this.type===D.semi?null:this.parseExpression(),this.expect(D.semi),n.update=this.type===D.parenR?null:this.parseExpression(),this.expect(D.parenR),n.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(n,"ForStatement")};Ct.parseForIn=function(n,e){var t=this.type===D._in;return this.next(),e.type==="VariableDeclaration"&&e.declarations[0].init!=null&&(!t||this.options.ecmaVersion<8||this.strict||e.kind!=="var"||e.declarations[0].id.type!=="Identifier")&&this.raise(e.start,(t?"for-in":"for-of")+" loop variable declaration may not have an initializer"),n.left=e,n.right=t?this.parseExpression():this.parseMaybeAssign(),this.expect(D.parenR),n.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(n,t?"ForInStatement":"ForOfStatement")};Ct.parseVar=function(n,e,t){for(n.declarations=[],n.kind=t;;){var i=this.startNode();if(this.parseVarId(i,t),this.eat(D.eq)?i.init=this.parseMaybeAssign(e):t==="const"&&!(this.type===D._in||this.options.ecmaVersion>=6&&this.isContextual("of"))?this.unexpected():i.id.type!=="Identifier"&&!(e&&(this.type===D._in||this.isContextual("of")))?this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):i.init=null,n.declarations.push(this.finishNode(i,"VariableDeclarator")),!this.eat(D.comma))break}return n};Ct.parseVarId=function(n,e){n.id=this.parseBindingAtom(),this.checkLValPattern(n.id,e==="var"?HT:Fl,!1)};var Gg=1,hE=2,QU=4;Ct.parseFunction=function(n,e,t,i,s){this.initFunction(n),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!i)&&(this.type===D.star&&e&hE&&this.unexpected(),n.generator=this.eat(D.star)),this.options.ecmaVersion>=8&&(n.async=!!i),e&Gg&&(n.id=e&QU&&this.type!==D.name?null:this.parseIdent(),n.id&&!(e&hE)&&this.checkLValSimple(n.id,this.strict||n.generator||n.async?this.treatFunctionsAsVar?HT:Fl:GU));var r=this.yieldPos,o=this.awaitPos,a=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(VT(n.async,n.generator)),e&Gg||(n.id=this.type===D.name?this.parseIdent():null),this.parseFunctionParams(n),this.parseFunctionBody(n,t,!1,s),this.yieldPos=r,this.awaitPos=o,this.awaitIdentPos=a,this.finishNode(n,e&Gg?"FunctionDeclaration":"FunctionExpression")};Ct.parseFunctionParams=function(n){this.expect(D.parenL),n.params=this.parseBindingList(D.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()};Ct.parseClass=function(n,e){this.next();var t=this.strict;this.strict=!0,this.parseClassId(n,e),this.parseClassSuper(n);var i=this.enterClassBody(),s=this.startNode(),r=!1;for(s.body=[],this.expect(D.braceL);this.type!==D.braceR;){var o=this.parseClassElement(n.superClass!==null);o&&(s.body.push(o),o.type==="MethodDefinition"&&o.kind==="constructor"?(r&&this.raise(o.start,"Duplicate constructor in the same class"),r=!0):o.key&&o.key.type==="PrivateIdentifier"&&yK(i,o)&&this.raiseRecoverable(o.key.start,"Identifier '#"+o.key.name+"' has already been declared"))}return this.strict=t,this.next(),n.body=this.finishNode(s,"ClassBody"),this.exitClassBody(),this.finishNode(n,e?"ClassDeclaration":"ClassExpression")};Ct.parseClassElement=function(n){if(this.eat(D.semi))return null;var e=this.options.ecmaVersion,t=this.startNode(),i="",s=!1,r=!1,o="method",a=!1;if(this.eatContextual("static")){if(e>=13&&this.eat(D.braceL))return this.parseClassStaticBlock(t),t;this.isClassElementNameStart()||this.type===D.star?a=!0:i="static"}if(t.static=a,!i&&e>=8&&this.eatContextual("async")&&((this.isClassElementNameStart()||this.type===D.star)&&!this.canInsertSemicolon()?r=!0:i="async"),!i&&(e>=9||!r)&&this.eat(D.star)&&(s=!0),!i&&!r&&!s){var l=this.value;(this.eatContextual("get")||this.eatContextual("set"))&&(this.isClassElementNameStart()?o=l:i=l)}if(i?(t.computed=!1,t.key=this.startNodeAt(this.lastTokStart,this.lastTokStartLoc),t.key.name=i,this.finishNode(t.key,"Identifier")):this.parseClassElementName(t),e<13||this.type===D.parenL||o!=="method"||s||r){var c=!t.static&&D0(t,"constructor"),u=c&&n;c&&o!=="method"&&this.raise(t.key.start,"Constructor can't have get/set modifier"),t.kind=c?"constructor":o,this.parseClassMethod(t,s,r,u)}else this.parseClassField(t);return t};Ct.isClassElementNameStart=function(){return this.type===D.name||this.type===D.privateId||this.type===D.num||this.type===D.string||this.type===D.bracketL||this.type.keyword};Ct.parseClassElementName=function(n){this.type===D.privateId?(this.value==="constructor"&&this.raise(this.start,"Classes can't have an element named '#constructor'"),n.computed=!1,n.key=this.parsePrivateIdent()):this.parsePropertyName(n)};Ct.parseClassMethod=function(n,e,t,i){var s=n.key;n.kind==="constructor"?(e&&this.raise(s.start,"Constructor can't be a generator"),t&&this.raise(s.start,"Constructor can't be an async method")):n.static&&D0(n,"prototype")&&this.raise(s.start,"Classes may not have a static property named prototype");var r=n.value=this.parseMethod(e,t,i);return n.kind==="get"&&r.params.length!==0&&this.raiseRecoverable(r.start,"getter should have no params"),n.kind==="set"&&r.params.length!==1&&this.raiseRecoverable(r.start,"setter should have exactly one param"),n.kind==="set"&&r.params[0].type==="RestElement"&&this.raiseRecoverable(r.params[0].start,"Setter cannot use rest params"),this.finishNode(n,"MethodDefinition")};Ct.parseClassField=function(n){if(D0(n,"constructor")?this.raise(n.key.start,"Classes can't have a field named 'constructor'"):n.static&&D0(n,"prototype")&&this.raise(n.key.start,"Classes can't have a static field named 'prototype'"),this.eat(D.eq)){var e=this.currentThisScope(),t=e.inClassFieldInit;e.inClassFieldInit=!0,n.value=this.parseMaybeAssign(),e.inClassFieldInit=t}else n.value=null;return this.semicolon(),this.finishNode(n,"PropertyDefinition")};Ct.parseClassStaticBlock=function(n){n.body=[];var e=this.labels;for(this.labels=[],this.enterScope(mA|zT);this.type!==D.braceR;){var t=this.parseStatement(null);n.body.push(t)}return this.next(),this.exitScope(),this.labels=e,this.finishNode(n,"StaticBlock")};Ct.parseClassId=function(n,e){this.type===D.name?(n.id=this.parseIdent(),e&&this.checkLValSimple(n.id,Fl,!1)):(e===!0&&this.unexpected(),n.id=null)};Ct.parseClassSuper=function(n){n.superClass=this.eat(D._extends)?this.parseExprSubscripts(!1):null};Ct.enterClassBody=function(){var n={declared:Object.create(null),used:[]};return this.privateNameStack.push(n),n.declared};Ct.exitClassBody=function(){for(var n=this.privateNameStack.pop(),e=n.declared,t=n.used,i=this.privateNameStack.length,s=i===0?null:this.privateNameStack[i-1],r=0;r<t.length;++r){var o=t[r];gA(e,o.name)||(s?s.used.push(o):this.raiseRecoverable(o.start,"Private field '#"+o.name+"' must be declared in an enclosing class"))}};function yK(n,e){var t=e.key.name,i=n[t],s="true";return e.type==="MethodDefinition"&&(e.kind==="get"||e.kind==="set")&&(s=(e.static?"s":"i")+e.kind),i==="iget"&&s==="iset"||i==="iset"&&s==="iget"||i==="sget"&&s==="sset"||i==="sset"&&s==="sget"?(n[t]="true",!1):i?!0:(n[t]=s,!1)}function D0(n,e){var t=n.computed,i=n.key;return!t&&(i.type==="Identifier"&&i.name===e||i.type==="Literal"&&i.value===e)}Ct.parseExport=function(n,e){if(this.next(),this.eat(D.star))return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(n.exported=this.parseModuleExportName(),this.checkExport(e,n.exported,this.lastTokStart)):n.exported=null),this.expectContextual("from"),this.type!==D.string&&this.unexpected(),n.source=this.parseExprAtom(),this.semicolon(),this.finishNode(n,"ExportAllDeclaration");if(this.eat(D._default)){this.checkExport(e,"default",this.lastTokStart);var t;if(this.type===D._function||(t=this.isAsyncFunction())){var i=this.startNode();this.next(),t&&this.next(),n.declaration=this.parseFunction(i,Gg|QU,!1,t)}else if(this.type===D._class){var s=this.startNode();n.declaration=this.parseClass(s,"nullableID")}else n.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(n,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())n.declaration=this.parseStatement(null),n.declaration.type==="VariableDeclaration"?this.checkVariableExport(e,n.declaration.declarations):this.checkExport(e,n.declaration.id,n.declaration.id.start),n.specifiers=[],n.source=null;else{if(n.declaration=null,n.specifiers=this.parseExportSpecifiers(e),this.eatContextual("from"))this.type!==D.string&&this.unexpected(),n.source=this.parseExprAtom();else{for(var r=0,o=n.specifiers;r<o.length;r+=1){var a=o[r];this.checkUnreserved(a.local),this.checkLocalExport(a.local),a.local.type==="Literal"&&this.raise(a.local.start,"A string literal cannot be used as an exported binding without `from`.")}n.source=null}this.semicolon()}return this.finishNode(n,"ExportNamedDeclaration")};Ct.checkExport=function(n,e,t){n&&(typeof e!="string"&&(e=e.type==="Identifier"?e.name:e.value),gA(n,e)&&this.raiseRecoverable(t,"Duplicate export '"+e+"'"),n[e]=!0)};Ct.checkPatternExport=function(n,e){var t=e.type;if(t==="Identifier")this.checkExport(n,e,e.start);else if(t==="ObjectPattern")for(var i=0,s=e.properties;i<s.length;i+=1){var r=s[i];this.checkPatternExport(n,r)}else if(t==="ArrayPattern")for(var o=0,a=e.elements;o<a.length;o+=1){var l=a[o];l&&this.checkPatternExport(n,l)}else t==="Property"?this.checkPatternExport(n,e.value):t==="AssignmentPattern"?this.checkPatternExport(n,e.left):t==="RestElement"?this.checkPatternExport(n,e.argument):t==="ParenthesizedExpression"&&this.checkPatternExport(n,e.expression)};Ct.checkVariableExport=function(n,e){if(n)for(var t=0,i=e;t<i.length;t+=1){var s=i[t];this.checkPatternExport(n,s.id)}};Ct.shouldParseExportStatement=function(){return this.type.keyword==="var"||this.type.keyword==="const"||this.type.keyword==="class"||this.type.keyword==="function"||this.isLet()||this.isAsyncFunction()};Ct.parseExportSpecifiers=function(n){var e=[],t=!0;for(this.expect(D.braceL);!this.eat(D.braceR);){if(t)t=!1;else if(this.expect(D.comma),this.afterTrailingComma(D.braceR))break;var i=this.startNode();i.local=this.parseModuleExportName(),i.exported=this.eatContextual("as")?this.parseModuleExportName():i.local,this.checkExport(n,i.exported,i.exported.start),e.push(this.finishNode(i,"ExportSpecifier"))}return e};Ct.parseImport=function(n){return this.next(),this.type===D.string?(n.specifiers=vK,n.source=this.parseExprAtom()):(n.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),n.source=this.type===D.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(n,"ImportDeclaration")};Ct.parseImportSpecifiers=function(){var n=[],e=!0;if(this.type===D.name){var t=this.startNode();if(t.local=this.parseIdent(),this.checkLValSimple(t.local,Fl),n.push(this.finishNode(t,"ImportDefaultSpecifier")),!this.eat(D.comma))return n}if(this.type===D.star){var i=this.startNode();return this.next(),this.expectContextual("as"),i.local=this.parseIdent(),this.checkLValSimple(i.local,Fl),n.push(this.finishNode(i,"ImportNamespaceSpecifier")),n}for(this.expect(D.braceL);!this.eat(D.braceR);){if(e)e=!1;else if(this.expect(D.comma),this.afterTrailingComma(D.braceR))break;var s=this.startNode();s.imported=this.parseModuleExportName(),this.eatContextual("as")?s.local=this.parseIdent():(this.checkUnreserved(s.imported),s.local=s.imported),this.checkLValSimple(s.local,Fl),n.push(this.finishNode(s,"ImportSpecifier"))}return n};Ct.parseModuleExportName=function(){if(this.options.ecmaVersion>=13&&this.type===D.string){var n=this.parseLiteral(this.value);return fK.test(n.value)&&this.raise(n.start,"An export name cannot include a lone surrogate."),n}return this.parseIdent(!0)};Ct.adaptDirectivePrologue=function(n){for(var e=0;e<n.length&&this.isDirectiveCandidate(n[e]);++e)n[e].directive=n[e].expression.raw.slice(1,-1)};Ct.isDirectiveCandidate=function(n){return this.options.ecmaVersion>=5&&n.type==="ExpressionStatement"&&n.expression.type==="Literal"&&typeof n.expression.value=="string"&&(this.input[n.start]==='"'||this.input[n.start]==="'")};var ea=Xn.prototype;ea.toAssignable=function(n,e,t){if(this.options.ecmaVersion>=6&&n)switch(n.type){case"Identifier":this.inAsync&&n.name==="await"&&this.raise(n.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"AssignmentPattern":case"RestElement":break;case"ObjectExpression":n.type="ObjectPattern",t&&this.checkPatternErrors(t,!0);for(var i=0,s=n.properties;i<s.length;i+=1){var r=s[i];this.toAssignable(r,e),r.type==="RestElement"&&(r.argument.type==="ArrayPattern"||r.argument.type==="ObjectPattern")&&this.raise(r.argument.start,"Unexpected token")}break;case"Property":n.kind!=="init"&&this.raise(n.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(n.value,e);break;case"ArrayExpression":n.type="ArrayPattern",t&&this.checkPatternErrors(t,!0),this.toAssignableList(n.elements,e);break;case"SpreadElement":n.type="RestElement",this.toAssignable(n.argument,e),n.argument.type==="AssignmentPattern"&&this.raise(n.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":n.operator!=="="&&this.raise(n.left.end,"Only '=' operator can be used for specifying default value."),n.type="AssignmentPattern",delete n.operator,this.toAssignable(n.left,e);break;case"ParenthesizedExpression":this.toAssignable(n.expression,e,t);break;case"ChainExpression":this.raiseRecoverable(n.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!e)break;default:this.raise(n.start,"Assigning to rvalue")}else t&&this.checkPatternErrors(t,!0);return n};ea.toAssignableList=function(n,e){for(var t=n.length,i=0;i<t;i++){var s=n[i];s&&this.toAssignable(s,e)}if(t){var r=n[t-1];this.options.ecmaVersion===6&&e&&r&&r.type==="RestElement"&&r.argument.type!=="Identifier"&&this.unexpected(r.argument.start)}return n};ea.parseSpread=function(n){var e=this.startNode();return this.next(),e.argument=this.parseMaybeAssign(!1,n),this.finishNode(e,"SpreadElement")};ea.parseRestBinding=function(){var n=this.startNode();return this.next(),this.options.ecmaVersion===6&&this.type!==D.name&&this.unexpected(),n.argument=this.parseBindingAtom(),this.finishNode(n,"RestElement")};ea.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case D.bracketL:var n=this.startNode();return this.next(),n.elements=this.parseBindingList(D.bracketR,!0,!0),this.finishNode(n,"ArrayPattern");case D.braceL:return this.parseObj(!0)}return this.parseIdent()};ea.parseBindingList=function(n,e,t){for(var i=[],s=!0;!this.eat(n);)if(s?s=!1:this.expect(D.comma),e&&this.type===D.comma)i.push(null);else{if(t&&this.afterTrailingComma(n))break;if(this.type===D.ellipsis){var r=this.parseRestBinding();this.parseBindingListItem(r),i.push(r),this.type===D.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(n);break}else{var o=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(o),i.push(o)}}return i};ea.parseBindingListItem=function(n){return n};ea.parseMaybeDefault=function(n,e,t){if(t=t||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(D.eq))return t;var i=this.startNodeAt(n,e);return i.left=t,i.right=this.parseMaybeAssign(),this.finishNode(i,"AssignmentPattern")};ea.checkLValSimple=function(n,e,t){e===void 0&&(e=B0);var i=e!==B0;switch(n.type){case"Identifier":this.strict&&this.reservedWordsStrictBind.test(n.name)&&this.raiseRecoverable(n.start,(i?"Binding ":"Assigning to ")+n.name+" in strict mode"),i&&(e===Fl&&n.name==="let"&&this.raiseRecoverable(n.start,"let is disallowed as a lexically bound name"),t&&(gA(t,n.name)&&this.raiseRecoverable(n.start,"Argument name clash"),t[n.name]=!0),e!==HU&&this.declareName(n.name,e,n.start));break;case"ChainExpression":this.raiseRecoverable(n.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":i&&this.raiseRecoverable(n.start,"Binding member expression");break;case"ParenthesizedExpression":return i&&this.raiseRecoverable(n.start,"Binding parenthesized expression"),this.checkLValSimple(n.expression,e,t);default:this.raise(n.start,(i?"Binding":"Assigning to")+" rvalue")}};ea.checkLValPattern=function(n,e,t){switch(e===void 0&&(e=B0),n.type){case"ObjectPattern":for(var i=0,s=n.properties;i<s.length;i+=1){var r=s[i];this.checkLValInnerPattern(r,e,t)}break;case"ArrayPattern":for(var o=0,a=n.elements;o<a.length;o+=1){var l=a[o];l&&this.checkLValInnerPattern(l,e,t)}break;default:this.checkLValSimple(n,e,t)}};ea.checkLValInnerPattern=function(n,e,t){switch(e===void 0&&(e=B0),n.type){case"Property":this.checkLValInnerPattern(n.value,e,t);break;case"AssignmentPattern":this.checkLValPattern(n.left,e,t);break;case"RestElement":this.checkLValPattern(n.argument,e,t);break;default:this.checkLValPattern(n,e,t)}};var Lo=function(e,t,i,s,r){this.token=e,this.isExpr=!!t,this.preserveSpace=!!i,this.override=s,this.generator=!!r},zi={b_stat:new Lo("{",!1),b_expr:new Lo("{",!0),b_tmpl:new Lo("${",!1),p_stat:new Lo("(",!1),p_expr:new Lo("(",!0),q_tmpl:new Lo("`",!0,!0,function(n){return n.tryReadTemplateToken()}),f_stat:new Lo("function",!1),f_expr:new Lo("function",!0),f_expr_gen:new Lo("function",!0,!1,null,!0),f_gen:new Lo("function",!1,!1,null,!0)},ap=Xn.prototype;ap.initialContext=function(){return[zi.b_stat]};ap.curContext=function(){return this.context[this.context.length-1]};ap.braceIsBlock=function(n){var e=this.curContext();return e===zi.f_expr||e===zi.f_stat?!0:n===D.colon&&(e===zi.b_stat||e===zi.b_expr)?!e.isExpr:n===D._return||n===D.name&&this.exprAllowed?Eo.test(this.input.slice(this.lastTokEnd,this.start)):n===D._else||n===D.semi||n===D.eof||n===D.parenR||n===D.arrow?!0:n===D.braceL?e===zi.b_stat:n===D._var||n===D._const||n===D.name?!1:!this.exprAllowed};ap.inGeneratorContext=function(){for(var n=this.context.length-1;n>=1;n--){var e=this.context[n];if(e.token==="function")return e.generator}return!1};ap.updateContext=function(n){var e,t=this.type;t.keyword&&n===D.dot?this.exprAllowed=!1:(e=t.updateContext)?e.call(this,n):this.exprAllowed=t.beforeExpr};ap.overrideContext=function(n){this.curContext()!==n&&(this.context[this.context.length-1]=n)};D.parenR.updateContext=D.braceR.updateContext=function(){if(this.context.length===1){this.exprAllowed=!0;return}var n=this.context.pop();n===zi.b_stat&&this.curContext().token==="function"&&(n=this.context.pop()),this.exprAllowed=!n.isExpr};D.braceL.updateContext=function(n){this.context.push(this.braceIsBlock(n)?zi.b_stat:zi.b_expr),this.exprAllowed=!0};D.dollarBraceL.updateContext=function(){this.context.push(zi.b_tmpl),this.exprAllowed=!0};D.parenL.updateContext=function(n){var e=n===D._if||n===D._for||n===D._with||n===D._while;this.context.push(e?zi.p_stat:zi.p_expr),this.exprAllowed=!0};D.incDec.updateContext=function(){};D._function.updateContext=D._class.updateContext=function(n){n.beforeExpr&&n!==D._else&&!(n===D.semi&&this.curContext()!==zi.p_stat)&&!(n===D._return&&Eo.test(this.input.slice(this.lastTokEnd,this.start)))&&!((n===D.colon||n===D.braceL)&&this.curContext()===zi.b_stat)?this.context.push(zi.f_expr):this.context.push(zi.f_stat),this.exprAllowed=!1};D.backQuote.updateContext=function(){this.curContext()===zi.q_tmpl?this.context.pop():this.context.push(zi.q_tmpl),this.exprAllowed=!1};D.star.updateContext=function(n){if(n===D._function){var e=this.context.length-1;this.context[e]===zi.f_expr?this.context[e]=zi.f_expr_gen:this.context[e]=zi.f_gen}this.exprAllowed=!0};D.name.updateContext=function(n){var e=!1;this.options.ecmaVersion>=6&&n!==D.dot&&(this.value==="of"&&!this.exprAllowed||this.value==="yield"&&this.inGeneratorContext())&&(e=!0),this.exprAllowed=e};var Nt=Xn.prototype;Nt.checkPropClash=function(n,e,t){if(!(this.options.ecmaVersion>=9&&n.type==="SpreadElement")&&!(this.options.ecmaVersion>=6&&(n.computed||n.method||n.shorthand))){var i=n.key,s;switch(i.type){case"Identifier":s=i.name;break;case"Literal":s=String(i.value);break;default:return}var r=n.kind;if(this.options.ecmaVersion>=6){s==="__proto__"&&r==="init"&&(e.proto&&(t?t.doubleProto<0&&(t.doubleProto=i.start):this.raiseRecoverable(i.start,"Redefinition of __proto__ property")),e.proto=!0);return}s="$"+s;var o=e[s];if(o){var a;r==="init"?a=this.strict&&o.init||o.get||o.set:a=o.init||o[r],a&&this.raiseRecoverable(i.start,"Redefinition of property")}else o=e[s]={init:!1,get:!1,set:!1};o[r]=!0}};Nt.parseExpression=function(n,e){var t=this.start,i=this.startLoc,s=this.parseMaybeAssign(n,e);if(this.type===D.comma){var r=this.startNodeAt(t,i);for(r.expressions=[s];this.eat(D.comma);)r.expressions.push(this.parseMaybeAssign(n,e));return this.finishNode(r,"SequenceExpression")}return s};Nt.parseMaybeAssign=function(n,e,t){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(n);this.exprAllowed=!1}var i=!1,s=-1,r=-1,o=-1;e?(s=e.parenthesizedAssign,r=e.trailingComma,o=e.doubleProto,e.parenthesizedAssign=e.trailingComma=-1):(e=new C_,i=!0);var a=this.start,l=this.startLoc;(this.type===D.parenL||this.type===D.name)&&(this.potentialArrowAt=this.start,this.potentialArrowInForAwait=n==="await");var c=this.parseMaybeConditional(n,e);if(t&&(c=t.call(this,c,a,l)),this.type.isAssign){var u=this.startNodeAt(a,l);return u.operator=this.value,this.type===D.eq&&(c=this.toAssignable(c,!1,e)),i||(e.parenthesizedAssign=e.trailingComma=e.doubleProto=-1),e.shorthandAssign>=c.start&&(e.shorthandAssign=-1),this.type===D.eq?this.checkLValPattern(c):this.checkLValSimple(c),u.left=c,this.next(),u.right=this.parseMaybeAssign(n),o>-1&&(e.doubleProto=o),this.finishNode(u,"AssignmentExpression")}else i&&this.checkExpressionErrors(e,!0);return s>-1&&(e.parenthesizedAssign=s),r>-1&&(e.trailingComma=r),c};Nt.parseMaybeConditional=function(n,e){var t=this.start,i=this.startLoc,s=this.parseExprOps(n,e);if(this.checkExpressionErrors(e))return s;if(this.eat(D.question)){var r=this.startNodeAt(t,i);return r.test=s,r.consequent=this.parseMaybeAssign(),this.expect(D.colon),r.alternate=this.parseMaybeAssign(n),this.finishNode(r,"ConditionalExpression")}return s};Nt.parseExprOps=function(n,e){var t=this.start,i=this.startLoc,s=this.parseMaybeUnary(e,!1,!1,n);return this.checkExpressionErrors(e)||s.start===t&&s.type==="ArrowFunctionExpression"?s:this.parseExprOp(s,t,i,-1,n)};Nt.parseExprOp=function(n,e,t,i,s){var r=this.type.binop;if(r!=null&&(!s||this.type!==D._in)&&r>i){var o=this.type===D.logicalOR||this.type===D.logicalAND,a=this.type===D.coalesce;a&&(r=D.logicalAND.binop);var l=this.value;this.next();var c=this.start,u=this.startLoc,d=this.parseExprOp(this.parseMaybeUnary(null,!1,!1,s),c,u,r,s),f=this.buildBinary(e,t,n,d,l,o||a);return(o&&this.type===D.coalesce||a&&(this.type===D.logicalOR||this.type===D.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(f,e,t,i,s)}return n};Nt.buildBinary=function(n,e,t,i,s,r){i.type==="PrivateIdentifier"&&this.raise(i.start,"Private identifier can only be left side of binary expression");var o=this.startNodeAt(n,e);return o.left=t,o.operator=s,o.right=i,this.finishNode(o,r?"LogicalExpression":"BinaryExpression")};Nt.parseMaybeUnary=function(n,e,t,i){var s=this.start,r=this.startLoc,o;if(this.isContextual("await")&&this.canAwait)o=this.parseAwait(i),e=!0;else if(this.type.prefix){var a=this.startNode(),l=this.type===D.incDec;a.operator=this.value,a.prefix=!0,this.next(),a.argument=this.parseMaybeUnary(null,!0,l,i),this.checkExpressionErrors(n,!0),l?this.checkLValSimple(a.argument):this.strict&&a.operator==="delete"&&a.argument.type==="Identifier"?this.raiseRecoverable(a.start,"Deleting local variable in strict mode"):a.operator==="delete"&&WU(a.argument)?this.raiseRecoverable(a.start,"Private fields can not be deleted"):e=!0,o=this.finishNode(a,l?"UpdateExpression":"UnaryExpression")}else if(!e&&this.type===D.privateId)(i||this.privateNameStack.length===0)&&this.unexpected(),o=this.parsePrivateIdent(),this.type!==D._in&&this.unexpected();else{if(o=this.parseExprSubscripts(n,i),this.checkExpressionErrors(n))return o;for(;this.type.postfix&&!this.canInsertSemicolon();){var c=this.startNodeAt(s,r);c.operator=this.value,c.prefix=!1,c.argument=o,this.checkLValSimple(o),this.next(),o=this.finishNode(c,"UpdateExpression")}}if(!t&&this.eat(D.starstar))if(e)this.unexpected(this.lastTokStart);else return this.buildBinary(s,r,o,this.parseMaybeUnary(null,!1,!1,i),"**",!1);else return o};function WU(n){return n.type==="MemberExpression"&&n.property.type==="PrivateIdentifier"||n.type==="ChainExpression"&&WU(n.expression)}Nt.parseExprSubscripts=function(n,e){var t=this.start,i=this.startLoc,s=this.parseExprAtom(n,e);if(s.type==="ArrowFunctionExpression"&&this.input.slice(this.lastTokStart,this.lastTokEnd)!==")")return s;var r=this.parseSubscripts(s,t,i,!1,e);return n&&r.type==="MemberExpression"&&(n.parenthesizedAssign>=r.start&&(n.parenthesizedAssign=-1),n.parenthesizedBind>=r.start&&(n.parenthesizedBind=-1),n.trailingComma>=r.start&&(n.trailingComma=-1)),r};Nt.parseSubscripts=function(n,e,t,i,s){for(var r=this.options.ecmaVersion>=8&&n.type==="Identifier"&&n.name==="async"&&this.lastTokEnd===n.end&&!this.canInsertSemicolon()&&n.end-n.start===5&&this.potentialArrowAt===n.start,o=!1;;){var a=this.parseSubscript(n,e,t,i,r,o,s);if(a.optional&&(o=!0),a===n||a.type==="ArrowFunctionExpression"){if(o){var l=this.startNodeAt(e,t);l.expression=a,a=this.finishNode(l,"ChainExpression")}return a}n=a}};Nt.parseSubscript=function(n,e,t,i,s,r,o){var a=this.options.ecmaVersion>=11,l=a&&this.eat(D.questionDot);i&&l&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var c=this.eat(D.bracketL);if(c||l&&this.type!==D.parenL&&this.type!==D.backQuote||this.eat(D.dot)){var u=this.startNodeAt(e,t);u.object=n,c?(u.property=this.parseExpression(),this.expect(D.bracketR)):this.type===D.privateId&&n.type!=="Super"?u.property=this.parsePrivateIdent():u.property=this.parseIdent(this.options.allowReserved!=="never"),u.computed=!!c,a&&(u.optional=l),n=this.finishNode(u,"MemberExpression")}else if(!i&&this.eat(D.parenL)){var d=new C_,f=this.yieldPos,p=this.awaitPos,g=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var A=this.parseExprList(D.parenR,this.options.ecmaVersion>=8,!1,d);if(s&&!l&&!this.canInsertSemicolon()&&this.eat(D.arrow))return this.checkPatternErrors(d,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=f,this.awaitPos=p,this.awaitIdentPos=g,this.parseArrowExpression(this.startNodeAt(e,t),A,!0,o);this.checkExpressionErrors(d,!0),this.yieldPos=f||this.yieldPos,this.awaitPos=p||this.awaitPos,this.awaitIdentPos=g||this.awaitIdentPos;var v=this.startNodeAt(e,t);v.callee=n,v.arguments=A,a&&(v.optional=l),n=this.finishNode(v,"CallExpression")}else if(this.type===D.backQuote){(l||r)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var m=this.startNodeAt(e,t);m.tag=n,m.quasi=this.parseTemplate({isTagged:!0}),n=this.finishNode(m,"TaggedTemplateExpression")}return n};Nt.parseExprAtom=function(n,e){this.type===D.slash&&this.readRegexp();var t,i=this.potentialArrowAt===this.start;switch(this.type){case D._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),t=this.startNode(),this.next(),this.type===D.parenL&&!this.allowDirectSuper&&this.raise(t.start,"super() call outside constructor of a subclass"),this.type!==D.dot&&this.type!==D.bracketL&&this.type!==D.parenL&&this.unexpected(),this.finishNode(t,"Super");case D._this:return t=this.startNode(),this.next(),this.finishNode(t,"ThisExpression");case D.name:var s=this.start,r=this.startLoc,o=this.containsEsc,a=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!o&&a.name==="async"&&!this.canInsertSemicolon()&&this.eat(D._function))return this.overrideContext(zi.f_expr),this.parseFunction(this.startNodeAt(s,r),0,!1,!0,e);if(i&&!this.canInsertSemicolon()){if(this.eat(D.arrow))return this.parseArrowExpression(this.startNodeAt(s,r),[a],!1,e);if(this.options.ecmaVersion>=8&&a.name==="async"&&this.type===D.name&&!o&&(!this.potentialArrowInForAwait||this.value!=="of"||this.containsEsc))return a=this.parseIdent(!1),(this.canInsertSemicolon()||!this.eat(D.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(s,r),[a],!0,e)}return a;case D.regexp:var l=this.value;return t=this.parseLiteral(l.value),t.regex={pattern:l.pattern,flags:l.flags},t;case D.num:case D.string:return this.parseLiteral(this.value);case D._null:case D._true:case D._false:return t=this.startNode(),t.value=this.type===D._null?null:this.type===D._true,t.raw=this.type.keyword,this.next(),this.finishNode(t,"Literal");case D.parenL:var c=this.start,u=this.parseParenAndDistinguishExpression(i,e);return n&&(n.parenthesizedAssign<0&&!this.isSimpleAssignTarget(u)&&(n.parenthesizedAssign=c),n.parenthesizedBind<0&&(n.parenthesizedBind=c)),u;case D.bracketL:return t=this.startNode(),this.next(),t.elements=this.parseExprList(D.bracketR,!0,!0,n),this.finishNode(t,"ArrayExpression");case D.braceL:return this.overrideContext(zi.b_expr),this.parseObj(!1,n);case D._function:return t=this.startNode(),this.next(),this.parseFunction(t,0);case D._class:return this.parseClass(this.startNode(),!1);case D._new:return this.parseNew();case D.backQuote:return this.parseTemplate();case D._import:return this.options.ecmaVersion>=11?this.parseExprImport():this.unexpected();default:this.unexpected()}};Nt.parseExprImport=function(){var n=this.startNode();this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import");var e=this.parseIdent(!0);switch(this.type){case D.parenL:return this.parseDynamicImport(n);case D.dot:return n.meta=e,this.parseImportMeta(n);default:this.unexpected()}};Nt.parseDynamicImport=function(n){if(this.next(),n.source=this.parseMaybeAssign(),!this.eat(D.parenR)){var e=this.start;this.eat(D.comma)&&this.eat(D.parenR)?this.raiseRecoverable(e,"Trailing comma is not allowed in import()"):this.unexpected(e)}return this.finishNode(n,"ImportExpression")};Nt.parseImportMeta=function(n){this.next();var e=this.containsEsc;return n.property=this.parseIdent(!0),n.property.name!=="meta"&&this.raiseRecoverable(n.property.start,"The only valid meta property for import is 'import.meta'"),e&&this.raiseRecoverable(n.start,"'import.meta' must not contain escaped characters"),this.options.sourceType!=="module"&&!this.options.allowImportExportEverywhere&&this.raiseRecoverable(n.start,"Cannot use 'import.meta' outside a module"),this.finishNode(n,"MetaProperty")};Nt.parseLiteral=function(n){var e=this.startNode();return e.value=n,e.raw=this.input.slice(this.start,this.end),e.raw.charCodeAt(e.raw.length-1)===110&&(e.bigint=e.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(e,"Literal")};Nt.parseParenExpression=function(){this.expect(D.parenL);var n=this.parseExpression();return this.expect(D.parenR),n};Nt.parseParenAndDistinguishExpression=function(n,e){var t=this.start,i=this.startLoc,s,r=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var o=this.start,a=this.startLoc,l=[],c=!0,u=!1,d=new C_,f=this.yieldPos,p=this.awaitPos,g;for(this.yieldPos=0,this.awaitPos=0;this.type!==D.parenR;)if(c?c=!1:this.expect(D.comma),r&&this.afterTrailingComma(D.parenR,!0)){u=!0;break}else if(this.type===D.ellipsis){g=this.start,l.push(this.parseParenItem(this.parseRestBinding())),this.type===D.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}else l.push(this.parseMaybeAssign(!1,d,this.parseParenItem));var A=this.lastTokEnd,v=this.lastTokEndLoc;if(this.expect(D.parenR),n&&!this.canInsertSemicolon()&&this.eat(D.arrow))return this.checkPatternErrors(d,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=f,this.awaitPos=p,this.parseParenArrowList(t,i,l,e);(!l.length||u)&&this.unexpected(this.lastTokStart),g&&this.unexpected(g),this.checkExpressionErrors(d,!0),this.yieldPos=f||this.yieldPos,this.awaitPos=p||this.awaitPos,l.length>1?(s=this.startNodeAt(o,a),s.expressions=l,this.finishNodeAt(s,"SequenceExpression",A,v)):s=l[0]}else s=this.parseParenExpression();if(this.options.preserveParens){var m=this.startNodeAt(t,i);return m.expression=s,this.finishNode(m,"ParenthesizedExpression")}else return s};Nt.parseParenItem=function(n){return n};Nt.parseParenArrowList=function(n,e,t,i){return this.parseArrowExpression(this.startNodeAt(n,e),t,!1,i)};var bK=[];Nt.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var n=this.startNode(),e=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(D.dot)){n.meta=e;var t=this.containsEsc;return n.property=this.parseIdent(!0),n.property.name!=="target"&&this.raiseRecoverable(n.property.start,"The only valid meta property for new is 'new.target'"),t&&this.raiseRecoverable(n.start,"'new.target' must not contain escaped characters"),this.allowNewDotTarget||this.raiseRecoverable(n.start,"'new.target' can only be used in functions and class static block"),this.finishNode(n,"MetaProperty")}var i=this.start,s=this.startLoc,r=this.type===D._import;return n.callee=this.parseSubscripts(this.parseExprAtom(),i,s,!0,!1),r&&n.callee.type==="ImportExpression"&&this.raise(i,"Cannot use new with import()"),this.eat(D.parenL)?n.arguments=this.parseExprList(D.parenR,this.options.ecmaVersion>=8,!1):n.arguments=bK,this.finishNode(n,"NewExpression")};Nt.parseTemplateElement=function(n){var e=n.isTagged,t=this.startNode();return this.type===D.invalidTemplate?(e||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),t.value={raw:this.value,cooked:null}):t.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,`
`),cooked:this.value},this.next(),t.tail=this.type===D.backQuote,this.finishNode(t,"TemplateElement")};Nt.parseTemplate=function(n){n===void 0&&(n={});var e=n.isTagged;e===void 0&&(e=!1);var t=this.startNode();this.next(),t.expressions=[];var i=this.parseTemplateElement({isTagged:e});for(t.quasis=[i];!i.tail;)this.type===D.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(D.dollarBraceL),t.expressions.push(this.parseExpression()),this.expect(D.braceR),t.quasis.push(i=this.parseTemplateElement({isTagged:e}));return this.next(),this.finishNode(t,"TemplateLiteral")};Nt.isAsyncProp=function(n){return!n.computed&&n.key.type==="Identifier"&&n.key.name==="async"&&(this.type===D.name||this.type===D.num||this.type===D.string||this.type===D.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===D.star)&&!Eo.test(this.input.slice(this.lastTokEnd,this.start))};Nt.parseObj=function(n,e){var t=this.startNode(),i=!0,s={};for(t.properties=[],this.next();!this.eat(D.braceR);){if(i)i=!1;else if(this.expect(D.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(D.braceR))break;var r=this.parseProperty(n,e);n||this.checkPropClash(r,s,e),t.properties.push(r)}return this.finishNode(t,n?"ObjectPattern":"ObjectExpression")};Nt.parseProperty=function(n,e){var t=this.startNode(),i,s,r,o;if(this.options.ecmaVersion>=9&&this.eat(D.ellipsis))return n?(t.argument=this.parseIdent(!1),this.type===D.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(t,"RestElement")):(t.argument=this.parseMaybeAssign(!1,e),this.type===D.comma&&e&&e.trailingComma<0&&(e.trailingComma=this.start),this.finishNode(t,"SpreadElement"));this.options.ecmaVersion>=6&&(t.method=!1,t.shorthand=!1,(n||e)&&(r=this.start,o=this.startLoc),n||(i=this.eat(D.star)));var a=this.containsEsc;return this.parsePropertyName(t),!n&&!a&&this.options.ecmaVersion>=8&&!i&&this.isAsyncProp(t)?(s=!0,i=this.options.ecmaVersion>=9&&this.eat(D.star),this.parsePropertyName(t,e)):s=!1,this.parsePropertyValue(t,n,i,s,r,o,e,a),this.finishNode(t,"Property")};Nt.parsePropertyValue=function(n,e,t,i,s,r,o,a){if((t||i)&&this.type===D.colon&&this.unexpected(),this.eat(D.colon))n.value=e?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,o),n.kind="init";else if(this.options.ecmaVersion>=6&&this.type===D.parenL)e&&this.unexpected(),n.kind="init",n.method=!0,n.value=this.parseMethod(t,i);else if(!e&&!a&&this.options.ecmaVersion>=5&&!n.computed&&n.key.type==="Identifier"&&(n.key.name==="get"||n.key.name==="set")&&this.type!==D.comma&&this.type!==D.braceR&&this.type!==D.eq){(t||i)&&this.unexpected(),n.kind=n.key.name,this.parsePropertyName(n),n.value=this.parseMethod(!1);var l=n.kind==="get"?0:1;if(n.value.params.length!==l){var c=n.value.start;n.kind==="get"?this.raiseRecoverable(c,"getter should have no params"):this.raiseRecoverable(c,"setter should have exactly one param")}else n.kind==="set"&&n.value.params[0].type==="RestElement"&&this.raiseRecoverable(n.value.params[0].start,"Setter cannot use rest params")}else this.options.ecmaVersion>=6&&!n.computed&&n.key.type==="Identifier"?((t||i)&&this.unexpected(),this.checkUnreserved(n.key),n.key.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=s),n.kind="init",e?n.value=this.parseMaybeDefault(s,r,this.copyNode(n.key)):this.type===D.eq&&o?(o.shorthandAssign<0&&(o.shorthandAssign=this.start),n.value=this.parseMaybeDefault(s,r,this.copyNode(n.key))):n.value=this.copyNode(n.key),n.shorthand=!0):this.unexpected()};Nt.parsePropertyName=function(n){if(this.options.ecmaVersion>=6){if(this.eat(D.bracketL))return n.computed=!0,n.key=this.parseMaybeAssign(),this.expect(D.bracketR),n.key;n.computed=!1}return n.key=this.type===D.num||this.type===D.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never")};Nt.initFunction=function(n){n.id=null,this.options.ecmaVersion>=6&&(n.generator=n.expression=!1),this.options.ecmaVersion>=8&&(n.async=!1)};Nt.parseMethod=function(n,e,t){var i=this.startNode(),s=this.yieldPos,r=this.awaitPos,o=this.awaitIdentPos;return this.initFunction(i),this.options.ecmaVersion>=6&&(i.generator=n),this.options.ecmaVersion>=8&&(i.async=!!e),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(VT(e,i.generator)|zT|(t?zU:0)),this.expect(D.parenL),i.params=this.parseBindingList(D.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(i,!1,!0,!1),this.yieldPos=s,this.awaitPos=r,this.awaitIdentPos=o,this.finishNode(i,"FunctionExpression")};Nt.parseArrowExpression=function(n,e,t,i){var s=this.yieldPos,r=this.awaitPos,o=this.awaitIdentPos;return this.enterScope(VT(t,!1)|UU),this.initFunction(n),this.options.ecmaVersion>=8&&(n.async=!!t),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,n.params=this.toAssignableList(e,!0),this.parseFunctionBody(n,!0,!1,i),this.yieldPos=s,this.awaitPos=r,this.awaitIdentPos=o,this.finishNode(n,"ArrowFunctionExpression")};Nt.parseFunctionBody=function(n,e,t,i){var s=e&&this.type!==D.braceL,r=this.strict,o=!1;if(s)n.body=this.parseMaybeAssign(i),n.expression=!0,this.checkParams(n,!1);else{var a=this.options.ecmaVersion>=7&&!this.isSimpleParamList(n.params);(!r||a)&&(o=this.strictDirective(this.end),o&&a&&this.raiseRecoverable(n.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var l=this.labels;this.labels=[],o&&(this.strict=!0),this.checkParams(n,!r&&!o&&!e&&!t&&this.isSimpleParamList(n.params)),this.strict&&n.id&&this.checkLValSimple(n.id,HU),n.body=this.parseBlock(!1,void 0,o&&!r),n.expression=!1,this.adaptDirectivePrologue(n.body.body),this.labels=l}this.exitScope()};Nt.isSimpleParamList=function(n){for(var e=0,t=n;e<t.length;e+=1){var i=t[e];if(i.type!=="Identifier")return!1}return!0};Nt.checkParams=function(n,e){for(var t=Object.create(null),i=0,s=n.params;i<s.length;i+=1){var r=s[i];this.checkLValInnerPattern(r,HT,e?null:t)}};Nt.parseExprList=function(n,e,t,i){for(var s=[],r=!0;!this.eat(n);){if(r)r=!1;else if(this.expect(D.comma),e&&this.afterTrailingComma(n))break;var o=void 0;t&&this.type===D.comma?o=null:this.type===D.ellipsis?(o=this.parseSpread(i),i&&this.type===D.comma&&i.trailingComma<0&&(i.trailingComma=this.start)):o=this.parseMaybeAssign(!1,i),s.push(o)}return s};Nt.checkUnreserved=function(n){var e=n.start,t=n.end,i=n.name;if(this.inGenerator&&i==="yield"&&this.raiseRecoverable(e,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&i==="await"&&this.raiseRecoverable(e,"Cannot use 'await' as identifier inside an async function"),this.currentThisScope().inClassFieldInit&&i==="arguments"&&this.raiseRecoverable(e,"Cannot use 'arguments' in class field initializer"),this.inClassStaticBlock&&(i==="arguments"||i==="await")&&this.raise(e,"Cannot use "+i+" in class static initialization block"),this.keywords.test(i)&&this.raise(e,"Unexpected keyword '"+i+"'"),!(this.options.ecmaVersion<6&&this.input.slice(e,t).indexOf("\\")!==-1)){var s=this.strict?this.reservedWordsStrict:this.reservedWords;s.test(i)&&(!this.inAsync&&i==="await"&&this.raiseRecoverable(e,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(e,"The keyword '"+i+"' is reserved"))}};Nt.parseIdent=function(n,e){var t=this.startNode();return this.type===D.name?t.name=this.value:this.type.keyword?(t.name=this.type.keyword,(t.name==="class"||t.name==="function")&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)&&this.context.pop()):this.unexpected(),this.next(!!n),this.finishNode(t,"Identifier"),n||(this.checkUnreserved(t),t.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=t.start)),t};Nt.parsePrivateIdent=function(){var n=this.startNode();return this.type===D.privateId?n.name=this.value:this.unexpected(),this.next(),this.finishNode(n,"PrivateIdentifier"),this.privateNameStack.length===0?this.raise(n.start,"Private field '#"+n.name+"' must be declared in an enclosing class"):this.privateNameStack[this.privateNameStack.length-1].used.push(n),n};Nt.parseYield=function(n){this.yieldPos||(this.yieldPos=this.start);var e=this.startNode();return this.next(),this.type===D.semi||this.canInsertSemicolon()||this.type!==D.star&&!this.type.startsExpr?(e.delegate=!1,e.argument=null):(e.delegate=this.eat(D.star),e.argument=this.parseMaybeAssign(n)),this.finishNode(e,"YieldExpression")};Nt.parseAwait=function(n){this.awaitPos||(this.awaitPos=this.start);var e=this.startNode();return this.next(),e.argument=this.parseMaybeUnary(null,!0,!1,n),this.finishNode(e,"AwaitExpression")};var O0=Xn.prototype;O0.raise=function(n,e){var t=LU(this.input,n);e+=" ("+t.line+":"+t.column+")";var i=new SyntaxError(e);throw i.pos=n,i.loc=t,i.raisedAt=this.pos,i};O0.raiseRecoverable=O0.raise;O0.curPosition=function(){if(this.options.locations)return new Lm(this.curLine,this.pos-this.lineStart)};var ph=Xn.prototype,_K=function(e){this.flags=e,this.var=[],this.lexical=[],this.functions=[],this.inClassFieldInit=!1};ph.enterScope=function(n){this.scopeStack.push(new _K(n))};ph.exitScope=function(){this.scopeStack.pop()};ph.treatFunctionsAsVarInScope=function(n){return n.flags&op||!this.inModule&&n.flags&Fm};ph.declareName=function(n,e,t){var i=!1;if(e===Fl){var s=this.currentScope();i=s.lexical.indexOf(n)>-1||s.functions.indexOf(n)>-1||s.var.indexOf(n)>-1,s.lexical.push(n),this.inModule&&s.flags&Fm&&delete this.undefinedExports[n]}else if(e===VU){var r=this.currentScope();r.lexical.push(n)}else if(e===GU){var o=this.currentScope();this.treatFunctionsAsVar?i=o.lexical.indexOf(n)>-1:i=o.lexical.indexOf(n)>-1||o.var.indexOf(n)>-1,o.functions.push(n)}else for(var a=this.scopeStack.length-1;a>=0;--a){var l=this.scopeStack[a];if(l.lexical.indexOf(n)>-1&&!(l.flags&NU&&l.lexical[0]===n)||!this.treatFunctionsAsVarInScope(l)&&l.functions.indexOf(n)>-1){i=!0;break}if(l.var.push(n),this.inModule&&l.flags&Fm&&delete this.undefinedExports[n],l.flags&GT)break}i&&this.raiseRecoverable(t,"Identifier '"+n+"' has already been declared")};ph.checkLocalExport=function(n){this.scopeStack[0].lexical.indexOf(n.name)===-1&&this.scopeStack[0].var.indexOf(n.name)===-1&&(this.undefinedExports[n.name]=n)};ph.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]};ph.currentVarScope=function(){for(var n=this.scopeStack.length-1;;n--){var e=this.scopeStack[n];if(e.flags&GT)return e}};ph.currentThisScope=function(){for(var n=this.scopeStack.length-1;;n--){var e=this.scopeStack[n];if(e.flags&GT&&!(e.flags&UU))return e}};var E_=function(e,t,i){this.type="",this.start=t,this.end=0,e.options.locations&&(this.loc=new S_(e,i)),e.options.directSourceFile&&(this.sourceFile=e.options.directSourceFile),e.options.ranges&&(this.range=[t,0])},AA=Xn.prototype;AA.startNode=function(){return new E_(this,this.start,this.startLoc)};AA.startNodeAt=function(n,e){return new E_(this,n,e)};function jU(n,e,t,i){return n.type=e,n.end=t,this.options.locations&&(n.loc.end=i),this.options.ranges&&(n.range[1]=t),n}AA.finishNode=function(n,e){return jU.call(this,n,e,this.lastTokEnd,this.lastTokEndLoc)};AA.finishNodeAt=function(n,e,t,i){return jU.call(this,n,e,t,i)};AA.copyNode=function(n){var e=new E_(this,n.start,this.startLoc);for(var t in n)e[t]=n[t];return e};var qU="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",XU=qU+" Extended_Pictographic",YU=XU,JU=YU+" EBase EComp EMod EPres ExtPict",xK=JU,wK={9:qU,10:XU,11:YU,12:JU,13:xK},sD="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",KU="Adlam Adlm Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",ZU=KU+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",$U=ZU+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",eN=$U+" Chorasmian Chrs Diak Dives_Akuru Khitan_Small_Script Kits Yezi Yezidi",SK=eN+" Cypro_Minoan Cpmn Old_Uyghur Ougr Tangsa Tnsa Toto Vithkuqi Vith",CK={9:KU,10:ZU,11:$U,12:eN,13:SK},tN={};function EK(n){var e=tN[n]={binary:uu(wK[n]+" "+sD),nonBinary:{General_Category:uu(sD),Script:uu(CK[n])}};e.nonBinary.Script_Extensions=e.nonBinary.Script,e.nonBinary.gc=e.nonBinary.General_Category,e.nonBinary.sc=e.nonBinary.Script,e.nonBinary.scx=e.nonBinary.Script_Extensions}for(var qw=0,rD=[9,10,11,12,13];qw<rD.length;qw+=1){var MK=rD[qw];EK(MK)}var _t=Xn.prototype,Jl=function(e){this.parser=e,this.validFlags="gim"+(e.options.ecmaVersion>=6?"uy":"")+(e.options.ecmaVersion>=9?"s":"")+(e.options.ecmaVersion>=13?"d":""),this.unicodeProperties=tN[e.options.ecmaVersion>=13?13:e.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};Jl.prototype.reset=function(e,t,i){var s=i.indexOf("u")!==-1;this.start=e|0,this.source=t+"",this.flags=i,this.switchU=s&&this.parser.options.ecmaVersion>=6,this.switchN=s&&this.parser.options.ecmaVersion>=9};Jl.prototype.raise=function(e){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+e)};Jl.prototype.at=function(e,t){t===void 0&&(t=!1);var i=this.source,s=i.length;if(e>=s)return-1;var r=i.charCodeAt(e);if(!(t||this.switchU)||r<=55295||r>=57344||e+1>=s)return r;var o=i.charCodeAt(e+1);return o>=56320&&o<=57343?(r<<10)+o-56613888:r};Jl.prototype.nextIndex=function(e,t){t===void 0&&(t=!1);var i=this.source,s=i.length;if(e>=s)return s;var r=i.charCodeAt(e),o;return!(t||this.switchU)||r<=55295||r>=57344||e+1>=s||(o=i.charCodeAt(e+1))<56320||o>57343?e+1:e+2};Jl.prototype.current=function(e){return e===void 0&&(e=!1),this.at(this.pos,e)};Jl.prototype.lookahead=function(e){return e===void 0&&(e=!1),this.at(this.nextIndex(this.pos,e),e)};Jl.prototype.advance=function(e){e===void 0&&(e=!1),this.pos=this.nextIndex(this.pos,e)};Jl.prototype.eat=function(e,t){return t===void 0&&(t=!1),this.current(t)===e?(this.advance(t),!0):!1};_t.validateRegExpFlags=function(n){for(var e=n.validFlags,t=n.flags,i=0;i<t.length;i++){var s=t.charAt(i);e.indexOf(s)===-1&&this.raise(n.start,"Invalid regular expression flag"),t.indexOf(s,i+1)>-1&&this.raise(n.start,"Duplicate regular expression flag")}};_t.validateRegExpPattern=function(n){this.regexp_pattern(n),!n.switchN&&this.options.ecmaVersion>=9&&n.groupNames.length>0&&(n.switchN=!0,this.regexp_pattern(n))};_t.regexp_pattern=function(n){n.pos=0,n.lastIntValue=0,n.lastStringValue="",n.lastAssertionIsQuantifiable=!1,n.numCapturingParens=0,n.maxBackReference=0,n.groupNames.length=0,n.backReferenceNames.length=0,this.regexp_disjunction(n),n.pos!==n.source.length&&(n.eat(41)&&n.raise("Unmatched ')'"),(n.eat(93)||n.eat(125))&&n.raise("Lone quantifier brackets")),n.maxBackReference>n.numCapturingParens&&n.raise("Invalid escape");for(var e=0,t=n.backReferenceNames;e<t.length;e+=1){var i=t[e];n.groupNames.indexOf(i)===-1&&n.raise("Invalid named capture referenced")}};_t.regexp_disjunction=function(n){for(this.regexp_alternative(n);n.eat(124);)this.regexp_alternative(n);this.regexp_eatQuantifier(n,!0)&&n.raise("Nothing to repeat"),n.eat(123)&&n.raise("Lone quantifier brackets")};_t.regexp_alternative=function(n){for(;n.pos<n.source.length&&this.regexp_eatTerm(n););};_t.regexp_eatTerm=function(n){return this.regexp_eatAssertion(n)?(n.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(n)&&n.switchU&&n.raise("Invalid quantifier"),!0):(n.switchU?this.regexp_eatAtom(n):this.regexp_eatExtendedAtom(n))?(this.regexp_eatQuantifier(n),!0):!1};_t.regexp_eatAssertion=function(n){var e=n.pos;if(n.lastAssertionIsQuantifiable=!1,n.eat(94)||n.eat(36))return!0;if(n.eat(92)){if(n.eat(66)||n.eat(98))return!0;n.pos=e}if(n.eat(40)&&n.eat(63)){var t=!1;if(this.options.ecmaVersion>=9&&(t=n.eat(60)),n.eat(61)||n.eat(33))return this.regexp_disjunction(n),n.eat(41)||n.raise("Unterminated group"),n.lastAssertionIsQuantifiable=!t,!0}return n.pos=e,!1};_t.regexp_eatQuantifier=function(n,e){return e===void 0&&(e=!1),this.regexp_eatQuantifierPrefix(n,e)?(n.eat(63),!0):!1};_t.regexp_eatQuantifierPrefix=function(n,e){return n.eat(42)||n.eat(43)||n.eat(63)||this.regexp_eatBracedQuantifier(n,e)};_t.regexp_eatBracedQuantifier=function(n,e){var t=n.pos;if(n.eat(123)){var i=0,s=-1;if(this.regexp_eatDecimalDigits(n)&&(i=n.lastIntValue,n.eat(44)&&this.regexp_eatDecimalDigits(n)&&(s=n.lastIntValue),n.eat(125)))return s!==-1&&s<i&&!e&&n.raise("numbers out of order in {} quantifier"),!0;n.switchU&&!e&&n.raise("Incomplete quantifier"),n.pos=t}return!1};_t.regexp_eatAtom=function(n){return this.regexp_eatPatternCharacters(n)||n.eat(46)||this.regexp_eatReverseSolidusAtomEscape(n)||this.regexp_eatCharacterClass(n)||this.regexp_eatUncapturingGroup(n)||this.regexp_eatCapturingGroup(n)};_t.regexp_eatReverseSolidusAtomEscape=function(n){var e=n.pos;if(n.eat(92)){if(this.regexp_eatAtomEscape(n))return!0;n.pos=e}return!1};_t.regexp_eatUncapturingGroup=function(n){var e=n.pos;if(n.eat(40)){if(n.eat(63)&&n.eat(58)){if(this.regexp_disjunction(n),n.eat(41))return!0;n.raise("Unterminated group")}n.pos=e}return!1};_t.regexp_eatCapturingGroup=function(n){if(n.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(n):n.current()===63&&n.raise("Invalid group"),this.regexp_disjunction(n),n.eat(41))return n.numCapturingParens+=1,!0;n.raise("Unterminated group")}return!1};_t.regexp_eatExtendedAtom=function(n){return n.eat(46)||this.regexp_eatReverseSolidusAtomEscape(n)||this.regexp_eatCharacterClass(n)||this.regexp_eatUncapturingGroup(n)||this.regexp_eatCapturingGroup(n)||this.regexp_eatInvalidBracedQuantifier(n)||this.regexp_eatExtendedPatternCharacter(n)};_t.regexp_eatInvalidBracedQuantifier=function(n){return this.regexp_eatBracedQuantifier(n,!0)&&n.raise("Nothing to repeat"),!1};_t.regexp_eatSyntaxCharacter=function(n){var e=n.current();return iN(e)?(n.lastIntValue=e,n.advance(),!0):!1};function iN(n){return n===36||n>=40&&n<=43||n===46||n===63||n>=91&&n<=94||n>=123&&n<=125}_t.regexp_eatPatternCharacters=function(n){for(var e=n.pos,t=0;(t=n.current())!==-1&&!iN(t);)n.advance();return n.pos!==e};_t.regexp_eatExtendedPatternCharacter=function(n){var e=n.current();return e!==-1&&e!==36&&!(e>=40&&e<=43)&&e!==46&&e!==63&&e!==91&&e!==94&&e!==124?(n.advance(),!0):!1};_t.regexp_groupSpecifier=function(n){if(n.eat(63)){if(this.regexp_eatGroupName(n)){n.groupNames.indexOf(n.lastStringValue)!==-1&&n.raise("Duplicate capture group name"),n.groupNames.push(n.lastStringValue);return}n.raise("Invalid group")}};_t.regexp_eatGroupName=function(n){if(n.lastStringValue="",n.eat(60)){if(this.regexp_eatRegExpIdentifierName(n)&&n.eat(62))return!0;n.raise("Invalid capture group name")}return!1};_t.regexp_eatRegExpIdentifierName=function(n){if(n.lastStringValue="",this.regexp_eatRegExpIdentifierStart(n)){for(n.lastStringValue+=eh(n.lastIntValue);this.regexp_eatRegExpIdentifierPart(n);)n.lastStringValue+=eh(n.lastIntValue);return!0}return!1};_t.regexp_eatRegExpIdentifierStart=function(n){var e=n.pos,t=this.options.ecmaVersion>=11,i=n.current(t);return n.advance(t),i===92&&this.regexp_eatRegExpUnicodeEscapeSequence(n,t)&&(i=n.lastIntValue),TK(i)?(n.lastIntValue=i,!0):(n.pos=e,!1)};function TK(n){return jl(n,!0)||n===36||n===95}_t.regexp_eatRegExpIdentifierPart=function(n){var e=n.pos,t=this.options.ecmaVersion>=11,i=n.current(t);return n.advance(t),i===92&&this.regexp_eatRegExpUnicodeEscapeSequence(n,t)&&(i=n.lastIntValue),IK(i)?(n.lastIntValue=i,!0):(n.pos=e,!1)};function IK(n){return Gf(n,!0)||n===36||n===95||n===8204||n===8205}_t.regexp_eatAtomEscape=function(n){return this.regexp_eatBackReference(n)||this.regexp_eatCharacterClassEscape(n)||this.regexp_eatCharacterEscape(n)||n.switchN&&this.regexp_eatKGroupName(n)?!0:(n.switchU&&(n.current()===99&&n.raise("Invalid unicode escape"),n.raise("Invalid escape")),!1)};_t.regexp_eatBackReference=function(n){var e=n.pos;if(this.regexp_eatDecimalEscape(n)){var t=n.lastIntValue;if(n.switchU)return t>n.maxBackReference&&(n.maxBackReference=t),!0;if(t<=n.numCapturingParens)return!0;n.pos=e}return!1};_t.regexp_eatKGroupName=function(n){if(n.eat(107)){if(this.regexp_eatGroupName(n))return n.backReferenceNames.push(n.lastStringValue),!0;n.raise("Invalid named reference")}return!1};_t.regexp_eatCharacterEscape=function(n){return this.regexp_eatControlEscape(n)||this.regexp_eatCControlLetter(n)||this.regexp_eatZero(n)||this.regexp_eatHexEscapeSequence(n)||this.regexp_eatRegExpUnicodeEscapeSequence(n,!1)||!n.switchU&&this.regexp_eatLegacyOctalEscapeSequence(n)||this.regexp_eatIdentityEscape(n)};_t.regexp_eatCControlLetter=function(n){var e=n.pos;if(n.eat(99)){if(this.regexp_eatControlLetter(n))return!0;n.pos=e}return!1};_t.regexp_eatZero=function(n){return n.current()===48&&!M_(n.lookahead())?(n.lastIntValue=0,n.advance(),!0):!1};_t.regexp_eatControlEscape=function(n){var e=n.current();return e===116?(n.lastIntValue=9,n.advance(),!0):e===110?(n.lastIntValue=10,n.advance(),!0):e===118?(n.lastIntValue=11,n.advance(),!0):e===102?(n.lastIntValue=12,n.advance(),!0):e===114?(n.lastIntValue=13,n.advance(),!0):!1};_t.regexp_eatControlLetter=function(n){var e=n.current();return nN(e)?(n.lastIntValue=e%32,n.advance(),!0):!1};function nN(n){return n>=65&&n<=90||n>=97&&n<=122}_t.regexp_eatRegExpUnicodeEscapeSequence=function(n,e){e===void 0&&(e=!1);var t=n.pos,i=e||n.switchU;if(n.eat(117)){if(this.regexp_eatFixedHexDigits(n,4)){var s=n.lastIntValue;if(i&&s>=55296&&s<=56319){var r=n.pos;if(n.eat(92)&&n.eat(117)&&this.regexp_eatFixedHexDigits(n,4)){var o=n.lastIntValue;if(o>=56320&&o<=57343)return n.lastIntValue=(s-55296)*1024+(o-56320)+65536,!0}n.pos=r,n.lastIntValue=s}return!0}if(i&&n.eat(123)&&this.regexp_eatHexDigits(n)&&n.eat(125)&&RK(n.lastIntValue))return!0;i&&n.raise("Invalid unicode escape"),n.pos=t}return!1};function RK(n){return n>=0&&n<=1114111}_t.regexp_eatIdentityEscape=function(n){if(n.switchU)return this.regexp_eatSyntaxCharacter(n)?!0:n.eat(47)?(n.lastIntValue=47,!0):!1;var e=n.current();return e!==99&&(!n.switchN||e!==107)?(n.lastIntValue=e,n.advance(),!0):!1};_t.regexp_eatDecimalEscape=function(n){n.lastIntValue=0;var e=n.current();if(e>=49&&e<=57){do n.lastIntValue=10*n.lastIntValue+(e-48),n.advance();while((e=n.current())>=48&&e<=57);return!0}return!1};_t.regexp_eatCharacterClassEscape=function(n){var e=n.current();if(PK(e))return n.lastIntValue=-1,n.advance(),!0;if(n.switchU&&this.options.ecmaVersion>=9&&(e===80||e===112)){if(n.lastIntValue=-1,n.advance(),n.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(n)&&n.eat(125))return!0;n.raise("Invalid property name")}return!1};function PK(n){return n===100||n===68||n===115||n===83||n===119||n===87}_t.regexp_eatUnicodePropertyValueExpression=function(n){var e=n.pos;if(this.regexp_eatUnicodePropertyName(n)&&n.eat(61)){var t=n.lastStringValue;if(this.regexp_eatUnicodePropertyValue(n)){var i=n.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(n,t,i),!0}}if(n.pos=e,this.regexp_eatLoneUnicodePropertyNameOrValue(n)){var s=n.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(n,s),!0}return!1};_t.regexp_validateUnicodePropertyNameAndValue=function(n,e,t){gA(n.unicodeProperties.nonBinary,e)||n.raise("Invalid property name"),n.unicodeProperties.nonBinary[e].test(t)||n.raise("Invalid property value")};_t.regexp_validateUnicodePropertyNameOrValue=function(n,e){n.unicodeProperties.binary.test(e)||n.raise("Invalid property name")};_t.regexp_eatUnicodePropertyName=function(n){var e=0;for(n.lastStringValue="";sN(e=n.current());)n.lastStringValue+=eh(e),n.advance();return n.lastStringValue!==""};function sN(n){return nN(n)||n===95}_t.regexp_eatUnicodePropertyValue=function(n){var e=0;for(n.lastStringValue="";BK(e=n.current());)n.lastStringValue+=eh(e),n.advance();return n.lastStringValue!==""};function BK(n){return sN(n)||M_(n)}_t.regexp_eatLoneUnicodePropertyNameOrValue=function(n){return this.regexp_eatUnicodePropertyValue(n)};_t.regexp_eatCharacterClass=function(n){if(n.eat(91)){if(n.eat(94),this.regexp_classRanges(n),n.eat(93))return!0;n.raise("Unterminated character class")}return!1};_t.regexp_classRanges=function(n){for(;this.regexp_eatClassAtom(n);){var e=n.lastIntValue;if(n.eat(45)&&this.regexp_eatClassAtom(n)){var t=n.lastIntValue;n.switchU&&(e===-1||t===-1)&&n.raise("Invalid character class"),e!==-1&&t!==-1&&e>t&&n.raise("Range out of order in character class")}}};_t.regexp_eatClassAtom=function(n){var e=n.pos;if(n.eat(92)){if(this.regexp_eatClassEscape(n))return!0;if(n.switchU){var t=n.current();(t===99||aN(t))&&n.raise("Invalid class escape"),n.raise("Invalid escape")}n.pos=e}var i=n.current();return i!==93?(n.lastIntValue=i,n.advance(),!0):!1};_t.regexp_eatClassEscape=function(n){var e=n.pos;if(n.eat(98))return n.lastIntValue=8,!0;if(n.switchU&&n.eat(45))return n.lastIntValue=45,!0;if(!n.switchU&&n.eat(99)){if(this.regexp_eatClassControlLetter(n))return!0;n.pos=e}return this.regexp_eatCharacterClassEscape(n)||this.regexp_eatCharacterEscape(n)};_t.regexp_eatClassControlLetter=function(n){var e=n.current();return M_(e)||e===95?(n.lastIntValue=e%32,n.advance(),!0):!1};_t.regexp_eatHexEscapeSequence=function(n){var e=n.pos;if(n.eat(120)){if(this.regexp_eatFixedHexDigits(n,2))return!0;n.switchU&&n.raise("Invalid escape"),n.pos=e}return!1};_t.regexp_eatDecimalDigits=function(n){var e=n.pos,t=0;for(n.lastIntValue=0;M_(t=n.current());)n.lastIntValue=10*n.lastIntValue+(t-48),n.advance();return n.pos!==e};function M_(n){return n>=48&&n<=57}_t.regexp_eatHexDigits=function(n){var e=n.pos,t=0;for(n.lastIntValue=0;rN(t=n.current());)n.lastIntValue=16*n.lastIntValue+oN(t),n.advance();return n.pos!==e};function rN(n){return n>=48&&n<=57||n>=65&&n<=70||n>=97&&n<=102}function oN(n){return n>=65&&n<=70?10+(n-65):n>=97&&n<=102?10+(n-97):n-48}_t.regexp_eatLegacyOctalEscapeSequence=function(n){if(this.regexp_eatOctalDigit(n)){var e=n.lastIntValue;if(this.regexp_eatOctalDigit(n)){var t=n.lastIntValue;e<=3&&this.regexp_eatOctalDigit(n)?n.lastIntValue=e*64+t*8+n.lastIntValue:n.lastIntValue=e*8+t}else n.lastIntValue=e;return!0}return!1};_t.regexp_eatOctalDigit=function(n){var e=n.current();return aN(e)?(n.lastIntValue=e-48,n.advance(),!0):(n.lastIntValue=0,!1)};function aN(n){return n>=48&&n<=55}_t.regexp_eatFixedHexDigits=function(n,e){var t=n.pos;n.lastIntValue=0;for(var i=0;i<e;++i){var s=n.current();if(!rN(s))return n.pos=t,!1;n.lastIntValue=16*n.lastIntValue+oN(s),n.advance()}return!0};var WT=function(e){this.type=e.type,this.value=e.value,this.start=e.start,this.end=e.end,e.options.locations&&(this.loc=new S_(e,e.startLoc,e.endLoc)),e.options.ranges&&(this.range=[e.start,e.end])},Xt=Xn.prototype;Xt.next=function(n){!n&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new WT(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()};Xt.getToken=function(){return this.next(),new WT(this)};typeof Symbol<"u"&&(Xt[Symbol.iterator]=function(){var n=this;return{next:function(){var e=n.getToken();return{done:e.type===D.eof,value:e}}}});Xt.nextToken=function(){var n=this.curContext();if((!n||!n.preserveSpace)&&this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length)return this.finishToken(D.eof);if(n.override)return n.override(this);this.readToken(this.fullCharCodeAtPos())};Xt.readToken=function(n){return jl(n,this.options.ecmaVersion>=6)||n===92?this.readWord():this.getTokenFromCode(n)};Xt.fullCharCodeAtPos=function(){var n=this.input.charCodeAt(this.pos);if(n<=55295||n>=56320)return n;var e=this.input.charCodeAt(this.pos+1);return e<=56319||e>=57344?n:(n<<10)+e-56613888};Xt.skipBlockComment=function(){var n=this.options.onComment&&this.curPosition(),e=this.pos,t=this.input.indexOf("*/",this.pos+=2);if(t===-1&&this.raise(this.pos-2,"Unterminated comment"),this.pos=t+2,this.options.locations)for(var i=void 0,s=e;(i=DU(this.input,s,this.pos))>-1;)++this.curLine,s=this.lineStart=i;this.options.onComment&&this.options.onComment(!0,this.input.slice(e+2,t),e,this.pos,n,this.curPosition())};Xt.skipLineComment=function(n){for(var e=this.pos,t=this.options.onComment&&this.curPosition(),i=this.input.charCodeAt(this.pos+=n);this.pos<this.input.length&&!rp(i);)i=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(e+n,this.pos),e,this.pos,t,this.curPosition())};Xt.skipSpace=function(){e:for(;this.pos<this.input.length;){var n=this.input.charCodeAt(this.pos);switch(n){case 32:case 160:++this.pos;break;case 13:this.input.charCodeAt(this.pos+1)===10&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(n>8&&n<14||n>=5760&&OU.test(String.fromCharCode(n)))++this.pos;else break e}}};Xt.finishToken=function(n,e){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var t=this.type;this.type=n,this.value=e,this.updateContext(t)};Xt.readToken_dot=function(){var n=this.input.charCodeAt(this.pos+1);if(n>=48&&n<=57)return this.readNumber(!0);var e=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&n===46&&e===46?(this.pos+=3,this.finishToken(D.ellipsis)):(++this.pos,this.finishToken(D.dot))};Xt.readToken_slash=function(){var n=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):n===61?this.finishOp(D.assign,2):this.finishOp(D.slash,1)};Xt.readToken_mult_modulo_exp=function(n){var e=this.input.charCodeAt(this.pos+1),t=1,i=n===42?D.star:D.modulo;return this.options.ecmaVersion>=7&&n===42&&e===42&&(++t,i=D.starstar,e=this.input.charCodeAt(this.pos+2)),e===61?this.finishOp(D.assign,t+1):this.finishOp(i,t)};Xt.readToken_pipe_amp=function(n){var e=this.input.charCodeAt(this.pos+1);if(e===n){if(this.options.ecmaVersion>=12){var t=this.input.charCodeAt(this.pos+2);if(t===61)return this.finishOp(D.assign,3)}return this.finishOp(n===124?D.logicalOR:D.logicalAND,2)}return e===61?this.finishOp(D.assign,2):this.finishOp(n===124?D.bitwiseOR:D.bitwiseAND,1)};Xt.readToken_caret=function(){var n=this.input.charCodeAt(this.pos+1);return n===61?this.finishOp(D.assign,2):this.finishOp(D.bitwiseXOR,1)};Xt.readToken_plus_min=function(n){var e=this.input.charCodeAt(this.pos+1);return e===n?e===45&&!this.inModule&&this.input.charCodeAt(this.pos+2)===62&&(this.lastTokEnd===0||Eo.test(this.input.slice(this.lastTokEnd,this.pos)))?(this.skipLineComment(3),this.skipSpace(),this.nextToken()):this.finishOp(D.incDec,2):e===61?this.finishOp(D.assign,2):this.finishOp(D.plusMin,1)};Xt.readToken_lt_gt=function(n){var e=this.input.charCodeAt(this.pos+1),t=1;return e===n?(t=n===62&&this.input.charCodeAt(this.pos+2)===62?3:2,this.input.charCodeAt(this.pos+t)===61?this.finishOp(D.assign,t+1):this.finishOp(D.bitShift,t)):e===33&&n===60&&!this.inModule&&this.input.charCodeAt(this.pos+2)===45&&this.input.charCodeAt(this.pos+3)===45?(this.skipLineComment(4),this.skipSpace(),this.nextToken()):(e===61&&(t=2),this.finishOp(D.relational,t))};Xt.readToken_eq_excl=function(n){var e=this.input.charCodeAt(this.pos+1);return e===61?this.finishOp(D.equality,this.input.charCodeAt(this.pos+2)===61?3:2):n===61&&e===62&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(D.arrow)):this.finishOp(n===61?D.eq:D.prefix,1)};Xt.readToken_question=function(){var n=this.options.ecmaVersion;if(n>=11){var e=this.input.charCodeAt(this.pos+1);if(e===46){var t=this.input.charCodeAt(this.pos+2);if(t<48||t>57)return this.finishOp(D.questionDot,2)}if(e===63){if(n>=12){var i=this.input.charCodeAt(this.pos+2);if(i===61)return this.finishOp(D.assign,3)}return this.finishOp(D.coalesce,2)}}return this.finishOp(D.question,1)};Xt.readToken_numberSign=function(){var n=this.options.ecmaVersion,e=35;if(n>=13&&(++this.pos,e=this.fullCharCodeAtPos(),jl(e,!0)||e===92))return this.finishToken(D.privateId,this.readWord1());this.raise(this.pos,"Unexpected character '"+eh(e)+"'")};Xt.getTokenFromCode=function(n){switch(n){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(D.parenL);case 41:return++this.pos,this.finishToken(D.parenR);case 59:return++this.pos,this.finishToken(D.semi);case 44:return++this.pos,this.finishToken(D.comma);case 91:return++this.pos,this.finishToken(D.bracketL);case 93:return++this.pos,this.finishToken(D.bracketR);case 123:return++this.pos,this.finishToken(D.braceL);case 125:return++this.pos,this.finishToken(D.braceR);case 58:return++this.pos,this.finishToken(D.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(D.backQuote);case 48:var e=this.input.charCodeAt(this.pos+1);if(e===120||e===88)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(e===111||e===79)return this.readRadixNumber(8);if(e===98||e===66)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(n);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(n);case 124:case 38:return this.readToken_pipe_amp(n);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(n);case 60:case 62:return this.readToken_lt_gt(n);case 61:case 33:return this.readToken_eq_excl(n);case 63:return this.readToken_question();case 126:return this.finishOp(D.prefix,1);case 35:return this.readToken_numberSign()}this.raise(this.pos,"Unexpected character '"+eh(n)+"'")};Xt.finishOp=function(n,e){var t=this.input.slice(this.pos,this.pos+e);return this.pos+=e,this.finishToken(n,t)};Xt.readRegexp=function(){for(var n,e,t=this.pos;;){this.pos>=this.input.length&&this.raise(t,"Unterminated regular expression");var i=this.input.charAt(this.pos);if(Eo.test(i)&&this.raise(t,"Unterminated regular expression"),n)n=!1;else{if(i==="[")e=!0;else if(i==="]"&&e)e=!1;else if(i==="/"&&!e)break;n=i==="\\"}++this.pos}var s=this.input.slice(t,this.pos);++this.pos;var r=this.pos,o=this.readWord1();this.containsEsc&&this.unexpected(r);var a=this.regexpState||(this.regexpState=new Jl(this));a.reset(t,s,o),this.validateRegExpFlags(a),this.validateRegExpPattern(a);var l=null;try{l=new RegExp(s,o)}catch{}return this.finishToken(D.regexp,{pattern:s,flags:o,value:l})};Xt.readInt=function(n,e,t){for(var i=this.options.ecmaVersion>=12&&e===void 0,s=t&&this.input.charCodeAt(this.pos)===48,r=this.pos,o=0,a=0,l=0,c=e??1/0;l<c;++l,++this.pos){var u=this.input.charCodeAt(this.pos),d=void 0;if(i&&u===95){s&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),a===95&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),l===0&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),a=u;continue}if(u>=97?d=u-97+10:u>=65?d=u-65+10:u>=48&&u<=57?d=u-48:d=1/0,d>=n)break;a=u,o=o*n+d}return i&&a===95&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===r||e!=null&&this.pos-r!==e?null:o};function DK(n,e){return e?parseInt(n,8):parseFloat(n.replace(/_/g,""))}function lN(n){return typeof BigInt!="function"?null:BigInt(n.replace(/_/g,""))}Xt.readRadixNumber=function(n){var e=this.pos;this.pos+=2;var t=this.readInt(n);return t==null&&this.raise(this.start+2,"Expected number in radix "+n),this.options.ecmaVersion>=11&&this.input.charCodeAt(this.pos)===110?(t=lN(this.input.slice(e,this.pos)),++this.pos):jl(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(D.num,t)};Xt.readNumber=function(n){var e=this.pos;!n&&this.readInt(10,void 0,!0)===null&&this.raise(e,"Invalid number");var t=this.pos-e>=2&&this.input.charCodeAt(e)===48;t&&this.strict&&this.raise(e,"Invalid number");var i=this.input.charCodeAt(this.pos);if(!t&&!n&&this.options.ecmaVersion>=11&&i===110){var s=lN(this.input.slice(e,this.pos));return++this.pos,jl(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(D.num,s)}t&&/[89]/.test(this.input.slice(e,this.pos))&&(t=!1),i===46&&!t&&(++this.pos,this.readInt(10),i=this.input.charCodeAt(this.pos)),(i===69||i===101)&&!t&&(i=this.input.charCodeAt(++this.pos),(i===43||i===45)&&++this.pos,this.readInt(10)===null&&this.raise(e,"Invalid number")),jl(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var r=DK(this.input.slice(e,this.pos),t);return this.finishToken(D.num,r)};Xt.readCodePoint=function(){var n=this.input.charCodeAt(this.pos),e;if(n===123){this.options.ecmaVersion<6&&this.unexpected();var t=++this.pos;e=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,e>1114111&&this.invalidStringToken(t,"Code point out of bounds")}else e=this.readHexChar(4);return e};Xt.readString=function(n){for(var e="",t=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var i=this.input.charCodeAt(this.pos);if(i===n)break;i===92?(e+=this.input.slice(t,this.pos),e+=this.readEscapedChar(!1),t=this.pos):i===8232||i===8233?(this.options.ecmaVersion<10&&this.raise(this.start,"Unterminated string constant"),++this.pos,this.options.locations&&(this.curLine++,this.lineStart=this.pos)):(rp(i)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return e+=this.input.slice(t,this.pos++),this.finishToken(D.string,e)};var cN={};Xt.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(n){if(n===cN)this.readInvalidTemplateToken();else throw n}this.inTemplateElement=!1};Xt.invalidStringToken=function(n,e){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw cN;this.raise(n,e)};Xt.readTmplToken=function(){for(var n="",e=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var t=this.input.charCodeAt(this.pos);if(t===96||t===36&&this.input.charCodeAt(this.pos+1)===123)return this.pos===this.start&&(this.type===D.template||this.type===D.invalidTemplate)?t===36?(this.pos+=2,this.finishToken(D.dollarBraceL)):(++this.pos,this.finishToken(D.backQuote)):(n+=this.input.slice(e,this.pos),this.finishToken(D.template,n));if(t===92)n+=this.input.slice(e,this.pos),n+=this.readEscapedChar(!0),e=this.pos;else if(rp(t)){switch(n+=this.input.slice(e,this.pos),++this.pos,t){case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:n+=`
`;break;default:n+=String.fromCharCode(t);break}this.options.locations&&(++this.curLine,this.lineStart=this.pos),e=this.pos}else++this.pos}};Xt.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if(this.input[this.pos+1]!=="{")break;case"`":return this.finishToken(D.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")};Xt.readEscapedChar=function(n){var e=this.input.charCodeAt(++this.pos);switch(++this.pos,e){case 110:return`
`;case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return eh(this.readCodePoint());case 116:return"	";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(this.strict&&this.invalidStringToken(this.pos-1,"Invalid escape sequence"),n){var t=this.pos-1;return this.invalidStringToken(t,"Invalid escape sequence in template string"),null}default:if(e>=48&&e<=55){var i=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],s=parseInt(i,8);return s>255&&(i=i.slice(0,-1),s=parseInt(i,8)),this.pos+=i.length-1,e=this.input.charCodeAt(this.pos),(i!=="0"||e===56||e===57)&&(this.strict||n)&&this.invalidStringToken(this.pos-1-i.length,n?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(s)}return rp(e)?"":String.fromCharCode(e)}};Xt.readHexChar=function(n){var e=this.pos,t=this.readInt(16,n);return t===null&&this.invalidStringToken(e,"Bad character escape sequence"),t};Xt.readWord1=function(){this.containsEsc=!1;for(var n="",e=!0,t=this.pos,i=this.options.ecmaVersion>=6;this.pos<this.input.length;){var s=this.fullCharCodeAtPos();if(Gf(s,i))this.pos+=s<=65535?1:2;else if(s===92){this.containsEsc=!0,n+=this.input.slice(t,this.pos);var r=this.pos;this.input.charCodeAt(++this.pos)!==117&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var o=this.readCodePoint();(e?jl:Gf)(o,i)||this.invalidStringToken(r,"Invalid Unicode escape"),n+=eh(o),t=this.pos}else break;e=!1}return n+this.input.slice(t,this.pos)};Xt.readWord=function(){var n=this.readWord1(),e=D.name;return this.keywords.test(n)&&(e=UT[n]),this.finishToken(e,n)};var OK="8.8.0";Xn.acorn={Parser:Xn,version:OK,defaultOptions:cE,Position:Lm,SourceLocation:S_,getLineInfo:LU,Node:E_,TokenType:ti,tokTypes:D,keywordTypes:UT,TokContext:Lo,tokContexts:zi,isIdentifierChar:Gf,isIdentifierStart:jl,Token:WT,isNewLine:rp,lineBreak:Eo,lineBreakG:hK,nonASCIIwhitespace:OU};const kK=function(n,e,t){n.traverse(i=>{i.renderOrder=t})};class vA extends ze.Object3D{constructor(t,i){super();h(this,"_rebuildParentUI",()=>{this._parent._needsUpdate=!0,this.parent&&!this.parent.isUI?(k0.register(this),this.activatePseudoState("root")):(k0.remove(this),this.deactivatePseudoState("root"))});Object.defineProperties(this,{isUI:{configurable:!1,enumerable:!0,value:!0}}),this._backgroundMesh=null,this._backgroundMaterial=null,this._backgroundCustomDepthMaterial=null,this._backgroundMaterialMediation={},this._backgroundMeshMediation={backgroundCastShadow:{m:"castShadow"},backgroundReceiveShadow:{m:"receiveShadow"},renderOrder:{m:"renderOrder",t:kK}},this._fontMesh=null,this._fontMaterial=new tD("fontMaterial"),this._fontCustomDepthMaterial=new tD("fontCustomDepthMaterial"),this._fontMeshMediation={fontMaterial:{m:"material"},fontCustomDepthMaterial:{m:"customDepthMaterial",t:B7},fontCastShadow:{m:"castShadow"},fontReceiveShadow:{m:"receiveShadow"},renderOrder:{m:"renderOrder"}},this._children=t.children?new t.children:new ul("children"),this._parent=new D7,this.addEventListener("added",this._rebuildParentUI),this.addEventListener("removed",this._rebuildParentUI),this._backgroundSide=new eD("backgroundSide"),this._fontSide=new eD("fontSide"),this._backgroundAlphaTest=new $B("backgroundAlphaTest",.02),this._fontAlphaTest=new $B("fontAlphaTest",.02),this._visible=new aJ("visible",!0),this._backgroundCastShadow=new Kv("backgroundCastShadow"),this._fontCastShadow=new Kv("fontCastShadow"),this._backgroundReceiveShadow=new Kv("backgroundReceiveShadow"),this._fontReceiveShadow=new Kv("fontReceiveShadow"),this._renderOrder=new S7,this._segments=t.segments?new t.segments:new RU,this._bounds=t.bounds?new t.bounds:new ul("bounds"),this._order=new AJ,this._padding=new R7,this._margin=new P7,this._position=new gU,this._flexDirection=t.flexDirection?new t.flexDirection:new IT,this._justifyContent=t.justifyContent?new t.justifyContent:new RT,this._alignItems=t.alignItems?new t.alignItems:new MT,this._display=new H7("flex"),this._boxSizing=new j7("border-box"),this._width=new bJ,this._height=new _J,this._backgroundColor=t.backgroundColor?new t.backgroundColor:new pU,this._backgroundOpacity=new Qw("backgroundOpacity",.5),this._backgroundImage=new J7,this._backgroundSize=new Z7("cover"),this._color=t.color?new t.color:new km("color","inherit"),this._fontOpacity=new Qw("fontOpacity","inherit"),this._whiteSpace=t.whiteSpace?new t.whiteSpace:new TU,this._fontFamily=t.fontFamily?new t.fontFamily:new EU,this._fontStyle=t.fontStyle?new t.fontStyle:new vU("normal"),this._fontWeight=t.fontWeight?new t.fontWeight:new yU,this._fontSize=t.fontSize?new t.fontSize:new eK,this._lineHeight=t.lineHeight?new t.lineHeight:new MU,this._fontKerning=t.fontKerning?new t.fontKerning:new w_,this._letterSpacing=t.letterSpacing?new t.letterSpacing:new IU,this._overflow=new tJ("visible"),this._borderRadius=new rJ(0),this._borderWidth=new oJ(0),this._borderColor=new km("borderColor",16711935),this._borderOpacity=new Qw("borderOpacity",1),this._font=new z7,this._lineBreak=t.lineBreak?new t.lineBreak:new ul("lineBreak"),this._textContent=t.textContent?new t.textContent:new AU,this._glyphs=t.glyphs?new t.glyphs:new ul("glyphs"),this._inlines=t.inlines?new t.inlines:new ul("inlines"),this._layouter=t.layouter?new t.layouter:new ul("layouter"),this._inlineJustificator=new lJ,this._textAlign=t.textAlign?new t.textAlign:new TT,this._autoSize=t.autoSize?new t.autoSize:new ul("autoSize"),this._renderer=t.renderer?new t.renderer:new ul("renderer"),this._offset=new C7,this._invertAlpha=new tK,this._fontSmooth=t.fontSmooth?new t.fontSmooth:new E7,this._components=[this._textContent,this._children,this._parent,this._autoSize,this._fontFamily,this._fontStyle,this._fontWeight,this._font,this._whiteSpace,this._glyphs,this._inlines,this._visible,this._backgroundSide,this._fontSide,this._backgroundAlphaTest,this._fontAlphaTest,this._backgroundCastShadow,this._fontCastShadow,this._backgroundReceiveShadow,this._fontReceiveShadow,this._renderOrder,this._segments,this._padding,this._margin,this._width,this._height,this._borderWidth,this._boxSizing,this._bounds,this._position,this._flexDirection,this._justifyContent,this._alignItems,this._order,this._display,this._backgroundColor,this._backgroundOpacity,this._backgroundImage,this._backgroundSize,this._fontOpacity,this._color,this._fontSize,this._lineHeight,this._fontKerning,this._letterSpacing,this._borderRadius,this._borderColor,this._borderOpacity,this._lineBreak,this._offset,this._layouter,this._inlineJustificator,this._textAlign,this._invertAlpha,this._fontSmooth,this._fontMaterial,this._fontCustomDepthMaterial,this._overflow,this._renderer],this._onAfterUpdates=[],i.backgroundSide||(i.backgroundSide=0),i&&this.set(i)}update(){const t={};for(const i of this._components)i._needsUpdate&&(i.update(this,t),i._needsUpdate=!1);this._transferToBackgroundMesh(t),this._transferToFontMesh(t),this._transferToBackgroundMaterial(t),this._transferToFontMaterial(t);for(const i of this._children._uis)i.update()}process(){for(const t of this._children._uis)t.process();for(const t of this._components)t._needsProcess&&(t.process(this),t._needsProcess=!1)}render(){for(let t=0;t<this._components.length;t++){const i=this._components[t];i._needsRender&&(i.render(this),i._needsRender=!1)}for(const t of this._children._uis)t.render()}set(t){if(t.fontTexture&&(console.warn("ThreeMeshUI::set( {fontTexture} ) is deprecated. Please use fontLibrary to register font families and variants."),t.fontFamily)){const i=t.fontFamily.pages?t.fontFamily.info.face:t.fontFamily;let s=Du.getFontFamily(i);if(!s){const r=t.fontStyle?t.fontStyle:"normal",o=t.fontWeight?t.fontWeight:"400";s=Du.addFontFamily(i).addVariant(o,r,t.fontFamily,t.fontTexture)}t.fontFamily=s,delete t.fontTexture}for(let i of Object.keys(t)){const s=t[i];switch(i){case"contentDirection":console.warn("ThreeMeshUI v7xx: property `contentDirection` is deprecated and has been renamed as `flexDirection`"),i="flexDirection";break;case"interLine":console.warn("ThreeMeshUI v7xx: property `interLine` is deprecated and has been renamed as `lineHeight`"),i="lineHeight";break;case"content":console.warn("ThreeMeshUI v7xx: property `content` is deprecated and has been renamed as `textContent`"),i="textContent";break;case"fontColor":console.warn("ThreeMeshUI v7xx: property `fontColor` is deprecated and has been renamed as `color`"),i="color";break;case"hiddenOverflow":console.warn("ThreeMeshUI v7xx: property `hiddenOverflow` is deprecated and has been renamed as `overflow`"),i="overflow";break;case"backgroundTexture":console.warn("ThreeMeshUI v7xx: property `backgroundTexture` is deprecated and has been renamed as `backgroundImage`"),i="backgroundImage";break;case"alignContent":console.warn("ThreeMeshUI v7xx: property `alignContent` is deprecated and has been renamed as `alignItems`"),i="alignItems";break;case"borderTopColor":case"borderBottomColor":case"borderLeftColor":case"borderRightColor":i="borderColor";break}switch(i){case"fontSmooth":case"renderOrder":case"segments":case"visible":case"offset":this[`_${i}`].value=s;break;case"flexDirection":case"justifyContent":case"alignItems":case"color":case"fontFamily":case"fontOpacity":case"fontKerning":case"fontSize":case"fontStyle":case"fontWeight":case"textAlign":case"letterSpacing":case"lineHeight":case"whiteSpace":case"breakOn":case"width":case"height":case"padding":case"margin":case"backgroundColor":case"backgroundOpacity":case"backgroundImage":case"backgroundSize":case"borderColor":case"borderOpacity":case"borderRadius":case"borderWidth":case"overflow":case"order":case"boxSizing":this[`_${i}`]&&(this[`_${i}`].inline=s);break;case"paddingTop":this._padding.top=s;break;case"paddingRight":this._padding.right=s;break;case"paddingBottom":this._padding.bottom=s;break;case"paddingLeft":this._padding.left=s;break;case"marginTop":this._margin.top=s;break;case"marginRight":this._margin.right=s;break;case"marginBottom":this._margin.bottom=s;break;case"marginLeft":this._margin.left=s;break;case"borderTopWidth":this._borderWidth.top=s;break;case"borderRightWidth":this._borderWidth.right=s;break;case"borderBottomWidth":this._borderWidth.bottom=s;break;case"borderLeftWidth":this._borderWidth.left=s;break;case"borderTopLeftRadius":this._borderRadius.topLeft=s;break;case"borderTopRightRadius":this._borderRadius.topRight=s;break;case"borderBottomRightRadius":this._borderRadius.bottomRight=s;break;case"borderBottomLeftRadius":this._borderRadius.bottomLeft=s;break;case"side":case"castShadow":case"receiveShadow":const r=i.charAt(0).toUpperCase()+i.substr(1);this[`_background${r}`].value=s,this[`_font${r}`].value=s;break;case"fontSide":case"backgroundSide":case"fontCastShadow":case"backgroundCastShadow":case"fontReceiveShadow":case"backgroundReceiveShadow":case"fontMaterial":case"fontCustomDepthMaterial":this[`_${i}`].value=s;break;default:this[`_${i}`]!==void 0?this[`_${i}`].value=s:this[i]=s}}}get(t){switch(t){case"overflow":case"width":case"height":return this[`_${t}`].inline}}_rebuildChildrenLists(){this._children._needsUpdate=!0}add(t){let i=!1;for(let s=0;s<arguments.length;s++)super.add(arguments[s]),arguments[s].isUI&&(i=!0);return i&&this._rebuildChildrenLists(),this}remove(t){for(const i of Object.keys(arguments))arguments[i].isInline&&this.update(null,!0);return super.remove(...arguments),this._rebuildChildrenLists(),this}clear(){return this.removeFromParent(),this.traverse(t=>{t.material&&t.material.dispose(),t.geometry&&t.geometry.dispose()}),super.clear(),this._backgroundMesh=null,this._backgroundMaterial=null,this._backgroundMaterialMediation=null,this._backgroundMeshMediation=null,this._children.dispose(),this._children=null,this._parent.dispose(),this._parent=null,this._backgroundSide=null,this._backgroundAlphaTest=null,this._visible=null,this._backgroundCastShadow=null,this._backgroundReceiveShadow=null,this._renderOrder=null,this._segments=null,this._bounds=null,this._boxSizing=null,this._padding=null,this._margin=null,this._position=null,this._flexDirection=null,this._justifyContent=null,this._alignItems=null,this._display=null,this._backgroundColor=null,this._backgroundOpacity=null,this._backgroundSize=null,this._fontOpacity=null,this._color=null,this._whiteSpace=null,this._fontFamily=null,this._fontStyle=null,this._fontWeight=null,this._lineHeight=null,this._fontKerning=null,this._letterSpacing=null,this._overflow=null,this._textAlign=null,this._font=null,this._lineBreak=null,this._layouter=null,this}get textContent(){return this._textContent.process(this),this._textContent._value}get backgroundMaterial(){return this._backgroundMaterial}set backgroundMaterial(t){this._backgroundMaterial=t,this._backgroundMaterialMediation={...t.constructor.mediation},this._transferToBackgroundMaterial(),this._backgroundMesh&&(this._backgroundMesh.material=this._backgroundMaterial,co(t,"frameSize",this._backgroundMesh.scale))}set backgroundCustomDepthMaterial(t){this._backgroundCustomDepthMaterial=t,this._transferToBackgroundMaterial(),this._backgroundMesh&&(this._backgroundMesh.customDepthMaterial=this._backgroundCustomDepthMaterial)}get backgroundCustomDepthMaterial(){return this._backgroundCustomDepthMaterial}_transferToBackgroundMaterial(t=null){if(!t){t={};for(const i of this._components)i.output(t)}Yv.mediate(this,this._backgroundMaterial,t,this._backgroundMaterialMediation,this._backgroundCustomDepthMaterial)}set backgroundSide(t){this._backgroundSide.value=t,this._backgroundMaterial&&(this._backgroundMaterial.side=t)}get backgroundSide(){return this._backgroundSide.value}set backgroundAlphaTest(t){this._backgroundAlphaTest.value=t,this._backgroundMaterial&&(this._backgroundMaterial.alphaTest=t)}get backgroundAlphaTest(){return this._backgroundAlphaTest.value}get fontMaterial(){return this._fontMaterial.value}set fontMaterial(t){this._fontMaterial.value=t}set fontCustomDepthMaterial(t){this._fontCustomDepthMaterial.value=t}get fontCustomDepthMaterial(){return this._fontCustomDepthMaterial.value}_transferToFontMaterial(t=null){const i=this._fontMaterial.value;if(i){if(!t){t={};for(const s of this._components)s.output(t)}Yv.mediate(this,i,t,this._fontMaterial._mediation,this._fontCustomDepthMaterial.value)}}set fontSide(t){this._fontSide.value=t}get fontSide(){return this._fontSide.value}set fontAlphaTest(t){this._fontAlphaTest.value=t}get fontAlphaTest(){return this._fontAlphaTest.value}_transferToBackgroundMesh(t=null){if(!t){t={};for(const i of this._components)i.output(t)}Yv.mediate(this,this._backgroundMesh,t,this._backgroundMeshMediation)}setBackgroundMesh(t){this._backgroundMesh&&(this.remove(this._backgroundMesh),this.unbindBackgroundMeshProperties()),this._backgroundMesh=t,this._backgroundMesh&&(this.bindBackgroundMeshProperties(),this._backgroundCustomDepthMaterial&&(this._backgroundMesh.customDepthMaterial=this._backgroundCustomDepthMaterial),this._backgroundMaterial&&co(this._backgroundMaterial,"frameSize",this._backgroundMesh.scale),this._transferToBackgroundMesh(),this.add(this._backgroundMesh))}bindBackgroundMeshProperties(){}unbindBackgroundMeshProperties(){}activatePseudoState(t){}deactivatePseudoState(t){}togglePseudoState(t){}hasPseudoState(t){return!1}set borderRadiusMediation(t){this._borderRadius.mediation=t}set backgroundCastShadow(t){this._backgroundCastShadow&&(this._backgroundCastShadow.value=t)}get backgroundCastShadow(){return this._backgroundCastShadow}set backgroundReceiveShadow(t){this._backgroundReceiveShadow&&(this._backgroundReceiveShadow.value=t)}get backgroundReceiveShadow(){return this._backgroundReceiveShadow}set renderOrder(t){this._renderOrder&&(this._renderOrder.value=t)}get renderOrder(){return this._renderOrder.value}_transferToFontMesh(t=null){if(this._fontMesh){if(!t){t={};for(const i of this._components)i.output(t)}Yv.mediate(this,this._fontMesh,t,this._fontMeshMediation)}}setFontMesh(t){this._fontMesh&&(this.remove(this._fontMesh),this._fontMesh.material&&this._fontMesh.material.dispose(),this._fontMesh.geometry&&this._fontMesh.geometry.dispose(),this._fontMesh=null,this.unbindFontMeshProperties()),this._fontMesh=t,this._fontMesh&&(this._fontMesh.raycast=()=>{},this.bindFontMeshProperties(),this._transferToFontMaterial(),this._transferToFontMesh(),this.add(this._fontMesh))}bindFontMeshProperties(){}unbindFontMeshProperties(){}set fontCastShadow(t){this._fontCastShadow&&(this._fontCastShadow.value=t)}get fontCastShadow(){return this._fontCastShadow}set fontReceiveShadow(t){this._fontReceiveShadow&&(this._fontReceiveShadow.value=t)}get fontReceiveShadow(){return this._fontReceiveShadow}set segments(t){this._segments.value=t}get segments(){return this._segments.value}set onAfterUpdate(t){console.warn("ThreeMeshUI v7xx : `onAfterUpdate()` property has been deprecated, please rely on `addAfterUpdate` instead."),this.addAfterUpdate(t)}addAfterUpdate(t){this._onAfterUpdates.push(t)}removeAfterUpdate(t){const i=this._onAfterUpdates.indexOf(t);i!==-1&&this._onAfterUpdates.splice(i,1)}performAfterUpdate(){for(let t=0;t<this._onAfterUpdates.length;t++)this._onAfterUpdates[t]()}getProperty(t){return this[`_${t}`]?this[`_${t}`]:null}appendProperty(t,i){this[`_${t}`]=i,this._components.push(i)}replaceProperty(t,i){const s=this[`_${t}`],r=this._components.indexOf(s);return this._components[r]=this[`_${t}`]=i,i.needsUpdate=!0,s}}class k0{static register(e){this.elements.includes(e)||this.elements.push(e)}static remove(e){const t=this.elements.indexOf(e);t!==-1&&this.elements.splice(t,1)}static update(){for(const e of this.elements)e.update(),e.process(),e.process(),e.render()}}k0.elements=[];const LK=`

// FrameBorder vertex pars
attribute vec2 uvB;
varying vec2 vUvB;

`,jT=LK,FK=`

	// FrameBorder vertex shader
	vUvB = uvB;

`,qT=FK,UK=`

// borders sequences are : x:TOP, y:RIGHT, z:BOTTOM, w:LEFT
uniform vec4 borderWidth;
uniform vec3 borderColor;
uniform float borderOpacity;
uniform vec4 borderRadius;

uniform vec2 cornerTL;
uniform vec2 cornerTR;
uniform vec2 cornerBR;
uniform vec2 cornerBL;

varying vec2 vUvB;

float getEllipticFactor( vec2 uv, vec2 center, float radiusX, float radiusY )
{

		float edx = uv.x - center.x;
		float edy = uv.y - center.y;

		float ddx = (edx * edx) / (radiusX * radiusX);
		float ddy = (edy * edy) / (radiusY * radiusY);

		return ddx + ddy;

}

`,XT=UK,NK=`

vec4 borderColor = vec4( borderColor, borderOpacity );

// This could be tweak to produce more smoothing
float mult = 1.0;

// Step 1 ----------------------------------------------
// Draw the four borders ( top - right - bottom - left )
// Without worrying about radiuses ( Straight boorders )

// Top
float topBorderUVy = 1.0 - borderWidth.x;
if( borderWidth.x > 0.0 && vUvB.y > topBorderUVy )
{

	float w = fwidth( 1.0 - vUvB.y ) * mult;
	float step = smoothstep( topBorderUVy , topBorderUVy + w , vUvB.y );
	diffuseColor = mix( diffuseColor, borderColor, step );

}

// Left
float leftBorderUVx = borderWidth.w;
if( borderWidth.w > 0.0 && vUvB.x < leftBorderUVx )
{

	float w = fwidth( vUvB.x ) * mult ;
	float step = smoothstep( leftBorderUVx , leftBorderUVx - w , vUvB.x );
	diffuseColor = mix( diffuseColor, borderColor, step );

}

// Bottom
float bottomBorderUVy = borderWidth.z;
if( borderWidth.z > 0.0 && vUvB.y < bottomBorderUVy )
{
	float w = fwidth( vUvB.y ) * mult;
	float step = smoothstep( bottomBorderUVy , bottomBorderUVy - w , vUvB.y );
	diffuseColor = mix( diffuseColor, borderColor, step );
}

// Right
float rightBorderUVx = 1.0 - borderWidth.y;
if( borderWidth.y > 0.0 && vUvB.x > rightBorderUVx )
{
	float w = fwidth( 1.0 - vUvB.x ) * mult;
	float step = smoothstep( rightBorderUVx , rightBorderUVx + w , vUvB.x );
	diffuseColor = mix( diffuseColor, borderColor, step );
}


// Step 2 ----------------------------------------------
// Process each corners ( topLeft, topRight, bottomRight, bottomLeft )
// To transparentize outside radiuses
// To draw ellipse border on the corner


// Top Left corner
if( vUvB.x < cornerTL.x && vUvB.y > cornerTL.y ) {

		// Only draw border if width is set
		if( borderWidth.w + borderWidth.x > 0.0 ){

			float borderFactor = getEllipticFactor( vUvB, cornerTL, cornerTL.x - borderWidth.w,  ( 1.0 - cornerTL.y ) - borderWidth.x );
			float step = smoothstep( 1.0, 1.0 + fwidth( borderFactor ) * mult, borderFactor );
			diffuseColor = mix( diffuseColor, borderColor, step );

		}

		// Then then radius
		float radiusFactor = getEllipticFactor( vUvB, cornerTL, cornerTL.x, 1.0 - cornerTL.y );
		float alphaStep = smoothstep( 1.0 , 1.0 + fwidth(radiusFactor) * mult , radiusFactor );
		diffuseColor.a = mix( diffuseColor.a, 0.0, alphaStep );

}
// Bottom Left
if( vUvB.x < cornerBL.x && vUvB.y < cornerBL.y ) {

		if( borderWidth.w + borderWidth.z > 0.0 ){

			float borderFactor = getEllipticFactor( vUvB, cornerBL, cornerBL.x - borderWidth.w,  cornerBL.y - borderWidth.z );
			float step = smoothstep( 1.0, 1.0 + fwidth( borderFactor ) * mult, borderFactor );
			diffuseColor = mix( diffuseColor, borderColor, step );

		}


		float radiusFactor = getEllipticFactor( vUvB, cornerBL, cornerBL.x, cornerBL.y );
		float alphaStep = smoothstep( 1.0 , 1.0 + fwidth(radiusFactor) * mult , radiusFactor );
		diffuseColor.a = mix( diffuseColor.a, 0.0, alphaStep );

}
// Top Right
if( vUvB.x > cornerTR.x && vUvB.y > cornerTR.y ) {

		if( borderWidth.y + borderWidth.x > 0.0 ){

			float borderFactor = getEllipticFactor( vUvB, cornerTR, ( 1.0 - cornerTR.x ) - borderWidth.y,  ( 1.0 - cornerTR.y ) - borderWidth.x );
			float step = smoothstep( 1.0, 1.0 + fwidth( borderFactor ) * mult, borderFactor );
			diffuseColor = mix( diffuseColor, borderColor, step );

		}

		float radiusFactor = getEllipticFactor( vUvB, cornerTR, 1.0 - cornerTR.x, 1.0 - cornerTR.y );
		float alphaStep = smoothstep( 1.0 , 1.0 + fwidth(radiusFactor) * mult , radiusFactor );
		diffuseColor.a = mix( diffuseColor.a, 0.0, alphaStep );

}
// Bottom Right
if( vUvB.x > cornerBR.x && vUvB.y < cornerBR.y ) {

		if( borderWidth.y + borderWidth.z > 0.0 ){

			float borderFactor = getEllipticFactor( vUvB, cornerBR, ( 1.0 - cornerBR.x ) - borderWidth.y,  cornerBR.y - borderWidth.z );
			float step = smoothstep( 1.0, 1.0 + fwidth( borderFactor ) * mult, borderFactor );
			diffuseColor = mix( diffuseColor, borderColor, step );

		}

		float radiusFactor = getEllipticFactor( vUvB, cornerBR, 1.0 - cornerBR.x, cornerBR.y );
		float alphaStep = smoothstep( 1.0 , 1.0 + fwidth(radiusFactor) * mult , radiusFactor );
		diffuseColor.a = mix( diffuseColor.a, 0.0, alphaStep );

}

`,YT=NK,zK=`

// To be removed - required for both border and background
uniform vec3 frameSize;
uniform vec2 textureSize;

`,JT=zK,GK=`

#ifdef USE_MAP

vec4 sampleTexture() {

	vec2 uv = vUv;

	// default stretch
	#if BACKGROUND_MAPPING != 0

	float textureRatio = textureSize.x / textureSize.y;
	float panelRatio = frameSize.x / frameSize.y;
	float ratio = panelRatio / textureRatio;
	float ratio2 = textureRatio / panelRatio;

		// contain
		#if BACKGROUND_MAPPING == 1
		if ( textureRatio < panelRatio ) { // repeat on X
			float newX = uv.x * ratio;
			newX += 0.5 - 0.5 * ratio;
			uv.x = newX;
		} else { // repeat on Y
			float newY = uv.y * ratio2;
			newY += 0.5 - 0.5 * ratio2;
			uv.y = newY;
		}
		#else
		// cover
		if ( textureRatio < panelRatio ) { // stretch on Y
			float newY = uv.y * ratio2;
			newY += 0.5 - 0.5 * ratio2;
			uv.y = newY;
		} else { // stretch on X
			float newX = uv.x * ratio;
			newX += 0.5 - 0.5 * ratio;
			uv.x = newX;
		}

		#endif

	#endif

	return texture2D( map, uv );

}
#endif
`,KT=GK,VK=`
#ifdef USE_MAP

	vec4 textureSample = sampleTexture();
	diffuseColor *= textureSample;

#endif
`,ZT=VK,hN={msdfAlphaglyphParsVertexGlsl:PT,msdfAlphaglyphVertexGlsl:BT,msdfOffsetglyphVertexGlsl:DT,msdfAlphaglyphParsFragmentGlsl:OT,msdfAlphaglyphFragmentGlsl:kT,frameBorderParsVertexGlsl:jT,frameBorderVertexGlsl:qT,frameCommonParsFragmentGlsl:JT,frameBorderParsFragmentGlsl:XT,frameBorderFragmentGlsl:YT,frameBackgroundParsFragmentGlsl:KT,frameBackgroundFragmentGlsl:ZT},HK=`
// Would be automatic on three materials and from USE_UV
#ifdef USE_MAP
varying vec2 vUv;
#endif

${jT}

#include <clipping_planes_pars_vertex>

void main() {

	#ifdef USE_MAP
	vUv = uv;
	#endif

	${qT}

	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
	gl_Position = projectionMatrix * mvPosition;

	#include <clipping_planes_vertex>

}
`,QK=`

// Basic
uniform vec3 diffuse;
uniform float opacity;

#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif

${JT}

${XT}


#ifdef USE_MAP
varying vec2 vUv;
uniform sampler2D map;
#endif

${KT}

#include <clipping_planes_pars_fragment>

void main() {

	vec4 diffuseColor = vec4( diffuse, opacity );

	// map
	${ZT}

	${YT}

	#ifdef USE_ALPHATEST

	if ( diffuseColor.a < alphaTest ) discard;

	#endif

	// output
	gl_FragColor = diffuseColor;


	#include <clipping_planes_fragment>
}
`;class L0{static get mediation(){return jK}static ensureMaterialOptions(e){e.transparent=!0,e.alphaTest=e.alphaTest||.02}static ensureDefines(e){e.defines||(e.defines={})}static ensureUserData(e,t){e.userData.borderColor={value:null},e.userData.borderRadius={value:new ze.Vector4(0,0,0,0)},e.userData.cornerTL={value:new ze.Vector2(0,1)},e.userData.cornerTR={value:new ze.Vector2(1,1)},e.userData.cornerBR={value:new ze.Vector2(1,0)},e.userData.cornerBL={value:new ze.Vector2(0,0)},e.userData.borderWidth={value:new ze.Vector4(0,0,0,0)},e.userData.borderOpacity={value:null},e.userData.frameSize={value:new ze.Vector3(1,1,1)},e.userData.textureSize={value:new ze.Vector2(1,1)}}static bindUniformsWithUserData(e,t){e.uniforms.borderColor=t.userData.borderColor,e.uniforms.borderRadius=t.userData.borderRadius,e.uniforms.cornerTL=t.userData.cornerTL,e.uniforms.cornerTR=t.userData.cornerTR,e.uniforms.cornerBR=t.userData.cornerBR,e.uniforms.cornerBL=t.userData.cornerBL,e.uniforms.borderWidth=t.userData.borderWidth,e.uniforms.borderOpacity=t.userData.borderOpacity,e.uniforms.frameSize=t.userData.frameSize,e.uniforms.textureSize=t.userData.textureSize}static injectShaderChunks(e){L0.injectVertexShaderChunks(e),L0.injectFragmentShaderChunks(e)}static injectVertexShaderChunks(e){e.vertexShader=e.vertexShader.replace("#include <uv_pars_vertex>",`#include <uv_pars_vertex>
`+jT),e.vertexShader=e.vertexShader.replace("#include <uv_vertex>",`#include <uv_vertex>
`+qT)}static injectFragmentShaderChunks(e){e.fragmentShader=e.fragmentShader.replace("#include <map_pars_fragment>",`#include <map_pars_fragment>
`+KT),e.fragmentShader=e.fragmentShader.replace("#include <map_pars_fragment>",`#include <map_pars_fragment>
`+XT),e.fragmentShader=e.fragmentShader.replace("#include <map_pars_fragment>",`#include <map_pars_fragment>
`+JT),e.fragmentShader=e.fragmentShader.replace("#include <map_fragment>",ZT),e.fragmentShader=e.fragmentShader.replace("#include <alphamap_fragment>",YT+`
#include <alphamap_fragment>`)}}const WK=function(n,e,t){t=["stretch","contain","cover"].indexOf(t),SU(n,"BACKGROUND_MAPPING",t)},jK={clippingPlanes:{m:"clippingPlanes"},backgroundAlphaTest:{m:"alphaTest",t:__},backgroundSide:{m:"side"},backgroundImage:{m:"map"},backgroundColor:{m:"color"},backgroundOpacity:{m:"opacity"},backgroundSize:{m:"computedBackgroundSize",t:WK},borderWidth:{m:"borderWidth",t:co},borderColor:{m:"borderColor",t:co},cornerTL:{m:"cornerTL",t:co},cornerTR:{m:"cornerTR",t:co},cornerBR:{m:"cornerBR",t:co},cornerBL:{m:"cornerBL",t:co},borderOpacity:{m:"borderOpacity",t:co},size:{m:"frameSize",t:co},tSize:{m:"textureSize",t:co}};class uN extends ze.ShaderMaterial{static get mediation(){return L0.mediation}constructor(){super({uniforms:{alphaTest:{value:.02},map:{value:null},diffuse:{value:new ze.Color(16777215)},opacity:{value:1},borderColor:{value:new ze.Color(0)},borderOpacity:{value:0},borderRadius:{value:new ze.Vector4(0,0,0,0)},cornerTL:{value:new ze.Vector2(0,1)},cornerTR:{value:new ze.Vector2(1,1)},cornerBR:{value:new ze.Vector2(1,0)},cornerBL:{value:new ze.Vector2(0,0)},borderWidth:{value:new ze.Vector4(0,0,0,0)},frameSize:{value:new ze.Vector3(1,1,1)},textureSize:{value:new ze.Vector2(1,1)}},side:ze.FrontSide,transparent:!0,clipping:!0,vertexShader:HK,fragmentShader:QK,extensions:{derivatives:!0}}),this.defines.USE_ALPHATEST="",this.needsUpdate=!0}set map(e){this.uniforms.map.value=e,e?this.defines.USE_UV===void 0&&(this.defines.USE_UV="",this.needsUpdate=!0):this.defines.USE_UV!==void 0&&(delete this.defines.USE_UV,this.needsUpdate=!0),this.needsUpdate=!0}get map(){return this.uniforms.map.value}get alphaTest(){return this.uniforms.alphaTest.value}set alphaTest(e){this.uniforms.alphaTest.value=e}set opacity(e){this.uniforms&&(this.uniforms.opacity.value=e)}get opacity(){return this.uniforms.opacity.value}get color(){return this.uniforms.diffuse.value}set color(e){this.uniforms.diffuse.value=e}}class qK extends mi{constructor(){super("children",null,!1);h(this,"_sortOrder",(t,i)=>t._order._value<i._order._value?-1:t._order._value>i._order._value?1:this._uis.indexOf(t)<this._uis.indexOf(i)?-1:1);this._uis=[],this._boxes=[]}update(t,i){this._compute(t),t._layouter._needsUpdate=!0,t._renderOrder._needsUpdate=!0}process(t){this._compute(t),t._flexDirection._needsProcess=!0,t._layouter._needsProcess=!0,t._overflow._needsRender=!0}_compute(t){this._uis=t.children.filter(i=>i.visible&&i.isUI),this._boxes=this._uis.filter(i=>i.isBox).sort(this._sortOrder)}dispose(){this._uis=null,this._boxes=null}}class dN extends mi{constructor(){super("bounds",null,!1),this._size=new ze.Vector3(1,1,1),this._offsetWidth=0,this._offsetHeight=0,this._innerWidth=0,this._innerHeight=0,this._centerX=.5,this._centerY=.5,this._needsProcess=!0}setReferenceWidth(e,t){const i=e._width,s=e._padding._value,r=e._borderWidth._value,o=e._margin._value,a=i._auto?1:i._value,l=t*a-(o.y+o.w);aE(l,this._offsetWidth)||(this._offsetWidth=l,this._innerWidth=this._offsetWidth-(s.y+s.w+r.y+r.w),this._centerX=Xw(e),this._propagateWidth(e),this._triggerCascadingDependencies(e))}setReferenceHeight(e,t){const i=e._height,s=e._padding._value,r=e._borderWidth._value,o=e._margin._value,a=i._auto?1:i._value,l=t*a-(o.x+o.z);aE(l,this._offsetHeight)||(this._offsetHeight=l,this._innerHeight=this._offsetHeight-(s.x+s.z+r.x+r.z),this._centerY=Yw(e),this._propagateHeight(e),this._triggerCascadingDependencies(e))}setChildrenWidth(e,t){const i=e._padding._value,s=e._borderWidth._value;this._innerWidth=t,this._offsetWidth=this._innerWidth+(i.y+i.w+s.y+s.w),this._centerX=Xw(e),this._propagateWidth(e),this._triggerCascadingDependencies(e)}setChildrenHeight(e,t){const i=e._padding._value,s=e._borderWidth._value;this._innerHeight=t,this._offsetHeight=this._innerHeight+(i.x+i.z+s.x+s.z),this._centerY=Yw(e),this._propagateHeight(e),this._triggerCascadingDependencies(e)}update(e,t){const i=e._padding._value,s=e._borderWidth._value,r=e._width;!r._auto&&!r._relative&&(e._boxSizing._value==="content-box"?(this._innerWidth=r._value,this._offsetWidth=this._innerWidth+i.y+i.w+s.y+s.w):(this._offsetWidth=r._value,this._innerWidth=this._offsetWidth-(i.y+i.w+s.y+s.w)),this._centerX=Xw(e),this._needsProcess=!0,this._propagateWidth(e),this._triggerCascadingDependencies(e));const o=e._height;!o._auto&&!o._relative&&(e._boxSizing._value==="content-box"?(this._innerHeight=o._value,this._offsetHeight=this._innerHeight+i.x+i.z+s.x+s.z):(this._offsetHeight=o._value,this._innerHeight=this._offsetHeight-(i.x+i.z+s.x+s.z)),this._centerY=Yw(e),this._needsProcess=!0,this._propagateHeight(e),this._triggerCascadingDependencies(e))}render(e){this._size.x=this._offsetWidth,this._size.y=this._offsetHeight,e._backgroundMesh&&e._backgroundMesh.updateScale(),e._renderer._needsRender=!0}output(e){e.size=this._size}process(e){e._overflow._needsRender=!0}_computeChildrenSideWidth(e){return XK(e)}_computeChildrenSideHeight(e){return YK(e)}_propagateWidth(e){for(let t=0;t<e._children._boxes.length;t++){const i=e._children._boxes[t];i._width._relative&&i._bounds.setReferenceWidth(i,this._innerWidth)}}_propagateHeight(e){for(let t=0;t<e._children._boxes.length;t++){const i=e._children._boxes[t];i._height._relative&&i._bounds.setReferenceHeight(i,this._innerHeight)}}_triggerCascadingDependencies(e){e._parent._value&&(e._parent._value._autoSize._needsProcess=!0),e._flexDirection._needsProcess=!0,e._fontSize._needsProcess=!0,e._layouter._needsProcess=!0,this._needsRender=!0,e._borderWidth._needsRender=!0,e._borderRadius._needsRender=!0,e._overflow._needsRender=!0}}function Xw(n){const e=n._padding._value,t=n._borderWidth._value,i=e.w+t.w,s=e.y+t.y;return(i-s)/2}function Yw(n){const e=n._padding._value,t=n._borderWidth._value,i=e.x+t.x;return(e.z+t.z-i)/2}function XK(n){return n._children._boxes.reduce((e,t)=>{const i=t._margin._value,s=t._bounds._offsetWidth+i.y+i.w;return e+s},0)}function YK(n){return n._children._boxes.reduce((e,t)=>{const i=t._margin._value,s=t._bounds._offsetHeight+i.x+i.z;return e+s},0)}class JK extends MT{constructor(){super(),this._allowsInherit=!1,this._needsUpdate=!0,this._process=this.emptyStrategyLogic,this._childAlign=this.emptyStrategyLogic}computeOutputValue(e){switch(this._value=this._inheritedInput,e._flexDirection._value){case"row":case"row-reverse":switch(this._process=iZ,this._value){case"start":this._childAlign=ZK;break;case"end":this._childAlign=KK;break;default:this._childAlign=oD}break;case"column":case"column-reverse":switch(this._process=tZ,this._value){case"start":this._childAlign=eZ;break;case"end":this._childAlign=$K;break;default:this._childAlign=oD}break}this._needsProcess=!0,e._autoSize._needsProcess=!0,e._flexDirection._needsProcess=!0,e._justifyContent._needsProcess=!0,this._needsProcess=!0,e._fontSize._needsProcess=!0,e._layouter._needsProcess=!0}process(e){this._process(e,this._childAlign);let t="center",i="center",s="center";const r=e._padding._value,o=e._borderWidth._value;e._flexDirection._value.indexOf("column")!==-1?this._value==="start"?t=i="left":this._value==="end"?t=i="right":t="centerX":this._value==="start"?t=s="top":this._value==="end"?t=s="bottom":t="centerY";let a=-(r.x-r.z)/2-(o.x-o.z)/2,l=-(r.y-r.w)/2-(o.y-o.w)/2;i==="left"?l=(r.w-r.y)/2+(o.w-o.y)/2:i==="right"&&(l=-(r.y-r.w)/2-(o.y-o.w)/2),s==="top"?a=-(r.x-r.z)/2-(o.x-o.z)/2:s==="bottom"&&(a=(r.z-r.x)/2+(o.z-o.x)/2),e._children._boxes.forEach(c=>{let u=0,d=0;t==="top"?d=-c._margin._value.x:t==="bottom"?d=c._margin._value.z:t==="left"?u=c._margin._value.w:t==="right"?u=-c._margin._value.y:t==="centerX"?u=(c._margin._value.w-c._margin._value.y)/2:t==="centerY"&&(d=(-c._margin._value.x+c._margin._value.z)/2),e._layouter._childrenPos[c.id].x+=l+u,e._layouter._childrenPos[c.id].y+=a+d})}}function oD(){return 0}function KK(n,e){return-e+n._bounds._offsetHeight/2}function ZK(n,e){return e-n._bounds._offsetHeight/2}function $K(n,e){return e-n._bounds._offsetWidth/2}function eZ(n,e){return-e+n._bounds._offsetWidth/2}function tZ(n,e){const t=n._bounds._innerWidth/2;n._children._boxes.forEach(i=>{n._layouter._childrenPos[i.id].x=e(i,t)})}function iZ(n,e){const t=n._bounds._innerHeight/2;n._children._boxes.forEach(i=>{n._layouter._childrenPos[i.id].y=e(i,t)})}class nZ extends IT{constructor(){super(),this._allowsInherit=!1,this._needsUpdate=!0,this._offset=0,this._reverse=1,this._process=this.emptyStrategyLogic}computeOutputValue(e){switch(this._value=this._inheritedInput,this._value){case"row":this._process=sZ;break;case"row-reverse":this._process=rZ;break;case"column":this._process=oZ;break;case"column-reverse":this._process=aZ;break}e._justifyContent._needsUpdate||e._justifyContent.computeOutputValue(e),e._alignItems._needsUpdate||e._alignItems.computeOutputValue(e),this._needsProcess=!0}process(e){switch(this._value){case"row":this._offset=-e._bounds._innerWidth/2;break;case"row-reverse":this._offset=e._bounds._innerWidth/2;break;case"column":this._offset=e._bounds._innerHeight/2;break;case"column-reverse":this._offset=-e._bounds._innerHeight/2;break}this._reverse=-Math.sign(this._offset),this._reverse===0&&(this._reverse=1),this._process(e),e._justifyContent._needsProcess=!0,e._layouter._needsProcess=!0}}function sZ(n){let e=n._flexDirection._offset;const t=n._flexDirection._reverse,i=n._children._boxes;for(let s=0;s<i.length;s++){const r=i[s],o=r.id,a=r._bounds._offsetWidth;e+=r._margin._value.w*t;const l=n._layouter._childrenPos[o];l.x=e+a/2*t,l.y=0,e+=t*(a+r._margin._value.y)}}function rZ(n){let e=n._flexDirection._offset;const t=n._flexDirection._reverse,i=n._children._boxes;for(let s=0;s<i.length;s++){const r=i[s],o=r.id,a=r._bounds._offsetWidth;e+=r._margin._value.y*t;const l=n._layouter._childrenPos[o];l.x=e+a/2*t,l.y=0,e+=(a+r._margin._value.w)*t}}function oZ(n){let e=n._flexDirection._offset;const t=n._flexDirection._reverse,i=n._children._boxes;for(let s=0;s<i.length;s++){const r=i[s],o=r.id,a=r._bounds._offsetHeight;e+=r._margin._value.x*t;const l=n._layouter._childrenPos[o];l.x=0,l.y=e+a/2*t,e+=(a+r._margin._value.z)*t}}function aZ(n){let e=n._flexDirection._offset;const t=n._flexDirection._reverse,i=n._children._boxes;for(let s=0;s<i.length;s++){const r=i[s],o=r.id,a=r._bounds._offsetHeight;e+=r._margin._value.z*t;const l=n._layouter._childrenPos[o];l.x=0,l.y=e+a/2*t,e+=(a+r._margin._value.x)*t}}class lZ extends RT{constructor(e){super("justifyContent",e,!0),this._allowsInherit=!1,this._needsUpdate=!0,this._computeOffset=this.emptyStrategyLogic,this._computeMargin=this.emptyStrategyLogic,this._process=this.emptyStrategyLogic}computeOutputValue(e){switch(this._value=this._inheritedInput,e._flexDirection._value){case"column-reverse":case"column":this._process=hZ.bind(this);break;case"row-reverse":case"row":this._process=cZ.bind(this);break}switch(this._value){case"end":this._computeOffset=fZ,this._computeMargin=Jw;break;case"center":this._computeOffset=pZ,this._computeMargin=Jw;break;case"start":this._computeOffset=Zv,this._computeMargin=Jw;break;case"space-between":this._computeOffset=Zv,this._computeMargin=gZ;break;case"space-around":this._computeOffset=Zv,this._computeMargin=AZ;break;case"space-evenly":this._computeOffset=Zv,this._computeMargin=mZ;break}e._flexDirection._needsProcess=!0}process(e){this._process(e),e._alignItems._needsProcess=!0}}function cZ(n){const e=n._flexDirection._offset,{usedDirectionSpace:t,remainingSpace:i}=uZ(n),s=e*2-t*Math.sign(e),r=this._computeOffset(s),o=this._computeMargin(n,i,n._flexDirection._reverse);n._children._boxes.forEach((a,l)=>{n._layouter._childrenPos[a.id].x-=r-o[l]})}function hZ(n){const e=n._flexDirection._offset,{usedDirectionSpace:t,remainingSpace:i}=dZ(n),s=e*2-t*Math.sign(e),r=this._computeOffset(s),o=this._computeMargin(n,i,n._flexDirection._reverse);n._children._boxes.forEach((a,l)=>{n._layouter._childrenPos[a.id].y-=r-o[l]})}function uZ(n){const e=n._bounds._computeChildrenSideWidth(n);return{usedDirectionSpace:e,remainingSpace:n._bounds._innerWidth-e}}function dZ(n){const e=n._bounds._computeChildrenSideHeight(n);return{usedDirectionSpace:e,remainingSpace:n._bounds._innerHeight-e}}function Zv(n){return 0}function fZ(n){return n}function pZ(n){return n/2}function Jw(n,e=0,t=1){return Array(n._children._boxes.length).fill(0)}function gZ(n,e=0,t=1){const s=n._children._boxes.length,r=Array(s).fill(0);if(e>0&&s>1){const o=e/(s-1)*t;r[0]=0;for(let a=1;a<s;a++)r[a]=o*a}return r}function mZ(n,e=0,t=1){const s=n._children._boxes.length,r=Array(s).fill(0);if(e>0){const o=e/(s+1)*t;for(let a=0;a<s;a++)r[a]=o*(a+1)}return r}function AZ(n,e=0,t=1){const s=n._children._boxes.length,r=Array(s).fill(0);if(e>0){const o=e/s*t,a=o/2;r[0]=a;for(let l=1;l<s;l++)r[l]=a+o*l}return r}let Kw;class fN extends ze.Mesh{constructor(e){const t=e.slice,i={};let s=1,r=1;if(t){if(s=t.width?t.width:1,r=t.height?t.height:1,t.top){if(t.left){const f=new ze.PlaneGeometry(t.left*s,t.top*r,1,1);ll(f,0,t.left,1-t.top,1),f.translate(t.left*s/2,-t.top*r/2,0),i.topLeft=f}const d=new ze.PlaneGeometry(1,t.top*r,1,1);if(ll(d,t.left,1-t.right,1-t.top,1),d.translate(0,-t.top*r/2,0),i.top=d,t.right){const f=new ze.PlaneGeometry(t.right*s,t.top*r,1,1);ll(f,1-t.right,1,1-t.top,1),f.translate(-t.right*s/2,-t.top*r/2,0),i.topRight=f}}if(t.left){const d=new ze.PlaneGeometry(t.left*s,1,1,1);ll(d,0,t.left,t.bottom,1-t.top),d.translate(t.left*s/2,0,0),i.left=d}const u=new ze.PlaneGeometry(1,1,1,1);if(ll(u,t.left,1-t.right,t.bottom,1-t.top),i.middle=u,t.right){const d=new ze.PlaneGeometry(t.right*s,1,1,1);ll(d,1-t.right,1,t.bottom,1-t.top),d.translate(-t.right*s/2,0,0),i.right=d}if(t.bottom){if(t.left){const f=new ze.PlaneGeometry(t.left*s,t.bottom*r,1,1);ll(f,0,t.left,0,t.bottom),f.translate(t.left*s/2,t.bottom*r/2,0),i.bottomLeft=f}const d=new ze.PlaneGeometry(1,t.bottom*r,1,1);if(ll(d,t.left,1-t.right,0,t.bottom),d.translate(0,t.bottom*r/2,0),i.bottom=d,t.right){const f=new ze.PlaneGeometry(t.right*s,t.bottom*r,1,1);ll(f,1-t.right,1,0,t.bottom),f.translate(-t.right*s/2,t.bottom*r/2,0),i.bottomRight=f}}}let o=e.backgroundMaterial;t&&(Kw||(Kw=new ze.MeshBasicMaterial({alphaTest:1.1})),o=Kw);const a=new ze.PlaneGeometry(1,1,e._segments.value,e._segments.value),l=new ze.BufferAttribute(new Float32Array(a.getAttribute("uv").array),2);if(a.setAttribute("uvB",l).name="uvB",super(a,o),this.name="UIBackgroundBox",t){this.slice=t,this.sliceSize=new ze.Vector3(1-(t.left+t.right),1-(t.bottom+t.top),1),this.sliceScale=new ze.Vector3(s,r,1);for(const c in i){const u=new ze.Mesh(i[c],e.backgroundMaterial);this.add(u),i[c]=u}this.updateScale=this.updateScaleSlice,this.slices=i}}updateScale(){}updateScaleSlice(){const e=new ze.Vector3(1,1,1);this.scale.x<(this.slice.left+this.slice.right)*this.sliceScale.x&&(e.x=this.scale.x/((this.slice.left+this.slice.right)*this.sliceScale.x)),this.scale.y<(this.slice.bottom+this.slice.top)*this.sliceScale.y&&(e.y=this.scale.y/((this.slice.bottom+this.slice.top)*this.sliceScale.y));for(const t in this.slices){const i=this.slices[t];i.scale.set(1/this.scale.x,1/this.scale.y,this.scale.y);const s=vZ[t];for(const o in s)i.position[o]=this.scale[o]*s[o]*i.scale[o];const r=yZ[t];if(r){r.x&&(i.position.x=this.sliceScale.x*.5*(this.slice.left-this.slice.right)*(1/this.scale.x)),r.y&&(i.position.y=this.sliceScale.y*.5*(this.slice.bottom-this.slice.top)*(1/this.scale.y));for(const o in r){const a=this.scale[o]-(1-this.sliceSize[o])*this.sliceScale[o];i.scale[o]=Math.max(0,a*(1/this.scale[o]))}}}e.x!==1&&(this.slices.left.scale.x*=e.x,this.slices.topLeft.scale.x*=e.x,this.slices.bottomLeft.scale.x*=e.x,this.slices.right.scale.x*=e.x,this.slices.topRight.scale.x*=e.x,this.slices.bottomRight.scale.x*=e.x),e.y!==1&&(this.slices.top.scale.y*=e.y,this.slices.topLeft.scale.y*=e.y,this.slices.topRight.scale.y*=e.y,this.slices.bottom.scale.y*=e.y,this.slices.bottomLeft.scale.y*=e.y,this.slices.bottomRight.scale.y*=e.y)}}const vZ={topLeft:{x:-.5,y:.5},top:{y:.5},topRight:{x:.5,y:.5},left:{x:-.5},right:{x:.5},bottomLeft:{x:-.5,y:-.5},bottom:{y:-.5},bottomRight:{x:.5,y:-.5}},yZ={top:{x:1},left:{y:1},right:{y:1},bottom:{x:1},middle:{x:1,y:1}};function ll(n,e,t,i,s){const r=t-e,o=s-i,a=n.attributes.uv;for(let c=0;c<a.count;c++){const u=a.getX(c),d=a.getY(c);a.setXY(c,e+u*r,i+d*o)}const l=new ze.BufferAttribute(new Float32Array(n.getAttribute("uv").array),2);n.setAttribute("uvB",l).name="uvB"}class pN extends mi{constructor(){super("renderer")}render(e){e._backgroundMesh||e.setBackgroundMesh(new fN(e)),e.performAfterUpdate()}}class bZ extends gU{constructor(){super("position")}update(e,t){super.update(e,t),this._needsProcess=!0}}class _Z extends mi{constructor(){super("autosize"),this._needsProcess=!0}process(e){e._width._auto&&xZ(e),e._height._auto&&wZ(e);const t=e._alignItems._value==="stretch",i=t&&e._flexDirection._value.indexOf("column")!==-1,s=t&&!i;for(const r of e._children._boxes)(r._width._auto&&i||r._width._relative)&&r._bounds.setReferenceWidth(r,e._bounds._innerWidth),(r._height._auto&&s||r._height._relative)&&r._bounds.setReferenceHeight(r,e._bounds._innerHeight)}}function xZ(n){n._bounds.setChildrenWidth(n,CZ(n))}function wZ(n){n._bounds.setChildrenHeight(n,SZ(n))}function SZ(n){switch(n._flexDirection._value){case"row":case"row-reverse":return IZ(n);case"column":case"column-reverse":return MZ(n)}}function CZ(n){switch(n._flexDirection._value){case"row":case"row-reverse":return EZ(n);case"column":case"column-reverse":return TZ(n)}}function EZ(n){let e=0;for(const t of n._children._boxes){if(t._position._value!=="static")continue;const i=t._margin._value,s=t._bounds._offsetWidth+i.y+i.w;e+=s}return e}function MZ(n){let e=0;for(const t of n._children._boxes){if(t._position._value!=="static")continue;const i=t._margin._value,s=t._bounds._offsetHeight+i.x+i.z;e+=s}return e}function TZ(n){let e=0;for(const t of n._children._boxes){if(t._position._value!=="static")continue;const i=t._margin._value,s=t._bounds._offsetWidth+i.y+i.w;s>e&&(e=s)}return e}function IZ(n){let e=0;for(const t of n._children._boxes){if(t._position._value!=="static")continue;const i=t._margin._value,s=t._bounds._offsetHeight+i.x+i.z;s>e&&(e=s)}return e}class Um extends vA{constructor(e,t){Um.definePropertiesValues(e,t),super(e,t),Um.init(this)}bindBackgroundMeshProperties(){this._bounds._size=this._backgroundMesh.scale,this._bounds._needsProcess=!0}unbindBackgroundMeshProperties(){this._bounds._size=new ze.Vector3(1,1,1),this._bounds._needsProcess=!0}static definePropertiesValues(e,t){e.children||(e.children=qK),e.bounds||(e.bounds=dN),e.flexDirection||(e.flexDirection=nZ),e.justifyContent||(e.justifyContent=lZ),e.alignItems||(e.alignItems=JK),e.position||(e.position=bZ),e.autoSize||(e.autoSize=_Z),e.renderer||(e.renderer=pN),t.fontSide||(t.fontSide=0),t.invertAlpha||(t.invertAlpha=!1),t.fontCastShadow||(t.fontCastShadow=!1),t.fontReceiveShadow||(t.fontReceiveShadow=!1),t.backgroundCastShadow||(t.backgroundCastShadow=!1),t.backgroundReceiveShadow||(t.backgroundReceiveShadow=!1)}static init(e){Object.defineProperties(e,{isBox:{configurable:!1,enumerable:!0,value:!0}}),e.backgroundMaterial=new uN,e._renderer.render(e),e._backgroundMesh.visible=!1}}class aD extends Array{constructor(...e){super(...e),this.width=0,this.lineBase=0,this.lineHeight=0,this.y=0}}class RZ extends mi{constructor(){super("layouter",null,!1),this._needsUpdate=!0,this._childrenPos={}}update(e,t){this._childrenPos={};for(const i of e._children._boxes)i._position._value==="static"&&(this._childrenPos[i.id]=i.position)}process(e){}}class Nm extends Um{constructor(e={}){const t={};Nm.definePropertiesValues(t,e),super(t,e),Nm.init(this)}add(e){const t=[];for(let i=0;i<arguments.length;i++){const s=arguments[i];!s.isUI||s.isBox?t.push(s):console.warn("Block element can only contain Box elements.",s)}return super.add(...t)}static definePropertiesValues(e,t){e.layouter=RZ}static init(e){Object.defineProperties(e,{isBlock:{configurable:!1,enumerable:!0,value:!0}})}}class PZ extends mi{constructor(){super("textContent",null,!1)}update(e,t){e._glyphs._needsUpdate=!0,e._whiteSpace._needsProcess=!0}}class BZ extends mi{constructor(){super("inlines",null,!1),this._value=null}process(e){if(this._value=e._glyphs._value.map(t=>t.asInlineGlyph()),this._value.length){this._value[0].paddingLeft=e._padding._value.w,this._value[0].marginLeft=e._margin._value.w;const t=this._value.length-1;this._value[t].paddingRight=e._padding._value.y,this._value[t].marginRight=e._margin._value.y}e._fontSize._needsProcess=!0,e._lineBreak._needsProcess=!0,e._fontKerning._needsProcess=!0,e._layouter._needsProcess=!0}get value(){return this._value}}class DZ extends mi{constructor(){super("glyphs",null,!1),this._needsUpdate=!1,this._value=null}process(e){e._font._fontVariant&&e._font._fontVariant.isReady&&(this._value=e._whiteSpace._whiteSpacedContent.split("").map(t=>e._font._fontVariant.getTypographicGlyph(t)),this._value&&(e._inlines._needsProcess=!0))}get value(){return this._value}}class OZ extends km{constructor(){super("color","inherit",!1),this.output=this._outputValue}computeOutputValue(e){this._input==="inherit"?this._value.set(this.getInheritedInput(e)):this._value.set(this._input)}}class gN extends mi{constructor(e=`- ,.:?!
`){super("lineBreak",e,!0),this._newLineBreakability=null}update(e,t){this._needsProcess=!0}process(e){const t=e._whiteSpace._newLineBreakability;if(e._inlines._value)for(let i=0;i<e._inlines._value.length;i++){const s=e._inlines._value[i],r=s.char;let o=null;r!==void 0&&(t!=="nowrap"&&(this._value.includes(r)||r.match(/\s/g))&&(o="possible"),r.match(/\n/g)&&(o=t)),s.lineBreak=o}}get value(){return this._value}}class mN extends mi{constructor(){super("layouter",null,!1),this._value=null}update(e,t){this._value=e._parent.find(i=>i.isUI&&i.isText),this._needsProcess=!0}process(e){this._value&&(this._value._layouter._needsProcess=!0)}}class kZ extends km{constructor(e){super("backgroundColor",e,!1),this._allowsInherit=!1,this._input=0}computeOutputValue(e){this._input==="inherit"?this._value.set(this.getInheritedInput(e)):this._value.set(this._input)}}class AN extends vU{constructor(){super(),this._allowsInherit=!1,this.computeOutputValue=this._computeFromInherited}}class vN extends yU{constructor(){super()}computeOutputValue(e){this._value=ET(this.getInheritedInput(e))}}class yN extends EU{constructor(){super("fontFamily","inherit",!0),this._input="inherit",this._needsUpdate=!0,this._allowsInherit=!1}computeOutputValue(e){let t=this._inheritedInput;if(t==="inherit"&&(t=this.getInheritedInput(e)),t instanceof x_)this._value=t,e._font._needsUpdate=!0;else if(typeof t=="string"){const i=Du.getFontFamily(t);i?(this._value=i,e._font._needsUpdate=!0):console.warn(`(.style) fontFamily, the font '${t}' is not registered. Aborted.`)}else console.warn("(.style) fontFamily requires a registered fontFamily instance, or the id of a registered fontFamily."),console.warn("If you want to set a specific font, please use .font property instead.")}get value(){return this._value}}class $T extends TU{constructor(){super(),this._allowsInherit=!1,this.computeOutputValue=this._computeFromInherited,this._whiteSpacedContent="",this._stringCollapser=this.emptyStrategyLogic,this._inlineCollapser=this.emptyStrategyLogic,this._inlineWrapper=this.emptyStrategyLogic}_computeFromInherited(e){switch(super._computeFromInherited(e),this._newLineBreakability=LZ(this._value),this._value){case"nowrap":case"normal":this._stringCollapser=FZ;break;case"pre-line":this._stringCollapser=bN;break;default:this._stringCollapser=UZ}switch(this._value){case"pre-line":case"nowrap":case"normal":this._inlineCollapser=HZ;break;case"pre-wrap":this._inlineCollapser=VZ;break;default:this._inlineCollapser=QZ}switch(this._value){case"pre-line":case"pre-wrap":case"normal":this._inlineWrapper=NZ;break;case"pre":this._inlineWrapper=zZ;break;default:this._inlineWrapper=GZ}this._needsProcess=!0}process(e){e.isInline&&!e.isInlineBlock&&(this._whiteSpacedContent=this._stringCollapser(e._textContent._value),e._glyphs._needsProcess=!0)}}const lD={"	":"	","\n":`
`,"\r":"\r"," ":" "},LZ=function(n){switch(n){case"pre":case"pre-wrap":case"pre-line":return"mandatory"}return null};function FZ(n){return bN(n.replace(/\n/g," "))}function bN(n){return n.replace(/[ ]{2,}/g," ")}function UZ(n){return n}function NZ(n,e,t,i){const s=n[e];if(s.lineBreak==="mandatory"||t+s.xadvance+s.xoffset+s.kerning>i.INNER_WIDTH)return!0;const r=wN(n,e,i);return WZ(n[e-1],t,r,i)}function zZ(n,e,t,i){return n[e].lineBreak==="mandatory"}function GZ(){return!1}function VZ(n){if(!n[0])return 0;const e=n[0],t=n[n.length-1];return e.char&&e.char===`
`&&n.length>1&&xN([e],n[1]),t.char&&t.char===`
`&&n.length>1&&_N([t],n[n.length-2]),e.offsetX}function HZ(n){if(!n[0])return 0;let e=[],t;for(let i=0;i<n.length;i++){const s=n[i];if(s.char&&lD[s.char]&&n.length>i){e.push(s),t=n[i+1];continue}break}xN(e,t),e=[],t=null;for(let i=n.length-1;i>0;i--){const s=n[i];if(s.char&&lD[s.char]&&i>0){e.push(s),t=n[i-1];continue}break}return _N(e,t),n[0].offsetX}function QZ(n){return n[0]?n[0].offsetX:0}function _N(n,e){if(e)for(let t=0;t<n.length;t++){const i=n[t];i.fontFactor=0,i.offsetX=e.offsetX+e.cumulativeWidth,i.cumulativeWidth=0}}function xN(n,e){if(e)for(let t=0;t<n.length;t++){const i=n[t];i.fontFactor=0,i.offsetX=e.offsetX,i.cumulativeWidth=0}}function wN(n,e,t,i){if(i=i||0,!n[e])return i;const s=n[e];return s.lineBreak?i+s.xadvance:wN(n,e+1,t,i+s.xadvance+s.xoffset+s.kerning+t.LETTERSPACING)}function WZ(n,e,t,i){return!n||!n.char||e+t<i.INNER_WIDTH?!1:i.BREAKON.indexOf(n.char)>-1}class SN extends IU{constructor(){super(),this._input="inherit",this._allowsInherit=!1,this.computeOutputValue=this._computeFromInherited}_computeFromInherited(e){super._computeFromInherited(e),e._fontSize._needsProcess=!0,e._layouter._needsProcess=!0}}class CN extends Vi{constructor(){super("fontSize","inherit",!0),this._allowsInherit=!1}computeOutputValue(e){this._value=this._inheritedInput,e._font._fontVariant&&(e._bounds._needsProcess=!0,e._layouter._needsProcess=!0)}process(e){if(!e._font._fontVariant||!e._font._fontVariant.isReady)return;const t=this._value/e._font._fontVariant.typographic.size,i=e._inlines._value;for(let s=0;s<i.length;s++){const r=i[s];r.resetOffsets(),r.fontSize=this._value,r.fontFactor=t}}get value(){return this._value}}class EN extends RU{constructor(){super("segments",1,!1),this._notInheritedValue=void 0}update(e,t){this._notInheritedValue=this._value,this._notInheritedValue==="inherit"&&(this._notInheritedValue=this.getInheritedInput(e)),e._layouter._needsUpdate=!0}set value(e){this._value!==e&&(this._value=e,this._needsUpdate=!0)}get value(){return this._value==="inherit"?this._notInheritedValue:this._value}}class jZ extends EN{constructor(){super(),this._value="inherit"}}class qZ extends w_{constructor(){super(),this._allowsInherit=!1,this.computeOutputValue=this._computeFromInherited}_computeFromInherited(e){super._computeFromInherited(e),e._parent._value._layouter._needsProcess=!1}process(e){if(this._value!=="none"){const t=e._whiteSpace._whiteSpacedContent,i=e._inlines._value;for(let s=1;s<i.length;s++){const r=t[s-1]+t[s];i[s].kerning=e._font._fontVariant.getKerningAmount(r)}}}}class MN extends mi{constructor(){super("children",null,!1),this._uis=[]}update(e,t){}process(e){}_compute(e){}dispose(){}}function XZ(n,e=!1){const t=n[0].index!==null,i=new Set(Object.keys(n[0].attributes)),s=new Set(Object.keys(n[0].morphAttributes)),r={},o={},a=n[0].morphTargetsRelative,l=new ze.BufferGeometry;let c=0;for(let u=0;u<n.length;++u){const d=n[u];let f=0;if(t!==(d.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const p in d.attributes){if(!i.has(p))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+'. All geometries must have compatible attributes; make sure "'+p+'" attribute exists among all geometries, or in none of them.'),null;r[p]===void 0&&(r[p]=[]),r[p].push(d.attributes[p]),f++}if(f!==i.size)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+". Make sure all geometries have the same number of attributes."),null;if(a!==d.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const p in d.morphAttributes){if(!s.has(p))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+".  .morphAttributes must be consistent throughout all geometries."),null;o[p]===void 0&&(o[p]=[]),o[p].push(d.morphAttributes[p])}if(l.userData.mergedUserData=l.userData.mergedUserData||[],l.userData.mergedUserData.push(d.userData),e){let p;if(t)p=d.index.count;else if(d.attributes.position!==void 0)p=d.attributes.position.count;else return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+". The geometry must have either an index or a position attribute"),null;l.addGroup(c,p,u),c+=p}}if(t){let u=0;const d=[];for(let f=0;f<n.length;++f){const p=n[f].index;for(let g=0;g<p.count;++g)d.push(p.getX(g)+u);u+=n[f].attributes.position.count}l.setIndex(d)}for(const u in r){const d=cD(r[u]);if(!d)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+u+" attribute."),null;l.setAttribute(u,d)}for(const u in o){const d=o[u][0].length;if(d===0)break;l.morphAttributes=l.morphAttributes||{},l.morphAttributes[u]=[];for(let f=0;f<d;++f){const p=[];for(let A=0;A<o[u].length;++A)p.push(o[u][A][f]);const g=cD(p);if(!g)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+u+" morphAttribute."),null;l.morphAttributes[u].push(g)}}return l}function cD(n){let e,t,i,s=0;for(let a=0;a<n.length;++a){const l=n[a];if(l.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(e===void 0&&(e=l.array.constructor),e!==l.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(t===void 0&&(t=l.itemSize),t!==l.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(i===void 0&&(i=l.normalized),i!==l.normalized)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;s+=l.array.length}const r=new e(s);let o=0;for(let a=0;a<n.length;++a)r.set(n[a].array,o),o+=n[a].array.length;return new ze.BufferAttribute(r,t,i)}class YZ extends mi{constructor(){super("renderer")}render(e){if(!e._inlines._value||!e._inlines._value.length)return;const t=e._inlines._value.map(s=>e._font._fontVariant.getGeometricGlyph(s,e).translate(s.offsetX,s.offsetY,0)),i=XZ(t);e.setFontMesh(new ze.Mesh(i,e.fontMaterial)),e._fontMesh.renderOrder=1/0}}class JZ extends TT{constructor(){super(),this._allowsInherit=!1,this._needsUpdate=!1}computeOutputValue(e){this._value=this._inheritedInput,e._layouter._needsProcess=!0}}class Vf extends vA{constructor(t={}){const i={};Vf.definePropertiesValues(i,t);super(i,t);h(this,"_rebuildParentUI",()=>{super._rebuildParentUI(),this._layouter._needsUpdate=!0});Vf.init(this)}add(t){const i=[];for(let s=0;s<arguments.length;s++){const r=arguments[s];!r.isUI||r.isInline?(i.push(r),r.position.z=.005):console.warn("Block element can only contain Box elements.",r)}return super.add(...i)}set textContent(t){this._textContent.value=t}get textContent(){return this._textContent._value}set invertAlpha(t){this._invertAlpha.value=t}get invertAlpha(){return this._invertAlpha._value}static definePropertiesValues(t,i){t.children||(t.children=MN),t.textContent||(t.textContent=PZ),t.glyphs||(t.glyphs=DZ),t.inlines||(t.inlines=BZ),t.layouter||(t.layouter=mN),t.renderer||(t.renderer=YZ),t.fontFamily||(t.fontFamily=yN),t.fontWeight||(t.fontWeight=vN),t.fontStyle||(t.fontStyle=AN),t.fontSize||(t.fontSize=CN),t.color||(t.color=OZ),t.backgroundColor||(t.backgroundColor=kZ),t.lineBreak||(t.lineBreak=gN),t.letterSpacing||(t.letterSpacing=SN),t.whiteSpace||(t.whiteSpace=$T),t.segments||(t.segments=jZ),t.textAlign||(t.textAlign=JZ),t.fontKerning||(t.fontKerning=qZ)}static init(t){Object.defineProperties(t,{isInline:{configurable:!1,enumerable:!0,value:!0}})}}class KZ extends AU{constructor(){super("textContent",null,!1),this._needsUpdate=!1}set value(e){this._value!==e&&(this._value=e,this._needsUpdate=!0)}update(e,t){this._needsUpdate=!1;for(let i=e.children.length-1;i>=0;i--){const s=e.children[i];s.isUI&&(e.remove(s),s.clear())}e._children._uis=[],this._value&&e.add(new Vf({name:"anonymousInline",textContent:this._value}))}}class ZZ extends Array{constructor(...e){super(...e),this.width=0,this.height=0}}class $Z extends mi{constructor(){super("layouter",null,!1),this._value=null}update(e,t){}process(e){let t=e._width._value;e._width._auto?t=1/0:t=e._bounds._innerWidth;const i=e._lineHeight._value,s=new ZZ(new aD);let r=0;e._children._inlines.forEach(d=>{if(!d._inlines.value)return;this._resetInlines(d);const f=d._fontSize._value,p=d._letterSpacing._value*f,g=d._whiteSpace._value,A=d._lineBreak._value,v={WHITESPACE:g,LETTERSPACING:p,BREAKON:A,INNER_WIDTH:t},m=d._whiteSpace._inlineWrapper;r+=d._margin._value.w+d._padding._value.w,d._inlines.value.forEach((b,y,_)=>{const E=s[s.length-1];if(m(_,y,r,v)){if(s.push(new aD(b)),b.offsetX=b.xoffset,b.width===0){r=0;return}b.cumulativeWidth=b.xadvance+p,r=b.cumulativeWidth;return}s[s.length-1].push(b),b.offsetX=r+b.xoffset+b.kerning,b.cumulativeWidth=b.xadvance+b.kerning+p,r+=b.cumulativeWidth,E.length-1===1&&E[E.length-2].width===0&&(b.offsetX-=b.xoffset,r-=b.xoffset)}),r+=d._margin._value.y+d._padding._value.y});const o=e._whiteSpace._inlineCollapser;let a=0,l=0,c=0;s.forEach((d,f)=>{const p=o(d);let g=0,A=0;if(d.forEach(v=>{g=Math.max(g,v.lineHeight),A=Math.max(A,v.lineBase),v.offsetX-=p}),d.lineHeight=g,d.lineBase=A,f===0?c=-(g*i-g)*.5:c-=s[f-1].lineHeight*i,d.y=c,d.x=0,d.forEach(v=>{v.offsetY=c-v.anchor,v.lineHeight<d.lineHeight&&(v.offsetY-=d.lineBase-v.lineBase)}),l+=d.lineHeight*i,d.width=0,d[0]){const v=d[d.length-1];d.width=v.offsetX+v.cumulativeWidth+v.paddingRight+v.marginRight+d[0].offsetX,a=Math.max(a,d.width)}}),s.height=l,s.width=a,this._value=s,t===1/0&&e._bounds.setChildrenWidth(e,s.width),e._height._auto&&e._bounds.setChildrenHeight(e,s.height);const u=e._parent._value;u&&(u._autoSize._needsProcess=!0,u._flexDirection._needsProcess=!0),e._inlineJustificator._needsProcess=!0,e._textAlign._needsProcess=!0,e._overflow._needsUpdate=!0}_resetInlines(e){e._fontSize.process(e)}}class e$ extends TT{constructor(){super(),this._allowsInherit=!1,this._needsUpdate=!0}computeOutputValue(e){this._value=this._inheritedInput,this._needsProcess=!0}process(e){t$(e),e._renderer._needsRender=!0}}function t$(n){const e=n._layouter._value,t=n._textAlign._value,i=n._bounds._innerWidth;for(let s=0;s<e.length;s++){const r=e[s],o=i$(n,r,s===e.length-1),a=n._padding._value,l=n._borderWidth._value,c=(-a.w+a.y)/2+(-l.w+l.y)/2;r.x+=o;for(let u=0;u<r.length;u++)r[u].offsetX+=o-c}if(t.indexOf("justify")===0)for(let s=0;s<e.length;s++){const r=e[s];if(t.indexOf("-")!==-1&&s===e.length-1)return;const o=i-r.width;if(o<=0)return;let a=0;for(let d=1;d<r.length-1;d++)a+=r[d].char===" "?1:0;const l=o/a;let c=1;t==="justify-right"&&(r.reverse(),c=-1);let u=0;for(let d=1;d<=r.length-1;d++){const f=r[d];f.offsetX+=u*c,u+=f.char===" "?l:0}t==="justify-right"&&r.reverse()}}function i$(n,e,t){switch(n._textAlign._value){case"justify-left":case"justify":case"left":return-n._bounds._innerWidth/2;case"justify-right":case"right":return-e.width+n._bounds._innerWidth/2;case"center":return-e.width/2;case"justify-center":return t?-e.width/2:-n._bounds._innerWidth/2;default:console.warn(`textAlign: '${n._textAlign._value}' is not valid`)}}class n$ extends IT{constructor(){super(),this._value=this._input="column",this._allowsInherit=!1,this._needsUpdate=!0}computeOutputValue(e){this._value=this._inheritedInput}}class s$ extends MU{constructor(){super(),this._allowsInherit=!1,this.computeOutputValue=this._computeFromInherited}}class r$ extends w_{constructor(){super(),this._value=this._input=this.getDefaultValue(),this._allowsInherit=!1,this.computeOutputValue=this._computeFromInherited}_computeFromInherited(e){super._computeFromInherited(e)}}class o$ extends dN{constructor(){super(),this._innerWidth=1/0,this._innerHeight=0}}class a$ extends mi{constructor(){super("children",null,!1);h(this,"_sortOrder",(t,i)=>t._order._value<i._order._value?-1:t._order._value>i._order._value?1:this._uis.indexOf(t)<this._uis.indexOf(i)?-1:1);this._uis=[],this._inlines=[],this._boxes=[]}update(t,i){this._compute(t),this._needsProcess=!0}process(t){this._compute(t),t._overflow._needsRender=!0}_compute(t){this._uis=t.children.filter(i=>i.visible&&i.isUI),this._inlines=this._uis.filter(i=>i.isInline).sort(this._sortOrder)}dispose(){this._inlines=null}}class l$ extends mi{constructor(){super("autosize")}process(e){if(e._layouter._value&&e._layouter._value.length){const t=e._layouter._value,i=e._padding._value,s=e._borderWidth._value;e._width._auto&&e._bounds.setOffsetWidth(e,t.width+i.w+i.y+s.w+s.y),e._height._auto&&e._bounds.setOffsetHeight(e,t.height+i.x+i.z+s.x+s.z)}}}class c$ extends pN{constructor(){super("renderer"),this._needsUpdate=!1}render(e){super.render(e);for(const t of e._children._inlines)t._renderer.render(t);e.performAfterUpdate()}}class zm extends Um{constructor(e={},t={}){zm.definePropertiesValues(t,e),super(t,e),zm.init(this)}add(e){const t=[];let i=!1;for(let s=0;s<arguments.length;s++){const r=arguments[s];!r.isUI||r.isInline?(r.isInline&&(i=!0),t.push(r)):console.warn("Block element can only contain Box elements.",r)}return t.length>0&&super.add(...t),i&&(this._children._needsUpdate=!0,this._layouter._needsProcess=!0),this}set textContent(e){this._textContent.value=e}get textContent(){return super.textContent}set invertAlpha(e){this._invertAlpha.value=e}get invertAlpha(){return this._invertAlpha._value}get lines(){return this._layouter._value}static definePropertiesValues(e,t){e.flexDirection=n$,e.justifyContent=RT,e.alignItems=MT,e.bounds=o$,e.autoSize=l$,e.renderer=c$,e.children||(e.children=a$),e.textContent||(e.textContent=KZ),e.layouter||(e.layouter=$Z),e.lineHeight||(e.lineHeight=s$),e.textAlign||(e.textAlign=e$),e.whiteSpace||(e.whiteSpace=$T),e.fontKerning||(e.fontKerning=r$),e.segments||(e.segments=EN),t.width||(t.width="100%"),t.fontSide||(t.fontSide=0)}static init(e){Object.defineProperties(e,{isText:{configurable:!1,enumerable:!0,value:!0}})}}class h$ extends mi{constructor(){super("inlines",null,!1),this._value=[]}process(e){this._value[0].paddingLeft=e._padding._value.w,this._value[0].marginLeft=e._margin._value.w;const t=this._value.length-1;this._value[t].paddingRight=e._padding._value.y,this._value[t].marginRight=e._margin._value.y}}class u$ extends mi{constructor(){super("renderer")}render(e){e._backgroundMesh||e.setBackgroundMesh(new fN(e)),e._backgroundMesh.position.x=e._inlines._value[0].offsetX+e._inlines._value[0].width/2,e._backgroundMesh.position.y=e._inlines._value[0].offsetY+e._inlines._value[0].lineBase/2,e._bounds.render(e)}}class d$ extends mi{constructor(){super("bounds",null,!1),this._size=new ze.Vector3(1,1,1),this._offsetWidth=0,this._offsetHeight=0,this._innerWidth=0,this._innerHeight=0}update(e,t){this.output(t),this._needsProcess=!0}process(e){this._offsetWidth=this._innerWidth=e._inlines._value[0].width,this._offsetHeight=this._innerHeight=e._inlines._value[0].height,this._needsRender=!0,e._borderWidth._needsRender=!0,e._borderRadius._needsRender=!0}render(e){this._size.x=this._offsetWidth,this._size.y=this._offsetHeight}output(e){e.size=this._size}}class Gm extends vA{constructor(e={}){const t={};Gm.definePropertiesValues(t,e),super(t,e),Gm.init(this)}clear(){for(const e of this._inlines._value)e.clear();return super.clear()}bindBackgroundMeshProperties(){this._backgroundMesh.raycast=()=>{},this._bounds._size=this._backgroundMesh.scale,this._bounds._needsUpdate=!0}unbindBackgroundMeshProperties(){this._bounds._size=new ze.Vector3(1,1,1),this._bounds._needsUpdate=!0}add(e){const t=[];for(let i=0;i<arguments.length;i++){const s=arguments[i];s.isUI?console.warn("ThreeMeshUI::InlineBlockElement cannot contains UI Elements.",s):(t.push(s),s.position.z=.005)}return super.add(...t)}static definePropertiesValues(e,t){e.children||(e.children=MN),e.bounds||(e.bounds=d$),e.inlines||(e.inlines=h$),e.layouter||(e.layouter=mN),e.renderer||(e.renderer=u$),e.fontFamily||(e.fontFamily=yN),e.fontWeight||(e.fontWeight=vN),e.fontStyle||(e.fontStyle=AN),e.fontSize||(e.fontSize=CN),e.backgroundColor||(e.backgroundColor=pU),e.lineBreak||(e.lineBreak=gN),e.letterSpacing||(e.letterSpacing=SN),e.whiteSpace||(e.whiteSpace=$T),e.fontKerning||(e.fontKerning=w_),t.backgroundSize||(t.backgroundSize="cover"),t.width||(t.width="100%"),t.height||(t.height="100%"),t.boxSizing||(t.boxSizing="border-box")}static init(e){Object.defineProperties(e,{isInline:{configurable:!1,enumerable:!0,value:!0},isInlineBlock:{configurable:!1,enumerable:!0,value:!0}}),e._inlines._value=[new f$(e)],e.backgroundMaterial=new uN,e._renderer.render(e)}}class f$ extends xU{constructor(e){super(),this._uiElement=e}get xadvance(){const e=this._uiElement._padding._value,t=this._uiElement._width;return t._relative?t._value*this._uiElement._fontSize.getInheritedInput(this._uiElement):e.w+e.y+t.value}get width(){const e=this._uiElement._width;return e._relative?e._value*this._uiElement._fontSize.getInheritedInput(this._uiElement):e.value}get height(){const e=this._uiElement._height;return e._relative?e._value*this._uiElement._fontSize.getInheritedInput(this._uiElement):e.value}get anchor(){return this.height}get lineHeight(){const e=this._uiElement._height;return e._relative?e._value*this._uiElement._fontSize.getInheritedInput(this._uiElement):e.value}get lineBase(){const e=this._uiElement._height;return e._relative?e._value*this._uiElement._fontSize.getInheritedInput(this._uiElement):e.value}clear(){this._uiElement=null}}class TN{constructor(e){this._subject=e}attach(){console.error(`Behavior::attach() - Is abstract and therefore should be overridden in ${this.constructor.name}`)}act(){throw new Error(`Behavior::act() - Is abstract and therefore should be overridden in ${this.constructor.name}`)}detach(){console.error(`Behavior::detach() - Is abstract and therefore should be overridden in ${this.constructor.name}`)}clear(){}}const IN=()=>k0.update(),RN={BaseProperty:mi,Block:Nm,Text:zm,Inline:Vf,InlineBlock:Gm,MeshUIBaseElement:vA,FontLibrary:Du,update:IN,MSDFFontMaterialUtils:uo,ShaderChunkUI:hN,Behavior:TN,FontVariant:pA};typeof global<"u"&&(global.ThreeMeshUI=RN);const p$=RN;var g$=Cn.w8,PN=Cn.cg,e1=Cn.gO,m$=Cn.wb,uE=Cn.zV,A$=Cn.HS,v$=Cn.Ec,Qy=Cn.gF,y$=Cn.ol,b$=Cn.pz,_$=Cn.tx,x$=Cn.hj,w$=Cn.FV,S$=Cn.sV,BN=Cn.xv,C$=Cn.mx,E$=Cn.gE,M$=Cn.ZP,DN=Cn.Vx;const Zw=Object.freeze(Object.defineProperty({__proto__:null,BaseProperty:g$,Behavior:PN,Block:e1,DefaultValues:m$,FontLibrary:uE,FontVariant:A$,InheritableProperty:v$,Inline:Qy,InlineBlock:y$,InlineGlyph:b$,MSDFFontMaterialUtils:_$,MaterialTransformers:x$,MeshUIBaseElement:w$,ShaderChunkUI:S$,Text:BN,TypographicFont:C$,TypographicGlyph:E$,default:M$,update:DN},Symbol.toStringTag,{value:"Module"})),T$=re("debugshadowcomponents");e1.prototype.interactable={get(){return this.interactive},set(n){this.interactable=n}};const Ma=Symbol("shadowDomOwner");class Va extends Te{constructor(){super(...arguments);h(this,"shadowComponent",null);h(this,"_controlsChildLayout",!0);h(this,"_root");h(this,"_parentComponent")}isRoot(){var t;return((t=this.Root)==null?void 0:t.gameObject)===this.gameObject}get canvas(){const t=this.Root;return t!=null&&t.isCanvas?t:null}markDirty(){hr.markUIDirty(this.context)}get controlsChildLayout(){return this._controlsChildLayout}set controlsChildLayout(t){this._controlsChildLayout=t,this.shadowComponent&&(this.shadowComponent.autoLayout=t)}get Root(){return this._root===void 0&&(this._root=ne.getComponentInParent(this.gameObject,T_)),this._root}get Canvas(){return this.canvas}__internalNewInstanceCreated(){super.__internalNewInstanceCreated(),this.shadowComponent=null,this._root=void 0,this._parentComponent=void 0}onEnable(){super.onEnable()}addShadowComponent(t,i){var o;this.removeShadowComponent();const s=this.isRoot()?this.gameObject:this.gameObject.parent;if(this._parentComponent=ne.getComponentInParent(s,Va),!this._parentComponent){console.warn(`Component "${this.name}" doesn't have a UI parent anywhere. Do you have an UI element outside a Canvas? UI components must be a child of a Canvas component`,this);return}t.name=this.name+" ("+(this.constructor.name??"UI")+")",t.autoLayout=this._parentComponent.controlsChildLayout,t[Ma]=this,this.setShadowComponentOwner(t);let r=!1;if(((o=this.Root)==null?void 0:o.gameObject)===this.gameObject)this.gameObject.add(t);else{const a=this._parentComponent.shadowComponent;a&&(a==null||a.add(t),r=!0)}this.shadowComponent=t,i&&i.shadowComponent&&this.shadowComponent&&i.shadowComponent.add(this.shadowComponent),oA&&t.add(new Zf(.5)),this.onAfterAddedToScene(),r&&DN(),T$&&console.log(this.shadowComponent)}set(t){}setShadowComponentOwner(t){if(t&&(t[Ma]===void 0||t[Ma]===this)&&(t[Ma]=this,t.children))for(const i of t.children)this.setShadowComponentOwner(i)}traverseOwnedShadowComponents(t,i,s){if(t&&t[Ma]===i){s(t);for(const r of t.children)this.traverseOwnedShadowComponents(r,i,s)}}removeShadowComponent(){this.shadowComponent&&this.shadowComponent.removeFromParent()}onAfterAddedToScene(){}setInteractable(t){this.shadowComponent&&(this.shadowComponent.interactable=t)}}class T_ extends Va{awake(){super.awake()}}class Vm{static getObject(e){const t=e[Ma];return t&&(t.isComponent===!0?e=t.gameObject:e=t),e}static isInteractable(e,t){if(t&&(t.canvasGroup=void 0,t.graphic=void 0),e==null||!e.visible||(e=this.getObject(e),!e.visible))return!1;const i=this.tryFindCanvasGroup(e);if((i==null?void 0:i.isCanvasGroup)===!0&&(t&&(t.canvasGroup=i),i.blocksRaycasts===!1||i.interactable===!1))return!1;const s=v0(e,r=>{if(r.isGraphic===!0)return r},!1);return t&&(s==null?void 0:s.isGraphic)===!0&&(t.graphic=s),!((s==null?void 0:s.raycastTarget)===!1||(s==null?void 0:s.layer)===2)}static tryFindCanvasGroup(e){if(!e)return null;const t=v0(e,i=>{const s=i;if(s.blocksRaycasts!==void 0&&s.interactable!==void 0)return s},!1);return t!==void 0?t:this.tryFindCanvasGroup(e.parent)}}const pg=re("debugwebxrcontroller");var Pn;(function(n){n[n.PhysicalDevice=0]="PhysicalDevice",n[n.Touch=1]="Touch"})(Pn||(Pn={}));var Pr;(function(n){n.SelectStart="select-start",n.SelectEnd="select-end",n.Update="update"})(Pr||(Pr={}));class t1 extends Te{}const Gn=class extends Te{constructor(){super(...arguments);h(this,"webXR");h(this,"index",-1);h(this,"controllerModel");h(this,"controller");h(this,"controllerGrip");h(this,"hand");h(this,"handPointerModel");h(this,"grabbed",null);h(this,"input",null);h(this,"type",Pn.PhysicalDevice);h(this,"showRaycastLine",!0);h(this,"enableRaycasts",!0);h(this,"enableDefaultControls",!0);h(this,"_wristQuaternion",null);h(this,"movementVector",new w);h(this,"worldRot",new Se);h(this,"joystick",new te);h(this,"didRotate",!1);h(this,"didTeleport",!1);h(this,"didChangeScale",!1);h(this,"lastHit",null);h(this,"raycastLine",null);h(this,"_raycastHitPoint",null);h(this,"_connnectedCallback",null);h(this,"_disconnectedCallback",null);h(this,"_selectStartEvt",null);h(this,"_selectEndEvt",null);h(this,"_selectionPressed",!1);h(this,"_selectionPressedLastFrame",!1);h(this,"_selectionStartTime",0);h(this,"_selectionEndTime",0);h(this,"_useSmoothing",!0);h(this,"_isConnected",!1);h(this,"rayRotation",new Se);h(this,"_pinchStartTime");h(this,"selectStartCallback",null);h(this,"lastSelectStartObject",null);h(this,"_didNotEndSelection",!1);h(this,"closeGrabBoundingBoxHelper")}static CreateRaycastLine(){const t=new dn(this.geometry),i=t.material;return i.color=this.raycastColor,t.layers.set(2),t.name="line",t.scale.z=1,t}static CreateRaycastHitPoint(){const t=new So(.5,22,22),i=new ai({color:this.raycastColor}),s=new ye(t,i);return s.visible=!1,s.layers.set(2),s}static Create(t,i,s,r){const o=s?ne.addNewComponent(s,Gn,!1):new Gn;o.webXR=t,o.index=i,o.type=r;const a=t.context;o.controller=a.renderer.xr.getController(i),o.controllerGrip=a.renderer.xr.getControllerGrip(i),o.controllerModel=this.Factory.createControllerModel(o.controller),o.controllerGrip.add(o.controllerModel),o.hand=a.renderer.xr.getHand(i);const l=new sp;cA(l,a),o.webXR.handModelPath&&o.webXR.handModelPath!==""?l.setPath(Nu(t.sourceId,o.webXR.handModelPath)):l.setPath("https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles/generic-hand/");const c=new $Y(o.hand,l);return o.hand.add(c),o.hand.traverse(u=>u.layers.set(2)),o.handPointerModel=new o7(o.hand,o.controller),o.controller.addEventListener("connected",u=>{o.setControllerLayers(o.controllerModel,2),o.setControllerLayers(o.controllerGrip,2),o.setControllerLayers(o.hand,2),setTimeout(()=>{o.setControllerLayers(o.controllerModel,2),o.setControllerLayers(o.controllerGrip,2),o.setControllerLayers(o.hand,2)},1e3)}),o.hand.addEventListener("connected",u=>{var f;if(u.data.hand){t.Rig&&t.Rig.add(o.hand),o.type=Pn.PhysicalDevice,o.handPointerModel.traverse(g=>g.layers.set(2)),(f=o.handPointerModel.pointerObject)==null||f.traverse(g=>g.layers.set(2));const p=o.hand.joints;if(p)for(const g of Object.keys(p)){const A=p[g];A.parent||o.hand.add(A)}}}),o}static addEventListener(t,i){const s=this.eventSubs[t]??[];s.push(i),this.eventSubs[t]=s}static removeEventListener(t,i){if(!i)return;const s=this.eventSubs[t]??[],r=s.indexOf(i);r>=0&&s.splice(r,1),this.eventSubs[t]=s}get isUsingHands(){var i;const t=(i=this.input)==null?void 0:i.hand;return t!=null}get wrist(){if(!this.hand)return null;const t=this.hand.joints;return t?t.wrist:null}getWristQuaternion(){const t=this.wrist;return t?(this._wristQuaternion||(this._wristQuaternion=new Se),Gr(t).multiply(this._wristQuaternion.setFromEuler(new pn(-Math.PI/4,0,0)))):null}get selectionDown(){return this._selectionPressed&&!this._selectionPressedLastFrame}get selectionUp(){return!this._selectionPressed&&this._selectionPressedLastFrame}get selectionPressed(){return this._selectionPressed}get selectionClick(){return this._selectionEndTime-this._selectionStartTime<.3}get raycastHitPoint(){return this._raycastHitPoint}get useSmoothing(){return this._useSmoothing}awake(){if(!this.controller){console.warn("WebXRController: Missing controller object.",this);return}this._connnectedCallback=this.onSourceConnected.bind(this),this._disconnectedCallback=this.onSourceDisconnected.bind(this),this._selectStartEvt=this.onSelectStart.bind(this),this._selectEndEvt=this.onSelectEnd.bind(this),this.type===Pn.Touch&&(this.controllerGrip.addEventListener("connected",this._connnectedCallback),this.controllerGrip.addEventListener("disconnected",this._disconnectedCallback),this.controller.addEventListener("selectstart",this._selectStartEvt),this.controller.addEventListener("selectend",this._selectEndEvt)),this.type===Pn.PhysicalDevice&&(this.controller.addEventListener("selectstart",this._selectStartEvt),this.controller.addEventListener("selectend",this._selectEndEvt))}onDestroy(){var t,i,s;this.type===Pn.Touch&&(this.controllerGrip.removeEventListener("connected",this._connnectedCallback),this.controllerGrip.removeEventListener("disconnected",this._disconnectedCallback),this.controller.removeEventListener("selectstart",this._selectStartEvt),this.controller.removeEventListener("selectend",this._selectEndEvt)),this.type===Pn.PhysicalDevice&&(this.controller.removeEventListener("selectstart",this._selectStartEvt),this.controller.removeEventListener("selectend",this._selectEndEvt)),(t=this.hand)==null||t.clear(),(i=this.controllerGrip)==null||i.clear(),(s=this.controller)==null||s.clear()}onEnable(){var t,i,s,r,o;if(!this.webXR){console.warn("No WebXR component assigned to WebXRController.");return}this.hand&&(this.hand.name="Hand"),this.controllerGrip&&(this.controllerGrip.name="ControllerGrip"),this.controller&&(this.controller.name="Controller"),this.raycastLine&&(this.raycastLine.name="RaycastLine;"),this.webXR.Controllers.indexOf(this)<0&&this.webXR.Controllers.push(this),this.raycastLine||(this.raycastLine=Gn.CreateRaycastLine()),this._raycastHitPoint||(this._raycastHitPoint=Gn.CreateRaycastHitPoint()),(t=this.webXR.Rig)==null||t.add(this.hand),(i=this.webXR.Rig)==null||i.add(this.controllerGrip),(s=this.webXR.Rig)==null||s.add(this.controller),(r=this.webXR.Rig)==null||r.add(this.raycastLine),(o=this.raycastLine)==null||o.add(this._raycastHitPoint),this._raycastHitPoint.visible=!1,this.hand.add(this.handPointerModel),pg&&console.log("ADDED TO RIG",this.webXR.Rig)}onDisable(){var t,i,s,r,o;if((t=this.hand)==null||t.removeFromParent(),(i=this.controllerGrip)==null||i.removeFromParent(),(s=this.controller)==null||s.removeFromParent(),(r=this.raycastLine)==null||r.removeFromParent(),(o=this._raycastHitPoint)==null||o.removeFromParent(),this.webXR){const a=this.webXR.Controllers.indexOf(this);a>=0&&this.webXR.Controllers.splice(a,1)}}onSourceConnected(t){if(this._isConnected){console.warn("Received connected event for controller that is already connected",this.index,t);return}this._isConnected=!0,this.input=t.data,this.type===Pn.Touch&&this.onSelectStart()}onSourceDisconnected(t){if(!this._isConnected){console.warn("Received discnnected event for controller that is not connected",t);return}this._isConnected=!1,this.type===Pn.Touch&&this.onSelectEnd(),this.input=null}createPointerEvent(t){switch(t){case"down":this.context.input.createPointerDown(new xc(ui.PointerDown,null,{clientX:0,clientY:0,button:this.index,pointerType:ns.Touch}));break;case"move":break;case"up":this.context.input.createPointerUp(new xc(ui.PointerUp,null,{clientX:0,clientY:0,button:this.index,pointerType:ns.Touch}));break}}raycastUpdate(t,i){const s=this.showRaycastLine&&this.type!==Pn.Touch;if(this.type===Pn.Touch)t.visible=!1;else if(this.isUsingHands){t.visible=!this.grabbed&&s,On(t,i);const r=this.hand.joints;if(r&&r.wrist&&this.grabbed&&this.grabbed.isCloseGrab){const a=this.getWristQuaternion();a&&this.rayRotation.copy(a)}_o(t,this.rayRotation)}else t.visible=s,_o(t,this.rayRotation),On(t,i)}update(){if(!this.webXR)return;this.context.time.frameCount%60===0&&(this.setControllerLayers(this.controller,2),this.setControllerLayers(this.controllerGrip,2),this.setControllerLayers(this.hand,2));const t=Gn.eventSubs[Pr.Update];if(t&&t.length>0)for(const r of t)r(this);let i=1;this.type===Pn.PhysicalDevice?i=this.context.time.deltaTime/.1:this.isUsingHands&&this.handPointerModel.pinched&&(i=this.context.time.deltaTime/.3),this.rayRotation.slerp(Gr(this.controller),this.useSmoothing?i:1);const s=Mt(this.controller);this.isUsingHands&&this.handPointerModel.cursorObject&&(this.handPointerModel.cursorObject.visible=!1),this.enableRaycasts?(this.raycastLine&&this.raycastUpdate(this.raycastLine,s),this.lastHit=this.updateLastHit(),this.grabbed&&this.grabbed.update()):this.raycastLine&&(this.raycastLine.visible=!1),this._selectionPressedLastFrame=this._selectionPressed,this.selectStartCallback&&this.selectStartCallback()}onUpdate(t){var r,o;if(this.lastHit=null,!t||t.inputSources.length<=this.index){this.input=null;return}if(this.type===Pn.PhysicalDevice&&(this.input=t.inputSources[this.index]),!this.input)return;const i=this.webXR.Rig;if(!i)return;this._didNotEndSelection&&!this.handPointerModel.pinched&&(this._didNotEndSelection=!1,this.onSelectEnd()),this.updateStick(this.input);const s=(o=(r=this.input)==null?void 0:r.gamepad)==null?void 0:o.buttons;if(this.enableDefaultControls)switch(this.input.handedness){case"left":this.movementUpdate(i,s);break;case"right":this.rotationUpdate(i,s);break}}movementUpdate(t,i){const s=3*Gn.MovementSpeedFactor,r=2,o=tt.clamp01(this.joystick.length()*2),a=this.joystick.x>0?1:-1;let l=Math.pow(this.joystick.x,r);l*=a,l*=o;const c=this.joystick.y>0?1:-1;let u=Math.pow(this.joystick.y,r);u*=c,l*=o,t.getWorldQuaternion(this.worldRot),this.movementVector.set(l,0,u),this.movementVector.applyQuaternion(this.webXR.TransformOrientation),this.movementVector.y=0,this.movementVector.applyQuaternion(this.worldRot),this.movementVector.multiplyScalar(s*this.context.time.deltaTime),t.position.add(this.movementVector),this.isUsingHands&&this.runTeleport(t,i)}rotationUpdate(t,i){const s=this.joystick.x,r=Math.abs(s);if(r<.4)this.didRotate=!1;else if(r>.5&&!this.didRotate){const o=s>0?-1:1;t.rotateY(tt.toRadians(30*o)),this.didRotate=!0}this.runTeleport(t,i)}runTeleport(t,i){var u,d;let s=-this.joystick.y;if((u=this.hand)!=null&&u.visible&&!this.grabbed){const f=this.handPointerModel.isPinched();f&&this._pinchStartTime===void 0&&(this._pinchStartTime=this.context.time.time),f&&this._pinchStartTime&&this.context.time.time-this._pinchStartTime>.8&&(s=this.handPointerModel.isPinched()?1:0),f||(this._pinchStartTime=void 0)}else this._pinchStartTime=void 0;const r=this.webXR.IsInVR,o=this.webXR.Rig;let a=s>.5&&r,l=o?((d=o==null?void 0:o.scale)==null?void 0:d.x)<.999:!1,c=null;if(i&&this.input&&!this.input.hand)for(let f=0;f<i.length;f++){const p=i[f];if(f===4)if(p.pressed&&!this.didChangeScale&&r){this.didChangeScale=!0;const g=o;if(g){const A=this.switchScale(g,a,l,c);a=A.doTeleport,l=A.isInMiniatureMode,c=A.newRigScale}}else p.pressed||(this.didChangeScale=!1)}if(a){if(!this.didTeleport){const f=this.raycast();if(this.didTeleport=!0,f&&f.length>0){const p=f[0];if(l||this.isValidTeleportTarget(p.object)){const g=p.point;On(t,g)}}}}else s<.1&&(this.didTeleport=!1);c!==null&&(t.scale.set(c,c,c),t.updateMatrixWorld())}isValidTeleportTarget(t){return ne.getComponentInParent(t,t1)!=null}switchScale(t,i,s,r){if(s){s=!1,t.scale.set(1,1,1),r=1,Gn.MovementSpeedFactor=1;const o=this.context.mainCamera;Gn.PreviousCameraFarDistance&&(o.far=Gn.PreviousCameraFarDistance)}else{s=!0,i=!0,r=.1,Gn.MovementSpeedFactor=r*2;const o=this.context.mainCamera;Gn.PreviousCameraFarDistance=o.far,o.far/=r}return{doTeleport:i,isInMiniatureMode:s,newRigScale:r}}updateStick(t){var i;!t||!t.gamepad||((i=t.gamepad.axes)==null?void 0:i.length)<4||(this.joystick.x=t.gamepad.axes[2],this.joystick.y=t.gamepad.axes[3])}updateLastHit(){var r;const t=this.raycast(),i=t?t[0]:null;this.lastHit=i;let s=1;if(this.webXR.Rig&&(s/=this.webXR.Rig.scale.x),this.raycastLine){this.raycastLine.scale.z=s*(((r=this.lastHit)==null?void 0:r.distance)??9999);const o=this.raycastLine.material;i!=null?o.color=Gn.raycastColor:o.color=Gn.raycastNoHitColor}if(this._raycastHitPoint){if(this.lastHit!=null){this._raycastHitPoint.position.z=-1;const o=tt.clamp(this.lastHit.distance*.01*s,.015,.1);this._raycastHitPoint.scale.set(o,o,o)}this._raycastHitPoint.visible=this.lastHit!==null&&this.lastHit!==void 0}return i}onSelectStart(){this.context.connection.allowEditing&&(this.selectStartCallback=()=>this.onHandleSelectStart())}onHandleSelectStart(){this.selectStartCallback=null,this._selectionPressed=!0,this._selectionStartTime=this.context.time.time,this._selectionEndTime=1e3;let t=null,i=!1;if(this.isUsingHands?(t=this.overlap(),t.length<=0?(t=this.raycast(),i=!1):i=!0):t=this.raycast(),pg&&console.log("onHandleSelectStart","close grab? "+i,"intersections",t),t&&t.length>0)for(const s of t){const r=s.object;this.lastSelectStartObject=r;const o={selected:r,grab:r},a=Gn.eventSubs[Pr.SelectStart];if(a&&a.length>0)for(const l of a)l(this,o);o.grab!==r&&pg&&console.log("Grabbed object changed","original",r,"new",o.grab),o.grab&&(this.grabbed=Wo.TryTake(this,o.grab,s,i));break}else{const s=Gn.eventSubs[Pr.SelectStart],r={selected:null,grab:null};if(s&&s.length>0)for(const o of s)o(this,r)}}onSelectEnd(){var s;if(this.isUsingHands&&this.handPointerModel.pinched){this._didNotEndSelection=!0;return}if(!this._selectionPressed)return;this.selectStartCallback=null,this._selectionPressed=!1,this._selectionEndTime=this.context.time.time;const t={grab:((s=this.grabbed)==null?void 0:s.selected)??this.lastSelectStartObject},i=Gn.eventSubs[Pr.SelectEnd];if(i&&i.length>0)for(const r of i)r(this,t);this.grabbed&&(this.grabbed.free(),this.grabbed=null)}testIsVisible(t){return!(!t||ne.isActiveInHierarchy(t)===!1||Vm.isInteractable(t)===!1)}setControllerLayers(t,i){var s,r;if(t&&(t.layers.set(i),t.children))for(const o of t.children)((s=this.grabbed)==null?void 0:s.selected)===o||((r=this.grabbed)==null?void 0:r.selectedMesh)===o||this.setControllerLayers(o,i)}getRay(){const t=new Qa;return t.origin.copy(Mt(this.controller)),t.direction.set(0,0,-1).applyQuaternion(this.rayRotation),t}overlap(){const t=this.isUsingHands&&this.handPointerModel?this.handPointerModel.pointerObject:this.controllerGrip;if(pg&&(!this.closeGrabBoundingBoxHelper&&t&&(this.closeGrabBoundingBoxHelper=new $b(t,16776960),this.scene.add(this.closeGrabBoundingBoxHelper)),this.closeGrabBoundingBoxHelper&&t&&this.closeGrabBoundingBoxHelper.setFromObject(t)),!t)return new Array;const i=Mt(t).clone();return this.context.physics.sphereOverlap(i,.02)}raycast(){const t=new Ko;t.layerMask=new Ss,t.layerMask.enableAll(),t.layerMask.disable(2),t.ray=this.getRay();const i=this.context.physics.raycast(t);for(let s=0;s<i.length;s++){const r=i[s],o=r.object;if(!this.testIsVisible(o)){i.splice(s,1),s--;continue}r.object=Vm.getObject(o);break}return i}};let un=Gn;h(un,"Factory",new v7),h(un,"raycastColor",new _e(.9,.3,.3)),h(un,"raycastNoHitColor",new _e(.6,.6,.6)),h(un,"geometry",new ft().setFromPoints([new w(0,0,0),new w(0,0,-1)])),h(un,"handModels",{}),h(un,"eventSubs",{}),h(un,"PreviousCameraFarDistance"),h(un,"MovementSpeedFactor",1);var F0;(function(n){n.WillTake="WillTake",n.DidTake="DidTake",n.WillFree="WillFree",n.DidFree="DidFree"})(F0||(F0={}));const zs=class{constructor(){h(this,"sync",null);h(this,"selected",null);h(this,"selectedParent",null);h(this,"selectedMesh",null);h(this,"controller",null);h(this,"grabTime",0);h(this,"grabUUID","");h(this,"isCloseGrab",!1);h(this,"originalMaterial",null);h(this,"usageMarker",null);h(this,"rigidbodies",null);h(this,"didReparent",!1);h(this,"grabDistance",0);h(this,"interactable",null);h(this,"positionSource",null);h(this,"grabPoint",new w);h(this,"localPositionOffsetToGrab",null);h(this,"localPositionOffsetToGrab_worldSpace",new w);h(this,"localQuaternionToGrab",new Se(0,0,0,1));h(this,"targetDir",null);h(this,"quaternionLerp",null);h(this,"controllerDir",new w);h(this,"controllerWorldPos",new w);h(this,"lastControllerWorldPos",new w);h(this,"controllerPosDelta",new w);h(this,"totalChangeAlongDirection",0);h(this,"rigPositionLastFrame",new w)}static AddEventListener(e,t){return zs.Events[e]||(zs.Events[e]=[]),zs.Events[e].push(t),t}static RemoveEventListener(e,t){if(!t||!zs.Events[e])return;const i=zs.Events[e].indexOf(t);i>=0&&zs.Events[e].splice(i,1)}static Register(e){this.Current.find(t=>t===e)||this.Current.push(e)}static Remove(e){const t=this.Current.indexOf(e);t>=0&&this.Current.splice(t,1)}static TryTake(e,t,i,s){const r=ne.getComponentInParent(t,dA);if(r)t=r.gameObject;else return pg&&console.warn("Prevented taking object that is not interactable",t),null;let o=t;const a=ne.getComponentInParent(t,Bu);a&&(a.requestOwnership(),o=a.gameObject);for(const c of this.Current)if(c.selected===o)return c.controller===e||(c.free(),c.Take(e,o,t,a,r,i,s)),c;const l=new zs;return l.Take(e,o,t,a,r,i,s),l}Take(e,t,i,s,r,o,a){var p,g;if(console.assert(t!==null,"Expected object to be taken but was",t),e.isUsingHands?this.positionSource=a?e.wrist:e.controller:this.positionSource=e.controller,!this.positionSource)return console.warn("No position source"),this;const l={controller:e,take:t,hit:i,sync:s,interactable:r};(p=zs.Events.WillTake)==null||p.forEach(A=>A(this,l));const c=i;c!=null&&c.material&&(this.originalMaterial=c.material,Array.isArray(c.material)||(c.material=c.material.clone(),c.material&&c.material.emissive&&(c.material.emissive.b=.2))),this.selected=t,this.selectedParent||(this.selectedParent=t.parent),this.selectedMesh=c,this.controller=e,this.interactable=r,this.isCloseGrab=a,this.didReparent=!1,this.sync=s,this.grabTime=e.context.time.time,this.grabUUID=Date.now().toString(),this.usageMarker=ne.addNewComponent(this.selected,fA),this.rigidbodies=ne.getComponentsInChildren(this.selected,bi),Mt(this.positionSource,this.lastControllerWorldPos);const u=()=>a?this.lastControllerWorldPos.clone():o.point.clone();this.grabDistance=u().distanceTo(this.lastControllerWorldPos),this.totalChangeAlongDirection=0,this.localPositionOffsetToGrab=this.selected.worldToLocal(u());const d=e.isUsingHands&&a?this.controller.getWristQuaternion().clone():e.rayRotation.clone();Gr(this.selected,this.localQuaternionToGrab).premultiply(d.invert());const f=this.controller.webXR.Rig;return f&&this.rigPositionLastFrame.copy(Mt(f)),pr.Add(e.context,this.selected),zs.Register(this),this.sync&&(this.sync.fastMode=!0),(g=zs.Events.DidTake)==null||g.forEach(A=>A(this,l)),this}free(){var s,r,o,a;if(!this.selected)return;const e={controller:this.controller,take:this.selected,hit:this.selected,sync:this.sync,interactable:null};(s=zs.Events.WillFree)==null||s.forEach(l=>l(this,e)),pr.Remove(this.controller.context,this.selected),zs.Remove(this),this.sync&&(this.sync.fastMode=!1);const t=this.selectedMesh;t&&this.originalMaterial&&t.material&&(t.material=this.originalMaterial);const i=this.selected;if(this.didReparent&&i.parent){const l=this.selectedParent;l?l.attach(i):(r=this.controller)==null||r.context.scene.attach(i)}if((o=this.usageMarker)==null||o.destroy(),this.controller&&(this.controller.grabbed=null),this.selected=null,this.selectedParent=null,this.selectedMesh=null,this.sync=null,this.rigidbodies)for(const l of this.rigidbodies)l.wakeUp(),l.setVelocity(l.smoothedVelocity);this.rigidbodies=null,this.localPositionOffsetToGrab=null,this.quaternionLerp=null,(a=zs.Events.DidFree)==null||a.forEach(l=>l(this,e))}controllerMovementSinceLastFrame(){if(!this.positionSource||!this.controller)return 0;this.controllerDir.set(0,0,-1),this.controllerDir.applyQuaternion(this.controller.rayRotation),Mt(this.positionSource,this.controllerWorldPos),this.controllerPosDelta.copy(this.controllerWorldPos),this.controllerPosDelta.sub(this.lastControllerWorldPos),this.lastControllerWorldPos.copy(this.controllerWorldPos);const e=this.controller.webXR.Rig;if(e){const i=Mt(e),s=this.rigPositionLastFrame.sub(i);this.controllerPosDelta.add(s),this.rigPositionLastFrame.copy(i)}return this.controllerDir.dot(this.controllerPosDelta)}update(){var e;if(this.rigidbodies)for(const t of this.rigidbodies)t.resetVelocities();if(this.sync&&this.controller&&this.controller.context.connection.isInRoom&&this.controller.context.time.time-this.grabTime>3&&this.sync.hasOwnership()===!1&&(console.log("no ownership, will leave",this.sync.guid),this.free()),!(this.interactable&&!this.interactable.canGrab)){if(!this.didReparent&&this.selected&&this.controller){const t=((e=this.controller.webXR.Rig)==null?void 0:e.scale.x)??1;this.totalChangeAlongDirection+=this.controllerMovementSinceLastFrame();let i=1;this.controller.type===Pn.PhysicalDevice&&(i=Math.max(0,1+this.totalChangeAlongDirection*2/t),i=i*i*i),this.grabDistance/t<.8&&(i=1),this.targetDir||(this.targetDir=new w),this.targetDir.set(0,0,-this.grabDistance*i);const s=this.targetDir.applyQuaternion(this.controller.rayRotation).add(this.controllerWorldPos),r=this.controller.rayRotation.clone().multiplyQuaternions(this.controller.rayRotation,this.localQuaternionToGrab);this.quaternionLerp||(this.quaternionLerp=r.clone()),this.quaternionLerp.slerp(r,this.controller.useSmoothing?this.controller.context.time.deltaTime/.03:1),_o(this.selected,this.quaternionLerp),this.selected.updateWorldMatrix(!1,!1),this.grabPoint.copy(s),this.localPositionOffsetToGrab&&(this.localPositionOffsetToGrab_worldSpace.copy(this.localPositionOffsetToGrab),this.selected.localToWorld(this.localPositionOffsetToGrab_worldSpace).sub(Mt(this.selected)),s.sub(this.localPositionOffsetToGrab_worldSpace)),On(this.selected,s)}if(this.rigidbodies!=null)for(const t of this.rigidbodies)t.wakeUp();Fr.markDirty(this.selected,!0)}}};let Wo=zs;h(Wo,"Events",{}),h(Wo,"Current",[]);class Oc{constructor(e,t){h(this,"used",!1);h(this,"inputSource");h(this,"object");h(this,"pointerId");h(this,"isDown");h(this,"isUp");h(this,"isPressed");h(this,"isClicked");h(this,"input");h(this,"_event");this._event=t,this.input=e}use(){this.used=!0,this.pointerId!==void 0&&this.input.setPointerUsed(this.pointerId)}stopPropagation(){var e;(e=this._event)==null||e.stopImmediatePropagation()}Use(){this.use()}StopPropagation(){var e;(e=this._event)==null||e.stopImmediatePropagation()}get event(){return this._event}clone(){const e=new Oc(this.input,this._event);return Object.assign(e,this),e}}class yA extends Te{awake(){hr.createIfNoneExists(this.context)}onEnable(){var e;(e=hr.get(this.context))==null||e.register(this)}onDisable(){var e;(e=hr.get(this.context))==null||e.unregister(this)}performRaycast(e=null){return null}}class th extends yA{constructor(){super(...arguments);h(this,"targets",null);h(this,"raycastHits",[])}start(){this.targets=[this.gameObject]}performRaycast(t=null){return this.targets?(t??(t=new Ko),t.targets=this.targets,t.results=this.raycastHits,this.context.physics.raycast(t)):null}}class ON extends th{}const zd=re("debugeventsystem");var Hf;(function(n){n.BeforeHandleInput="BeforeHandleInput",n.AfterHandleInput="AfterHandleInput"})(Hf||(Hf={}));const Aa=class extends Te{constructor(){super();h(this,"raycaster",[]);h(this,"_selectStartFn");h(this,"_selectEndFn");h(this,"_selectUpdateFn");h(this,"_handleEventCycleFn");h(this,"_handleInputFn");h(this,"pressedByID",new Map);h(this,"hoveredByID",new Map);h(this,"_sortedHits",[]);h(this,"_sortingBuffer",[]);h(this,"_noDepthTestingResults",[]);h(this,"out",{});h(this,"currentActiveMeshUIComponents",[]);Aa.systems.push(this)}static createIfNoneExists(t){this.didSearchEventSystem||(this.didSearchEventSystem=!0,Aa.systems.length<=0&&Aa.systems.push(...ne.findObjectsOfType(Aa,t)));for(const s of Aa.systems)if(s.context===t)return;const i=new Me;ne.addNewComponent(i,Aa),t.scene.add(i)}static get systems(){const t=Lt.Current;return this._eventSystemMap.has(t)||this._eventSystemMap.set(t,[]),this._eventSystemMap.get(t)}static get(t){const i=this._eventSystemMap.get(t);return i&&i.length>0?i[0]:null}static get instance(){return this.systems[0]}static ensureUpdateMeshUI(t,i,s=!1){vl.update(t,i,s)}static markUIDirty(t){vl.markDirty()}get hasActiveUI(){return this.currentActiveMeshUIComponents.length>0}get isHoveringObjects(){return this.hoveredByID.size>0}onDestroy(){Aa.systems.splice(Aa.systems.indexOf(this),1)}start(){if(this.raycaster.length<=0&&!ne.findObjectOfType(yA,this.context)){const i=ne.addNewComponent(this.context.scene,th);this.raycaster.push(i),(si()||zd)&&console.warn("Added an ObjectRaycaster to the scene because no raycaster was found")}}register(t){var i;t&&this.raycaster&&!this.raycaster.includes(t)&&((i=this.raycaster)==null||i.push(t))}unregister(t){var s,r;const i=(s=this.raycaster)==null?void 0:s.indexOf(t);i!==void 0&&i!==-1&&((r=this.raycaster)==null||r.splice(i,1))}onEnable(){const t=new Map;this._selectStartFn??(this._selectStartFn=(s,r)=>{if(!r.grab)return;vl.resetLastSelected();const o=new Oc(this.context.input);o.inputSource=s,o.pointerId=0,o.isDown=s.selectionDown,o.isUp=s.selectionUp,o.isPressed=s.selectionPressed,o.isClicked=!1,t.set(s,r.grab),r.grab&&!this.handleEventOnObject(r.grab,o)&&(r.grab=null)}),this._selectEndFn??(this._selectEndFn=(s,r)=>{var l;if(!r.grab)return;const o=new Oc(this.context.input);o.inputSource=s,o.pointerId=0,o.isDown=s.selectionDown,o.isUp=s.selectionUp,o.isPressed=s.selectionPressed,o.isClicked=s.selectionClick,this.handleEventOnObject(r.grab,o);const a=t.get(s);if(t.set(s,null),a)for(const c of this.pressedByID.keys()){const u=this.pressedByID[c];u.obj===a&&u.handler&&((l=u.handler.onPointerUp)==null||l.call(u.handler,o),this.pressedByID.delete(c))}});const i=new Ko;this._selectUpdateFn??(this._selectUpdateFn=s=>{i.ray=s.getRay();const r=this.performRaycast(i);if(!r)return;const o=new Oc(this.context.input);o.inputSource=s,this.handleIntersections(r,o)}),un.addEventListener(Pr.SelectStart,this._selectStartFn),un.addEventListener(Pr.SelectEnd,this._selectEndFn),un.addEventListener(Pr.Update,this._selectUpdateFn),this._handleInputFn=this.onPointerEvent.bind(this),this.context.input.addEventListener(ui.PointerDown,this._handleInputFn),this.context.input.addEventListener(ui.PointerUp,this._handleInputFn),this.context.input.addEventListener(ui.PointerMove,this._handleInputFn)}onDisable(){un.removeEventListener(Pr.SelectStart,this._selectStartFn),un.removeEventListener(Pr.SelectEnd,this._selectEndFn),un.removeEventListener(Pr.Update,this._selectUpdateFn),this.context.input.removeEventListener(ui.PointerDown,this._handleInputFn),this.context.input.removeEventListener(ui.PointerUp,this._handleInputFn),this.context.input.removeEventListener(ui.PointerMove,this._handleInputFn)}onBeforeRender(){this.resetMeshUIStates()}onPointerEvent(t){if(t===void 0)return;const i=t.pointerType==ns.Touch?t.button:0,s=new Oc(this.context.input,t);s.inputSource=this.context.input,s.pointerId=i,s.isClicked=t.type==ui.PointerUp&&this.context.input.getPointerClicked(i),s.isDown=t.type==ui.PointerDown,s.isUp=t.type==ui.PointerUp,s.isPressed=this.context.input.getPointerPressed(i),zd&&s.isClicked&&console.log("CLICK",i);const r=new Ko;r.screenPoint=this.context.input.getPointerPositionRC(i);const o=this.performRaycast(r);if(!o)return;zd&&s.isClicked&&bn("EventSystem: "+s.pointerId+" - "+this.context.time.frame+" - Up:"+s.isUp+", Down:"+s.isDown);const a={sender:this,args:s,hasActiveUI:this.currentActiveMeshUIComponents.length>0};if(this.dispatchEvent(new CustomEvent(Hf.BeforeHandleInput,{detail:a})),!this.handleIntersections(o,s)){const l=this.hoveredByID.get(i);if(l&&this.triggerOnExit(l.obj,l.data),this.hoveredByID.delete(i),s.isUp){const c=this.pressedByID.get(i);c==null||c.handlers.forEach(u=>{var d;return(d=u.onPointerUp)==null?void 0:d.call(u,s)}),this.pressedByID.delete(i)}}this.dispatchEvent(new CustomEvent(Hf.AfterHandleInput,{detail:a}))}performRaycast(t){if(!this.raycaster)return null;this._sortedHits.length=0;for(const i of this.raycaster){if(!i.activeAndEnabled)continue;const s=i.performRaycast(t);s&&s.length>0&&this._sortedHits.push(...s)}return this._sortedHits.sort((i,s)=>i.distance-s.distance),this._sortedHits}handleIntersections(t,i){if(!t||t.length<=0)return!1;t=this.sortCandidates(t);for(const s of t){const{object:r}=s;if(this.handleEventOnObject(r,i))return!0}return!1}sortCandidates(t){this._sortingBuffer.length=0,this._noDepthTestingResults.length=0;for(let i=0;i<t.length;i++){const s=t[i],r=s.object;if(r.material&&r.material.depthTest===!1){this._noDepthTestingResults.push(s);continue}this._sortingBuffer.push(s)}for(const i of this._sortingBuffer)this._noDepthTestingResults.push(i);return this._noDepthTestingResults}handleEventOnObject(t,i){if(!this.testIsVisible(t))return i.isClicked&&zd&&console.log("not allowed",t),!1;if(i.pointerId===void 0)return!1;i.object=t;const s=t.parent;let r=!1;const o=i.isClicked??!1;let a=null;if(s&&s.isUI){const d=(i.isPressed||i.isClicked)??!1;if(s[Ma]){const f=s[Ma].gameObject;if(f){if(!Vm.isInteractable(f,this.out))return!1;a=this.out.canvasGroup??null,this.handleMeshUIIntersection(t,d),t=f,r=!0}}if(!r&&this.handleMeshUiObjectWithoutShadowDom(s,d))return!0}o&&zd&&console.log(this.context.time.frame,t);const l=this.hoveredByID.get(i.pointerId),c=(l==null?void 0:l.obj)!==t;c&&(l!=null&&l.obj)&&this.triggerOnExit(l.obj,l.data);const u=this.hoveredByID.get(i.pointerId);if(u?(u.obj=t,u.data=i):this.hoveredByID.set(i.pointerId,{obj:t,data:i}),i.isDown){const d=this.pressedByID.get(i.pointerId);d?(d.obj=t,d.data=i):this.pressedByID.set(i.pointerId,{obj:t,data:i,handlers:new Set})}return(a===null||a.interactable)&&this.handleMainInteraction(t,i,c),!0}propagate(t,i,s){for(;;){if(i.used)return;if(ne.foreachComponent(t,r=>{s(r)},!1),!t.parent)break;t=t.parent}}handleMainInteraction(t,i,s){if(i.pointerId===void 0)return;const r=this.pressedByID.get(i.pointerId);this.propagate(t,i,o=>{var d;const a=o;if(a.interactable===!1)return;a.onPointerEnter&&s&&a.onPointerEnter(i),i.isDown&&a.onPointerDown&&(a.onPointerDown(i),r==null||r.handlers.add(a));const l=this.context.input.getPointerPositionLastFrame(i.pointerId),c=this.context.input.getPointerPosition(i.pointerId);l&&!tt.approximately(l,c)&&a.onPointerMove&&a.onPointerMove(i),i.isUp&&(a.onPointerUp&&(a.onPointerUp(i),r==null||r.handlers.delete(a)),a.onPointerExit&&((d=i.event)==null?void 0:d.pointerType)===ns.Touch&&(a.onPointerExit(i),this.hoveredByID.delete(i.pointerId))),i.isClicked&&a.onPointerClick&&a.onPointerClick(i)}),i.isUp&&(r==null||r.handlers.forEach(o=>{o.onPointerUp&&o.onPointerUp(i)}),this.pressedByID.delete(i.pointerId))}triggerOnExit(t,i){i.used=!1,this.propagate(t,i,s=>{if(!s.gameObject||s.destroyed)return;const r=s;r.onPointerExit&&r.onPointerExit(i)})}handleMeshUiObjectWithoutShadowDom(t,i){return!t||!t.isUI?!0:this.handleMeshUIIntersection(t,i)}handleMeshUIIntersection(t,i){const s=vl.updateState(t,i);return s&&this.currentActiveMeshUIComponents.push(s),s!==null}resetMeshUIStates(){if(this.context.input.getPointerPressedCount()>0&&vl.resetLastSelected(),!(!this.currentActiveMeshUIComponents||this.currentActiveMeshUIComponents.length<=0)){for(let t=0;t<this.currentActiveMeshUIComponents.length;t++){const i=this.currentActiveMeshUIComponents[t];vl.resetState(i)}this.currentActiveMeshUIComponents.length=0}}testIsVisible(t){return t?ne.isActiveSelf(t)?this.testIsVisible(t.parent):!1:!0}};let hr=Aa;h(hr,"_eventSystemMap",new Map),h(hr,"didSearchEventSystem",!1);class vl{static markDirty(){this.needsUpdate=!0}static update(e,t,i=!1){if(i){e.update();return}const s=t.time.frameCount;for(const r of this.lastUpdateFrame)if(r.context===t){if(s===r.frame)return;r.frame=s;let o=this.needsUpdate||s<1;r.nextUpdate===t.time.frameCount&&(o=!0),o&&(zd&&console.log("Update threemeshui"),this.needsUpdate=!1,e.update());return}this.lastUpdateFrame=[{context:t,frame:s,nextUpdate:s}],e.update()}static updateState(e,t){let i=null;if(e&&(i=this.findBlockInParent(e),i&&i!==this.lastSelected)){if(i.interactable===!1)return null;this.needsUpdate=!0}return i}static resetLastSelected(){const e=this.lastSelected;e&&(this.lastSelected=null,this.resetState(e))}static resetState(e){e&&(this.needsUpdate=!0)}static findBlockInParent(e){return e?e.isBlock?e:this.findBlockInParent(e.parent):null}}h(vl,"lastSelected",null),h(vl,"lastUpdateFrame",[]),h(vl,"needsUpdate",!1);const Wy=Symbol("cameraController");function I$(n){return n[Wy]}function hD(n,e,t){t?n[Wy]=e:n[Wy]===e&&(n[Wy]=null)}function I_(n){const e=n[Ma];return e||(n.parent?I_(n.parent):null)}function U0(n,e){if(!n)return;const t=n.material;if((t==null?void 0:t.isMaterial)===!0){const i=n.parent;i&&i.isText,t.side=e.doubleSided??!0?wi:Es,t.shadowSide=e.doubleSided?wi:Es,n.castShadow=e.castShadows?e.castShadows:!1,n.receiveShadow=e.receiveShadows?e.receiveShadows:!1}for(const i of n.children)U0(i,e)}function Gd(n,e,t){n[e]===void 0&&console.warn("Field",e,"is undefined on",n);const i=Proxy.revocable(n[e],{set(o,a,l,c){const u=o[a],d=Reflect.set(o,a,l,c);return t(l,u),d}}),s=i.revoke,r=n[e];return i.revoke=()=>{n[e]=r,s()},n[e]=i.proxy,i}const uD=Symbol("Scheduled action");function R$(n,e,t=li.OnBeforeRender){let i=n[uD];i||(i=n[uD]={});const s=e.name;i[t]||(i[t]={});const r=i[t];if(r[s])return;function*a(){e==null||e.call(n),r[s]=null}const l=n.startCoroutine(a(),t);r[s]=l}class kN extends ye{constructor(e,t={}){const s=[e.isCubeTexture?"#define ENVMAP_TYPE_CUBE":""],r=`
			varying vec3 vWorldPosition;

			void main() {

				vec4 worldPosition = ( modelMatrix * vec4( position, 1.0 ) );
				vWorldPosition = worldPosition.xyz;

				gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

			}
			`,o=s.join(`
`)+`

				varying vec3 vWorldPosition;

				uniform float radius;
				uniform float height;
				uniform float angle;

				#ifdef ENVMAP_TYPE_CUBE

					uniform samplerCube map;

				#else

					uniform sampler2D map;

				#endif

				// From: https://www.shadertoy.com/view/4tsBD7
				float diskIntersectWithBackFaceCulling( vec3 ro, vec3 rd, vec3 c, vec3 n, float r ) 
				{

					float d = dot ( rd, n );

					if( d > 0.0 ) { return 1e6; }

					vec3 o = ro - c;
					float t = - dot( n, o ) / d;
					vec3 q = o + rd * t;

					return ( dot( q, q ) < r * r ) ? t : 1e6;

				}

				// From: https://www.iquilezles.org/www/articles/intersectors/intersectors.htm
				float sphereIntersect( vec3 ro, vec3 rd, vec3 ce, float ra ) {

					vec3 oc = ro - ce;
					float b = dot( oc, rd );
					float c = dot( oc, oc ) - ra * ra;
					float h = b * b - c;

					if( h < 0.0 ) { return -1.0; }

					h = sqrt( h );

					return - b + h;

				}

				vec3 project() {

					vec3 p = normalize( vWorldPosition );
					vec3 camPos = cameraPosition;
					camPos.y -= height;

					float intersection = sphereIntersect( camPos, p, vec3( 0.0 ), radius );
					if( intersection > 0.0 ) {

						vec3 h = vec3( 0.0, - height, 0.0 );
						float intersection2 = diskIntersectWithBackFaceCulling( camPos, p, h, vec3( 0.0, 1.0, 0.0 ), radius );
						p = ( camPos + min( intersection, intersection2 ) * p ) / radius;

					} else {

						p = vec3( 0.0, 1.0, 0.0 );

					}

					return p;

				}

				#include <common>

				void main() {

					vec3 projectedWorldPosition = project();

					#ifdef ENVMAP_TYPE_CUBE

						vec3 outcolor = textureCube( map, projectedWorldPosition ).rgb;

					#else

						vec3 direction = normalize( projectedWorldPosition );
						vec2 uv = equirectUv( direction );
						vec3 outcolor = texture2D( map, uv ).rgb;

					#endif

					gl_FragColor = vec4( outcolor, 1.0 );

					#include <tonemapping_fragment>
					#include <colorspace_fragment>

				}
				`,a={map:{value:e},height:{value:t.height||15},radius:{value:t.radius||100}},l=new iA(1,16),c=new Bt({uniforms:a,fragmentShader:o,vertexShader:r,side:wi});super(l,c)}set radius(e){this.material.uniforms.radius.value=e}get radius(){return this.material.uniforms.radius.value}set height(e){this.material.uniforms.height.value=e}get height(){return this.material.uniforms.height.value}}var Ks=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const $v=re("freecam"),Zp=re("debugcamerafit"),ey=re("smoothcam"),P$={LEFT:"",UP:"",RIGHT:"",BOTTOM:""};let $w;class rn extends Te{constructor(){super(...arguments);h(this,"enableRotate",!0);h(this,"autoRotate",!1);h(this,"autoRotateSpeed",1);h(this,"autoFit",!1);h(this,"enableKeys",!0);h(this,"enableDamping",!0);h(this,"dampingFactor",.1);h(this,"enableZoom",!0);h(this,"minZoom",0);h(this,"maxZoom",1/0);h(this,"enablePan",!0);h(this,"lookAtConstraint",null);h(this,"lookAtConstraint01",1);h(this,"middleClickToFocus",!0);h(this,"doubleClickToFocus",!0);h(this,"useSlerp",!0);h(this,"debugLog",!1);h(this,"targetLerpSpeed",5);h(this,"autoTarget",!0);h(this,"_lookTargetPosition");h(this,"_controls",null);h(this,"_cameraObject",null);h(this,"_lerpToTargetPosition",!1);h(this,"_lerpCameraToTarget",!1);h(this,"_cameraTargetPosition",null);h(this,"_inputs",0);h(this,"_enableTime",0);h(this,"_startedListeningToKeyEvents",!1);h(this,"_eventSystem");h(this,"_afterHandleInputFn");h(this,"_camera",null);h(this,"_syncedTransform");h(this,"_didStart",!1);h(this,"targetElement",null);h(this,"onControlsChangeStarted",()=>{this._syncedTransform&&this._syncedTransform.requestOwnership()});h(this,"_shouldDisable",!1);h(this,"_haveAttachedKeyboardEvents",!1)}get isCameraController(){return!0}get controls(){return this._controls}get controllerObject(){return this._cameraObject}onStartInteraction(t){var i;(i=this.controls)==null||i.addEventListener("start",t)}awake(){this._didStart=!1,this._lookTargetPosition=new w,this._startedListeningToKeyEvents=!1}start(){if(this._didStart=!0,this.autoTarget&&this._controls){const t=ne.getComponent(this.gameObject,yi);if(t&&!this.setFromTargetPosition()){this.debugLog&&console.log("NO TARGET");const s=Mt(t.cam).length(),r=new w(0,0,-s).applyMatrix4(t.cam.matrixWorld);this.setTarget(r,!0)}if(this.autoTarget&&!this.setFromTargetPosition()){const i=new Ko;i.screenPoint=new te(0,0),i.lineThreshold=.1;const s=this.context.physics.raycast(i);s.length>0&&this.setTarget(s[0].point,!0),Zp&&console.log("OrbitControls hits",...s)}this.autoFit&&this.fitCamera()}this._eventSystem=hr.get(this.context)??void 0,this._eventSystem&&(this._afterHandleInputFn=this.afterHandleInput.bind(this),this._eventSystem.addEventListener(Hf.AfterHandleInput,this._afterHandleInputFn))}onDestroy(){var t,i;(t=this._controls)==null||t.dispose(),(i=this._eventSystem)==null||i.removeEventListener(Hf.AfterHandleInput,this._afterHandleInputFn)}onEnable(){this._enableTime=this.context.time.time;const t=ne.getComponent(this.gameObject,yi);this._camera=t;const i=t==null?void 0:t.cam;if(i&&hD(i,this,!0),!this._controls){if(!i){console.warn("OrbitControls: Requires a Camera component on the same object as this component.");return}i&&(this._cameraObject=i);const s=this.targetElement??this.context.domElement,r=i==null?void 0:i.quaternion.clone();this._controls=new XY(i,s),i==null||i.quaternion.copy(r),$w===void 0&&($w={...this._controls.keys})}this._controls&&($v&&(this.enablePan=!0,this.enableZoom=!0,this.middleClickToFocus=!0,ch()&&(this.doubleClickToFocus=!0)),this._controls.addEventListener("start",this.onControlsChangeStarted),(i==null?void 0:i.type)==="PerspectiveCamera"?$v||(this._controls.minDistance=this.minZoom,this._controls.maxDistance=this.maxZoom):$v||(this._controls.minZoom=this.minZoom,this._controls.maxZoom=this.maxZoom),this._startedListeningToKeyEvents||(this._startedListeningToKeyEvents=!0,this._controls.listenToKeyEvents(window.document.body))),this._syncedTransform=ne.getComponent(this.gameObject,Bu)??void 0}onDisable(){var t;(t=this._camera)!=null&&t.cam&&hD(this._camera.cam,this,!1),this._controls&&(this._controls.enabled=!1,this._controls.autoRotate=!1,this._controls.removeEventListener("start",this.onControlsChangeStarted))}afterHandleInput(t){t.detail.args.pointerId===0&&(t.detail.args.isDown?this._controls&&this._eventSystem&&(this._shouldDisable=this._eventSystem.hasActiveUI):(!t.detail.args.isPressed||t.detail.args.isUp)&&(this._shouldDisable=!1))}onBeforeRender(){var i,s,r;if(!this._controls||this._cameraObject!==this.context.mainCamera)return;(this.context.input.getPointerDown(0)||this.context.input.getPointerDown(1)||this.context.input.getPointerDown(2))&&(this._inputs+=1),this._inputs>0&&(this.enableRotate&&(this.autoRotate=!1),this._lerpCameraToTarget=!1,this._lerpToTargetPosition=!1),this._inputs=0;let t=this.middleClickToFocus&&this.context.input.getPointerClicked(1);if(t||(t=this.doubleClickToFocus&&this.context.input.getPointerDoubleClicked(0)&&this.context.time.time-this._enableTime>.3),t?this.setTargetFromRaycast():(this.context.input.getPointerDown(0)||this.context.input.mouseWheelChanged)&&(this._lerpToTargetPosition=!1,this._lerpCameraToTarget=!1),this._lerpToTargetPosition||this._lerpCameraToTarget){const o=this.context.time.deltaTime*this.targetLerpSpeed;if(this._lerpCameraToTarget&&this._cameraTargetPosition&&this._cameraObject){if(this.useSlerp){const a=(i=this._cameraObject)==null?void 0:i.position;P8(a,this._cameraTargetPosition,o)}else(s=this._cameraObject)==null||s.position.lerp(this._cameraTargetPosition,o);this._cameraObject.position.distanceTo(this._cameraTargetPosition)<1e-4&&(this._lerpCameraToTarget=!1)}this._lerpToTargetPosition&&(this.lerpTarget(this._lookTargetPosition,o),this._lookTargetPosition.distanceTo(this._controls.target)<1e-5&&(this._lerpToTargetPosition=!1))}if(!$v&&((r=this.lookAtConstraint)!=null&&r.locked)&&this.setFromTargetPosition(0,this.lookAtConstraint01),this._controls){if(this.debugLog&&(this._controls.domElement=this.context.renderer.domElement),this._controls.enabled=!this._shouldDisable&&this._camera===this.context.mainCameraComponent&&!this.context.isInXR,this._controls.keys=this.enableKeys?$w:P$,this._controls.autoRotate=this.autoRotate,this._controls.autoRotateSpeed=this.autoRotateSpeed,this._controls.enableZoom=this.enableZoom,this._controls.enableDamping=this.enableDamping,this._controls.dampingFactor=this.dampingFactor,this._controls.enablePan=this.enablePan,this._controls.enableRotate=this.enableRotate,typeof ey=="number"||ey===!0){this._controls.enableDamping=!0;const o=typeof ey=="number"?ey:.99;this._controls.dampingFactor=Math.max(.001,1-Math.min(1,o))}this.context.isInXR||this._controls.update()}}setCameraTarget(t,i=!1){return this.setCameraTargetPosition(t,i)}setCameraTargetPosition(t,i=!1){var s;t?(this._lerpCameraToTarget=!0,this._cameraTargetPosition=t.clone(),i&&this._cameraTargetPosition&&((s=this.controllerObject)==null||s.position.copy(this._cameraTargetPosition))):this._lerpCameraToTarget=!1}setFromTargetPosition(t=0,i=1){var r;if(!this._controls)return!1;const s=(r=this.lookAtConstraint)==null?void 0:r.sources;if(s&&s.length>0){const o=s[t];if(o)return o.getWorldPosition(this._lookTargetPosition),this.lerpTarget(this._lookTargetPosition,i),!0}return!1}setTarget(t=null,i=!1){this._controls&&(t!==null&&this._lookTargetPosition.copy(t),i?this._controls.target.copy(this._lookTargetPosition):this._lerpToTargetPosition=!0)}lerpTarget(t,i){this._controls&&this._controls.target.lerp(t,i)}distanceToTarget(t){return this._controls?this._controls.target.distanceTo(t):-1}setTargetFromRaycast(){var i,s;if(!this.controls)return;const t=this.context.physics.raycast();for(const r of t)if(r.distance>0&&ne.isActiveInHierarchy(r.object)){const o=I_(r.object);if(o){const a=o.canvas;if(a!=null&&a.screenspace)break}if(this._lookTargetPosition.copy(r.point),this._lerpToTargetPosition=!0,this._cameraTargetPosition=null,this.context.mainCamera){this._lerpCameraToTarget=!0;const a=Mt(this.context.mainCamera);this._cameraTargetPosition=a.clone().sub(this.controls.target).add(this._lookTargetPosition),(s=(i=this._cameraObject)==null?void 0:i.parent)==null||s.worldToLocal(this._cameraTargetPosition)}break}}fitCamera(t,i=1.1,s=!0){const r=this._cameraObject,o=this._controls;if(t!=null&&t.length||(t=this.context.scene.children),t.length<=0||!r||!o)return;const a=new w,l=new w,c=new Bn;c.makeEmpty();const u=[];function d(y){let _=!0;if(y.visible&&(y instanceof aC&&(_=!1),y instanceof OM&&(_=!1),y instanceof kN&&(_=!1),y.material instanceof Wb&&(_=!1),y instanceof ye||(_=!1),y!==r&&y.isUI!==!0)){if(_){Zp&&console.log(y.name,y.type,y);const E=y.children;y.children=u,c.expandByObject(y,!0),y.children=E}for(const E of y.children)d(E)}}for(const y of t)y.updateMatrixWorld(),d(y);if(r.updateMatrixWorld(),r.updateProjectionMatrix(),c.getCenter(l),c.applyMatrix4(r.matrixWorldInverse),c.getSize(a),c.setFromCenterAndSize(l,a),a.length()<=1e-10){Zp&&console.warn("Camera fit size is zero",c,[...t]);return}const f=r.fov,p=2*Math.atan(Math.tan(f*Math.PI/360/2)*r.aspect)/Math.PI*360,g=a.y/(2*Math.atan(Math.PI*f/360)),A=a.x/(2*Math.atan(Math.PI*p/360)),v=i*Math.max(g,A)+a.z/2;Zp&&console.log("Fit camera to objects",g,A,"distance",v);const m=Mt(r),b=o.target.clone().sub(m).normalize().multiplyScalar(v);if(o.maxDistance=v*10,o.minDistance=v*.01,this.setTarget(l,s),this.autoTarget=!1,r.near=v/100,r.far=v*100,r.updateMatrixWorld(),r.updateProjectionMatrix(),r.parent){const y=r.parent.worldToLocal(o.target.clone().sub(b));this.setCameraTarget(y,s)}else console.error(`Can not fit camera ${r.name} because it has no parent`);if(Zp){const y=new aC(c);this.context.scene.add(y),F8(y,zM(r)),this._haveAttachedKeyboardEvents||(this._haveAttachedKeyboardEvents=!0,document.body.addEventListener("keydown",_=>{_.code==="KeyF"&&this.fitCamera(t)}))}o.update()}}Ks([x()],rn.prototype,"enableRotate",void 0);Ks([x()],rn.prototype,"autoRotate",void 0);Ks([x()],rn.prototype,"autoRotateSpeed",void 0);Ks([x()],rn.prototype,"autoFit",void 0);Ks([x()],rn.prototype,"enableKeys",void 0);Ks([x()],rn.prototype,"enableDamping",void 0);Ks([x()],rn.prototype,"dampingFactor",void 0);Ks([x()],rn.prototype,"enableZoom",void 0);Ks([x()],rn.prototype,"minZoom",void 0);Ks([x()],rn.prototype,"maxZoom",void 0);Ks([x()],rn.prototype,"enablePan",void 0);Ks([x(y_)],rn.prototype,"lookAtConstraint",void 0);Ks([x()],rn.prototype,"lookAtConstraint01",void 0);Ks([x()],rn.prototype,"middleClickToFocus",void 0);Ks([x()],rn.prototype,"doubleClickToFocus",void 0);var Vr=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r},Ec;(function(n){n[n.Skybox=1]="Skybox",n[n.SolidColor=2]="SolidColor",n[n.Uninitialized=4]="Uninitialized"})(Ec||(Ec={}));const qh=re("debugcam"),dD=re("debugscreenpointtoray"),af=class extends Te{constructor(){super(...arguments);h(this,"_nearClipPlane",.1);h(this,"_farClipPlane",1e3);h(this,"orthographic",!1);h(this,"orthographicSize",5);h(this,"ARBackgroundAlpha",0);h(this,"_cullingMask",4294967295);h(this,"_backgroundBlurriness");h(this,"_backgroundIntensity");h(this,"_environmentIntensity");h(this,"_targetTexture",null);h(this,"_backgroundColor");h(this,"_fov");h(this,"_cam",null);h(this,"_clearFlags",Ec.SolidColor);h(this,"_skybox")}get isCamera(){return!0}get aspect(){return this._cam instanceof qt?this._cam.aspect:this.context.domWidth/this.context.domHeight}get fieldOfView(){return this._cam instanceof qt?this._cam.fov:this._fov}set fieldOfView(t){const i=this.fieldOfView!=t;if(this._fov=t,i&&this._cam&&this._cam instanceof qt){if(this._fov===void 0){console.warn("Can not set undefined fov on PerspectiveCamera");return}this._cam.fov=this._fov,this._cam.updateProjectionMatrix()}}get nearClipPlane(){return this._nearClipPlane}set nearClipPlane(t){const i=this._nearClipPlane!=t;this._nearClipPlane=t,this._cam&&i&&(this._cam.near=t,this._cam.updateProjectionMatrix())}get farClipPlane(){return this._farClipPlane}set farClipPlane(t){const i=this._farClipPlane!=t;this._farClipPlane=t,this._cam&&i&&(this._cam.far=t,this._cam.updateProjectionMatrix())}get clearFlags(){return this._clearFlags}set clearFlags(t){t!==this._clearFlags&&(this._clearFlags=t,this.applyClearFlagsIfIsActiveCamera())}set cullingMask(t){this._cullingMask=t,this._cam&&(this._cam.layers.mask=t)}get cullingMask(){return this._cam?this._cam.layers.mask:this._cullingMask}set backgroundBlurriness(t){t!==this._backgroundBlurriness&&(t===void 0?this._backgroundBlurriness=void 0:this._backgroundBlurriness=Math.min(Math.max(t,0),1),this.applyClearFlagsIfIsActiveCamera())}get backgroundBlurriness(){return this._backgroundBlurriness}set backgroundIntensity(t){t!==this._backgroundIntensity&&(t===void 0?this._backgroundIntensity=void 0:this._backgroundIntensity=Math.min(Math.max(t,0),10),this.applyClearFlagsIfIsActiveCamera())}get backgroundIntensity(){return this._backgroundIntensity}set environmentIntensity(t){this._environmentIntensity=t}get environmentIntensity(){return this._environmentIntensity}get backgroundColor(){return this._backgroundColor??null}set backgroundColor(t){if(t){if(this._backgroundColor)this._backgroundColor.copy(t);else{if(!t.clone)return;this._backgroundColor=t.clone()}t.alpha===void 0&&(this._backgroundColor.alpha=1),this.applyClearFlagsIfIsActiveCamera()}}set targetTexture(t){this._targetTexture=t}get targetTexture(){return this._targetTexture}get cam(){return this.activeAndEnabled&&this.buildCamera(),this._cam}screenPointToRay(t,i,s){const r=this.cam,o=af._origin;o.set(t,i,-1),this.context.input.convertScreenspaceToRaycastSpace(o),dD&&console.log("screenPointToRay",t.toFixed(2),i.toFixed(2),"now:",o.x.toFixed(2),o.y.toFixed(2),"isInXR:"+this.context.isInXR),o.z=-1,o.unproject(r);const a=af._direction.set(o.x,o.y,o.z),l=Mt(r);return a.sub(l),a.normalize(),s?(s.set(l,a),s):new Qa(l.clone(),a.clone())}awake(){dD&&window.addEventListener("pointerdown",t=>{const i=t.clientX,s=t.clientY;console.log("touch",i.toFixed(2),s.toFixed(2));const r=this.screenPointToRay(i,s),o="#"+Math.floor(Math.random()*16777215).toString(16);lu.DrawRay(r.origin,r.direction,o,10)})}onEnable(){qh&&console.log(`Camera enabled: "${this.name}". ClearFlags=${Ec[this._clearFlags]}`,this),this.buildCamera(),(this.tag=="MainCamera"||!this.context.mainCameraComponent)&&(this.context.setCurrentCamera(this),D$(this)),this.applyClearFlagsIfIsActiveCamera()}onDisable(){this.context.removeCamera(this)}onBeforeRender(){if(this._cam&&this._targetTexture){this.context.isManagedExternally&&(this._warnedAboutExternalRenderer||(this._warnedAboutExternalRenderer=!0,console.warn("Rendering with external renderer is not supported yet. This may not work or throw errors. Please remove the the target texture from your camera: "+this.name,this.targetTexture))),this.context.composer;const t=this.context.renderer;if(t){const i=this.context.mainCameraComponent;this.applyClearFlags(),this._targetTexture.render(this.context.scene,this._cam,t),i==null||i.applyClearFlags()}}}buildCamera(){if(this._cam)return;const t=this.gameObject.isCamera;let i=null;if(t?(i=this.gameObject,i==null||i.layers.enableAll(),i instanceof qt&&(this._fov=i.fov)):i=this.gameObject.children[0],i&&i.isCamera)i instanceof qt&&(this._fov&&(i.fov=this._fov),i.near=this._nearClipPlane,i.far=this._farClipPlane,i.updateProjectionMatrix());else if(!this.orthographic)i=new qt(this.fieldOfView,window.innerWidth/window.innerHeight,this._nearClipPlane,this._farClipPlane),this.fieldOfView&&(i.fov=this.fieldOfView),this.gameObject.add(i);else{const s=this.orthographicSize*100;i=new rh(window.innerWidth/-s,window.innerWidth/s,window.innerHeight/s,window.innerHeight/-s,this._nearClipPlane,this._farClipPlane),this.gameObject.add(i)}this._cam=i,this._cam.layers.mask=this._cullingMask,this.tag=="MainCamera"&&this.context.setCurrentCamera(this)}applyClearFlagsIfIsActiveCamera(){this.context.mainCameraComponent===this&&this.applyClearFlags()}applyClearFlags(){if(!this._cam){qh&&console.log("Camera does not exist (apply clear flags)");return}if(this.fieldOfView=this._fov,qh){const t=`Camera "${this.name}" clear flags: ${Ec[this._clearFlags]}`;console.log(t)}switch(this._clearFlags){case Ec.Skybox:if(af.backgroundShouldBeTransparent(this.context)&&(!this.ARBackgroundAlpha||this.ARBackgroundAlpha<.001)){this.context.scene.background=null,this.context.renderer.setClearColor(0,0);return}this.enableSkybox(),this._backgroundBlurriness!==void 0&&(this.context.scene.backgroundBlurriness=this._backgroundBlurriness),this._backgroundIntensity!==void 0&&(this.context.scene.backgroundIntensity=this._backgroundIntensity);break;case Ec.SolidColor:if(this._backgroundColor){let t=this._backgroundColor.alpha;af.backgroundShouldBeTransparent(this.context)&&(t=this.ARBackgroundAlpha??0),this.context.scene.background=null,this.context.renderer.setClearColor(this._backgroundColor,t)}else qh&&console.warn(`Camera "${this.name}" has no background color`,this);break;case Ec.Uninitialized:this.context.scene.background=null,this.context.renderer.setClearColor(0,0);break}}enableSkybox(){this._skybox||(this._skybox=new B$(this)),this._skybox.enable()}static backgroundShouldBeTransparent(t){var o,a,l,c;const i=(o=t.renderer.xr)==null?void 0:o.getSession();if(!i)return!1;const s=i.environmentBlendMode;qh&&bn("Environment blend mode: "+s+" on "+navigator.userAgent);const r=s==="additive"||s==="alpha-blend";if(t.xrSessionMode===Ru.ImmersiveAR&&s==="opaque"){if((a=navigator.userAgent)!=null&&a.includes("OculusBrowser"))return!0;if((l=navigator.userAgent)!=null&&l.includes("Mozilla")&&((c=navigator.userAgent)!=null&&c.includes("Mobile WebXRViewer/v2")))return!0}return r}};let yi=af;h(yi,"_origin",new w),h(yi,"_direction",new w);Vr([x()],yi.prototype,"fieldOfView",null);Vr([x()],yi.prototype,"nearClipPlane",null);Vr([x()],yi.prototype,"farClipPlane",null);Vr([x()],yi.prototype,"clearFlags",null);Vr([x()],yi.prototype,"orthographic",void 0);Vr([x()],yi.prototype,"orthographicSize",void 0);Vr([x()],yi.prototype,"ARBackgroundAlpha",void 0);Vr([x()],yi.prototype,"cullingMask",null);Vr([x()],yi.prototype,"backgroundBlurriness",null);Vr([x()],yi.prototype,"backgroundIntensity",null);Vr([x()],yi.prototype,"environmentIntensity",null);Vr([x(Si)],yi.prototype,"backgroundColor",null);Vr([x(yu)],yi.prototype,"targetTexture",null);class B${constructor(e){h(this,"_camera");h(this,"_skybox");this._camera=e}get context(){var e;return(e=this._camera)==null?void 0:e.context}enable(){this._skybox=this.context.lightmaps.tryGetSkybox(this._camera.sourceId),this._skybox?this.context.scene.background!==this._skybox&&(qh&&console.log(`Camera "${this._camera.name}" set skybox`,this._camera,this._skybox),this._skybox.colorSpace=Je,this._skybox.mapping=mo,this.context.scene.background=this._skybox):(console.warn(`Camera "${this._camera.name}" failed to load/find skybox texture`,this._camera.sourceId,this.context.lightmaps,"Current background: ",this.context.scene.background),(qh||si())&&Rs(`Camera "${this._camera.name}" has no skybox texture`))}}function D$(n){re("freecam")&&n.context.mainCameraComponent===n&&ne.getOrAddComponent(n.gameObject,rn)}class Af extends Te{constructor(){super(...arguments);h(this,"_listener",null)}get listener(){return this._listener==null&&(this._listener=new dL),this._listener}awake(){Ni.registerWaitForAllowAudio(()=>{if(this.destroyed)return;const t=this.listener;if(t==null||t.parent)return;const i=this.context.mainCameraComponent||ne.getComponentInParent(this.gameObject,yi);i!=null&&i.cam?i.cam.add(t):this.gameObject.add(t)})}}var R_=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const O$=re("debugsignals");class P_{constructor(){h(this,"guid")}}R_([x()],P_.prototype,"guid",void 0);class bA{constructor(){h(this,"signal");h(this,"reaction")}}R_([x(P_)],bA.prototype,"signal",void 0);R_([x(qn)],bA.prototype,"reaction",void 0);const va=class extends Te{constructor(){super(...arguments);h(this,"events")}static invoke(t){if(va.receivers[t]){const i=va.receivers[t];if(!i)return;for(const s of i)s.invoke(t)}}awake(){O$&&console.log("SignalReceiver awake",this)}onEnable(){if(this.events)for(const t of this.events)va.receivers[t.signal.guid]||(va.receivers[t.signal.guid]=[]),va.receivers[t.signal.guid].push(this)}onDisable(){if(this.events){for(const t of this.events)if(va.receivers[t.signal.guid]){const i=va.receivers[t.signal.guid].indexOf(this);i>=0&&va.receivers[t.signal.guid].splice(i,1)}}}invoke(t){if(!this.events||!Array.isArray(this.events))return;const i=typeof t=="object"?t.guid:t;for(const s of this.events)if(s.signal.guid===i)try{if(s.reaction){if(!s.reaction.invoke){console.warn("Missing invoke - possibly a serialization error",s,this);continue}}else{console.warn("Missing reaction for signal",s,this);continue}s.reaction.invoke()}catch(r){console.error(r)}}};let Hc=va;h(Hc,"receivers",{});R_([x(bA)],Hc.prototype,"events",void 0);var wr;(function(n){n.Activation="ActivationTrack",n.Animation="AnimationTrack",n.Audio="AudioTrack",n.Control="ControlTrack",n.Marker="MarkerTrack",n.Signal="SignalTrack"})(wr||(wr={}));var fa;(function(n){n[n.None=0]="None",n[n.Hold=1]="Hold",n[n.Loop=2]="Loop",n[n.PingPong=3]="PingPong",n[n.Continue=4]="Continue"})(fa||(fa={}));var dE;(function(n){n.Signal="SignalEmitter"})(dE||(dE={}));const Rd=re("debugtimeline");var Kd;(function(n){n[n.Hold=0]="Hold",n[n.Loop=1]="Loop",n[n.None=2]="None"})(Kd||(Kd={}));var fD;(function(n){n[n.None=0]="None",n[n.Hold=1]="Hold",n[n.Loop=2]="Loop",n[n.PingPong=3]="PingPong",n[n.Continue=4]="Continue"})(fD||(fD={}));const lb=class extends Te{constructor(){super(...arguments);h(this,"playableAsset");h(this,"playOnAwake");h(this,"extrapolationMode",Kd.Loop);h(this,"waitForAudio",!0);h(this,"_visibilityChangeEvt");h(this,"_clonedPlayableAsset",!1);h(this,"_speed",1);h(this,"_guidsMap");h(this,"_isPlaying",!1);h(this,"_internalUpdateRoutine");h(this,"_isPaused",!1);h(this,"_isStopping",!1);h(this,"_time",0);h(this,"_duration",0);h(this,"_weight",1);h(this,"_animationTracks",[]);h(this,"_audioTracks",[]);h(this,"_signalTracks",[]);h(this,"_controlTracks",[]);h(this,"_customTracks",[]);h(this,"_allTracks",[this._animationTracks,this._audioTracks,this._signalTracks,this._controlTracks,this._customTracks]);h(this,"animationCallbackReceivers",[])}static registerCreateTrack(t,i){this.createTrackFunctions[t]=i}get isPlaying(){return this._isPlaying}get isPaused(){return this._isPaused}get time(){return this._time}set time(t){typeof t=="number"&&!Number.isNaN(t)?this._time=t:(Rd||Ar())&&console.error("INVALID TIMELINE.TIME VALUE",t,this.name)}get duration(){return this._duration}set duration(t){this._duration=t}get weight(){return this._weight}set weight(t){this._weight=t}get speed(){return this._speed}set speed(t){this._speed=t}awake(){var t,i,s;Rd&&console.log(this,(t=this.playableAsset)==null?void 0:t.tracks),this.rebuildGraph(),this.isValid()||console.warn("PlayableDirector is not valid",this.playableAsset,(i=this.playableAsset)==null?void 0:i.tracks,Array.isArray((s=this.playableAsset)==null?void 0:s.tracks),this)}onEnable(){var t,i,s;for(const r of this._audioTracks)(t=r.onEnable)==null||t.call(r);for(const r of this._customTracks)(i=r.onEnable)==null||i.call(r);for(const r of this._animationTracks)(s=r.onEnable)==null||s.call(r);this.playOnAwake&&this.play(),this._visibilityChangeEvt||(this._visibilityChangeEvt=()=>{switch(document.visibilityState){case"hidden":this.setAudioTracksAllowPlaying(!1);break;case"visible":this.setAudioTracksAllowPlaying(!0);break}}),window.addEventListener("visibilitychange",this._visibilityChangeEvt)}onDisable(){var t,i,s;this.stop();for(const r of this._audioTracks)(t=r.onDisable)==null||t.call(r);for(const r of this._customTracks)(i=r.onDisable)==null||i.call(r);for(const r of this._animationTracks)(s=r.onDisable)==null||s.call(r);this._visibilityChangeEvt&&window.removeEventListener("visibilitychange",this._visibilityChangeEvt)}onDestroy(){var t;for(const i of this._allTracks)for(const s of i)(t=s.onDestroy)==null||t.call(s)}rebuildGraph(){this.isValid()&&(this.resolveBindings(),this.updateTimelineDuration(),this.setupAndCreateTrackHandlers())}async play(){if(!this.isValid())return;const t=this._isPaused==!0;if(this._isPaused=!1,t&&this.invokePauseChangedMethodsOnTracks(),!this._isPlaying){if(this._isPlaying=!0,this.waitForAudio){const i=[];for(const s of this._audioTracks){const r=s.loadAudio(this._time,1,0);r&&i.push(r)}if(i.length>0&&(await Promise.all(i),!this._isPlaying))return;for(;this._audioTracks.length>0&&this._isPlaying&&!Ni.userInteractionRegistered&&this.waitForAudio;)await Tu(200)}this.invokeStateChangedMethodsOnTracks(),this._internalUpdateRoutine=this.startCoroutine(this.internalUpdate(),li.OnBeforeRender)}}pause(){this.isValid()&&(this._isPlaying=!1,!this._isPaused&&(this._isPaused=!0,this.internalEvaluate(),this.invokePauseChangedMethodsOnTracks(),this.invokeStateChangedMethodsOnTracks()))}stop(){this._isStopping=!0;for(const s of this._audioTracks)s.stop();const t=this._isPaused==!0,i=this._isPlaying;this._isPlaying&&(this._time=0,this._isPlaying=!1,this._isPaused=!1,this.internalEvaluate(),t&&this.invokePauseChangedMethodsOnTracks()),this._isPlaying=!1,this._isPaused=!1,t&&!i&&this.invokePauseChangedMethodsOnTracks(),i&&this.invokeStateChangedMethodsOnTracks(),this._internalUpdateRoutine&&this.stopCoroutine(this._internalUpdateRoutine),this._internalUpdateRoutine=null,this._isStopping=!1}evaluate(){this.internalEvaluate(!0)}isValid(){return this.playableAsset&&this.playableAsset.tracks&&Array.isArray(this.playableAsset.tracks)}*forEachTrack(){for(const t of this._allTracks)for(const i of t)yield i}get audioTracks(){return this._audioTracks}resolveGuids(t){this._guidsMap=t}invokePauseChangedMethodsOnTracks(){var t;for(const i of this.forEachTrack())(t=i.onPauseChanged)==null||t.call(i)}invokeStateChangedMethodsOnTracks(){var t;for(const i of this.forEachTrack())(t=i.onStateChanged)==null||t.call(i,this._isPlaying)}*internalUpdate(){for(;this._isPlaying&&this.activeAndEnabled;)!this._isPaused&&this._isPlaying&&(this._time+=this.context.time.deltaTime*this.speed,this.internalEvaluate()),yield}internalEvaluate(t=!1){if(!this.isValid())return;let i=this._time;switch(this.extrapolationMode){case Kd.Hold:this._speed>0?i=Math.min(i,this._duration):this._speed<0&&(i=Math.max(i,0)),this._time=i;break;case Kd.Loop:i%=this._duration,this._time=i;break;case Kd.None:if(i>this._duration){this.stop();return}break}const s=this._time;for(const r of this.playableAsset.tracks)if(!r.muted)switch(r.type){case wr.Activation:if(!t&&!this._isPlaying)continue;for(let o=0;o<r.outputs.length;o++){const a=r.outputs[o];if(typeof a=="object"){let l=!1;if(r.clips)for(const u of r.clips)u.start<=s&&s<=u.end&&(l=!0);const c=a;c.visible!==void 0&&c.visible!==l&&(c.visible=l,Rd&&console.warn(this.name,"set ActivationTrack-"+o,c.name,l,s))}}break}if(!this._isStopping)for(const r of this._animationTracks)r.evaluate(s);for(const r of this._audioTracks)r.evaluate(s);for(const r of this._signalTracks)r.evaluate(s);for(const r of this._controlTracks)r.evaluate(s);for(const r of this._customTracks)r.evaluate(s)}resolveBindings(){if(this._clonedPlayableAsset||(this._clonedPlayableAsset=!0,this.playableAsset=FM(this.playableAsset)),!this.playableAsset||!this.playableAsset.tracks)return;const t=this.findRoot(this.gameObject);for(const i of this.playableAsset.tracks){for(let s=i.outputs.length-1;s>=0;s--){let r=i.outputs[s];if(typeof r=="string"){this._guidsMap&&this._guidsMap[r]&&(r=this._guidsMap[r]);const o=ne.findByGuid(r,t);o===null||typeof o!="object"?(i.outputs.splice(s,1),console.warn("Failed to resolve binding",r,i.name,i.type)):(Rd&&console.log("Resolved binding",r,"to",o),i.outputs[s]=o)}else if(r===null){if(i.outputs.splice(s,1),lb.createTrackFunctions[i.type])continue;i.type!==wr.Audio&&i.type!==wr.Control&&i.type!==wr.Marker&&i.type!==wr.Signal&&console.warn("Missing binding",r,i.name,i.type,this.name,this.playableAsset.name)}}if(i.type===wr.Control&&i.clips)for(let s=0;s<i.clips.length;s++){const r=i.clips[s];let o=r.asset.sourceObject;if(typeof o=="string"){this._guidsMap&&this._guidsMap[o]&&(o=this._guidsMap[o]);const a=ne.findByGuid(o,t);a===null||typeof a!="object"?console.warn("Failed to resolve sourceObject binding",o,i.name,r):(Rd&&console.log("Resolved binding",o,"to",a),r.asset.sourceObject=a)}}}}findRoot(t){return t.parent?this.findRoot(t.parent):t}updateTimelineDuration(){if(this._duration=0,!(!this.playableAsset||!this.playableAsset.tracks)){for(const t of this.playableAsset.tracks)if(t.muted!==!0){if(t.clips)for(const i of t.clips)i.end>this._duration&&(this._duration=i.end);if(t.markers)for(const i of t.markers)i.time>this._duration&&(this._duration=i.time+.001)}}}setupAndCreateTrackHandlers(){var i,s;if(this._animationTracks.length=0,this._audioTracks.length=0,this._signalTracks.length=0,!this.playableAsset)return;const t=ne.findObjectOfType(Af,this.context);for(const r of this.playableAsset.tracks){const o=r.type,a=lb.createTrackFunctions[o];if(a!=null){const l=a(this,r);if(typeof l.evaluate=="function"){l.director=this,l.track=r,this._customTracks.push(l);continue}}if(r.type===wr.Animation){if(!r.clips||r.clips.length<=0){Rd&&console.warn("Animation track has no clips",r);continue}for(let l=r.outputs.length-1;l>=0;l--){let c=r.outputs[l];if(c instanceof Me){const d=ne.getOrAddComponent(c,Xs);d&&(c=d)}const u=(i=c==null?void 0:c.gameObject)==null?void 0:i.animations;if(u){const d=new i1;d.trackOffset=r.trackOffset,d.director=this,d.track=r;for(let f=0;f<r.clips.length;f++){const p=r.clips[f],g=p.asset;if(!g){console.error("MISSING anim model?","clip#"+f,p,r,this.playableAsset,this.name);continue}const A=g.clip;let v=A;if((typeof v=="string"||typeof v=="number")&&(v=u.find(b=>b.name===A)),!v){console.warn("Could not find animationClip for model",p,r.name,this.name,(s=this.playableAsset)==null?void 0:s.name);continue}c instanceof Xs&&c.runtimeAnimatorController&&(c.__internalDidAwakeAndStart||c.initializeRuntimeAnimatorController(),c.runtimeAnimatorController.mixer||c.runtimeAnimatorController.bind(c),d.mixer=c.runtimeAnimatorController.mixer),d.mixer||(d.mixer=new Zb(c.gameObject)),d.clips.push(v),d.mixer.uncacheAction(v),d.createHooks(p.asset,v);const m=d.mixer.clipAction(v);d.actions.push(m),d.models.push(p)}this._animationTracks.push(d)}}}else if(r.type===wr.Audio){if(!r.clips||r.clips.length<=0)continue;const l=new vf;if(l.director=this,l.track=r,this._audioTracks.push(l),!t)continue;l.listener=t.listener;for(let c=0;c<r.clips.length;c++){const u=r.clips[c];l.addModel(u)}}else if(r.type===wr.Marker){const l=new N0;if(l.director=this,l.track=r,r.markers)for(const c of r.markers)switch(c.type){case dE.Signal:l.models.push(c),l.didTrigger.push(!1);break}if(l!==null&&l.models.length>0){const c=ne.getComponent(this.gameObject,Hc);c&&(l.receivers.push(c),this._signalTracks.push(l))}}else if(r.type===wr.Signal){const l=new N0;if(l.director=this,l.track=r,r.markers)for(const c of r.markers)l.models.push(c),l.didTrigger.push(!1);for(const c of r.outputs)l.receivers.push(c);this._signalTracks.push(l)}else if(r.type===wr.Control){const l=new n1;if(l.director=this,l.track=r,r.clips)for(const c of r.clips)l.models.push(c);l.resolveSourceObjects(this.context),this._controlTracks.push(l)}}}setAudioTracksAllowPlaying(t){for(const i of this._audioTracks)i.onAllowAudioChanged(t)}registerAnimationCallback(t){this.animationCallbackReceivers.push(t)}unregisterAnimationCallback(t){const i=this.animationCallbackReceivers.indexOf(t);i!==-1&&this.animationCallbackReceivers.splice(i,1)}};let Qc=lb;h(Qc,"createTrackFunctions",{});const Rl=re("debugtimeline");class B_{constructor(){h(this,"director");h(this,"track")}get muted(){return this.track.muted}set muted(e){var t;e!==this.track.muted&&(this.track.muted=e,(t=this.onMuteChanged)==null||t.call(this))}*forEachClip(e=!1){var t;if((t=this.track)!=null&&t.clips)if(e)for(let i=this.track.clips.length-1;i>=0;i--)yield this.track.clips[i];else for(const i of this.track.clips)yield i}getClipTime(e,t){return t.clipIn+(e-t.start)*t.timeScale}getClipTimeNormalized(e,t){return(e-t.start)/t.duration}evaluateWeight(e,t,i,s=!0){if(t<0||t>=i.length)return 0;const r=i[t];if(s||e>=r.start&&e<=r.end){let o=1;const a=!1;if(r.easeInDuration>0){const l=Math.min((e-r.start)/r.easeInDuration,1);o*=l}if(r.easeOutDuration>0&&!a){const l=Math.min((r.end-e)/r.easeOutDuration,1);o*=l}return o}return 0}}class k${constructor(e){h(this,"clip");h(this,"rootPositionOffset");h(this,"rootQuaternionOffset");h(this,"rootStartPosition");h(this,"rootEndPosition");h(this,"rootStartQuaternion");h(this,"rootEndQuaternion");const t=e.getClip();this.clip=t;const i=e.getRoot(),s=i.name+".position",r=i.name+".quaternion";Rl&&console.log(t.name,t.tracks,s);for(const o of t.tracks)if(!(o.times.length<=0)){if(o.name.endsWith(s))this.rootStartPosition=new w().fromArray(o.values,0),this.rootEndPosition=new w().fromArray(o.values,o.values.length-3),this.rootPositionOffset=this.rootEndPosition.clone().sub(this.rootStartPosition),Rl&&console.log(this.rootPositionOffset);else if(o.name.endsWith(r)&&(this.rootStartQuaternion=new Se().fromArray(o.values,0),this.rootEndQuaternion=new Se().fromArray(o.values,o.values.length-4),this.rootQuaternionOffset=this.rootEndQuaternion.clone().multiply(this.rootStartQuaternion),Rl)){const a=new pn().setFromQuaternion(this.rootQuaternionOffset);console.log("ROT",a)}}}get hasOffsets(){return this.rootPositionOffset!==void 0||this.rootQuaternionOffset!==void 0}}class i1 extends B_{constructor(){super(...arguments);h(this,"models",[]);h(this,"trackOffset");h(this,"target");h(this,"mixer");h(this,"clips",[]);h(this,"actions",[]);h(this,"_actionOffsets",[]);h(this,"_didBind",!1);h(this,"_animator",null);h(this,"_useclipOffsets",!0);h(this,"_totalOffsetPosition",new w);h(this,"_totalOffsetRotation",new Se);h(this,"_totalOffsetPosition2",new w);h(this,"_totalOffsetRotation2",new Se);h(this,"_summedPos",new w);h(this,"_tempPos",new w);h(this,"_summedRot",new Se);h(this,"_tempRot",new Se);h(this,"_clipRotQuat",new Se)}onStateChanged(){this._animator&&VB(this._animator.gameObject,this,this.director.isPlaying)}createHooks(t,i){var u,d;if(((u=i.tracks)==null?void 0:u.length)<=0){console.warn("No tracks in AnimationClip",i);return}const s=i.tracks[0].name.split("."),r=s[s.length-2],o=r+".position",a=r+".quaternion";let l=!1,c=!1;for(const f of i.tracks)f.name.endsWith(o)?(l=!0,this.createPositionInterpolant(i,t,f)):f.name.endsWith(a)&&(c=!0,this.createRotationInterpolant(i,t,f));if(!l||!c){const f=(d=this.mixer)==null?void 0:d.getRoot(),p=i.tracks[0],g=p.name.lastIndexOf("."),A=p.name.substring(0,g),v=A.substring(A.lastIndexOf(".")+1),m=f.getObjectByName(v);if(m)if(l){if(!c){const b=i.tracks[0].name.substring(0,g)+".quaternion";Rl&&console.warn("Create quaternion track",v,m);const y=m.quaternion,_=new Vl(b,[0,i.duration],[y.x,y.y,y.z,y.w,y.x,y.y,y.z,y.w]);i.tracks.push(_),this.createRotationInterpolant(i,t,_)}}else{const b=A+".position";Rl&&console.warn("Create position track",v,m);const y=m.position,_=new Kc(b,[0,i.duration],[y.x,y.y,y.z,y.x,y.y,y.z]);i.tracks.push(_),this.createPositionInterpolant(i,t,_)}}}bind(){if(!this._didBind){this._didBind=!0,Rl&&console.log(this.models),this.mixer?this.target=this.mixer.getRoot():console.warn("No mixer was assigned to animation track");for(const t of this.actions){const i=new k$(t);this._actionOffsets.push(i)}this.target&&(this._animator=ne.getComponent(this.target,Xs)??null,this._animator&&VB(this._animator.gameObject,this,!0));for(const t of this.models){const i=t.asset,s=i.position,r=i.rotation;s&&s.x!==void 0&&(s.isVector3||(i.position=new w(s.x,s.y,s.z)),r.isQuaternion||(i.rotation=new Se(r.x,r.y,r.z,r.w)))}this.ensureTrackOffsets()}}ensureTrackOffsets(){if(this.trackOffset){const t=this.trackOffset.position;t&&(t.isVector3||(this.trackOffset.position=new w(t.x,t.y,t.z)));const i=this.trackOffset.rotation;i&&(i.isQuaternion||(this.trackOffset.rotation=new Se(i.x,i.y,i.z,i.w)))}}evaluate(t){var l,c,u,d,f,p,g;if(this.track.muted||!this.mixer)return;this.bind(),this._totalOffsetPosition.set(0,0,0),this._totalOffsetRotation.set(0,0,0,1),this._totalOffsetPosition2.set(0,0,0),this._totalOffsetRotation2.set(0,0,0,1);let i=0,s=0,r=!1,o=!1,a=0;for(let A=0;A<this.clips.length;A++){const v=this.models[A],m=this.actions[A],b=v.asset;m.weight=0;const y=t>=v.start&&t<=v.end,_=v.preExtrapolationMode,E=v.postExtrapolationMode,M=A<this.clips.length-1?this.models[A+1]:null;let I=y,R=!1;if(!I&&!r&&v.end<t&&E!==fa.None?(!M||M.start>t)&&(I=!0,r=!0):A==0&&!I&&!o&&v.start>t&&_!==fa.None&&(!M||M.start<t)&&(I=!0,R=!0,o=!0),I){let C=1;C*=this.evaluateWeight(t,A,this.models,I),C*=this.director.weight;let T=y;if(R)switch(_){case fa.Hold:break;case fa.Loop:t+=v.start,T=!0;break;default:t+=v.start,T=!0;break}let O=this.getClipTime(t,v),J=0;const V=b.duration;if(R&&_===fa.Hold&&(O=0),T){if(b.loop)for(J+=Math.floor(O/(V+1e-6));O>V;)O-=V}else if(!y&&r)switch(E){case fa.Hold:O=this.getClipTime(v.end,v);break;case fa.Loop:O%=V;break;case fa.PingPong:const N=Math.floor(O/V)%2!==0;O%=V,N&&(O=V-O);break}v.reversed===!0?m.time=m.getClip().duration-O:m.time=O,m.timeScale=0;const H=Math.max(0,C);if(m.weight=H,a+=H,m.clampWhenFinished=!1,m.isRunning()||m.play(),this._useclipOffsets){const Y=i==0?this._totalOffsetPosition:this._totalOffsetPosition2,N=i==0?this._totalOffsetRotation:this._totalOffsetRotation2;i<1&&(s=1-C),i+=1;const L=this._summedPos.set(0,0,0),G=this._tempPos.set(0,0,0),ee=this._summedRot.identity(),$=this._tempRot.identity(),j=b.rotation;j&&(this._clipRotQuat.identity(),this._clipRotQuat.slerp(j,C));const ie=this._actionOffsets[A];if(ie.hasOffsets)for(let Ae=0;Ae<J;Ae++)ie.rootPositionOffset?G.copy(ie.rootPositionOffset):G.set(0,0,0),G.applyQuaternion(ee),this._clipRotQuat&&G.applyQuaternion(this._clipRotQuat),ie.rootQuaternionOffset&&($.copy(ie.rootQuaternionOffset),ee.multiply($)),L.add(G);this._clipRotQuat&&N.multiply(this._clipRotQuat),N.multiply(ee),b.position&&L.add(b.position),Y.add(L)}}}if(this._useclipOffsets&&(this._totalOffsetPosition.lerp(this._totalOffsetPosition2,s),this._totalOffsetRotation.slerp(this._totalOffsetRotation2,s)),this.__mixerError===void 0&&(Rl||si())&&((c=(l=this._animator)==null?void 0:l.runtimeAnimatorController)!=null&&c.mixer)&&this.mixer!==((d=(u=this._animator)==null?void 0:u.runtimeAnimatorController)==null?void 0:d.mixer)&&(this.__mixerError=!0,console.error("AnimationTrack mixer is not shared with the animator controller - this might result in the timeline to not animate properly. Please report a bug to the Needle Engine team!",this)),(f=this._animator)!=null&&f.runtimeAnimatorController){const A=Math.max(0,1-a);(g=(p=this._animator)==null?void 0:p.runtimeAnimatorController)==null||g.update(A)}else this.mixer.update(t)}createRotationInterpolant(t,i,s){var l;const r=s.createInterpolant.bind(s),o=new Se;this.ensureTrackOffsets();const a=(l=this.trackOffset)==null?void 0:l.rotation;s.createInterpolant=()=>{const c=r(),u=c.evaluate.bind(c);return c.evaluate=d=>{var p;const f=u(d);if(o.set(f[0],f[1],f[2],f[3]),o.premultiply(this._totalOffsetRotation),a&&o.premultiply(a),this.director.animationCallbackReceivers)for(const g of this.director.animationCallbackReceivers)(p=g==null?void 0:g.onTimelineRotation)==null||p.call(g,this.director,this.target,d,o);return f[0]=o.x,f[1]=o.y,f[2]=o.z,f[3]=o.w,f},c}}createPositionInterpolant(t,i,s){var u,d;const r=s.createInterpolant.bind(s),o=new w;this.ensureTrackOffsets();const a=(u=this.trackOffset)==null?void 0:u.rotation,l=(d=this.trackOffset)==null?void 0:d.position;let c;s.createInterpolant=()=>{const f=r(),p=f.evaluate.bind(f);return f.evaluate=g=>{var v,m,b;const A=p(g);if(o.set(A[0],A[1],A[2]),i.removeStartOffset&&(c===void 0?(c=null,c=(m=(v=this._actionOffsets.find(y=>y.clip===t))==null?void 0:v.rootStartPosition)==null?void 0:m.clone()):c!=null&&c.isVector3&&o.sub(c)),o.applyQuaternion(this._totalOffsetRotation),o.add(this._totalOffsetPosition),a&&o.applyQuaternion(a),l&&(o.x-=l.x,o.y+=l.y,o.z+=l.z),this.director.animationCallbackReceivers)for(const y of this.director.animationCallbackReceivers)(b=y==null?void 0:y.onTimelinePosition)==null||b.call(y,this.director,this.target,g,o);return A[0]=o.x,A[1]=o.y,A[2]=o.z,A},f}}}const L$=re("mutetimeline"),lf=class extends B_{constructor(){super(...arguments);h(this,"models",[]);h(this,"listener");h(this,"audio",[]);h(this,"audioContextTimeOffset",[]);h(this,"lastTime",0);h(this,"_audioLoader",null)}getAudioFilePath(t){const i=this.director.sourceId;return Nu(i,t)}onAllowAudioChanged(t){for(let i=0;i<this.models.length;i++){const s=this.models[i];this.audio[i].setVolume(t?s.asset.volume:0)}}addModel(t){const i=new PM(this.listener);this.audio.push(i),this.models.push(t)}onDisable(){for(const t of this.audio)t.isPlaying&&t.stop()}onDestroy(){for(const t of this.audio)t.source&&(t==null||t.disconnect());this.audio.length=0}onMuteChanged(){if(this.muted)for(let t=0;t<this.audio.length;t++){const i=this.audio[t];i!=null&&i.isPlaying&&i.stop()}}stop(){for(let t=0;t<this.audio.length;t++){const i=this.audio[t];i!=null&&i.isPlaying&&i.stop()}}evaluate(t){if(L$||this.track.muted||this.director.speed<0)return;const i=this.director.context.application.muted,s=i?.1:0;for(let r=0;r<this.models.length;r++){const o=this.models[r],a=this.audio[r];if((!a||!a.buffer)&&this.isInTimeRange(o,t-1,t+1)&&this.handleAudioLoading(o,a),Ni.userInteractionRegistered!==!1&&!(a===null||!a.buffer))if(a.playbackRate=this.director.context.time.timeScale,a.loop=o.asset.loop,t>=o.start&&t<=o.end&&t<this.director.duration){if(this.director.isPlaying==!1){if(a.isPlaying&&a.stop(),this.lastTime===t)continue}else if(!a.isPlaying)a.offset=o.clipIn+(t-o.start)*o.timeScale,a.play(s);else{const c=o.clipIn+(t-o.start)*o.timeScale,u=a.context.currentTime-a._startedAt+a.offset;Math.abs(c-u)>.3&&(a.offset=c,a.stop(),a.play(s))}let l=o.asset.volume;if(i&&(l=0),o.easeInDuration>0){const c=Math.min((t-o.start)/o.easeInDuration,1);l*=c}if(o.easeOutDuration>0){const c=Math.min((o.end-t)/o.easeOutDuration,1);l*=c}a.setVolume(l*this.director.weight)}else a.isPlaying&&a.stop()}this.lastTime=t}loadAudio(t,i=0,s=0){let r=null;const o=t-s,a=t+i;for(const l of this.models)if(this.isInTimeRange(l,o,a)){const c=this.audio[this.models.indexOf(l)],u=this.handleAudioLoading(l,c);u!==null&&(r===null&&(r=[]),r.push(u))}return r!==null?Promise.all(r):null}isInTimeRange(t,i,s){return i<=t.start&&s>=t.end||i>=t.start&&i<=t.end||s>=t.start&&s<=t.end}static dispose(){lf._audioBuffers.clear()}handleAudioLoading(t,i){this._audioLoader||(this._audioLoader=new o0);const s=this.getAudioFilePath(t.asset.clip);if(lf._audioBuffers.get(s)){const o=lf._audioBuffers.get(s);return o.then(a=>{a&&i.setBuffer(a)}),o}Rl&&console.warn("LOAD audio track",s,this.director.sourceId);const r=new Promise((o,a)=>{this._audioLoader.load(s,l=>{i.setBuffer(l),o(l)},void 0,l=>{console.error("Error loading audio",l),o(null)})});return lf._audioBuffers.set(s,r),r}};let vf=lf;h(vf,"_audioBuffers",new Map);class N0 extends B_{constructor(){super(...arguments);h(this,"models",[]);h(this,"didTrigger",[]);h(this,"receivers",[])}evaluate(t){var s;if(this.track.muted)return;const i=this.director.context.time.deltaTime*1.5;for(let r=0;r<this.models.length;r++){const o=this.models[r],a=this.didTrigger[r],l=o.time-t;let c=!1;if(o.retroActive)c=l<=1e-6;else{const u=Math.abs(l);(u===0||u>=1e-5&&u<i)&&(c=!0)}if(c){if(!a)if(Rl&&console.log("Trigger signal",t,o.time,o),this.didTrigger[r]=!0,((s=this.receivers)==null?void 0:s.length)<=0)Hc.invoke(o.asset);else for(const u of this.receivers)u&&u.invoke(o.asset)}else o.emitOnce||(this.didTrigger[r]=!1)}}}class n1 extends B_{constructor(){super(...arguments);h(this,"models",[]);h(this,"timelines",[]);h(this,"_previousActiveModel",null)}resolveSourceObjects(t){for(let i=this.models.length-1;i>=0;i--){const r=this.models[i].asset;if(!r.sourceObject||typeof r.sourceObject!="object"){console.log("no source object, removing model",i,r),this.models.splice(i,1);continue}else{const o=ne.getComponent(r.sourceObject,Qc);this.timelines.push(o),o&&r.updateDirector&&(o.playOnAwake=!1)}}}evaluate(t){var i;this._previousActiveModel=null;for(let s=0;s<this.models.length;s++){const r=this.models[s],o=r.asset;if(t>=r.start&&t<=r.end){this._previousActiveModel=r;const a=this.getClipTime(t,r);if(o.controlActivation){const l=o.sourceObject;l.visible=!0}if(o.updateDirector){const l=this.timelines[s];l&&(l.isPlaying&&l.pause(),l.time=a,l.evaluate())}}else{const a=(i=this._previousActiveModel)==null?void 0:i.asset;if(o.controlActivation){const l=o.sourceObject;(a==null?void 0:a.sourceObject)!==l&&(l.visible=!1)}}}}}var LN=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};class Et{constructor(e){h(this,"_active",!0);h(this,"_value");h(this,"_valueRaw");h(this,"_defaultValue");h(this,"valueProcessor");h(this,"onValueChanged");this._value=e,this._defaultValue=e,this._valueRaw=e}get overrideState(){return this._active}set overrideState(e){if(this._active===e)return;this._active=e;const t=e?this._valueRaw:this._defaultValue;this.processValue(t,!0)}get value(){return this._valueRaw}set value(e){this.processValue(e,!1)}set defaultValue(e){this._defaultValue=e}__init(){this.processValue(this._valueRaw,!0)}processValue(e,t){if(e==null||!t&&this.testIfValueChanged(e)===!1)return;const i=this._value;!this._active&&this._defaultValue!==void 0?(this._value=this._defaultValue,e=this._defaultValue,this._valueRaw=e):(this._valueRaw=e,this._active&&this.valueProcessor&&(e=this.valueProcessor(e)),this._value=e),this.onValueChanged&&this.onValueChanged(e,i,this)}testIfValueChanged(e){return this._valueRaw!==e}}LN([x()],Et.prototype,"overrideState",null);LN([x()],Et.prototype,"value",null);var F$=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const U$=re("debugpost");class Zs extends Gu{constructor(t=void 0){super();h(this,"active",!0);h(this,"_result");h(this,"_didCreateVolumeParameters",!1);if(t){this.ensureVolumeParameters();for(const i of Object.keys(t)){const s=t[i],r=this[i];r instanceof Et&&(r.value=s)}}}onEnable(){this.__internalDidAwakeAndStart&&(this.active=!0)}onDisable(){this.active=!1}init(){}apply(){var t;return this.ensureVolumeParameters(),this._result||(this._result=(t=this.onCreateEffect)==null?void 0:t.call(this)),this._result&&this.initParameters(),this._result}unapply(){}dispose(){U$&&console.warn("DISPOSE",this),this._result&&(Array.isArray(this._result)?this._result.forEach(t=>t.dispose()):this._result.dispose()),this._result=void 0}initParameters(){const t=Object.keys(this);for(const i of t){const s=this[i];s instanceof Et&&s.__init()}}onAfterDeserialize(t,i){if(typeof t=="object"){const s=this.$serializedTypes;if(s){for(const r of Object.keys(s))if(s[r]===Et){const a=t[r];if(a!==void 0){const l=this[r];l.value=a}}}}}onEditorModification(t){const i=t.propertyName;if(this[i]instanceof Et){const s=t.value;return this[i].value=s,!0}}ensureVolumeParameters(){if(this._didCreateVolumeParameters)return;this._didCreateVolumeParameters=!0;const t=this.$serializedTypes;if(t)for(const i of Object.keys(t))t[i]===Et&&(this[i]||(this[i]=new Et))}}F$([x()],Zs.prototype,"active",void 0);var N$=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const z$=re("debugpost"),fE={};function ta(n,e){fE[n]=e}function G$(n){return n.__type in fE?fE[n.__type]:(z$&&n.__type&&console.warn("Unknown postprocessing type",n.__type,n),Zs)}class D_{constructor(){h(this,"components",[])}init(){var e;(e=this.components)==null||e.forEach(t=>t.init())}}N$([hA([n=>G$(n),Zs])],D_.prototype,"components",void 0);var V$=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r},pD;(function(n){n[n.LOW=0]="LOW",n[n.MEDIUM=1]="MEDIUM",n[n.HIGH=2]="HIGH",n[n.ULTRA=3]="ULTRA"})(pD||(pD={}));class O_ extends Zs{constructor(){super(...arguments);h(this,"preset")}get typeName(){return"Antialiasing"}onCreateEffect(){const t=new O6({preset:Fd.HIGH,edgeDetectionMode:sT.DEPTH});return this.preset.onValueChanged=i=>{t.applyPreset(i)},t}}V$([x(Et)],O_.prototype,"preset",void 0);ta("Antialiasing",O_);class s1{constructor(){h(this,"files",[])}get extensionName(){return"Audio"}onExportObject(e,t,i){const s=ne.getComponents(e,Ni);if(s.length)for(const r of s){if(!r.clip||typeof r.clip!="string"||!r.playOnAwake)continue;const o=r.clip.split("/").pop();this.files.includes(r.clip)||this.files.push(r.clip),t.addEventListener("serialize",(a,l)=>{a.appendLine(),a.beginBlock(`def SpatialAudio "${t.name}"`),a.appendLine(`uniform asset filePath = @audio/${o}@`),a.appendLine(`uniform token auralMode = "${r.spatialBlend>0?"spatial":"nonSpatial"}"`),a.appendLine(`uniform token playbackMode = "${r.loop?"loopFromStage":"onceFromStart"}"`),a.appendLine(`uniform float gain = ${r.volume}`),a.closeBlock()})}}async onAfterSerialize(e){for(const t of this.files){const i=t.split("/").pop(),o=await(await(await fetch(t)).blob()).arrayBuffer(),a=new Uint8Array(o);e.files["audio/"+i]=a}}}const Zd=re("debugnetworkingstreams");var tn;(function(n){n.Connected="peer-user-connected",n.StreamReceived="receive-stream",n.StreamEnded="call-ended",n.Disconnected="peer-user-disconnected",n.UserJoined="user-joined"})(tn||(tn={}));class H${constructor(e,t){h(this,"type",tn.StreamEnded);h(this,"userId");h(this,"direction");this.userId=e,this.direction=t}}class Q${constructor(e,t){h(this,"type",tn.StreamReceived);h(this,"stream");h(this,"target");this.stream=e,this.target=t}}class W${constructor(e,t){h(this,"guid");h(this,"peerId");h(this,"dontSave",!0);this.guid=e.id,this.peerId=t}}var Rc;(function(n){n.Incoming="incoming",n.Outgoing="outgoing"})(Rc||(Rc={}));class j$ extends Fn{constructor(t,i,s){super();h(this,"userId");h(this,"direction");h(this,"call");h(this,"_stream",null);h(this,"_isDisposed",!1);this.userId=t,this.call=i,this.direction=s,this._stream=null,i.on("stream",r=>{if(Zd&&console.log("Receive video",r.getAudioTracks(),r.getVideoTracks()),this._stream=r,s===Rc.Incoming){const o=new Q$(r,this);this.dispatchEvent(o)}}),i.on("close",()=>{this.dispatchEvent(new H$(t,s))})}get stream(){return this._stream}close(){this._isDisposed||(this._isDisposed=!0,this.call.close(),kc(this._stream))}get isOpen(){var t;return((t=this.call.peerConnection)==null?void 0:t.connectionState)==="connected"}get isOpening(){var t;return((t=this.call.peerConnection)==null?void 0:t.connectionState)==="connecting"}get isClosed(){return!this.isOpen}}const cf=class extends Fn{constructor(t,i){super();h(this,"id");h(this,"context");h(this,"_peer");h(this,"_incomingCalls",[]);h(this,"_outgoingCalls",[]);h(this,"_enabled",!1);h(this,"_enabledPeer",!1);h(this,"onConnectRoomFn",this.onConnectRoom.bind(this));h(this,"onPeerConnectFn",this.onPeerConnect.bind(this));h(this,"onPeerReceiveCallFn",this.onPeerReceivingCall.bind(this));this.context=t,this.id=i,this.setupPeer(),navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia}static getOrCreate(t,i){if(cf.instances.has(i))return cf.instances.get(i);const s=new cf(t,i);return cf.instances.set(i,s),s}getMyPeerId(){if(this.context.connection.connectionId)return this.getPeerIdFromUserId(this.context.connection.connectionId)}getPeerIdFromUserId(t){return this.id+"-"+t}getUserIdFromPeerId(t){return t.substring(this.id.length+1)}makeCall(t,i){var o;const s={metadata:{userId:this.context.connection.connectionId}},r=(o=this._peer)==null?void 0:o.call(t,i,s);if(r)return this.registerCall(r,Rc.Outgoing)}get peer(){return this._peer}enable(){this._enabled||(this._enabled=!0,this.context.connection.beginListen(pi.JoinedRoom,this.onConnectRoomFn),this.subscribePeerEvents())}disable(){this._enabled&&(this._enabled=!1,this.context.connection.stopListen(pi.JoinedRoom,this.onConnectRoomFn),this.unsubscribePeerEvents())}onConnectRoom(){this.setupPeer()}setupPeer(){if(this.context.connection.connectionId&&!this._enabledPeer){if(this._enabledPeer=!0,!this._peer){const t=this.getMyPeerId();t?this._peer=PW(t):console.error("Failed to setup peerjs because we dont have a connection id",this.context.connection.connectionId)}this._enabled&&this.subscribePeerEvents()}}subscribePeerEvents(){this._peer&&(this._peer.on("open",this.onPeerConnectFn),this._peer.on("call",this.onPeerReceiveCallFn))}unsubscribePeerEvents(){this._peer&&(this._peer.off("open",this.onPeerConnectFn),this._peer.off("call",this.onPeerReceiveCallFn))}onPeerConnect(t){Zd&&console.log("Peer connected as",t),this.context.connection.send(tn.Connected,new W$(this,t))}onPeerReceivingCall(t){t.answer(),this.registerCall(t,Rc.Incoming)}registerCall(t,i){const s=t.metadata;(!s||!s.userId)&&console.error("Missing call metadata",t);const r=s.userId;i===Rc.Incoming&&Zd?console.log("Receive call from",t.metadata):Zd&&console.log("Make call to",t.metadata);const o=i===Rc.Incoming?this._incomingCalls:this._outgoingCalls,a=new j$(r,t,i);return o.push(a),t.on("error",l=>{console.error("Call error",l)}),t.on("close",()=>{Zd&&console.log("Call ended",t.metadata),t.close();const l=o.indexOf(a);l!==-1&&o.splice(l,1)}),a.addEventListener(tn.StreamEnded,l=>{this.dispatchEvent(l)}),i===Rc.Incoming&&(a.addEventListener(tn.StreamReceived,l=>{this.dispatchEvent(l)}),t.on("stream",()=>{let l=0;const c=setInterval(()=>{const u=l===0;!a.isOpen&&u&&(l+=1,clearInterval(c),a.close())},2e3)})),a}};let Vg=cf;h(Vg,"instances",new Map);class k_ extends Fn{constructor(t,i){super();h(this,"context");h(this,"peer");h(this,"_sendingStreams",new Map);h(this,"debug",!1);h(this,"onJoinedRoom",t=>{this.debug&&console.log(`${t.userId} joined room and I'm currently sending ${this._sendingStreams.size} streams`),this._sendingStreams.size>0&&this.updateSendingCalls()});h(this,"onReceiveStream",t=>{this.debug&&console.log("RECEIVE STREAM",t),this.dispatchEvent({type:tn.StreamReceived,target:this,stream:t.stream,userId:t.userId})});h(this,"onCallEnded",t=>{this.dispatchEvent(t)});h(this,"onUserConnected",t=>{if(this.peer.id===t.guid){this.debug&&console.log("USER CONNECTED",t.guid,t);const i=this._sendingStreams.keys().next().value;this.peer.makeCall(t.peerId,i)}});this.context=t,this.peer=i,Zd&&(this.debug=!0)}static create(t){const i=Vg.getOrCreate(t.context,t.context.connection.connectionId);return new k_(t.context,i)}startSendingStream(t){this._sendingStreams.has(t)?console.warn("Received start sending stream with stream that is already being sent"):(this._sendingStreams.set(t,[]),this.updateSendingCalls())}stopSendingStream(t){if(t){const i=this._sendingStreams.get(t);if(i){this.debug&&console.log("Closing calls",i);for(const s of i)s.close()}this._sendingStreams.delete(t),i&&this.debug&&console.log("Currently sending",this._sendingStreams)}}enable(){this.peer.enable(),this.peer.addEventListener(tn.StreamReceived,this.onReceiveStream),this.peer.addEventListener(tn.StreamEnded,this.onCallEnded),this.context.connection.beginListen(tn.Connected,this.onUserConnected),this.context.connection.beginListen(pi.JoinedRoom,this.onJoinedRoom),this.context.connection.beginListen(pi.UserJoinedRoom,this.onJoinedRoom),this.context.connection.beginListen(pi.UserLeftRoom,this.onUserLeft)}disable(){this.peer.disable(),this.peer.removeEventListener(tn.StreamReceived,this.onReceiveStream),this.peer.removeEventListener(tn.StreamEnded,this.onCallEnded),this.context.connection.stopListen(tn.Connected,this.onUserConnected),this.context.connection.stopListen(pi.JoinedRoom,this.onJoinedRoom),this.context.connection.stopListen(pi.UserJoinedRoom,this.onJoinedRoom),this.context.connection.stopListen(pi.UserLeftRoom,this.onUserLeft)}onUserLeft(t){this.stopCallsToUsersThatAreNotInTheRoomAnymore()}updateSendingCalls(){var s;let t=!1;const i=this.context.connection.connectionId;for(const r of this._sendingStreams.keys()){const o=this._sendingStreams.get(r)||[];for(const a of this.context.connection.usersInRoom()){if(a===i)continue;const l=o.find(c=>c.userId===a);if(!l||((s=l.stream)==null?void 0:s.active)===!1){this.debug&&console.log("Starting call to",a,i);const c=this.peer.makeCall(this.peer.getPeerIdFromUserId(a),r);c&&(t=!0,o.push(c))}}this._sendingStreams.set(r,o)}this.stopCallsToUsersThatAreNotInTheRoomAnymore(),t&&this.debug&&console.log("Currently sending",this._sendingStreams)}stopCallsToUsersThatAreNotInTheRoomAnymore(){for(const t of this._sendingStreams.keys()){const i=this._sendingStreams.get(t);if(i)for(let s=i.length-1;s>=0;s--){const r=i[s];this.context.connection.userIsInRoom(r.userId)||(r.close(),i.splice(s,1))}}}}function kc(n){if(n&&n instanceof MediaStream)for(const e of n.getTracks())e.stop()}var FN=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const UN="noVoip",q$=re("debugvoip");class Hu extends Te{constructor(){super(...arguments);h(this,"autoConnect",!1);h(this,"runInBackground",!0);h(this,"debug",!1);h(this,"_net");h(this,"_outputStream",null);h(this,"onJoinedRoom",async()=>{await Tu(300),this.autoConnect&&!this.isSending&&this.connect()});h(this,"_incomingStreams",new Map);h(this,"onReceiveStream",t=>{const i=t.target.userId,s=t.stream,r=this._incomingStreams.get(i);if(r)r.srcObject=s,r.setAttribute("autoplay","true");else{const o=new Audio;this._incomingStreams.set(i,o),o.setAttribute("autoplay","true"),o.srcObject=s}});h(this,"onStreamEnded",t=>{const i=this._incomingStreams.get(t.userId);kc(i==null?void 0:i.srcObject),this._incomingStreams.delete(t.userId)});h(this,"onEnabledChanged",()=>{for(const t of this._incomingStreams){const i=t[1];i.muted=!this.enabled}});h(this,"onVisibilityChanged",()=>{if(this.runInBackground)return;const i=!(document.visibilityState==="visible");this.setMuted(i);for(const s of this._incomingStreams){const r=s[1];r.muted=i}})}awake(){q$&&(this.debug=!0),this.debug&&window.addEventListener("keydown",async t=>{t.key==="v"&&(console.log("MUTE?",!this.isMuted),this.setMuted(!this.isMuted))})}onEnable(){this._net||(this._net=k_.create(this)),this._net.addEventListener(tn.StreamReceived,this.onReceiveStream),this._net.addEventListener(tn.StreamEnded,this.onStreamEnded),this._net.enable(),this.autoConnect&&(this.context.connection.isConnected?this.connect():this.context.connection.beginListen(pi.JoinedRoom,this.onJoinedRoom)),this.onEnabledChanged(),window.addEventListener("visibilitychange",this.onVisibilityChanged)}onDisable(){var t;this._net.stopSendingStream(this._outputStream),this._net.removeEventListener(tn.StreamReceived,this.onReceiveStream),this._net.removeEventListener(tn.StreamEnded,this.onStreamEnded),(t=this._net)==null||t.disable(),this.context.connection.stopListen(pi.JoinedRoom,this.onJoinedRoom),this.onEnabledChanged(),window.removeEventListener("visibilitychange",this.onVisibilityChanged)}get isSending(){return this._outputStream!=null&&this._outputStream.active}async connect(t){if(this.context.connection.isConnected){if(!await NR())return console.error("Cannot connect to voice chat - microphone permissions not granted"),!1}else return console.error("Cannot connect to voice chat - not connected to server"),!1;return this._net.stopSendingStream(this._outputStream),kc(this._outputStream),this._outputStream=await this.getAudioStream(t),this._outputStream?(this._net.startSendingStream(this._outputStream),!0):(await NR()?console.error("VOIP: Could not get audio stream - please make sure to connect an audio device and grant microphone permissions"):M8("Microphone permissions not granted: Please grant microphone permissions to use voice chat"),!1)}disconnect(){this._net.stopSendingStream(this._outputStream),kc(this._outputStream),this._outputStream=null}setMuted(t){var s;const i=(s=this._outputStream)==null?void 0:s.getAudioTracks();if(i)for(const r of i)r.enabled=!t}get isMuted(){var i;if(this._outputStream===null)return!1;const t=(i=this._outputStream)==null?void 0:i.getAudioTracks();if(t){for(const s of t)if(!s.enabled)return!0}return!1}getFrequency(t){return this.unsupported_getfrequency||(this.unsupported_getfrequency=!0,si()&&Rs("VOIP: getFrequency is currently not supported"),console.warn("VOIP: getFrequency is currently not supported")),null}async getAudioStream(t){return navigator.mediaDevices.getUserMedia?await navigator.mediaDevices.getUserMedia({audio:t??!0,video:!1}).catch(s=>(console.warn("VOIP failed getting audio stream",s),null)):(console.error("No getDisplayMedia support"),null)}}FN([x()],Hu.prototype,"autoConnect",void 0);FN([x()],Hu.prototype,"runInBackground",void 0);var NN=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const X$=re("debugmouth");class L_ extends Te{constructor(){super(...arguments);h(this,"idle",[]);h(this,"talking",[]);h(this,"marker",null);h(this,"voip",null);h(this,"lastMouthChangeTime",0);h(this,"mouthChangeLength",0)}awake(){setTimeout(()=>{this.voip=ne.findObjectOfType(Hu,this.context),this.marker||(this.marker=ne.getComponentInParent(this.gameObject,as))},3e3)}update(){var s;if(!this.voip||this.context.time.frameCount%10!==0)return;let t=((s=this.marker)==null?void 0:s.connectionId)??null;if(!t){X$&&(t=null);return}const i=this.voip.getFrequency(t)??0;this.updateLips(i)}updateLips(t){if(this.context.time.time-this.lastMouthChangeTime>this.mouthChangeLength){if(this.mouthChangeLength=.05+Math.random()*.1,this.talking&&this.talking.length>0&&t>30){this.lastMouthChangeTime=this.context.time.time;const i=Math.floor(Math.random()*this.talking.length);this.setMouthShapeActive(this.talking,i)}else if(this.idle.length>0&&this.context.time.time-this.lastMouthChangeTime>.5){this.lastMouthChangeTime=this.context.time.time;const i=Math.floor(Math.random()*this.idle.length);this.setMouthShapeActive(this.idle,i)}}}setMouthShapeActive(t,i){if(t){t!=this.idle?this.idle.map(s=>s.visible=!1):this.talking.map(s=>s.visible=!1);for(let s=0;s<t.length;s++){const r=t[s];r&&(r.visible=s===i)}}}}NN([x(Me)],L_.prototype,"idle",void 0);NN([x(Me)],L_.prototype,"talking",void 0);class zN extends Te{constructor(){super(...arguments);h(this,"voip",null);h(this,"marker",null);h(this,"_startPosition",null)}awake(){this.voip=ne.findObjectOfType(Hu,this.context),this.marker=ne.getComponentInParent(this.gameObject,as)}update(){if(!this.voip||!this.marker||this.context.time.frameCount%10!==0)return;const t=this.marker.connectionId,i=this.voip.getFrequency(t);if(i==null)return;this._startPosition||(this._startPosition=this.gameObject.position.clone());const s=i/100;this.gameObject.position.y=this._startPosition.y+s*.07}}var F_=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};class lp extends Te{constructor(){super(...arguments);h(this,"eyes",[]);h(this,"lastBlinkTime",0);h(this,"blinkLength",0);h(this,"eyesOpen",!0);h(this,"state",null)}awake(){this.state=ne.getComponentInParent(this.gameObject,os)}update(){if(!this.gameObject||!this.gameObject.visible||!this.eyes||!Array.isArray(this.eyes)||this.eyes.length===0)return;if(this.context.time.time-this.lastBlinkTime>this.blinkLength){if(this.lastBlinkTime=this.context.time.time,this.state&&!this.state.isOn||!this.activeAndEnabled)return;if(this.eyesOpen=!this.eyesOpen,this.blinkLength=Math.random(),this.eyesOpen?(this.blinkLength*=3,this.blinkLength+=.5,Math.random()<.1&&(this.blinkLength=.1+Math.random()*.2)):(this.blinkLength*=Math.random()*.2,this.blinkLength+=.1),Math.random()<.1&&(this.blinkLength*=3),this.blinkLength=Math.max(.2,this.blinkLength),this.blinkLength=Math.min(3,this.blinkLength),this.eyes)for(const i of this.eyes)i&&(i.visible=this.eyesOpen)}}}F_([x(Me)],lp.prototype,"eyes",void 0);F_([x()],lp.prototype,"lastBlinkTime",void 0);F_([x()],lp.prototype,"blinkLength",void 0);F_([x()],lp.prototype,"eyesOpen",void 0);var r1=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const rI=class extends Te{constructor(){super(...arguments);h(this,"head",null);h(this,"eyes",null);h(this,"target",null);h(this,"brain",null);h(this,"vec",new w);h(this,"currentTargetPoint",new w)}awake(){this.brain||(this.brain=ne.getComponentInParent(this.gameObject,I0)),this.brain||(console.log("No look at brain found, adding it now"),this.brain=ne.addNewComponent(this.gameObject,I0)),this.brain&&this.target&&(this.brain.controlledTarget=this.target)}update(){const t=this.target;if(t&&this.head){const i=this.eyes;if(i){const s=Mt(t);this.currentTargetPoint.lerp(s,this.context.time.deltaTime/.1);const r=Mt(this.head),o=this.vec.copy(this.currentTargetPoint).sub(r).normalize();if(o.length()<.1)return;const a=rI.forward;if(a.set(0,0,1),a.applyQuaternion(Gr(this.head)),a.dot(o)>.45)for(let c=0;c<i.length;c++)i[c].lookAt(this.currentTargetPoint)}}}};let Wc=rI;h(Wc,"forward",new w(0,0,1));r1([x(Me)],Wc.prototype,"head",void 0);r1([x(Me)],Wc.prototype,"eyes",void 0);r1([x(Me)],Wc.prototype,"target",void 0);var o1=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};class _A extends Te{constructor(){super(...arguments);h(this,"length",1);h(this,"depthTest",!0);h(this,"isGizmo",!0);h(this,"_axes",null)}onEnable(){if(this.isGizmo&&!oA)return;this._axes||(this._axes=new Zf(this.length)),this.gameObject.add(this._axes);const t=this._axes.material;t&&t.depthTest!==void 0&&(t.depthTest=this.depthTest)}onDisable(){this._axes&&this.gameObject.remove(this._axes)}}o1([x()],_A.prototype,"length",void 0);o1([x()],_A.prototype,"depthTest",void 0);o1([x()],_A.prototype,"isGizmo",void 0);class GN extends Te{constructor(){super(...arguments);h(this,"from");h(this,"to");h(this,"hint");h(this,"desiredDistance",1)}onEnable(){}update(){if(!this.from||!this.to||!this.hint)return;const t=Mt(this.to).clone(),i=Mt(this.from).clone(),s=t.distanceTo(i),r=t.clone();r.sub(i);const o=i.clone();o.add(t),o.multiplyScalar(.5);const a=Mt(this.hint).clone();a.sub(o);const l=new w;l.crossVectors(a,r),l.crossVectors(r,l),l.normalize();const c=s*.5,u=Math.max(this.desiredDistance,c),d=Math.sqrt(u*u-c*c),f=l.clone();f.multiplyScalar(d),f.add(o),On(this.gameObject,f);const p=o.clone();p.sub(l),this.gameObject.lookAt(p)}}const gD=re("debugusdz");class a1{constructor(){h(this,"behaviours",[]);h(this,"behaviourComponents",[]);h(this,"behaviourComponentsCopy",[])}get extensionName(){return"Behaviour"}addBehavior(e){this.behaviours.push(e)}onBeforeBuildDocument(e){const t=[];return e.root.traverse(i=>{ne.foreachComponent(i,s=>{var o;const r=s;if(typeof r.createBehaviours=="function"||typeof r.beforeCreateDocument=="function"||typeof r.afterCreateDocument=="function"||typeof r.afterSerialize=="function"){this.behaviourComponents.push(r);const a=(o=r.beforeCreateDocument)==null?void 0:o.call(r,this,e);a instanceof Promise&&t.push(a)}},!1)}),Promise.all(t)}onExportObject(e,t,i){var s;for(const r of this.behaviourComponents)(s=r.createBehaviours)==null||s.call(r,this,t,i)}onAfterBuildDocument(e){for(const t of this.behaviourComponents)typeof t.afterCreateDocument=="function"&&t.afterCreateDocument(this,e);this.behaviourComponentsCopy=this.behaviourComponents.slice(),this.behaviourComponents.length=0}onAfterHierarchy(e,t){var i;if((i=this.behaviours)!=null&&i.length){t.beginBlock('def Scope "Behaviors"');for(const s of this.behaviours)s.writeTo(this,e.document,t);t.closeBlock()}}async onAfterSerialize(e){gD&&console.log("onAfterSerialize behaviours",this.behaviourComponentsCopy);for(const t of this.behaviourComponentsCopy)typeof t.afterSerialize=="function"&&(gD&&console.log("behaviour has afterSerialize",t),t.afterSerialize.constructor.name==="AsyncFunction"?await t.afterSerialize(this,e):t.afterSerialize(this,e))}}var l1=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};class cp extends Zs{constructor(){super(...arguments);h(this,"threshold");h(this,"intensity");h(this,"scatter");h(this,"selectiveBloom",!0)}get typeName(){return"Bloom"}init(){this.threshold.defaultValue=1,this.intensity.defaultValue=0,this.scatter.defaultValue=.2,this.selectiveBloom?(this.threshold.valueProcessor=t=>t,this.intensity.valueProcessor=t=>t,this.scatter.valueProcessor=t=>1*Math.PI*(1-t)):(this.threshold.valueProcessor=t=>t,this.intensity.valueProcessor=t=>t,this.scatter.valueProcessor=t=>100*(1-t))}onCreateEffect(){let t;if(this.selectiveBloom){const i=t=new cF(this.context.scene,this.context.mainCamera,{blendFunction:Ot.ADD,mipmapBlur:!0,luminanceThreshold:this.threshold.value,luminanceSmoothing:this.scatter.value,intensity:this.intensity.value});i.inverted=!0}else t=new lT;return this.intensity.onValueChanged=i=>{t.intensity=i},this.threshold.onValueChanged=i=>{t.luminanceMaterial.threshold=i},this.scatter.onValueChanged=i=>{t.luminancePass.enabled=!0,t.luminanceMaterial.smoothing=i},t}}l1([x(Et)],cp.prototype,"threshold",void 0);l1([x(Et)],cp.prototype,"intensity",void 0);l1([x(Et)],cp.prototype,"scatter",void 0);ta("Bloom",cp);var ia=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};class Kl extends Te{constructor(){super(...arguments);h(this,"attachedRigidbody",null);h(this,"isTrigger",!1);h(this,"sharedMaterial");h(this,"updateProperties",()=>{var t;(t=this.context.physics.engine)==null||t.updateProperties(this)})}get isCollider(){return!0}awake(){super.awake(),this.attachedRigidbody||(this.attachedRigidbody=this.gameObject.getComponentInParent(bi))}start(){this.attachedRigidbody||(this.attachedRigidbody=this.gameObject.getComponentInParent(bi))}onEnable(){this.attachedRigidbody||(this.attachedRigidbody=this.gameObject.getComponentInParent(bi))}onDisable(){var t;(t=this.context.physics.engine)==null||t.removeBody(this)}get body(){var t;return(t=this.context.physics.engine)==null?void 0:t.getBody(this)}}ia([x(bi)],Kl.prototype,"attachedRigidbody",void 0);ia([x()],Kl.prototype,"isTrigger",void 0);ia([x()],Kl.prototype,"sharedMaterial",void 0);class U_ extends Kl{constructor(){super(...arguments);h(this,"radius",.5);h(this,"center",new w(0,0,0))}onEnable(){var t;super.onEnable(),(t=this.context.physics.engine)==null||t.addSphereCollider(this,this.center),_L(this.gameObject.scale,this.updateProperties)}onDisable(){super.onDisable(),s8(this.gameObject.scale,this.updateProperties)}onValidate(){this.updateProperties()}}ia([Bs(),x()],U_.prototype,"radius",void 0);ia([x(w)],U_.prototype,"center",void 0);class N_ extends Kl{constructor(){super(...arguments);h(this,"size",new w(1,1,1));h(this,"center",new w(0,0,0))}onEnable(){var t;super.onEnable(),(t=this.context.physics.engine)==null||t.addBoxCollider(this,this.center,this.size)}onValidate(){this.updateProperties()}}ia([Bs(),x(w)],N_.prototype,"size",void 0);ia([x(w)],N_.prototype,"center",void 0);class z_ extends Kl{constructor(){super(...arguments);h(this,"sharedMesh");h(this,"convex",!1)}onEnable(){var t,i,s,r,o;if(super.onEnable(),(t=this.sharedMesh)!=null&&t.isMesh||this.gameObject instanceof ye&&(this.sharedMesh=this.gameObject),(i=this.sharedMesh)!=null&&i.isMesh)(s=this.context.physics.engine)==null||s.addMeshCollider(this,this.sharedMesh,this.convex,Jo(this.gameObject));else{const a=this.sharedMesh;if(a!=null&&a.isGroup){console.warn(`MeshCollider mesh is a group "${(r=this.sharedMesh)==null?void 0:r.name}", adding all children as colliders. This is currently not fully supported (colliders can not be removed from world again)`,this);for(const l in a.children){const c=a.children[l];c.isMesh&&((o=this.context.physics.engine)==null||o.addMeshCollider(this,c,this.convex,Jo(this.gameObject)))}}}}}ia([x()],z_.prototype,"convex",void 0);class Ou extends Kl{constructor(){super(...arguments);h(this,"center",new w(0,0,0));h(this,"radius",.5);h(this,"height",2)}onEnable(){var t;super.onEnable(),(t=this.context.physics.engine)==null||t.addCapsuleCollider(this,this.center,this.height,this.radius)}}ia([x(w)],Ou.prototype,"center",void 0);ia([x()],Ou.prototype,"radius",void 0);ia([x()],Ou.prototype,"height",void 0);var c1=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};class hp extends Te{constructor(){super(...arguments);h(this,"objectBounds",!1);h(this,"color");h(this,"isGizmo",!0);h(this,"_gizmoObject",null);h(this,"_boxHelper",null)}onEnable(){this.isGizmo&&!oA||(this._gizmoObject||(this.objectBounds?this._gizmoObject=new $b(this.gameObject,this.color??16776960):(this.objectBounds=!1,this._gizmoObject=jF(this.color??16776960))),this.objectBounds?(this.scene.add(this._gizmoObject),this._boxHelper=this._gizmoObject,this.startCoroutine(this.syncObjectBounds(),li.OnBeforeRender)):this.gameObject.add(this._gizmoObject))}onDisable(){this._gizmoObject&&this.gameObject.remove(this._gizmoObject)}*syncObjectBounds(){var t;for(;this._boxHelper;)(t=this._boxHelper)==null||t.update(),yield}}c1([x()],hp.prototype,"objectBounds",void 0);c1([x(_e)],hp.prototype,"color",void 0);c1([x()],hp.prototype,"isGizmo",void 0);var xA=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const eS=re("debugui"),tS=re("debuguilayout");class VN{constructor(){h(this,"width");h(this,"height")}}class HN{constructor(){h(this,"x");h(this,"y");h(this,"width");h(this,"height")}}const ko=new w,$p=new Ie,ty=new Se;class Ts extends Va{constructor(){super(...arguments);h(this,"_anchoredPosition");h(this,"sizeDelta",new te(100,100));h(this,"pivot",new te(.5,.5));h(this,"anchorMin",new te(0,0));h(this,"anchorMax",new te(1,1));h(this,"minWidth");h(this,"minHeight");h(this,"lastMatrix");h(this,"rectBlock");h(this,"_transformNeedsUpdate",!1);h(this,"_initialPosition");h(this,"_parentRectTransform");h(this,"_lastUpdateFrame",-1);h(this,"_lastAnchoring");h(this,"_createdBlocks",[]);h(this,"_createdTextBlocks",[])}get parent(){return this._parentRectTransform}get translation(){return this.gameObject.position}get rotation(){return this.gameObject.quaternion}get scale(){return this.gameObject.scale}get anchoredPosition(){return this._anchoredPosition||(this._anchoredPosition=new te),this._anchoredPosition}set anchoredPosition(t){this._anchoredPosition=t}get width(){let t=this.sizeDelta.x;if(this.anchorMin.x!==this.anchorMax.x&&this._parentRectTransform){const i=this._parentRectTransform.width,s=this.anchorMax.x-this.anchorMin.x;t=i*s,t+=this.sizeDelta.x}return this.minWidth!==void 0&&t<this.minWidth?this.minWidth:t}get height(){let t=this.sizeDelta.y;if(this.anchorMin.y!==this.anchorMax.y&&this._parentRectTransform){const i=this._parentRectTransform.height,s=this.anchorMax.y-this.anchorMin.y;t=i*s,t+=this.sizeDelta.y}return this.minHeight!==void 0&&t<this.minHeight?this.minHeight:t}awake(){super.awake(),this._anchoredPosition||(this._anchoredPosition=new te),this.lastMatrix=new Ie,this.rectBlock=new Me,this.rectBlock.name=this.name,this._initialPosition=this.gameObject.position.clone(),this._initialPosition.z=0,Gd(this,"_anchoredPosition",()=>{this.markDirty()}),Gd(this,"sizeDelta",()=>{this.markDirty()}),Gd(this,"pivot",()=>{this.markDirty()}),Gd(this,"anchorMin",()=>{this.markDirty()}),Gd(this,"anchorMax",()=>{this.markDirty()})}onEnable(){var t;super.onEnable(),this.addShadowComponent(this.rectBlock),this._transformNeedsUpdate=!0,(t=this.Canvas)==null||t.registerTransform(this)}onDisable(){var t;super.onDisable(),this.removeShadowComponent(),(t=this.Canvas)==null||t.unregisterTransform(this)}onParentRectTransformChanged(t){this._transformNeedsUpdate||this.onApplyTransform(tS?`${t.name} changed`:void 0)}get isDirty(){return this._transformNeedsUpdate||(this._transformNeedsUpdate=!this.lastMatrix.equals(this.gameObject.matrix)),this._transformNeedsUpdate}markDirty(){this._transformNeedsUpdate||(tS&&console.warn("RectTransform markDirty()",this.name),this._transformNeedsUpdate=!0,this._lastUpdateFrame=-1)}updateTransform(){(this._transformNeedsUpdate||!this.lastMatrix.equals(this.gameObject.matrix))&&this.canUpdate()&&this.onApplyTransform(this._transformNeedsUpdate?"Marked dirty":"Matrix changed")}canUpdate(){return this._transformNeedsUpdate&&this.activeAndEnabled&&this._lastUpdateFrame!==this.context.time.frame}onApplyTransform(t){var r;if(this.context.time.frameCount===this._lastUpdateFrame)return;this._lastUpdateFrame=this.context.time.frameCount;const i=this.shadowComponent;if(!i)return;this.gameObject.parent?this._parentRectTransform=ne.getComponentInParent(this.gameObject.parent,Ts):this._parentRectTransform=void 0,this._transformNeedsUpdate=!1,tS&&console.warn("RectTransform  ApplyTransform",this.name+" because "+t),this.isRoot()?this.Root.screenspace||(i.rotation.y=Math.PI):(i.matrix.identity(),i.matrixAutoUpdate=!1,ko.set(0,0,0),this.applyPivot(ko),i.matrix.setPosition(ko.x,ko.y,0),(this.gameObject.quaternion.x||this.gameObject.quaternion.y||this.gameObject.quaternion.z)&&(ty.copy(this.gameObject.quaternion),ty.x*=-1,ty.z*=-1,$p.makeRotationFromQuaternion(ty),i.matrix.premultiply($p)),ko.set(0,0,0),this.applyAnchoring(ko),(r=this.Canvas)!=null&&r.screenspace?ko.z+=.1:ko.z+=.01,$p.identity(),$p.setPosition(ko.x,ko.y,ko.z),i.matrix.premultiply($p),i.matrix.scale(this.gameObject.scale)),this.lastMatrix.copy(this.gameObject.matrix);const s=!0;for(const o of G2(this.gameObject,Va,s,1)){if(o===this||!o.activeAndEnabled)continue;const a=o;a.onParentRectTransformChanged&&a.onParentRectTransformChanged(this)}}applyAnchoring(t){this._lastAnchoring||(this._lastAnchoring=new te);const i=this._lastAnchoring.sub(this._anchoredPosition);this.gameObject.position.x+=i.x,this.gameObject.position.y+=i.y,this._lastAnchoring.copy(this._anchoredPosition),t.x+=this._initialPosition.x-this.gameObject.position.x,t.y+=this._initialPosition.y-this.gameObject.position.y,t.z+=this._initialPosition.z-this.gameObject.position.z;const s=this._parentRectTransform;if(s){let r=0;const o=1-this.anchorMax.y-this.anchorMin.y;r-=s.height*.5*o,t.y+=r;let a=0;const l=1-this.anchorMax.x-this.anchorMin.x;a-=s.width*.5*l,t.x+=a}}applyPivot(t){if(this.pivot&&!this.isRoot()){const i=this.pivot.x-.5;t.x-=i*this.sizeDelta.x*this.gameObject.scale.x;const s=this.pivot.y-.5;t.y-=s*this.sizeDelta.y*this.gameObject.scale.y}}getBasicOptions(){const t={width:this.sizeDelta.x,height:this.sizeDelta.y,offset:0,backgroundOpacity:0,borderWidth:0,borderRadius:0,borderOpacity:0,letterSpacing:-.03};return this.ensureValidSize(t),t}ensureValidSize(t,i=1e-4){return t.width<=0&&(t.width=i),t.height<=0&&(t.height=1e-4),t}createNewBlock(t){t={...this.getBasicOptions(),...t},eS&&console.log(this.name,t);const i=new e1(t);return this._createdBlocks.push(i),i}createNewText(t){eS&&console.log(t),t={...this.getBasicOptions(),...t},eS&&console.log(this.name,t);const i=new BN(t);return this._createdTextBlocks.push(i),i}}xA([x(te)],Ts.prototype,"anchoredPosition",null);xA([x(te)],Ts.prototype,"sizeDelta",void 0);xA([x(te)],Ts.prototype,"pivot",void 0);xA([x(te)],Ts.prototype,"anchorMin",void 0);xA([x(te)],Ts.prototype,"anchorMax",void 0);class Y$ extends PN{constructor(e,t={}){super(e),e._simpleState__activeStates=[],e._simpleState__normalStyles={},e._simpleState__states=t,e._simpleState__statesProperties={};for(const i in t)for(const s in t[i])e._simpleState__statesProperties[s]||(e._simpleState__statesProperties[s]=[]),e._simpleState__statesProperties[s].push(i);for(const i of e._components)e._simpleState__statesProperties[i.id]&&(e._simpleState__normalStyles[i.id]=i.inline?i.inline:i._value);e.__overridedSet=e.set,e.set=this.storeSet.bind(e),e.renderStates=this.renderStates.bind(e),e.setupState=this.setupState.bind(e),e.setState=this.setState.bind(e),e.activatePseudoState=this.activatePseudoState.bind(e),e.deactivatePseudoState=this.deactivatePseudoState.bind(e),e.togglePseudoState=this.togglePseudoState.bind(e)}act(){}attach(){}detach(){}setupState(e,t){this._simpleState__states[e]=t;const i=[];for(const s in t)this._simpleState__statesProperties[s]||(this._simpleState__statesProperties[s]=[],i.push(s)),this._simpleState__statesProperties[s].push(e);for(const s of this._components)i.indexOf(s.id)>-1&&(this._simpleState__normalStyles[s.id]=s.inline?s.inline:s._value)}renderStates(){let e={...this._simpleState__normalStyles};for(const t in this._simpleState__states)this._simpleState__activeStates.indexOf(t)>-1&&(e={...e,...this._simpleState__states[t]});this.set(e,!1)}storeSet(e,t=!0){if(t)for(const i in e)this._simpleState__statesProperties[i]&&(this._simpleState__normalStyles[i]=e[i]);this.__overridedSet(e)}activatePseudoState(e){this._simpleState__activeStates.indexOf(e)===-1&&(this._simpleState__activeStates.push(e),this.renderStates())}deactivatePseudoState(e){const t=this._simpleState__activeStates.indexOf(e);t>-1&&(this._simpleState__activeStates.splice(t,1),this.renderStates())}togglePseudoState(e){const t=this._simpleState__activeStates.indexOf(e);t>-1?this._simpleState__activeStates.splice(t,1):this._simpleState__activeStates.push(e),this.renderStates()}setState(e){Array.isArray(e)?this._simpleState__activeStates=e:this._simpleState__activeStates=[e],this.renderStates()}}var QN=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};class wA extends Te{constructor(){super(...arguments);h(this,"effectColor");h(this,"effectDistance")}}QN([x(Si)],wA.prototype,"effectColor",void 0);QN([x(te)],wA.prototype,"effectDistance",void 0);var WN=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const iy={backgroundColor:new _e(1,1,1),backgroundOpacity:1,borderColor:new _e(1,1,1),borderOpacity:1},am=class extends Va{constructor(){super(...arguments);h(this,"_alphaFactor",1);h(this,"raycastTarget",!0);h(this,"uiObject",null);h(this,"_color",null);h(this,"_rect",null);h(this,"_stateManager",null);h(this,"_currentlyCreatingPanel",!1)}get isGraphic(){return!0}get color(){return this._color||(this._color=new Si(1,1,1,1)),this._color}set color(t){(!this._color||this._color.r!==t.r||this._color.g!==t.g||this._color.b!==t.b||this._color.alpha!==t.alpha)&&(this._color||(this._color=new Si(1,1,1,1)),this._color.copy(t))}setAlphaFactor(t){this._alphaFactor=t,this.onColorChanged()}get alphaFactor(){return this._alphaFactor}onColorChanged(){this.uiObject&&(iy.backgroundColor=this._color,iy.backgroundOpacity=this._color.alpha*this._alphaFactor,this.applyEffects(iy,this._alphaFactor),this.uiObject.set(iy),this.markDirty())}get m_Color(){return this._color}get rectTransform(){if(this._rect||(this._rect=ne.getComponent(this.gameObject,Ts)),!this._rect)throw new Error("Not Supported: Make sure to add a RectTransform component before adding a UI Graphic component.");return this._rect}onParentRectTransformChanged(){var t;(t=this.uiObject)==null||t.set({width:this.rectTransform.width,height:this.rectTransform.height}),this.markDirty()}__internalNewInstanceCreated(){super.__internalNewInstanceCreated(),this._rect=null,this.uiObject=null,this._color&&(this._color=this._color.clone())}setState(t){this.makePanel(),this.uiObject&&(this.uiObject.setState(t),this==null||this.markDirty())}setupState(t){this.makePanel(),this.uiObject&&(this._stateManager||(this._stateManager=new Y$(this.uiObject)),this.uiObject.setupState(t.state,t.attributes))}setOptions(t){this.makePanel(),this.uiObject&&this.uiObject.set(t)}awake(){super.awake(),this.makePanel(),Gd(this,"_color",()=>R$(this,this.onColorChanged))}onEnable(){var t;super.onEnable(),this.uiObject&&((t=this.rectTransform.shadowComponent)==null||t.add(this.uiObject),this.addShadowComponent(this.uiObject,this.rectTransform))}onDisable(){super.onDisable(),this.uiObject&&this.removeShadowComponent()}makePanel(){if(this.uiObject||this._currentlyCreatingPanel)return;this._currentlyCreatingPanel=!0;const t=.015,i={backgroundColor:this.color,backgroundOpacity:this.color.alpha,offset:t};this.onBeforeCreate(i),this.applyEffects(i),this.onCreate(i),this.controlsChildLayout=!1,this._currentlyCreatingPanel=!1,this.onAfterCreated()}onBeforeCreate(t){}onCreate(t){this.uiObject=this.rectTransform.createNewBlock(t),this.uiObject.name=this.name}onAfterCreated(){}applyEffects(t,i=1){var r;const s=(r=this.gameObject)==null?void 0:r.getComponent(wA);s&&(s.effectDistance&&(t.borderWidth=Math.max(Math.abs(s.effectDistance.x),Math.abs(s.effectDistance.y))),s.effectColor&&(t.borderColor=s.effectColor,t.borderOpacity=s.effectColor.alpha*i))}async setTexture(t){if(this.setOptions({backgroundOpacity:0}),t){if(t.colorSpace===Je){if(am.textureCache.has(t))t=am.textureCache.get(t);else if(!t.isRenderTargetTexture){const i=t.clone();i.colorSpace=gn,am.textureCache.set(t,i),t=i}}this.setOptions({backgroundImage:t,borderRadius:0,backgroundOpacity:this.color.alpha,backgroundSize:"stretch"})}else this.setOptions({backgroundImage:null,borderRadius:0,backgroundOpacity:this.color.alpha});this.markDirty()}onAfterAddedToScene(){super.onAfterAddedToScene(),this.shadowComponent&&(this.shadowComponent.offset=this.shadowComponent.position.z)}};let Ul=am;h(Ul,"textureCache",new Map);WN([x(Si)],Ul.prototype,"color",null);WN([x()],Ul.prototype,"raycastTarget",void 0);class G_ extends Ul{constructor(){super(...arguments);h(this,"_flippedObject",!1)}onAfterCreated(){this.uiObject&&!this._flippedObject&&(this._flippedObject=!0,this.uiObject.scale.y*=-1)}}var V_=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};let h1=class{constructor(){h(this,"texture",null);h(this,"rect")}};V_([x(Rt)],h1.prototype,"texture",void 0);let SA=class extends G_{constructor(){super(...arguments);h(this,"_sprite");h(this,"pixelsPerUnitMultiplier",1)}set image(t){this.sprite||(this.sprite=new h1),this.sprite.texture=t,this.onAfterCreated()}get image(){return this.sprite?this.sprite.texture:null}get sprite(){return this._sprite}set sprite(t){this._sprite!==t&&(this._sprite=t,this.onAfterCreated())}isBuiltinSprite(){var t,i,s,r,o,a,l,c;switch((i=(t=this.sprite)==null?void 0:t.texture)==null?void 0:i.name){case"InputFieldBackground":case"UISprite":case"Background":case"Knob":return!0}return((o=(r=(s=this.sprite)==null?void 0:s.texture)==null?void 0:r.image)==null?void 0:o.width)===32&&((c=(l=(a=this.sprite)==null?void 0:a.texture)==null?void 0:l.image)==null?void 0:c.height)===32}onBeforeCreate(t){var i,s;super.onBeforeCreate(t),this.isBuiltinSprite()&&(t.borderRadius=5/this.pixelsPerUnitMultiplier,((s=(i=this.sprite)==null?void 0:i.texture)==null?void 0:s.name)==="Knob"&&(t.borderRadius=999))}onAfterCreated(){var t;this.__didAwake&&(super.onAfterCreated(),!this.isBuiltinSprite()&&this.setTexture((t=this.sprite)==null?void 0:t.texture))}};V_([x(h1)],SA.prototype,"sprite",null);V_([x()],SA.prototype,"pixelsPerUnitMultiplier",void 0);class u1 extends G_{constructor(){super(...arguments);h(this,"_mainTexture")}get mainTexture(){return this._mainTexture}set mainTexture(t){this._mainTexture!==t&&(this._mainTexture=t,this.onAfterCreated())}onAfterCreated(){this.__didAwake&&(super.onAfterCreated(),this.setTexture(this.mainTexture))}}V_([x(Rt)],u1.prototype,"mainTexture",null);var Hr=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const Pd=re("debugbutton");var pa;(function(n){n[n.None=0]="None",n[n.ColorTint=1]="ColorTint",n[n.SpriteSwap=2]="SpriteSwap",n[n.Animation=3]="Animation"})(pa||(pa={}));class Qu{constructor(){h(this,"colorMultiplier");h(this,"disabledColor");h(this,"fadeDuration");h(this,"highlightedColor");h(this,"normalColor");h(this,"pressedColor");h(this,"selectedColor")}}Hr([x()],Qu.prototype,"colorMultiplier",void 0);Hr([x(Si)],Qu.prototype,"disabledColor",void 0);Hr([x()],Qu.prototype,"fadeDuration",void 0);Hr([x(Si)],Qu.prototype,"highlightedColor",void 0);Hr([x(Si)],Qu.prototype,"normalColor",void 0);Hr([x(Si)],Qu.prototype,"pressedColor",void 0);Hr([x(Si)],Qu.prototype,"selectedColor",void 0);class gh extends Te{constructor(){super(...arguments);h(this,"onClick");h(this,"_isHovered",!1);h(this,"colors");h(this,"transition");h(this,"animationTriggers");h(this,"animator");h(this,"_interactable",!0);h(this,"_requestedAnimatorTrigger");h(this,"_isInit",!1);h(this,"_image")}onPointerEnter(t){var i,s;Pd&&console.log("Button Enter",(i=this.animationTriggers)==null?void 0:i.highlightedTrigger,this.animator),this._isHovered=!0,this.interactable&&(this.transition==pa.Animation&&this.animationTriggers&&this.animator?this.animator.setTrigger(this.animationTriggers.highlightedTrigger):this.transition===pa.ColorTint&&this.colors&&((s=this._image)==null||s.setState("hovered")),this.context.input.setCursorPointer())}onPointerExit(){var t,i;Pd&&console.log("Button Exit",(t=this.animationTriggers)==null?void 0:t.highlightedTrigger,this.animator),this._isHovered=!1,this.interactable&&(this.transition==pa.Animation&&this.animationTriggers&&this.animator?this.animator.setTrigger(this.animationTriggers.normalTrigger):this.transition===pa.ColorTint&&this.colors&&((i=this._image)==null||i.setState("normal")),this.context.input.setCursorNormal())}onPointerDown(t){var i,s;Pd&&console.log("Button Down",(i=this.animationTriggers)==null?void 0:i.highlightedTrigger,this.animator),this.interactable&&(this.transition==pa.Animation&&this.animationTriggers&&this.animator?this.animator.setTrigger(this.animationTriggers.pressedTrigger):this.transition===pa.ColorTint&&this.colors&&((s=this._image)==null||s.setState("pressed")))}onPointerUp(t){var i,s;Pd&&console.warn("Button Up",(i=this.animationTriggers)==null?void 0:i.highlightedTrigger,this.animator,this._isHovered),this.interactable&&(this.transition==pa.Animation&&this.animationTriggers&&this.animator?this.animator.setTrigger(this._isHovered?this.animationTriggers.highlightedTrigger:this.animationTriggers.normalTrigger):this.transition===pa.ColorTint&&this.colors&&((s=this._image)==null||s.setState(this._isHovered?"hovered":"normal")))}onPointerClick(t){!this.interactable||t.pointerId===void 0||t.pointerId!==0&&this.context.input.getIsMouse(t.pointerId)||(Pd&&(console.warn("Button Click",this.onClick),bn("CLICKED button "+this.name+" at "+this.context.time.frameCount)),this.onClick&&this.onClick.listenerCount>0&&(this.onClick.invoke(),t.use()))}set interactable(t){this._interactable=t,this._image&&(this._image.setInteractable(t),t?this._image.setState("normal"):this._image.setState("disabled"))}get interactable(){return this._interactable}set_interactable(t){this.interactable=t}awake(){super.awake(),Pd&&console.log(this),this._isInit=!1,this.init()}start(){var t;(t=this._image)==null||t.setInteractable(this.interactable)}onEnable(){super.onEnable()}onDestroy(){this._isHovered&&this.context.input.setCursorNormal()}*setAnimatorTriggerAtEndOfFrame(t){var i;this._requestedAnimatorTrigger=t,yield,yield,this._requestedAnimatorTrigger==t&&((i=this.animator)==null||i.SetTrigger(t))}init(){this._isInit||(this._isInit=!0,this._image=ne.getComponent(this.gameObject,SA),this._image&&(this.stateSetup(this._image),this.interactable?this._image.setState("normal"):this._image.setState("disabled")))}stateSetup(t){var p,g,A,v,m;t.setInteractable(this.interactable);const i=this.getFinalColor(t.color,(p=this.colors)==null?void 0:p.normalColor),s={state:"normal",attributes:{backgroundColor:i,backgroundOpacity:i.alpha}};t.setupState(s);const r=this.getFinalColor(t.color,(g=this.colors)==null?void 0:g.highlightedColor),o={state:"hovered",attributes:{backgroundColor:r,backgroundOpacity:r.alpha}};t.setupState(o);const a=this.getFinalColor(t.color,(A=this.colors)==null?void 0:A.pressedColor),l={state:"pressed",attributes:{backgroundColor:a,backgroundOpacity:a.alpha}};t.setupState(l);const c=this.getFinalColor(t.color,(v=this.colors)==null?void 0:v.selectedColor),u={state:"selected",attributes:{backgroundColor:c,backgroundOpacity:c.alpha}};t.setupState(u);const d=this.getFinalColor(t.color,(m=this.colors)==null?void 0:m.disabledColor),f={state:"disabled",attributes:{backgroundColor:d,backgroundOpacity:d.alpha}};t.setupState(f)}getFinalColor(t,i){return i?t.clone().multiply(i):t.clone()}}Hr([x(qn)],gh.prototype,"onClick",void 0);Hr([x()],gh.prototype,"colors",void 0);Hr([x()],gh.prototype,"transition",void 0);Hr([x()],gh.prototype,"animationTriggers",void 0);Hr([x(Xs)],gh.prototype,"animator",void 0);Hr([x()],gh.prototype,"interactable",null);var En=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const mD=re("debuguilayout");class Wu{constructor(){h(this,"left",0);h(this,"right",0);h(this,"top",0);h(this,"bottom",0)}get vertical(){return this.top+this.bottom}get horizontal(){return this.left+this.right}}En([x()],Wu.prototype,"left",void 0);En([x()],Wu.prototype,"right",void 0);En([x()],Wu.prototype,"top",void 0);En([x()],Wu.prototype,"bottom",void 0);var pE;(function(n){n[n.UpperLeft=0]="UpperLeft",n[n.UpperCenter=1]="UpperCenter",n[n.UpperRight=2]="UpperRight",n[n.MiddleLeft=3]="MiddleLeft",n[n.MiddleCenter=4]="MiddleCenter",n[n.MiddleRight=5]="MiddleRight",n[n.LowerLeft=6]="LowerLeft",n[n.LowerCenter=7]="LowerCenter",n[n.LowerRight=8]="LowerRight",n[n.Custom=9]="Custom"})(pE||(pE={}));var _u;(function(n){n.Horizontal="x",n.Vertical="y"})(_u||(_u={}));class Qr extends Te{constructor(){super(...arguments);h(this,"_rectTransform",null);h(this,"_needsUpdate",!1);h(this,"childAlignment",pE.UpperLeft);h(this,"reverseArrangement",!1);h(this,"spacing",0);h(this,"padding");h(this,"minWidth",0);h(this,"minHeight",0);h(this,"flexibleHeight",0);h(this,"flexibleWidth",0);h(this,"preferredHeight",0);h(this,"preferredWidth",0)}get rectTransform(){return this._rectTransform}onParentRectTransformChanged(t){this._needsUpdate=!0}get isDirty(){return this._needsUpdate}get isLayoutGroup(){return!0}updateLayout(){this._rectTransform&&(mD&&console.warn("Layout Update",this.context.time.frame,this.name),this._needsUpdate=!1,this.onCalculateLayout(this._rectTransform))}start(){this._needsUpdate=!0}onEnable(){mD&&console.log(this.name,this),this._rectTransform=this.gameObject.getComponent(Ts);const t=this.gameObject.getComponentInParent(Yn);t&&t.registerLayoutGroup(this),this._needsUpdate=!0}onDisable(){const t=this.gameObject.getComponentInParent(Yn);t&&t.unregisterLayoutGroup(this)}set m_Spacing(t){t!==this.spacing&&(this._needsUpdate=!0,this.spacing=t)}get m_Spacing(){return this.spacing}}En([x()],Qr.prototype,"childAlignment",void 0);En([x()],Qr.prototype,"reverseArrangement",void 0);En([x()],Qr.prototype,"spacing",void 0);En([x(Wu)],Qr.prototype,"padding",void 0);En([x()],Qr.prototype,"minWidth",void 0);En([x()],Qr.prototype,"minHeight",void 0);En([x()],Qr.prototype,"flexibleHeight",void 0);En([x()],Qr.prototype,"flexibleWidth",void 0);En([x()],Qr.prototype,"preferredHeight",void 0);En([x()],Qr.prototype,"preferredWidth",void 0);class mh extends Qr{constructor(){super(...arguments);h(this,"childControlHeight",!0);h(this,"childControlWidth",!0);h(this,"childForceExpandHeight",!1);h(this,"childForceExpandWidth",!1);h(this,"childScaleHeight",!1);h(this,"childScaleWidth",!1)}onCalculateLayout(t){var R;const i=this.primaryAxis,s=t.width;let r=s;const o=t.height;let a=o;r-=this.padding.horizontal,a-=this.padding.vertical,i===_u.Horizontal?this.padding.horizontal:this.padding.vertical;const l=i===_u.Horizontal,c=l?"y":"x",u=l?this.childControlWidth:this.childControlHeight,d=l?this.childControlHeight:this.childControlWidth,f=l?this.childForceExpandWidth:this.childForceExpandHeight,p=l?this.childForceExpandHeight:this.childForceExpandWidth,g=l?a:r,A=l?s:o,v=.5*(l?this.childAlignment%3:Math.floor(this.childAlignment/3));let m=0;l?m+=this.padding.left:m+=this.padding.top;let b=0,y=0;for(let C=0;C<this.gameObject.children.length;C++){const T=this.gameObject.children[C],O=ne.getComponent(T,Ts);O!=null&&O.activeAndEnabled&&(y+=1,l?b+=O.width:b+=O.height)}let _=0;const E=this.spacing*(y-1);if(f||u){let C=0;l?C=r-=E:C=a-=E,y>0&&(_=C/y)}let M=0;M+=this.padding.left,M-=this.padding.right,v!==0&&(m=A-b,m*=v,m-=E*v,l?(m-=this.padding.right*v,m+=this.padding.left*(1-v),m<this.padding.left&&(m=this.padding.left)):(m-=this.padding.bottom*v,m+=this.padding.top*(1-v),m<this.padding.top&&(m=this.padding.top)));let I=1;for(let C=0;C<this.gameObject.children.length;C++){const T=this.gameObject.children[C],O=ne.getComponent(T,Ts);if(O!=null&&O.activeAndEnabled){(R=O.pivot)==null||R.set(.5,.5),O.anchorMin.set(0,1),O.anchorMax.set(0,1);const J=s*.5+M*.5;O.anchoredPosition.x!==J&&(O.anchoredPosition.x=J);const V=o*-.5;O.anchoredPosition.y!==V&&(O.anchoredPosition.y=V),p&&d&&O.sizeDelta[c]!==g&&(O.sizeDelta[c]=g),f&&u&&O.sizeDelta[i]!==_&&(O.sizeDelta[i]=_);const H=l?O.width:O.height,Y=H*.5;if(m+=Y,f){const L=_*I-_*.5;L>m&&(m=L-_*.5+H+this.padding.left,m-=Y)}let N=m;i===_u.Vertical&&(N=-N),O.anchoredPosition[i]!==N&&(O.anchoredPosition[i]=N),m+=Y,m+=this.spacing,I+=1}}}}En([x()],mh.prototype,"childControlHeight",void 0);En([x()],mh.prototype,"childControlWidth",void 0);En([x()],mh.prototype,"childForceExpandHeight",void 0);En([x()],mh.prototype,"childForceExpandWidth",void 0);En([x()],mh.prototype,"childScaleHeight",void 0);En([x()],mh.prototype,"childScaleWidth",void 0);class jN extends mh{get primaryAxis(){return _u.Vertical}}class qN extends mh{get primaryAxis(){return _u.Horizontal}}class XN extends Qr{onCalculateLayout(){}}var qa=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r},ba;(function(n){n[n.ScreenSpaceOverlay=0]="ScreenSpaceOverlay",n[n.ScreenSpaceCamera=1]="ScreenSpaceCamera",n[n.WorldSpace=2]="WorldSpace",n[n.Undefined=-1]="Undefined"})(ba||(ba={}));const iS=re("debuguilayout");class Yn extends T_{constructor(){super(...arguments);h(this,"_renderOnTop");h(this,"_depthWrite",!1);h(this,"_doubleSided",!0);h(this,"_castShadows",!1);h(this,"_receiveShadows",!1);h(this,"_renderMode",ba.Undefined);h(this,"_rootCanvas");h(this,"_scaleFactor",1);h(this,"worldCamera");h(this,"planeDistance",-1);h(this,"_boundRenderSettingsChanged",this.onRenderSettingsChanged.bind(this));h(this,"previousParent",null);h(this,"_lastMatrixWorld",null);h(this,"_rectTransforms",[]);h(this,"_layoutGroups",new Map);h(this,"_receivers",[]);h(this,"onBeforeRenderRoutine",()=>{var t,i,s,r;if(this.context.isInVR){this.onUpdateRenderMode(),this.handleLayoutUpdates(),(t=this.shadowComponent)==null||t.updateMatrixWorld(!0),(i=this.shadowComponent)==null||i.updateWorldMatrix(!0,!0),this.invokeBeforeRenderEvents(),hr.ensureUpdateMeshUI(Zw,this.context,!0);return}this.previousParent=this.gameObject.parent,this.renderOnTop||this.screenspace?this.gameObject.removeFromParent():(this.onUpdateRenderMode(),this.handleLayoutUpdates(),(s=this.shadowComponent)==null||s.updateMatrixWorld(!0),(r=this.shadowComponent)==null||r.updateWorldMatrix(!0,!0),this.invokeBeforeRenderEvents(),hr.ensureUpdateMeshUI(Zw,this.context))});h(this,"onAfterRenderRoutine",()=>{var t,i;if(!this.context.isInVR){if((this.screenspace||this.renderOnTop)&&this.previousParent&&this.context.mainCamera){if(this.screenspace){const o=this.context.mainCamera;o==null||o.add(this.gameObject)}else this.previousParent.add(this.gameObject);const s=this.context.renderer.autoClear,r=this.context.renderer.autoClearColor;this.context.renderer.autoClear=!1,this.context.renderer.autoClearColor=!1,this.context.renderer.clearDepth(),this.onUpdateRenderMode(!0),this.handleLayoutUpdates(),(t=this.shadowComponent)==null||t.updateMatrixWorld(!0),this.invokeBeforeRenderEvents(),hr.ensureUpdateMeshUI(Zw,this.context,!0),this.context.renderer.render(this.gameObject,this.context.mainCamera),this.context.renderer.autoClear=s,this.context.renderer.autoClearColor=r,this.previousParent.add(this.gameObject)}(i=this._lastMatrixWorld)==null||i.copy(this.gameObject.matrixWorld)}});h(this,"_updateRenderSettingsRoutine");h(this,"_activeRenderMode",-1);h(this,"_lastWidth",-1);h(this,"_lastHeight",-1)}get isCanvas(){return!0}get screenspace(){return this.renderMode!==ba.WorldSpace}set renderOnTop(t){t!==this._renderOnTop&&(this._renderOnTop=t,this.onRenderSettingsChanged())}get renderOnTop(){return this._renderOnTop!==void 0?this._renderOnTop:!!(this.screenspace&&this._renderMode===ba.ScreenSpaceOverlay)}set depthWrite(t){this._depthWrite!==t&&(this._depthWrite=t,this.onRenderSettingsChanged())}get depthWrite(){return this._depthWrite}set doubleSided(t){this._doubleSided!==t&&(this._doubleSided=t,this.onRenderSettingsChanged())}get doubleSided(){return this._doubleSided}set castShadows(t){this._castShadows!==t&&(this._castShadows=t,this.onRenderSettingsChanged())}get castShadows(){return this._castShadows}set receiveShadows(t){this._receiveShadows!==t&&(this._receiveShadows=t,this.onRenderSettingsChanged())}get receiveShadows(){return this._receiveShadows}get renderMode(){return this._renderMode}set renderMode(t){this._renderMode!==t&&(this._renderMode=t,this.onRenderSettingsChanged())}set rootCanvas(t){this._rootCanvas instanceof Yn||(this._rootCanvas=t)}get rootCanvas(){return this._rootCanvas}get scaleFactor(){return this._scaleFactor}set scaleFactor(t){this._scaleFactor=t}awake(){var t;this.shadowComponent=this.gameObject,this.previousParent=this.gameObject.parent,iS&&console.log("Canvas.Awake()",((t=this.previousParent)==null?void 0:t.name)+"/"+this.gameObject.name),super.awake()}start(){this.onUpdateRenderMode()}onEnable(){super.onEnable(),this._updateRenderSettingsRoutine=void 0,this._lastMatrixWorld=new Ie,this.onUpdateRenderMode(),document.addEventListener("resize",this._boundRenderSettingsChanged),this.context.pre_render_callbacks.push(this.onBeforeRenderRoutine),this.context.post_render_callbacks.push(this.onAfterRenderRoutine)}onDisable(){super.onDisable(),document.removeEventListener("resize",this._boundRenderSettingsChanged);const t=this.context.pre_render_callbacks.indexOf(this.onBeforeRenderRoutine);t!==-1&&this.context.pre_render_callbacks.splice(t,1);const i=this.context.post_render_callbacks.indexOf(this.onAfterRenderRoutine);i!==-1&&this.context.post_render_callbacks.splice(i,1)}registerTransform(t){this._rectTransforms.push(t)}unregisterTransform(t){const i=this._rectTransforms.indexOf(t);i!==-1&&this._rectTransforms.splice(i,1)}registerLayoutGroup(t){const i=t.gameObject;this._layoutGroups.set(i,t)}unregisterLayoutGroup(t){const i=t.gameObject;this._layoutGroups.delete(i)}registerEventReceiver(t){this._receivers.push(t)}unregisterEventReceiver(t){const i=this._receivers.indexOf(t);i!==-1&&this._receivers.splice(i,1)}invokeBeforeRenderEvents(){var t;for(const i of this._receivers)(t=i.onBeforeCanvasRender)==null||t.call(i,this)}handleLayoutUpdates(){this._lastMatrixWorld===null&&(this._lastMatrixWorld=new Ie);const t=!this._lastMatrixWorld.equals(this.gameObject.matrixWorld);iS&&t&&console.log("Canvas Layout changed",this.context.time.frameCount,this.name);const i=!1;for(const s of this._rectTransforms){t&&s.markDirty();let r=this._layoutGroups.get(s.gameObject);s.isDirty&&!r&&(r=s.gameObject.getComponentInParent(Qr)),(s.isDirty||r!=null&&r.isDirty)&&(iS&&!i&&console.log("CANVAS UPDATE ### "+s.name+" ##################################### "+this.context.time.frame),r==null||r.updateLayout(),s.updateTransform())}}applyRenderSettings(){this.onRenderSettingsChanged()}onRenderSettingsChanged(){this._updateRenderSettingsRoutine||(this._updateRenderSettingsRoutine=this.startCoroutine(this._updateRenderSettingsDelayed(),li.OnBeforeRender))}*_updateRenderSettingsDelayed(){if(yield,this._updateRenderSettingsRoutine=void 0,this.shadowComponent){this.onUpdateRenderMode(),U0(this.shadowComponent,this);for(const t of ne.getComponentsInChildren(this.gameObject,Va))U0(t.shadowComponent,this)}}onUpdateRenderMode(t=!1){if(!t&&this._renderMode===this._activeRenderMode&&this._lastWidth===this.context.domWidth&&this._lastHeight===this.context.domHeight)return;this._activeRenderMode=this._renderMode;let i=this.context.mainCameraComponent,s=10;switch(i&&i.nearClipPlane>0&&i.farClipPlane>0&&(s=tt.lerp(i.nearClipPlane,i.farClipPlane,.01)),this._renderMode===ba.ScreenSpaceCamera&&(this.worldCamera&&(i=this.worldCamera),this.planeDistance>0&&(s=this.planeDistance)),this._renderMode){case ba.ScreenSpaceOverlay:case ba.ScreenSpaceCamera:if(this._lastWidth=this.context.domWidth,this._lastHeight=this.context.domHeight,!i)return;const r=s+.01;this.gameObject.position.x=0,this.gameObject.position.y=0,this.gameObject.position.z=-r,this.gameObject.quaternion.identity();const o=this.gameObject.getComponent(Ts);let a=!1;o.sizeDelta.x!==this.context.domWidth&&(a=!0),o.sizeDelta.y!==this.context.domHeight&&(a=!0);const l=i.fieldOfView*Math.PI/180,c=2*Math.tan(l/2)*Math.abs(r);this.gameObject.scale.x=c/this.context.domHeight,this.gameObject.scale.y=c/this.context.domHeight,this.gameObject.scale.z=.01,a&&(o.sizeDelta.x=this.context.domWidth,o.sizeDelta.y=this.context.domHeight,o==null||o.markDirty());break;case ba.WorldSpace:this._lastWidth=-1,this._lastHeight=-1;break}}}qa([x()],Yn.prototype,"renderOnTop",null);qa([x()],Yn.prototype,"depthWrite",null);qa([x()],Yn.prototype,"doubleSided",null);qa([x()],Yn.prototype,"castShadows",null);qa([x()],Yn.prototype,"receiveShadows",null);qa([x()],Yn.prototype,"renderMode",null);qa([x(Yn)],Yn.prototype,"rootCanvas",null);qa([x()],Yn.prototype,"scaleFactor",null);qa([x(yi)],Yn.prototype,"worldCamera",void 0);qa([x()],Yn.prototype,"planeDistance",void 0);var d1=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};class ku extends Te{constructor(){super(...arguments);h(this,"_alpha",1);h(this,"interactable",!0);h(this,"blocksRaycasts",!0);h(this,"_isDirty",!1);h(this,"_buffer",[])}get alpha(){return this._alpha}set alpha(t){t!==this._alpha&&(this._alpha=t,this.markDirty())}get isCanvasGroup(){return!0}markDirty(){this._isDirty||(this._isDirty=!0,this.startCoroutine(this.applyChangesDelayed(),li.OnBeforeRender))}*applyChangesDelayed(){this._isDirty=!1,this.applyChangesNow()}applyChangesNow(){for(const t of ne.getComponentsInChildren(this.gameObject,Va,this._buffer)){const i=t;i.setAlphaFactor&&i.setAlphaFactor(this._alpha)}}}d1([x()],ku.prototype,"alpha",null);d1([x()],ku.prototype,"interactable",void 0);d1([x()],ku.prototype,"blocksRaycasts",void 0);var Oi=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};class up extends Te{constructor(){super(...arguments);h(this,"object");h(this,"target");h(this,"duration",1);h(this,"relativeMotion",!1);h(this,"coroutine",null);h(this,"targetPos",new w);h(this,"targetRot",new Se);h(this,"targetScale",new w)}*moveToTarget(){if(!this.target||!this.object)return;const t=Mt(this.object).clone(),i=Mt(this.target).clone(),s=Gr(this.object).clone(),r=Gr(this.target).clone(),o=Jo(this.object).clone(),a=Jo(this.target).clone(),l=t.distanceTo(i),c=s.angleTo(r),u=o.distanceTo(a);if(l<.01&&c<.01&&u<.01){On(this.object,i),_o(this.object,r),WR(this.object,a),this.coroutine=null;return}let d=0,f=0;for(;d<1;)d+=this.context.time.deltaTime/this.duration,d>1&&(d=1),f=d<.5?4*d*d*d:1-Math.pow(-2*d+2,3)/2,this.targetPos.lerpVectors(t,i,f),this.targetRot.slerpQuaternions(s,r,f),this.targetScale.lerpVectors(o,a,f),On(this.object,this.targetPos),_o(this.object,this.targetRot),WR(this.object,this.targetScale),yield;this.coroutine=null}*moveRelative(){if(!this.target||!this.object)return;const t=this.object.position.clone(),i=this.object.quaternion.clone(),s=this.object.scale.clone(),r=this.target.position.clone(),o=this.target.quaternion.clone(),a=this.target.scale.clone();r.applyQuaternion(this.object.quaternion),this.targetPos.copy(this.object.position).add(r),this.targetRot.copy(this.object.quaternion).multiply(o),this.targetScale.copy(this.object.scale).multiply(a);let l=0,c=0;for(;l<1;)l+=this.context.time.deltaTime/this.duration,l>1&&(l=1),c=l<.5?4*l*l*l:1-Math.pow(-2*l+2,3)/2,this.object.position.lerpVectors(t,this.targetPos,c),this.object.quaternion.slerpQuaternions(i,this.targetRot,c),this.object.scale.lerpVectors(s,this.targetScale,c),yield;this.coroutine=null}onPointerClick(t){t.use(),this.coroutine&&this.stopCoroutine(this.coroutine),this.relativeMotion?this.coroutine=this.startCoroutine(this.moveRelative()):this.coroutine=this.startCoroutine(this.moveToTarget())}beforeCreateDocument(t){var i;if(this.target&&this.object&&this.gameObject){const s=new Cs("Move to "+((i=this.target)==null?void 0:i.name),Nr.tapTrigger(this.gameObject),di.transformAction(this.object,this.target,this.duration,this.relativeMotion?E0.Relative:E0.Absolute));t.addBehavior(s)}}}Oi([x(Me)],up.prototype,"object",void 0);Oi([x(Me)],up.prototype,"target",void 0);Oi([x()],up.prototype,"duration",void 0);Oi([x()],up.prototype,"relativeMotion",void 0);const ya=class extends Te{constructor(){super(...arguments);h(this,"materialToSwitch");h(this,"variantMaterial");h(this,"fadeDuration",0);h(this,"_objectsWithThisMaterial",[]);h(this,"selfModel");h(this,"targetModels")}awake(){if(this.variantMaterial&&this.materialToSwitch){const t=ne.findObjectsOfType(Ci);for(const i of t)for(let s=0;s<i.sharedMaterials.length;s++){const r=i.sharedMaterials[s];if(r===this.materialToSwitch){if(i.gameObject instanceof ye)this._objectsWithThisMaterial.push(i.gameObject);else if(i.gameObject instanceof ar)for(const o of i.gameObject.children)o instanceof ye&&o.material===r&&this._objectsWithThisMaterial.push(o);break}}}}onPointerClick(t){if(t.use(),!!this.variantMaterial)for(let i=0;i<this._objectsWithThisMaterial.length;i++){const s=this._objectsWithThisMaterial[i];s.material=this.variantMaterial}}async beforeCreateDocument(t,i){this.targetModels=[],ya._materialTriggersPerId={},ya.variantSwitchIndex=0,this.materialToSwitch&&await fo.assignTextureLOD(this.context,this.sourceId,this.materialToSwitch,0),this.variantMaterial&&await fo.assignTextureLOD(this.context,this.sourceId,this.variantMaterial,0)}createBehaviours(t,i,s){this._objectsWithThisMaterial.find(o=>o.uuid===i.uuid)&&this.targetModels.push(i),this.gameObject.uuid===i.uuid&&(this.selfModel=i,this.materialToSwitch&&(ya._materialTriggersPerId[this.materialToSwitch.uuid]||(ya._materialTriggersPerId[this.materialToSwitch.uuid]=[]),ya._materialTriggersPerId[this.materialToSwitch.uuid].push(this)))}afterCreateDocument(t,i){if(!this.materialToSwitch)return;const s=ya._materialTriggersPerId[this.materialToSwitch.uuid];if(s){const r={};for(const a of s){const l=a.createVariants();l&&l.length>0&&(r[a.selfModel.uuid]=l)}const o=[];for(const a of s){for(const l in r)l!==a.selfModel.uuid&&o.push(r[l]);a.createAndAttachBehaviors(t,r[a.selfModel.uuid],o)}}delete ya._materialTriggersPerId[this.materialToSwitch.uuid]}createAndAttachBehaviors(t,i,s){const r=[],o=[],a=Math.max(0,this.fadeDuration);for(const l of this.targetModels){const c=di.fadeAction(l,a,!1);o.push(c)}for(const l of s)o.push(di.fadeAction(l,a,!1));for(const l of i)r.push(di.fadeAction(l,a,!1)),o.push(di.fadeAction(l,a,!0));t.addBehavior(new Cs("Select "+this.selfModel.name,Nr.tapTrigger(this.selfModel),di.parallel(...o))),t.addBehavior(new Cs("Start hidden "+this.selfModel.name,Nr.sceneStartTrigger(),di.parallel(...r)))}createVariants(){if(!this.variantMaterial)return null;const t=[];for(const i of this.targetModels){const s=i.clone();s.name+=" variant_"+this.variantMaterial.name+"_"+ya.variantSwitchIndex++,s.name=s.name.replace(/\s/g,"_"),s.material=this.variantMaterial,s.geometry=i.geometry,s.matrix=i.matrix,(!i.parent||!i.parent.isEmpty())&&Or.createEmptyParent(i),i.parent&&i.parent.add(s),t.push(s)}return t}};let Pl=ya;h(Pl,"_materialTriggersPerId",{}),h(Pl,"variantSwitchIndex",0);Oi([x(Pt)],Pl.prototype,"materialToSwitch",void 0);Oi([x(Pt)],Pl.prototype,"variantMaterial",void 0);Oi([x()],Pl.prototype,"fadeDuration",void 0);class CA extends Te{constructor(){super(...arguments);h(this,"target");h(this,"toggleOnClick",!1);h(this,"targetState",!0);h(this,"hideSelf",!0);h(this,"selfModel");h(this,"otherModel");h(this,"toggleModel");h(this,"stateBeforeCreatingDocument",!1)}onPointerClick(t){t.use(),!this.toggleOnClick&&this.hideSelf&&(this.gameObject.visible=!1),this.target&&(this.target.visible=this.toggleOnClick?!this.target.visible:this.targetState)}createBehaviours(t,i,s){i.uuid===this.gameObject.uuid&&(this.selfModel=i)}beforeCreateDocument(){this.stateBeforeCreatingDocument=this.gameObject.visible,this.gameObject.visible=!0}afterCreateDocument(t,i){if(this.target){if(this.otherModel=i.document.findById(this.target.uuid),this.selfModel&&this.otherModel){let s=this.hideSelf;this.targetState,this.toggleOnClick&&(s=!0,this.target.visible,(!this.selfModel.parent||this.selfModel.parent.isEmpty())&&ZF.createEmptyParent(this.selfModel),this.toggleModel=this.selfModel.clone(),this.toggleModel.name+="_toggle",this.selfModel.parent.add(this.toggleModel));const r=[];if(s&&r.push(di.fadeAction(this.selfModel,0,!1)),this.toggleModel&&r.push(di.fadeAction(this.toggleModel,0,!0)),r.push(di.fadeAction(this.otherModel,0,this.targetState)),t.addBehavior(new Cs("Toggle_"+this.selfModel.name+"_hideSelf",Nr.tapTrigger(this.selfModel),di.sequence(...r))),this.toggleOnClick&&this.toggleModel){const o=[];o.push(di.fadeAction(this.toggleModel,0,!1)),o.push(di.fadeAction(this.selfModel,0,!0)),o.push(di.fadeAction(this.otherModel,0,!this.targetState)),t.addBehavior(new Cs("Toggle_"+this.selfModel.name+"_toggleSelf",Nr.tapTrigger(this.toggleModel),di.sequence(...o))),t.addBehavior(new Cs("HideOnStart_"+this.gameObject.name,Nr.sceneStartTrigger(),di.fadeAction(this.toggleModel,0,!1)))}}this.gameObject.visible=this.stateBeforeCreatingDocument}}}Oi([x(Me)],CA.prototype,"target",void 0);Oi([x()],CA.prototype,"targetState",void 0);Oi([x()],CA.prototype,"hideSelf",void 0);class YN extends Te{start(){this.gameObject.visible=!1}createBehaviours(e,t,i){t.uuid===this.gameObject.uuid&&e.addBehavior(new Cs("HideOnStart_"+this.gameObject.name,Nr.sceneStartTrigger(),di.fadeAction(t,0,!1)))}beforeCreateDocument(){this.gameObject.visible=!0}afterCreateDocument(){this.gameObject.visible=!1}}class EA extends Te{constructor(){super(...arguments);h(this,"target");h(this,"duration",.5);h(this,"motionType",Bm.bounce)}beforeCreateDocument(){}createBehaviours(t,i,s){if(this.target&&i.uuid===this.gameObject.uuid){const r=new Cs("emphasize "+this.name,Nr.tapTrigger(this.gameObject),di.emphasize(this.target,this.duration,this.motionType,void 0,"basic"));t.addBehavior(r)}}afterCreateDocument(t,i){}}Oi([x()],EA.prototype,"target",void 0);Oi([x()],EA.prototype,"duration",void 0);Oi([x()],EA.prototype,"motionType",void 0);class MA extends Te{constructor(){super(...arguments);h(this,"target");h(this,"clip","");h(this,"toggleOnClick",!1)}onPointerClick(t){if(t.use(),!(!this.target&&!this.clip)){if(!this.target){const i=this.gameObject.addNewComponent(Ni);i&&(i.spatialBlend=1,i.volume=1,i.loop=!1,this.target=i)}this.target&&(this.target.isPlaying&&this.toggleOnClick?this.target.stop():(!this.toggleOnClick&&this.target.isPlaying&&this.target.stop(),this.clip?this.target.play(this.clip):this.target.play()))}}createBehaviours(t,i,s){if(!(!this.target&&!this.clip)&&i.uuid===this.gameObject.uuid){const r=this.clip?this.clip:this.target?this.target.clip:void 0;if(!r||typeof r!="string")return;const o=this.target?this.target.gameObject:this.gameObject,a=r.split("/").pop(),l=this.target?this.target.volume:1,c=this.target&&this.target.spatialBlend==0?Dm.NonSpatial:Dm.Spatial,u=new Cs("playAudio "+this.name,Nr.tapTrigger(this.gameObject),di.playAudioAction(o,"audio/"+a,M0.Play,l,c));t.addBehavior(u)}}async afterSerialize(t,i){if(!this.target&&!this.clip)return;const s=this.clip?this.clip:this.target?this.target.clip:void 0;if(!s||typeof s!="string")return;const r=s.split("/").pop(),l=await(await(await fetch(this.clip)).blob()).arrayBuffer(),c=new Uint8Array(l);i.files["audio/"+r]=c}}Oi([x(Ni)],MA.prototype,"target",void 0);Oi([x(URL)],MA.prototype,"clip",void 0);Oi([x()],MA.prototype,"toggleOnClick",void 0);const tu=class extends Te{constructor(){super(...arguments);h(this,"target");h(this,"animator");h(this,"stateName");h(this,"stateNameAfterPlaying");h(this,"loopAfterPlaying",!1);h(this,"selfModel");h(this,"stateAnimationModel");h(this,"stateAnimation");h(this,"stateAfterPlayingAnimationModel");h(this,"stateAfterPlayingAnimation")}onPointerClick(t){var i;t.use(),this.target&&this.stateName&&((i=this.animator)==null||i.play(this.stateName,0,0,.1))}createBehaviours(t,i,s){i.uuid===this.gameObject.uuid&&(this.selfModel=i)}onAfterHierarchy(){tu.animationActions=[]}afterCreateDocument(t,i){if(!this.stateAnimation||!this.stateAnimationModel)return;i.document.traverse(r=>{var o,a;if(r.uuid===((o=this.target)==null?void 0:o.uuid)&&this.stateAnimation){const l=[];let c=tu.animationActions.find(d=>d.affectedObjects==r&&d.start==this.stateAnimation.start&&d.duration==this.stateAnimation.duration);if(c||(c=di.startAnimationAction(r,this.stateAnimation.start,this.stateAnimation.duration),tu.animationActions.push(c)),l.push(c),this.stateAfterPlayingAnimation&&this.stateAfterPlayingAnimationModel){let d=tu.animationActions.find(p=>p.affectedObjects==r&&p.start==this.stateAfterPlayingAnimation.start&&p.duration==this.stateAfterPlayingAnimation.duration);d||(d=di.startAnimationAction(r,this.stateAfterPlayingAnimation.start,this.stateAfterPlayingAnimation.duration),tu.animationActions.push(d));const f=di.sequence(d);this.loopAfterPlaying&&f.makeLooping(),l.push(f)}const u=new Cs("tap "+this.name+" for "+this.stateName+" on "+((a=this.target)==null?void 0:a.name),Nr.tapTrigger(this.selfModel),di.sequence(...l));t.addBehavior(u)}})}createAnimation(t,i,s){var r,o,a,l,c;if(this.target&&this.animator){const u=(o=(r=this.animator)==null?void 0:r.runtimeAnimatorController)==null?void 0:o.findState(this.stateName);if(!((a=u==null?void 0:u.motion)!=null&&a.clip)){si()&&console.warn("No clip found for state "+this.stateName);return}this.stateAnimationModel=i,this.stateAnimation=t.registerAnimation(this.target,u==null?void 0:u.motion.clip);const d=(c=(l=this.animator)==null?void 0:l.runtimeAnimatorController)==null?void 0:c.findState(this.stateNameAfterPlaying);this.stateAfterPlayingAnimationModel=i,this.stateAfterPlayingAnimation=t.registerAnimation(this.target,d==null?void 0:d.motion.clip)}}};let Na=tu;h(Na,"animationActions",[]);Oi([x(Me)],Na.prototype,"target",void 0);Oi([x(Xs)],Na.prototype,"animator",void 0);Oi([x()],Na.prototype,"stateName",void 0);Oi([x()],Na.prototype,"stateNameAfterPlaying",void 0);Oi([x()],Na.prototype,"loopAfterPlaying",void 0);class TA extends Te{constructor(){super(...arguments);h(this,"target")}getType(){}getDuration(){}}Oi([x(Me)],TA.prototype,"target",void 0);class H_ extends Te{constructor(){super(...arguments);h(this,"target")}}Oi([x(TA)],H_.prototype,"target",void 0);class Q_ extends TA{constructor(){super(...arguments);h(this,"type",Hg.Hide);h(this,"duration",1)}getType(){switch(this.type){case Hg.Hide:return"hide";case Hg.Show:return"show"}}getDuration(){return this.duration}}Oi([x()],Q_.prototype,"type",void 0);Oi([x()],Q_.prototype,"duration",void 0);class JN extends H_{}var Hg;(function(n){n[n.Show=0]="Show",n[n.Hide=1]="Hide"})(Hg||(Hg={}));var Zl=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const AD=re("debugcharactercontroller");class dp extends Te{constructor(){super(...arguments);h(this,"center",new w(0,0,0));h(this,"radius",.5);h(this,"height",2);h(this,"_rigidbody",null);h(this,"_activeGroundCollisions")}get rigidbody(){return this._rigidbody?this._rigidbody:(this._rigidbody=this.gameObject.getComponent(bi),this._rigidbody||(this._rigidbody=this.gameObject.addNewComponent(bi)),this.rigidbody)}awake(){this._activeGroundCollisions=new Set}onEnable(){const t=this.rigidbody;let i=this.gameObject.getComponent(Ou);i||(i=this.gameObject.addNewComponent(Ou)),i.center.copy(this.center),i.radius=this.radius,i.height=this.height;const s=new w(0,0,1),r=new w(1,0,0),o=new w(0,1,0),a=this.gameObject.getWorldDirection(new w);a.y=0;const l=r.dot(a)<0?-1:1,c=s.angleTo(a)*l;this.gameObject.setRotationFromAxisAngle(o,c),t.lockRotationX=!0,t.lockRotationY=!0,t.lockRotationZ=!0}move(t){this.gameObject.position.add(t)}onCollisionEnter(t){(t.contacts.length==0||t.contacts.some(i=>i.normal.y>.2))&&(this._activeGroundCollisions.add(t),AD&&console.log(`Collision(${this._activeGroundCollisions.size}): ${t.contacts.map(i=>i.normal.y.toFixed(2)).join(", ")} - ${this.isGrounded}`))}onCollisionExit(t){this._activeGroundCollisions.delete(t),AD&&console.log(`Collision(${this._activeGroundCollisions.size}) - ${this.isGrounded}`)}get isGrounded(){return this._activeGroundCollisions.size>0}}Zl([x(w)],dp.prototype,"center",void 0);Zl([x()],dp.prototype,"radius",void 0);Zl([x()],dp.prototype,"height",void 0);class Ah extends Te{constructor(){super(...arguments);h(this,"controller");h(this,"movementSpeed",2);h(this,"rotationSpeed",2);h(this,"jumpForce",1);h(this,"doubleJumpForce",2);h(this,"animator");h(this,"lookForward",!0);h(this,"lookInput",new te(0,0));h(this,"moveInput",new te(0,0));h(this,"jumpInput",!1);h(this,"_currentSpeed",new w(0,0,0));h(this,"_currentAngularSpeed",new w(0,0,0));h(this,"_temp",new w(0,0,0));h(this,"_jumpCount",0);h(this,"_currentRotation");h(this,"_raycastOptions",new Ko)}awake(){this._currentRotation=new Se}update(){const t=this.context.input;t.isKeyPressed("KeyW")?this.moveInput.y+=1:t.isKeyPressed("KeyS")&&(this.moveInput.y-=1),t.isKeyPressed("KeyD")?this.lookInput.x+=1:t.isKeyPressed("KeyA")&&(this.lookInput.x-=1),this.jumpInput||(this.jumpInput=t.isKeyDown("Space"))}move(t){this.moveInput.add(t)}look(t){this.lookInput.add(t)}jump(){this.jumpInput=!0}onBeforeRender(){this.handleInput(this.moveInput,this.lookInput,this.jumpInput),this.lookInput.set(0,0),this.moveInput.set(0,0),this.jumpInput=!1}handleInput(t,i,s){var r,o,a,l,c,u,d,f,p,g,A;if((r=this.controller)!=null&&r.isGrounded&&(this._jumpCount=0,this.doubleJumpForce>0&&((o=this.animator)==null||o.setBool("doubleJump",!1))),this._currentSpeed.z+=t.y*this.movementSpeed*this.context.time.deltaTime,(a=this.animator)==null||a.setBool("running",t.length()>.01),(c=this.animator)==null||c.setBool("jumping",((l=this.controller)==null?void 0:l.isGrounded)===!0&&s),this._temp.copy(this._currentSpeed),this._temp.applyQuaternion(this.gameObject.quaternion),this.controller?this.controller.move(this._temp):this.gameObject.position.add(this._temp),this._currentAngularSpeed.y+=tt.toRadians(-i.x*this.rotationSpeed)*this.context.time.deltaTime,this.lookForward&&Math.abs(this._currentAngularSpeed.y)<.01){const v=this.context.mainCameraComponent.forward;v.y=0,v.normalize(),this._currentRotation.setFromUnitVectors(new w(0,0,1),v),this.gameObject.quaternion.slerp(this._currentRotation,this.context.time.deltaTime*10)}if(this.gameObject.rotateY(this._currentAngularSpeed.y),this._currentSpeed.multiplyScalar(1-this.context.time.deltaTime*10),this._currentAngularSpeed.y*=1-this.context.time.deltaTime*10,this.controller&&s&&this.jumpForce>0){let v=(u=this.controller)==null?void 0:u.isGrounded;if(this.doubleJumpForce>0&&!((d=this.controller)!=null&&d.isGrounded)&&this._jumpCount===1&&(v=!0,(f=this.animator)==null||f.setBool("doubleJump",!0)),v){this._jumpCount+=1;const m=this.controller.rigidbody,b=this._jumpCount===2?this.doubleJumpForce:this.jumpForce;m.applyImpulse(new w(0,1,0).multiplyScalar(b))}}if(this.controller){const v=(p=this.controller)==null?void 0:p.rigidbody.getVelocity().y;if(v<-1){this._raycastOptions.ray||(this._raycastOptions.ray=new Qa),this._raycastOptions.ray.origin.copy(Mt(this.gameObject)),this._raycastOptions.ray.direction.set(0,-1,0);const m=this.layer;this.gameObject.layers.disableAll(),this.gameObject.layers.set(2);const b=this.context.physics.raycast(this._raycastOptions);this.gameObject.layers.set(m),(b.length&&b[0].distance>2||v<-10)&&((g=this.animator)==null||g.setBool("falling",!0))}else(A=this.animator)==null||A.setBool("falling",!1)}}}Zl([x(dp)],Ah.prototype,"controller",void 0);Zl([x()],Ah.prototype,"movementSpeed",void 0);Zl([x()],Ah.prototype,"rotationSpeed",void 0);Zl([x()],Ah.prototype,"jumpForce",void 0);Zl([x()],Ah.prototype,"doubleJumpForce",void 0);Zl([x(Xs)],Ah.prototype,"animator",void 0);var J$=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};class W_ extends Zs{constructor(){super(...arguments);h(this,"intensity")}get typeName(){return"ChromaticAberration"}init(){this.intensity.defaultValue=0}onCreateEffect(){const t=new rF;return t.offset=new te(0,0),t.radialModulation=!0,t.modulationOffset=.15,this.intensity.valueProcessor=i=>i*.02,this.intensity.onValueChanged=i=>{t.offset.x=-i,t.offset.y=i},t}}J$([x(Et)],W_.prototype,"intensity",void 0);ta("ChromaticAberration",W_);var j_=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};class ju extends Zs{constructor(){super(...arguments);h(this,"postExposure");h(this,"contrast");h(this,"hueShift");h(this,"saturation")}get typeName(){return"ColorAdjustments"}init(){this.postExposure.valueProcessor=t=>(t=Math.pow(2,t),t),this.postExposure.defaultValue=0,this.contrast.valueProcessor=t=>{let i=1;return t>0?i=200:t<0&&(i=100),t/i},this.contrast.defaultValue=0,this.hueShift.valueProcessor=t=>Math.PI*t/180,this.hueShift.defaultValue=0,this.saturation.valueProcessor=t=>t<0?t/100:t/(100*Math.PI),this.saturation.defaultValue=0}unapply(){this.context.renderer.toneMappingExposure=1}onCreateEffect(){this.context.renderer.toneMapping===Qs&&this.postExposure.overrideState&&(this.context.renderer.toneMapping=dm);const t=new sF;this.postExposure.onValueChanged=s=>{this.context.renderer.toneMapping===Qs&&(this.context.renderer.toneMapping=dm),this.postExposure.overrideState&&(this.context.renderer.toneMappingExposure=s)},this.contrast.onValueChanged=s=>{t.contrast=s};const i=new aF;return this.hueShift.onValueChanged=s=>i.hue=s,this.saturation.onValueChanged=s=>i.saturation=s,[i,t]}}j_([x(Et)],ju.prototype,"postExposure",void 0);j_([x(Et)],ju.prototype,"contrast",void 0);j_([x(Et)],ju.prototype,"hueShift",void 0);j_([x(Et)],ju.prototype,"saturation",void 0);ta("ColorAdjustments",ju);const K$=(Math.sqrt(5)-1)/4,Zn=(5-Math.sqrt(5))/20,ny=n=>Math.floor(n)|0,sy=new Float64Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);function Z$(n=Math.random){const e=$$(n),t=new Float64Array(e).map(o=>sy[o%32*4]),i=new Float64Array(e).map(o=>sy[o%32*4+1]),s=new Float64Array(e).map(o=>sy[o%32*4+2]),r=new Float64Array(e).map(o=>sy[o%32*4+3]);return function(a,l,c,u){let d,f,p,g,A;const v=(a+l+c+u)*K$,m=ny(a+v),b=ny(l+v),y=ny(c+v),_=ny(u+v),E=(m+b+y+_)*Zn,M=m-E,I=b-E,R=y-E,C=_-E,T=a-M,O=l-I,J=c-R,V=u-C;let H=0,Y=0,N=0,L=0;T>O?H++:Y++,T>J?H++:N++,T>V?H++:L++,O>J?Y++:N++,O>V?Y++:L++,J>V?N++:L++;const G=H>=3?1:0,ee=Y>=3?1:0,$=N>=3?1:0,j=L>=3?1:0,ie=H>=2?1:0,Ae=Y>=2?1:0,ge=N>=2?1:0,Ce=L>=2?1:0,Ee=H>=1?1:0,Ne=Y>=1?1:0,Ve=N>=1?1:0,lt=L>=1?1:0,xt=T-G+Zn,et=O-ee+Zn,W=J-$+Zn,Le=V-j+Zn,me=T-ie+2*Zn,ke=O-Ae+2*Zn,we=J-ge+2*Zn,Ze=V-Ce+2*Zn,We=T-Ee+3*Zn,qe=O-Ne+3*Zn,pt=J-Ve+3*Zn,wt=V-lt+3*Zn,Qt=T-1+4*Zn,z=O-1+4*Zn,k=J-1+4*Zn,he=V-1+4*Zn,Re=m&255,Pe=b&255,Fe=y&255,X=_&255;let de=.6-T*T-O*O-J*J-V*V;if(de<0)d=0;else{const Oe=Re+e[Pe+e[Fe+e[X]]];de*=de,d=de*de*(t[Oe]*T+i[Oe]*O+s[Oe]*J+r[Oe]*V)}let le=.6-xt*xt-et*et-W*W-Le*Le;if(le<0)f=0;else{const Oe=Re+G+e[Pe+ee+e[Fe+$+e[X+j]]];le*=le,f=le*le*(t[Oe]*xt+i[Oe]*et+s[Oe]*W+r[Oe]*Le)}let Qe=.6-me*me-ke*ke-we*we-Ze*Ze;if(Qe<0)p=0;else{const Oe=Re+ie+e[Pe+Ae+e[Fe+ge+e[X+Ce]]];Qe*=Qe,p=Qe*Qe*(t[Oe]*me+i[Oe]*ke+s[Oe]*we+r[Oe]*Ze)}let je=.6-We*We-qe*qe-pt*pt-wt*wt;if(je<0)g=0;else{const Oe=Re+Ee+e[Pe+Ne+e[Fe+Ve+e[X+lt]]];je*=je,g=je*je*(t[Oe]*We+i[Oe]*qe+s[Oe]*pt+r[Oe]*wt)}let Ge=.6-Qt*Qt-z*z-k*k-he*he;if(Ge<0)A=0;else{const Oe=Re+1+e[Pe+1+e[Fe+1+e[X+1]]];Ge*=Ge,A=Ge*Ge*(t[Oe]*Qt+i[Oe]*z+s[Oe]*k+r[Oe]*he)}return 27*(d+f+p+g+A)}}function $$(n){const t=new Uint8Array(512);for(let i=0;i<512/2;i++)t[i]=i;for(let i=0;i<512/2-1;i++){const s=i+~~(n()*(256-i)),r=t[i];t[i]=t[s],t[s]=r}for(let i=256;i<512;i++)t[i]=t[i-256];return t}var se=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const ry=re("debugparticles");var wa;(function(n){n[n.Billboard=0]="Billboard",n[n.Stretch=1]="Stretch",n[n.HorizontalBillboard=2]="HorizontalBillboard",n[n.VerticalBillboard=3]="VerticalBillboard",n[n.Mesh=4]="Mesh"})(wa||(wa={}));let qu=class{constructor(){h(this,"alphaKeys");h(this,"colorKeys")}get duration(){return 1}evaluate(e,t){let i,s=0,r=null,o=0;for(let a=0;a<this.alphaKeys.length;a++){const l=this.alphaKeys[a];(l.time<e||!i)&&(i=l,s=a)}for(let a=0;a<this.colorKeys.length;a++){const l=this.colorKeys[a];(l.time<e||!r)&&(r=l,o=a)}if(r)if(o+1<this.colorKeys.length){const l=this.colorKeys[o+1],c=tt.remap(e,r.time,l.time,0,1);t.r=tt.lerp(r.color.r,l.color.r,c),t.g=tt.lerp(r.color.g,l.color.g,c),t.b=tt.lerp(r.color.b,l.color.b,c)}else t.r=r.color.r,t.g=r.color.g,t.b=r.color.b;if(i)if(s+1<this.alphaKeys.length){const l=this.alphaKeys[s+1],c=tt.remap(e,i.time,l.time,0,1);t.alpha=tt.lerp(i.alpha,l.alpha,c)}else t.alpha=i.alpha;return t}};se([x()],qu.prototype,"alphaKeys",void 0);se([x()],qu.prototype,"colorKeys",void 0);var Hn;(function(n){n[n.Constant=0]="Constant",n[n.Curve=1]="Curve",n[n.TwoCurves=2]="TwoCurves",n[n.TwoConstants=3]="TwoConstants"})(Hn||(Hn={}));var $d;(function(n){n[n.Color=0]="Color",n[n.Gradient=1]="Gradient",n[n.TwoColors=2]="TwoColors",n[n.TwoGradients=3]="TwoGradients",n[n.RandomColor=4]="RandomColor"})($d||($d={}));var Xo;(function(n){n[n.Local=0]="Local",n[n.World=1]="World",n[n.Custom=2]="Custom"})(Xo||(Xo={}));var ro;(function(n){n[n.Sphere=0]="Sphere",n[n.SphereShell=1]="SphereShell",n[n.Hemisphere=2]="Hemisphere",n[n.HemisphereShell=3]="HemisphereShell",n[n.Cone=4]="Cone",n[n.Box=5]="Box",n[n.Mesh=6]="Mesh",n[n.ConeShell=7]="ConeShell",n[n.ConeVolume=8]="ConeVolume",n[n.ConeVolumeShell=9]="ConeVolumeShell",n[n.Circle=10]="Circle",n[n.CircleEdge=11]="CircleEdge",n[n.SingleSidedEdge=12]="SingleSidedEdge",n[n.MeshRenderer=13]="MeshRenderer",n[n.SkinnedMeshRenderer=14]="SkinnedMeshRenderer",n[n.BoxShell=15]="BoxShell",n[n.BoxEdge=16]="BoxEdge",n[n.Donut=17]="Donut",n[n.Rectangle=18]="Rectangle",n[n.Sprite=19]="Sprite",n[n.SpriteRenderer=20]="SpriteRenderer"})(ro||(ro={}));var Xh;(function(n){n[n.Random=0]="Random",n[n.Loop=1]="Loop",n[n.PingPong=2]="PingPong",n[n.BurstSpread=3]="BurstSpread"})(Xh||(Xh={}));class ct{constructor(){h(this,"mode");h(this,"constant");h(this,"constantMin");h(this,"constantMax");h(this,"curve");h(this,"curveMin");h(this,"curveMax");h(this,"curveMultiplier")}evaluate(e,t){const i=t===void 0?Math.random():t;switch(this.mode){case Hn.Constant:return this.constant;case Hn.Curve:return e=tt.clamp01(e),this.curve.evaluate(e)*this.curveMultiplier;case Hn.TwoCurves:const s=e*this.curveMin.duration,r=e*this.curveMax.duration;return tt.lerp(this.curveMin.evaluate(s),this.curveMax.evaluate(r),i%1)*this.curveMultiplier;case Hn.TwoConstants:return tt.lerp(this.constantMin,this.constantMax,i%1);default:this.curveMax.evaluate(e)*this.curveMultiplier;break}return 0}getMax(){switch(this.mode){case Hn.Constant:return this.constant;case Hn.Curve:return this.getMaxFromCurve(this.curve)*this.curveMultiplier;case Hn.TwoCurves:return Math.max(this.getMaxFromCurve(this.curveMin),this.getMaxFromCurve(this.curveMax))*this.curveMultiplier;case Hn.TwoConstants:return Math.max(this.constantMin,this.constantMax);default:return 0}}getMaxFromCurve(e){if(!e)return 0;let t=Number.MIN_VALUE;for(let i=0;i<e.keys.length;i++){const s=e.keys[i];s.value>t&&(t=s.value)}return t}}se([x()],ct.prototype,"mode",void 0);se([x()],ct.prototype,"constant",void 0);se([x()],ct.prototype,"constantMin",void 0);se([x()],ct.prototype,"constantMax",void 0);se([x(fh)],ct.prototype,"curve",void 0);se([x(fh)],ct.prototype,"curveMin",void 0);se([x(fh)],ct.prototype,"curveMax",void 0);se([x()],ct.prototype,"curveMultiplier",void 0);const ao=class{constructor(){h(this,"mode");h(this,"color");h(this,"colorMin");h(this,"colorMax");h(this,"gradient");h(this,"gradientMin");h(this,"gradientMax")}evaluate(e,t){const i=t===void 0?Math.random():t;switch(this.mode){case $d.Color:return this.color;case $d.Gradient:return this.gradient.evaluate(e,ao._temp),ao._temp;case $d.TwoColors:return ao._temp.lerpColors(this.colorMin,this.colorMax,i);case $d.TwoGradients:return this.gradientMin.evaluate(e,ao._temp),this.gradientMax.evaluate(e,ao._temp2),ao._temp.lerp(ao._temp2,i)}return ao._temp.set(16711935),ao._temp.alpha=1,ao._temp}};let ls=ao;h(ls,"_temp",new Si(0,0,0,1)),h(ls,"_temp2",new Si(0,0,0,1));se([x(Si)],ls.prototype,"color",void 0);se([x(Si)],ls.prototype,"colorMin",void 0);se([x(Si)],ls.prototype,"colorMax",void 0);se([x(qu)],ls.prototype,"gradient",void 0);se([x(qu)],ls.prototype,"gradientMin",void 0);se([x(qu)],ls.prototype,"gradientMax",void 0);var z0;(function(n){n[n.Hierarchy=0]="Hierarchy",n[n.Local=1]="Local",n[n.Shape=2]="Shape"})(z0||(z0={}));class Ds{constructor(){h(this,"cullingMode");h(this,"duration");h(this,"emitterVelocityMode");h(this,"flipRotation");h(this,"gravityModifier");h(this,"gravityModifierMultiplier");h(this,"loop");h(this,"maxParticles");h(this,"playOnAwake");h(this,"prewarm");h(this,"ringBufferLoopRange");h(this,"ringBufferMode");h(this,"scalingMode");h(this,"simulationSpace");h(this,"simulationSpeed");h(this,"startColor");h(this,"startDelay");h(this,"startDelayMultiplier");h(this,"startLifetime");h(this,"startLifetimeMultiplier");h(this,"startRotation");h(this,"startRotationMultiplier");h(this,"startRotation3D");h(this,"startRotationX");h(this,"startRotationXMultiplier");h(this,"startRotationY");h(this,"startRotationYMultiplier");h(this,"startRotationZ");h(this,"startRotationZMultiplier");h(this,"startSize");h(this,"startSize3D");h(this,"startSizeMultiplier");h(this,"startSizeX");h(this,"startSizeXMultiplier");h(this,"startSizeY");h(this,"startSizeYMultiplier");h(this,"startSizeZ");h(this,"startSizeZMultiplier");h(this,"startSpeed");h(this,"startSpeedMultiplier");h(this,"stopAction");h(this,"useUnscaledTime")}}se([x(ct)],Ds.prototype,"gravityModifier",void 0);se([x(ls)],Ds.prototype,"startColor",void 0);se([x(ct)],Ds.prototype,"startDelay",void 0);se([x(ct)],Ds.prototype,"startLifetime",void 0);se([x(ct)],Ds.prototype,"startRotation",void 0);se([x(ct)],Ds.prototype,"startRotationX",void 0);se([x(ct)],Ds.prototype,"startRotationY",void 0);se([x(ct)],Ds.prototype,"startRotationZ",void 0);se([x(ct)],Ds.prototype,"startSize",void 0);se([x(ct)],Ds.prototype,"startSizeX",void 0);se([x(ct)],Ds.prototype,"startSizeY",void 0);se([x(ct)],Ds.prototype,"startSizeZ",void 0);se([x(ct)],Ds.prototype,"startSpeed",void 0);class G0{constructor(){h(this,"cycleCount");h(this,"maxCount");h(this,"minCount");h(this,"probability");h(this,"repeatInterval");h(this,"time");h(this,"count");h(this,"_performed",0)}reset(){this._performed=0}run(e){if(e<=this.time)return 0;let t=0;if(this.cycleCount===0||this._performed<this.cycleCount){const i=this.time+this.repeatInterval*this._performed;if(e>=i&&(this._performed+=1,Math.random()<this.probability))switch(this.count.mode){case Hn.Constant:t=this.count.constant;break;case Hn.TwoConstants:t=tt.lerp(this.count.constantMin,this.count.constantMax,Math.random());break;case Hn.Curve:t=this.count.curve.evaluate(Math.random());break;case Hn.TwoCurves:const s=Math.random();t=tt.lerp(this.count.curveMin.evaluate(s),this.count.curveMax.evaluate(s),Math.random());break}}return t}}class $l{constructor(){h(this,"enabled");h(this,"bursts");h(this,"rateOverTime");h(this,"rateOverTimeMultiplier");h(this,"rateOverDistance");h(this,"rateOverDistanceMultiplier");h(this,"system")}get burstCount(){var e;return((e=this.bursts)==null?void 0:e.length)??0}reset(){var e;(e=this.bursts)==null||e.forEach(t=>t.reset())}getBurst(){let e=0;if(this.burstCount>0)for(let t=0;t<this.burstCount;t++){const i=this.bursts[t];this.system.main.loop&&i.time>=this.system.time&&i.reset(),e+=Math.round(i.run(this.system.time))}return e}}se([x()],$l.prototype,"enabled",void 0);se([x()],$l.prototype,"bursts",void 0);se([x(ct)],$l.prototype,"rateOverTime",void 0);se([x()],$l.prototype,"rateOverTimeMultiplier",void 0);se([x(ct)],$l.prototype,"rateOverDistance",void 0);se([x()],$l.prototype,"rateOverDistanceMultiplier",void 0);class q_{constructor(){h(this,"enabled");h(this,"color")}}se([x(ls)],q_.prototype,"color",void 0);class Xu{constructor(){h(this,"enabled");h(this,"separateAxes");h(this,"size");h(this,"sizeMultiplier");h(this,"x");h(this,"xMultiplier");h(this,"y");h(this,"yMultiplier");h(this,"z");h(this,"zMultiplier");h(this,"_time",0);h(this,"_temp",new w)}evaluate(e,t,i){if(t||(t=this._temp),!this.enabled)return t.x=t.y=t.z=1,t;if(this.separateAxes)t.x=this.x.evaluate(e,i)*this.xMultiplier,t.y=this.y.evaluate(e,i)*this.yMultiplier,t.z=this.z.evaluate(e,i)*this.zMultiplier;else{const s=this.size.evaluate(e,i)*this.sizeMultiplier;t.x=s}return t}}se([x(ct)],Xu.prototype,"size",void 0);se([x(ct)],Xu.prototype,"x",void 0);se([x(ct)],Xu.prototype,"y",void 0);se([x(ct)],Xu.prototype,"z",void 0);const hf=class{constructor(){h(this,"shapeType",ro.Box);h(this,"enabled",!0);h(this,"alignToDirection",!1);h(this,"angle",0);h(this,"arc",360);h(this,"arcSpread");h(this,"arcSpeedMultiplier");h(this,"arcMode");h(this,"boxThickness");h(this,"position");h(this,"rotation");h(this,"_rotation",new pn);h(this,"scale");h(this,"radius");h(this,"radiusThickness");h(this,"sphericalDirectionAmount");h(this,"randomDirectionAmount");h(this,"randomPositionAmount");h(this,"system");h(this,"_space");h(this,"_worldSpaceMatrix",new Ie);h(this,"_worldSpaceMatrixInverse",new Ie);h(this,"_vector",new w(0,0,0));h(this,"_temp",new w(0,0,0));h(this,"_dir",new w);h(this,"_loopTime",0);h(this,"_loopDirection",1);ry&&console.log(this)}get type(){return ro[this.shapeType]}initialize(e){this.getPosition(),e.position.copy(this._vector)}toJSON(){return this}clone(){return new hf}update(e,t,i,s){this.system=e,this._space=i,i===Xo.World&&(this._worldSpaceMatrix.copy(s.matrixWorld),this._worldSpaceMatrix.elements[0]=1,this._worldSpaceMatrix.elements[5]=1,this._worldSpaceMatrix.elements[10]=1,this._worldSpaceMatrixInverse.copy(this._worldSpaceMatrix).invert())}applyRotation(e){const t=this.rotation.x!==0||this.rotation.y!==0||this.rotation.z!==0;return t&&(this._rotation.x=tt.toRadians(this.rotation.x),this._rotation.y=tt.toRadians(this.rotation.y),this._rotation.z=tt.toRadians(this.rotation.z),this._rotation.order="ZYX",e.applyEuler(this._rotation)),t}get vector(){return this._vector}getPosition(){this._vector.set(0,0,0);const e=this._temp.copy(this.position),t=this._space===Xo.World;t&&e.applyQuaternion(this.system.worldQuaternion);let i=this.radius;if(t&&(i*=this.system.worldScale.x),this.enabled){switch(this.shapeType){case ro.Box:ry&&lu.DrawBox(this.position,this.scale,14540253,1),this._vector.x=Math.random()*this.scale.x-this.scale.x/2,this._vector.y=Math.random()*this.scale.y-this.scale.y/2,this._vector.z=Math.random()*this.scale.z-this.scale.z/2,this._vector.add(e);break;case ro.Cone:this.randomConePoint(this.position,this.angle,i,this.radiusThickness,this.arc,this.arcMode,this._vector);break;case ro.Sphere:this.randomSpherePoint(this.position,i,this.radiusThickness,this.arc,this._vector);break;case ro.Circle:this.randomCirclePoint(this.position,i,this.radiusThickness,this.arc,this._vector);break;default:this._vector.set(0,0,0);break}this.randomizePosition(this._vector,this.randomPositionAmount)}this.applyRotation(this._vector),t&&(this._vector.applyQuaternion(this.system.worldQuaternion),this._vector.add(this.system.worldPos)),ry&&lu.DrawSphere(this._vector,.03,16711680,.5,!0)}getDirection(e){var t;if(!this.enabled)return this._dir.set(0,0,1),this._dir;switch(this.shapeType){case ro.Box:this._dir.set(0,0,1);break;case ro.Cone:this._dir.set(0,0,1);break;case ro.Circle:case ro.Sphere:const i=e.x,s=e.y,r=e.z;this._dir.set(i,s,r),(t=this.system)!=null&&t.worldspace?this._dir.sub(this.system.worldPos):this._dir.sub(this.position);break;default:this._dir.set(0,0,1);break}return this._space===Xo.World&&this._dir.applyQuaternion(this.system.worldQuaternion),this.applyRotation(this._dir),this._dir.normalize(),this.spherizeDirection(this._dir,this.sphericalDirectionAmount),this.randomizeDirection(this._dir,this.randomDirectionAmount),ry&&(lu.DrawSphere(e,.01,8925952,.5,!0),lu.DrawDirection(e,this._dir,8925952,.5,!0)),this._dir}randomizePosition(e,t){if(t<=0)return;const i=hf._tempVec;i.set(Math.random()*2-1,Math.random()*2-1,Math.random()*2-1),i.x*=t*this.scale.x,i.y*=t*this.scale.y,i.z*=t*this.scale.z,e.add(i)}randomizeDirection(e,t){if(t===0)return;const i=hf._randomQuat,s=hf._tempVec;s.set(Math.random()-.5,Math.random()-.5,Math.random()-.5).normalize(),i.setFromAxisAngle(s,t*Math.random()*Math.PI),e.applyQuaternion(i)}spherizeDirection(e,t){if(t===0)return;const i=Math.random()*Math.PI*2,s=Math.acos(1-Math.random()*2),r=Math.sin(s)*Math.cos(i),o=Math.sin(s)*Math.sin(i),a=Math.cos(s),l=new w(r,o,a);e.lerp(l,t)}randomSpherePoint(e,t,i,s,r){const o=Math.random(),a=Math.random(),l=2*Math.PI*o*(s/360),c=Math.acos(2*a-1),u=tt.lerp(1,1-Math.pow(1-Math.random(),Math.PI),i)*t,d=e.x+this.scale.x*(-u*Math.sin(c)*Math.cos(l)),f=e.y+this.scale.y*(u*Math.sin(c)*Math.sin(l)),p=e.z+this.scale.z*(u*Math.cos(c));r.x=d,r.y=f,r.z=p}randomCirclePoint(e,t,i,s,r){const o=Math.random(),a=2*Math.PI*o*(s/360),l=tt.lerp(1,1-Math.pow(1-Math.random(),Math.PI),i)*t,c=e.x+this.scale.x*l*Math.cos(a),u=e.y+this.scale.y*l*Math.sin(a),d=e.z;r.x=c,r.y=u,r.z=d}randomConePoint(e,t,i,s,r,o,a){let l=0,c=0;switch(o){case Xh.Random:l=Math.random(),c=Math.random();break;case Xh.PingPong:this._loopTime>1&&(this._loopDirection=-1),this._loopTime<0&&(this._loopDirection=1);case Xh.Loop:l=.5,c=Math.random(),this._loopTime+=this.system.deltaTime*this._loopDirection;break}let u=2*Math.PI*l*(r/360);switch(o){case Xh.PingPong:case Xh.Loop:u+=Math.PI+.5,u+=this._loopTime*Math.PI*2,u%=tt.toRadians(r);break}const d=Math.acos(2*c-1),f=tt.lerp(1,1-Math.pow(1-Math.random(),Math.PI),s)*i,p=e.x+-f*Math.sin(d)*Math.cos(u),g=e.y+f*Math.sin(d)*Math.sin(u),A=e.z;a.x=p*this.scale.x,a.y=g*this.scale.y,a.z=A*this.scale.z}};let Gi=hf;h(Gi,"_randomQuat",new Se),h(Gi,"_tempVec",new w);se([x()],Gi.prototype,"shapeType",void 0);se([x()],Gi.prototype,"enabled",void 0);se([x()],Gi.prototype,"alignToDirection",void 0);se([x()],Gi.prototype,"angle",void 0);se([x()],Gi.prototype,"arc",void 0);se([x()],Gi.prototype,"arcSpread",void 0);se([x()],Gi.prototype,"arcSpeedMultiplier",void 0);se([x()],Gi.prototype,"arcMode",void 0);se([x(w)],Gi.prototype,"boxThickness",void 0);se([x(w)],Gi.prototype,"position",void 0);se([x(w)],Gi.prototype,"rotation",void 0);se([x(w)],Gi.prototype,"scale",void 0);se([x()],Gi.prototype,"radius",void 0);se([x()],Gi.prototype,"radiusThickness",void 0);se([x()],Gi.prototype,"sphericalDirectionAmount",void 0);se([x()],Gi.prototype,"randomDirectionAmount",void 0);se([x()],Gi.prototype,"randomPositionAmount",void 0);class Ai{constructor(){h(this,"damping");h(this,"enabled");h(this,"frequency");h(this,"octaveCount");h(this,"octaveMultiplier");h(this,"octaveScale");h(this,"positionAmount");h(this,"quality");h(this,"remap");h(this,"remapEnabled");h(this,"remapMultiplier");h(this,"remapX");h(this,"remapXMultiplier");h(this,"remapY");h(this,"remapYMultiplier");h(this,"remapZ");h(this,"remapZMultiplier");h(this,"scrollSpeedMultiplier");h(this,"separateAxes");h(this,"strengthMultiplier");h(this,"strengthX");h(this,"strengthXMultiplier");h(this,"strengthY");h(this,"strengthYMultiplier");h(this,"strengthZ");h(this,"strengthZMultiplier");h(this,"_noise");h(this,"_time",0);h(this,"_temp",new w)}update(e){this._time+=e.time.deltaTime*this.scrollSpeedMultiplier}apply(e,t,i,s,r,o){if(!this.enabled)return;this._noise||(this._noise=Z$(()=>0));const a=this._temp.set(t.x,t.y,t.z).multiplyScalar(this.frequency),l=this._noise(a.x,a.y,a.z,this._time),c=this._noise(a.x,a.y,a.z,this._time+1e3*this.frequency),u=this._noise(a.x,a.y,a.z,this._time+2e3*this.frequency);this._temp.set(l,c,u).normalize();const d=r/o;let f=this.positionAmount.evaluate(d);this.separateAxes?(this._temp.x*=f*this.strengthXMultiplier,this._temp.y*=f*this.strengthYMultiplier,this._temp.z*=f*this.strengthZMultiplier):(this.strengthX&&(f*=this.strengthX.evaluate(d)*1.5),this._temp.multiplyScalar(f)),i.x+=this._temp.x,i.y+=this._temp.y,i.z+=this._temp.z}}se([x()],Ai.prototype,"damping",void 0);se([x()],Ai.prototype,"enabled",void 0);se([x()],Ai.prototype,"frequency",void 0);se([x()],Ai.prototype,"octaveCount",void 0);se([x()],Ai.prototype,"octaveMultiplier",void 0);se([x()],Ai.prototype,"octaveScale",void 0);se([x(ct)],Ai.prototype,"positionAmount",void 0);se([x()],Ai.prototype,"quality",void 0);se([x(ct)],Ai.prototype,"remap",void 0);se([x()],Ai.prototype,"remapEnabled",void 0);se([x()],Ai.prototype,"remapMultiplier",void 0);se([x(ct)],Ai.prototype,"remapX",void 0);se([x()],Ai.prototype,"remapXMultiplier",void 0);se([x(ct)],Ai.prototype,"remapY",void 0);se([x()],Ai.prototype,"remapYMultiplier",void 0);se([x(ct)],Ai.prototype,"remapZ",void 0);se([x()],Ai.prototype,"remapZMultiplier",void 0);se([x()],Ai.prototype,"scrollSpeedMultiplier",void 0);se([x()],Ai.prototype,"separateAxes",void 0);se([x()],Ai.prototype,"strengthMultiplier",void 0);se([x(ct)],Ai.prototype,"strengthX",void 0);se([x()],Ai.prototype,"strengthXMultiplier",void 0);se([x(ct)],Ai.prototype,"strengthY",void 0);se([x()],Ai.prototype,"strengthYMultiplier",void 0);se([x(ct)],Ai.prototype,"strengthZ",void 0);se([x()],Ai.prototype,"strengthZMultiplier",void 0);var gE;(function(n){n[n.PerParticle=0]="PerParticle",n[n.Ribbon=1]="Ribbon"})(gE||(gE={}));var mE;(function(n){n[n.Stretch=0]="Stretch",n[n.Tile=1]="Tile",n[n.DistributePerSegment=2]="DistributePerSegment",n[n.RepeatPerSegment=3]="RepeatPerSegment"})(mE||(mE={}));class Yi{constructor(){h(this,"enabled");h(this,"attachRibbonToTransform",!1);h(this,"colorOverLifetime");h(this,"colorOverTrail");h(this,"dieWithParticles",!0);h(this,"inheritParticleColor",!0);h(this,"lifetime");h(this,"lifetimeMultiplier");h(this,"minVertexDistance",.2);h(this,"mode",gE.PerParticle);h(this,"ratio",1);h(this,"ribbonCount",1);h(this,"shadowBias",0);h(this,"sizeAffectsLifetime",!1);h(this,"sizeAffectsWidth",!1);h(this,"splitSubEmitterRibbons",!1);h(this,"textureMode",mE.Stretch);h(this,"widthOverTrail");h(this,"widthOverTrailMultiplier");h(this,"worldSpace",!1)}getWidth(e,t,i,s){const r=this.widthOverTrail.evaluate(i,s);return e*=r,e}getColor(e,t,i){const s=this.colorOverTrail.evaluate(i),r=this.colorOverLifetime.evaluate(t);e.x*=s.r*r.r,e.y*=s.g*r.g,e.z*=s.b*r.b,e.w*=s.alpha*r.alpha}}se([x()],Yi.prototype,"enabled",void 0);se([x()],Yi.prototype,"attachRibbonToTransform",void 0);se([x(ls)],Yi.prototype,"colorOverLifetime",void 0);se([x(ls)],Yi.prototype,"colorOverTrail",void 0);se([x()],Yi.prototype,"dieWithParticles",void 0);se([x()],Yi.prototype,"inheritParticleColor",void 0);se([x(ct)],Yi.prototype,"lifetime",void 0);se([x()],Yi.prototype,"lifetimeMultiplier",void 0);se([x()],Yi.prototype,"minVertexDistance",void 0);se([x()],Yi.prototype,"mode",void 0);se([x()],Yi.prototype,"ratio",void 0);se([x()],Yi.prototype,"ribbonCount",void 0);se([x()],Yi.prototype,"shadowBias",void 0);se([x()],Yi.prototype,"sizeAffectsLifetime",void 0);se([x()],Yi.prototype,"sizeAffectsWidth",void 0);se([x()],Yi.prototype,"splitSubEmitterRibbons",void 0);se([x()],Yi.prototype,"textureMode",void 0);se([x(ct)],Yi.prototype,"widthOverTrail",void 0);se([x()],Yi.prototype,"widthOverTrailMultiplier",void 0);se([x()],Yi.prototype,"worldSpace",void 0);class on{constructor(){h(this,"enabled");h(this,"space",Xo.Local);h(this,"orbitalX");h(this,"orbitalY");h(this,"orbitalZ");h(this,"orbitalXMultiplier");h(this,"orbitalYMultiplier");h(this,"orbitalZMultiplier");h(this,"orbitalOffsetX");h(this,"orbitalOffsetY");h(this,"orbitalOffsetZ");h(this,"speedModifier");h(this,"speedModifierMultiplier");h(this,"x");h(this,"xMultiplier");h(this,"y");h(this,"yMultiplier");h(this,"z");h(this,"zMultiplier");h(this,"_system");h(this,"_temp",new w);h(this,"_temp2",new w);h(this,"_temp3",new w);h(this,"_hasOrbital",!1);h(this,"_index",0);h(this,"_orbitalMatrix",new Ie)}update(e){this._system=e}init(e){this._index==0&&(e.debug=!0),this._index+=1,e.orbitx=this.orbitalX.evaluate(Math.random()),e.orbity=this.orbitalY.evaluate(Math.random()),e.orbitz=this.orbitalZ.evaluate(Math.random()),this._hasOrbital=e.orbitx!=0||e.orbity!=0||e.orbitz!=0}apply(e,t,i,s,r,o,a){var p;if(!this.enabled)return;const l=o/a,c=this.speedModifier.evaluate(l)*this.speedModifierMultiplier,u=this.x.evaluate(l),d=this.y.evaluate(l),f=this.z.evaluate(l);if(this._temp.set(-u,d,f),this._system&&this._system.main.simulationSpace===Xo.World&&this._temp.applyQuaternion(this._system.worldQuaternion),this._hasOrbital&&((p=this._system)==null?void 0:p.worldPos)){const A=this._temp2.set(i.x,i.y,i.z),v=this.orbitalXMultiplier,m=this.orbitalYMultiplier,b=this.orbitalZMultiplier,y=c*Math.PI*2*10,_=Math.cos(y*v),E=Math.sin(y*v),M=Math.cos(y*m),I=Math.sin(y*m),R=Math.cos(y*b),C=Math.sin(y*b),T=A.x*(M*R)+A.y*(M*C)+A.z*-I,O=A.x*(E*I*R-_*C)+A.y*(E*I*C+_*R)+A.z*(E*M),J=A.x*(_*I*R+E*C)+A.y*(_*I*C-E*R)+A.z*(_*M),V=this._temp3.set(A.x-T,A.y-O,A.z-J);V.normalize(),V.multiplyScalar(.2/r*Math.max(this.orbitalXMultiplier,this.orbitalYMultiplier,this.orbitalZMultiplier)),s.x+=V.x,s.y+=V.y,s.z+=V.z}s.x+=this._temp.x,s.y+=this._temp.y,s.z+=this._temp.z,s.x*=c,s.y*=c,s.z*=c}}se([x()],on.prototype,"enabled",void 0);se([x()],on.prototype,"space",void 0);se([x(ct)],on.prototype,"orbitalX",void 0);se([x(ct)],on.prototype,"orbitalY",void 0);se([x(ct)],on.prototype,"orbitalZ",void 0);se([x()],on.prototype,"orbitalXMultiplier",void 0);se([x()],on.prototype,"orbitalYMultiplier",void 0);se([x()],on.prototype,"orbitalZMultiplier",void 0);se([x()],on.prototype,"orbitalOffsetX",void 0);se([x()],on.prototype,"orbitalOffsetY",void 0);se([x()],on.prototype,"orbitalOffsetZ",void 0);se([x(ct)],on.prototype,"speedModifier",void 0);se([x()],on.prototype,"speedModifierMultiplier",void 0);se([x(ct)],on.prototype,"x",void 0);se([x()],on.prototype,"xMultiplier",void 0);se([x(ct)],on.prototype,"y",void 0);se([x()],on.prototype,"yMultiplier",void 0);se([x(ct)],on.prototype,"z",void 0);se([x()],on.prototype,"zMultiplier",void 0);var AE;(function(n){n[n.Lifetime=0]="Lifetime",n[n.Speed=1]="Speed",n[n.FPS=2]="FPS"})(AE||(AE={}));var vD;(function(n){n[n.Grid=0]="Grid",n[n.Sprites=1]="Sprites"})(vD||(vD={}));var yD;(function(n){n[n.Custom=0]="Custom",n[n.Random=1]="Random",n[n.MeshIndex=2]="MeshIndex"})(yD||(yD={}));var bD;(function(n){n[n.WholeSheet=0]="WholeSheet",n[n.SingleRow=1]="SingleRow"})(bD||(bD={}));class Os{constructor(){h(this,"animation");h(this,"enabled");h(this,"cycleCount");h(this,"frameOverTime");h(this,"frameOverTimeMultiplier");h(this,"numTilesX");h(this,"numTilesY");h(this,"startFrame");h(this,"startFrameMultiplier");h(this,"rowMode");h(this,"rowIndex");h(this,"spriteCount");h(this,"timeMode")}sampleOnceAtStart(){if(this.timeMode===AE.Lifetime)switch(this.frameOverTime.mode){case Hn.Constant:case Hn.TwoConstants:case Hn.TwoCurves:case Hn.Curve:return!0}return!1}getStartIndex(){return this.sampleOnceAtStart()?Math.random()*(this.numTilesX*this.numTilesY):0}evaluate(e){if(!this.sampleOnceAtStart())return this.getIndex(e)}getIndex(e){const t=this.numTilesX*this.numTilesY;e=e*this.cycleCount;let i=this.frameOverTime.evaluate(e%1);return i*=this.frameOverTimeMultiplier,i*=t,i=i%t,i=Math.floor(i),i}}se([x()],Os.prototype,"animation",void 0);se([x()],Os.prototype,"enabled",void 0);se([x()],Os.prototype,"cycleCount",void 0);se([x(ct)],Os.prototype,"frameOverTime",void 0);se([x()],Os.prototype,"frameOverTimeMultiplier",void 0);se([x()],Os.prototype,"numTilesX",void 0);se([x()],Os.prototype,"numTilesY",void 0);se([x(ct)],Os.prototype,"startFrame",void 0);se([x()],Os.prototype,"startFrameMultiplier",void 0);se([x()],Os.prototype,"rowMode",void 0);se([x()],Os.prototype,"rowIndex",void 0);se([x()],Os.prototype,"spriteCount",void 0);se([x()],Os.prototype,"timeMode",void 0);class na{constructor(){h(this,"enabled");h(this,"separateAxes");h(this,"x");h(this,"xMultiplier");h(this,"y");h(this,"yMultiplier");h(this,"z");h(this,"zMultiplier")}evaluate(e,t){return this.enabled?this.separateAxes?0:this.z.evaluate(e,t)*-1:0}}se([x()],na.prototype,"enabled",void 0);se([x()],na.prototype,"separateAxes",void 0);se([x(ct)],na.prototype,"x",void 0);se([x()],na.prototype,"xMultiplier",void 0);se([x(ct)],na.prototype,"y",void 0);se([x()],na.prototype,"yMultiplier",void 0);se([x(ct)],na.prototype,"z",void 0);se([x()],na.prototype,"zMultiplier",void 0);class Mo{constructor(){h(this,"enabled");h(this,"range");h(this,"separateAxes");h(this,"x");h(this,"xMultiplier");h(this,"y");h(this,"yMultiplier");h(this,"z");h(this,"zMultiplier")}evaluate(e,t){if(!this.enabled)return 0;if(!this.separateAxes){const i=tt.lerp(this.range.x,this.range.y,t);return this.z.evaluate(i)*-1}return 0}}se([x()],Mo.prototype,"enabled",void 0);se([x()],Mo.prototype,"range",void 0);se([x()],Mo.prototype,"separateAxes",void 0);se([x(ct)],Mo.prototype,"x",void 0);se([x()],Mo.prototype,"xMultiplier",void 0);se([x(ct)],Mo.prototype,"y",void 0);se([x()],Mo.prototype,"yMultiplier",void 0);se([x(ct)],Mo.prototype,"z",void 0);se([x()],Mo.prototype,"zMultiplier",void 0);class Un{constructor(){h(this,"enabled");h(this,"dampen");h(this,"drag");h(this,"dragMultiplier");h(this,"limit");h(this,"limitMultiplier");h(this,"separateAxes");h(this,"limitX");h(this,"limitXMultiplier");h(this,"limitY");h(this,"limitYMultiplier");h(this,"limitZ");h(this,"limitZMultiplier");h(this,"multiplyDragByParticleSize",!1);h(this,"multiplyDragByParticleVelocity",!1);h(this,"space");h(this,"_temp",new w);h(this,"_temp2",new w)}apply(e,t,i,s,r,o,a){if(this.enabled){const l=this.limit.evaluate(r)*this.limitMultiplier;if(t.length()>l){this._temp.copy(t).normalize().multiplyScalar(l);const u=this.dampen*.5;t.x=tt.lerp(t.x,this._temp.x,u),t.y=tt.lerp(t.y,this._temp.y,u),t.z=tt.lerp(t.z,this._temp.z,u),i.x=tt.lerp(i.x,this._temp.x,u),i.y=tt.lerp(i.y,this._temp.y,u),i.z=tt.lerp(i.z,this._temp.z,u)}}}}se([x()],Un.prototype,"enabled",void 0);se([x()],Un.prototype,"dampen",void 0);se([x(ct)],Un.prototype,"drag",void 0);se([x()],Un.prototype,"dragMultiplier",void 0);se([x(ct)],Un.prototype,"limit",void 0);se([x()],Un.prototype,"limitMultiplier",void 0);se([x()],Un.prototype,"separateAxes",void 0);se([x(ct)],Un.prototype,"limitX",void 0);se([x()],Un.prototype,"limitXMultiplier",void 0);se([x(ct)],Un.prototype,"limitY",void 0);se([x()],Un.prototype,"limitYMultiplier",void 0);se([x(ct)],Un.prototype,"limitZ",void 0);se([x()],Un.prototype,"limitZMultiplier",void 0);se([x()],Un.prototype,"multiplyDragByParticleSize",void 0);se([x()],Un.prototype,"multiplyDragByParticleVelocity",void 0);se([x()],Un.prototype,"space",void 0);var V0;(function(n){n[n.Initial=0]="Initial",n[n.Current=1]="Current"})(V0||(V0={}));class Yu{constructor(){h(this,"enabled");h(this,"curve");h(this,"curveMultiplier");h(this,"mode");h(this,"system");h(this,"_lastWorldPosition");h(this,"_velocity",new w);h(this,"_temp",new w)}update(e){this.enabled&&this.system.worldspace!==!1&&(this._lastWorldPosition?(this._velocity.copy(this.system.worldPos).sub(this._lastWorldPosition).multiplyScalar(1/this.system.deltaTime),this._lastWorldPosition.copy(this.system.worldPos)):(this._velocity.set(0,0,0),this._lastWorldPosition=this.system.worldPos.clone()))}applyInitial(e){if(this.enabled&&this.system.worldspace!==!1&&this.mode===V0.Initial){const t=this.curve.evaluate(Math.random(),Math.random());this._temp.copy(this._velocity).multiplyScalar(t),e.add(this._temp)}}applyCurrent(e,t,i){if(this.enabled&&this.system.worldspace!==!1&&this.mode===V0.Current){const s=this.curve.evaluate(t,i);this._temp.copy(this._velocity).multiplyScalar(s),e.add(this._temp)}}}se([x()],Yu.prototype,"enabled",void 0);se([x(ct)],Yu.prototype,"curve",void 0);se([x()],Yu.prototype,"curveMultiplier",void 0);se([x()],Yu.prototype,"mode",void 0);class vr{constructor(){h(this,"enabled");h(this,"range");h(this,"separateAxes");h(this,"size");h(this,"sizeMultiplier");h(this,"x");h(this,"xMultiplier");h(this,"y");h(this,"yMultiplier");h(this,"z");h(this,"zMultiplier")}evaluate(e,t,i,s){const r=e.length(),o=tt.remap(r,this.range.x,this.range.y,0,1),a=this.size.evaluate(o,i);return s*a}}se([x()],vr.prototype,"enabled",void 0);se([x(te)],vr.prototype,"range",void 0);se([x()],vr.prototype,"separateAxes",void 0);se([x(ct)],vr.prototype,"size",void 0);se([x()],vr.prototype,"sizeMultiplier",void 0);se([x(ct)],vr.prototype,"x",void 0);se([x()],vr.prototype,"xMultiplier",void 0);se([x(ct)],vr.prototype,"y",void 0);se([x()],vr.prototype,"yMultiplier",void 0);se([x(ct)],vr.prototype,"z",void 0);se([x()],vr.prototype,"zMultiplier",void 0);class fp{constructor(){h(this,"enabled");h(this,"range");h(this,"color")}evaluate(e,t,i){const s=e.length(),r=tt.remap(s,this.range.x,this.range.y,0,1),o=this.color.evaluate(r,t);i.x*=o.r,i.y*=o.g,i.z*=o.b,i.w*=o.alpha}}se([x()],fp.prototype,"enabled",void 0);se([x(te)],fp.prototype,"range",void 0);se([x(ls)],fp.prototype,"color",void 0);function _D(n){const e=n.domElement.shadowRoot.querySelector("link[rel='ar']");if(e)return e;const t=document.createElement("div");t.classList.add("menu"),t.classList.add("quicklook-menu"),t.style.display="none",t.style.visibility="hidden";const i=document.createElement("button");i.id="open-in-ar",i.innerText="Open in QuickLook",t.appendChild(i);const s=document.createElement("a");s.id="needle-usdz-link",s.style.display="none",s.rel="ar",s.href="",t.appendChild(s);const r=document.createElement("img");return r.id="button",s.appendChild(r),n.domElement.shadowRoot.appendChild(t),s}function eee(){var n=new Date;const e=n.getMonth()+1,t=n.getDate(),i=n.getHours(),s=n.getMinutes(),r=n.getSeconds(),o=(e<10?"0":"")+e,a=(t<10?"0":"")+t,l=(i<10?"0":"")+i,c=(s<10?"0":"")+s,u=(r<10?"0":"")+r;return n.getFullYear()+o+a+"-"+l+c+u}const oy=re("debugusdz");function tee(n,e){const t=[],i=ne.getComponentsInChildren(n,Xs),s=ne.getComponentsInChildren(n,xo);let r=!1;const o=new fr("rest",.01,[]),a=new Map,l=(c,u)=>{if(!r&&u.tracks.length>0&&(r=!0,c.push(o)),u.tracks.length>0)for(const d of u.tracks){const f=kt.parseTrackName(d.name),p=kt.findNode(n,f.nodeName);if(p){a.has(p)||a.set(p,[]);const g=a.get(p);switch(f.propertyName){case"position":{if(g.includes("position"))continue;const A=p.position,v=new dr(d.name,[0,.01],[A.x,A.y,A.z,A.x,A.y,A.z]);g.push("position"),o.tracks.push(v);break}case"quaternion":{if(g.includes("quaternion"))continue;const A=p.quaternion,v=new dr(d.name,[0,.01],[A.x,A.y,A.z,A.w,A.x,A.y,A.z,A.w]);g.push("quaternion"),o.tracks.push(v);break}case"scale":{if(g.includes("scale"))continue;const A=p.scale,v=new dr(d.name,[0,.01],[A.x,A.y,A.z,A.x,A.y,A.z]);g.push("scale"),o.tracks.push(v);break}}}}};for(const c of i){if(!c||!c.runtimeAnimatorController)continue;oy&&console.log(c);const u=[];for(const d of c.runtimeAnimatorController.enumerateActions()){oy&&console.log(d);const f=d.getClip();l(u,f),u.includes(f)||u.push(f)}t.push({root:c.gameObject,clips:u})}for(const c of s){oy&&console.log(c);const u=[];for(const d of c.animations)l(u,d),u.includes(d)||u.push(d);t.push({root:c.gameObject,clips:u})}oy&&(console.log("Rest Pose Clip",o),console.log("USDZ Animation Clips",t));for(const c of t)for(const u of c.clips)e.registerAnimation(c.root,u)}class iee{static createButton(e,t={},i){const s=document.createElement("button");let r=!1;function o(){if(t.optionalFeatures=t.optionalFeatures||[],t.domOverlay===void 0){var u=document.createElement("div");u.style.display="none",document.body.appendChild(u);var d=document.createElementNS("http://www.w3.org/2000/svg","svg");d.setAttribute("width",38),d.setAttribute("height",38),d.style.position="absolute",d.style.right="20px",d.style.top="20px",d.addEventListener("click",function(){p.end()}),u.appendChild(d);var f=document.createElementNS("http://www.w3.org/2000/svg","path");f.setAttribute("d","M 12,12 L 28,28 M 28,12 12,28"),f.setAttribute("stroke","#fff"),f.setAttribute("stroke-width",2),d.appendChild(f),t.optionalFeatures.push("dom-overlay"),t.domOverlay={root:u},r=!0}let p=null,g=null;async function A(m){var _;const b=/WebXRViewer\//i.test(navigator.userAgent),y=t.domOverlay.root;b&&((_=t.domOverlay)!=null&&_.root?(g=y.parentNode,g&&(console.log("Reparent DOM Overlay to body",y,y.style.display),y.style.display="",y.style.visibility="",document.body.appendChild(y))):console.warn("WebXRViewer: No DOM Overlay found")),m.addEventListener("end",v),await e.xr.setSession(m),s.textContent="STOP AR",r&&(t.domOverlay.root.style.display=""),p=m}function v(){p.removeEventListener("end",v),s.textContent="START AR";const m=t.domOverlay.root;g&&g.appendChild(m),r&&(m.style.display="none"),p=null}s.style.display="",s.style.cursor="pointer",s.style.left="calc(50% - 50px)",s.style.width="100px",s.textContent="START AR",s.onmouseenter=function(){s.style.opacity="1.0"},s.onmouseleave=function(){s.style.opacity="0.5"},s.onclick=function(){p===null?(i==null||i.call(this,t),navigator.xr.requestSession("immersive-ar",t).then(A)):p.end()}}function a(){s.disabled=!0,s.style.display="",s.style.cursor="auto",s.style.left="calc(50% - 75px)",s.style.width="150px",s.onmouseenter=null,s.onmouseleave=null,s.onclick=null}function l(){a(),s.textContent="AR NOT SUPPORTED"}function c(u){u.style.position="absolute",u.style.bottom="20px",u.style.padding="12px 6px",u.style.border="1px solid #fff",u.style.borderRadius="4px",u.style.background="rgba(0,0,0,0.1)",u.style.color="#fff",u.style.font="normal 13px sans-serif",u.style.textAlign="center",u.style.opacity="0.5",u.style.outline="none",u.style.zIndex="999"}if("xr"in navigator)return s.id="ARButton",s.style.display="none",c(s),navigator.xr.isSessionSupported("immersive-ar").then(function(u){u?o():l()}).catch(l),s;{const u=document.createElement("a");return window.isSecureContext===!1?(u.href=document.location.href.replace(/^http:/,"https:"),u.innerHTML="WEBXR NEEDS HTTPS"):(u.href="https://immersiveweb.dev/",u.innerHTML="WEBXR NOT AVAILABLE"),u.style.left="calc(50% - 90px)",u.style.width="180px",u.style.textDecoration="none",c(u),u}}}const cb=class{static createButton(e,t){const i=document.createElement("button");function s(){let l=null;async function c(d){d.addEventListener("end",u),await e.xr.setSession(d),i.textContent="EXIT VR",l=d}function u(){l.removeEventListener("end",u),i.textContent="ENTER VR",l=null}i.style.display="",i.style.cursor="pointer",i.style.left="calc(50% - 50px)",i.style.width="100px",i.textContent="ENTER VR",i.onmouseenter=function(){i.style.opacity="1.0"},i.onmouseleave=function(){i.style.opacity="0.5"},i.onclick=function(){if(l===null){const d={optionalFeatures:t.optionalFeatures};navigator.xr.requestSession("immersive-vr",d).then(c)}else l.end()}}function r(){i.disabled=!0,i.style.display="",i.style.cursor="auto",i.style.left="calc(50% - 75px)",i.style.width="150px",i.onmouseenter=null,i.onmouseleave=null,i.onclick=null}function o(){r(),i.textContent="VR NOT SUPPORTED"}function a(l){l.style.position="absolute",l.style.bottom="20px",l.style.padding="12px 6px",l.style.border="1px solid #fff",l.style.borderRadius="4px",l.style.background="rgba(0,0,0,0.1)",l.style.color="#fff",l.style.font="normal 13px sans-serif",l.style.textAlign="center",l.style.opacity="0.5",l.style.outline="none",l.style.zIndex="999"}if("xr"in navigator)return i.id="VRButton",i.style.display="none",a(i),navigator.xr.isSessionSupported("immersive-vr").then(function(l){l?s():o(),cb.xrSessionIsGranted&&(console.log("XR session is granted - will enter immersive web now"),i.click())}),i;{const l=document.createElement("a");return window.isSecureContext===!1?(l.href=document.location.href.replace(/^http:/,"https:"),l.innerHTML="WEBXR NEEDS HTTPS"):(l.href="https://immersiveweb.dev/",l.innerHTML="WEBXR NOT AVAILABLE"),l.style.left="calc(50% - 90px)",l.style.width="180px",l.style.textDecoration="none",a(l),l}}static registerSessionGrantedListener(){if("xr"in navigator){if(/WebXRViewer\//i.test(navigator.userAgent))return;navigator.xr.addEventListener("sessiongranted",()=>{cb.xrSessionIsGranted=!0})}}};let Qg=cb;h(Qg,"xrSessionIsGranted",!1);Qg.registerSessionGrantedListener();var f1=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const nee=new Ie;class Ha extends Te{constructor(){super(...arguments);h(this,"webAR",null);h(this,"invertForward",!1);h(this,"arTouchTransform",!1);h(this,"_initalMatrix",new Ie);h(this,"_selectStartFn",this.onSelectStart.bind(this));h(this,"_selectEndFn",this.onSelectEnd.bind(this));h(this,"userInput");h(this,"_arScale",1);h(this,"_rig",null);h(this,"_startPose",null);h(this,"_placementPose",null);h(this,"_isTouching",!1);h(this,"_rigStartPose",null);h(this,"_gotFirstHitTestResult",!1);h(this,"_anchor",null);h(this,"_anchorMatrix",new Ie);h(this,"_invertedSessionRootMatrix",new Ie);h(this,"_invertForwardMatrix",new Ie().makeRotationY(Math.PI))}get rig(){var t;return(t=this.webAR)==null?void 0:t.webxr.Rig}get arScale(){return this._arScale}set arScale(t){t!==this._arScale&&(this._arScale=t,this.setScale(t))}start(){const t=ne.findObjectOfType(vt);t&&(t.Rig.updateMatrix(),this._initalMatrix.copy(t.Rig.matrix))}onBegin(t){var i;this._placementPose=null,this.gameObject.visible=!1,this.gameObject.matrixAutoUpdate=!1,this._startPose=this.gameObject.matrix.clone(),this._rigStartPose=(i=this.rig)==null?void 0:i.matrix.clone(),this._gotFirstHitTestResult=!1,this._anchor=null,t.addEventListener("selectstart",this._selectStartFn),t.addEventListener("selectend",this._selectEndFn),this.gameObject.visible=!1,this.rig&&(this.rig.matrixAutoUpdate=!0,this._initalMatrix.decompose(this.rig.position,this.rig.quaternion,this.rig.scale)),this.dispatchEvent(new CustomEvent("onBeginSession"))}onUpdate(t,i,s,r){if(r&&!this._placementPose&&(this._gotFirstHitTestResult||(this._gotFirstHitTestResult=!0,this.dispatchEvent(new CustomEvent("canPlaceSession",{detail:{pose:r}}))),this._isTouching)){const o=new Ie().fromArray(r.transform.matrix).invert();return this.dispatchEvent(new CustomEvent("placedSession",{detail:{pose:r,poseMatrix:o}})),this.webAR&&this.webAR.setReticleActive(!1),this.placeAt(t,o),s&&r&&this.onCreatePlacementAnchor(s,r),!0}return!1}onCreatePlacementAnchor(t,i){var s,r;this._anchor=null,(r=(s=t==null?void 0:t.createAnchor)==null?void 0:s.call(t,i.transform))==null||r.then(o=>{this.context.isInAR&&(this._anchor=o)})}onBeforeRender(t){if(t&&this._rig)if(this._anchor){const i=this.context.renderer.xr.getReferenceSpace();if(i){const s=t.getPose(this._anchor.anchorSpace,i);if(s){const r=this._anchorMatrix.fromArray(s.transform.matrix).invert();this.placeAt(this._rig,r);return}}}else this._placementPose&&this.placeAt(this._rig,this._placementPose)}placeAt(t,i){this._placementPose||(this._placementPose=new Ie),this._placementPose.copy(i);const s=this._invertedSessionRootMatrix.copy(this.gameObject.matrixWorld).invert();this._placementPose.premultiply(s),t?(this.invertForward&&this._placementPose.premultiply(this._invertForwardMatrix),this.userInput||(this.userInput=new Vd(this.context)),this.userInput.enable(),this._rig=t,this.setScale(this.arScale)):this._rig=null,this.gameObject.visible=!0}onEnd(t,i){var s,r;(s=this.userInput)==null||s.disable(),(r=this.userInput)==null||r.reset(),this._placementPose=null,this.gameObject.visible=!1,this.gameObject.matrixAutoUpdate=!1,this._anchor=null,this._startPose&&this.gameObject.matrix.copy(this._startPose),t&&(t.matrixAutoUpdate=!0,this._rigStartPose&&this._rigStartPose.decompose(t.position,t.quaternion,t.scale)),Fr.markDirty(this.gameObject,!0),setTimeout(()=>{this.gameObject&&(this.gameObject.matrixAutoUpdate=!0,this.gameObject.visible=!0)},100)}onSelectStart(){this._isTouching=!0}onSelectEnd(){this._isTouching=!1}setScale(t){const i=this._rig;!i||!this._placementPose||(this._rigStartPose||(this._rigStartPose=i.matrix.clone()),i.matrixAutoUpdate=!1,this.arTouchTransform&&this.userInput&&this.userInput.applyMatrixTo(this._placementPose),i.matrix.multiplyMatrices(nee.makeScale(t,t,t),this._placementPose),i.matrix.decompose(i.position,i.quaternion,i.scale),i.updateMatrixWorld())}}f1([x()],Ha.prototype,"invertForward",void 0);f1([x()],Ha.prototype,"arTouchTransform",void 0);f1([x()],Ha.prototype,"arScale",null);const hb=class{constructor(e){h(this,"oneFingerDrag",!0);h(this,"twoFingerRotate",!0);h(this,"twoFingerScale",!0);h(this,"context");h(this,"offset");h(this,"plane");h(this,"_scale",1);h(this,"_enabled",!1);h(this,"prev",new Map);h(this,"_didMultitouch",!1);h(this,"touchStart",e=>{for(let t=0;t<e.changedTouches.length;t++){const i=e.changedTouches[t];this.prev.has(i.identifier)||this.prev.set(i.identifier,{x:0,z:0,screenx:0,screeny:0});const s=this.prev.get(i.identifier);if(s){const r=this.getPositionOnPlane(i.clientX,i.clientY);s.x=r.x,s.z=r.z,s.screenx=i.clientX,s.screeny=i.clientY}}});h(this,"touchEnd",e=>{e.touches.length<=0&&(this._didMultitouch=!1)});h(this,"touchMove",e=>{if(!e.defaultPrevented){if(e.touches.length===1){if(this._didMultitouch)return;const t=e.touches[0],i=this.prev.get(t.identifier);if(!i)return;const s=this.getPositionOnPlane(t.clientX,t.clientY),r=s.x-i.x,o=s.z-i.z;if(r===0&&o===0)return;this.oneFingerDrag&&this.addMovement(r,o),i.x=s.x,i.z=s.z,i.screenx=t.clientX,i.screeny=t.clientY;return}else if(e.touches.length===2){this._didMultitouch=!0;const t=e.touches[0],i=e.touches[1],s=this.prev.get(t.identifier),r=this.prev.get(i.identifier);if(!s||!r)return;if(this.twoFingerRotate){const o=Math.atan2(t.clientY-i.clientY,t.clientX-i.clientX),a=Math.atan2(s.screeny-r.screeny,s.screenx-r.screenx),l=o-a;Math.abs(l)>.001&&this.addRotation(l)}if(this.twoFingerScale){const o=t.clientX-i.clientX,a=t.clientY-i.clientY,l=Math.sqrt(o*o+a*a),c=s.screenx-r.screenx,u=s.screeny-r.screeny,d=Math.sqrt(c*c+u*u),f=l-d;Math.abs(f)>2&&this.addScale(f)}s.screenx=t.clientX,s.screeny=t.clientY,r.screenx=i.clientX,r.screeny=i.clientY}}});h(this,"_raycaster",new Uu);h(this,"_intersection",new w);h(this,"_screenPos",new w);h(this,"_tempMatrix",new Ie);this.context=e,this.offset=new Ie,this.plane=new Ir,this.plane.setFromNormalAndCoplanarPoint(hb.up,hb.zero)}enable(){this._enabled||(this._enabled=!0,window.addEventListener("touchstart",this.touchStart,{passive:!1}),window.addEventListener("touchmove",this.touchMove,{passive:!1}),window.addEventListener("touchend",this.touchEnd,{passive:!1}))}disable(){this._enabled&&(this._enabled=!1,window.removeEventListener("touchstart",this.touchStart),window.removeEventListener("touchmove",this.touchMove),window.removeEventListener("touchend",this.touchEnd))}reset(){this._scale=1,this.offset.identity()}applyMatrixTo(e){e.premultiply(this.offset)}getPositionOnPlane(e,t){const i=this.context.mainCamera;return this._screenPos.x=e/window.innerWidth*2-1,this._screenPos.y=-(t/window.innerHeight)*2+1,this._screenPos.z=1,this._screenPos.unproject(i),this._raycaster.set(i.position,this._screenPos.sub(i.position)),this._raycaster.ray.intersectPlane(this.plane,this._intersection),this._intersection}addMovement(e,t){e*=.75,t*=.75,e/=this._scale,t/=this._scale,this.offset.elements[12]-=e,this.offset.elements[14]-=t}addScale(e){e/=window.innerWidth,this._scale*=1+e,this._tempMatrix.makeScale(1-e,1-e,1-e),this.offset.premultiply(this._tempMatrix)}addRotation(e){this._tempMatrix.makeRotationY(e),this.offset.premultiply(this._tempMatrix)}};let Vd=hb;h(Vd,"up",new w(0,1,0)),h(Vd,"zero",new w(0,0,0)),h(Vd,"one",new w(1,1,1));const see=re("debugrig");class H0 extends Te{awake(){if(see){const e=new Me;e.position.y+=.5,this.gameObject.add(e);const t=e.addNewComponent(hp);t&&(t.isGizmo=!1)}}}class yf{constructor(){h(this,"bb",null);h(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}x(){return this.bb.readFloat32(this.bb_pos)}y(){return this.bb.readFloat32(this.bb_pos+4)}z(){return this.bb.readFloat32(this.bb_pos+8)}w(){return this.bb.readFloat32(this.bb_pos+12)}static sizeOf(){return 16}static createVec4(e,t,i,s,r){return e.prep(4,16),e.writeFloat32(r),e.writeFloat32(s),e.writeFloat32(i),e.writeFloat32(t),e.offset()}}class bs{constructor(){h(this,"bb",null);h(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsVrUserStateBuffer(e,t){return(t||new bs).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsVrUserStateBuffer(e,t){return e.setPosition(e.position()+t_),(t||new bs).__init(e.readInt32(e.position())+e.position(),e)}guid(e){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}time(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readInt64(this.bb_pos+e):this.bb.createLong(0,0)}avatarId(e){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__string(this.bb_pos+t,e):null}position(e){const t=this.bb.__offset(this.bb_pos,10);return t?(e||new zr).__init(this.bb_pos+t,this.bb):null}rotation(e){const t=this.bb.__offset(this.bb_pos,12);return t?(e||new yf).__init(this.bb_pos+t,this.bb):null}scale(){const e=this.bb.__offset(this.bb_pos,14);return e?this.bb.readFloat32(this.bb_pos+e):0}posLeftHand(e){const t=this.bb.__offset(this.bb_pos,16);return t?(e||new zr).__init(this.bb_pos+t,this.bb):null}posRightHand(e){const t=this.bb.__offset(this.bb_pos,18);return t?(e||new zr).__init(this.bb_pos+t,this.bb):null}rotLeftHand(e){const t=this.bb.__offset(this.bb_pos,20);return t?(e||new yf).__init(this.bb_pos+t,this.bb):null}rotRightHand(e){const t=this.bb.__offset(this.bb_pos,22);return t?(e||new yf).__init(this.bb_pos+t,this.bb):null}static startVrUserStateBuffer(e){e.startObject(10)}static addGuid(e,t){e.addFieldOffset(0,t,0)}static addTime(e,t){e.addFieldInt64(1,t,e.createLong(0,0))}static addAvatarId(e,t){e.addFieldOffset(2,t,0)}static addPosition(e,t){e.addFieldStruct(3,t,0)}static addRotation(e,t){e.addFieldStruct(4,t,0)}static addScale(e,t){e.addFieldFloat32(5,t,0)}static addPosLeftHand(e,t){e.addFieldStruct(6,t,0)}static addPosRightHand(e,t){e.addFieldStruct(7,t,0)}static addRotLeftHand(e,t){e.addFieldStruct(8,t,0)}static addRotRightHand(e,t){e.addFieldStruct(9,t,0)}static endVrUserStateBuffer(e){return e.endObject()}static finishVrUserStateBufferBuffer(e,t){e.finish(t)}static finishSizePrefixedVrUserStateBufferBuffer(e,t){e.finish(t,void 0,!0)}}const xD=re("debugxr"),eg=re("debugavatar");var Yh;(function(n){n.WebXR_UserJoined="webxr-user-joined",n.WebXR_UserLeft="webxr-user-left",n.VRSessionStart="vr-session-started",n.VRSessionEnd="vr-session-ended",n.VRSessionUpdate="vr-session-update"})(Yh||(Yh={}));var Q0;(function(n){n.VR="vr",n.AR="ar"})(Q0||(Q0={}));const p1="VRUS";VM(p1,bs.getRootAsVrUserStateBuffer);function vE(){return new Date().getTime()}function ree(n){const e=n&4294967295,t=n/Math.pow(2,32)&1048575;return Fa.create(e,t)}const lm=class{constructor(e){h(this,"guid");h(this,"time");h(this,"avatarId");h(this,"position",new w);h(this,"rotation",new Ke);h(this,"scale",1);h(this,"posLeftHand",new w);h(this,"posRightHand",new w);h(this,"rotLeftHand",new Se);h(this,"rotRightHand",new Se);this.guid=e}update(e,t,i,s,r){var u,d,f,p,g,A;this.time=vE(),this.avatarId=r,this.position.set(t.x,t.y,t.z),e&&this.position.applyMatrix4(e.matrixWorld);let o=lm.quat0;const a=lm.quat1;o.set(i.x,i.y,i.z,i.w),o=o.multiplyQuaternions(o,lm.invertRotation),e&&(e.getWorldQuaternion(a),o.multiplyQuaternions(a,o)),this.rotation.set(o.x,o.y,o.z,o.w),this.scale=e.scale.x;const l=(u=s.LeftController)==null?void 0:u.controllerGrip;l&&(l.getWorldPosition(this.posLeftHand),l.getWorldQuaternion(this.rotLeftHand));const c=(d=s.RightController)==null?void 0:d.controllerGrip;if(c&&(c.getWorldPosition(this.posRightHand),c.getWorldQuaternion(this.rotRightHand)),(p=(f=s.LeftController)==null?void 0:f.hand)!=null&&p.visible){const v=s.LeftController.wrist;v&&(v.getWorldPosition(this.posLeftHand),v.getWorldQuaternion(this.rotLeftHand))}if((A=(g=s.RightController)==null?void 0:g.hand)!=null&&A.visible){const v=s.RightController.wrist;v&&(v.getWorldPosition(this.posRightHand),v.getWorldQuaternion(this.rotRightHand))}}sendAsBuffer(e,t){e.clear();const i=e.createString(this.guid),s=e.createString(this.avatarId);bs.startVrUserStateBuffer(e),bs.addGuid(e,i),bs.addTime(e,ree(this.time)),bs.addAvatarId(e,s),bs.addPosition(e,zr.createVec3(e,this.position.x,this.position.y,this.position.z)),bs.addRotation(e,yf.createVec4(e,this.rotation.x,this.rotation.y,this.rotation.z,this.rotation.w)),bs.addScale(e,this.scale),bs.addPosLeftHand(e,zr.createVec3(e,this.posLeftHand.x,this.posLeftHand.y,this.posLeftHand.z)),bs.addPosRightHand(e,zr.createVec3(e,this.posRightHand.x,this.posRightHand.y,this.posRightHand.z)),bs.addRotLeftHand(e,yf.createVec4(e,this.rotLeftHand.x,this.rotLeftHand.y,this.rotLeftHand.z,this.rotLeftHand.w)),bs.addRotRightHand(e,yf.createVec4(e,this.rotRightHand.x,this.rotRightHand.y,this.rotRightHand.z,this.rotRightHand.w));const r=bs.endVrUserStateBuffer(e);e.finish(r,p1);const o=e.asUint8Array();t.sendBinary(o)}setFromBuffer(e,t){if(!e)return;this.guid=e,this.time=t.time().toFloat64();const i=t.avatarId();i&&(this.avatarId=i);const s=t.position();s&&this.position.set(s.x(),s.y(),s.z());const r=t.rotation();r&&this.rotation.set(r.x(),r.y(),r.z(),r.w());const o=t.posLeftHand();o&&this.posLeftHand.set(o.x(),o.y(),o.z());const a=t.posRightHand();a&&this.posRightHand.set(a.x(),a.y(),a.z());const l=t.rotLeftHand();l&&this.rotLeftHand.set(l.x(),l.y(),l.z(),l.w());const c=t.rotRightHand();c&&this.rotRightHand.set(c.x(),c.y(),c.z(),c.w()),this.scale=t.scale()}};let Ta=lm;h(Ta,"invertRotation",new Se().setFromAxisAngle(new w(0,1,0),Math.PI)),h(Ta,"quat0",new Se),h(Ta,"quat1",new Se);class W0 extends Te{constructor(){super(...arguments);h(this,"webXR",null);h(this,"debugAvatarUser",null);h(this,"voip",null);h(this,"tempState",new Ta(""));h(this,"_removeAvatarsList",[]);h(this,"eventSub_ConnectionEvent",null);h(this,"eventSub_WebXRStartEvent",null);h(this,"eventSub_WebXREndEvent",null);h(this,"eventSub_WebXRUpdateEvent",null);h(this,"avatars",{});h(this,"localAvatar",null);h(this,"k_LocalAvatarNoNetworkingGuid","local");h(this,"ownership",null);h(this,"xrState",null);h(this,"builder",new $f(1024))}async awake(){if(this.webXR||(this.webXR=ne.getComponent(this.gameObject,vt)),this.webXR||(this.webXR=ne.findObjectOfType(vt,this.context)),!this.webXR&&(this.webXR=ne.findObjectOfType(vt,this.context),!this.webXR)){console.warn("WebXRSync: Could not find WebXR component, won't sync.");return}if(this.voip||(this.voip=ne.findObjectOfType(Hu,this.context)),eg){const t="debug-avatar-"+eg,i=new Il(this.context,t,this.webXR);if(this.debugAvatarUser=i,typeof eg=="string"&&eg.length>0)if(await i.setAvatarOverride(eg)){const s=new Ta(t);s.position.y+=1;const r=.5;s.posLeftHand.y+=r,s.posLeftHand.x+=r,s.posRightHand.y+=r,s.posRightHand.x-=r,i.tryUpdate(s,0)}else i.destroy()}}onEnable(){if(!this.webXR&&(this.webXR=ne.getComponent(this.gameObject,vt),!this.webXR)){console.warn("Missing webxr component on "+this.gameObject.name);return}this.eventSub_WebXRStartEvent=this.onXRSessionStart.bind(this),vt.addEventListener(ii.XRStarted,this.eventSub_WebXRStartEvent),this.eventSub_WebXRUpdateEvent=this.onXRSessionUpdate.bind(this),vt.addEventListener(ii.XRUpdate,this.eventSub_WebXRUpdateEvent),this.eventSub_WebXREndEvent=this.onXRSessionEnded.bind(this),vt.addEventListener(ii.XRStopped,this.eventSub_WebXREndEvent),this.eventSub_ConnectionEvent=this.onConnected.bind(this),this.context.connection.beginListen(pi.JoinedRoom,this.eventSub_ConnectionEvent),this.context.connection.beginListen(Yh.WebXR_UserJoined,t=>{console.log("webxr user joined evt")}),this.context.connection.beginListen(Yh.WebXR_UserLeft,t=>{const i=t.id!==null&&t.id!==void 0;if(i&&(console.log("webxr user left evt"),i)){const s=this.avatars[t.id];s==null||s.destroy(),this.avatars[t.id]=void 0}}),this.context.connection.beginListenBinary(p1,t=>{const i=t.guid();if(!i)return;const s=t.time().toFloat64(),r=this.tempState;r.setFromBuffer(i,t);const o=this.onTryGetAvatar(i,s);o==null||o.tryUpdate(r,s)}),this.context.connection.beginListen(Yh.VRSessionUpdate,t=>{const i=t.guid,s=t.time,r=this.onTryGetAvatar(i,s);r==null||r.tryUpdate(t,s)})}onTryGetAvatar(t,i){if(t===this.context.connection.connectionId)return null;const s=new Date().getTime()-i;if(s>5e3)return xD&&console.log("old data",s,t),null;if(!this.webXR)return null;let r=this.avatars[t];if(r===void 0)try{console.log("create new avatar");const o=new Il(this.context,t,this.webXR);r=o,this.avatars[t]=o}catch(o){this.avatars[t]=null,console.error(o)}return r}onDisable(){this.eventSub_ConnectionEvent&&this.context.connection.stopListen(pi.JoinedRoom,this.eventSub_ConnectionEvent),vt.removeEventListener(ii.XRStarted,this.eventSub_WebXRStartEvent),vt.removeEventListener(ii.XRUpdate,this.eventSub_WebXRUpdateEvent),vt.removeEventListener(ii.XRStopped,this.eventSub_WebXREndEvent)}update(){const t=vE();this.debugAvatarUser&&(this.debugAvatarUser.lastUpdate=t),this.detectPotentiallyDisconnectedAvatarsAndRemove();for(const i in this.avatars){const s=this.avatars[i];s&&s.update()}}detectPotentiallyDisconnectedAvatarsAndRemove(){const t=vE();for(const i in this.avatars){const s=this.avatars[i];if(!s){this._removeAvatarsList.push(i);continue}t-s.lastUpdate>1e4&&(console.log("avatar timed out (didnt receive any updates in  a while) - destroying it now"),s.destroy(),this.avatars[i]=void 0)}for(const i of this._removeAvatarsList)delete this.avatars[i];this._removeAvatarsList.length=0}buildLocalAvatar(){var i;if(this.localAvatar)return;const t=((i=this.context.connection)==null?void 0:i.connectionId)??this.k_LocalAvatarNoNetworkingGuid;this.localAvatar=new Il(this.context,t,this.webXR),this.localAvatar.isLocalAvatar=!0,this.localAvatar.setAvatarOverride(this.getAvatarId()),this.avatars[this.localAvatar.guid]=this.localAvatar}onConnected(){var t,i,s;xD&&console.log("Hey you are connected as "+this.context.connection.connectionId),((t=this.localAvatar)==null?void 0:t.guid)===this.k_LocalAvatarNoNetworkingGuid&&(this.localAvatar&&((i=this.localAvatar)==null||i.destroy(),this.avatars[this.localAvatar.guid]=void 0),this.localAvatar=null,this.xrState=null,(s=this.ownership)==null||s.freeOwnership(),this.ownership=null)}onXRSessionStart(t){var i,s,r;if(console.log("XR session started"),this.context.connection.send(Yh.WebXR_UserJoined,{id:this.context.connection.connectionId,mode:Q0.VR}),this.localAvatar&&((i=this.localAvatar)==null||i.destroy(),this.avatars[this.localAvatar.guid]=void 0,this.localAvatar=null),this.xrState=null,(s=this.ownership)==null||s.freeOwnership(),this.ownership=null,this.avatars)for(const o in this.avatars)(r=this.avatars[o])==null||r.updateFlags()}onXRSessionEnded(t){var i;console.log("XR session ended"),this.context.connection.send(Yh.WebXR_UserLeft,{id:this.context.connection.connectionId,mode:Q0.VR}),this.localAvatar&&((i=this.localAvatar)==null||i.destroy(),this.avatars[this.localAvatar.guid]=void 0,this.localAvatar=null)}onXRSessionUpdate(t){this.xrState??(this.xrState=new Ta(this.context.connection.connectionId??this.k_LocalAvatarNoNetworkingGuid)),this.ownership??(this.ownership=new qM(this.context.connection,this.context.connection.connectionId??this.k_LocalAvatarNoNetworkingGuid)),this.ownership.guid=this.context.connection.connectionId??this.k_LocalAvatarNoNetworkingGuid,this.buildLocalAvatar();const{frame:i,xr:s,rig:r}=t,o=i.getViewerPose(s.getReferenceSpace());if(!o)return;const a=o==null?void 0:o.transform,l=a.position,c=a.orientation;this.xrState.update(r,l,c,this.webXR,this.getAvatarId()),this.localAvatar&&(this.context.connection.connectionId&&(this.localAvatar.guid=this.context.connection.connectionId),this.localAvatar.tryUpdate(this.xrState,0)),!(this.ownership&&!this.ownership.hasOwnership&&this.context.connection.isConnected&&(this.context.time.frameCount%120===0&&this.ownership.requestOwnership(),!this.ownership.hasOwnership))&&(!this.context.connection.isConnected||!this.context.connection.connectionId||this.xrState.sendAsBuffer(this.builder,this.context.connection))}getAvatarId(){return re("avatar")??null}}var pp=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const nS=re("debugwebxr");async function oee(){return cC()?!0:"xr"in navigator?await navigator.xr.isSessionSupported("immersive-ar")===!0:!1}async function aee(){return"xr"in navigator?await navigator.xr.isSessionSupported("immersive-vr")===!0:!1}let gg=!1,mg=!1;oee().then(n=>gg=n);aee().then(n=>mg=n);var ii;(function(n){n.XRStarted="xrStarted",n.XRStopped="xrStopped",n.XRUpdate="xrUpdate",n.RequestVRSession="requestVRSession",n.ModifyAROptions="modify-ar-options"})(ii||(ii={}));const yn=class extends Te{constructor(){super(...arguments);h(this,"enableVR",!0);h(this,"enableAR",!0);h(this,"defaultAvatar");h(this,"handModelPath","");h(this,"createVRButton",!0);h(this,"createARButton",!0);h(this,"controllers",[]);h(this,"rig");h(this,"isInit",!1);h(this,"_requestedAR",!1);h(this,"_requestedVR",!1);h(this,"_isInAR",!1);h(this,"_isInVR",!1);h(this,"_arButton");h(this,"_vrButton");h(this,"webAR",null);h(this,"_transformOrientation",new Se);h(this,"_currentHeadPose",null);h(this,"_originalCameraParent",null);h(this,"_originalCameraPosition",new w);h(this,"_originalCameraRotation",new Se);h(this,"_originalXRRigParent",null);h(this,"_originalXRRigPosition",new w);h(this,"_originalXRRigRotation",new Se);h(this,"xrMirrorWindow",null)}static get IsInWebXR(){return this._isInXr}static get XRSupported(){return"xr"in navigator&&(gg||mg)}static get IsARSupported(){return gg}static get IsVRSupported(){return mg}static get OptionalFeatures_VR(){return this._optionalFeatures_VR}static get OptionalFeatures_AR(){return this._optionalFeatures_AR}static addEventListener(t,i){return this.events.addEventListener(t,i),i}static removeEventListener(t,i){return this.events.removeEventListener(t,i),i}static dispatchEvent(t,i){this.events.dispatchEvent({type:t,detail:i})}static createVRButton(t,i){yn.XRSupported?t.__internalAwake():console.warn("WebXR is not supported on this device");const s={optionalFeatures:yn.OptionalFeatures_VR},r=Qg.createButton(t.context.renderer,s);return r.classList.add("webxr-ar-button"),r.classList.add("webxr-button"),this.resetButtonStyles(r),((i==null?void 0:i.registerClick)??!0)&&r.addEventListener("click",t.onClickedVRButton.bind(t)),r}static createARButton(t,i){var a;t.__internalAwake();const s=(a=t.webAR)==null?void 0:a.getAROverlayContainer(),r={optionalFeatures:[...this.OptionalFeatures_AR]};s?(r.domOverlay={root:s},r.optionalFeatures.push("dom-overlay"),r.optionalFeatures.push("hit-test"),r.optionalFeatures.push("anchors")):console.warn("No dom overlay root found, HTML overlays on top of screen-based AR will not work.");const o=iee.createButton(t.context.renderer,r,this.onModifyAROptions.bind(this));return o.classList.add("webxr-ar-button"),o.classList.add("webxr-button"),yn.resetButtonStyles(o),((i==null?void 0:i.registerClick)??!0)&&o.addEventListener("click",t.onClickedARButton.bind(t)),o}static onModifyAROptions(t){yn.dispatchEvent(ii.ModifyAROptions,t)}static resetButtonStyles(t){t&&(t.style.position="",t.style.bottom="",t.style.left="")}endSession(){const t=this.context.renderer.xr.getSession();t&&t.end()}get Rig(){return this.ensureRig(),this.rig}get Controllers(){return this.controllers}get LeftController(){var t,i;return this.controllers.length>0&&((t=this.controllers[0].input)==null?void 0:t.handedness)==="left"?this.controllers[0]:this.controllers.length>1&&((i=this.controllers[1].input)==null?void 0:i.handedness)==="left"?this.controllers[1]:null}get RightController(){var t,i;return this.controllers.length>0&&((t=this.controllers[0].input)==null?void 0:t.handedness)==="right"?this.controllers[0]:this.controllers.length>1&&((i=this.controllers[1].input)==null?void 0:i.handedness)==="right"?this.controllers[1]:null}get ARButton(){return this._arButton}get VRButton(){return this._vrButton}get IsInVR(){return this._isInVR}get IsInAR(){return this._isInAR}awake(){if(this.defaultAvatar&&typeof this.defaultAvatar=="string"&&(this.defaultAvatar=wn.getOrCreate(this.sourceId??"/",this.defaultAvatar,this.context)),!ne.findObjectOfType(W0,this.context)){const t=ne.addNewComponent(this.gameObject,W0,!1);t.webXR=this}this.webAR=new bf(this),location.protocol=="http:"&&location.host.indexOf("localhost")<0&&(Rs("WebXR only works on https"),console.warn("WebXR only works on https. https://engine.needle.tools/docs/xr.html"))}onEnable(){if(this.isInit||!this.enableAR&&!this.enableVR)return;this.isInit=!0,this.context.renderer.xr.enabled=!0,yn.XRSupported;let t,i;const s=document.createElement("div");s.classList.add("webxr-buttons"),s.style.cssText=`
            position: absolute;
            bottom: 21px;
            left: 50%;
            transform: translate(-50%, 0%);
            z-index: 1000;
        
            display: flex;
            flex-direction: row;
            justify-content: center;
            align-items: flex-start;
            gap: 10px;
        `,this.context.appendHTMLElement(s);const r=nS;nS&&console.log("ARSupported?",gg,"VRSupported?",mg),(r||this.createARButton&&this.enableAR&&gg)&&(t=yn.createARButton(this),this._arButton=t,s.appendChild(t)),(r||this.createVRButton&&this.enableVR&&mg)&&(i=yn.createVRButton(this),this._vrButton=i,s.appendChild(i)),setTimeout(()=>{yn.resetButtonStyles(i),yn.resetButtonStyles(t)},1e3)}get TransformOrientation(){return this._transformOrientation}get HeadPose(){return this._currentHeadPose}onBeforeRender(t){var s;if(!t)return;const i=this.context.renderer.xr.getSession();if(i){const r=this.context.renderer.xr.getReferenceSpace();if(!r)return;const o=t.getViewerPose(r);if(!o)return;this._currentHeadPose=o;const a=o==null?void 0:o.transform;a&&this._transformOrientation.set(a.orientation.x,a.orientation.y,a.orientation.z,a.orientation.w),yn._isInXr===!1&&i?this.onEnterXR(i,t):this.IsInVR&&this.context.mainCamera&&this.ensureRig();for(const l of this.controllers)l.onUpdate(i);this._isInAR&&((s=this.webAR)==null||s.onUpdate(i,t))}yn.events.dispatchEvent({type:ii.XRUpdate,frame:t,xr:this.context.renderer.xr,rig:this.rig})}onClickedARButton(){this._isInAR||(this._requestedAR=!0,this._requestedVR=!1,this.captureStateBeforeXR())}onClickedVRButton(){if(!this._isInVR){if(this._requestedVR){this.onExitXR(null);return}this._requestedAR=!1,this._requestedVR=!0,this.captureStateBeforeXR(),this.ensureRig();for(let t=0;t<2;t++)un.Create(this,t,this.gameObject,Pn.PhysicalDevice);yn.events.dispatchEvent({type:ii.RequestVRSession})}}captureStateBeforeXR(){this.context.mainCamera&&(this._originalCameraPosition.copy(Mt(this.context.mainCamera)),this._originalCameraRotation.copy(Gr(this.context.mainCamera)),this._originalCameraParent=this.context.mainCamera.parent),this.Rig&&(this._originalXRRigParent=this.Rig.parent,this._originalXRRigPosition.copy(this.Rig.position),this._originalXRRigRotation.copy(this.Rig.quaternion))}ensureRig(){if(!this.rig||nT(this.rig)){const t=ne.findObjectOfType(H0,this.context);t?(this.rig=t.gameObject,this.rig.rotateY(Math.PI)):(this.rig=new ar,this.rig.rotateY(Math.PI),this.rig.name="XRRig",this.context.scene.add(this.rig))}if(this.context.isInXR&&this.context.mainCamera&&this.context.mainCamera.parent!==this.rig&&(this.rig.add(this.context.mainCamera),this.IsInVR)){const t=ne.findObjectOfType(H0);t&&(t==null?void 0:t.gameObject)!==this.rig&&(this.rig.position.copy(t.gameObject.position),this.rig.quaternion.copy(t.gameObject.quaternion),this.rig.rotateY(Math.PI),this.rig.scale.copy(t.gameObject.scale))}}onEnterXR(t,i){var a,l;console.log("[XR] session begin",t,i),yn._isInXr=!0,this.ensureRig();const s=this.context.renderer.xr.getReferenceSpace();if(s&&this.rig){const c=i.getViewerPose(s),u=c==null?void 0:c.transform.orientation;if(u){const d=new Se(u.x,u.y,u.z,u.w),f=new pn().setFromQuaternion(d);this.rig.rotateY(f.y)}}const r=this.context.renderer.xr;if(this.context.mainCamera){const c=r.getCamera();nS&&console.log("WebXRCamera",c);const u=(a=this.context.mainCameraComponent)==null?void 0:a.cullingMask;if(c&&u!==void 0){for(const d of c.cameras)d.layers.mask=u;c.layers.mask=u}else if(c){for(const d of c.cameras)d.layers.enableAll();c.layers.enableAll()}this._requestedAR&&this.context.scene.add(this.rig)}const o=this._requestedAR?Wi.AR:Wi.VR;switch(cr.Global.Set(o),o){case Wi.AR:this.context.xrSessionMode=Ru.ImmersiveAR,this._isInAR=!0,(l=this.webAR)==null||l.onBegin(t);break;case Wi.VR:this.context.xrSessionMode=Ru.ImmersiveVR,this._isInVR=!0,this.onEnterVR(t);break}t.addEventListener("end",()=>{console.log("[XR] session end"),yn._isInXr=!1,this.onExitXR(t)}),this.onEnterXR_HandleMirrorWindow(t),yn.events.dispatchEvent({type:ii.XRStarted,session:t})}onExitXR(t){var s,r,o,a;const i=this._isInAR;t&&(this._isInAR?(s=this.webAR)==null||s.onEnd(t):(r=this.context.mainCameraComponent)==null||r.applyClearFlagsIfIsActiveCamera()),this._isInAR=!1,this._isInVR=!1,this._requestedAR=!1,this._requestedVR=!1,this.context.xrSessionMode=void 0,this.xrMirrorWindow&&(this.xrMirrorWindow.close(),this.xrMirrorWindow=null),this.destroyControllers(),this.context.mainCamera&&((o=this._originalCameraParent)==null||o.add(this.context.mainCamera),On(this.context.mainCamera,this._originalCameraPosition),_o(this.context.mainCamera,this._originalCameraRotation),this.context.mainCamera.scale.set(1,1,1)),i&&((a=this._originalXRRigParent)==null||a.add(this.rig),this.rig.position.copy(this._originalXRRigPosition),this.rig.quaternion.copy(this._originalXRRigRotation)),cr.Global.Set(Wi.Browser|Wi.ThirdPerson),yn.events.dispatchEvent({type:ii.XRStopped,session:t})}onEnterVR(t){}destroyControllers(){var t;for(let i=this.controllers.length-1;i>=0;i-=1)(t=this.controllers[i])==null||t.destroy();this.controllers.length=0}onEnterXR_HandleMirrorWindow(t){re("mirror")&&setTimeout(()=>{if(!yn.IsInWebXR)return;const i=new URL(window.location.href);a0(i.searchParams,UN,1),a0(i.searchParams,"isMirror",1);const s=i.toString();this.xrMirrorWindow=window.open(s,"webxr sync","popup=yes"),this.xrMirrorWindow&&(this.xrMirrorWindow.onload=()=>{this.xrMirrorWindow&&(this.xrMirrorWindow.onbeforeunload=()=>{yn.IsInWebXR&&t.end()})})},1e3)}};let vt=yn;h(vt,"_isInXr",!1),h(vt,"events",new Fn),h(vt,"_optionalFeatures_VR",["local-floor","bounded-floor","hand-tracking","high-fixed-foveation-level","layers"]),h(vt,"_optionalFeatures_AR",["anchors","local-floor","hand-tracking","layers"]);pp([x()],vt.prototype,"enableVR",void 0);pp([x()],vt.prototype,"enableAR",void 0);pp([x(wn)],vt.prototype,"defaultAvatar",void 0);pp([x()],vt.prototype,"handModelPath",void 0);pp([x()],vt.prototype,"createVRButton",void 0);pp([x()],vt.prototype,"createARButton",void 0);const uf=class{constructor(e){h(this,"_webxr");h(this,"reticle",null);h(this,"reticleParent",null);h(this,"hitTestSource",null);h(this,"reticleActive",!0);h(this,"previousBackground",null);h(this,"previousEnvironment",null);h(this,"sessionRoot",null);h(this,"_previousParent",null);h(this,"arDomOverlay",null);h(this,"arOverlayElement",null);h(this,"noHitTestAvailable",!1);h(this,"didPlaceARSessionRoot",!1);this._webxr=e}get webxr(){return this._webxr}get context(){return this.webxr.context}getAROverlayContainer(){this.arDomOverlay=this.webxr.context.domElement;const e=this.arDomOverlay;return e.getAROverlayContainer?this.arOverlayElement=e.getAROverlayContainer():this.arOverlayElement=this.arDomOverlay,this.arOverlayElement}setReticleActive(e){this.reticleActive=e}async onBegin(e){var o,a,l;const t=this.webxr.context;this.reticleActive=!0,this.didPlaceARSessionRoot=!1,this.getAROverlayContainer();const i=o8()?Pn.PhysicalDevice:Pn.Touch,s=i===Pn.Touch?4:2;for(let c=0;c<s;c++)un.Create(this.webxr,c,this.webxr.gameObject,i);if((!this.sessionRoot||this.sessionRoot.destroyed||!this.sessionRoot.activeAndEnabled)&&(this.sessionRoot=ne.findObjectOfType(Ha,t)),!this.sessionRoot){const c=this.webxr.gameObject;this.sessionRoot=ne.addNewComponent(c,Ha),console.warn("WebAR: No ARSessionRoot found, creating one automatically on the WebXR object")}this.previousBackground=t.scene.background,this.previousEnvironment=t.scene.environment,t.scene.background=null,e.requestReferenceSpace("viewer").then(c=>{var u,d;(d=(u=e.requestHitTestSource)==null?void 0:u.call(e,{space:c}))==null||d.then(f=>{this.hitTestSource=f}).catch(f=>{this.noHitTestAvailable=!0,console.warn("WebXR: Hit test not supported",f)})}),!this.reticle&&this.sessionRoot&&(this.reticle=new ye(new nA(.07,.09,32).rotateX(-Math.PI/2),new ai),this.reticle.name="AR Placement reticle",this.reticle.matrixAutoUpdate=!1,this.reticle.visible=!1,this.reticleParent=new Me,this.reticleParent.name="AR Reticle Parent",this.reticleParent.matrixAutoUpdate=!1,this.reticleParent.add(this.reticle),this.webxr.scene?(this.context.scene.add(this.reticleParent),this.context.scene.visible=!0):console.warn("Could not found WebXR Rig")),this._previousParent=this.webxr.gameObject,uf.tempWebXRObject||(uf.tempWebXRObject=new Me),this.context.scene.add(uf.tempWebXRObject),ne.addComponent(uf.tempWebXRObject,this.webxr),this.sessionRoot?(this.sessionRoot.webAR=this,(o=this.sessionRoot)==null||o.onBegin(e)):console.warn("No WebARSessionRoot found in scene");const r=this.context.domElement;(a=r==null?void 0:r.onEnterAR)==null||a.call(r,e,this.arOverlayElement),(l=this.context.mainCameraComponent)==null||l.applyClearFlagsIfIsActiveCamera()}onEnd(e){var s,r;this._previousParent&&(ne.addComponent(this._previousParent,this.webxr),this._previousParent=null),this.hitTestSource=null;const t=this.webxr.context;t.scene.background=this.previousBackground,t.scene.environment=this.previousEnvironment,this.sessionRoot&&this.sessionRoot.onEnd(this.webxr.Rig,e);const i=this.context.domElement;(s=i.onExitAR)==null||s.call(i,e),(r=this.context.mainCameraComponent)==null||r.applyClearFlagsIfIsActiveCamera()}onUpdate(e,t){var s,r;if(this.noHitTestAvailable===!0){if(this.reticle&&(this.reticle.visible=!1),!this.didPlaceARSessionRoot){this.didPlaceARSessionRoot=!0;const o=this.webxr.Rig,a=lee.clone();(s=this.sessionRoot)==null||s.placeAt(o,a)}return}if(!this.hitTestSource)return;const i=t.getHitTestResults(this.hitTestSource);if(i.length){const o=i[0],a=this.webxr.context.renderer.xr.getReferenceSpace();if(a){const l=o.getPose(a);if(this.sessionRoot){const c=this.sessionRoot.onUpdate(this.webxr.Rig,e,o,l);this.didPlaceARSessionRoot=c}if(this.reticle&&(this.reticle.visible=this.reticleActive,this.reticleActive&&l)){const c=l.transform.matrix;this.reticle.matrix.fromArray(c),this.webxr.Rig&&this.reticle.matrix.premultiply(this.webxr.Rig.matrix)}}}else(r=this.sessionRoot)==null||r.onUpdate(this.webxr.Rig,e,null,null),this.reticle&&(this.reticle.visible=!1)}};let bf=uf;h(bf,"tempWebXRObject");const lee=new Ie().identity().makeTranslation(0,0,0);var ec=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const Oh=re("debugtext");var zt;(function(n){n[n.UpperLeft=0]="UpperLeft",n[n.UpperCenter=1]="UpperCenter",n[n.UpperRight=2]="UpperRight",n[n.MiddleLeft=3]="MiddleLeft",n[n.MiddleCenter=4]="MiddleCenter",n[n.MiddleRight=5]="MiddleRight",n[n.LowerLeft=6]="LowerLeft",n[n.LowerCenter=7]="LowerCenter",n[n.LowerRight=8]="LowerRight"})(zt||(zt={}));var Wg;(function(n){n[n.Truncate=0]="Truncate",n[n.Overflow=1]="Overflow"})(Wg||(Wg={}));var jg;(function(n){n[n.Wrap=0]="Wrap",n[n.Overflow=1]="Overflow"})(jg||(jg={}));var sr;(function(n){n[n.Normal=0]="Normal",n[n.Bold=1]="Bold",n[n.Italic=2]="Italic",n[n.BoldAndItalic=3]="BoldAndItalic"})(sr||(sr={}));class $s extends Ul{constructor(){super(...arguments);h(this,"alignment",zt.UpperLeft);h(this,"verticalOverflow",Wg.Truncate);h(this,"horizontalOverflow",jg.Wrap);h(this,"lineSpacing",1);h(this,"supportRichText",!1);h(this,"font");h(this,"fontStyle",sr.Normal);h(this,"_text","");h(this,"_fontSize",12);h(this,"_textMeshUi",null);h(this,"_didHandleTextRenderOnTop",!1)}setAlphaFactor(t){var i;super.setAlphaFactor(t),(i=this.uiObject)==null||i.set({fontOpacity:this.color.alpha*this.alphaFactor}),this.markDirty()}get text(){return this._text}set text(t){t!==this._text&&(this._text=t,this.feedText(this.text,this.supportRichText),this.markDirty())}set_text(t){this.text=t}get fontSize(){return this._fontSize}set fontSize(t){var i;this._fontSize=t,(i=this.uiObject)==null||i.set({fontSize:t})}onColorChanged(){var t;(t=this.uiObject)==null||t.set({color:this.color,fontOpacity:this.color.alpha})}onParentRectTransformChanged(){super.onParentRectTransformChanged(),this.uiObject&&this.updateOverflow()}onBeforeCanvasRender(t){this.updateOverflow()}updateOverflow(){var i;const t=(i=this.uiObject)==null?void 0:i._overflow;t&&(t._needsUpdate=!0,this.markDirty())}onCreate(t){Oh&&console.log(this),this.horizontalOverflow==jg.Overflow&&(t.whiteSpace="pre"),this.verticalOverflow==Wg.Truncate&&(this.context.renderer.localClippingEnabled=!0,t.overflow="hidden"),this.horizontalOverflow==jg.Overflow&&this.verticalOverflow==Wg.Truncate,t.lineHeight=this.lineSpacing,delete t.backgroundOpacity,delete t.backgroundColor,Oh&&(t.backgroundColor=16750848,t.backgroundOpacity=.5);const i=this.rectTransform;t={...t,...this.getTextOpts()},this.getAlignment(t),Oh&&(t.backgroundColor=Math.random()*16777215,t.backgroundOpacity=.1),this.uiObject=i.createNewText(t),this.feedText(this.text,this.supportRichText)}onAfterAddedToScene(){super.onAfterAddedToScene(),this.handleTextRenderOnTop()}getTextOpts(){const t=this.fontSize,i={color:this.color,fontOpacity:this.color.alpha,fontSize:t,fontKerning:"normal"};return this.setFont(i,this.fontStyle),i}onEnable(){var t;super.onEnable(),this._didHandleTextRenderOnTop=!1,this.uiObject&&this.uiObject.addAfterUpdate(()=>{this.setShadowComponentOwner(this.uiObject),this.markDirty()}),setTimeout(()=>this.markDirty(),10),(t=this.canvas)==null||t.registerEventReceiver(this)}onDisable(){var t;super.onDisable(),(t=this.canvas)==null||t.unregisterEventReceiver(this)}getAlignment(t){switch(t.flexDirection="column",this.alignment){case zt.UpperLeft:case zt.MiddleLeft:case zt.LowerLeft:t.textAlign="left";break;case zt.UpperCenter:case zt.MiddleCenter:case zt.LowerCenter:t.textAlign="center";break;case zt.UpperRight:case zt.MiddleRight:case zt.LowerRight:t.textAlign="right";break}switch(this.alignment){default:case zt.UpperLeft:case zt.UpperCenter:case zt.UpperRight:t.alignItems="start";break;case zt.MiddleLeft:case zt.MiddleCenter:case zt.MiddleRight:t.alignItems="center";break;case zt.LowerLeft:case zt.LowerCenter:case zt.LowerRight:t.alignItems="end";break}return t}feedText(t,i){var s,r,o;if(Oh&&console.log("feedText",this.uiObject,t,i),!!this.uiObject)if(this._textMeshUi||(this._textMeshUi=[]),this.uiObject.children.length=0,!i||t.length===0)this.uiObject.textContent=t;else{let a=this.getNextTag(t);if(a){if(a.startIndex>0){for(let u=this.uiObject.children.length-1;u>=0;u--){const d=this.uiObject.children[u];d.isUI&&(this.uiObject.remove(d),d.clear())}const c=new Qy({textContent:t.substring(0,a.startIndex),color:"inherit"});this.uiObject.add(c)}}else{this.uiObject.textContent="",this.setOptions({textContent:t});return}const l=[];for(;a;){const c=this.getNextTag(t,a.endIndex),u={fontFamily:(s=this.uiObject)==null?void 0:s.get("fontFamily"),color:"inherit",textContent:""};if(c){u.textContent=this.getText(t,a,c),this.handleTag(a,u,l);const d=new Qy(u);(r=this.uiObject)==null||r.add(d)}else{u.textContent=t.substring(a.endIndex),this.handleTag(a,u,l);const d=new Qy(u);(o=this.uiObject)==null||o.add(d)}a=c}}}handleTextRenderOnTop(){this._didHandleTextRenderOnTop||(this._didHandleTextRenderOnTop=!0,this.startCoroutine(this.renderOnTopCoroutine()))}*renderOnTopCoroutine(){if(!this.canvas)return;const t=[],i=this.canvas,s={renderOnTop:i.renderOnTop,depthWrite:i.depthWrite,doubleSided:i.doubleSided};for(;;){let r=!1;if(this._textMeshUi)for(let o=0;o<this._textMeshUi.length;o++){if(t[o]===!0)continue;r=!0;const a=this._textMeshUi[o];a.textContent&&(U0(a,s),t[o]=!0)}if(!r)break;yield}}handleTag(t,i,s){if(!t.isEndTag){if(t.type.includes("color")){const r=new sS(t,{color:i.color});if(s.push(r),t.type.length>6){const o=parseInt("0x"+t.type.substring(7));i.color=o}else i.color=new _e(1,1,1)}else if(t.type=="b"){this.setFont(i,sr.Bold);const r=new sS(t,{fontWeight:700});s.push(r)}else if(t.type=="i"){this.setFont(i,sr.Italic);const r=new sS(t,{fontStyle:"italic"});s.push(r)}}}getText(t,i,s){return t.substring(i.endIndex,s.startIndex)}getNextTag(t,i=0){const s=t.indexOf("<",i),r=t.indexOf(">",s);if(s>=0&&r>=0){const o=t.substring(s+1,r);return{type:o,startIndex:s,endIndex:r+1,isEndTag:o.startsWith("/")}}return null}setFont(t,i){if(!this.font)return;const s=this.font,r=this.getFamilyNameWithCorrectSuffix(s,i);Oh&&console.log("Selected font family:"+r);let o=uE.getFontFamily(r);switch(o||(o=uE.addFontFamily(r)),t.fontFamily=o,i){default:case sr.Normal:t.fontWeight=400,t.fontStyle="normal";break;case sr.Bold:t.fontWeight=700,t.fontStyle="normal";break;case sr.Italic:t.fontWeight=400,t.fontStyle="italic";break;case sr.BoldAndItalic:t.fontStyle="italic",t.fontWeight=400}let a=o.getVariant(t.fontWeight,t.fontStyle);if(!a){let l=r;l!=null&&l.endsWith("-msdf.json")||(l+="-msdf.json");let c=r;c!=null&&c.endsWith(".png")||(c+=".png"),a=o.addVariant(t.fontWeight,t.fontStyle,l,c),a==null||a.addEventListener("ready",()=>{this.markDirty()})}}getFamilyNameWithCorrectSuffix(t,i){var u;const s=t.lastIndexOf("-");if(s<0)return t;const r=(u=t.substring(s+1))==null?void 0:u.toLowerCase();if(cee.includes(r))return Oh&&console.warn("Unsupported font style: "+r),t;const o=t.lastIndexOf("/");let a=t;o>=0&&(a=a.substring(o+1));const l=a[0]===a[0].toUpperCase(),c=t.substring(0,s);switch(Oh&&console.log("Select font: ",t,sr[i],a,l,c),i){case sr.Normal:return l?c+"-Regular":c+"-regular";case sr.Bold:return l?c+"-Bold":c+"-bold";case sr.Italic:return l?c+"-Italic":c+"-italic";case sr.BoldAndItalic:return l?c+"-BoldItalic":c+"-bolditalic";default:return t}}}ec([x()],$s.prototype,"alignment",void 0);ec([x()],$s.prototype,"verticalOverflow",void 0);ec([x()],$s.prototype,"horizontalOverflow",void 0);ec([x()],$s.prototype,"lineSpacing",void 0);ec([x()],$s.prototype,"supportRichText",void 0);ec([x(URL)],$s.prototype,"font",void 0);ec([x()],$s.prototype,"fontStyle",void 0);ec([x()],$s.prototype,"text",null);ec([x()],$s.prototype,"fontSize",null);class sS{constructor(e,t){h(this,"tag");h(this,"previousValues");this.tag=e,this.previousValues=t}}const cee=["medium","mediumitalic","black","blackitalic","thin","thinitalic","extrabold","light","lightitalic","semibold"];var qg;(function(n){n.singleLine="singleLine",n.hardBreaks="hardBreaks",n.flowing="flowing"})(qg||(qg={}));var ef;(function(n){n.left="left",n.center="center",n.right="right",n.justified="justified"})(ef||(ef={}));var tf;(function(n){n.top="top",n.middle="middle",n.lowerMiddle="lowerMiddle",n.baseline="baseline",n.bottom="bottom"})(tf||(tf={}));class du{constructor(e){h(this,"id");h(this,"content","");h(this,"font",[]);h(this,"pointSize",144);h(this,"width");h(this,"height");h(this,"depth");h(this,"wrapMode");h(this,"horizontalAlignment");h(this,"verticalAlignment");h(this,"material");this.id=e}static getId(){return this.global_id++}setDepth(e){return this.depth=e,this}setPointSize(e){return this.pointSize=e,this}setHorizontalAlignment(e){return this.horizontalAlignment=e,this}setVerticalAlignment(e){return this.verticalAlignment=e,this}writeTo(e,t){var s;t.beginBlock(`def Preliminary_Text "${this.id}"`),this.content&&t.appendLine(`string content = "${this.content}"`),(!this.font||this.font.length<=0)&&(this.font||(this.font=[]),(s=this.font)==null||s.push("sans-serif"));const i=this.font.map(r=>`"${r}"`).join(", ");t.appendLine(`string[] font = [ ${i} ]`),t.appendLine(`double pointSize = ${this.pointSize}`),typeof this.width=="number"&&t.appendLine(`double width = ${this.width}`),typeof this.height=="number"&&t.appendLine(`double height = ${this.height}`),typeof this.depth=="number"&&t.appendLine(`double depth = ${this.depth}`),this.wrapMode&&t.appendLine(`token wrapMode = "${this.wrapMode}"`),this.horizontalAlignment&&t.appendLine(`token horizontalAlignment = "${this.horizontalAlignment}"`),this.verticalAlignment&&t.appendLine(`token verticalAlignment = "${this.verticalAlignment}"`),this.material!==void 0&&t.appendLine(`rel material:binding = </Materials/Material_${this.material.id}>`),t.closeBlock()}}h(du,"global_id",0);class g1{static singleLine(e,t,i){const s=new du("text_"+du.getId());return s.content=e,t&&(s.pointSize=t),i&&(s.depth=i),s}static multiLine(e,t,i,s,r,o){const a=new du("text_"+du.getId());return a.content=e,a.width=t,a.height=i,a.horizontalAlignment=s,a.verticalAlignment=r,o!==void 0&&(a.wrapMode=o),a}}const hee=new Ie().makeRotationY(Math.PI),uee=new Ie().makeScale(-1,1,-1);class X_{get extensionName(){return"text"}onExportObject(e,t,i){}exportText(e,t,i){const s=ne.getComponent(e,$s);if(!s)return;const r=ne.getComponent(e,Ts);let o=100,a=100;r&&(o=r.width,a=r.height),t.matrix=hee.clone(),r&&t.matrix.premultiply(uee);const l=new _e().copySRGBToLinear(s.color);t.material=new Yo({color:l,emissive:l}),t.addEventListener("serialize",(c,u)=>{let d=s.text;d=d.replace(/\n/g,"\\n");const f=g1.multiLine(d,o,a,ef.center,tf.bottom,qg.flowing);this.setTextAlignment(f,s.alignment),this.setOverflow(f,s),t.material&&(f.material=t.material),f.pointSize=this.convertToTextSize(s.fontSize),f.depth=.001,f.writeTo(void 0,c)})}convertToTextSize(e){return 1/.0502*144*e}setOverflow(e,t){t.horizontalOverflow?e.wrapMode=qg.singleLine:e.wrapMode=qg.flowing}setTextAlignment(e,t){switch(t){case zt.LowerLeft:case zt.MiddleLeft:case zt.UpperLeft:e.horizontalAlignment=ef.left;break;case zt.LowerCenter:case zt.MiddleCenter:case zt.UpperCenter:e.horizontalAlignment=ef.center;break;case zt.LowerRight:case zt.MiddleRight:case zt.UpperRight:e.horizontalAlignment=ef.right;break}switch(t){case zt.LowerLeft:case zt.LowerCenter:case zt.LowerRight:e.verticalAlignment=tf.bottom;break;case zt.MiddleLeft:case zt.MiddleCenter:case zt.MiddleRight:e.verticalAlignment=tf.middle;break;case zt.UpperLeft:case zt.UpperCenter:case zt.UpperRight:e.verticalAlignment=tf.top;break}}}class m1{get extensionName(){return"tmui"}onExportObject(e,t,i){const s=ne.getComponent(e,Yn);if(s&&s.activeAndEnabled&&s.renderMode===ba.WorldSpace){const r=new X_,o=ne.getComponent(e,Ts),a=ne.getComponent(e,ku);if(o){o.width,o.height;const l=Or.createEmpty(),c=o.shadowComponent;if(t.add(l),c){const u=c.matrix;l.matrix.copy(u);const d=new Map,f=new Map;d.set(c,l),f.set(c,a?a.alpha:1),c.traverse(p=>{if(p===c)return;const g=Or.createEmpty();g.matrix.copy(p.matrix);const A=p.parent,v=A&&typeof A.textContent=="string"&&A.textContent.length;let m=f.get(A)||1;const b=ne.getComponent(p,ku);if(b&&(m*=b.alpha),p instanceof ye&&v){const _=p[Ma].gameObject;r.exportText(_,g,i)}if(p instanceof ye&&!v){const _=p.geometry.clone();_.scale(1,1,-1),this.flipWindingOrder(_),g.geometry=_;const E=new _e,M=p.material.opacity;E.copy(p.material.color),g.material=new ai({color:E,opacity:M*m,map:p.material.map,transparent:!0})}d.set(p,g),f.set(p,m);const y=d.get(A);if(!y){console.error("Error when exporting UI: shadow component parent not found!",p,p.parent);return}y.add(g)})}}}}flipWindingOrder(e){const t=e.index.array;for(let i=0,s=t.length/3;i<s;i++){const r=t[i*3];t[i*3]=t[i*3+2],t[i*3+2]=r}e.index.needsUpdate=!0}}var Wr=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const Mn=re("debugusdz");class Ju{constructor(){h(this,"callToAction");h(this,"checkoutTitle");h(this,"checkoutSubtitle");h(this,"callToActionURL")}}Wr([x()],Ju.prototype,"callToAction",void 0);Wr([x()],Ju.prototype,"checkoutTitle",void 0);Wr([x()],Ju.prototype,"checkoutSubtitle",void 0);Wr([x()],Ju.prototype,"callToActionURL",void 0);class To extends Te{constructor(){super(...arguments);h(this,"objectToExport");h(this,"autoExportAnimations",!1);h(this,"exportFileName");h(this,"customUsdzFile");h(this,"customBranding");h(this,"anchoringType","plane");h(this,"planeAnchoringAlignment","horizontal");h(this,"interactive",!0);h(this,"extensions",[]);h(this,"allowCreateQuicklookButton",!0);h(this,"link");h(this,"webxr");h(this,"onClickedOpenInARElement",t=>{t.preventDefault(),this.exportAsync()});h(this,"lastCallback");h(this,"_quicklookButton");h(this,"_quicklookButtonContainer",null)}start(){var t,i,s;Mn&&(console.log("USDZExporter",this),console.log("Debug USDZ Mode. Press 'T' to export"),window.addEventListener("keydown",r=>{switch(r.key){case"t":this.exportAsync();break}}),ch()&&setTimeout(()=>{this.exportAsync()},2e3)),this.objectToExport||(this.objectToExport=this.gameObject),!((i=(t=this.objectToExport)==null?void 0:t.children)!=null&&i.length)&&!((s=this.objectToExport)!=null&&s.isMesh)&&(this.objectToExport=this.context.scene),this.interactive&&(this.extensions.push(new a1),this.extensions.push(new s1),this.extensions.push(new X_),this.extensions.push(new m1))}onEnable(){var s;const t=hC(),i=Wh();(Mn||t&&i)&&((Mn||this.allowCreateQuicklookButton)&&this.addQuicklookButton(),this.lastCallback=this.quicklookCallback.bind(this),this.link=_D(this.context),this.link.addEventListener("message",this.lastCallback)),Mn&&bn("USDZ Exporter enabled: "+this.name),(s=document.getElementById("open-in-ar"))==null||s.addEventListener("click",this.onClickedOpenInARElement)}onDisable(){var s,r;(s=this.link)==null||s.removeEventListener("message",this.lastCallback);const t=hC(),i=Wh();(Mn||t&&i)&&this.removeQuicklookButton(),Mn&&bn("USDZ Exporter disabled: "+this.name),(r=document.getElementById("open-in-ar"))==null||r.removeEventListener("click",this.onClickedOpenInARElement)}async exportAsync(){var v;let t=this.exportFileName??((v=this.objectToExport)==null?void 0:v.name)??this.name;if(Fg()||(t!==""&&(t+="-"),t+="MadeWithNeedle"),t+="-"+eee(),this.link||(this.link=_D(this.context)),this.customUsdzFile){Mn&&console.log("Exporting custom usdz",this.customUsdzFile);const m=this.buildQuicklookOverlay();Mn&&console.log("QuickLook Overlay",m);const b=m.callToAction?encodeURIComponent(m.callToAction):"",y=m.checkoutTitle?encodeURIComponent(m.checkoutTitle):"",_=m.checkoutSubtitle?encodeURIComponent(m.checkoutSubtitle):"";this.link.href=this.customUsdzFile+`#callToAction=${b}&checkoutTitle=${y}&checkoutSubtitle=${_}&callToActionURL=${m.callToActionURL}`,Mn&&console.log(this.link.href),this.lastCallback||(this.lastCallback=this.quicklookCallback.bind(this),this.link.addEventListener("message",this.lastCallback)),this.link.download=t+".usdz",this.link.click();return}if(!this.objectToExport){console.warn("No object to export",this);return}const i=ne.getComponentsInChildren(this.objectToExport,Ci),s=new Array;for(const m of i)for(const b of m.sharedMaterials)if(b){const y=m.loadProgressiveTextures(b);y instanceof Promise&&s.push(y)}Mn&&bn("Load textures: "+s.length),await Promise.all(s),Mn&&bn("Load textures: done");const r=cr.Global.Mask;cr.Global.Set(Wi.AR),this.applyWebARSessionRoot();const o=new EY,a=[...this.extensions],l=new _T;a.push(l),this.autoExportAnimations&&tee(this.objectToExport,l);const c={self:this,exporter:o,extensions:a,object:this.objectToExport};this.dispatchEvent(new CustomEvent("before-export",{detail:c})),o.debug=Mn,this.anchoringType!=="plane"&&this.anchoringType!=="none"&&this.anchoringType!=="image"&&this.anchoringType!=="face"&&(this.anchoringType="plane"),this.planeAnchoringAlignment!=="horizontal"&&this.planeAnchoringAlignment!=="vertical"&&this.planeAnchoringAlignment!=="any"&&(this.planeAnchoringAlignment="horizontal");const u=await o.parse(this.objectToExport,{ar:{anchoring:{type:this.anchoringType},planeAnchoring:{alignment:this.planeAnchoringAlignment}},extensions:a,quickLookCompatible:!0}),d=new Blob([u],{type:"application/octet-stream"});this.dispatchEvent(new CustomEvent("after-export",{detail:c}));const f=this.buildQuicklookOverlay();Mn&&console.log("QuickLook Overlay",f);const p=f.callToAction?encodeURIComponent(f.callToAction):"",g=f.checkoutTitle?encodeURIComponent(f.checkoutTitle):"",A=f.checkoutSubtitle?encodeURIComponent(f.checkoutSubtitle):"";this.link.href=URL.createObjectURL(d)+`#callToAction=${p}&checkoutTitle=${g}&checkoutSubtitle=${A}&callToActionURL=${f.callToActionURL}`,this.lastCallback||(this.lastCallback=this.quicklookCallback.bind(this),this.link.addEventListener("message",this.lastCallback)),this.link.download=t+".usdz",this.link.click(),Mn&&console.log("USDZ generation done. Downloading as "+this.link.download),cr.Global.Set(r)}quicklookCallback(t){if((t==null?void 0:t.data)=="_apple_ar_quicklook_button_tapped"){Mn&&Rs("Quicklook closed via call to action button");var i=new CustomEvent("quicklook-button-tapped",{detail:this});if(this.dispatchEvent(i),!i.defaultPrevented){const s=new URLSearchParams(this.link.href);if(s){const r=s.get("callToActionURL");Mn&&bn("Quicklook url: "+r),r&&(Fg()?globalThis.open(r,"_blank"):console.warn("Quicklook closed: custom redirects require a Needle Engine Pro license: https://needle.tools/pricing",r))}}}}buildQuicklookOverlay(){var s,r,o,a,l,c;const t={};return this.customBranding&&Object.assign(t,this.customBranding),Fg()||(console.log("Custom Quicklook banner text requires pro license: https://needle.tools/pricing"),t.callToAction="Close",t.checkoutTitle=" Made with Needle",t.checkoutSubtitle="_"),(((s=t.callToAction)==null?void 0:s.length)||((r=t.checkoutTitle)==null?void 0:r.length)||((o=t.checkoutSubtitle)==null?void 0:o.length))&&((a=t.callToAction)!=null&&a.length||(t.callToAction="\0"),(l=t.checkoutTitle)!=null&&l.length||(t.checkoutTitle="\0"),(c=t.checkoutSubtitle)!=null&&c.length||(t.checkoutSubtitle="\0")),this.dispatchEvent(new CustomEvent("quicklook-overlay",{detail:t})),t}async createQuicklookButton(){var t,i;if(!this.webxr)if(await Tu(1),this.webxr=ne.findObjectOfType(vt)??void 0,this.webxr)if(this.webxr.VRButton&&((t=this.webxr.VRButton.parentElement)==null||t.removeChild(this.webxr.VRButton)),this.webxr.ARButton&&this._quicklookButton!==this.webxr.ARButton){this._quicklookButton=this.webxr.ARButton;const s=(i=this.webxr.ARButton.parentElement)==null?void 0:i.querySelector("a");s&&(s.href=""),this.webxr.ARButton.innerText="Open in Quicklook",this.webxr.ARButton.disabled=!1,this.webxr.ARButton.addEventListener("click",r=>{r.preventDefault(),this.exportAsync()}),this.webxr.ARButton.classList.add("quicklook-ar-button"),this._quicklookButtonContainer=this.webxr.ARButton.parentElement,this.dispatchEvent(new CustomEvent("created-button",{detail:this.webxr.ARButton}))}else{this.webxr.createARButton=!1,this.webxr.createVRButton=!1;let s=this.context.domElement.shadowRoot.querySelector(".webxr-buttons");s||(s=document.createElement("div"),s.classList.add("webxr-buttons"));const r=document.createElement("button");r.innerText="Open in Quicklook",r.addEventListener("click",()=>{this.exportAsync()}),r.classList.add("webxr-ar-button"),r.classList.add("webxr-button"),r.classList.add("quicklook-ar-button"),this._quicklookButton=r,s.appendChild(r),this._quicklookButtonContainer=s,this.dispatchEvent(new CustomEvent("created-button",{detail:r}))}else console.warn("Could not find WebXR component: will not create Quicklook button",Lt.Current)}async addQuicklookButton(){await this.createQuicklookButton(),this._quicklookButton&&this._quicklookButtonContainer&&this._quicklookButtonContainer.appendChild(this._quicklookButton)}removeQuicklookButton(){var t;(t=this._quicklookButton)==null||t.remove()}applyWebARSessionRoot(){if(!this.objectToExport)return;let t=ne.getComponentInParent(this.objectToExport,Ha);const i=t!=null;if(t||(t=ne.getComponentInChildren(this.objectToExport,Ha)),Mn&&console.log("applyWebARSessionRoot",t),!t){Mn&&console.warn("No WebARSessionRoot found in parent hierarchy",this.objectToExport);return}const s=i?this.objectToExport:t.gameObject,r=1/t.arScale;Mn&&console.log("AR Session Root scale",r,s),s.matrix.makeScale(r,r,r),t.invertForward&&s.matrix.multiply(new Ie().makeRotationY(Math.PI))}}Wr([x(Me)],To.prototype,"objectToExport",void 0);Wr([x()],To.prototype,"autoExportAnimations",void 0);Wr([x()],To.prototype,"exportFileName",void 0);Wr([x(URL)],To.prototype,"customUsdzFile",void 0);Wr([x(Ju)],To.prototype,"customBranding",void 0);Wr([x()],To.prototype,"anchoringType",void 0);Wr([x()],To.prototype,"planeAnchoringAlignment",void 0);Wr([x()],To.prototype,"interactive",void 0);Wr([x()],To.prototype,"allowCreateQuicklookButton",void 0);const wD=re("debugdeletable");class A1 extends zo{}class KN extends Te{constructor(){super(...arguments);h(this,"deleteBoxes",[])}awake(){this.deleteBoxes=ne.findObjectsOfType(A1,this.context)}update(){for(const t of this.deleteBoxes){const i=this.gameObject;if(t.isInBox(i)===!0){const r=ne.getComponentInParent(this.gameObject,fA);r?wD&&console.warn("Can not delete object with usage marker",this.guid,r):(wD&&console.log("DESTROY",this.gameObject),YM(this.gameObject,this.context.connection))}}}}var Ku=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r},yE;(function(n){n[n.Off=0]="Off",n[n.Gaussian=1]="Gaussian",n[n.Bokeh=2]="Bokeh"})(yE||(yE={}));class Xa extends Zs{constructor(){super(...arguments);h(this,"mode");h(this,"focusDistance");h(this,"focalLength");h(this,"aperture");h(this,"gaussianMaxRadius");h(this,"resolutionScale");h(this,"bokehScale")}get typeName(){return"DepthOfField"}init(){this.focalLength.valueProcessor=i=>{const s=i/300,r=2;return tt.lerp(r,.01,s)};const t=20;this.aperture.valueProcessor=i=>{const s=1-i/32;return tt.lerp(1,t,s)}}onCreateEffect(){if(this.mode===yE.Off)return;const t=1/window.devicePixelRatio;if(this.resolutionScale===void 0){let s=1;ch()&&(s=.6),this.resolutionScale=new Et(s*t)}const i=new oF(this.context.mainCamera,{worldFocusRange:.2,focalLength:1,bokehScale:20,resolutionScale:this.resolutionScale.value});return this.focusDistance.onValueChanged=s=>{i.circleOfConfusionMaterial.worldFocusDistance=s},this.focalLength.onValueChanged=s=>i.circleOfConfusionMaterial.worldFocusRange=s,this.aperture.onValueChanged=s=>i.bokehScale=s,this.resolutionScale&&(this.resolutionScale.onValueChanged=s=>i.resolution.scale=s),[i]}unapply(){}}Ku([x()],Xa.prototype,"mode",void 0);Ku([x(Et)],Xa.prototype,"focusDistance",void 0);Ku([x(Et)],Xa.prototype,"focalLength",void 0);Ku([x(Et)],Xa.prototype,"aperture",void 0);Ku([x(Et)],Xa.prototype,"gaussianMaxRadius",void 0);Ku([x(Et)],Xa.prototype,"resolutionScale",void 0);Ku([x(Et)],Xa.prototype,"bokehScale",void 0);ta("DepthOfField",Xa);var dee=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r},j0;(function(n){n[n.Never=0]="Never",n[n.Desktop=1]="Desktop",n[n.Mobile=2]="Mobile"})(j0||(j0={}));class v1 extends Te{constructor(){super(...arguments);h(this,"visibleOn")}onEnable(){this.apply()}apply(){this.test()||ne.setActive(this.gameObject,!1)}test(){return this.visibleOn<0?!0:ch()?(this.visibleOn&j0.Mobile)!==0:(this.visibleOn&j0.Desktop)!==0}}dee([x()],v1.prototype,"visibleOn",void 0);class ZN{get extensionName(){return"DocumentExtension"}onAfterBuildDocument(e){}}var $N=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r},Hm;(function(n){n.SelectStart="selectstart",n.SelectEnd="selectend"})(Hm||(Hm={}));const ml=class extends dA{constructor(){super();h(this,"showGizmo",!0);h(this,"useViewAngle",!0);h(this,"transformSelf",!0);h(this,"orbit",null);h(this,"selectStartEventListener",[]);h(this,"selectEndEventListener",[]);h(this,"_dragHelper",null);h(this,"_draggingRigidbodies",[]);h(this,"_waitingForDragStart",null);h(this,"_isDragging",!1);h(this,"_marker",null);h(this,"_dragDelta");h(this,"_didDrag",!1);h(this,"_activePointerId");this.selectStartEventListener=[],this.selectEndEventListener=[],this._dragDelta=new te}static get HasAnySelected(){return this._active>0}addDragEventListener(t,i){switch(t){case Hm.SelectStart:this.selectStartEventListener.push(i);break;case Hm.SelectEnd:this.selectEndEventListener.push(i);break}}start(){this.orbit=ne.findObjectOfType(rn,this.context),this.gameObject.getComponentInParent(th)||this.gameObject.addNewComponent(th)}allowEdit(t=null){return this.context.connection.allowEditing}onPointerEnter(t){if(!this.allowEdit(this.gameObject)||vt.IsInWebXR)return;const i=ne.getComponentInParent(t.object,ml);!i||i!==this||(ml.lastHovered=t.object,this.context.domElement.style.cursor="pointer")}onPointerExit(t){this.allowEdit(this.gameObject)&&(vt.IsInWebXR||ml.lastHovered===t.object&&(this.context.domElement.style.cursor="auto"))}onPointerDown(t){this.allowEdit(this.gameObject)&&(vt.IsInWebXR||(ml._active+=1,this._dragDelta.set(0,0),this._didDrag=!1,this._waitingForDragStart=t.clone(),t.stopPropagation(),this.orbit&&(this.orbit.enabled=!1)))}onPointerMove(t){(this._isDragging||this._waitingForDragStart!==null)&&t.use()}onPointerUp(t){this._waitingForDragStart=null,this.allowEdit(this.gameObject)&&(ml._active>0&&(ml._active-=1),!vt.IsInWebXR&&(this.onDragEnd(t),t.stopPropagation(),this.orbit&&(this.orbit.enabled=!0)))}update(){var t;if(!vt.IsInWebXR){if(this._waitingForDragStart){if(!this._didDrag){const s=this.context.input.getPointerPositionDelta(0);if(s&&this._dragDelta.add(s),this._dragDelta.length()>2)this._didDrag=!0;else return}const i=this._waitingForDragStart;this._waitingForDragStart=null,this.onDragStart(i)}this._dragHelper&&this._dragHelper.hasSelected&&this.onUpdateDrag(),(((t=this._dragHelper)==null?void 0:t.hasSelected)===!1||this._activePointerId!==void 0&&this.context.input.getPointerPressed(this._activePointerId)===!1)&&this.onDragEnd(null)}}onDragStart(t){if(!this._dragHelper)if(this.context.mainCamera)this._dragHelper=new jy(this.context.mainCamera);else return;if(!t||!t.object)return;const i=ne.getComponentInParent(t.object,ml);if(!i||i!==this)return;let s=t.object;this.transformSelf&&(s=this.gameObject);const r={selected:s,attached:s};for(const c of this.selectStartEventListener)c(this,r);if(this._activePointerId=t.pointerId,!r.attached)return;r.attached,s=r.attached,this._isDragging=!0,this._dragHelper.setSelected(s,this.context),this.orbit&&(this.orbit.enabled=!1);const o=ne.getComponentInChildren(s,Bu);o&&(o.fastMode=!0,o==null||o.requestOwnership()),this._marker=ne.addNewComponent(s,fA),this._draggingRigidbodies.length=0;const a=ne.getComponentsInChildren(s,bi);a&&this._draggingRigidbodies.push(...a);const l=LR();ne.invokeOnChildren(this._dragHelper.selected,l("onDragStart"))}onUpdateDrag(){if(this._dragHelper){this._dragHelper.showGizmo=this.showGizmo,this._dragHelper.useViewAngle=this.useViewAngle,this._dragHelper.onUpdate(this.context);for(const t of this._draggingRigidbodies)t.wakeUp(),t.resetVelocities()}}onDragEnd(t){if(!this||!this._isDragging||(this._isDragging=!1,!this._dragHelper))return;for(const r of this._draggingRigidbodies)r.setVelocity(r.smoothedVelocity);this._draggingRigidbodies.length=0;const i=this._dragHelper.selected;if(this._dragHelper.setSelected(null,this.context),this.orbit&&(this.orbit.enabled=!0),t!=null&&t.object){const r=ne.getComponentInChildren(t.object,Bu);r&&(r.fastMode=!1)}this._marker&&this._marker.destroy();for(const r of this.selectEndEventListener)r(this);const s=LR();ne.invokeOnChildren(i,s("onDragEnd"))}};let Bl=ml;h(Bl,"_active",0),h(Bl,"lastHovered");$N([x()],Bl.prototype,"showGizmo",void 0);$N([x()],Bl.prototype,"useViewAngle",void 0);const oI=class{constructor(e){h(this,"showGizmo",!0);h(this,"useViewAngle",!0);h(this,"_selected",null);h(this,"_context",null);h(this,"_camera");h(this,"_cameraPlane",new Ir);h(this,"_hasGroundPlane",!1);h(this,"_groundPlane",new Ir);h(this,"_groundOffset",new w);h(this,"_groundOffsetFactor",0);h(this,"_groundDistance",0);h(this,"_groundPlanePoint",new w);h(this,"_raycaster",new Uu);h(this,"_cameraPlaneOffset",new w);h(this,"_intersection",new w);h(this,"_worldPosition",new w);h(this,"_inverseMatrix",new Ie);h(this,"_rbs",[]);h(this,"_groundLine");h(this,"_groundMarker");h(this,"_groundOffsetVector",new w(0,1,0));h(this,"_requireUpdateGroundPlane",!0);h(this,"_didDragOnGroundPlaneLastFrame",!1);this._camera=e;const t=new dn(oI.geometry),i=t.material;i.color=new _e(.4,.4,.4),t.layers.set(2),t.name="line",t.scale.y=1,this._groundLine=t;const s=new So(.5,22,22),r=new ai({color:i.color}),o=new ye(s,r);o.visible=!1,o.layers.set(2),this._groundMarker=o}get hasSelected(){return this._selected!==null&&this._selected!==void 0}get selected(){return this._selected}setSelected(e,t){if(this._selected&&t)for(const i of this._rbs)i.wakeUp(),i.setVelocity(0,0,0);if(this._selected&&pr.Remove(t,this._selected),this._selected=e,this._context=t,this._rbs.length=0,e?(t.scene.add(this._groundLine),t.scene.add(this._groundMarker)):(this._groundLine.removeFromParent(),this._groundMarker.removeFromParent()),this._selected){if(!t){console.error("DragHelper: no context");return}pr.Add(t,this._selected,null),this._groundOffsetFactor=0,this._hasGroundPlane=!0,this._groundOffset.set(0,0,0),this._requireUpdateGroundPlane=!0,this.onUpdateScreenSpacePlane()}}onUpdate(e){var a,l,c,u,d;if(!this._context)return;const t="Space",i="KeyD",s=((a=this._context)==null?void 0:a.input.isKeyPressed(t))||((l=this._context)==null?void 0:l.input.isKeyPressed(i)),r=this._context.input.getTouchesPressedCount()>=2||s;if(r){const f=this._context.input.getPointerPositionDelta(0);f&&(this._groundOffsetVector.set(0,1,0),(c=this._selected)==null||c.rotateOnWorldAxis(this._groundOffsetVector,f.x*this._context.time.deltaTime))}const o=this._context.input.getPointerPositionRC(0);if(o&&(this._raycaster.setFromCamera(o,this._camera),this._selected)){this._groundOffsetVector.set(0,1,0);const f=Mt(this._camera).clone().sub(Mt(this._selected)).normalize(),p=Math.abs(f.dot(this._groundOffsetVector)),g=((u=this._context)==null?void 0:u.input.isKeyPressed(t))||((d=this._context)==null?void 0:d.input.isKeyPressed(i));let A=!this.useViewAngle||p>.2;(r||g||this._context.input.getPointerPressedCount()>1)&&(A=!1);const v=this._didDragOnGroundPlaneLastFrame!==A;if(this._didDragOnGroundPlaneLastFrame=A,this._hasGroundPlane||(this._requireUpdateGroundPlane=!0),(this._requireUpdateGroundPlane||!A||v)&&this.onUpdateGroundPlane(),this._requireUpdateGroundPlane=!1,this._hasGroundPlane)if(this._raycaster.ray.intersectPlane(this._groundPlane,this._intersection)){const m=this._intersection.y;if(this._groundPlanePoint.copy(this._intersection).sub(this._groundOffset),this._groundPlanePoint.y=m,A){this._groundOffsetVector.set(0,1,0);const b=this._intersection.sub(this._groundOffset).add(this._groundOffsetVector.multiplyScalar(this._groundOffsetFactor));this.onUpdateWorldPosition(b,this._groundPlanePoint,!1),this.onDidUpdate();return}}else this._groundPlanePoint.set(0,99999,0);v&&this.onUpdateScreenSpacePlane(),this._requireUpdateGroundPlane=!0,this._raycaster.ray.intersectPlane(this._cameraPlane,this._intersection)&&(this.onUpdateWorldPosition(this._intersection.sub(this._cameraPlaneOffset),this._groundPlanePoint,!0),this.onDidUpdate())}}onUpdateWorldPosition(e,t,i){if(this._selected){if(i){const s=Mt(this._selected);s.y=e.y,e=s}if(On(this._selected,e),On(this._groundLine,e),this._hasGroundPlane?this._groundLine.scale.y=this._groundDistance:this._groundLine.scale.y=1e3,this._groundLine.visible=this.showGizmo,this._groundMarker.visible=t!==null&&this.showGizmo,t){const s=Mt(this._camera).distanceTo(t)*.01;this._groundMarker.scale.set(s,s,s),On(this._groundMarker,t)}}}onUpdateScreenSpacePlane(){if(!this._selected||!this._context)return;const e=this._context.input.getPointerPositionRC(0);e&&(this._raycaster.setFromCamera(e,this._camera),this._cameraPlane.setFromNormalAndCoplanarPoint(this._camera.getWorldDirection(this._cameraPlane.normal),this._worldPosition.setFromMatrixPosition(this._selected.matrixWorld)),this._raycaster.ray.intersectPlane(this._cameraPlane,this._intersection)&&this._selected.parent&&(this._inverseMatrix.copy(this._selected.parent.matrixWorld).invert(),this._cameraPlaneOffset.copy(this._intersection).sub(this._worldPosition.setFromMatrixPosition(this._selected.matrixWorld))))}onUpdateGroundPlane(){if(!this._selected||!this._context)return;const e=Mt(this._selected),t=new Qa(new w(0,.1,0).add(e),new w(0,-1,0)),i=new Ko;i.ignore=[this._selected];const s=this._context.physics.raycastFromRay(t,i);for(let r=0;r<s.length;r++){const o=s[r];if(!o.face||this.contains(this._selected,o.object))continue;const a=new w(0,1,0);this._groundPlane.setFromNormalAndCoplanarPoint(a,o.point);break}this._hasGroundPlane=!0,this._groundPlane.setFromNormalAndCoplanarPoint(t.direction.multiplyScalar(-1),t.origin),this._raycaster.ray.intersectPlane(this._groundPlane,this._intersection),this._groundDistance=this._intersection.distanceTo(e),this._groundOffset.copy(this._intersection).sub(e)}onDidUpdate(){Fr.markDirty(this._selected);for(const e of this._rbs)e.wakeUp(),e.resetForcesAndTorques(),e.setAngularVelocity(0,0,0)}contains(e,t){if(e===t)return!0;if(e.children){for(const i of e.children)if(this.contains(i,t))return!0}return!1}};let jy=oI;h(jy,"geometry",new ft().setFromPoints([new w(0,0,0),new w(0,-1,0)]));function y1(n,e,t){console.warn("Adding components on object has been temporarily disabled")}var q0;(function(n){n.File_Spawned="file-spawned"})(q0||(q0={}));class fee{constructor(e,t,i,s,r,o,a,l){h(this,"guid");h(this,"file_name");h(this,"file_hash");h(this,"file_size");h(this,"position");h(this,"seed");h(this,"sender");h(this,"serverUrl");h(this,"parentGuid");h(this,"boundsSize");this.seed=t,this.guid=i,this.file_name=s,this.file_hash=r,this.file_size=o,this.position=a,this.sender=e,this.serverUrl=l}}async function pee(n,e,t){const i=n.name;return i.endsWith(".gltf")||i.endsWith(".glb")?new Promise((s,r)=>{const o=new FileReader;o.readAsArrayBuffer(n),o.onloadend=async a=>{const l=o.result,c=JM(),u=new Ws(c),d=await Ga().parseSync(e,l,n.name,u);if(d&&d.scene){const f=d.scene;if(!f.guid){const p=new Ws(c);f.guid=p.generateUUID()}t&&Aee(e.connection,n,c,f,t),y1(),s(d)}}}):(console.warn("Unsupported file type: "+i,n),null)}async function gee(n,e){return new Promise(async(t,i)=>{const s=JM(),r=new Ws(s),o=n.toString(),a=await Ga().loadSync(e,o,o,r);a&&a.scene?(a.scene,y1(),t(a)):console.warn("Unsupported file type: "+n.toString())})}en.registerCallback(Qn.ContextCreated,n=>{mee(n.context)});function mee(n){n.connection.beginListen(q0.File_Spawned,async e=>{if(e.sender!==n.connection.connectionId){console.log("received file event",e),vee(e,n);let t=null;try{t=await vF(e.file_name,e.file_hash,e.file_size,e.serverUrl)}finally{yee(e)}if(t){const i=new Ws(e.seed),s=await Ga().parseSync(n,t,e.file_name,i);if(s&&s.scene){const r=s.scene;if(y1(),e.parentGuid){const o=h_(e.parentGuid,n.scene);o&&"add"in o&&o.add(r)}r.parent||n.scene.add(r),e.position!==null&&r.position.copy(e.position)}}else console.error("download didnt return file")}})}async function Aee(n,e,t,i,s){if(!n.connectionId){console.error("Can not upload file - no connection id");return}if(!i.guid){console.error("Can not upload file - no guid",i,i.guid);return}const r=await K6(e,s);if(!r)return;if(!r.filename){console.error("Can not send upload event - no filename",e.name);return}if(!r.hash){console.error("Can not send upload event - no hash",e.name);return}const o=new fee(n.connectionId,t,i.guid,r.filename,r.hash,e.size,i.position,r.url??s);i.parent&&(o.parentGuid=i.parent.guid),n.send(q0.File_Spawned,o)}const bE={};function vee(n,e){const t=new Ei,i=new ye(t,new ai({color:65280})),s=new $b(i,5592405);if(bE[n.guid]=s,e.scene.add(s),n.parentGuid){const r=h_(n.parentGuid,e.scene);r&&r.add(s)}n.position&&s.position.copy(n.position)}function yee(n,e){const t=n.guid,i=bE[t];i&&(delete bE[t],i.removeFromParent())}var b1=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const bee=re("debugnet");class ql extends Te{constructor(){super(...arguments);h(this,"url",null);h(this,"urlParameterName",null);h(this,"localhost",null)}awake(){bee&&console.log(this),this.context.connection.registerProvider(this)}getWebsocketUrl(){let t=this.url?ql.GetUrl(this.url,this.localhost):null;if(this.urlParameterName){const o=re(this.urlParameterName);o&&typeof o=="string"&&(t=o)}if(!t)return null;const s=new RegExp("(((https?)|(?<socket_prefix>wss?))://)?(www.)?(?<url>.+)","gm").exec(t);return s!=null&&s.groups?(s==null?void 0:s.groups.socket_prefix)?t:"wss://"+(s==null?void 0:s.groups.url):null}static GetUrl(t,i){let s=t;const r=ql.IsLocalNetwork()&&i;if(r&&(s=i),t!=null&&t.startsWith("/")){const o=r?s:window.location.origin;o!=null&&o.endsWith("/")&&t.startsWith("/")&&(t=t.substring(1)),s=o+t}return s}static IsLocalNetwork(t=window.location.hostname){return Ar(t)}}b1([x()],ql.prototype,"url",void 0);b1([x()],ql.prototype,"urlParameterName",void 0);b1([x()],ql.prototype,"localhost",void 0);var e3=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const Bd=re("debugdroplistener");var X0;(function(n){n.ObjectAdded="object-added",n.FileDropped="file-dropped"})(X0||(X0={}));class Y_ extends Te{constructor(){super(...arguments);h(this,"filesBackendUrl");h(this,"localhost");h(this,"onDrag",t=>{t.preventDefault()});h(this,"onDrop",async t=>{if(Bd&&console.log(t),!(t!=null&&t.dataTransfer))return;t.preventDefault();const i=t.dataTransfer.items;if(i)for(const s in i){const r=i[s];if(r.kind==="file"){const o=r.getAsFile();if(!o)continue;await this.addFiles(o)}else r.kind==="string"&&r.type=="text/plain"&&r.getAsString(async o=>{Bd&&console.log("dropped url",o);try{const a=new URL(o);if(!a)return;const l=await gee(a,this.context);l&&this.addObject(t,l)}catch{console.log("dropped string is not a valid URL!",o)}})}})}onEnable(){this.filesBackendUrl=ql.GetUrl(this.filesBackendUrl,this.localhost)??this.filesBackendUrl,Bd&&console.log(this,this.filesBackendUrl),this.context.domElement.addEventListener("dragover",this.onDrag),this.context.domElement.addEventListener("drop",this.onDrop)}onDisable(){this.context.domElement.removeEventListener("dragover",this.onDrag),this.context.domElement.removeEventListener("drop",this.onDrop)}async addFiles(...t){if(Bd&&console.log("Add files",t),!!Array.isArray(t)&&t.length)for(const i of t){if(!i)continue;Bd&&console.log("Register file "+i.name+" to",this.filesBackendUrl,i);const s=await pee(i,this.context,this.filesBackendUrl);this.dispatchEvent(new CustomEvent(X0.FileDropped,{detail:i})),s&&this.addObject(void 0,s)}}async addObject(t,i){if(Bd&&console.log("Dropped",i),!(i!=null&&i.scene)){console.warn("No object specified to add to scene",i);return}const s=i.scene;if(t!==void 0){const r=new Ko;r.setMask(16777215),r.screenPointFromOffset(t.offsetX,t.offsetY);const o=this.context.physics.raycast(r);if(o&&o.length>0)for(const a of o){s.position.copy(a.point);break}}this.gameObject.add(s),this.dispatchEvent(new CustomEvent(X0.ObjectAdded,{detail:i}))}}e3([x()],Y_.prototype,"filesBackendUrl",void 0);e3([x()],Y_.prototype,"localhost",void 0);var J_=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};class gp extends dA{constructor(){super(...arguments);h(this,"parent",null);h(this,"object",null);h(this,"limitCount",10);h(this,"limitInterval",60);h(this,"_currentCount",0);h(this,"_startPosition",null);h(this,"_startQuaternion",null)}awake(){var i,s;if(this.object){if(this.object===this.gameObject){console.error("Can not duplicate self");return}this.object.visible=!1,this._startPosition=((i=this.object.position)==null?void 0:i.clone())??new w(0,0,0),this._startQuaternion=((s=this.object.quaternion)==null?void 0:s.clone())??new Se(0,0,0,1)}const t=ne.getComponentInParent(this.gameObject,Bl);t?t.addDragEventListener(Hm.SelectStart,(r,o)=>{if(this._currentCount>=this.limitCount){o.attached=null;return}const a=this.handleDuplication(o.selected);a&&(console.assert(a!==o.selected,"Duplicated object is original"),o.attached=a)}):console.warn("Could no find drag controls in parent",this.name),un.addEventListener(Pr.SelectStart,(r,o)=>{if(this._currentCount>=this.limitCount){o.grab=null;return}const a=this.handleDuplication(o.selected);a&&(o.grab=a)}),this.cloneLimitIntervalFn()}cloneLimitIntervalFn(){this.destroyed||(this._currentCount>0&&(this._currentCount-=1),setTimeout(()=>{this.cloneLimitIntervalFn()},this.limitInterval/this.limitCount*1e3))}handleDuplication(t){var i;if(this._currentCount>=this.limitCount||!this.object)return null;if(t===this.gameObject||this.handleMultiObject(t)){if(this.object===this.gameObject)return null;this.object.visible=!0,this._startPosition&&this.object.position.copy(this._startPosition),this._startQuaternion&&this.object.quaternion.copy(this._startQuaternion);const s=new Hl;this.parent||(this.parent=this.gameObject.parent),this.parent&&(s.parent=this.parent.guid??((i=this.parent.userData)==null?void 0:i.guid),s.keepWorldPosition=!0),s.position=this.worldPosition,s.rotation=this.worldQuaternion,s.context=this.context,this._currentCount+=1;const r=ne.instantiateSynced(this.object,s);return console.assert(r!==this.object,"Duplicated object is original"),this.object.visible=!1,this._startPosition&&this.object.position.clone().copy(this._startPosition),this._startQuaternion&&this.object.quaternion.clone().copy(this._startQuaternion),r}return null}handleMultiObject(t){return this.gameObject.type==="Group"||this.gameObject.type==="Object3D"?this.isInChildren(this.gameObject,t):!1}isInChildren(t,i){if(!t)return!1;if(t===i)return!0;if(t.children){for(const s of t.children)if(this.isInChildren(s,i))return!0}return!1}}J_([x(Me)],gp.prototype,"parent",void 0);J_([x(Me)],gp.prototype,"object",void 0);J_([x()],gp.prototype,"limitCount",void 0);J_([x()],gp.prototype,"limitInterval",void 0);var Jh;(function(n){n[n.PointerEnter=0]="PointerEnter",n[n.PointerExit=1]="PointerExit",n[n.PointerDown=2]="PointerDown",n[n.PointerUp=3]="PointerUp",n[n.PointerClick=4]="PointerClick",n[n.Drag=5]="Drag",n[n.Drop=6]="Drop",n[n.Scroll=7]="Scroll",n[n.UpdateSelected=8]="UpdateSelected",n[n.Select=9]="Select",n[n.Deselect=10]="Deselect",n[n.Move=11]="Move",n[n.InitializePotentialDrag=12]="InitializePotentialDrag",n[n.BeginDrag=13]="BeginDrag",n[n.EndDrag=14]="EndDrag",n[n.Submit=15]="Submit",n[n.Cancel=16]="Cancel"})(Jh||(Jh={}));var _1=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};class x1{constructor(){h(this,"eventID");h(this,"callback")}}_1([x()],x1.prototype,"eventID",void 0);_1([x(qn)],x1.prototype,"callback",void 0);class w1 extends Te{constructor(){super(...arguments);h(this,"triggers")}invoke(t){if(this.triggers)for(const i of this.triggers)i.eventID===t&&i.callback.invoke()}onPointerClick(t){this.invoke(Jh.PointerClick)}onPointerEnter(t){this.invoke(Jh.PointerEnter)}onPointerExit(t){this.invoke(Jh.PointerExit)}onPointerDown(t){this.invoke(Jh.PointerDown)}onPointerUp(t){this.invoke(Jh.PointerUp)}}_1([x(x1)],w1.prototype,"triggers",void 0);var S1=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};class C1 extends Te{constructor(){super(...arguments);h(this,"connectedBody");h(this,"_rigidBody",null)}get rigidBody(){return this._rigidBody}onEnable(){this._rigidBody||(this._rigidBody=this.gameObject.getComponent(bi)),this.rigidBody&&this.connectedBody&&this.startCoroutine(this.create())}*create(){yield,this.rigidBody&&this.connectedBody&&this.createJoint(this.rigidBody,this.connectedBody)}}S1([x(bi)],C1.prototype,"connectedBody",void 0);class t3 extends C1{createJoint(e,t){var i;(i=this.context.physics.engine)==null||i.addFixedJoint(e,t)}}class K_ extends C1{constructor(){super(...arguments);h(this,"anchor");h(this,"axis")}createJoint(t,i){var s;this.axis&&this.anchor&&((s=this.context.physics.engine)==null||s.addHingeJoint(t,i,this.anchor,this.axis))}}S1([x(w)],K_.prototype,"anchor",void 0);S1([x(w)],K_.prototype,"axis",void 0);const _ee={type:"change"};let xee=class extends Fn{constructor(e,t){super(),this.object=e,this.domElement=t,this.enabled=!0,this.movementSpeed=1,this.rollSpeed=.005,this.dragToLook=!1,this.autoForward=!1;const i=this,s=1e-6,r=new Se,o=new w;this.tmpQuaternion=new Se,this.status=0,this.moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},this.moveVector=new w(0,0,0),this.rotationVector=new w(0,0,0),this.keydown=function(p){if(!(p.altKey||this.enabled===!1)){switch(p.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=.1;break;case"KeyW":this.moveState.forward=1;break;case"KeyS":this.moveState.back=1;break;case"KeyA":this.moveState.left=1;break;case"KeyD":this.moveState.right=1;break;case"KeyR":this.moveState.up=1;break;case"KeyF":this.moveState.down=1;break;case"ArrowUp":this.moveState.pitchUp=1;break;case"ArrowDown":this.moveState.pitchDown=1;break;case"ArrowLeft":this.moveState.yawLeft=1;break;case"ArrowRight":this.moveState.yawRight=1;break;case"KeyQ":this.moveState.rollLeft=1;break;case"KeyE":this.moveState.rollRight=1;break}this.updateMovementVector(),this.updateRotationVector()}},this.keyup=function(p){if(this.enabled!==!1){switch(p.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=1;break;case"KeyW":this.moveState.forward=0;break;case"KeyS":this.moveState.back=0;break;case"KeyA":this.moveState.left=0;break;case"KeyD":this.moveState.right=0;break;case"KeyR":this.moveState.up=0;break;case"KeyF":this.moveState.down=0;break;case"ArrowUp":this.moveState.pitchUp=0;break;case"ArrowDown":this.moveState.pitchDown=0;break;case"ArrowLeft":this.moveState.yawLeft=0;break;case"ArrowRight":this.moveState.yawRight=0;break;case"KeyQ":this.moveState.rollLeft=0;break;case"KeyE":this.moveState.rollRight=0;break}this.updateMovementVector(),this.updateRotationVector()}},this.pointerdown=function(p){if(this.enabled!==!1)if(this.dragToLook)this.status++;else{switch(p.button){case 0:this.moveState.forward=1;break;case 2:this.moveState.back=1;break}this.updateMovementVector()}},this.pointermove=function(p){if(this.enabled!==!1&&(!this.dragToLook||this.status>0)){const g=this.getContainerDimensions(),A=g.size[0]/2,v=g.size[1]/2;this.moveState.yawLeft=-(p.pageX-g.offset[0]-A)/A,this.moveState.pitchDown=(p.pageY-g.offset[1]-v)/v,this.updateRotationVector()}},this.pointerup=function(p){if(this.enabled!==!1){if(this.dragToLook)this.status--,this.moveState.yawLeft=this.moveState.pitchDown=0;else{switch(p.button){case 0:this.moveState.forward=0;break;case 2:this.moveState.back=0;break}this.updateMovementVector()}this.updateRotationVector()}},this.contextMenu=function(p){this.enabled!==!1&&p.preventDefault()},this.update=function(p){if(this.enabled===!1)return;const g=p*i.movementSpeed,A=p*i.rollSpeed;i.object.translateX(i.moveVector.x*g),i.object.translateY(i.moveVector.y*g),i.object.translateZ(i.moveVector.z*g),i.tmpQuaternion.set(i.rotationVector.x*A,i.rotationVector.y*A,i.rotationVector.z*A,1).normalize(),i.object.quaternion.multiply(i.tmpQuaternion),(o.distanceToSquared(i.object.position)>s||8*(1-r.dot(i.object.quaternion))>s)&&(i.dispatchEvent(_ee),r.copy(i.object.quaternion),o.copy(i.object.position))},this.updateMovementVector=function(){const p=this.moveState.forward||this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right,this.moveVector.y=-this.moveState.down+this.moveState.up,this.moveVector.z=-p+this.moveState.back},this.updateRotationVector=function(){this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp,this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft,this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft},this.getContainerDimensions=function(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}},this.dispose=function(){this.domElement.removeEventListener("contextmenu",a),this.domElement.removeEventListener("pointerdown",c),this.domElement.removeEventListener("pointermove",l),this.domElement.removeEventListener("pointerup",u),window.removeEventListener("keydown",d),window.removeEventListener("keyup",f)};const a=this.contextMenu.bind(this),l=this.pointermove.bind(this),c=this.pointerdown.bind(this),u=this.pointerup.bind(this),d=this.keydown.bind(this),f=this.keyup.bind(this);this.domElement.addEventListener("contextmenu",a),this.domElement.addEventListener("pointerdown",c),this.domElement.addEventListener("pointermove",l),this.domElement.addEventListener("pointerup",u),window.addEventListener("keydown",d),window.addEventListener("keyup",f),this.updateMovementVector(),this.updateRotationVector()}};class i3 extends Te{constructor(){super(...arguments);h(this,"_controls",null)}onEnable(){var i;const t=(i=ne.getComponent(this.gameObject,yi))==null?void 0:i.cam;if(!t){console.warn("FlyControls: Requires a Camera component on the same object as this component.");return}this._controls=new xee(t,this.context.renderer.domElement),this._controls.rollSpeed=.5,this._controls.movementSpeed=3,this._controls.dragToLook=!0}onDisable(){var t;(t=this._controls)==null||t.dispose(),this._controls=null}update(){this._controls&&this._controls.update(this.context.time.deltaTime)}}var E1=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r},_E;(function(n){n[n.Linear=1]="Linear",n[n.Exponential=2]="Exponential",n[n.ExponentialSquared=3]="ExponentialSquared"})(_E||(_E={}));class IA extends Te{constructor(){super(...arguments);h(this,"_fog")}get fog(){return this._fog||(this._fog=new aM(0,0,50)),this._fog}get mode(){return _E.Linear}set near(t){this.fog.near=t}get near(){return this.fog.near}set far(t){this.fog.far=t}get far(){return this.fog.far}set color(t){this.fog.color.copy(t)}get color(){return this.fog.color}onEnable(){this.scene.fog=this.fog}onDisable(){this.scene.fog===this._fog&&(this.scene.fog=null)}}E1([x()],IA.prototype,"near",null);E1([x()],IA.prototype,"far",null);E1([x(_e)],IA.prototype,"color",null);let ay,rS,Dd,ly;function oS(n,e=1/0,t=null){rS||(rS=new us(2,2,1,1)),Dd||(Dd=new Bt({uniforms:{blitTexture:new xe(n)},vertexShader:`
            varying vec2 vUv;
            void main(){
                vUv = uv;
                gl_Position = vec4(position.xy * 1.0,0.,.999999);
            }`,fragmentShader:`
            uniform sampler2D blitTexture; 
            varying vec2 vUv;

            void main(){ 
                gl_FragColor = vec4(vUv.xy, 0, 1);
                
                #ifdef IS_SRGB
                gl_FragColor = LinearTosRGB( texture2D( blitTexture, vUv) );
                #else
                gl_FragColor = texture2D( blitTexture, vUv);
                #endif
            }`})),Dd.uniforms.blitTexture.value=n,Dd.defines.IS_SRGB=n.colorSpace==Je,Dd.needsUpdate=!0,ly||(ly=new ye(rS,Dd),ly.frustrumCulled=!1);const i=new qt,s=new mr;s.add(ly),t||(t=ay=new oh({antialias:!1})),t.setSize(Math.min(n.image.width,e),Math.min(n.image.height,e)),t.clear(),t.render(s,i);const r=new Rt(t.domElement);return r.minFilter=n.minFilter,r.magFilter=n.magFilter,r.wrapS=n.wrapS,r.wrapT=n.wrapT,r.name=n.name,ay&&(ay.dispose(),ay=null),r}const SD={POSITION:["byte","byte normalized","unsigned byte","unsigned byte normalized","short","short normalized","unsigned short","unsigned short normalized"],NORMAL:["byte normalized","short normalized"],TANGENT:["byte normalized","short normalized"],TEXCOORD:["byte","byte normalized","unsigned byte","short","short normalized","unsigned short"]};class M1{constructor(){this.pluginCallbacks=[],this.register(function(e){return new Bee(e)}),this.register(function(e){return new Dee(e)}),this.register(function(e){return new Lee(e)}),this.register(function(e){return new Fee(e)}),this.register(function(e){return new Uee(e)}),this.register(function(e){return new Nee(e)}),this.register(function(e){return new Oee(e)}),this.register(function(e){return new kee(e)}),this.register(function(e){return new zee(e)}),this.register(function(e){return new Gee(e)}),this.register(function(e){return new Vee(e)})}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,i,s){const r=new Pee,o=[];for(let a=0,l=this.pluginCallbacks.length;a<l;a++)o.push(this.pluginCallbacks[a](r));r.setPlugins(o),r.write(e,t,s).catch(i)}parseAsync(e,t){const i=this;return new Promise(function(s,r){i.parse(e,s,r,t)})}}const jt={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},aS="KHR_mesh_quantization",kr={};kr[Ft]=jt.NEAREST;kr[Pf]=jt.NEAREST_MIPMAP_NEAREST;kr[fu]=jt.NEAREST_MIPMAP_LINEAR;kr[Dt]=jt.LINEAR;kr[Jm]=jt.LINEAR_MIPMAP_NEAREST;kr[yo]=jt.LINEAR_MIPMAP_LINEAR;kr[Wn]=jt.CLAMP_TO_EDGE;kr[vo]=jt.REPEAT;kr[wu]=jt.MIRRORED_REPEAT;const CD={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},wee=new _e,ED=12,See=1179937895,Cee=2,MD=8,Eee=1313821514,Mee=5130562;function Ag(n,e){return n.length===e.length&&n.every(function(t,i){return t===e[i]})}function Tee(n){return new TextEncoder().encode(n).buffer}function Iee(n){return Ag(n.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}function Ree(n,e,t){const i={min:new Array(n.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(n.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let s=e;s<e+t;s++)for(let r=0;r<n.itemSize;r++){let o;n.itemSize>4?o=n.array[s*n.itemSize+r]:(r===0?o=n.getX(s):r===1?o=n.getY(s):r===2?o=n.getZ(s):r===3&&(o=n.getW(s)),n.normalized===!0&&(o=cs.normalize(o,n.array))),i.min[r]=Math.min(i.min[r],o),i.max[r]=Math.max(i.max[r],o)}return i}function n3(n){return Math.ceil(n/4)*4}function lS(n,e=0){const t=n3(n.byteLength);if(t!==n.byteLength){const i=new Uint8Array(t);if(i.set(new Uint8Array(n)),e!==0)for(let s=n.byteLength;s<t;s++)i[s]=e;return i.buffer}return n}function TD(){return typeof document>"u"&&typeof OffscreenCanvas<"u"?new OffscreenCanvas(1,1):document.createElement("canvas")}function ID(n,e){if(n.toBlob!==void 0)return new Promise(i=>n.toBlob(i,e));let t;return e==="image/jpeg"?t=.92:e==="image/webp"&&(t=.8),n.convertToBlob({type:e,quality:t})}class Pee{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.extensionsRequired={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(e){this.plugins=e}async write(e,t,i={}){this.options=Object.assign({binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},i),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(e),await Promise.all(this.pending);const s=this,r=s.buffers,o=s.json;i=s.options;const a=s.extensionsUsed,l=s.extensionsRequired,c=new Blob(r,{type:"application/octet-stream"}),u=Object.keys(a),d=Object.keys(l);if(u.length>0&&(o.extensionsUsed=u),d.length>0&&(o.extensionsRequired=d),o.buffers&&o.buffers.length>0&&(o.buffers[0].byteLength=c.size),i.binary===!0){const f=new FileReader;f.readAsArrayBuffer(c),f.onloadend=function(){const p=lS(f.result),g=new DataView(new ArrayBuffer(MD));g.setUint32(0,p.byteLength,!0),g.setUint32(4,Mee,!0);const A=lS(Tee(JSON.stringify(o)),32),v=new DataView(new ArrayBuffer(MD));v.setUint32(0,A.byteLength,!0),v.setUint32(4,Eee,!0);const m=new ArrayBuffer(ED),b=new DataView(m);b.setUint32(0,See,!0),b.setUint32(4,Cee,!0);const y=ED+v.byteLength+A.byteLength+g.byteLength+p.byteLength;b.setUint32(8,y,!0);const _=new Blob([m,v,A,g,p],{type:"application/octet-stream"}),E=new FileReader;E.readAsArrayBuffer(_),E.onloadend=function(){t(E.result)}}}else if(o.buffers&&o.buffers.length>0){const f=new FileReader;f.readAsDataURL(c),f.onloadend=function(){const p=f.result;o.buffers[0].uri=p,t(o)}}else t(o)}serializeUserData(e,t){if(Object.keys(e.userData).length===0)return;const i=this.options,s=this.extensionsUsed;try{const r=JSON.parse(JSON.stringify(e.userData));if(i.includeCustomExtensions&&r.gltfExtensions){t.extensions===void 0&&(t.extensions={});for(const o in r.gltfExtensions)t.extensions[o]=r.gltfExtensions[o],s[o]=!0;delete r.gltfExtensions}Object.keys(r).length>0&&(t.extras=r)}catch(r){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+r.message)}}getUID(e,t=!1){if(this.uids.has(e)===!1){const s=new Map;s.set(!0,this.uid++),s.set(!1,this.uid++),this.uids.set(e,s)}return this.uids.get(e).get(t)}isNormalizedNormalAttribute(e){if(this.cache.attributesNormalized.has(e))return!1;const i=new w;for(let s=0,r=e.count;s<r;s++)if(Math.abs(i.fromBufferAttribute(e,s).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){const t=this.cache;if(t.attributesNormalized.has(e))return t.attributesNormalized.get(e);const i=e.clone(),s=new w;for(let r=0,o=i.count;r<o;r++)s.fromBufferAttribute(i,r),s.x===0&&s.y===0&&s.z===0?s.setX(1):s.normalize(),i.setXYZ(r,s.x,s.y,s.z);return t.attributesNormalized.set(e,i),i}applyTextureTransform(e,t){let i=!1;const s={};(t.offset.x!==0||t.offset.y!==0)&&(s.offset=t.offset.toArray(),i=!0),t.rotation!==0&&(s.rotation=t.rotation,i=!0),(t.repeat.x!==1||t.repeat.y!==1)&&(s.scale=t.repeat.toArray(),i=!0),i&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=s,this.extensionsUsed.KHR_texture_transform=!0)}buildMetalRoughTexture(e,t){if(e===t)return e;function i(p){return p.colorSpace===Je?function(A){return A<.04045?A*.0773993808:Math.pow(A*.9478672986+.0521327014,2.4)}:function(A){return A}}console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures."),e instanceof Ol&&(e=oS(e)),t instanceof Ol&&(t=oS(t));const s=e?e.image:null,r=t?t.image:null,o=Math.max(s?s.width:0,r?r.width:0),a=Math.max(s?s.height:0,r?r.height:0),l=TD();l.width=o,l.height=a;const c=l.getContext("2d");c.fillStyle="#00ffff",c.fillRect(0,0,o,a);const u=c.getImageData(0,0,o,a);if(s){c.drawImage(s,0,0,o,a);const p=i(e),g=c.getImageData(0,0,o,a).data;for(let A=2;A<g.length;A+=4)u.data[A]=p(g[A]/256)*256}if(r){c.drawImage(r,0,0,o,a);const p=i(t),g=c.getImageData(0,0,o,a).data;for(let A=1;A<g.length;A+=4)u.data[A]=p(g[A]/256)*256}c.putImageData(u,0,0);const f=(e||t).clone();return f.source=new Sl(l),f.colorSpace=ur,f.channel=(e||t).channel,e&&t&&e.channel!==t.channel&&console.warn("THREE.GLTFExporter: UV channels for metalnessMap and roughnessMap textures must match."),f}processBuffer(e){const t=this.json,i=this.buffers;return t.buffers||(t.buffers=[{byteLength:0}]),i.push(e),0}processBufferView(e,t,i,s,r){const o=this.json;o.bufferViews||(o.bufferViews=[]);let a;switch(t){case jt.BYTE:case jt.UNSIGNED_BYTE:a=1;break;case jt.SHORT:case jt.UNSIGNED_SHORT:a=2;break;default:a=4}const l=n3(s*e.itemSize*a),c=new DataView(new ArrayBuffer(l));let u=0;for(let p=i;p<i+s;p++)for(let g=0;g<e.itemSize;g++){let A;e.itemSize>4?A=e.array[p*e.itemSize+g]:(g===0?A=e.getX(p):g===1?A=e.getY(p):g===2?A=e.getZ(p):g===3&&(A=e.getW(p)),e.normalized===!0&&(A=cs.normalize(A,e.array))),t===jt.FLOAT?c.setFloat32(u,A,!0):t===jt.INT?c.setInt32(u,A,!0):t===jt.UNSIGNED_INT?c.setUint32(u,A,!0):t===jt.SHORT?c.setInt16(u,A,!0):t===jt.UNSIGNED_SHORT?c.setUint16(u,A,!0):t===jt.BYTE?c.setInt8(u,A):t===jt.UNSIGNED_BYTE&&c.setUint8(u,A),u+=a}const d={buffer:this.processBuffer(c.buffer),byteOffset:this.byteOffset,byteLength:l};return r!==void 0&&(d.target=r),r===jt.ARRAY_BUFFER&&(d.byteStride=e.itemSize*a),this.byteOffset+=l,o.bufferViews.push(d),{id:o.bufferViews.length-1,byteLength:0}}processBufferViewImage(e){const t=this,i=t.json;return i.bufferViews||(i.bufferViews=[]),new Promise(function(s){const r=new FileReader;r.readAsArrayBuffer(e),r.onloadend=function(){const o=lS(r.result),a={buffer:t.processBuffer(o),byteOffset:t.byteOffset,byteLength:o.byteLength};t.byteOffset+=o.byteLength,s(i.bufferViews.push(a)-1)}})}processAccessor(e,t,i,s){const r=this.json,o={1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",9:"MAT3",16:"MAT4"};let a;if(e.array.constructor===Float32Array)a=jt.FLOAT;else if(e.array.constructor===Int32Array)a=jt.INT;else if(e.array.constructor===Uint32Array)a=jt.UNSIGNED_INT;else if(e.array.constructor===Int16Array)a=jt.SHORT;else if(e.array.constructor===Uint16Array)a=jt.UNSIGNED_SHORT;else if(e.array.constructor===Int8Array)a=jt.BYTE;else if(e.array.constructor===Uint8Array)a=jt.UNSIGNED_BYTE;else throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type: "+e.array.constructor.name);if(i===void 0&&(i=0),s===void 0&&(s=e.count),s===0)return null;const l=Ree(e,i,s);let c;t!==void 0&&(c=e===t.index?jt.ELEMENT_ARRAY_BUFFER:jt.ARRAY_BUFFER);const u=this.processBufferView(e,a,i,s,c),d={bufferView:u.id,byteOffset:u.byteOffset,componentType:a,count:s,max:l.max,min:l.min,type:o[e.itemSize]};return e.normalized===!0&&(d.normalized=!0),r.accessors||(r.accessors=[]),r.accessors.push(d)-1}processImage(e,t,i,s="image/png"){if(e!==null){const r=this,o=r.cache,a=r.json,l=r.options,c=r.pending;o.images.has(e)||o.images.set(e,{});const u=o.images.get(e),d=s+":flipY/"+i.toString();if(u[d]!==void 0)return u[d];a.images||(a.images=[]);const f={mimeType:s},p=TD();p.width=Math.min(e.width,l.maxTextureSize),p.height=Math.min(e.height,l.maxTextureSize);const g=p.getContext("2d");if(i===!0&&(g.translate(0,p.height),g.scale(1,-1)),e.data!==void 0){t!==Ti&&console.error("GLTFExporter: Only RGBAFormat is supported.",t),(e.width>l.maxTextureSize||e.height>l.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",e);const v=new Uint8ClampedArray(e.height*e.width*4);for(let m=0;m<v.length;m+=4)v[m+0]=e.data[m+0],v[m+1]=e.data[m+1],v[m+2]=e.data[m+2],v[m+3]=e.data[m+3];g.putImageData(new ImageData(v,e.width,e.height),0,0)}else g.drawImage(e,0,0,p.width,p.height);l.binary===!0?c.push(ID(p,s).then(v=>r.processBufferViewImage(v)).then(v=>{f.bufferView=v})):p.toDataURL!==void 0?f.uri=p.toDataURL(s):c.push(ID(p,s).then(v=>new FileReader().readAsDataURL(v)).then(v=>{f.uri=v}));const A=a.images.push(f)-1;return u[d]=A,A}else throw new Error("THREE.GLTFExporter: No valid image data found. Unable to process texture.")}processSampler(e){const t=this.json;t.samplers||(t.samplers=[]);const i={magFilter:kr[e.magFilter],minFilter:kr[e.minFilter],wrapS:kr[e.wrapS],wrapT:kr[e.wrapT]};return t.samplers.push(i)-1}processTexture(e){const i=this.options,s=this.cache,r=this.json;if(s.textures.has(e))return s.textures.get(e);r.textures||(r.textures=[]),e instanceof Ol&&(e=oS(e,i.maxTextureSize));let o=e.userData.mimeType;o==="image/webp"&&(o="image/png");const a={sampler:this.processSampler(e),source:this.processImage(e.image,e.format,e.flipY,o)};e.name&&(a.name=e.name),this._invokeAll(function(c){c.writeTexture&&c.writeTexture(e,a)});const l=r.textures.push(a)-1;return s.textures.set(e,l),l}processMaterial(e){var c,u,d,f,p;const t=this.cache,i=this.json;if(t.materials.has(e))return t.materials.get(e);if(e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;i.materials||(i.materials=[]);const s={pbrMetallicRoughness:{}};e.isMeshStandardMaterial!==!0&&e.isMeshBasicMaterial!==!0&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");const r=e.color.toArray().concat([e.opacity]);Ag(r,[1,1,1,1])||(s.pbrMetallicRoughness.baseColorFactor=r),e.isMeshStandardMaterial?(s.pbrMetallicRoughness.metallicFactor=e.metalness,s.pbrMetallicRoughness.roughnessFactor=e.roughness):(s.pbrMetallicRoughness.metallicFactor=.5,s.pbrMetallicRoughness.roughnessFactor=.5);const o=(c=e.metalnessMap)!=null&&c.image?e.metalnessMap:void 0,a=(u=e.roughnessMap)!=null&&u.image?e.roughnessMap:void 0;if(o||a){const g=this.buildMetalRoughTexture(o,a),A={index:this.processTexture(g),channel:g.channel};this.applyTextureTransform(A,g),s.pbrMetallicRoughness.metallicRoughnessTexture=A}if(e.map){const g={index:this.processTexture(e.map),texCoord:e.map.channel};this.applyTextureTransform(g,e.map),s.pbrMetallicRoughness.baseColorTexture=g}if(e.emissive){const g=e.emissive;if(Math.max(g.r,g.g,g.b)>0&&(s.emissiveFactor=e.emissive.toArray()),(d=e.emissiveMap)!=null&&d.image){const v={index:this.processTexture(e.emissiveMap),texCoord:e.emissiveMap.channel};this.applyTextureTransform(v,e.emissiveMap),s.emissiveTexture=v}}if((f=e.normalMap)!=null&&f.image){const g={index:this.processTexture(e.normalMap),texCoord:e.normalMap.channel};e.normalScale&&e.normalScale.x!==1&&(g.scale=e.normalScale.x),this.applyTextureTransform(g,e.normalMap),s.normalTexture=g}if((p=e.aoMap)!=null&&p.image){const g={index:this.processTexture(e.aoMap),texCoord:e.aoMap.channel};e.aoMapIntensity!==1&&(g.strength=e.aoMapIntensity),this.applyTextureTransform(g,e.aoMap),s.occlusionTexture=g}e.transparent?s.alphaMode="BLEND":e.alphaTest>0&&(s.alphaMode="MASK",s.alphaCutoff=e.alphaTest),e.side===wi&&(s.doubleSided=!0),e.name!==""&&(s.name=e.name),this.serializeUserData(e,s),this._invokeAll(function(g){g.writeMaterial&&g.writeMaterial(e,s)});const l=i.materials.push(s)-1;return t.materials.set(e,l),l}processMesh(e){const t=this.cache,i=this.json,s=[e.geometry.uuid];if(Array.isArray(e.material))for(let y=0,_=e.material.length;y<_;y++)s.push(e.material[y].uuid);else s.push(e.material.uuid);const r=s.join(":");if(t.meshes.has(r))return t.meshes.get(r);const o=e.geometry;let a;e.isLineSegments?a=jt.LINES:e.isLineLoop?a=jt.LINE_LOOP:e.isLine?a=jt.LINE_STRIP:e.isPoints?a=jt.POINTS:a=e.material.wireframe?jt.LINES:jt.TRIANGLES;const l={},c={},u=[],d=[],f={uv:"TEXCOORD_0",uv1:"TEXCOORD_1",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},p=o.getAttribute("normal");p!==void 0&&!this.isNormalizedNormalAttribute(p)&&(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),o.setAttribute("normal",this.createNormalizedNormalAttribute(p)));let g=null;for(let y in o.attributes){if(y.slice(0,5)==="morph")continue;const _=o.attributes[y];if(y=f[y]||y.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(y)||(y="_"+y),t.attributes.has(this.getUID(_))){c[y]=t.attributes.get(this.getUID(_));continue}g=null;const M=_.array;y==="JOINTS_0"&&!(M instanceof Uint16Array)&&!(M instanceof Uint8Array)&&(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),g=new ot(new Uint16Array(M),_.itemSize,_.normalized));const I=this.processAccessor(g||_,o);I!==null&&(y.startsWith("_")||this.detectMeshQuantization(y,_),c[y]=I,t.attributes.set(this.getUID(_),I))}if(p!==void 0&&o.setAttribute("normal",p),Object.keys(c).length===0)return null;if(e.morphTargetInfluences!==void 0&&e.morphTargetInfluences.length>0){const y=[],_=[],E={};if(e.morphTargetDictionary!==void 0)for(const M in e.morphTargetDictionary)E[e.morphTargetDictionary[M]]=M;for(let M=0;M<e.morphTargetInfluences.length;++M){const I={};let R=!1;for(const C in o.morphAttributes){if(C!=="position"&&C!=="normal"){R||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),R=!0);continue}const T=o.morphAttributes[C][M],O=C.toUpperCase(),J=o.attributes[C];if(t.attributes.has(this.getUID(T,!0))){I[O]=t.attributes.get(this.getUID(T,!0));continue}const V=T.clone();if(!o.morphTargetsRelative)for(let H=0,Y=T.count;H<Y;H++)for(let N=0;N<T.itemSize;N++)N===0&&V.setX(H,T.getX(H)-J.getX(H)),N===1&&V.setY(H,T.getY(H)-J.getY(H)),N===2&&V.setZ(H,T.getZ(H)-J.getZ(H)),N===3&&V.setW(H,T.getW(H)-J.getW(H));I[O]=this.processAccessor(V,o),t.attributes.set(this.getUID(J,!0),I[O])}d.push(I),y.push(e.morphTargetInfluences[M]),e.morphTargetDictionary!==void 0&&_.push(E[M])}l.weights=y,_.length>0&&(l.extras={},l.extras.targetNames=_)}const A=Array.isArray(e.material);if(A&&o.groups.length===0)return null;const v=A?e.material:[e.material],m=A?o.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let y=0,_=m.length;y<_;y++){const E={mode:a,attributes:c};if(this.serializeUserData(o,E),d.length>0&&(E.targets=d),o.index!==null){let I=this.getUID(o.index);(m[y].start!==void 0||m[y].count!==void 0)&&(I+=":"+m[y].start+":"+m[y].count),t.attributes.has(I)?E.indices=t.attributes.get(I):(E.indices=this.processAccessor(o.index,o,m[y].start,m[y].count),t.attributes.set(I,E.indices)),E.indices===null&&delete E.indices}const M=this.processMaterial(v[m[y].materialIndex]);M!==null&&(E.material=M),u.push(E)}l.primitives=u,i.meshes||(i.meshes=[]),this._invokeAll(function(y){y.writeMesh&&y.writeMesh(e,l)});const b=i.meshes.push(l)-1;return t.meshes.set(r,b),b}detectMeshQuantization(e,t){if(this.extensionsUsed[aS])return;let i;switch(t.array.constructor){case Int8Array:i="byte";break;case Uint8Array:i="unsigned byte";break;case Int16Array:i="short";break;case Uint16Array:i="unsigned short";break;default:return}t.normalized&&(i+=" normalized");const s=e.split("_",1)[0];SD[s]&&SD[s].includes(i)&&(this.extensionsUsed[aS]=!0,this.extensionsRequired[aS]=!0)}processCamera(e){const t=this.json;t.cameras||(t.cameras=[]);const i=e.isOrthographicCamera,s={type:i?"orthographic":"perspective"};return i?s.orthographic={xmag:e.right*2,ymag:e.top*2,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:s.perspective={aspectRatio:e.aspect,yfov:cs.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},e.name!==""&&(s.name=e.type),t.cameras.push(s)-1}processAnimation(e,t){const i=this.json,s=this.nodeMap;i.animations||(i.animations=[]),e=M1.Utils.mergeMorphTargetTracks(e.clone(),t);const r=e.tracks,o=[],a=[];for(let l=0;l<r.length;++l){const c=r[l],u=kt.parseTrackName(c.name);let d=kt.findNode(t,u.nodeName);const f=CD[u.propertyName];if(u.objectName==="bones"&&(d.isSkinnedMesh===!0?d=d.skeleton.getBoneByName(u.objectIndex):d=void 0),!d||!f)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',c.name),null;const p=1;let g=c.values.length/c.times.length;f===CD.morphTargetInfluences&&(g/=d.morphTargetInfluences.length);let A;c.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline===!0?(A="CUBICSPLINE",g/=3):c.getInterpolation()===Su?A="STEP":A="LINEAR",a.push({input:this.processAccessor(new ot(c.times,p)),output:this.processAccessor(new ot(c.values,g)),interpolation:A}),o.push({sampler:a.length-1,target:{node:s.get(d),path:f}})}return i.animations.push({name:e.name||"clip_"+i.animations.length,samplers:a,channels:o}),i.animations.length-1}processSkin(e){const t=this.json,i=this.nodeMap,s=t.nodes[i.get(e)],r=e.skeleton;if(r===void 0)return null;const o=e.skeleton.bones[0];if(o===void 0)return null;const a=[],l=new Float32Array(r.bones.length*16),c=new Ie;for(let d=0;d<r.bones.length;++d)a.push(i.get(r.bones[d])),c.copy(r.boneInverses[d]),c.multiply(e.bindMatrix).toArray(l,d*16);return t.skins===void 0&&(t.skins=[]),t.skins.push({inverseBindMatrices:this.processAccessor(new ot(l,16)),joints:a,skeleton:i.get(o)}),s.skin=t.skins.length-1}processNode(e){const t=this.json,i=this.options,s=this.nodeMap;t.nodes||(t.nodes=[]);const r={};if(i.trs){const a=e.quaternion.toArray(),l=e.position.toArray(),c=e.scale.toArray();Ag(a,[0,0,0,1])||(r.rotation=a),Ag(l,[0,0,0])||(r.translation=l),Ag(c,[1,1,1])||(r.scale=c)}else e.matrixAutoUpdate&&e.updateMatrix(),Iee(e.matrix)===!1&&(r.matrix=e.matrix.elements);if(e.name!==""&&(r.name=String(e.name)),this.serializeUserData(e,r),e.isMesh||e.isLine||e.isPoints){const a=this.processMesh(e);a!==null&&(r.mesh=a)}else e.isCamera&&(r.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){const a=[];for(let l=0,c=e.children.length;l<c;l++){const u=e.children[l];if(u.visible||i.onlyVisible===!1){const d=this.processNode(u);d!==null&&a.push(d)}}a.length>0&&(r.children=a)}this._invokeAll(function(a){a.writeNode&&a.writeNode(e,r)});const o=t.nodes.push(r)-1;return s.set(e,o),o}processScene(e){const t=this.json,i=this.options;t.scenes||(t.scenes=[],t.scene=0);const s={};e.name!==""&&(s.name=e.name),t.scenes.push(s);const r=[];for(let o=0,a=e.children.length;o<a;o++){const l=e.children[o];if(l.visible||i.onlyVisible===!1){const c=this.processNode(l);c!==null&&r.push(c)}}r.length>0&&(s.nodes=r),this.serializeUserData(e,s)}processObjects(e){const t=new mr;t.name="AuxScene";for(let i=0;i<e.length;i++)t.children.push(e[i]);this.processScene(t)}processInput(e){const t=this.options;e=e instanceof Array?e:[e],this._invokeAll(function(s){s.beforeParse&&s.beforeParse(e)});const i=[];for(let s=0;s<e.length;s++)e[s]instanceof mr?this.processScene(e[s]):i.push(e[s]);i.length>0&&this.processObjects(i);for(let s=0;s<this.skins.length;++s)this.processSkin(this.skins[s]);for(let s=0;s<t.animations.length;++s)this.processAnimation(t.animations[s],e[0]);this._invokeAll(function(s){s.afterParse&&s.afterParse(e)})}_invokeAll(e){for(let t=0,i=this.plugins.length;t<i;t++)e(this.plugins[t])}}class Bee{constructor(e){this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,t){if(!e.isLight)return;if(!e.isDirectionalLight&&!e.isPointLight&&!e.isSpotLight){console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e);return}const i=this.writer,s=i.json,r=i.extensionsUsed,o={};e.name&&(o.name=e.name),o.color=e.color.toArray(),o.intensity=e.intensity,e.isDirectionalLight?o.type="directional":e.isPointLight?(o.type="point",e.distance>0&&(o.range=e.distance)):e.isSpotLight&&(o.type="spot",e.distance>0&&(o.range=e.distance),o.spot={},o.spot.innerConeAngle=(e.penumbra-1)*e.angle*-1,o.spot.outerConeAngle=e.angle),e.decay!==void 0&&e.decay!==2&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),e.target&&(e.target.parent!==e||e.target.position.x!==0||e.target.position.y!==0||e.target.position.z!==-1)&&console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),r[this.name]||(s.extensions=s.extensions||{},s.extensions[this.name]={lights:[]},r[this.name]=!0);const a=s.extensions[this.name].lights;a.push(o),t.extensions=t.extensions||{},t.extensions[this.name]={light:a.length-1}}}class Dee{constructor(e){this.writer=e,this.name="KHR_materials_unlit"}writeMaterial(e,t){if(!e.isMeshBasicMaterial)return;const s=this.writer.extensionsUsed;t.extensions=t.extensions||{},t.extensions[this.name]={},s[this.name]=!0,t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9}}class Oee{constructor(e){this.writer=e,this.name="KHR_materials_clearcoat"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.clearcoat===0)return;const i=this.writer,s=i.extensionsUsed,r={};if(r.clearcoatFactor=e.clearcoat,e.clearcoatMap){const o={index:i.processTexture(e.clearcoatMap),texCoord:e.clearcoatMap.channel};i.applyTextureTransform(o,e.clearcoatMap),r.clearcoatTexture=o}if(r.clearcoatRoughnessFactor=e.clearcoatRoughness,e.clearcoatRoughnessMap){const o={index:i.processTexture(e.clearcoatRoughnessMap),texCoord:e.clearcoatRoughnessMap.channel};i.applyTextureTransform(o,e.clearcoatRoughnessMap),r.clearcoatRoughnessTexture=o}if(e.clearcoatNormalMap){const o={index:i.processTexture(e.clearcoatNormalMap),texCoord:e.clearcoatNormalMap.channel};i.applyTextureTransform(o,e.clearcoatNormalMap),r.clearcoatNormalTexture=o}t.extensions=t.extensions||{},t.extensions[this.name]=r,s[this.name]=!0}}class kee{constructor(e){this.writer=e,this.name="KHR_materials_iridescence"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.iridescence===0)return;const i=this.writer,s=i.extensionsUsed,r={};if(r.iridescenceFactor=e.iridescence,e.iridescenceMap){const o={index:i.processTexture(e.iridescenceMap),texCoord:e.iridescenceMap.channel};i.applyTextureTransform(o,e.iridescenceMap),r.iridescenceTexture=o}if(r.iridescenceIor=e.iridescenceIOR,r.iridescenceThicknessMinimum=e.iridescenceThicknessRange[0],r.iridescenceThicknessMaximum=e.iridescenceThicknessRange[1],e.iridescenceThicknessMap){const o={index:i.processTexture(e.iridescenceThicknessMap),texCoord:e.iridescenceThicknessMap.channel};i.applyTextureTransform(o,e.iridescenceThicknessMap),r.iridescenceThicknessTexture=o}t.extensions=t.extensions||{},t.extensions[this.name]=r,s[this.name]=!0}}class Lee{constructor(e){this.writer=e,this.name="KHR_materials_transmission"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const i=this.writer,s=i.extensionsUsed,r={};if(r.transmissionFactor=e.transmission,e.transmissionMap){const o={index:i.processTexture(e.transmissionMap),texCoord:e.transmissionMap.channel};i.applyTextureTransform(o,e.transmissionMap),r.transmissionTexture=o}t.extensions=t.extensions||{},t.extensions[this.name]=r,s[this.name]=!0}}class Fee{constructor(e){this.writer=e,this.name="KHR_materials_volume"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const i=this.writer,s=i.extensionsUsed,r={};if(r.thicknessFactor=e.thickness,e.thicknessMap){const o={index:i.processTexture(e.thicknessMap),texCoord:e.thicknessMap.channel};i.applyTextureTransform(o,e.thicknessMap),r.thicknessTexture=o}r.attenuationDistance=e.attenuationDistance,r.attenuationColor=e.attenuationColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=r,s[this.name]=!0}}class Uee{constructor(e){this.writer=e,this.name="KHR_materials_ior"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.ior===1.5)return;const s=this.writer.extensionsUsed,r={};r.ior=e.ior,t.extensions=t.extensions||{},t.extensions[this.name]=r,s[this.name]=!0}}class Nee{constructor(e){this.writer=e,this.name="KHR_materials_specular"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.specularIntensity===1&&e.specularColor.equals(wee)&&!e.specularIntensityMap&&!e.specularColorTexture)return;const i=this.writer,s=i.extensionsUsed,r={};if(e.specularIntensityMap){const o={index:i.processTexture(e.specularIntensityMap),texCoord:e.specularIntensityMap.channel};i.applyTextureTransform(o,e.specularIntensityMap),r.specularTexture=o}if(e.specularColorMap){const o={index:i.processTexture(e.specularColorMap),texCoord:e.specularColorMap.channel};i.applyTextureTransform(o,e.specularColorMap),r.specularColorTexture=o}r.specularFactor=e.specularIntensity,r.specularColorFactor=e.specularColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=r,s[this.name]=!0}}class zee{constructor(e){this.writer=e,this.name="KHR_materials_sheen"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.sheen==0)return;const i=this.writer,s=i.extensionsUsed,r={};if(e.sheenRoughnessMap){const o={index:i.processTexture(e.sheenRoughnessMap),texCoord:e.sheenRoughnessMap.channel};i.applyTextureTransform(o,e.sheenRoughnessMap),r.sheenRoughnessTexture=o}if(e.sheenColorMap){const o={index:i.processTexture(e.sheenColorMap),texCoord:e.sheenColorMap.channel};i.applyTextureTransform(o,e.sheenColorMap),r.sheenColorTexture=o}r.sheenRoughnessFactor=e.sheenRoughness,r.sheenColorFactor=e.sheenColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=r,s[this.name]=!0}}class Gee{constructor(e){this.writer=e,this.name="KHR_materials_anisotropy"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.anisotropy==0)return;const i=this.writer,s=i.extensionsUsed,r={};if(e.anisotropyMap){const o={index:i.processTexture(e.anisotropyMap)};i.applyTextureTransform(o,e.anisotropyMap),r.anisotropyTexture=o}r.anisotropyStrength=e.anisotropy,r.anisotropyRotation=e.anisotropyRotation,t.extensions=t.extensions||{},t.extensions[this.name]=r,s[this.name]=!0}}class Vee{constructor(e){this.writer=e,this.name="KHR_materials_emissive_strength"}writeMaterial(e,t){if(!e.isMeshStandardMaterial||e.emissiveIntensity===1)return;const s=this.writer.extensionsUsed,r={};r.emissiveStrength=e.emissiveIntensity,t.extensions=t.extensions||{},t.extensions[this.name]=r,s[this.name]=!0}}M1.Utils={insertKeyframe:function(n,e){const i=n.getValueSize(),s=new n.TimeBufferType(n.times.length+1),r=new n.ValueBufferType(n.values.length+i),o=n.createInterpolant(new n.ValueBufferType(i));let a;if(n.times.length===0){s[0]=e;for(let l=0;l<i;l++)r[l]=0;a=0}else if(e<n.times[0]){if(Math.abs(n.times[0]-e)<.001)return 0;s[0]=e,s.set(n.times,1),r.set(o.evaluate(e),0),r.set(n.values,i),a=0}else if(e>n.times[n.times.length-1]){if(Math.abs(n.times[n.times.length-1]-e)<.001)return n.times.length-1;s[s.length-1]=e,s.set(n.times,0),r.set(n.values,0),r.set(o.evaluate(e),n.values.length),a=s.length-1}else for(let l=0;l<n.times.length;l++){if(Math.abs(n.times[l]-e)<.001)return l;if(n.times[l]<e&&n.times[l+1]>e){s.set(n.times.slice(0,l+1),0),s[l+1]=e,s.set(n.times.slice(l+1),l+2),r.set(n.values.slice(0,(l+1)*i),0),r.set(o.evaluate(e),(l+1)*i),r.set(n.values.slice((l+1)*i),(l+2)*i),a=l+1;break}}return n.times=s,n.values=r,a},mergeMorphTargetTracks:function(n,e){const t=[],i={},s=n.tracks;for(let r=0;r<s.length;++r){let o=s[r];const a=kt.parseTrackName(o.name),l=kt.findNode(e,a.nodeName);if(a.propertyName!=="morphTargetInfluences"||a.propertyIndex===void 0){t.push(o);continue}if(o.createInterpolant!==o.InterpolantFactoryMethodDiscrete&&o.createInterpolant!==o.InterpolantFactoryMethodLinear){if(o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),o=o.clone(),o.setInterpolation(Jc)}const c=l.morphTargetInfluences.length,u=l.morphTargetDictionary[a.propertyIndex];if(u===void 0)throw new Error("THREE.GLTFExporter: Morph target name not found: "+a.propertyIndex);let d;if(i[l.uuid]===void 0){d=o.clone();const p=new d.ValueBufferType(c*d.times.length);for(let g=0;g<d.times.length;g++)p[g*c+u]=d.values[g];d.name=(a.nodeName||"")+".morphTargetInfluences",d.values=p,i[l.uuid]=d,t.push(d);continue}const f=o.createInterpolant(new o.ValueBufferType(1));d=i[l.uuid];for(let p=0;p<d.times.length;p++)d.values[p*c+u]=f.evaluate(d.times[p]);for(let p=0;p<o.times.length;p++){const g=this.insertKeyframe(d,o.times[p]);d.values[g*c+u]=o.values[p]}}return n.tracks=t,n}};class Hee{constructor(e){this.writer=e,this.name="EXT_mesh_gpu_instancing"}writeNode(e,t){if(e.constructor.name!=="InstancedMesh")return;const i=this.writer,s=i.extensionsUsed,r={};t.extensions=t.extensions||{},t.extensions[this.name]=r;let o=new Ie;const a=new Array,l=new Array,c=new Array;for(let p=0;p<e.count;p++){e.getMatrixAt(p,o);let g=new w,A=new Se,v=new w;o.decompose(g,A,v),a.push(g.x,g.y,g.z),l.push(A.x,A.y,A.z,A.w),c.push(v.x,v.y,v.z)}const u=new Float32Array(a),d=new Float32Array(l),f=new Float32Array(c);r.attributes={TRANSLATION:i.processAccessor(new ot(u,3)),ROTATION:i.processAccessor(new ot(d,4)),SCALE:i.processAccessor(new ot(f,3))},s[this.name]=!0}}var s3=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const cy=re("debuggltfexport");class r3 extends zo{constructor(){super(...arguments);h(this,"sceneRoot")}start(){this.startCoroutine(this.updateGltfBox())}*updateGltfBox(){for(;;)for(let t=0;t<10;t++)yield}}class Ia extends Te{constructor(){super(...arguments);h(this,"binary",!0);h(this,"objects",[]);h(this,"exporter");h(this,"ext")}async exportNow(t){cy&&console.log("Exporting objects as glTF",this.objects),t||(t="scene"),(!this.objects||this.objects.length<=0)&&(this.objects=[this.context.scene]);const i={binary:this.binary,pivot:Ia.calculateCenter(this.objects)},s=await this.export(this.objects,i);this.binary?t.endsWith(".glb")||(t+=".glb"):t.endsWith(".gltf")||(t+=".gltf"),this.binary?Ia.saveArrayBuffer(s,t):Ia.saveJson(s,t)}async export(t,i){if(!t||t.length<=0){console.warn("No objects set to export");return}this.exporter||(this.exporter=new M1,this.exporter.register(l=>new Hee(l)),this.ext=new QF,this.ext.registerExport(this.exporter)),Ia.filterTopmostParent(t);const s={trs:!1,onlyVisible:!0,truncateDrawRange:!1,binary:(i==null?void 0:i.binary)??!0,maxTextureSize:1/0,embedImages:!0,includeCustomExtensions:!0,animations:Ia.collectAnimations(t)},r=new Me;i!=null&&i.pivot&&r.position.sub(i.pivot),cy&&console.log("EXPORT",t),t.forEach(l=>{l&&(r.children.push(l),l.matrixAutoUpdate=!1,l.matrix.copy(l.matrixWorld),ne.getComponentsInChildren(l,Ci).forEach(c=>{ne.isActiveInHierarchy(c.gameObject)&&c.setInstancingEnabled(!1)}))});const o=new R2(r);return this.ext.context=o,new Promise((l,c)=>{var u;cy&&console.log("Starting glTF export.");try{(u=this.exporter)==null||u.parse(r,d=>{a(),l(d)},d=>{a(),c(d)},s)}catch(d){console.error(d),c(d)}finally{cy&&console.log("Finished glTF export.")}});function a(){t.forEach(l=>{l&&(l.matrixAutoUpdate=!0,ne.getComponentsInChildren(l,Ci).forEach(c=>{ne.isActiveInHierarchy(c.gameObject)&&c.setInstancingEnabled(!1)}))})}}static saveArrayBuffer(t,i){this.save(new Blob([t],{type:"application/octet-stream"}),i)}static saveJson(t,i){this.save("data: text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(t)),i)}static save(t,i){const s=document.createElement("a");s.style.display="none",document.body.appendChild(s),typeof t=="string"?s.href=t:s.href=URL.createObjectURL(t),s.download=i,s.click(),s.remove()}static collectAnimations(t,i){i=i||[];for(const s of t)s&&s.traverseVisible(r=>{r.animations&&r.animations.length>0&&i.push(...r.animations)});return i}static calculateCenter(t,i){const s=i||new w;return s.set(0,0,0),t.forEach(r=>{s.add(Mt(r))}),console.log(s),s.divideScalar(t.length),s}static filterTopmostParent(t){if(!(t.length<=0))for(let i=0;i<t.length;i++){let s=t[i];if(!s){t.splice(i,1),i--;continue}for(;s.parent;){if(t.includes(s.parent)){t.splice(i,1),i--;break}s=s.parent}}}}s3([x()],Ia.prototype,"binary",void 0);s3([x(Me)],Ia.prototype,"objects",void 0);var T1=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};class RA extends Te{constructor(){super(...arguments);h(this,"isGizmo",!1);h(this,"color0");h(this,"color1");h(this,"gridHelper");h(this,"size");h(this,"divisions");h(this,"offset")}onEnable(){if(this.isGizmo&&!oA)return;const t=this.size,i=this.divisions;this.gridHelper||(this.gridHelper=new OM(t,i,this.color0??new _e(.4,.4,.4),this.color1??new _e(.6,.6,.6)),this.offset!==void 0&&(this.gridHelper.position.y+=this.offset)),this.gridHelper&&this.gameObject.add(this.gridHelper)}onDisable(){this.gridHelper&&(this.gameObject.remove(this.gridHelper),this.gridHelper=null)}}T1([x()],RA.prototype,"isGizmo",void 0);T1([x(_e)],RA.prototype,"color0",void 0);T1([x(_e)],RA.prototype,"color1",void 0);var Z_=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const Qee=re("debuggroundprojection");class mp extends Te{constructor(){super(...arguments);h(this,"applyOnAwake",!1);h(this,"_scale",20);h(this,"_radius",100);h(this,"_height",100);h(this,"_lastEnvironment");h(this,"env");h(this,"_watcher")}set scale(t){var i;this._scale=t,(i=this.env)==null||i.scale.setScalar(t)}get scale(){return this._scale}set radius(t){this._radius=t,this.env&&(this.env.radius=t)}get radius(){return this._radius}set height(t){this._height=t,this.env&&(this.env.height=t)}get height(){return this._height}awake(){this.applyOnAwake&&this.updateAndCreate()}onEnable(){this.context.time.frameCount>0&&this.applyOnAwake&&this.updateAndCreate(),this._watcher||(this._watcher=new Uc(this.context.scene,"environment"),this._watcher.subscribeWrite(t=>{this.updateProjection()}))}onDisable(){var t,i;(t=this._watcher)==null||t.revoke(),(i=this.env)==null||i.removeFromParent()}updateAndCreate(){var t;this.updateProjection(),(t=this._watcher)==null||t.apply()}updateProjection(){var t;if(!this.context.scene.environment){(t=this.env)==null||t.removeFromParent();return}(!this.env||this.context.scene.environment!==this._lastEnvironment)&&(Qee&&console.log("Create/Update Ground Projection",this.context.scene.environment.name),this.env=new kN(this.context.scene.environment)),this._lastEnvironment=this.context.scene.environment,this.env.parent||this.gameObject.add(this.env),this.env.scale.setScalar(this._scale),this.env.radius=this._radius,this.env.height=this._height,this.env.isObject3D===!0&&this.env.layers.set(2)}}Z_([x()],mp.prototype,"applyOnAwake",void 0);Z_([x()],mp.prototype,"scale",null);Z_([x()],mp.prototype,"radius",null);Z_([x()],mp.prototype,"height",null);var $_=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const kh=re("debuginputfield"),bt=class extends Te{constructor(){super(...arguments);h(this,"textComponent");h(this,"placeholder");h(this,"onValueChanged");h(this,"onEndEdit");h(this,"inputEventFn");h(this,"_iosEventFn")}get text(){var t;return((t=this.textComponent)==null?void 0:t.text)??""}get isFocused(){return bt.active===this}start(){kh&&console.log(this.name,this)}onEnable(){var t;bt.htmlField||(bt.htmlField=document.createElement("input"),bt.htmlField.style.width="0px",bt.htmlField.style.height="0px",bt.htmlField.style.padding="0px",bt.htmlField.style.border="none",bt.htmlField.style.overflow="hidden",bt.htmlField.style.caretColor="transparent",bt.htmlField.style.outline="none",bt.htmlField.classList.add("ar"),document.body.append(bt.htmlField)),this.inputEventFn||(this.inputEventFn=this.onInput.bind(this)),bt.htmlField.addEventListener("keyup",this.inputEventFn),this.placeholder&&((t=this.textComponent)!=null&&t.text.length)&&ne.setActive(this.placeholder.gameObject,!1),hC()&&(this._iosEventFn=this.processInputOniOS.bind(this),window.addEventListener("touchend",this._iosEventFn))}onDisable(){var t;(t=bt.htmlField)==null||t.removeEventListener("keyup",this.inputEventFn),this.onDeselected(),this._iosEventFn&&window.removeEventListener("touchend",this._iosEventFn)}clear(){bt.active===this&&bt.htmlField?(bt.htmlField.value="",this.setTextFromInputField()):(this.textComponent&&(this.textComponent.text=""),this.placeholder&&ne.setActive(this.placeholder.gameObject,!0))}select(){this.onSelected()}deselect(){this.onDeselected()}onPointerClick(t){kh&&console.log("CLICK",t,bt.active),bt.activeTime=this.context.time.time,bt.active!==this&&this.startCoroutine(this.activeLoop(),li.LateUpdate),this.selectInputField()}*activeLoop(){for(this.onSelected();bt.active===this&&!(this.context.input.getPointerUp(0)&&this.context.time.time-bt.activeTime>.2);)this.setTextFromInputField(),yield;this.onDeselected()}onSelected(){var t,i,s,r;if(bt.active!==this&&(kh&&console.log("Select",this.name,this,bt.htmlField,this.context.isInXR,this.context.arOverlayElement,(t=this.textComponent)==null?void 0:t.text,(i=bt.htmlField)==null?void 0:i.value),(s=bt.active)==null||s.onDeselected(),bt.active=this,this.placeholder&&ne.setActive(this.placeholder.gameObject,!1),bt.htmlField)){if(bt.htmlField.value=((r=this.textComponent)==null?void 0:r.text)||"",kh&&console.log("set input field value",bt.htmlField.value),this.context.isInXR){const o=this.context.arOverlayElement;o&&o.append(bt.htmlField)}this.selectInputField()}}onDeselected(){var t;bt.active===this&&(bt.active=null,kh&&console.log("Deselect",this.name,this),bt.htmlField&&(bt.htmlField.blur(),document.body.append(bt.htmlField)),this.placeholder&&(!this.textComponent||this.textComponent.text.length<=0)&&ne.setActive(this.placeholder.gameObject,!0),bt.htmlField&&((t=this.onEndEdit)==null||t.invoke(bt.htmlField.value)))}update(){var t;bt.active===this&&((t=this.textComponent)==null||t.markDirty())}onInput(t){var i,s;if(bt.active===this){if(kh&&console.log(t.code,t,(i=bt.htmlField)==null?void 0:i.value,(s=this.textComponent)==null?void 0:s.text),t.code==="Escape"||t.code==="Enter"){this.onDeselected();return}bt.htmlField&&(this.textComponent&&(this.setTextFromInputField(),this.placeholder&&ne.setActive(this.placeholder.gameObject,this.textComponent.text.length<=0)),this.selectInputField())}}setTextFromInputField(){var t;if(this.textComponent&&bt.htmlField){if(this.textComponent.text!==bt.htmlField.value){kh&&console.log("VALUE CHANGED");const i=this.textComponent.text,s=bt.htmlField.value;(t=this.onValueChanged)==null||t.invoke(s,i)}this.textComponent.text=bt.htmlField.value}}selectInputField(){bt.htmlField&&(bt.htmlField.setSelectionRange(bt.htmlField.value.length,bt.htmlField.value.length),bt.htmlField.focus())}processInputOniOS(){const t=this.context.physics.raycast();if(!t.length)return;const s=t[0].object,r=I_(s);((r==null?void 0:r.gameObject)===this.gameObject||(r==null?void 0:r.gameObject.parent)===this.gameObject)&&this.selectInputField()}};let Go=bt;h(Go,"active",null),h(Go,"activeTime",-1),h(Go,"htmlField",null);$_([x($s)],Go.prototype,"textComponent",void 0);$_([x($s)],Go.prototype,"placeholder",void 0);$_([x(qn)],Go.prototype,"onValueChanged",void 0);$_([x(qn)],Go.prototype,"onEndEdit",void 0);var Ya=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};function cS(n){return n*Math.PI/180}const RD=300,Ac=re("debuglights");var pl;(function(n){n[n.Spot=0]="Spot",n[n.Directional=1]="Directional",n[n.Point=2]="Point",n[n.Area=3]="Area",n[n.Rectangle=3]="Rectangle",n[n.Disc=4]="Disc"})(pl||(pl={}));var Y0;(function(n){n[n.Realtime=4]="Realtime",n[n.Baked=2]="Baked",n[n.Mixed=1]="Mixed"})(Y0||(Y0={}));var Xg;(function(n){n[n.None=0]="None",n[n.Hard=1]="Hard",n[n.Soft=2]="Soft"})(Xg||(Xg={}));class jr extends Te{constructor(){super(...arguments);h(this,"type",0);h(this,"range",1);h(this,"spotAngle",1);h(this,"innerSpotAngle",1);h(this,"_color",new _e(16777215));h(this,"_shadowNearPlane",.1);h(this,"_shadowBias",0);h(this,"_shadowNormalBias",0);h(this,"_overrideShadowBiasSettings",!1);h(this,"_shadows",1);h(this,"lightmapBakeType",Y0.Realtime);h(this,"_intensity",-1);h(this,"_shadowDistance");h(this,"shadowWidth");h(this,"shadowHeight");h(this,"_shadowResolution");h(this,"light");h(this,"_webXRStartedListener");h(this,"_webXREndedListener");h(this,"_webARRoot")}set color(t){this._color=t,this.light!==void 0&&(this.light.color=t)}get color(){return this.light?this.light.color:this._color}set shadowNearPlane(t){var i,s;if(t!==this._shadowNearPlane&&(this._shadowNearPlane=t,((s=(i=this.light)==null?void 0:i.shadow)==null?void 0:s.camera)!==void 0)){const r=this.light.shadow.camera;r.near=t}}get shadowNearPlane(){return this._shadowNearPlane}set shadowBias(t){var i,s;t!==this._shadowBias&&(this._shadowBias=t,((s=(i=this.light)==null?void 0:i.shadow)==null?void 0:s.bias)!==void 0&&(this.light.shadow.bias=t,this.light.shadow.needsUpdate=!0))}get shadowBias(){return this._shadowBias}set shadowNormalBias(t){var i,s;t!==this._shadowNormalBias&&(this._shadowNormalBias=t,((s=(i=this.light)==null?void 0:i.shadow)==null?void 0:s.normalBias)!==void 0&&(this.light.shadow.normalBias=t,this.light.shadow.needsUpdate=!0))}get shadowNormalBias(){return this._shadowNormalBias}set shadows(t){this._shadows=t,this.light&&(this.light.castShadow=t!==Xg.None,this.updateShadowSoftHard())}get shadows(){return this._shadows}set intensity(t){var i;if(this._intensity=t,this.light){let s=1;if(this.context.isInXR&&this._webARRoot){const r=(i=this._webARRoot)==null?void 0:i.arScale;typeof r=="number"&&r>0&&(s/=r)}this.light.intensity=t*s}Ac&&console.log("Set light intensity to "+this._intensity,t,this)}get intensity(){return this._intensity}get shadowDistance(){const t=this.light;return t!=null&&t.shadow?t.shadow.camera.far:-1}set shadowDistance(t){this._shadowDistance=t;const i=this.light;if(i!=null&&i.shadow){const s=i.shadow.camera;s.far=t,s.updateProjectionMatrix()}}get shadowResolution(){const t=this.light;return t!=null&&t.shadow?t.shadow.mapSize.x:-1}set shadowResolution(t){if(t===this._shadowResolution)return;this._shadowResolution=t;const i=this.light;i!=null&&i.shadow&&(i.shadow.mapSize.set(t,t),i.shadow.needsUpdate=!0)}get isBaked(){return this.lightmapBakeType===Y0.Baked}get selfIsLight(){if(this.gameObject.isLight===!0)return!0;switch(this.gameObject.type){case"SpotLight":case"PointLight":case"DirectionalLight":return!0}return!1}getWorldPosition(t){return this.light?this.type===pl.Directional?this.light.getWorldPosition(t).multiplyScalar(1):this.light.getWorldPosition(t):t}awake(){this.color=new _e(this.color??16777215),Ac&&console.log(this.name,this)}onEnable(){Ac&&console.log("ENABLE LIGHT",this.name),this.createLight(),!this.isBaked&&(this.light&&(this.light.visible=!0,this.light.intensity=this._intensity,Ac&&console.log("Set light intensity to "+this.light.intensity,this.name),this.selfIsLight||this.light.parent!==this.gameObject&&this.gameObject.add(this.light)),this.type===pl.Directional&&this.startCoroutine(this.updateMainLightRoutine(),li.LateUpdate),this._webXRStartedListener=vt.addEventListener(ii.XRStarted,this.onWebXRStarted.bind(this)),this._webXREndedListener=vt.addEventListener(ii.XRStopped,this.onWebXREnded.bind(this)))}onDisable(){Ac&&console.log("DISABLE LIGHT",this.name),this.light&&(this.selfIsLight?this.light.intensity=0:this.light.visible=!1),vt.removeEventListener(ii.XRStarted,this._webXRStartedListener),vt.removeEventListener(ii.XRStopped,this._webXREndedListener)}onWebXRStarted(){this._webARRoot=ne.getComponentInParent(this.gameObject,Ha)??void 0}onWebXREnded(){}createLight(){const t=this.selfIsLight;if(t&&!this.light)switch(this.light=this.gameObject,this.light.name=this.name,this._intensity=this.light.intensity,this.type){case pl.Directional:this.setDirectionalLight(this.light);break}else if(!this.light)switch(this.type){case pl.Directional:const i=new Jb(this.color,this.intensity*Math.PI);if(i.position.set(0,0,-RD*.5).applyQuaternion(this.gameObject.quaternion),this.gameObject.add(i.target),c0(i.target,0,0,0),this.light=i,this.gameObject.position.set(0,0,0),this.gameObject.rotation.set(0,0,0),Ac){const a=new vL(this.light,.2,this.color);this.context.scene.add(a)}break;case pl.Spot:const s=new Xb(this.color,this.intensity*Math.PI,this.range,cS(this.spotAngle/2),1-cS(this.innerSpotAngle/2)/cS(this.spotAngle/2),2);s.position.set(0,0,0),s.rotation.set(0,0,0),this.light=s;const r=s.target;s.add(r),r.position.set(0,0,this.range),r.rotation.set(0,0,0);break;case pl.Point:const o=new Yb(this.color,this.intensity*Math.PI,this.range);this.light=o;break}if(this.light){if(this._intensity>=0?this.light.intensity=this._intensity:this._intensity=this.light.intensity,this.shadows!==Xg.None?this.light.castShadow=!0:this.light.castShadow=!1,this.light.shadow){this._shadowResolution!==void 0&&this._shadowResolution>4?(this.light.shadow.mapSize.width=this._shadowResolution,this.light.shadow.mapSize.height=this._shadowResolution):(this.light.shadow.mapSize.width=2048,this.light.shadow.mapSize.height=2048),Ac&&console.log("Override shadow bias?",this._overrideShadowBiasSettings,this.shadowBias,this.shadowNormalBias),this.light.shadow.bias=this.shadowBias,this.light.shadow.normalBias=this.shadowNormalBias,this.updateShadowSoftHard();const i=this.light.shadow.camera;if(i.near=this.shadowNearPlane,this._shadowDistance!==void 0&&typeof this._shadowDistance=="number"?i.far=this._shadowDistance:i.far=RD*Math.abs(this.gameObject.scale.z),this.gameObject.scale.set(1,1,1),this.shadowWidth!==void 0)i.left=-this.shadowWidth/2,i.right=this.shadowWidth/2;else{const s=this.gameObject.scale.x;i.left*=s,i.right*=s}if(this.shadowHeight!==void 0)i.top=this.shadowHeight/2,i.bottom=-this.shadowHeight/2;else{const s=this.gameObject.scale.y;i.top*=s,i.bottom*=s}this.light.shadow.needsUpdate=!0,Ac&&this.context.scene.add(new yL(i))}this.isBaked?this.light.removeFromParent():t||this.gameObject.add(this.light)}}*updateMainLightRoutine(){for(;;){this.type===pl.Directional&&((!this.context.mainLight||this.intensity>this.context.mainLight.intensity)&&(this.context.mainLight=this),yield);break}}updateShadowSoftHard(){this.light&&this.light.shadow&&(this.shadows===Xg.Soft||(this.light.shadow.radius=1,this.light.shadow.blurSamples=1))}setDirectionalLight(t){t.add(t.target),t.target.position.set(0,0,-1)}}h(jr,"allowChangingRendererShadowMapType",!0);Ya([x()],jr.prototype,"type",void 0);Ya([x(_e)],jr.prototype,"color",null);Ya([x()],jr.prototype,"shadowNearPlane",null);Ya([x()],jr.prototype,"shadowBias",null);Ya([x()],jr.prototype,"shadowNormalBias",null);Ya([x()],jr.prototype,"shadows",null);Ya([x()],jr.prototype,"lightmapBakeType",void 0);Ya([x()],jr.prototype,"intensity",null);Ya([x()],jr.prototype,"shadowDistance",null);Ya([x()],jr.prototype,"shadowResolution",null);new w(0,0,0);var PA=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const hS=re("debuglods"),Wee=re("nolods");var xE;(function(n){n[n.None=0]="None",n[n.CrossFade=1]="CrossFade",n[n.SpeedTree=2]="SpeedTree"})(xE||(xE={}));class Ap{constructor(){h(this,"screenRelativeTransitionHeight");h(this,"distance");h(this,"renderers")}}PA([x()],Ap.prototype,"screenRelativeTransitionHeight",void 0);PA([x()],Ap.prototype,"distance",void 0);PA([x(Ci)],Ap.prototype,"renderers",void 0);class jee{constructor(e){h(this,"model");this.model=e}get renderers(){return this.model.renderers}}class ex extends Te{constructor(){super(...arguments);h(this,"fadeMode",xE.None);h(this,"localReferencePoint");h(this,"lodCount",0);h(this,"size",0);h(this,"animateCrossFading",!1);h(this,"lodModels");h(this,"_lods",[]);h(this,"_settings",[]);h(this,"_lodsHandler");h(this,"_distanceFactor",1)}start(){if(hS&&console.log("LODGROUP",this.name,this.lodModels,this),!Wee&&!this._lodsHandler&&this.gameObject&&this.lodModels&&Array.isArray(this.lodModels)){const t=[];for(const s of this.lodModels){const r=new jee(s);this._lods.push(r);for(const o of r.renderers)t.includes(o)||t.push(o)}this._lodsHandler=new Array;for(let s=0;s<t.length;s++){const r=new cM;this._lodsHandler.push(r),this.gameObject.add(r)}const i=new Me;i.name="Cull "+this.name;for(let s=0;s<t.length;s++){const r=t[s],o=this._lodsHandler[s],a=r.gameObject;hS&&console.log(s,a.name);for(const l of this._lods){const c=l.model.distance;let u=null;if(l.renderers.includes(r)?u=a:u=i,u.type==="Group"){console.warn(`LODGroup ${this.name}: Group or MultiMaterial object's are not supported as LOD object: ${u.name}`);continue}hS&&console.log("LEVEL",u.name,c),this.onAddLodLevel(o,u,l.model.distance)}}}}update(){if(!this.gameObject||!this._lodsHandler)return;const t=this.context.mainCamera;if(t)for(const i of this._lodsHandler)i.update(t)}onAddLodLevel(t,i,s){if(i===this.gameObject){console.warn("LODGroup component must be on parent object and not mesh directly at the moment",i.name,i);return}t.addLevel(i,s*this._distanceFactor,.01);const r={lod:t,levelIndex:t.levels.length-1,distance:s};this._settings.push(r)}distanceFactor(t){if(t!==this._distanceFactor){this._distanceFactor=t;for(const i of this._settings){const s=i.lod.levels[i.levelIndex];s.distance=i.distance*t}}}}PA([x(w)],ex.prototype,"localReferencePoint",void 0);PA([x(Ap)],ex.prototype,"lodModels",void 0);const qee=re("logstats");class o3 extends Te{onEnable(){console.log(this),qee&&this.startCoroutine(this.run(),li.OnAfterRender)}*run(){for(;this.enabled;){const e=this.context.renderer.info;console.log(e.memory,e.render,e.programs),yield}}}var tx=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const aI=class extends Te{constructor(){super(...arguments);h(this,"target");h(this,"invertForward",!1);h(this,"keepUpDirection",!0);h(this,"copyTargetRotation",!1)}onBeforeRender(){let t=this.target;if(t||(t=this.context.mainCamera),!t)return;const i=Mt(t),s=Mt(this.gameObject);if(this.keepUpDirection&&(i.y=s.y),this.copyTargetRotation){if(_o(this.gameObject,Gr(t)),this.keepUpDirection){const r=s.sub(this.forward);this.gameObject.lookAt(r)}}else this.gameObject.lookAt(i);this.invertForward&&this.gameObject.quaternion.multiply(aI.flipYQuat)}createBehaviours(t,i,s){if(i.uuid===this.gameObject.uuid){let r=i;if(this.keepUpDirection){const a=Or.createEmptyParent(i);r=a;const l=this.invertForward?-1:1;a.matrix.multiply(new Ie().makeRotationZ(Math.PI/2*l)),i.matrix.multiply(new Ie().makeRotationZ(-Math.PI/2*l))}const o=new Cs("lookat "+this.name,Nr.sceneStartTrigger(),di.lookAtCameraAction(r,void 0,this.invertForward?Yd.back:Yd.forward,this.keepUpDirection?Yd.up:Yd.zero));t.addBehavior(o)}}};let Nl=aI;h(Nl,"flipYQuat",new Se().setFromAxisAngle(new w(0,1,0),Math.PI));tx([x(Me)],Nl.prototype,"target",void 0);tx([x()],Nl.prototype,"invertForward",void 0);tx([x()],Nl.prototype,"keepUpDirection",void 0);tx([x()],Nl.prototype,"copyTargetRotation",void 0);var Xee=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const hy=re("debugnestedgltf");class I1 extends Te{constructor(){super(...arguments);h(this,"filePath");h(this,"_isLoadingOrDoneLoading",!1)}listenToProgress(t){var i;(i=this.filePath)==null||i.beginListenDownload(t)}preload(){var t;(t=this.filePath)==null||t.preload()}async start(){var i,s,r,o,a;if(this._isLoadingOrDoneLoading)return;hy&&console.log(this,this.guid);const t=this.gameObject.parent;if(t){this._isLoadingOrDoneLoading=!0;const l=new Hl;l.idProvider=new Ws(this.hash(this.guid)),l.parent=t,this.gameObject.updateMatrix();const c=this.gameObject.matrix;hy&&console.log("Load nested:",((i=this.filePath)==null?void 0:i.uri)??this.filePath,this.gameObject.position);const u=await((r=(s=this.filePath)==null?void 0:s.instantiate)==null?void 0:r.call(this.filePath,l));hy&&console.log("Nested loaded:",((o=this.filePath)==null?void 0:o.uri)??this.filePath,u),u&&(u.matrixAutoUpdate=!1,u.matrix.identity(),u.applyMatrix4(c),u.matrixAutoUpdate=!0,u.layers.disableAll(),u.layers.set(this.layer),this.dispatchEvent(new CustomEvent("loaded",{detail:{instance:u,assetReference:this.filePath}}))),hy&&console.log("Nested loading done:",((a=this.filePath)==null?void 0:a.uri)??this.filePath,u)}}onDestroy(){var t;(t=this.filePath)==null||t.unload()}hash(t){let i=0;for(let s=0;s<t.length;s++)i=t.charCodeAt(s)+((i<<5)-i);return i}}Xee([x(wn)],I1.prototype,"filePath",void 0);var ix=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};class vp extends Te{constructor(){super(...arguments);h(this,"referenceSpace");h(this,"from");h(this,"affectPosition",!1);h(this,"affectRotation",!1);h(this,"alignLookDirection",!1);h(this,"levelLookDirection",!1);h(this,"levelPosition",!1);h(this,"positionOffset",new w(0,0,0));h(this,"rotationOffset",new w(0,0,0));h(this,"offset",new w(0,0,0))}update(){if(!this.from)return;var t=Mt(this.from),i=Gr(this.from);this.offset.copy(this.positionOffset);const s=this.offset.length();if(this.referenceSpace&&this.offset.transformDirection(this.referenceSpace.matrixWorld).multiplyScalar(s),t.add(this.offset),this.levelPosition&&this.referenceSpace){const l=new Ir(this.gameObject.up,0),c=Mt(this.referenceSpace);l.setFromNormalAndCoplanarPoint(this.gameObject.up,c);const u=new w(0,0,0);l.projectPoint(t,u),t.copy(u)}this.affectPosition&&On(this.gameObject,t);const r=new pn(this.rotationOffset.x,this.rotationOffset.y,this.rotationOffset.z),o=new Se().setFromEuler(r);this.affectRotation&&_o(this.gameObject,i.multiply(o));const a=new w;this.from.getWorldDirection(a).multiplyScalar(50),this.levelLookDirection&&(a.y=0),this.alignLookDirection&&this.gameObject.lookAt(a)}}ix([x(ne)],vp.prototype,"referenceSpace",void 0);ix([x(ne)],vp.prototype,"from",void 0);ix([x(w)],vp.prototype,"positionOffset",void 0);ix([x(w)],vp.prototype,"rotationOffset",void 0);var R1=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r},Kh;(function(n){n[n.NewTab=0]="NewTab",n[n.SameTab=1]="SameTab",n[n.NewWindow=2]="NewWindow"})(Kh||(Kh={}));class BA extends Te{constructor(){super(...arguments);h(this,"clickable",!0);h(this,"url");h(this,"mode",Kh.NewTab);h(this,"_safariNewTabWorkaround",()=>{var s,r;if(!this.clickable||!((s=this.url)!=null&&s.length)||this.mode===Kh.SameTab)return;const t=this.gameObject.getComponentInParent(yA);if(t){const o=t.performRaycast();if(!o)return;for(const a of o)if(a.object===this.gameObject||((r=I_(a.object))==null?void 0:r.gameObject)===this.gameObject){this._validateUrl();var i=document.createElement("a");i.setAttribute("target","_blank"),i.setAttribute("href",this.url),i.click();break}}})}async open(){if(!this.url){console.warn("OpenURL: URL is not set, can't open.",this);return}switch(this._validateUrl(),si()&&bn("Open URL: "+this.url),this.mode){case Kh.NewTab:Wh()?globalThis.open(this.url,"_blank"):globalThis.open(this.url,"_blank");break;case Kh.SameTab:Wh()?globalThis.open(this.url,"_top"):globalThis.open(this.url,"_self");break;case Kh.NewWindow:Wh()?globalThis.open(this.url,"_top"):globalThis.open(this.url,"_new");break}}start(){this.gameObject.getComponentInParent(th)||this.gameObject.addNewComponent(th)}onEnable(){Wh()&&window.addEventListener("touchend",this._safariNewTabWorkaround)}onDisable(){Wh()&&window.removeEventListener("touchend",this._safariNewTabWorkaround)}onPointerEnter(t){!t.used&&this.clickable&&this.context.input.setCursorPointer()}onPointerExit(){this.clickable&&this.context.input.setCursorNormal()}onPointerClick(t){var i;this.clickable&&!t.used&&((i=this.url)!=null&&i.length)&&this.open()}_validateUrl(){this.url&&this.url.startsWith("www.")&&(si()&&console.warn("URL is not valid, adding https:// to the start of the URL",this.url),this.url="https://"+this.url)}}R1([x()],BA.prototype,"clickable",void 0);R1([x()],BA.prototype,"url",void 0);R1([x()],BA.prototype,"mode",void 0);function Yee(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var i,s,r,o,a=[],l=!0,c=!1;try{if(r=(t=t.call(n)).next,e===0){if(Object(t)!==t)return;l=!1}else for(;!(l=(i=r.call(t)).done)&&(a.push(i.value),a.length!==e);l=!0);}catch(u){c=!0,s=u}finally{try{if(!l&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(c)throw s}}return a}}function wE(){wE=function(){return e};var n,e={},t=Object.prototype,i=t.hasOwnProperty,s=Object.defineProperty||function(N,L,G){N[L]=G.value},r=typeof Symbol=="function"?Symbol:{},o=r.iterator||"@@iterator",a=r.asyncIterator||"@@asyncIterator",l=r.toStringTag||"@@toStringTag";function c(N,L,G){return Object.defineProperty(N,L,{value:G,enumerable:!0,configurable:!0,writable:!0}),N[L]}try{c({},"")}catch{c=function(L,G,ee){return L[G]=ee}}function u(N,L,G,ee){var $=L&&L.prototype instanceof m?L:m,j=Object.create($.prototype),ie=new H(ee||[]);return s(j,"_invoke",{value:T(N,G,ie)}),j}function d(N,L,G){try{return{type:"normal",arg:N.call(L,G)}}catch(ee){return{type:"throw",arg:ee}}}e.wrap=u;var f="suspendedStart",p="suspendedYield",g="executing",A="completed",v={};function m(){}function b(){}function y(){}var _={};c(_,o,function(){return this});var E=Object.getPrototypeOf,M=E&&E(E(Y([])));M&&M!==t&&i.call(M,o)&&(_=M);var I=y.prototype=m.prototype=Object.create(_);function R(N){["next","throw","return"].forEach(function(L){c(N,L,function(G){return this._invoke(L,G)})})}function C(N,L){function G($,j,ie,Ae){var ge=d(N[$],N,j);if(ge.type!=="throw"){var Ce=ge.arg,Ee=Ce.value;return Ee&&typeof Ee=="object"&&i.call(Ee,"__await")?L.resolve(Ee.__await).then(function(Ne){G("next",Ne,ie,Ae)},function(Ne){G("throw",Ne,ie,Ae)}):L.resolve(Ee).then(function(Ne){Ce.value=Ne,ie(Ce)},function(Ne){return G("throw",Ne,ie,Ae)})}Ae(ge.arg)}var ee;s(this,"_invoke",{value:function($,j){function ie(){return new L(function(Ae,ge){G($,j,Ae,ge)})}return ee=ee?ee.then(ie,ie):ie()}})}function T(N,L,G){var ee=f;return function($,j){if(ee===g)throw new Error("Generator is already running");if(ee===A){if($==="throw")throw j;return{value:n,done:!0}}for(G.method=$,G.arg=j;;){var ie=G.delegate;if(ie){var Ae=O(ie,G);if(Ae){if(Ae===v)continue;return Ae}}if(G.method==="next")G.sent=G._sent=G.arg;else if(G.method==="throw"){if(ee===f)throw ee=A,G.arg;G.dispatchException(G.arg)}else G.method==="return"&&G.abrupt("return",G.arg);ee=g;var ge=d(N,L,G);if(ge.type==="normal"){if(ee=G.done?A:p,ge.arg===v)continue;return{value:ge.arg,done:G.done}}ge.type==="throw"&&(ee=A,G.method="throw",G.arg=ge.arg)}}}function O(N,L){var G=L.method,ee=N.iterator[G];if(ee===n)return L.delegate=null,G==="throw"&&N.iterator.return&&(L.method="return",L.arg=n,O(N,L),L.method==="throw")||G!=="return"&&(L.method="throw",L.arg=new TypeError("The iterator does not provide a '"+G+"' method")),v;var $=d(ee,N.iterator,L.arg);if($.type==="throw")return L.method="throw",L.arg=$.arg,L.delegate=null,v;var j=$.arg;return j?j.done?(L[N.resultName]=j.value,L.next=N.nextLoc,L.method!=="return"&&(L.method="next",L.arg=n),L.delegate=null,v):j:(L.method="throw",L.arg=new TypeError("iterator result is not an object"),L.delegate=null,v)}function J(N){var L={tryLoc:N[0]};1 in N&&(L.catchLoc=N[1]),2 in N&&(L.finallyLoc=N[2],L.afterLoc=N[3]),this.tryEntries.push(L)}function V(N){var L=N.completion||{};L.type="normal",delete L.arg,N.completion=L}function H(N){this.tryEntries=[{tryLoc:"root"}],N.forEach(J,this),this.reset(!0)}function Y(N){if(N||N===""){var L=N[o];if(L)return L.call(N);if(typeof N.next=="function")return N;if(!isNaN(N.length)){var G=-1,ee=function $(){for(;++G<N.length;)if(i.call(N,G))return $.value=N[G],$.done=!1,$;return $.value=n,$.done=!0,$};return ee.next=ee}}throw new TypeError(typeof N+" is not iterable")}return b.prototype=y,s(I,"constructor",{value:y,configurable:!0}),s(y,"constructor",{value:b,configurable:!0}),b.displayName=c(y,l,"GeneratorFunction"),e.isGeneratorFunction=function(N){var L=typeof N=="function"&&N.constructor;return!!L&&(L===b||(L.displayName||L.name)==="GeneratorFunction")},e.mark=function(N){return Object.setPrototypeOf?Object.setPrototypeOf(N,y):(N.__proto__=y,c(N,l,"GeneratorFunction")),N.prototype=Object.create(I),N},e.awrap=function(N){return{__await:N}},R(C.prototype),c(C.prototype,a,function(){return this}),e.AsyncIterator=C,e.async=function(N,L,G,ee,$){$===void 0&&($=Promise);var j=new C(u(N,L,G,ee),$);return e.isGeneratorFunction(L)?j:j.next().then(function(ie){return ie.done?ie.value:j.next()})},R(I),c(I,l,"Generator"),c(I,o,function(){return this}),c(I,"toString",function(){return"[object Generator]"}),e.keys=function(N){var L=Object(N),G=[];for(var ee in L)G.push(ee);return G.reverse(),function $(){for(;G.length;){var j=G.pop();if(j in L)return $.value=j,$.done=!1,$}return $.done=!0,$}},e.values=Y,H.prototype={constructor:H,reset:function(N){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(V),!N)for(var L in this)L.charAt(0)==="t"&&i.call(this,L)&&!isNaN(+L.slice(1))&&(this[L]=n)},stop:function(){this.done=!0;var N=this.tryEntries[0].completion;if(N.type==="throw")throw N.arg;return this.rval},dispatchException:function(N){if(this.done)throw N;var L=this;function G(ge,Ce){return j.type="throw",j.arg=N,L.next=ge,Ce&&(L.method="next",L.arg=n),!!Ce}for(var ee=this.tryEntries.length-1;ee>=0;--ee){var $=this.tryEntries[ee],j=$.completion;if($.tryLoc==="root")return G("end");if($.tryLoc<=this.prev){var ie=i.call($,"catchLoc"),Ae=i.call($,"finallyLoc");if(ie&&Ae){if(this.prev<$.catchLoc)return G($.catchLoc,!0);if(this.prev<$.finallyLoc)return G($.finallyLoc)}else if(ie){if(this.prev<$.catchLoc)return G($.catchLoc,!0)}else{if(!Ae)throw new Error("try statement without catch or finally");if(this.prev<$.finallyLoc)return G($.finallyLoc)}}}},abrupt:function(N,L){for(var G=this.tryEntries.length-1;G>=0;--G){var ee=this.tryEntries[G];if(ee.tryLoc<=this.prev&&i.call(ee,"finallyLoc")&&this.prev<ee.finallyLoc){var $=ee;break}}$&&(N==="break"||N==="continue")&&$.tryLoc<=L&&L<=$.finallyLoc&&($=null);var j=$?$.completion:{};return j.type=N,j.arg=L,$?(this.method="next",this.next=$.finallyLoc,v):this.complete(j)},complete:function(N,L){if(N.type==="throw")throw N.arg;return N.type==="break"||N.type==="continue"?this.next=N.arg:N.type==="return"?(this.rval=this.arg=N.arg,this.method="return",this.next="end"):N.type==="normal"&&L&&(this.next=L),v},finish:function(N){for(var L=this.tryEntries.length-1;L>=0;--L){var G=this.tryEntries[L];if(G.finallyLoc===N)return this.complete(G.completion,G.afterLoc),V(G),v}},catch:function(N){for(var L=this.tryEntries.length-1;L>=0;--L){var G=this.tryEntries[L];if(G.tryLoc===N){var ee=G.completion;if(ee.type==="throw"){var $=ee.arg;V(G)}return $}}throw new Error("illegal catch attempt")},delegateYield:function(N,L,G){return this.delegate={iterator:Y(N),resultName:L,nextLoc:G},this.method==="next"&&(this.arg=n),v}},e}function mt(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function PD(n,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,l3(i.key),i)}}function At(n,e,t){return e&&PD(n.prototype,e),t&&PD(n,t),Object.defineProperty(n,"prototype",{writable:!1}),n}function K(n,e,t){return e=l3(e),e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function yp(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&SE(n,e)}function J0(n){return J0=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},J0(n)}function SE(n,e){return SE=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,s){return i.__proto__=s,i},SE(n,e)}function Jee(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Ht(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function Kee(n,e){if(e&&(typeof e=="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Ht(n)}function bp(n){var e=Jee();return function(){var i=J0(n),s;if(e){var r=J0(this).constructor;s=Reflect.construct(i,arguments,r)}else s=i.apply(this,arguments);return Kee(this,s)}}function _f(n,e){return Zee(n)||Yee(n,e)||a3(n,e)||$ee()}function Zee(n){if(Array.isArray(n))return n}function a3(n,e){if(n){if(typeof n=="string")return BD(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return BD(n,e)}}function BD(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,i=new Array(e);t<e;t++)i[t]=n[t];return i}function $ee(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function DD(n,e){var t=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!t){if(Array.isArray(n)||(t=a3(n))||e&&n&&typeof n.length=="number"){t&&(n=t);var i=0,s=function(){};return{s,n:function(){return i>=n.length?{done:!0}:{done:!1,value:n[i++]}},e:function(l){throw l},f:s}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var r=!0,o=!1,a;return{s:function(){t=t.call(n)},n:function(){var l=t.next();return r=l.done,l},e:function(l){o=!0,a=l},f:function(){try{!r&&t.return!=null&&t.return()}finally{if(o)throw a}}}}function ete(n,e){if(typeof n!="object"||n===null)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var i=t.call(n,e||"default");if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function l3(n){var e=ete(n,"string");return typeof e=="symbol"?e:String(e)}var tte=function(n){yp(t,n);var e=bp(t);function t(i){var s;return mt(this,t),s=e.call(this),K(Ht(s),"type","ParticleEmitter"),K(Ht(s),"system",void 0),s.system=i,s}return At(t,[{key:"clone",value:function(){var s=this.system.clone();return s.emitter.copy(this,!0),s.emitter}},{key:"dispose",value:function(){}},{key:"extractFromCache",value:function(s){var r=[];for(var o in s){var a=s[o];delete a.metadata,r.push(a)}return r}},{key:"toJSON",value:function(s){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=s===void 0||typeof s=="string",a={};o&&(s={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},a.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var l={};if(l.uuid=this.uuid,l.type=this.type,this.name!==""&&(l.name=this.name),this.castShadow===!0&&(l.castShadow=!0),this.receiveShadow===!0&&(l.receiveShadow=!0),this.visible===!1&&(l.visible=!1),this.frustumCulled===!1&&(l.frustumCulled=!1),this.renderOrder!==0&&(l.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(l.userData=this.userData),l.layers=this.layers.mask,l.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(l.matrixAutoUpdate=!1),this.system!==null&&(l.ps=this.system.toJSON(s,r)),this.children.length>0){l.children=[];for(var c=0;c<this.children.length;c++)this.children[c].type!=="ParticleSystemPreview"&&l.children.push(this.children[c].toJSON(s).object)}if(o){var u=this.extractFromCache(s.geometries),d=this.extractFromCache(s.materials),f=this.extractFromCache(s.textures),p=this.extractFromCache(s.images);u.length>0&&(a.geometries=u),d.length>0&&(a.materials=d),f.length>0&&(a.textures=f),p.length>0&&(a.images=p)}return a.object=l,a}}]),t}(Me),uS=function(){function n(e){mt(this,n),K(this,"data",void 0),K(this,"next",void 0),K(this,"prev",void 0),this.data=e,this.next=null,this.prev=null}return At(n,[{key:"hasPrev",value:function(){return this.prev!==null}},{key:"hasNext",value:function(){return this.next!==null}}]),n}(),ite=function(){function n(){mt(this,n),K(this,"length",void 0),K(this,"head",void 0),K(this,"tail",void 0),this.length=0,this.head=this.tail=null}return At(n,[{key:"isEmpty",value:function(){return this.head===null}},{key:"clear",value:function(){this.length=0,this.head=this.tail=null}},{key:"front",value:function(){return this.head===null?null:this.head.data}},{key:"back",value:function(){return this.tail===null?null:this.tail.data}},{key:"dequeue",value:function(){if(this.head){var t=this.head.data;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,t}}},{key:"pop",value:function(){if(this.tail){var t=this.tail.data;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,t}}},{key:"queue",value:function(t){var i=new uS(t);this.tail||(this.tail=i),this.head&&(this.head.prev=i,i.next=this.head),this.head=i,this.length++}},{key:"push",value:function(t){var i=new uS(t);this.head||(this.head=i),this.tail&&(this.tail.next=i,i.prev=this.tail),this.tail=i,this.length++}},{key:"insertBefore",value:function(t,i){var s=new uS(i);s.next=t,s.prev=t.prev,s.prev!==null&&(s.prev.next=s),s.next.prev=s,t==this.head&&(this.head=s),this.length++}},{key:"remove",value:function(t){if(!(this.head===null||this.tail===null)){var i=this.head;for(t===this.head.data&&(this.head=this.head.next),t===this.tail.data&&(this.tail=this.tail.prev);i.next!==null&&i.data!==t;)i=i.next;i.data===t&&(i.prev!==null&&(i.prev.next=i.next),i.next!==null&&(i.next.prev=i.prev),this.length--)}}},{key:"values",value:wE().mark(function e(){var t;return wE().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:t=this.head;case 1:if(t===null){s.next=7;break}return s.next=4,t.data;case 4:t=t.next,s.next=1;break;case 7:case"end":return s.stop()}},e,this)})}]),n}(),Qm=function(){function n(){mt(this,n),K(this,"parentMatrix",void 0),K(this,"startSpeed",0),K(this,"startColor",new Ke),K(this,"startSize",1),K(this,"position",new w),K(this,"velocity",new w),K(this,"age",0),K(this,"life",1),K(this,"size",1),K(this,"angularVelocity",void 0),K(this,"rotation",0),K(this,"color",new Ke),K(this,"uvTile",0)}return At(n,[{key:"died",get:function(){return this.age>=this.life}}]),n}(),nte=At(function n(e,t,i){mt(this,n),this.position=e,this.size=t,this.color=i}),Wm=function(){function n(){mt(this,n),K(this,"parentMatrix",void 0),K(this,"startSpeed",0),K(this,"startColor",new Ke),K(this,"startSize",1),K(this,"position",new w),K(this,"localPosition",void 0),K(this,"velocity",new w),K(this,"age",0),K(this,"life",1),K(this,"size",1),K(this,"length",100),K(this,"color",new Ke),K(this,"previous",new ite),K(this,"uvTile",0)}return At(n,[{key:"update",value:function(){for(this.age<=this.life?this.previous.push(new nte(this.position.clone(),this.size,this.color.clone())):this.previous.length>0&&this.previous.dequeue();this.previous.length>this.length;)this.previous.dequeue()}},{key:"died",get:function(){return this.age>=this.life}},{key:"reset",value:function(){this.previous.clear()}}]),n}(),_s=function(){function n(e){mt(this,n),K(this,"type",void 0),this.value=e,this.type="value"}return At(n,[{key:"genValue",value:function(){return this.value}},{key:"toJSON",value:function(){return{type:"ConstantValue",value:this.value}}},{key:"clone",value:function(){return new n(this.value)}}],[{key:"fromJSON",value:function(t){return new n(t.value)}}]),n}(),nx=function(){function n(e,t){mt(this,n),K(this,"type",void 0),this.a=e,this.b=t,this.type="value"}return At(n,[{key:"genValue",value:function(){return cs.lerp(this.a,this.b,Math.random())}},{key:"toJSON",value:function(){return{type:"IntervalValue",a:this.a,b:this.b}}},{key:"clone",value:function(){return new n(this.a,this.b)}}],[{key:"fromJSON",value:function(t){return new n(t.a,t.b)}}]),n}(),ste=function(){function n(){mt(this,n),K(this,"functions",void 0),this.functions=new Array}return At(n,[{key:"findFunction",value:function(t){for(var i=0,s=0,r=this.functions.length-1;s+1<r;)if(i=Math.floor((s+r)/2),t<this.getStartX(i))r=i-1;else if(t>this.getEndX(i))s=i+1;else return i;for(var o=s;o<=r;o++)if(t>=this.functions[o][1]&&t<=this.getEndX(o))return o;return-1}},{key:"getStartX",value:function(t){return this.functions[t][1]}},{key:"setStartX",value:function(t,i){t>0&&(this.functions[t][1]=i)}},{key:"getEndX",value:function(t){return t+1<this.functions.length?this.functions[t+1][1]:1}},{key:"setEndX",value:function(t,i){t+1<this.functions.length&&(this.functions[t+1][1]=i)}},{key:"insertFunction",value:function(t,i){var s=this.findFunction(t);this.functions.splice(s+1,0,[i,t])}},{key:"removeFunction",value:function(t){return this.functions.splice(t,1)[0][0]}},{key:"getFunction",value:function(t){return this.functions[t][0]}},{key:"setFunction",value:function(t,i){this.functions[t][0]=i}},{key:"numOfFunctions",get:function(){return this.functions.length}}]),n}(),CE=function(){function n(e,t,i,s){mt(this,n),K(this,"p",void 0),this.p=[e,t,i,s]}return At(n,[{key:"genValue",value:function(t){var i=t*t,s=t*t*t,r=1-t,o=r*r,a=o*r;return this.p[0]*a+this.p[1]*o*t*3+this.p[2]*r*i*3+this.p[3]*s}},{key:"derivativeCoefficients",value:function(t){for(var i=[],s=t,r=s.length-1;r>0;r--){for(var o=[],a=0;a<r;a++){var l=r*(s[a+1]-s[a]);o.push(l)}i.push(o),s=o}return i}},{key:"getSlope",value:function(t){var i=this.derivativeCoefficients(this.p)[0],s=1-t,r=s*s,o=s*t*2,a=t*t;return r*i[0]+o*i[1]+a*i[2]}},{key:"controlCurve",value:function(t,i){this.p[1]=t/3+this.p[0],this.p[2]=this.p[3]-i/3}},{key:"hull",value:function(t){var i=this.p,s=[],r,o=0,a=0,l=0,c=[];for(c[o++]=i[0],c[o++]=i[1],c[o++]=i[2],c[o++]=i[3];i.length>1;){for(s=[],a=0,l=i.length-1;a<l;a++)r=t*i[a]+(1-t)*i[a+1],c[o++]=r,s.push(r);i=s}return c}},{key:"split",value:function(t){var i=this.hull(t),s={left:new n(i[0],i[4],i[7],i[9]),right:new n(i[9],i[8],i[6],i[3]),span:i};return s}},{key:"clone",value:function(){return new n(this.p[0],this.p[1],this.p[2],this.p[3])}},{key:"toJSON",value:function(){return{p0:this.p[0],p1:this.p[1],p2:this.p[2],p3:this.p[3]}}}],[{key:"fromJSON",value:function(t){return new n(t.p0,t.p1,t.p2,t.p3)}}]),n}(),rte=function(n){yp(t,n);var e=bp(t);function t(){var i,s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[[new CE(0,.3333333333333333,.6666666666666666,1),0]];return mt(this,t),i=e.call(this),K(Ht(i),"type",void 0),i.type="function",i.functions=s,i}return At(t,[{key:"genValue",value:function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,r=this.findFunction(s);return r===-1?0:this.functions[r][0].genValue((s-this.getStartX(r))/(this.getEndX(r)-this.getStartX(r)))}},{key:"toSVG",value:function(s,r){if(r<1)return"";for(var o=["M",0,this.functions[0][0].p[0]].join(" "),a=1/r;a<=1;a+=1/r)o=[o,"L",a*s,this.genValue(a)].join(" ");return o}},{key:"toJSON",value:function(){return{type:"PiecewiseBezier",functions:this.functions.map(function(s){var r=_f(s,2),o=r[0],a=r[1];return{function:o.toJSON(),start:a}})}}},{key:"clone",value:function(){return new t(this.functions.map(function(s){var r=_f(s,2),o=r[0],a=r[1];return[o.clone(),a]}))}}],[{key:"fromJSON",value:function(s){return new t(s.functions.map(function(r){return[CE.fromJSON(r.function),r.start]}))}}]),t}(ste);function Mi(n){switch(n.type){case"ConstantValue":return _s.fromJSON(n);case"IntervalValue":return nx.fromJSON(n);case"PiecewiseBezier":return rte.fromJSON(n);default:return new _s(0)}}var jm=function(e){return{r:e.x,g:e.y,b:e.z,a:e.w}},qm=function(e){return new Ke(e.r,e.g,e.b,e.a)},ote=function(e,t){switch(t){case"Vector3":return new w(e.x,e.y,e.z);case"Vector4":return new Ke(e.x,e.y,e.z,e.w);case"Color":return new w(e.r,e.g,e.b);case"Number":return e;default:return e}},ate=function(e,t){switch(t){case"Vector3":return{x:e.x,y:e.y,z:e.z};case"Vector4":return{x:e.x,y:e.y,z:e.z,w:e.w};case"Color":return{r:e.x,g:e.y,b:e.z};case"Number":return e;default:return e}},lte=function(){function n(e,t){mt(this,n),K(this,"type",void 0),this.a=e,this.b=t,this.type="value"}return At(n,[{key:"genColor",value:function(t){var i=Math.random();return t.copy(this.a).lerp(this.b,i)}},{key:"toJSON",value:function(){return{type:"RandomColor",a:jm(this.a),b:jm(this.b)}}},{key:"clone",value:function(){return new n(this.a.clone(),this.b.clone())}}],[{key:"fromJSON",value:function(t){return new n(qm(t.a),qm(t.b))}}]),n}(),EE=function(){function n(e,t){mt(this,n),K(this,"type",void 0),this.a=e,this.b=t,this.type="function"}return At(n,[{key:"genColor",value:function(t,i){return t.copy(this.a).lerp(this.b,i)}},{key:"toJSON",value:function(){return{type:"ColorRange",a:jm(this.a),b:jm(this.b)}}},{key:"clone",value:function(){return new n(this.a.clone(),this.b.clone())}}],[{key:"fromJSON",value:function(t){return new n(qm(t.a),qm(t.b))}}]),n}(),uy=function(){function n(e,t){mt(this,n),K(this,"keys",void 0),K(this,"type",void 0),K(this,"subType",void 0),this.subType=t,this.type="function",this.keys=e}return At(n,[{key:"findKey",value:function(t){for(var i=0,s=0,r=this.keys.length-1;s+1<r;)if(i=Math.floor((s+r)/2),t<this.getStartX(i))r=i-1;else if(t>this.getEndX(i))s=i+1;else return i;for(var o=s;o<=r;o++)if(t>=this.getStartX(o)&&t<=this.getEndX(o))return o;return-1}},{key:"getStartX",value:function(t){return this.keys[t][1]}},{key:"getEndX",value:function(t){return t+1<this.keys.length?this.keys[t+1][1]:1}},{key:"genValue",value:function(t,i){var s=this.findKey(i);return this.subType==="Number"?s===-1?this.keys[0][0]:s+1>=this.keys.length?this.keys[this.keys.length-1][0]:(this.keys[s+1][0]-this.keys[s][0])*((i-this.getStartX(s))/(this.getEndX(s)-this.getStartX(s)))+this.keys[s][0]:s===-1?t.copy(this.keys[0][0]):s+1>=this.keys.length?t.copy(this.keys[this.keys.length-1][0]):t.copy(this.keys[s][0]).lerp(this.keys[s+1][0],(i-this.getStartX(s))/(this.getEndX(s)-this.getStartX(s)))}},{key:"toJSON",value:function(){var t=this;return this.keys[0][0].constructor.name,{type:"CLinearFunction",subType:this.subType,keys:this.keys.map(function(i){var s=_f(i,2),r=s[0],o=s[1];return{value:ate(r,t.subType),pos:o}})}}},{key:"clone",value:function(){return this.subType==="Number"?new n(this.keys.map(function(t){var i=_f(t,2),s=i[0],r=i[1];return[s,r]}),this.subType):new n(this.keys.map(function(t){var i=_f(t,2),s=i[0],r=i[1];return[s.clone(),r]}),this.subType)}}],[{key:"fromJSON",value:function(t){return new n(t.keys.map(function(i){return[ote(i.value,t.subType),i.pos]}),t.subType)}}]),n}(),dy=new w,ME=function(){function n(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[[new w(0,0,0),0],[new w(1,1,1),0]],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[[1,0],[1,1]];mt(this,n),K(this,"type",void 0),K(this,"color",void 0),K(this,"alpha",void 0),this.type="function",this.color=new uy(e,"Color"),this.alpha=new uy(t,"Number")}return At(n,[{key:"genColor",value:function(t,i){return this.color.genValue(dy,i),t.set(dy.x,dy.y,dy.z,this.alpha.genValue(1,i))}},{key:"toJSON",value:function(){return{type:"Gradient",color:this.color.toJSON(),alpha:this.alpha.toJSON()}}},{key:"clone",value:function(){var t=new n;return t.alpha=this.alpha.clone(),t.color=this.color.clone(),t}}],[{key:"fromJSON",value:function(t){if(t.functions){var i=t.functions.map(function(r){return[EE.fromJSON(r.function).a,r.start]});return t.functions.length>0&&i.push([EE.fromJSON(t.functions[t.functions.length-1].function).b,1]),new n(i.map(function(r){return[new w(r[0].x,r[0].y,r[0].z),r[1]]}),i.map(function(r){return[r[0].w,r[1]]}))}else{var s=new n;return s.alpha=uy.fromJSON(t.alpha),s.color=uy.fromJSON(t.color),s}}}]),n}(),dS=new Ke,cte=function(){function n(e,t){mt(this,n),K(this,"gradient1",void 0),K(this,"gradient2",void 0),K(this,"type",void 0),this.type="memorizedFunction",this.gradient1=e,this.gradient2=t}return At(n,[{key:"startGen",value:function(t){t.rand=Math.random()}},{key:"genColor",value:function(t,i,s){return this.gradient1.genColor(t,i),this.gradient2.genColor(dS,i),s&&s.rand?t.lerp(dS,s.rand):t.lerp(dS,Math.random()),t}},{key:"toJSON",value:function(){return{type:"RandomColorBetweenGradient",gradient1:this.gradient1.toJSON(),gradient2:this.gradient2.toJSON()}}},{key:"clone",value:function(){return new n(this.gradient1.clone(),this.gradient2.clone())}}],[{key:"fromJSON",value:function(t){return new n(ME.fromJSON(t.gradient1),ME.fromJSON(t.gradient2))}}]),n}(),K0=function(){function n(e){mt(this,n),K(this,"type",void 0),this.color=e,this.type="value"}return At(n,[{key:"genColor",value:function(t){return t.copy(this.color)}},{key:"toJSON",value:function(){return{type:"ConstantColor",color:jm(this.color)}}},{key:"clone",value:function(){return new n(this.color.clone())}}],[{key:"fromJSON",value:function(t){return new n(qm(t.color))}}]),n}();function P1(n){switch(n.type){case"ConstantColor":return K0.fromJSON(n);case"ColorRange":return EE.fromJSON(n);case"RandomColor":return lte.fromJSON(n);case"Gradient":return ME.fromJSON(n);case"RandomColorBetweenGradient":return cte.fromJSON(n);default:return new K0(new Ke(1,1,1,1))}}var OD=function(){function n(){mt(this,n),K(this,"type",void 0),this.type="rotation"}return At(n,[{key:"genValue",value:function(t,i){var s,r,o,a,l,c;do s=Math.random()*2-1,r=Math.random()*2-1,o=s*s+r*r;while(o>1);do a=Math.random()*2-1,l=Math.random()*2-1,c=a*a+l*l;while(c>1);var u=Math.sqrt((1-o)/c);return t.set(s,r,u*a,u*l),t}},{key:"toJSON",value:function(){return{type:"RandomQuat"}}},{key:"clone",value:function(){return new n}}],[{key:"fromJSON",value:function(t){return new n}}]),n}(),c3=function(){function n(e,t){mt(this,n),K(this,"type",void 0),this.axis=e,this.angle=t,this.type="rotation"}return At(n,[{key:"genValue",value:function(t,i){return t.setFromAxisAngle(this.axis,this.angle.genValue(i))}},{key:"toJSON",value:function(){return{type:"AxisAngle",axis:{x:this.axis.x,y:this.axis.y,z:this.axis.z},angle:this.angle.toJSON()}}},{key:"clone",value:function(){return new n(this.axis.clone(),this.angle.clone())}}],[{key:"fromJSON",value:function(t){return new n(t.axis,Mi(t.angle))}}]),n}(),hte=function(){function n(e,t,i){mt(this,n),K(this,"type",void 0),this.angleX=e,this.angleY=t,this.angleZ=i,this.type="rotation"}return At(n,[{key:"genValue",value:function(t,i){return t.setFromEuler(new pn(this.angleX.genValue(i),this.angleY.genValue(i),this.angleZ.genValue(i)))}},{key:"toJSON",value:function(){return{type:"Euler",angleX:this.angleX.toJSON(),angleY:this.angleY.toJSON(),angleZ:this.angleZ.toJSON()}}},{key:"clone",value:function(){return new n(this.angleX,this.angleY,this.angleZ)}}],[{key:"fromJSON",value:function(t){return new n(Mi(t.angleX),Mi(t.angleY),Mi(t.angleZ))}}]),n}();function h3(n){switch(n.type){case"AxisAngle":return c3.fromJSON(n);case"Euler":return hte.fromJSON(n);case"RandomQuat":return OD.fromJSON(n);default:return new OD}}function ute(n){switch(n.type){case"ConstantValue":case"IntervalValue":case"PiecewiseBezier":return Mi(n);case"AxisAngle":case"RandomQuat":case"Euler":return h3(n);default:return new _s(0)}}var kD=function(){function n(e){mt(this,n),K(this,"type","ColorOverLife"),this.color=e}return At(n,[{key:"initialize",value:function(t){this.color.type==="memorizedFunction"&&(t.colorOverLifeMemory={},this.color.startGen(t.colorOverLifeMemory))}},{key:"update",value:function(t,i){this.color.type==="memorizedFunction"?this.color.genColor(t.color,t.age/t.life,t.colorOverLifeMemory):this.color.genColor(t.color,t.age/t.life),t.color.x*=t.startColor.x,t.color.y*=t.startColor.y,t.color.z*=t.startColor.z,t.color.w*=t.startColor.w}},{key:"frameUpdate",value:function(t){}},{key:"toJSON",value:function(){return{type:this.type,color:this.color.toJSON()}}},{key:"clone",value:function(){return new n(this.color.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new n(P1(t.color))}}]),n}(),LD=function(){function n(e,t){mt(this,n),K(this,"type","RotationOverLife"),K(this,"tempQuat",new Se),this.angularVelocity=e,this.dynamic=t}return At(n,[{key:"initialize",value:function(t){!this.dynamic&&t instanceof Qm&&(t.angularVelocity=this.angularVelocity.genValue())}},{key:"update",value:function(t,i){this.dynamic?t.rotation+=i*this.angularVelocity.genValue(t.age/t.life):t instanceof Qm&&(t.rotation+=i*t.angularVelocity)}},{key:"toJSON",value:function(){return{type:this.type,angularVelocity:this.angularVelocity.toJSON(),dynamic:this.dynamic}}},{key:"frameUpdate",value:function(t){}},{key:"clone",value:function(){return new n(this.angularVelocity.clone(),this.dynamic)}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new n(Mi(t.angularVelocity),t.dynamic)}}]),n}(),FD=function(){function n(e){mt(this,n),K(this,"type","SizeOverLife"),this.size=e}return At(n,[{key:"initialize",value:function(t){}},{key:"update",value:function(t){t.size=t.startSize*this.size.genValue(t.age/t.life)}},{key:"toJSON",value:function(){return{type:this.type,size:this.size.toJSON()}}},{key:"frameUpdate",value:function(t){}},{key:"clone",value:function(){return new n(this.size.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new n(Mi(t.size))}}]),n}(),UD=function(){function n(e){mt(this,n),K(this,"type","SpeedOverLife"),this.speed=e}return At(n,[{key:"initialize",value:function(t){}},{key:"update",value:function(t){t.velocity.normalize().multiplyScalar(t.startSpeed*this.speed.genValue(t.age/t.life))}},{key:"toJSON",value:function(){return{type:this.type,speed:this.speed.toJSON()}}},{key:"frameUpdate",value:function(t){}},{key:"clone",value:function(){return new n(this.speed.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new n(Mi(t.speed))}}]),n}(),ND=function(){function n(e,t){mt(this,n),K(this,"type","RotationBySpeed"),K(this,"tempQuat",new Se),this.angularVelocity=e,this.speedRange=t}return At(n,[{key:"initialize",value:function(t){}},{key:"update",value:function(t,i){var s=(t.startSpeed-this.speedRange.a)/(this.speedRange.b-this.speedRange.a);t.rotation+=i*this.angularVelocity.genValue(s)}},{key:"toJSON",value:function(){return{type:this.type,angularVelocity:this.angularVelocity.toJSON(),speedRange:this.speedRange.toJSON()}}},{key:"frameUpdate",value:function(t){}},{key:"clone",value:function(){return new n(this.angularVelocity.clone(),this.speedRange.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new n(Mi(t.angularVelocity),nx.fromJSON(t.speedRange))}}]),n}(),zD=function(){function n(e,t){mt(this,n),K(this,"type","SizeBySpeed"),this.size=e,this.speedRange=t}return At(n,[{key:"initialize",value:function(t){}},{key:"update",value:function(t){var i=(t.startSpeed-this.speedRange.a)/(this.speedRange.b-this.speedRange.a);t.size=t.startSize*this.size.genValue(i)}},{key:"toJSON",value:function(){return{type:this.type,size:this.size.toJSON(),speedRange:this.speedRange.toJSON()}}},{key:"frameUpdate",value:function(t){}},{key:"clone",value:function(){return new n(this.size.clone(),this.speedRange.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new n(Mi(t.size),nx.fromJSON(t.speedRange))}}]),n}(),GD=function(){function n(e,t){mt(this,n),K(this,"type","ColorBySpeed"),this.color=e,this.speedRange=t}return At(n,[{key:"initialize",value:function(t){this.color.type==="memorizedFunction"&&(t.colorOverLifeMemory={},this.color.startGen(t.colorOverLifeMemory))}},{key:"update",value:function(t,i){var s=(t.startSpeed-this.speedRange.a)/(this.speedRange.b-this.speedRange.a);this.color.type==="memorizedFunction"?this.color.genColor(t.color,s,t.colorOverLifeMemory):this.color.genColor(t.color,s),t.color.x*=t.startColor.x,t.color.y*=t.startColor.y,t.color.z*=t.startColor.z,t.color.w*=t.startColor.w}},{key:"frameUpdate",value:function(t){}},{key:"toJSON",value:function(){return{type:this.type,color:this.color.toJSON(),speedRange:this.speedRange.toJSON()}}},{key:"clone",value:function(){return new n(this.color.clone(),this.speedRange.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new n(P1(t.color),nx.fromJSON(t.speedRange))}}]),n}(),VD=function(){function n(e){mt(this,n),K(this,"type","FrameOverLife"),this.frame=e}return At(n,[{key:"initialize",value:function(t){}},{key:"update",value:function(t,i){t.uvTile=Math.floor(this.frame.genValue(t.age/t.life))}},{key:"frameUpdate",value:function(t){}},{key:"toJSON",value:function(){return{type:this.type,frame:this.frame.toJSON()}}},{key:"clone",value:function(){return new n(this.frame.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new n(Mi(t.frame))}}]),n}();new w(0,0,1);var HD=function(){function n(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new w(0,1,0);mt(this,n),K(this,"type","OrbitOverLife"),K(this,"rotation",void 0),K(this,"line",void 0),K(this,"temp",new w),this.orbitSpeed=e,this.axis=t,this.rotation=new Se,this.line=new mL}return At(n,[{key:"initialize",value:function(t){}},{key:"update",value:function(t,i){this.line.set(new w(0,0,0),this.axis),this.line.closestPointToPoint(t.position,!1,this.temp),this.rotation.setFromAxisAngle(this.axis,this.orbitSpeed.genValue(t.age/t.life)*i),t.position.sub(this.temp),t.position.applyQuaternion(this.rotation),t.position.add(this.temp)}},{key:"frameUpdate",value:function(t){}},{key:"toJSON",value:function(){return{type:this.type,orbitSpeed:this.orbitSpeed.toJSON(),axis:[this.axis.x,this.axis.y,this.axis.z]}}},{key:"clone",value:function(){return new n(this.orbitSpeed.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new n(Mi(t.orbitSpeed),t.axis?new w(t.axis[0],t.axis[1],t.axis[2]):void 0)}}]),n}(),QD=function(){function n(e,t){mt(this,n),K(this,"type","ApplyForce"),K(this,"magnitudeValue",void 0),this.direction=e,this.magnitude=t,this.magnitudeValue=this.magnitude.genValue()}return At(n,[{key:"initialize",value:function(t){}},{key:"update",value:function(t,i){t.velocity.addScaledVector(this.direction,this.magnitudeValue*i)}},{key:"frameUpdate",value:function(t){this.magnitudeValue=this.magnitude.genValue()}},{key:"toJSON",value:function(){return{type:this.type,direction:[this.direction.x,this.direction.y,this.direction.z],magnitude:this.magnitude.toJSON()}}},{key:"clone",value:function(){return new n(this.direction.clone(),this.magnitude.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){var i;return new n(new w(t.direction[0],t.direction[1],t.direction[2]),Mi((i=t.magnitude)!==null&&i!==void 0?i:t.force))}}]),n}(),WD=function(){function n(e,t){mt(this,n),K(this,"type","GravityForce"),K(this,"temp",new w),this.center=e,this.magnitude=t}return At(n,[{key:"initialize",value:function(t){}},{key:"update",value:function(t,i){this.temp.copy(this.center).sub(t.position).normalize(),t.velocity.addScaledVector(this.temp,this.magnitude/t.position.distanceToSquared(this.center)*i)}},{key:"frameUpdate",value:function(t){}},{key:"toJSON",value:function(){return{type:this.type,center:[this.center.x,this.center.y,this.center.z],magnitude:this.magnitude}}},{key:"clone",value:function(){return new n(this.center.clone(),this.magnitude)}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new n(new w(t.center[0],t.center[1],t.center[2]),t.magnitude)}}]),n}(),jD=function(){function n(e){mt(this,n),K(this,"type","WidthOverLength"),this.width=e}return At(n,[{key:"initialize",value:function(t){}},{key:"update",value:function(t){if(t instanceof Wm)for(var i=t.previous.values(),s=0;s<t.previous.length;s++){var r=i.next();r.value.size=this.width.genValue((t.previous.length-s)/t.length)}}},{key:"frameUpdate",value:function(t){}},{key:"toJSON",value:function(){return{type:this.type,width:this.width.toJSON()}}},{key:"clone",value:function(){return new n(this.width.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new n(Mi(t.width))}}]),n}();new w(0,0,1);var qD=function(){function n(e){mt(this,n),K(this,"type","ChangeEmitDirection"),K(this,"_temp",new w),K(this,"_q",new Se),this.angle=e}return At(n,[{key:"initialize",value:function(t){var i=t.velocity.length();i!=0&&(t.velocity.normalize(),t.velocity.x===0&&t.velocity.y===0?this._temp.set(0,t.velocity.z,0):this._temp.set(-t.velocity.y,t.velocity.x,0),this._q.setFromAxisAngle(this._temp.normalize(),this.angle.genValue()),this._temp.copy(t.velocity),t.velocity.applyQuaternion(this._q),this._q.setFromAxisAngle(this._temp,Math.random()*Math.PI*2),t.velocity.applyQuaternion(this._q),t.velocity.setLength(i))}},{key:"update",value:function(t,i){}},{key:"frameUpdate",value:function(t){}},{key:"toJSON",value:function(){return{type:this.type,angle:this.angle.toJSON()}}},{key:"clone",value:function(){return new n(this.angle)}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new n(Mi(t.angle))}}]),n}(),dte=new w(1,1,1),XD=new w(0,0,1),YD=function(){function n(e,t,i){mt(this,n),K(this,"type","EmitSubParticleSystem"),K(this,"q_",new Se),K(this,"v_",new w),K(this,"v2_",new w),this.particleSystem=e,this.useVelocityAsBasis=t,this.subParticleSystem=i,this.subParticleSystem&&this.subParticleSystem.system&&(this.subParticleSystem.system.onlyUsedByOther=!0)}return At(n,[{key:"initialize",value:function(t){t.emissionState={burstIndex:0,burstWaveIndex:0,time:0,waitEmiting:0,matrix:new Ie}}},{key:"update",value:function(t,i){if(!(!this.subParticleSystem||!t.emissionState)){var s=t.emissionState.matrix,r;if(t.rotation===void 0||this.useVelocityAsBasis)if(t.velocity.x===0&&t.velocity.y===0&&(t.velocity.z===1||t.velocity.z===0))s.set(1,0,0,t.position.x,0,1,0,t.position.y,0,0,1,t.position.z,0,0,0,1);else{this.v_.copy(XD).cross(t.velocity),this.v2_.copy(t.velocity).cross(this.v_);var o=this.v_.length(),a=this.v2_.length();s.set(this.v_.x/o,this.v2_.x/a,t.velocity.x,t.position.x,this.v_.y/o,this.v2_.y/a,t.velocity.y,t.position.y,this.v_.z/o,this.v2_.z/a,t.velocity.z,t.position.z,0,0,0,1)}else t.rotation instanceof Se?r=t.rotation:(this.q_.setFromAxisAngle(XD,t.rotation),r=this.q_),s.compose(t.position,r,dte);this.particleSystem.worldSpace||s.multiplyMatrices(this.particleSystem.emitter.matrixWorld,s),this.subParticleSystem.system.emit(i,t.emissionState,s)}}},{key:"frameUpdate",value:function(t){}},{key:"toJSON",value:function(){return{type:this.type,subParticleSystem:this.subParticleSystem?this.subParticleSystem.uuid:"",useVelocityAsBasis:this.useVelocityAsBasis}}},{key:"clone",value:function(){return new n(this.particleSystem,this.useVelocityAsBasis,this.subParticleSystem)}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t,i){return new n(i,t.useVelocityAsBasis,t.subParticleSystem)}}]),n}(),fte=.5*(Math.sqrt(3)-1),tg=(3-Math.sqrt(3))/6,pte=1/3,aa=1/6,gte=(Math.sqrt(5)-1)/4,$n=(5-Math.sqrt(5))/20,zn=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),vn=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]),u3=function(){function n(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Math.random;mt(this,n),K(this,"p",void 0),K(this,"perm",void 0),K(this,"permMod12",void 0);var t=typeof e=="function"?e:Ate(e);this.p=mte(t),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(var i=0;i<512;i++)this.perm[i]=this.p[i&255],this.permMod12[i]=this.perm[i]%12}return At(n,[{key:"noise2D",value:function(t,i){var s=this.permMod12,r=this.perm,o=0,a=0,l=0,c=(t+i)*fte,u=Math.floor(t+c),d=Math.floor(i+c),f=(u+d)*tg,p=u-f,g=d-f,A=t-p,v=i-g,m,b;A>v?(m=1,b=0):(m=0,b=1);var y=A-m+tg,_=v-b+tg,E=A-1+2*tg,M=v-1+2*tg,I=u&255,R=d&255,C=.5-A*A-v*v;if(C>=0){var T=s[I+r[R]]*3;C*=C,o=C*C*(zn[T]*A+zn[T+1]*v)}var O=.5-y*y-_*_;if(O>=0){var J=s[I+m+r[R+b]]*3;O*=O,a=O*O*(zn[J]*y+zn[J+1]*_)}var V=.5-E*E-M*M;if(V>=0){var H=s[I+1+r[R+1]]*3;V*=V,l=V*V*(zn[H]*E+zn[H+1]*M)}return 70*(o+a+l)}},{key:"noise3D",value:function(t,i,s){var r=this.permMod12,o=this.perm,a,l,c,u,d=(t+i+s)*pte,f=Math.floor(t+d),p=Math.floor(i+d),g=Math.floor(s+d),A=(f+p+g)*aa,v=f-A,m=p-A,b=g-A,y=t-v,_=i-m,E=s-b,M,I,R,C,T,O;y>=_?_>=E?(M=1,I=0,R=0,C=1,T=1,O=0):y>=E?(M=1,I=0,R=0,C=1,T=0,O=1):(M=0,I=0,R=1,C=1,T=0,O=1):_<E?(M=0,I=0,R=1,C=0,T=1,O=1):y<E?(M=0,I=1,R=0,C=0,T=1,O=1):(M=0,I=1,R=0,C=1,T=1,O=0);var J=y-M+aa,V=_-I+aa,H=E-R+aa,Y=y-C+2*aa,N=_-T+2*aa,L=E-O+2*aa,G=y-1+3*aa,ee=_-1+3*aa,$=E-1+3*aa,j=f&255,ie=p&255,Ae=g&255,ge=.6-y*y-_*_-E*E;if(ge<0)a=0;else{var Ce=r[j+o[ie+o[Ae]]]*3;ge*=ge,a=ge*ge*(zn[Ce]*y+zn[Ce+1]*_+zn[Ce+2]*E)}var Ee=.6-J*J-V*V-H*H;if(Ee<0)l=0;else{var Ne=r[j+M+o[ie+I+o[Ae+R]]]*3;Ee*=Ee,l=Ee*Ee*(zn[Ne]*J+zn[Ne+1]*V+zn[Ne+2]*H)}var Ve=.6-Y*Y-N*N-L*L;if(Ve<0)c=0;else{var lt=r[j+C+o[ie+T+o[Ae+O]]]*3;Ve*=Ve,c=Ve*Ve*(zn[lt]*Y+zn[lt+1]*N+zn[lt+2]*L)}var xt=.6-G*G-ee*ee-$*$;if(xt<0)u=0;else{var et=r[j+1+o[ie+1+o[Ae+1]]]*3;xt*=xt,u=xt*xt*(zn[et]*G+zn[et+1]*ee+zn[et+2]*$)}return 32*(a+l+c+u)}},{key:"noise4D",value:function(t,i,s,r){var o=this.perm,a,l,c,u,d,f=(t+i+s+r)*gte,p=Math.floor(t+f),g=Math.floor(i+f),A=Math.floor(s+f),v=Math.floor(r+f),m=(p+g+A+v)*$n,b=p-m,y=g-m,_=A-m,E=v-m,M=t-b,I=i-y,R=s-_,C=r-E,T=0,O=0,J=0,V=0;M>I?T++:O++,M>R?T++:J++,M>C?T++:V++,I>R?O++:J++,I>C?O++:V++,R>C?J++:V++;var H=T>=3?1:0,Y=O>=3?1:0,N=J>=3?1:0,L=V>=3?1:0,G=T>=2?1:0,ee=O>=2?1:0,$=J>=2?1:0,j=V>=2?1:0,ie=T>=1?1:0,Ae=O>=1?1:0,ge=J>=1?1:0,Ce=V>=1?1:0,Ee=M-H+$n,Ne=I-Y+$n,Ve=R-N+$n,lt=C-L+$n,xt=M-G+2*$n,et=I-ee+2*$n,W=R-$+2*$n,Le=C-j+2*$n,me=M-ie+3*$n,ke=I-Ae+3*$n,we=R-ge+3*$n,Ze=C-Ce+3*$n,We=M-1+4*$n,qe=I-1+4*$n,pt=R-1+4*$n,wt=C-1+4*$n,Qt=p&255,z=g&255,k=A&255,he=v&255,Re=.6-M*M-I*I-R*R-C*C;if(Re<0)a=0;else{var Pe=o[Qt+o[z+o[k+o[he]]]]%32*4;Re*=Re,a=Re*Re*(vn[Pe]*M+vn[Pe+1]*I+vn[Pe+2]*R+vn[Pe+3]*C)}var Fe=.6-Ee*Ee-Ne*Ne-Ve*Ve-lt*lt;if(Fe<0)l=0;else{var X=o[Qt+H+o[z+Y+o[k+N+o[he+L]]]]%32*4;Fe*=Fe,l=Fe*Fe*(vn[X]*Ee+vn[X+1]*Ne+vn[X+2]*Ve+vn[X+3]*lt)}var de=.6-xt*xt-et*et-W*W-Le*Le;if(de<0)c=0;else{var le=o[Qt+G+o[z+ee+o[k+$+o[he+j]]]]%32*4;de*=de,c=de*de*(vn[le]*xt+vn[le+1]*et+vn[le+2]*W+vn[le+3]*Le)}var Qe=.6-me*me-ke*ke-we*we-Ze*Ze;if(Qe<0)u=0;else{var je=o[Qt+ie+o[z+Ae+o[k+ge+o[he+Ce]]]]%32*4;Qe*=Qe,u=Qe*Qe*(vn[je]*me+vn[je+1]*ke+vn[je+2]*we+vn[je+3]*Ze)}var Ge=.6-We*We-qe*qe-pt*pt-wt*wt;if(Ge<0)d=0;else{var Oe=o[Qt+1+o[z+1+o[k+1+o[he+1]]]]%32*4;Ge*=Ge,d=Ge*Ge*(vn[Oe]*We+vn[Oe+1]*qe+vn[Oe+2]*pt+vn[Oe+3]*wt)}return 27*(a+l+c+u+d)}}]),n}();function mte(n){for(var e=new Uint8Array(256),t=0;t<256;t++)e[t]=t;for(var i=0;i<255;i++){var s=i+~~(n()*(256-i)),r=e[i];e[i]=e[s],e[s]=r}return e}function Ate(n){var e=0,t=0,i=0,s=1,r=vte();return e=r(" "),t=r(" "),i=r(" "),e-=r(n),e<0&&(e+=1),t-=r(n),t<0&&(t+=1),i-=r(n),i<0&&(i+=1),function(){var o=2091639*e+s*23283064365386963e-26;return e=t,t=i,i=o-(s=o|0)}}function vte(){var n=4022871197;return function(e){e=e.toString();for(var t=0;t<e.length;t++){n+=e.charCodeAt(t);var i=.02519603282416938*n;n=i>>>0,i-=n,i*=n,n=i>>>0,i-=n,n+=i*4294967296}return(n>>>0)*23283064365386963e-26}}var JD=function(){function n(e,t,i,s){mt(this,n),K(this,"type","TurbulenceField"),K(this,"generator",new u3),K(this,"timeOffset",new w),K(this,"temp",new w),K(this,"temp2",new w),this.scale=e,this.octaves=t,this.velocityMultiplier=i,this.timeScale=s,this.timeOffset.x=Math.random()/this.scale.x*this.timeScale.x,this.timeOffset.y=Math.random()/this.scale.y*this.timeScale.y,this.timeOffset.z=Math.random()/this.scale.z*this.timeScale.z}return At(n,[{key:"initialize",value:function(t){}},{key:"update",value:function(t,i){var s=t.position.x/this.scale.x,r=t.position.y/this.scale.y,o=t.position.z/this.scale.z;this.temp.set(0,0,0);for(var a=1,l=0;l<this.octaves;l++)this.temp2.set(this.generator.noise4D(s*a,r*a,o*a,this.timeOffset.x*a)/a,this.generator.noise4D(s*a,r*a,o*a,this.timeOffset.y*a)/a,this.generator.noise4D(s*a,r*a,o*a,this.timeOffset.z*a)/a),this.temp.add(this.temp2),a*=2;this.temp.multiply(this.velocityMultiplier),t.velocity.addScaledVector(this.temp,i)}},{key:"toJSON",value:function(){return{type:this.type,scale:[this.scale.x,this.scale.y,this.scale.z],octaves:this.octaves,velocityMultiplier:[this.velocityMultiplier.x,this.velocityMultiplier.y,this.velocityMultiplier.z],timeScale:[this.timeScale.x,this.timeScale.y,this.timeScale.z]}}},{key:"frameUpdate",value:function(t){this.timeOffset.x+=t*this.timeScale.x,this.timeOffset.y+=t*this.timeScale.y,this.timeOffset.z+=t*this.timeScale.z}},{key:"clone",value:function(){return new n(this.scale.clone(),this.octaves,this.velocityMultiplier.clone(),this.timeScale.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new n(new w(t.scale[0],t.scale[1],t.scale[2]),t.octaves,new w(t.velocityMultiplier[0],t.velocityMultiplier[1],t.velocityMultiplier[2]),new w(t.timeScale[0],t.timeScale[1],t.timeScale[2]))}}]),n}(),KD=new Se,ZD=function(){function n(e,t){mt(this,n),K(this,"type","Rotation3DOverLife"),K(this,"tempQuat",new Se),this.angularVelocity=e,this.dynamic=t}return At(n,[{key:"initialize",value:function(t){!this.dynamic&&t instanceof Qm&&(t.angularVelocity=new Se,this.angularVelocity.genValue(t.angularVelocity))}},{key:"update",value:function(t,i){this.dynamic?(this.angularVelocity.genValue(this.tempQuat,t.age/t.life),this.tempQuat.slerpQuaternions(KD,this.tempQuat,i),t.rotation.multiply(this.tempQuat)):t instanceof Qm&&(this.tempQuat.slerpQuaternions(KD,t.angularVelocity,i),t.rotation.multiply(this.tempQuat))}},{key:"toJSON",value:function(){return{type:this.type,angularVelocity:this.angularVelocity.toJSON(),dynamic:this.dynamic}}},{key:"frameUpdate",value:function(t){}},{key:"clone",value:function(){return new n(this.angularVelocity.clone(),this.dynamic)}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new n(h3(t.angularVelocity),t.dynamic)}}]),n}(),$D=function(){function n(e,t,i){mt(this,n),K(this,"type","ForceOverLife"),K(this,"_temp",new w),this.x=e,this.y=t,this.z=i}return At(n,[{key:"initialize",value:function(t){}},{key:"update",value:function(t){this._temp.set(this.x.genValue(t.age/t.life),this.y.genValue(t.age/t.life),this.z.genValue(t.age/t.life)),t.velocity.add(this._temp)}},{key:"toJSON",value:function(){return{type:this.type,x:this.x.toJSON(),y:this.y.toJSON(),z:this.z.toJSON()}}},{key:"frameUpdate",value:function(t){}},{key:"clone",value:function(){return new n(this.x.clone(),this.y.clone(),this.z.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new n(Mi(t.x),Mi(t.y),Mi(t.z))}}]),n}(),eO=function(){function n(e,t){mt(this,n),K(this,"type","Noise"),K(this,"generator",new u3),K(this,"duration",0),K(this,"temp",new w),this.frequency=e,this.power=t}return At(n,[{key:"initialize",value:function(t){t.startTime=this.duration}},{key:"update",value:function(t,i){this.temp.set(this.generator.noise2D(t.startTime*this.frequency.x,t.life/t.age*this.frequency.x),this.generator.noise2D(t.startTime*this.frequency.y+100.25,t.life/t.age*this.frequency.y+100.154),this.generator.noise2D(t.startTime*this.frequency.z+200.89,t.life/t.age*this.frequency.z+200.1)).multiply(this.power),t.position.addScaledVector(this.temp,i)}},{key:"toJSON",value:function(){return{type:this.type,frequency:[this.frequency.x,this.frequency.y,this.frequency.z],power:[this.power.x,this.power.y,this.power.z]}}},{key:"frameUpdate",value:function(t){this.duration+=t}},{key:"clone",value:function(){return new n(this.frequency.clone(),this.power.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new n(new w(t.frequency[0],t.frequency[1],t.frequency[2]),new w(t.power[0],t.power[1],t.power[2]))}}]),n}(),yte={ApplyForce:{type:"ApplyForce",constructor:QD,params:[["direction","vec3"],["magnitude","value"]],loadJSON:QD.fromJSON},Noise:{type:"Noise",constructor:eO,params:[["frequency","vec3"],["power","vec3"]],loadJSON:eO.fromJSON},TurbulenceField:{type:"TurbulenceField",constructor:JD,params:[["scale","vec3"],["octaves","number"],["velocityMultiplier","vec3"],["timeScale","vec3"]],loadJSON:JD.fromJSON},GravityForce:{type:"GravityForce",constructor:WD,params:[["center","vec3"],["magnitude","number"]],loadJSON:WD.fromJSON},ColorOverLife:{type:"ColorOverLife",constructor:kD,params:[["color","colorFunc"]],loadJSON:kD.fromJSON},RotationOverLife:{type:"RotationOverLife",constructor:LD,params:[["angularVelocity","valueFunc"],["dynamic","boolean"]],loadJSON:LD.fromJSON},Rotation3DOverLife:{type:"Rotation3DOverLife",constructor:ZD,params:[["angularVelocity","rotationFunc"],["dynamic","boolean"]],loadJSON:ZD.fromJSON},SizeOverLife:{type:"SizeOverLife",constructor:FD,params:[["size","valueFunc"]],loadJSON:FD.fromJSON},ColorBySpeed:{type:"ColorBySpeed",constructor:GD,params:[["color","colorFunc"],["speedRange","range"]],loadJSON:GD.fromJSON},RotationBySpeed:{type:"RotationBySpeed",constructor:ND,params:[["angularVelocity","valueFunc"],["speedRange","range"]],loadJSON:ND.fromJSON},SizeBySpeed:{type:"SizeBySpeed",constructor:zD,params:[["size","valueFunc"],["speedRange","range"]],loadJSON:zD.fromJSON},SpeedOverLife:{type:"SpeedOverLife",constructor:UD,params:[["speed","valueFunc"]],loadJSON:UD.fromJSON},FrameOverLife:{type:"FrameOverLife",constructor:VD,params:[["frame","valueFunc"]],loadJSON:VD.fromJSON},ForceOverLife:{type:"ForceOverLife",constructor:$D,params:[["x","valueFunc"],["y","valueFunc"],["z","valueFunc"]],loadJSON:$D.fromJSON},OrbitOverLife:{type:"OrbitOverLife",constructor:HD,params:[["orbitSpeed","valueFunc"],["axis","vec3"]],loadJSON:HD.fromJSON},WidthOverLength:{type:"WidthOverLength",constructor:jD,params:[["width","valueFunc"]],loadJSON:jD.fromJSON},ChangeEmitDirection:{type:"ChangeEmitDirection",constructor:qD,params:[["angle","value"]],loadJSON:qD.fromJSON},EmitSubParticleSystem:{type:"EmitSubParticleSystem",constructor:YD,params:[["particleSystem","self"],["useVelocityAsBasis","boolean"],["subParticleSystem","particleSystem"]],loadJSON:YD.fromJSON}};function bte(n,e){return yte[n.type].loadJSON(n,e)}var tO=function(){function n(){var e,t,i,s,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};mt(this,n),K(this,"type","cone"),K(this,"radius",void 0),K(this,"arc",void 0),K(this,"thickness",void 0),K(this,"angle",void 0),this.radius=(e=r.radius)!==null&&e!==void 0?e:10,this.arc=(t=r.arc)!==null&&t!==void 0?t:2*Math.PI,this.thickness=(i=r.thickness)!==null&&i!==void 0?i:1,this.angle=(s=r.angle)!==null&&s!==void 0?s:Math.PI/6}return At(n,[{key:"initialize",value:function(t){var i=Math.random(),s=cs.lerp(1-this.thickness,1,Math.random()),r=i*this.arc,o=Math.sqrt(s),a=Math.sin(r),l=Math.cos(r);t.position.x=o*l,t.position.y=o*a,t.position.z=0;var c=this.angle*o;t.velocity.set(0,0,Math.cos(c)).addScaledVector(t.position,Math.sin(c)).multiplyScalar(t.startSpeed),t.position.multiplyScalar(this.radius)}},{key:"toJSON",value:function(){return{type:"cone",radius:this.radius,arc:this.arc,thickness:this.thickness,angle:this.angle}}},{key:"clone",value:function(){return new n({radius:this.radius,arc:this.arc,thickness:this.thickness,angle:this.angle})}}],[{key:"fromJSON",value:function(t){return new n(t)}}]),n}(),iO=function(){function n(){var e,t,i,s,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};mt(this,n),K(this,"type","donut"),K(this,"radius",void 0),K(this,"arc",void 0),K(this,"thickness",void 0),K(this,"angle",void 0),this.radius=(e=r.radius)!==null&&e!==void 0?e:10,this.arc=(t=r.arc)!==null&&t!==void 0?t:2*Math.PI,this.thickness=(i=r.thickness)!==null&&i!==void 0?i:1,this.angle=(s=r.angle)!==null&&s!==void 0?s:Math.PI/6}return At(n,[{key:"initialize",value:function(t){var i=Math.random(),s=cs.lerp(this.thickness,1,Math.random()),r=i*this.arc,o=Math.sqrt(s),a=Math.sin(r),l=Math.cos(r);t.position.x=o*l,t.position.y=o*a,t.position.z=0;var c=this.angle*o;t.velocity.set(0,0,Math.cos(c)).addScaledVector(t.position,Math.sin(c)).multiplyScalar(t.startSpeed),t.position.multiplyScalar(this.radius)}},{key:"toJSON",value:function(){return{type:"donut",radius:this.radius,arc:this.arc,thickness:this.thickness,angle:this.angle}}},{key:"clone",value:function(){return new n({radius:this.radius,arc:this.arc,thickness:this.thickness,angle:this.angle})}}],[{key:"fromJSON",value:function(t){return new n(t)}}]),n}(),nO=function(){function n(){mt(this,n),K(this,"type","point")}return At(n,[{key:"initialize",value:function(t){var i=Math.random(),s=Math.random(),r=i*Math.PI*2,o=Math.acos(2*s-1),a=Math.cbrt(Math.random()),l=Math.sin(r),c=Math.cos(r),u=Math.sin(o),d=Math.cos(o);t.velocity.x=a*u*c,t.velocity.y=a*u*l,t.velocity.z=a*d,t.velocity.multiplyScalar(t.startSpeed),t.position.setScalar(0)}},{key:"toJSON",value:function(){return{type:"point"}}},{key:"clone",value:function(){return new n}}],[{key:"fromJSON",value:function(t){return new n}}]),n}(),TE=function(){function n(){var e,t,i,s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};mt(this,n),K(this,"type","sphere"),K(this,"radius",void 0),K(this,"arc",void 0),K(this,"thickness",void 0),this.radius=(e=s.radius)!==null&&e!==void 0?e:10,this.arc=(t=s.arc)!==null&&t!==void 0?t:2*Math.PI,this.thickness=(i=s.thickness)!==null&&i!==void 0?i:1}return At(n,[{key:"initialize",value:function(t){var i=Math.random(),s=Math.random(),r=cs.lerp(1-this.thickness,1,Math.random()),o=i*this.arc,a=Math.acos(2*s-1),l=Math.cbrt(r),c=Math.sin(o),u=Math.cos(o),d=Math.sin(a),f=Math.cos(a);t.position.x=l*d*u,t.position.y=l*d*c,t.position.z=l*f,t.velocity.setScalar(0).addScaledVector(t.position,t.startSpeed),t.position.multiplyScalar(this.radius)}},{key:"toJSON",value:function(){return{type:"sphere",radius:this.radius,arc:this.arc,thickness:this.thickness}}},{key:"clone",value:function(){return new n({radius:this.radius,arc:this.arc,thickness:this.thickness})}}],[{key:"fromJSON",value:function(t){return new n(t)}}]),n}(),sO=function(){function n(e){mt(this,n),K(this,"type","mesh_surface"),K(this,"_triangleIndexToArea",[]),K(this,"_geometry",void 0),K(this,"_tempA",new w),K(this,"_tempB",new w),K(this,"_tempC",new w),e&&(this.geometry=e)}return At(n,[{key:"geometry",get:function(){return this._geometry},set:function(t){if(this._geometry=t,t!==void 0&&typeof t!="string"){var i=new Vs;this._triangleIndexToArea.length=0;var s=0;if(t.getIndex()){var r=t.getIndex().array,o=r.length/3;this._triangleIndexToArea.push(0);for(var a=0;a<o;a++)i.setFromAttributeAndIndices(t.getAttribute("position"),r[a*3],r[a*3+1],r[a*3+2]),s+=i.getArea(),this._triangleIndexToArea.push(s);t.userData.triangleIndexToArea=this._triangleIndexToArea}}}},{key:"initialize",value:function(t){var i=this._geometry;if(!i||i.getIndex()===null){t.position.set(0,0,0),t.velocity.set(0,0,1).multiplyScalar(t.startSpeed);return}for(var s=this._triangleIndexToArea.length-1,r=0,o=s,a=Math.random()*this._triangleIndexToArea[s];r+1<o;){var l=Math.floor((r+o)/2);a<this._triangleIndexToArea[l]?o=l:r=l}var c=Math.random(),u=Math.random();c+u>1&&(c=1-c,u=1-u);var d=i.getIndex().array[r*3],f=i.getIndex().array[r*3+1],p=i.getIndex().array[r*3+2],g=i.getAttribute("position");this._tempA.fromBufferAttribute(g,d),this._tempB.fromBufferAttribute(g,f),this._tempC.fromBufferAttribute(g,p),this._tempB.sub(this._tempA),this._tempC.sub(this._tempA),this._tempA.addScaledVector(this._tempB,c).addScaledVector(this._tempC,u),t.position.copy(this._tempA),this._tempA.copy(this._tempB).cross(this._tempC).normalize(),t.velocity.copy(this._tempA).normalize().multiplyScalar(t.startSpeed)}},{key:"toJSON",value:function(){return{type:"mesh_surface",mesh:this._geometry?this._geometry.uuid:""}}},{key:"clone",value:function(){return new n(this._geometry)}}],[{key:"fromJSON",value:function(t,i){return new n(i.geometries[t.geometry])}}]),n}(),rO=function(){function n(){var e,t,i,s,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};mt(this,n),K(this,"type","grid"),K(this,"width",void 0),K(this,"height",void 0),K(this,"column",void 0),K(this,"row",void 0),this.width=(e=r.width)!==null&&e!==void 0?e:1,this.height=(t=r.height)!==null&&t!==void 0?t:1,this.column=(i=r.column)!==null&&i!==void 0?i:10,this.row=(s=r.row)!==null&&s!==void 0?s:10}return At(n,[{key:"initialize",value:function(t){var i=Math.floor(Math.random()*this.row),s=Math.floor(Math.random()*this.column);t.position.x=s*this.width/this.column-this.width/2,t.position.y=i*this.height/this.row-this.height/2,t.position.z=0,t.velocity.set(0,0,t.startSpeed)}},{key:"toJSON",value:function(){return{type:"grid",width:this.width,height:this.height,column:this.column,row:this.row}}},{key:"clone",value:function(){return new n({width:this.width,height:this.height,column:this.column,row:this.row})}}],[{key:"fromJSON",value:function(t){return new n(t)}}]),n}(),_te={cone:{type:"cone",params:[["radius","number"],["arc","radian"],["thickness","number"],["angle","radian"]],constructor:tO,loadJSON:tO.fromJSON},donut:{type:"donut",params:[["radius","number"],["arc","radian"],["thickness","number"],["angle","radian"]],constructor:iO,loadJSON:iO.fromJSON},point:{type:"point",params:[],constructor:nO,loadJSON:nO.fromJSON},sphere:{type:"sphere",params:[["radius","number"],["arc","radian"],["thickness","number"],["angle","radian"]],constructor:TE,loadJSON:TE.fromJSON},grid:{type:"grid",params:[["width","number"],["height","number"],["rows","number"],["column","number"]],constructor:rO,loadJSON:rO.fromJSON},mesh_surface:{type:"mesh_surface",params:[["geometry","geometry"]],constructor:sO,loadJSON:sO.fromJSON}};function xte(n,e){return _te[n.type].loadJSON(n,e)}var nt=function(n){return n[n.BillBoard=0]="BillBoard",n[n.StretchedBillBoard=1]="StretchedBillBoard",n[n.Mesh=2]="Mesh",n[n.Trail=3]="Trail",n[n.HorizontalBillBoard=4]="HorizontalBillBoard",n[n.VerticalBillBoard=5]="VerticalBillBoard",n}({}),d3=function(n){yp(t,n);var e=bp(t);function t(i){var s;mt(this,t),s=e.call(this),K(Ht(s),"type","VFXBatch"),K(Ht(s),"systems",void 0),K(Ht(s),"settings",void 0),K(Ht(s),"maxParticles",void 0),s.maxParticles=1e3,s.systems=new Set;var r=new Ss;return r.mask=i.layers.mask,s.settings={instancingGeometry:i.instancingGeometry,renderMode:i.renderMode,renderOrder:i.renderOrder,material:i.material.clone(),uTileCount:i.uTileCount,vTileCount:i.vTileCount,layers:r},s.frustumCulled=!1,s.renderOrder=s.settings.renderOrder,s}return At(t,[{key:"addSystem",value:function(s){this.systems.add(s)}},{key:"removeSystem",value:function(s){this.systems.delete(s)}}]),t}(ye),wte=new w(0,0,1),fS=new Se,Ste=new w,Cte=new w;new w;var oO=60,Ete=new us(1,1,1,1),Mte=function(){function n(e){var t,i,s,r,o,a,l,c,u,d,f,p,g,A,v,m,b,y,_,E,M;mt(this,n),K(this,"autoDestroy",void 0),K(this,"prewarm",void 0),K(this,"looping",void 0),K(this,"duration",void 0),K(this,"startLife",void 0),K(this,"startSpeed",void 0),K(this,"startRotation",void 0),K(this,"startSize",void 0),K(this,"startColor",void 0),K(this,"startTileIndex",void 0),K(this,"rendererEmitterSettings",void 0),K(this,"emissionOverTime",void 0),K(this,"emissionOverDistance",void 0),K(this,"emissionBursts",void 0),K(this,"onlyUsedByOther",void 0),K(this,"worldSpace",void 0),K(this,"speedFactor",void 0),K(this,"particleNum",void 0),K(this,"paused",void 0),K(this,"particles",void 0),K(this,"emitterShape",void 0),K(this,"emitter",void 0),K(this,"rendererSettings",void 0),K(this,"neededToUpdateRender",void 0),K(this,"behaviors",void 0),K(this,"prewarmed",void 0),K(this,"emissionState",void 0),K(this,"emitEnded",void 0),K(this,"markForDestroy",void 0),K(this,"previousWorldPos",void 0),K(this,"temp",new w),K(this,"travelDistance",0),K(this,"normalMatrix",new It),K(this,"_renderer",void 0),this.autoDestroy=e.autoDestroy===void 0?!1:e.autoDestroy,this.duration=(t=e.duration)!==null&&t!==void 0?t:1,this.looping=e.looping===void 0?!0:e.looping,this.prewarm=e.prewarm===void 0?!1:e.prewarm,this.startLife=(i=e.startLife)!==null&&i!==void 0?i:new _s(5),this.startSpeed=(s=e.startSpeed)!==null&&s!==void 0?s:new _s(0),this.startRotation=(r=e.startRotation)!==null&&r!==void 0?r:new _s(0),this.startSize=(o=e.startSize)!==null&&o!==void 0?o:new _s(1),this.startColor=(a=e.startColor)!==null&&a!==void 0?a:new K0(new Ke(1,1,1,1)),this.emissionOverTime=(l=e.emissionOverTime)!==null&&l!==void 0?l:new _s(10),this.emissionOverDistance=(c=e.emissionOverDistance)!==null&&c!==void 0?c:new _s(0),this.emissionBursts=(u=e.emissionBursts)!==null&&u!==void 0?u:[],this.onlyUsedByOther=(d=e.onlyUsedByOther)!==null&&d!==void 0?d:!1,this.emitterShape=(f=e.shape)!==null&&f!==void 0?f:new TE,this.behaviors=(p=e.behaviors)!==null&&p!==void 0?p:new Array,this.worldSpace=(g=e.worldSpace)!==null&&g!==void 0?g:!1,this.speedFactor=(A=e.speedFactor)!==null&&A!==void 0?A:0,this.rendererEmitterSettings=(v=e.rendererEmitterSettings)!==null&&v!==void 0?v:{},this.rendererSettings={instancingGeometry:(m=e.instancingGeometry)!==null&&m!==void 0?m:Ete,renderMode:(b=e.renderMode)!==null&&b!==void 0?b:nt.BillBoard,renderOrder:(y=e.renderOrder)!==null&&y!==void 0?y:0,material:e.material,uTileCount:(_=e.uTileCount)!==null&&_!==void 0?_:1,vTileCount:(E=e.vTileCount)!==null&&E!==void 0?E:1,layers:(M=e.layers)!==null&&M!==void 0?M:new Ss},this.neededToUpdateRender=!0,this.particles=new Array,this.startTileIndex=e.startTileIndex||new _s(0),this.emitter=new tte(this),this.paused=!1,this.particleNum=0,this.emissionState={burstIndex:0,burstWaveIndex:0,time:0,waitEmiting:0},this.emitEnded=!1,this.markForDestroy=!1,this.prewarmed=!1}return At(n,[{key:"time",get:function(){return this.emissionState.time},set:function(t){this.emissionState.time=t}},{key:"layers",get:function(){return this.rendererSettings.layers}},{key:"texture",get:function(){return this.rendererSettings.material.map},set:function(t){this.rendererSettings.material.map=t,this.neededToUpdateRender=!0}},{key:"material",get:function(){return this.rendererSettings.material},set:function(t){this.rendererSettings.material=t,this.neededToUpdateRender=!0}},{key:"uTileCount",get:function(){return this.rendererSettings.uTileCount},set:function(t){this.rendererSettings.uTileCount=t,this.neededToUpdateRender=!0}},{key:"vTileCount",get:function(){return this.rendererSettings.vTileCount},set:function(t){this.rendererSettings.vTileCount=t,this.neededToUpdateRender=!0}},{key:"instancingGeometry",get:function(){return this.rendererSettings.instancingGeometry},set:function(t){this.restart(),this.particles.length=0,this.rendererSettings.instancingGeometry=t,this.neededToUpdateRender=!0}},{key:"renderMode",get:function(){return this.rendererSettings.renderMode},set:function(t){if((this.rendererSettings.renderMode!=nt.Trail&&t===nt.Trail||this.rendererSettings.renderMode==nt.Trail&&t!==nt.Trail)&&(this.restart(),this.particles.length=0),this.rendererSettings.renderMode!==t)switch(t){case nt.Trail:this.rendererEmitterSettings={startLength:new _s(30),followLocalOrigin:!1};break;case nt.Mesh:this.rendererEmitterSettings={geometry:new us(1,1)},this.startRotation=new c3(new w(0,1,0),new _s(0));break;case nt.BillBoard:case nt.VerticalBillBoard:case nt.HorizontalBillBoard:case nt.StretchedBillBoard:this.rendererEmitterSettings={},this.rendererSettings.renderMode===nt.Mesh&&(this.startRotation=new _s(0));break}this.rendererSettings.renderMode=t,this.neededToUpdateRender=!0}},{key:"renderOrder",get:function(){return this.rendererSettings.renderOrder},set:function(t){this.rendererSettings.renderOrder=t,this.neededToUpdateRender=!0}},{key:"blending",get:function(){return this.rendererSettings.material.blending},set:function(t){this.rendererSettings.material.blending=t,this.neededToUpdateRender=!0}},{key:"pause",value:function(){this.paused=!0}},{key:"play",value:function(){this.paused=!1}},{key:"spawn",value:function(t,i,s){fS.setFromRotationMatrix(s);var r=Ste,o=fS,a=Cte;s.decompose(r,o,a);for(var l=0;l<t;l++){for(this.particleNum++;this.particles.length<this.particleNum;)this.rendererSettings.renderMode===nt.Trail?this.particles.push(new Wm):this.particles.push(new Qm);var c=this.particles[this.particleNum-1];if(this.startColor.genColor(c.startColor,this.emissionState.time,{}),c.color.copy(c.startColor),c.startSpeed=this.startSpeed.genValue(i.time/this.duration),c.life=this.startLife.genValue(i.time/this.duration),c.age=0,c.startSize=this.startSize.genValue(i.time/this.duration),c.uvTile=Math.floor(this.startTileIndex.genValue()),c.size=c.startSize,this.rendererSettings.renderMode===nt.Mesh||this.rendererSettings.renderMode===nt.BillBoard||this.rendererSettings.renderMode===nt.VerticalBillBoard||this.rendererSettings.renderMode===nt.HorizontalBillBoard||this.rendererSettings.renderMode===nt.StretchedBillBoard){var u=c;this.rendererSettings.renderMode===nt.Mesh?(u.rotation instanceof Se||(u.rotation=new Se),this.startRotation.type==="rotation"?this.startRotation.genValue(u.rotation,i.time/this.duration):u.rotation.setFromAxisAngle(wte,this.startRotation.genValue(i.time/this.duration))):this.startRotation.type==="rotation"?u.rotation=0:u.rotation=this.startRotation.genValue(i.time/this.duration)}else if(this.rendererSettings.renderMode===nt.Trail){var d=c;d.length=this.rendererEmitterSettings.startLength.genValue(i.time/this.duration),d.reset()}if(this.emitterShape.initialize(c),this.rendererSettings.renderMode===nt.Trail&&this.rendererEmitterSettings.followLocalOrigin){var f=c;f.localPosition=new w().copy(f.position)}this.worldSpace?(c.position.applyMatrix4(s),c.startSize=c.startSize*(Math.abs(a.x)+Math.abs(a.y)+Math.abs(a.z))/3,c.size=c.startSize,c.velocity.multiply(a).applyMatrix3(this.normalMatrix),c.rotation&&c.rotation instanceof Se&&c.rotation.multiplyQuaternions(fS,c.rotation)):this.onlyUsedByOther&&(c.parentMatrix=s);for(var p=0;p<this.behaviors.length;p++)this.behaviors[p].initialize(c)}}},{key:"endEmit",value:function(){this.emitEnded=!0,this.autoDestroy&&(this.markForDestroy=!0)}},{key:"dispose",value:function(){this._renderer&&this._renderer.deleteSystem(this),this.emitter.dispose(),this.emitter.parent&&this.emitter.parent.remove(this.emitter)}},{key:"restart",value:function(){this.paused=!1,this.particleNum=0,this.emissionState.burstIndex=0,this.emissionState.burstWaveIndex=0,this.emissionState.time=0,this.emissionState.waitEmiting=0,this.behaviors.forEach(function(t){t.reset()}),this.emitEnded=!1,this.markForDestroy=!1,this.prewarmed=!1}},{key:"update",value:function(t){if(!this.paused){for(var i=this.emitter;i.parent;)i=i.parent;if(i.type!=="Scene"){this.dispose();return}if(this.emitEnded&&this.particleNum===0){this.markForDestroy&&this.emitter.parent&&this.dispose();return}if(this.looping&&this.prewarm&&!this.prewarmed){this.prewarmed=!0;for(var s=0;s<this.duration*oO;s++)this.update(1/oO)}t>.1&&(t=.1),this.neededToUpdateRender&&(this._renderer&&this._renderer.updateSystem(this),this.neededToUpdateRender=!1),this.onlyUsedByOther||this.emit(t,this.emissionState,this.emitter.matrixWorld);for(var r=0;r<this.behaviors.length;r++){for(var o=0;o<this.particleNum;o++)this.particles[o].died||this.behaviors[r].update(this.particles[o],t);this.behaviors[r].frameUpdate(t)}for(var a=0;a<this.particleNum;a++)this.rendererEmitterSettings.followLocalOrigin&&this.particles[a].localPosition?(this.particles[a].position.copy(this.particles[a].localPosition),this.particles[a].parentMatrix?this.particles[a].position.applyMatrix4(this.particles[a].parentMatrix):this.particles[a].position.applyMatrix4(this.emitter.matrixWorld)):this.particles[a].position.addScaledVector(this.particles[a].velocity,t),this.particles[a].age+=t;if(this.rendererSettings.renderMode===nt.Trail)for(var l=0;l<this.particleNum;l++){var c=this.particles[l];c.update()}for(var u=0;u<this.particleNum;u++){var d=this.particles[u];d.died&&(!(d instanceof Wm)||d.previous.length===0)&&(this.particles[u]=this.particles[this.particleNum-1],this.particles[this.particleNum-1]=d,this.particleNum--,u--)}}}},{key:"emit",value:function(t,i,s){i.time>this.duration&&(this.looping?(i.time-=this.duration,i.burstIndex=0,this.behaviors.forEach(function(c){c.reset()})):!this.emitEnded&&!this.onlyUsedByOther&&this.endEmit()),this.normalMatrix.getNormalMatrix(s);var r=Math.ceil(i.waitEmiting);for(this.spawn(r,i,s),i.waitEmiting-=r;i.burstIndex<this.emissionBursts.length&&this.emissionBursts[i.burstIndex].time<=i.time;){if(Math.random()<this.emissionBursts[i.burstIndex].probability){var o=this.emissionBursts[i.burstIndex].count;this.spawn(o,i,s)}i.burstIndex++}if(!this.emitEnded&&(i.waitEmiting+=t*this.emissionOverTime.genValue(i.time/this.duration),this.previousWorldPos!=null)){this.emitter.getWorldPosition(this.temp),this.travelDistance+=this.previousWorldPos.distanceTo(this.temp);var a=this.emissionOverDistance.genValue(i.time/this.duration);if(this.travelDistance*a>0){var l=Math.floor(this.travelDistance*a);this.travelDistance-=l/a,i.waitEmiting+=l}}this.previousWorldPos===void 0&&(this.previousWorldPos=new w),this.emitter.getWorldPosition(this.previousWorldPos),i.time+=t}},{key:"toJSON",value:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=t===void 0||typeof t=="string";if(s&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}}),t.materials[this.rendererSettings.material.uuid]=this.rendererSettings.material.toJSON(t),i.useUrlForImage&&this.texture.source!==void 0){var r=this.texture.source;t.images[r.uuid]={uuid:r.uuid,url:this.texture.image.url}}var o;this.renderMode===nt.Trail?o={startLength:this.rendererEmitterSettings.startLength.toJSON(),followLocalOrigin:this.rendererEmitterSettings.followLocalOrigin}:this.renderMode===nt.Mesh?o={}:o={};var a=this.rendererSettings.instancingGeometry;return t.geometries&&!t.geometries[a.uuid]&&(t.geometries[a.uuid]=a.toJSON()),{version:"2.0",autoDestroy:this.autoDestroy,looping:this.looping,prewarm:this.prewarm,duration:this.duration,shape:this.emitterShape.toJSON(),startLife:this.startLife.toJSON(),startSpeed:this.startSpeed.toJSON(),startRotation:this.startRotation.toJSON(),startSize:this.startSize.toJSON(),startColor:this.startColor.toJSON(),emissionOverTime:this.emissionOverTime.toJSON(),emissionOverDistance:this.emissionOverDistance.toJSON(),emissionBursts:this.emissionBursts,onlyUsedByOther:this.onlyUsedByOther,instancingGeometry:this.rendererSettings.instancingGeometry.uuid,renderOrder:this.renderOrder,renderMode:this.renderMode,rendererEmitterSettings:o,speedFactor:this.renderMode===nt.StretchedBillBoard?this.speedFactor:0,material:this.rendererSettings.material.uuid,layers:this.layers.mask,startTileIndex:this.startTileIndex.toJSON(),uTileCount:this.uTileCount,vTileCount:this.vTileCount,behaviors:this.behaviors.map(function(l){return l.toJSON()}),worldSpace:this.worldSpace}}},{key:"addBehavior",value:function(t){this.behaviors.push(t)}},{key:"getRendererSettings",value:function(){return this.rendererSettings}},{key:"clone",value:function(){var t=[],i=DD(this.emissionBursts),s;try{for(i.s();!(s=i.n()).done;){var r=s.value,o={};Object.assign(o,r),t.push(o)}}catch(p){i.e(p)}finally{i.f()}var a=[],l=DD(this.behaviors),c;try{for(l.s();!(c=l.n()).done;){var u=c.value;a.push(u.clone())}}catch(p){l.e(p)}finally{l.f()}var d;this.renderMode===nt.Trail?d={startLength:this.rendererEmitterSettings.startLength.clone(),followLocalOrigin:this.rendererEmitterSettings.followLocalOrigin}:d={};var f=new Ss;return f.mask=this.layers.mask,new n({autoDestroy:this.autoDestroy,looping:this.looping,duration:this.duration,shape:this.emitterShape.clone(),startLife:this.startLife.clone(),startSpeed:this.startSpeed.clone(),startRotation:this.startRotation.clone(),startSize:this.startSize.clone(),startColor:this.startColor.clone(),emissionOverTime:this.emissionOverTime.clone(),emissionOverDistance:this.emissionOverDistance.clone(),emissionBursts:t,onlyUsedByOther:this.onlyUsedByOther,instancingGeometry:this.rendererSettings.instancingGeometry,renderMode:this.renderMode,renderOrder:this.renderOrder,rendererEmitterSettings:d,speedFactor:this.speedFactor,material:this.rendererSettings.material,startTileIndex:this.startTileIndex,uTileCount:this.uTileCount,vTileCount:this.vTileCount,behaviors:a,worldSpace:this.worldSpace,layers:f})}}],[{key:"fromJSON",value:function(t,i,s){var r,o=xte(t.shape,i),a;t.renderMode===nt.Trail?a={startLength:t.rendererEmitterSettings.startLength!=null?Mi(t.rendererEmitterSettings.startLength):new _s(30),followLocalOrigin:t.rendererEmitterSettings.followLocalOrigin}:t.renderMode===nt.Mesh?a={}:a={};var l=new Ss;t.layers&&(l.mask=t.layers);var c=new n({autoDestroy:t.autoDestroy,looping:t.looping,prewarm:t.prewarm,duration:t.duration,shape:o,startLife:Mi(t.startLife),startSpeed:Mi(t.startSpeed),startRotation:ute(t.startRotation),startSize:Mi(t.startSize),startColor:P1(t.startColor),emissionOverTime:Mi(t.emissionOverTime),emissionOverDistance:Mi(t.emissionOverDistance),emissionBursts:t.emissionBursts,onlyUsedByOther:t.onlyUsedByOther,instancingGeometry:i.geometries[t.instancingGeometry],renderMode:t.renderMode,rendererEmitterSettings:a,renderOrder:t.renderOrder,speedFactor:t.speedFactor,layers:l,material:t.material?i.materials[t.material]:t.texture?new ai({map:i.textures[t.texture],transparent:(r=t.transparent)!==null&&r!==void 0?r:!0,blending:t.blending,side:wi}):new ai({color:16777215,transparent:!0,blending:Mf,side:wi}),startTileIndex:typeof t.startTileIndex=="number"?new _s(t.startTileIndex):Mi(t.startTileIndex),uTileCount:t.uTileCount,vTileCount:t.vTileCount,behaviors:[],worldSpace:t.worldSpace});return c.behaviors=t.behaviors.map(function(u){var d=bte(u,c);return d.type==="EmitSubParticleSystem"&&(s[u.subParticleSystem]=d),d}),c}}]),n}(),pS=`

#include <common>
#include <uv_pars_fragment>
#include <color_pars_fragment>
#include <map_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
#include <alphatest_pars_fragment>

void main() {

    #include <clipping_planes_fragment>
    
    vec3 outgoingLight = vec3( 0.0 );
    vec4 diffuseColor = vColor;
    
    #include <logdepthbuf_fragment>
    
    #ifdef USE_MAP
    diffuseColor *= texture2D( map, vMapUv);
    #endif
    
    #include <alphatest_fragment>

    outgoingLight = diffuseColor.rgb;
    
    gl_FragColor = vec4( outgoingLight, diffuseColor.a );
    
    #include <tonemapping_fragment>

}
`,Tte=`
#define STANDARD
#ifdef PHYSICAL
#define IOR
#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
uniform float ior;
#endif
#ifdef SPECULAR
uniform float specularIntensity;
uniform vec3 specularColor;
#ifdef USE_SPECULARINTENSITYMAP
uniform sampler2D specularIntensityMap;
#endif
#ifdef USE_SPECULARCOLORMAP
uniform sampler2D specularColorMap;
#endif
#endif
#ifdef USE_CLEARCOAT
uniform float clearcoat;
uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
uniform float iridescence;
uniform float iridescenceIOR;
uniform float iridescenceThicknessMinimum;
uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
uniform vec3 sheenColor;
uniform float sheenRoughness;
#ifdef USE_SHEENCOLORMAP
uniform sampler2D sheenColorMap;
#endif
#ifdef USE_SHEENROUGHNESSMAP
uniform sampler2D sheenRoughnessMap;
#endif
#endif

varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

void main() {
    #include <clipping_planes_fragment>
    vec4 diffuseColor = vec4( diffuse, opacity );
    ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
    vec3 totalEmissiveRadiance = emissive;
    #include <logdepthbuf_fragment>
    #include <map_fragment>
    #include <color_fragment>
    #include <alphamap_fragment>
    #include <alphatest_fragment>
    #include <roughnessmap_fragment>
    #include <metalnessmap_fragment>
    #include <normal_fragment_begin>
    #include <normal_fragment_maps>
    #include <clearcoat_normal_fragment_begin>
    #include <clearcoat_normal_fragment_maps>
    #include <emissivemap_fragment>
    // accumulation
    #include <lights_physical_fragment>
    #include <lights_fragment_begin>
    #include <lights_fragment_maps>
    #include <lights_fragment_end>
    // modulation
    #include <aomap_fragment>
    vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
    vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
    #include <transmission_fragment>
    vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
    #ifdef USE_SHEEN
    // Sheen energy compensation approximation calculation can be found at the end of
        // https://drive.google.com/file/d/1T0D1VSyR4AllqIJTQAraEIzjlb5h4FKH/view?usp=sharing
        float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
        outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
    #endif
    #ifdef USE_CLEARCOAT
        float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
        vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
        outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
    #endif
    #include <output_fragment>
    #include <tonemapping_fragment>
    #include <encodings_fragment>
    #include <fog_fragment>
    #include <premultiplied_alpha_fragment>
    #include <dithering_fragment>
}`,DA=`

    #ifdef UV_TILE
        float col = mod(uvTile, tileCount.x);
        float row = (tileCount.y - floor(uvTile / tileCount.x) - 1.0);
        
        mat3 tileTransform = mat3(
          1.0 / tileCount.x, 0.0, 0.0,
          0.0, 1.0 / tileCount.y, 0.0, 
          col / tileCount.x, row / tileCount.y, 1.0);
    #else
        mat3 tileTransform = mat3(1.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0);
    #endif

#if defined( USE_UV ) || defined( USE_ANISOTROPY )

vUv = (tileTransform *vec3( uv, 1 )).xy;

#endif
#ifdef USE_MAP

vMapUv = ( tileTransform * (mapTransform * vec3( MAP_UV, 1 ) )).xy;

#endif
#ifdef USE_ALPHAMAP

vAlphaMapUv = ( tileTransform * (alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_LIGHTMAP

vLightMapUv = ( tileTransform * (lightMapTransform * vec3( LIGHTMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_AOMAP

vAoMapUv = ( tileTransform * (aoMapTransform * vec3( AOMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_BUMPMAP

vBumpMapUv = ( tileTransform * (bumpMapTransform * vec3( BUMPMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_NORMALMAP

vNormalMapUv = ( tileTransform * (normalMapTransform * vec3( NORMALMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_DISPLACEMENTMAP

vDisplacementMapUv = ( tileTransform * (displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_EMISSIVEMAP

vEmissiveMapUv = ( tileTransform * (emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_METALNESSMAP

vMetalnessMapUv = ( tileTransform * (metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_ROUGHNESSMAP

vRoughnessMapUv = ( tileTransform * (roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_ANISOTROPYMAP

vAnisotropyMapUv = ( tileTransform * (anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_CLEARCOATMAP

vClearcoatMapUv = ( tileTransform * (clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_CLEARCOAT_NORMALMAP

vClearcoatNormalMapUv = ( tileTransform * (clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP

vClearcoatRoughnessMapUv = ( tileTransform * (clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_IRIDESCENCEMAP

vIridescenceMapUv = ( tileTransform * (iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP

vIridescenceThicknessMapUv = ( tileTransform * (iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_SHEEN_COLORMAP

vSheenColorMapUv = ( tileTransform * (sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_SHEEN_ROUGHNESSMAP

vSheenRoughnessMapUv = ( tileTransform * (sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_SPECULARMAP

vSpecularMapUv = ( tileTransform * (specularMapTransform * vec3( SPECULARMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_SPECULAR_COLORMAP

vSpecularColorMapUv = ( tileTransform * (specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_SPECULAR_INTENSITYMAP

vSpecularIntensityMapUv = ( tileTransform * (specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_TRANSMISSIONMAP

vTransmissionMapUv = ( tileTransform * transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_THICKNESSMAP

vThicknessMapUv = ( tileTransform * thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) )).xy;

#endif
`,Ite=`
#include <common>
#include <color_pars_vertex>
#include <uv_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

attribute vec3 offset;
attribute float rotation;
attribute float size;
attribute float uvTile;

#ifdef UV_TILE
uniform vec2 tileCount;
#endif

void main() {

    `.concat(DA,`
	
    vec2 alignedPosition = ( position.xy ) * size;
    
    vec2 rotatedPosition;
    rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
    rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
#ifdef HORIZONTAL
    vec4 mvPosition = modelMatrix * vec4( offset, 1.0 );
    mvPosition.x += rotatedPosition.x;
    mvPosition.z -= rotatedPosition.y;
    mvPosition = viewMatrix * mvPosition;
#elif defined(VERTICAL)
    vec4 mvPosition = modelMatrix * vec4( offset, 1.0 );
    mvPosition.y += rotatedPosition.y;
    mvPosition = viewMatrix * mvPosition;
    mvPosition.x += rotatedPosition.x;
#else
    vec4 mvPosition = modelViewMatrix * vec4( offset, 1.0 );
    mvPosition.xy += rotatedPosition;
#endif

	vColor = color;

	gl_Position = projectionMatrix * mvPosition;

	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>

}
`),Rte=`
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

attribute vec3 offset;
attribute vec4 rotation;
attribute float size;
// attribute vec4 color;
attribute float uvTile;

#ifdef UV_TILE
uniform vec2 tileCount;
#endif

void main() {

    `.concat(DA,`
    
    float x2 = rotation.x + rotation.x, y2 = rotation.y + rotation.y, z2 = rotation.z + rotation.z;
    float xx = rotation.x * x2, xy = rotation.x * y2, xz = rotation.x * z2;
    float yy = rotation.y * y2, yz = rotation.y * z2, zz = rotation.z * z2;
    float wx = rotation.w * x2, wy = rotation.w * y2, wz = rotation.w * z2;
    float sx = size, sy = size, sz = size;
    
    mat4 matrix = mat4(( 1.0 - ( yy + zz ) ) * sx, ( xy + wz ) * sx, ( xz - wy ) * sx, 0.0,  // 1. column
                      ( xy - wz ) * sy, ( 1.0 - ( xx + zz ) ) * sy, ( yz + wx ) * sy, 0.0,  // 2. column
                      ( xz + wy ) * sz, ( yz - wx ) * sz, ( 1.0 - ( xx + yy ) ) * sz, 0.0,  // 3. column
                      offset.x, offset.y, offset.z, 1.0);
    
    vec4 mvPosition = modelViewMatrix * (matrix * vec4( position, 1.0 ));

	vColor = color;

	gl_Position = projectionMatrix * mvPosition;

	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>

}
`),Pte=`
#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>

attribute vec3 offset;
attribute vec4 rotation;
attribute float size;
attribute float uvTile;

#ifdef UV_TILE
uniform vec2 tileCount;
#endif

#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

void main() {
    `.concat(DA,`

    float x2 = rotation.x + rotation.x, y2 = rotation.y + rotation.y, z2 = rotation.z + rotation.z;
    float xx = rotation.x * x2, xy = rotation.x * y2, xz = rotation.x * z2;
    float yy = rotation.y * y2, yz = rotation.y * z2, zz = rotation.z * z2;
    float wx = rotation.w * x2, wy = rotation.w * y2, wz = rotation.w * z2;
    float sx = size, sy = size, sz = size;

    mat4 particleMatrix = mat4(( 1.0 - ( yy + zz ) ) * sx, ( xy + wz ) * sx, ( xz - wy ) * sx, 0.0,  // 1. column
                      ( xy - wz ) * sy, ( 1.0 - ( xx + zz ) ) * sy, ( yz + wx ) * sy, 0.0,  // 2. column
                      ( xz + wy ) * sz, ( yz - wx ) * sz, ( 1.0 - ( xx + yy ) ) * sz, 0.0,  // 3. column
                      offset.x, offset.y, offset.z, 1.0);

	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>

	// replace defaultnormal_vertex
	vec3 transformedNormal = objectNormal;
    mat3 m = mat3( particleMatrix );
    transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
    transformedNormal = m * transformedNormal;
    transformedNormal = normalMatrix * transformedNormal;
    #ifdef FLIP_SIDED
        transformedNormal = - transformedNormal;
    #endif
    #ifdef USE_TANGENT
        vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
        #ifdef FLIP_SIDED
        transformedTangent = - transformedTangent;
        #endif
    #endif

	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>

	// replace include <project_vertex>
  vec4 mvPosition = vec4( transformed, 1.0 );
  mvPosition = modelViewMatrix * (particleMatrix * mvPosition);
	gl_Position = projectionMatrix * mvPosition;

	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	
	vViewPosition = - mvPosition.xyz;
	
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}
`),Bte=`
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

attribute vec3 offset;
attribute float rotation;
attribute float size;
attribute vec3 velocity;
attribute float uvTile;

#ifdef UV_TILE
uniform vec2 tileCount;
#endif

uniform float speedFactor;

void main() {

    `.concat(DA,`
	
    vec4 mvPosition = modelViewMatrix * vec4( offset, 1.0 );
    vec3 viewVelocity = normalMatrix * velocity;

    vec3 scaledPos = vec3(position.xy * size, position.z);
    mvPosition.xyz += scaledPos + dot(scaledPos, viewVelocity) * viewVelocity / length(viewVelocity) * speedFactor;

	vColor = color;

	gl_Position = projectionMatrix * mvPosition;

	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>

}
`);function IE(n){return n===0?"uv":"uv".concat(n)}new w(0,0,1);var Dte=function(n){yp(t,n);var e=bp(t);function t(i){var s;return mt(this,t),s=e.call(this,i),K(Ht(s),"offsetBuffer",void 0),K(Ht(s),"rotationBuffer",void 0),K(Ht(s),"sizeBuffer",void 0),K(Ht(s),"colorBuffer",void 0),K(Ht(s),"uvTileBuffer",void 0),K(Ht(s),"velocityBuffer",void 0),K(Ht(s),"vector_",new w),K(Ht(s),"vector2_",new w),K(Ht(s),"vector3_",new w),K(Ht(s),"quaternion_",new Se),K(Ht(s),"quaternion2_",new Se),K(Ht(s),"quaternion3_",new Se),K(Ht(s),"rotationMat_",new It),K(Ht(s),"rotationMat2_",new It),s.maxParticles=1e3,s.setupBuffers(),s.rebuildMaterial(),s}return At(t,[{key:"buildExpandableBuffers",value:function(){this.offsetBuffer=new Mr(new Float32Array(this.maxParticles*3),3),this.offsetBuffer.setUsage(xs),this.geometry.setAttribute("offset",this.offsetBuffer),this.colorBuffer=new Mr(new Float32Array(this.maxParticles*4),4),this.colorBuffer.setUsage(xs),this.geometry.setAttribute("color",this.colorBuffer),this.settings.renderMode===nt.Mesh?(this.rotationBuffer=new Mr(new Float32Array(this.maxParticles*4),4),this.rotationBuffer.setUsage(xs),this.geometry.setAttribute("rotation",this.rotationBuffer)):(this.settings.renderMode===nt.BillBoard||this.settings.renderMode===nt.HorizontalBillBoard||this.settings.renderMode===nt.VerticalBillBoard||this.settings.renderMode===nt.StretchedBillBoard)&&(this.rotationBuffer=new Mr(new Float32Array(this.maxParticles),1),this.rotationBuffer.setUsage(xs),this.geometry.setAttribute("rotation",this.rotationBuffer)),this.sizeBuffer=new Mr(new Float32Array(this.maxParticles),1),this.sizeBuffer.setUsage(xs),this.geometry.setAttribute("size",this.sizeBuffer),this.uvTileBuffer=new Mr(new Float32Array(this.maxParticles),1),this.uvTileBuffer.setUsage(xs),this.geometry.setAttribute("uvTile",this.uvTileBuffer),this.settings.renderMode===nt.StretchedBillBoard&&(this.velocityBuffer=new Mr(new Float32Array(this.maxParticles*3),3),this.velocityBuffer.setUsage(xs),this.geometry.setAttribute("velocity",this.velocityBuffer))}},{key:"setupBuffers",value:function(){this.geometry&&this.geometry.dispose(),this.geometry=new TM,this.geometry.setIndex(this.settings.instancingGeometry.getIndex()),this.settings.instancingGeometry.hasAttribute("normal")&&this.geometry.setAttribute("normal",this.settings.instancingGeometry.getAttribute("normal")),this.geometry.setAttribute("position",this.settings.instancingGeometry.getAttribute("position")),this.geometry.setAttribute("uv",this.settings.instancingGeometry.getAttribute("uv")),this.buildExpandableBuffers()}},{key:"expandBuffers",value:function(s){for(;s>=this.maxParticles;)this.maxParticles*=2;this.setupBuffers()}},{key:"rebuildMaterial",value:function(){this.layers.mask=this.settings.layers.mask;var s,r={};if(this.settings.material.type==="MeshStandardMaterial"||this.settings.material.type==="MeshPhysicalMaterial"){var o=this.settings.material;s=Sb.merge([Ue.common,Ue.envmap,Ue.aomap,Ue.lightmap,Ue.emissivemap,Ue.bumpmap,Ue.normalmap,Ue.displacementmap,Ue.roughnessmap,Ue.metalnessmap,Ue.fog,Ue.lights,{emissive:{value:new _e(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),s.diffuse.value=o.color,s.opacity.value=o.opacity,s.emissive.value=o.emissive,s.roughness.value=o.roughness,s.metalness.value=o.metalness,o.envMap&&(s.envMap.value=o.envMap,s.envMapIntensity.value=o.envMapIntensity),o.normalMap&&(s.normalMap.value=o.normalMap,s.normalScale.value=o.normalScale),o.roughnessMap&&(s.roughnessMap.value=o.roughnessMap),o.metalnessMap&&(s.metalnessMap.value=o.metalnessMap),o.map&&(s.map=new xe(o.map))}else s={},s.map=new xe(this.settings.material.map);this.settings.material.alphaTest&&(r.USE_ALPHATEST="",s.alphaTest=new xe(this.settings.material.alphaTest)),r.USE_UV="";var a=this.settings.uTileCount,l=this.settings.vTileCount;(a>1||l>1)&&(r.UV_TILE="",s.tileCount=new xe(new te(a,l))),this.settings.material.normalMap&&(r.USE_NORMALMAP="",r.NORMALMAP_UV=IE(this.settings.material.normalMap.channel),s.normalMapTransform=new xe(new It().copy(this.settings.material.normalMap.matrix))),this.settings.material.map&&(r.USE_MAP="",r.MAP_UV=IE(this.settings.material.map.channel),s.mapTransform=new xe(new It().copy(this.settings.material.map.matrix))),r.USE_COLOR_ALPHA="";var c=!1;if(this.settings.renderMode===nt.BillBoard||this.settings.renderMode===nt.VerticalBillBoard||this.settings.renderMode===nt.HorizontalBillBoard||this.settings.renderMode===nt.Mesh){var u,d;this.settings.renderMode===nt.Mesh?this.settings.material.type==="MeshStandardMaterial"||this.settings.material.type==="MeshPhysicalMaterial"?(r.USE_COLOR="",u=Pte,d=Tte,c=!0):(u=Rte,d=pS):(u=Ite,d=pS),this.settings.renderMode===nt.VerticalBillBoard?r.VERTICAL="":this.settings.renderMode===nt.HorizontalBillBoard&&(r.HORIZONTAL=""),this.material=new Bt({uniforms:s,defines:r,vertexShader:u,fragmentShader:d,transparent:this.settings.material.transparent,depthWrite:!this.settings.material.transparent,blending:this.settings.material.blending,side:this.settings.material.side,alphaTest:this.settings.material.alphaTest,lights:c})}else if(this.settings.renderMode===nt.StretchedBillBoard)s.speedFactor=new xe(1),this.material=new Bt({uniforms:s,defines:r,vertexShader:Bte,fragmentShader:pS,transparent:this.settings.material.transparent,depthWrite:!this.settings.material.transparent,blending:this.settings.material.blending,side:this.settings.material.side,alphaTest:this.settings.material.alphaTest});else throw new Error("render mode unavailable")}},{key:"update",value:function(){var s=this,r=0,o=0;this.systems.forEach(function(a){o+=a.particleNum}),o>this.maxParticles&&this.expandBuffers(o),this.systems.forEach(function(a){var l=a.particles,c=a.particleNum,u=s.quaternion2_,d=s.vector2_,f=s.vector3_;a.emitter.matrixWorld.decompose(d,u,f),s.rotationMat_.setFromMatrix4(a.emitter.matrixWorld);for(var p=0;p<c;p++,r++){var g=l[p];if(s.settings.renderMode===nt.Mesh){var A=void 0;if(a.worldSpace)A=g.rotation;else{var v=void 0;g.parentMatrix?v=s.quaternion3_.setFromRotationMatrix(g.parentMatrix):v=u,A=s.quaternion_,A.copy(g.rotation).multiply(v)}s.rotationBuffer.setXYZW(r,A.x,A.y,A.z,A.w)}else(s.settings.renderMode===nt.StretchedBillBoard||s.settings.renderMode===nt.VerticalBillBoard||s.settings.renderMode===nt.HorizontalBillBoard||s.settings.renderMode===nt.BillBoard)&&s.rotationBuffer.setX(r,g.rotation);var m=void 0;if(a.worldSpace?m=g.position:(m=s.vector_,g.parentMatrix?m.copy(g.position).applyMatrix4(g.parentMatrix):m.copy(g.position).applyMatrix4(a.emitter.matrixWorld)),s.offsetBuffer.setXYZ(r,m.x,m.y,m.z),s.colorBuffer.setXYZW(r,g.color.x,g.color.y,g.color.z,g.color.w),a.worldSpace||g.parentMatrix?s.sizeBuffer.setX(r,g.size):s.sizeBuffer.setX(r,g.size*(Math.abs(f.x)+Math.abs(f.y)+Math.abs(f.z))/3),s.uvTileBuffer.setX(r,g.uvTile),s.settings.renderMode===nt.StretchedBillBoard&&s.velocityBuffer){var b=a.speedFactor,y=void 0;a.worldSpace?y=g.velocity:(y=s.vector_,g.parentMatrix?(s.rotationMat2_.setFromMatrix4(g.parentMatrix),y.copy(g.velocity).applyMatrix3(s.rotationMat2_)):y.copy(g.velocity).applyMatrix3(s.rotationMat_)),s.velocityBuffer.setXYZ(r,y.x*b,y.y*b,y.z*b)}}}),this.geometry.instanceCount=r,r>0&&(this.offsetBuffer.updateRange.count=r*3,this.offsetBuffer.needsUpdate=!0,this.sizeBuffer.updateRange.count=r,this.sizeBuffer.needsUpdate=!0,this.colorBuffer.updateRange.count=r*4,this.colorBuffer.needsUpdate=!0,this.uvTileBuffer.updateRange.count=r,this.uvTileBuffer.needsUpdate=!0,this.settings.renderMode===nt.StretchedBillBoard&&this.velocityBuffer&&(this.velocityBuffer.updateRange.count=r*3,this.velocityBuffer.needsUpdate=!0),this.settings.renderMode===nt.Mesh?(this.rotationBuffer.updateRange.count=r*4,this.rotationBuffer.needsUpdate=!0):(this.settings.renderMode===nt.StretchedBillBoard||this.settings.renderMode===nt.HorizontalBillBoard||this.settings.renderMode===nt.VerticalBillBoard||this.settings.renderMode===nt.BillBoard)&&(this.rotationBuffer.updateRange.count=r,this.rotationBuffer.needsUpdate=!0))}},{key:"dispose",value:function(){this.geometry.dispose()}}]),t}(d3),Ote=`

#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

uniform sampler2D alphaMap;
uniform float useAlphaMap;
uniform float visibility;
uniform float alphaTest;
uniform vec2 repeat;

varying vec4 vColor;
    
void main() {
    #include <clipping_planes_fragment>
    #include <logdepthbuf_fragment>

    vec4 c = vColor;
    
    #ifdef USE_MAP
    c *= texture2D( map, vUv * repeat );
    #endif
    if( useAlphaMap == 1. ) c.a *= texture2D( alphaMap, vUv * repeat ).a;
    if( c.a < alphaTest ) discard;
    gl_FragColor = c;

    #include <fog_fragment>
    #include <tonemapping_fragment>
}`,kte=`
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <clipping_planes_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <fog_pars_vertex>

attribute vec3 previous;
attribute vec3 next;
attribute float side;
attribute float width;

uniform vec2 resolution;
uniform float lineWidth;
uniform float sizeAttenuation;
    
vec2 fix(vec4 i, float aspect) {
    vec2 res = i.xy / i.w;
    res.x *= aspect;
    return res;
}
    
void main() {

    `.concat(DA,`
    
    float aspect = resolution.x / resolution.y;

    vColor = color;

    mat4 m = projectionMatrix * modelViewMatrix;
    vec4 finalPosition = m * vec4( position, 1.0 );
    vec4 prevPos = m * vec4( previous, 1.0 );
    vec4 nextPos = m * vec4( next, 1.0 );

    vec2 currentP = fix( finalPosition, aspect );
    vec2 prevP = fix( prevPos, aspect );
    vec2 nextP = fix( nextPos, aspect );

    float w = lineWidth * width;

    vec2 dir;
    if( nextP == currentP ) dir = normalize( currentP - prevP );
    else if( prevP == currentP ) dir = normalize( nextP - currentP );
    else {
        vec2 dir1 = normalize( currentP - prevP );
        vec2 dir2 = normalize( nextP - currentP );
        dir = normalize( dir1 + dir2 );

        vec2 perp = vec2( -dir1.y, dir1.x );
        vec2 miter = vec2( -dir.y, dir.x );
        //w = clamp( w / dot( miter, perp ), 0., 4., * lineWidth * width );

    }

    //vec2 normal = ( cross( vec3( dir, 0. ) vec3( 0., 0., 1. ) ) ).xy;
    vec4 normal = vec4( -dir.y, dir.x, 0., 1. );
    normal.xy *= .5 * w;
    normal *= projectionMatrix;
    if( sizeAttenuation == 0. ) {
        normal.xy *= finalPosition.w;
        normal.xy /= ( vec4( resolution, 0., 1. ) * projectionMatrix ).xy;
    }

    finalPosition.xy += normal.xy * side;

    gl_Position = finalPosition;

	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	
    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
    
	#include <fog_vertex>
}`);new w(0,0,1);var RE=function(n){yp(t,n);var e=bp(t);function t(i){var s;return mt(this,t),s=e.call(this,i),K(Ht(s),"positionBuffer",void 0),K(Ht(s),"previousBuffer",void 0),K(Ht(s),"nextBuffer",void 0),K(Ht(s),"uvBuffer",void 0),K(Ht(s),"sideBuffer",void 0),K(Ht(s),"widthBuffer",void 0),K(Ht(s),"colorBuffer",void 0),K(Ht(s),"indexBuffer",void 0),K(Ht(s),"vector_",new w),K(Ht(s),"vector2_",new w),K(Ht(s),"vector3_",new w),K(Ht(s),"quaternion_",new Se),s.maxParticles=1e4,s.setupBuffers(),s.rebuildMaterial(),s}return At(t,[{key:"setupBuffers",value:function(){this.geometry&&this.geometry.dispose(),this.geometry=new ft,this.indexBuffer=new ot(new Uint32Array(this.maxParticles*6),1),this.indexBuffer.setUsage(xs),this.geometry.setIndex(this.indexBuffer),this.positionBuffer=new ot(new Float32Array(this.maxParticles*6),3),this.positionBuffer.setUsage(xs),this.geometry.setAttribute("position",this.positionBuffer),this.previousBuffer=new ot(new Float32Array(this.maxParticles*6),3),this.previousBuffer.setUsage(xs),this.geometry.setAttribute("previous",this.previousBuffer),this.nextBuffer=new ot(new Float32Array(this.maxParticles*6),3),this.nextBuffer.setUsage(xs),this.geometry.setAttribute("next",this.nextBuffer),this.widthBuffer=new ot(new Float32Array(this.maxParticles*2),1),this.widthBuffer.setUsage(xs),this.geometry.setAttribute("width",this.widthBuffer),this.sideBuffer=new ot(new Float32Array(this.maxParticles*2),1),this.sideBuffer.setUsage(xs),this.geometry.setAttribute("side",this.sideBuffer),this.uvBuffer=new ot(new Float32Array(this.maxParticles*4),2),this.uvBuffer.setUsage(xs),this.geometry.setAttribute("uv",this.uvBuffer),this.colorBuffer=new ot(new Float32Array(this.maxParticles*8),4),this.colorBuffer.setUsage(xs),this.geometry.setAttribute("color",this.colorBuffer)}},{key:"expandBuffers",value:function(s){for(;s>=this.maxParticles;)this.maxParticles*=2;this.setupBuffers()}},{key:"rebuildMaterial",value:function(){this.layers.mask=this.settings.layers.mask;var s={lineWidth:{value:1},map:{value:null},useMap:{value:0},alphaMap:{value:null},useAlphaMap:{value:0},resolution:{value:new te(1,1)},sizeAttenuation:{value:1},visibility:{value:1},alphaTest:{value:0},repeat:{value:new te(1,1)}},r={};if(r.USE_UV="",r.USE_COLOR_ALPHA="",this.settings.material.map&&(r.USE_MAP="",r.MAP_UV=IE(this.settings.material.map.channel),s.map=new xe(this.settings.material.map),s.mapTransform=new xe(new It().copy(this.settings.material.map.matrix))),this.settings.renderMode===nt.Trail)this.material=new Bt({uniforms:s,defines:r,vertexShader:kte,fragmentShader:Ote,transparent:this.settings.material.transparent,depthWrite:!this.settings.material.transparent,side:this.settings.material.side,blending:this.settings.material.blending||Mf});else throw new Error("render mode unavailable")}},{key:"update",value:function(){var s=this,r=0,o=0,a=0;this.systems.forEach(function(l){for(var c=0;c<l.particleNum;c++)a+=l.particles[c].previous.length*2}),a>this.maxParticles&&this.expandBuffers(a),this.systems.forEach(function(l){var c=s.quaternion_,u=s.vector2_,d=s.vector3_;l.emitter.matrixWorld.decompose(u,c,d);for(var f=l.particles,p=l.particleNum,g=s.settings.uTileCount,A=s.settings.vTileCount,v=1/g,m=1/A,b=0;b<p;b++){var y=f[b],_=y.uvTile%A,E=Math.floor(y.uvTile/A),M=y.previous.values(),I=M.next(),R=I.value,C=R;I.done||(I=M.next());var T=void 0;I.value!==void 0?T=I.value:T=C;for(var O=0;O<y.previous.length;O++,r+=2){if(s.positionBuffer.setXYZ(r,C.position.x,C.position.y,C.position.z),s.positionBuffer.setXYZ(r+1,C.position.x,C.position.y,C.position.z),l.worldSpace?(s.positionBuffer.setXYZ(r,C.position.x,C.position.y,C.position.z),s.positionBuffer.setXYZ(r+1,C.position.x,C.position.y,C.position.z)):(y.parentMatrix?s.vector_.copy(C.position).applyMatrix4(y.parentMatrix):s.vector_.copy(C.position).applyMatrix4(l.emitter.matrixWorld),s.positionBuffer.setXYZ(r,s.vector_.x,s.vector_.y,s.vector_.z),s.positionBuffer.setXYZ(r+1,s.vector_.x,s.vector_.y,s.vector_.z)),l.worldSpace?(s.previousBuffer.setXYZ(r,R.position.x,R.position.y,R.position.z),s.previousBuffer.setXYZ(r+1,R.position.x,R.position.y,R.position.z)):(y.parentMatrix?s.vector_.copy(R.position).applyMatrix4(y.parentMatrix):s.vector_.copy(R.position).applyMatrix4(l.emitter.matrixWorld),s.previousBuffer.setXYZ(r,s.vector_.x,s.vector_.y,s.vector_.z),s.previousBuffer.setXYZ(r+1,s.vector_.x,s.vector_.y,s.vector_.z)),l.worldSpace?(s.nextBuffer.setXYZ(r,T.position.x,T.position.y,T.position.z),s.nextBuffer.setXYZ(r+1,T.position.x,T.position.y,T.position.z)):(y.parentMatrix?s.vector_.copy(T.position).applyMatrix4(y.parentMatrix):s.vector_.copy(T.position).applyMatrix4(l.emitter.matrixWorld),s.nextBuffer.setXYZ(r,s.vector_.x,s.vector_.y,s.vector_.z),s.nextBuffer.setXYZ(r+1,s.vector_.x,s.vector_.y,s.vector_.z)),s.sideBuffer.setX(r,-1),s.sideBuffer.setX(r+1,1),l.worldSpace)s.widthBuffer.setX(r,C.size),s.widthBuffer.setX(r+1,C.size);else if(y.parentMatrix)s.widthBuffer.setX(r,C.size),s.widthBuffer.setX(r+1,C.size);else{var J=(Math.abs(d.x)+Math.abs(d.y)+Math.abs(d.z))/3;s.widthBuffer.setX(r,C.size*J),s.widthBuffer.setX(r+1,C.size*J)}s.uvBuffer.setXY(r,(O/y.previous.length+_)*v,(A-E-1)*m),s.uvBuffer.setXY(r+1,(O/y.previous.length+_)*v,(A-E)*m),s.colorBuffer.setXYZW(r,C.color.x,C.color.y,C.color.z,C.color.w),s.colorBuffer.setXYZW(r+1,C.color.x,C.color.y,C.color.z,C.color.w),O+1<y.previous.length&&(s.indexBuffer.setX(o*3,r),s.indexBuffer.setX(o*3+1,r+1),s.indexBuffer.setX(o*3+2,r+2),o++,s.indexBuffer.setX(o*3,r+2),s.indexBuffer.setX(o*3+1,r+1),s.indexBuffer.setX(o*3+2,r+3),o++),R=C,C=T,I.done||(I=M.next(),I.value!==void 0&&(T=I.value))}}}),this.positionBuffer.updateRange.count=r*3,this.positionBuffer.needsUpdate=!0,this.previousBuffer.updateRange.count=r*3,this.previousBuffer.needsUpdate=!0,this.nextBuffer.updateRange.count=r*3,this.nextBuffer.needsUpdate=!0,this.sideBuffer.updateRange.count=r,this.sideBuffer.needsUpdate=!0,this.widthBuffer.updateRange.count=r,this.widthBuffer.needsUpdate=!0,this.uvBuffer.updateRange.count=r*2,this.uvBuffer.needsUpdate=!0,this.colorBuffer.updateRange.count=r*4,this.colorBuffer.needsUpdate=!0,this.indexBuffer.updateRange.count=o*3,this.indexBuffer.needsUpdate=!0,this.geometry.setDrawRange(0,o*3)}},{key:"dispose",value:function(){this.geometry.dispose()}}]),t}(d3),Lte=function(n){yp(t,n);var e=bp(t);function t(){var i;return mt(this,t),i=e.call(this),K(Ht(i),"batches",[]),K(Ht(i),"systemToBatchIndex",new Map),K(Ht(i),"type","BatchedRenderer"),i}return At(t,[{key:"addSystem",value:function(s){s._renderer=this;for(var r=s.getRendererSettings(),o=0;o<this.batches.length;o++)if(t.equals(this.batches[o].settings,r)){this.batches[o].addSystem(s),this.systemToBatchIndex.set(s,o);return}var a;switch(r.renderMode){case nt.Trail:a=new RE(r);break;case nt.Mesh:case nt.BillBoard:case nt.VerticalBillBoard:case nt.HorizontalBillBoard:case nt.StretchedBillBoard:a=new Dte(r);break}a.addSystem(s),this.batches.push(a),this.systemToBatchIndex.set(s,this.batches.length-1),this.add(a)}},{key:"deleteSystem",value:function(s){var r=this.systemToBatchIndex.get(s);r!=null&&(this.batches[r].removeSystem(s),this.systemToBatchIndex.delete(s))}},{key:"updateSystem",value:function(s){this.deleteSystem(s),this.addSystem(s)}},{key:"update",value:function(s){this.systemToBatchIndex.forEach(function(o,a){a.update(s)});for(var r=0;r<this.batches.length;r++)this.batches[r].update()}}],[{key:"equals",value:function(s,r){return s.material.side===r.material.side&&s.material.blending===r.material.blending&&s.material.transparent===r.material.transparent&&s.material.type===r.material.type&&s.material.alphaTest===r.material.alphaTest&&s.material.map===r.material.map&&s.renderMode===r.renderMode&&s.uTileCount===r.uTileCount&&s.vTileCount===r.vTileCount&&s.instancingGeometry===r.instancingGeometry&&s.renderOrder===r.renderOrder&&s.layers.mask===r.layers.mask}}]),t}(Me),Fte=Lte,aO=function(){function n(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new w;mt(this,n),K(this,"locations",[]),this.scaleX=e,this.scaleY=t,this.position=i}return At(n,[{key:"transform",value:function(t,i){t.x=this.locations[i%this.locations.length].x*this.scaleX+this.position.x,t.y=this.locations[i%this.locations.length].y*this.scaleY+this.position.y,t.z=this.position.z}},{key:"clone",value:function(){var t=new n(this.scaleX,this.scaleY,this.position.clone());return t.locations=this.locations.map(function(i){return i.clone()}),t}},{key:"toJSON",value:function(){return{scaleX:this.scaleX,scaleY:this.scaleY,position:this.position,locations:this.locations.map(function(t){return{x:t.x,y:t.y}})}}},{key:"fromImage",value:function(t,i){var s=document.createElement("canvas");s.width=t.width,s.height=t.height;var r=s.getContext("2d");if(r){r.drawImage(t,0,0);var o=r.getImageData(0,0,s.width,s.height,{colorSpace:"srgb"});s.remove(),this.locations.length=0;for(var a=0;a<o.height;a++)for(var l=0;l<o.width;l++)o.data[(a*o.width+l)*4+3]>i&&this.locations.push(new te(l,o.height-a))}}}],[{key:"fromJSON",value:function(t){var i=new n(t.scaleX,t.scaleY,new w(t.position[0],t.position[1],t.position[2]));return i.locations=t.locations.map(function(s){return new te(s.x,s.y)}),i}}]),n}();function Ute(n){switch(n.type){case"TextureSequencer":return aO.fromJSON(n);default:return new aO}}var Nte=function(){function n(e){mt(this,n),K(this,"type","ApplySequences"),K(this,"sequencers",[]),K(this,"time",0),K(this,"index",0),K(this,"pCount",0),K(this,"delay",void 0),K(this,"tempV",new w),this.delay=e}return At(n,[{key:"initialize",value:function(t){t.id=this.pCount,t.dst=new w,t.begin=new w,t.inMotion=!1,this.pCount++}},{key:"reset",value:function(){this.time=0,this.index=0,this.pCount=0}},{key:"update",value:function(t,i){var s=this.sequencers[this.index],r=t.id*this.delay;this.time>=s[0].a+r&&this.time<=s[0].b+r?(t.inMotion||(t.inMotion=!0,t.begin.copy(t.position),s[1].transform(t.dst,t.id)),t.position.lerpVectors(t.begin,t.dst,n.BEZIER.genValue((this.time-s[0].a-r)/(s[0].b-s[0].a)))):this.time>s[0].b+r&&(t.inMotion=!1)}},{key:"frameUpdate",value:function(t){for(;this.index+1<this.sequencers.length&&this.time>=this.sequencers[this.index+1][0].a;)this.index++;this.time+=t}},{key:"appendSequencer",value:function(t,i){this.sequencers.push([t,i])}},{key:"toJSON",value:function(){return{type:this.type,delay:this.delay,sequencers:this.sequencers.map(function(t){var i=_f(t,2),s=i[0],r=i[1];return{range:s.toJSON(),sequencer:r.toJSON()}})}}},{key:"clone",value:function(){var t=new n(this.delay);return t.sequencers=this.sequencers.map(function(i){return[i[0].clone(),i[1].clone()]}),t}}],[{key:"fromJSON",value:function(t){var i=new n(t.delay);return t.sequencers.forEach(function(s){i.sequencers.push([Mi(s.range),Ute(s.sequencer)])}),i}}]),n}();K(Nte,"BEZIER",new CE(0,0,1,1));var ae=function(n){return n[n.Number=0]="Number",n[n.Vec2=1]="Vec2",n[n.Vec3=2]="Vec3",n[n.Vec4=3]="Vec4",n[n.Boolean=4]="Boolean",n[n.AnyType=5]="AnyType",n}({}),lO=At(function n(e,t,i,s){mt(this,n),K(this,"input",void 0),K(this,"inputIndex",void 0),K(this,"output",void 0),K(this,"outputIndex",void 0),this.input=e,this.inputIndex=t,this.input.outputs[t].push(this),this.output=i,this.outputIndex=s,this.output.inputs[s]=this}),zte=function(){function n(){mt(this,n),K(this,"visited",new Set),K(this,"graph_",void 0),K(this,"context_",void 0),n.Instance=this}return At(n,[{key:"traverse",value:function(t){if(this.context_===void 0)throw new Error("context is undefined");if(this.graph_===void 0)throw new Error("graph is undefined");this.visited.add(t.id);for(var i=[],s=0;s<t.inputs.length;s++)if(t.inputs[s]instanceof lO){var r=t.inputs[s].input;this.visited.has(r.id)||this.traverse(r),i.push(r.outputValues[t.inputs[s].inputIndex])}else i.push(t.inputs[s].getValue(this.context_));t.func(this.context_,i,t.outputValues),this.graph_.nodesInOrder.push(t)}},{key:"executeCompiledGraph",value:function(){if(this.context_===void 0)throw new Error("context is undefined");if(this.graph_===void 0)throw new Error("graph is undefined");for(var t=this.graph_.nodesInOrder,i=0;i<t.length;i++){for(var s=[],r=t[i],o=0;o<r.inputs.length;o++)if(r.inputs[o]instanceof lO)s.push(r.inputs[o].input.outputValues[r.inputs[o].inputIndex]);else if(r.inputs[o]!==void 0)s.push(r.inputs[o].getValue(this.context_));else throw new Error("miss input for node ".concat(r.id));r.func(this.context_,s,r.outputValues)}}},{key:"run",value:function(t,i){if(this.graph_=t,this.context_=i,t.compiled)this.executeCompiledGraph();else{t.nodesInOrder.length=0,this.visited.clear();for(var s=0;s<t.outputNodes.length;s++){var r=t.outputNodes[s];this.traverse(r)}t.compiled=!0}}}]),n}();K(zte,"Instance",void 0);var Kt=function(){function n(e){mt(this,n),K(this,"name",void 0),K(this,"nodeTypeSignatures",[]),this.name=e}return At(n,[{key:"addSignature",value:function(t,i,s){this.nodeTypeSignatures.push({inputTypes:t,outputTypes:i,func:s})}}]),n}(),sx=new Kt("add");sx.addSignature([ae.Number,ae.Number],[ae.Number],function(n,e,t,i){i[0]=t[0]+t[1]});sx.addSignature([ae.Vec2,ae.Vec2],[ae.Vec2],function(n,e,t,i){i[0].addVectors(t[0],t[1])});sx.addSignature([ae.Vec3,ae.Vec3],[ae.Vec3],function(n,e,t,i){i[0].addVectors(t[0],t[1])});sx.addSignature([ae.Vec4,ae.Vec4],[ae.Vec4],function(n,e,t,i){i[0].addVectors(t[0],t[1])});var rx=new Kt("sub");rx.addSignature([ae.Number,ae.Number],[ae.Number],function(n,e,t,i){i[0]=t[0]-t[1]});rx.addSignature([ae.Vec2,ae.Vec2],[ae.Vec2],function(n,e,t,i){i[0].subVectors(t[0],t[1])});rx.addSignature([ae.Vec3,ae.Vec3],[ae.Vec3],function(n,e,t,i){i[0].subVectors(t[0],t[1])});rx.addSignature([ae.Vec4,ae.Vec4],[ae.Vec4],function(n,e,t,i){i[0].subVectors(t[0],t[1])});var ox=new Kt("mul");ox.addSignature([ae.Number,ae.Number],[ae.Number],function(n,e,t,i){i[0]=t[0]*t[1]});ox.addSignature([ae.Vec2,ae.Number],[ae.Vec2],function(n,e,t,i){i[0].copy(t[0]).multiplyScalar(t[1])});ox.addSignature([ae.Vec3,ae.Number],[ae.Vec3],function(n,e,t,i){i[0].copy(t[0]).multiplyScalar(t[1])});ox.addSignature([ae.Vec4,ae.Number],[ae.Vec4],function(n,e,t,i){i[0].copy(t[0]).multiplyScalar(t[1])});var ax=new Kt("div");ax.addSignature([ae.Number,ae.Number],[ae.Number],function(n,e,t,i){i[0]=t[0]/t[1]});ax.addSignature([ae.Vec2,ae.Number],[ae.Vec2],function(n,e,t,i){i[0].copy(t[0]).divideScalar(t[1])});ax.addSignature([ae.Vec3,ae.Number],[ae.Vec3],function(n,e,t,i){i[0].copy(t[0]).divideScalar(t[1])});ax.addSignature([ae.Vec4,ae.Number],[ae.Vec4],function(n,e,t,i){i[0].copy(t[0]).divideScalar(t[1])});var Gte=new Kt("sin");Gte.addSignature([ae.Number],[ae.Number],function(n,e,t,i){i[0]=Math.sin(t[0])});var Vte=new Kt("cos");Vte.addSignature([ae.Number],[ae.Number],function(n,e,t,i){i[0]=Math.cos(t[0])});var Hte=new Kt("tan");Hte.addSignature([ae.Number],[ae.Number],function(n,e,t,i){i[0]=Math.tan(t[0])});var Qte=new Kt("abs");Qte.addSignature([ae.Number],[ae.Number],function(n,e,t,i){i[0]=Math.abs(t[0])});var Wte=new Kt("min");Wte.addSignature([ae.Number,ae.Number],[ae.Number],function(n,e,t,i){i[0]=Math.min(t[0],t[1])});var jte=new Kt("max");jte.addSignature([ae.Number,ae.Number],[ae.Number],function(n,e,t,i){i[0]=Math.max(t[0],t[1])});var B1=new Kt("dot");B1.addSignature([ae.Vec2,ae.Vec2],[ae.Number],function(n,e,t,i){i[0]=t[0].dot(t[1])});B1.addSignature([ae.Vec3,ae.Vec3],[ae.Number],function(n,e,t,i){i[0]=t[0].dot(t[1])});B1.addSignature([ae.Vec4,ae.Vec4],[ae.Number],function(n,e,t,i){i[0]=t[0].dot(t[1])});var qte=new Kt("cross");qte.addSignature([ae.Vec3,ae.Vec3],[ae.Vec3],function(n,e,t,i){i[0].crossVectors(t[0],t[1])});var D1=new Kt("length");D1.addSignature([ae.Vec2],[ae.Number],function(n,e,t,i){i[0]=t[0].length()});D1.addSignature([ae.Vec3],[ae.Number],function(n,e,t,i){i[0]=t[0].length()});D1.addSignature([ae.Vec4],[ae.Number],function(n,e,t,i){i[0]=t[0].length()});var O1=new Kt("lengthSq");O1.addSignature([ae.Vec2],[ae.Number],function(n,e,t,i){i[0]=t[0].lengthSq()});O1.addSignature([ae.Vec3],[ae.Number],function(n,e,t,i){i[0]=t[0].lengthSq()});O1.addSignature([ae.Vec4],[ae.Number],function(n,e,t,i){i[0]=t[0].lengthSq()});var k1=new Kt("normalize");k1.addSignature([ae.Vec2],[ae.Vec2],function(n,e,t,i){i[0].copy(t[0]).normalize()});k1.addSignature([ae.Vec3],[ae.Vec3],function(n,e,t,i){i[0].copy(t[0]).normalize()});k1.addSignature([ae.Vec4],[ae.Vec4],function(n,e,t,i){i[0].copy(t[0]).normalize()});var f3=new Kt("distance");f3.addSignature([ae.Vec2,ae.Vec2],[ae.Number],function(n,e,t,i){i[0]=t[0].distanceTo(t[1])});f3.addSignature([ae.Vec3,ae.Vec3],[ae.Number],function(n,e,t,i){i[0]=t[0].distanceTo(t[1])});var Xte=new Kt("and");Xte.addSignature([ae.Boolean,ae.Boolean],[ae.Boolean],function(n,e,t,i){i[0]=t[0]&&t[1]});var Yte=new Kt("or");Yte.addSignature([ae.Boolean,ae.Boolean],[ae.Boolean],function(n,e,t,i){i[0]=t[0]||t[1]});var Jte=new Kt("not");Jte.addSignature([ae.Boolean],[ae.Boolean],function(n,e,t,i){i[0]=!t[0]});var lx=new Kt("equal");lx.addSignature([ae.Number,ae.Number],[ae.Boolean],function(n,e,t,i){i[0]=t[0]===t[1]});lx.addSignature([ae.Vec2,ae.Vec2],[ae.Boolean],function(n,e,t,i){i[0]=t[0].equals(t[1])});lx.addSignature([ae.Vec3,ae.Vec3],[ae.Boolean],function(n,e,t,i){i[0]=t[0].equals(t[1])});lx.addSignature([ae.Vec4,ae.Vec4],[ae.Boolean],function(n,e,t,i){i[0]=t[0].equals(t[1])});var Kte=new Kt("lessThan");Kte.addSignature([ae.Number,ae.Number],[ae.Boolean],function(n,e,t,i){i[0]=t[0]<t[1]});var Zte=new Kt("greaterThan");Zte.addSignature([ae.Number,ae.Number],[ae.Boolean],function(n,e,t,i){i[0]=t[0]>t[1]});var $te=new Kt("lessThanOrEqual");$te.addSignature([ae.Number,ae.Number],[ae.Boolean],function(n,e,t,i){i[0]=t[0]<=t[1]});var eie=new Kt("greaterThanOrEqual");eie.addSignature([ae.Number,ae.Number],[ae.Boolean],function(n,e,t,i){i[0]=t[0]>=t[1]});var tie=new Kt("if");tie.addSignature([ae.Boolean,ae.AnyType,ae.AnyType],[ae.AnyType],function(n,e,t,i){i[0]=t[0]?t[1]:t[2]});var iie=new Kt("number");iie.addSignature([],[ae.Number],function(n,e,t,i){i[0]=e.value});var nie=new Kt("vec2");nie.addSignature([],[ae.Vec2],function(n,e,t,i){i[0]=e.value});var sie=new Kt("vec3");sie.addSignature([],[ae.Vec3],function(n,e,t,i){i[0]=e.value});var rie=new Kt("vec4");rie.addSignature([],[ae.Vec4],function(n,e,t,i){i[0]=e.value});var oie=new Kt("bool");oie.addSignature([],[ae.Boolean],function(n,e,t,i){i[0]=e.value});var aie=new Kt("particlePosition");aie.addSignature([],[ae.Vec3],function(n,e,t,i){i[0]=n.particle[e.property]});var lie=new Kt("particleVelocity");lie.addSignature([],[ae.Vec3],function(n,e,t,i){i[0]=n.particle[e.property]});var cie=new Kt("particleRotation");cie.addSignature([],[ae.Number],function(n,e,t,i){i[0]=n.particle[e.property]});var hie=new Kt("particleAge");hie.addSignature([],[ae.Number],function(n,e,t,i){i[0]=n.particle[e.property]});var OA=new Kt("output");OA.addSignature([ae.Number],[ae.Number],function(n,e,t,i){i[0]=t[0]});OA.addSignature([ae.Vec2],[ae.Vec2],function(n,e,t,i){i[0]=t[0]});OA.addSignature([ae.Vec3],[ae.Vec3],function(n,e,t,i){i[0]=t[0]});OA.addSignature([ae.Vec4],[ae.Vec4],function(n,e,t,i){i[0]=t[0]});OA.addSignature([ae.Boolean],[ae.Boolean],function(n,e,t,i){i[0]=t[0]});console.log("%c Particle system powered by three.quarks. https://quarks.art/","font-size: 16px; font-weight: bold;");var Ji=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const vg=re("debugparticles"),uie=re("noprogressive"),die=re("debugprogressive");var Z0;(function(n){n[n.Birth=0]="Birth",n[n.Collision=1]="Collision",n[n.Death=2]="Death",n[n.Trigger=3]="Trigger",n[n.Manual=4]="Manual"})(Z0||(Z0={}));const ub=class extends Te{constructor(){super(...arguments);h(this,"renderMode");h(this,"particleMaterial");h(this,"trailMaterial");h(this,"particleMesh");h(this,"maxParticleSize");h(this,"minParticleSize");h(this,"velocityScale");h(this,"cameraVelocityScale");h(this,"lengthScale")}start(){if(this.maxParticleSize!==.5&&this.minParticleSize!==0&&si()){const t=`ParticleSystem "${this.name}" has non-default min/max particle size. This may not render correctly. Please set min size to 0 and the max size to 0.5 and use the "StartSize" setting instead`;console.warn(t)}}get transparent(){var i;return((i=this.particleMaterial)==null?void 0:i.transparent)??!1}getMaterial(t=!1){if(!ub._havePatchedQuarkShaders){ub._havePatchedQuarkShaders=!0;const s=RE.prototype.rebuildMaterial;RE.prototype.rebuildMaterial=function(){s.call(this),this.material.defines.MAP_UV="uv"}}const i=t===!0&&this.trailMaterial?this.trailMaterial:this.particleMaterial;return i&&!uie&&i._didRequestTextureLOD===void 0&&(i._didRequestTextureLOD=0,die&&console.log("Load material LOD",i.name),fo.assignTextureLOD(this.context,this.sourceId,i)),i}getMesh(t){let i=null;if(!i&&(this.particleMesh instanceof ye&&(i=this.particleMesh.geometry),i===null)){i=new us(1,1);const r=i.attributes.uv;for(let o=0;o<r.count;o++)r.setX(o,1-r.getX(o))}return new ye(i,this.getMaterial())}};let gr=ub;h(gr,"_havePatchedQuarkShaders",!1);Ji([x()],gr.prototype,"renderMode",void 0);Ji([x(Pt)],gr.prototype,"particleMaterial",void 0);Ji([x(Pt)],gr.prototype,"trailMaterial",void 0);Ji([x()],gr.prototype,"maxParticleSize",void 0);Ji([x()],gr.prototype,"minParticleSize",void 0);Ji([x()],gr.prototype,"velocityScale",void 0);Ji([x()],gr.prototype,"cameraVelocityScale",void 0);Ji([x()],gr.prototype,"lengthScale",void 0);class fy{constructor(e,t=1){h(this,"_curve");h(this,"_factor");h(this,"type","function");this._curve=e,this._factor=t}genValue(e){return this._curve.evaluate(e,Math.random())*this._factor}toJSON(){throw new Error("Method not implemented.")}clone(){throw new Error("Method not implemented.")}}class L1{constructor(e){h(this,"type","value");h(this,"system");this.system=e}toJSON(){throw new Error("Method not implemented.")}clone(){throw new Error("Method not implemented.")}}class fie extends L1{genValue(){return this.system.textureSheetAnimation.getStartIndex()}}class pie extends L1{constructor(){super(...arguments);h(this,"_lastPosition",new w);h(this,"_lastDistance",0)}update(){const t=Mt(this.system.gameObject);this._lastDistance=this._lastPosition.distanceTo(t),this._lastPosition.copy(t)}genValue(){if(!this.system.isPlaying||!this.system.emission.enabled||this.system.currentParticles>=this.system.maxParticles)return 0;let t=this.system.emission.rateOverTime.evaluate(this.system.time/this.system.duration,Math.random());if(this.system.deltaTime>0){const r=this.system.emission.rateOverDistance.evaluate(this.system.time/this.system.duration,Math.random());let a=this._lastDistance/this.system.deltaTime*r;Number.isFinite(a)||(a=0),t+=a}const i=this.system.emission.getBurst();i>0&&(t+=i/this.system.deltaTime);const s=this.system.maxParticles-this.system.currentParticles;return tt.clamp(t,0,s/this.system.deltaTime)}}class gie extends L1{genValue(){return this.system.isPlaying,0}}class _p{constructor(e){h(this,"system");this.system=e}initialize(e){}update(e,t){}frameUpdate(e){}toJSON(){throw new Error("Method not implemented.")}clone(){throw new Error("Method not implemented.")}reset(){}}class mie extends _p{constructor(){super(...arguments);h(this,"type","NeedleTextureSheet")}update(t,i){const s=this.system.textureSheetAnimation;if(s.enabled){const r=t.age/t.life,o=s.evaluate(r);o!==void 0&&(t.uvTile=o)}}}const cO=Symbol("particleRotation");class Aie extends _p{constructor(){super(...arguments);h(this,"type","NeedleRotation")}initialize(t){t[cO]=Math.random()}update(t,i){if(t.rotation===void 0)return;const s=t.age/t.life;if(typeof t.rotation=="number"&&(this.system.rotationOverLifetime.enabled?t.rotation+=this.system.rotationOverLifetime.evaluate(s,t[cO])*i:this.system.renderer.renderMode===wa.Billboard&&(t.rotation=Math.PI),this.system.rotationBySpeed.enabled)){const r=t.velocity.length();t.rotation+=this.system.rotationBySpeed.evaluate(s,r)*i}}}const hO=Symbol("sizeLerpFactor"),vie=new w;class yie extends _p{constructor(){super(...arguments);h(this,"type","NeedleSize");h(this,"_minSize",0);h(this,"_maxSize",1)}initialize(t){t[hO]=Math.random(),this._minSize=this.system.renderer.minParticleSize,this._maxSize=this.system.renderer.maxParticleSize}update(t,i){const s=t.age/t.life;let r=1;this.system.sizeOverLifetime.enabled&&(r*=this.system.sizeOverLifetime.evaluate(s,void 0,t[hO]).x);let o=1;if(this.system.renderer.renderMode!==wa.Mesh&&(o=this.system.worldScale.x/this.system.cameraScale),t.size=t.startSize*r*o,this.system.localspace){const a=p3(this.system,vie);t.size*=a.x}}}const nf=Symbol("particleLife"),gS=Symbol("trailLifetime"),uO=Symbol("trailStartLength"),mS=Symbol("trailWidthRandom");class bie extends _p{constructor(){super(...arguments);h(this,"type","NeedleTrail")}initialize(t){t instanceof Wm&&(t[nf]=t.life,this.system.trails.enabled&&this.system.trails.dieWithParticles===!1&&(t[gS]=this.system.trails.lifetime.evaluate(Math.random(),Math.random()),t.life+=t[gS]),t[uO]=t.length,t[mS]=Math.random())}update(t){var i;if((i=this.system.trails)!=null&&i.enabled&&t instanceof Wm){const s=t,r=t.age/t[nf],o=t.previous.values(),a=t.previous.length;for(let l=0;l<a;l++){const u=o.next().value,d=1-l/(a-1);let f=t.size;f<=0&&!this.system.trails.sizeAffectsWidth&&(f=100*this.system.trails.widthOverTrail.evaluate(.5,s[mS])),u.size=this.system.trails.getWidth(f,r,d,s[mS]),u.color.copy(t.color),this.system.trails.getColor(u.color,r,d)}if(t.age>t[nf]){t.velocity.set(0,0,0);const l=(t.age-t[nf])/t[gS];s.length=tt.lerp(t[uO],0,l)}}}}const py=Symbol("startVelocity"),dO=Symbol("gravityModifier"),AS=Symbol("gravitySpeed"),gy=Symbol("velocity lerp factor"),PE=new w;class _ie extends _p{constructor(){super(...arguments);h(this,"type","NeedleVelocity");h(this,"_gravityDirection",new w)}initialize(t){var o,a;const i=this.system.main.simulationSpeed,s=1;t.startSpeed=this.system.main.startSpeed.evaluate(Math.random(),Math.random())*s,t.velocity.copy(this.system.shape.getDirection(t.position)).multiplyScalar(t.startSpeed),(o=this.system.inheritVelocity)!=null&&o.enabled&&this.system.inheritVelocity.applyInitial(t.velocity),t[py]?t[py].copy(t.velocity):t[py]=t.velocity.clone();const r=this.system.main.gravityModifier.evaluate(Math.random(),Math.random());t[dO]=r*i,t[AS]=r*i*.5,t[gy]=Math.random(),(a=this.system.velocityOverLifetime)==null||a.init(t),this._gravityDirection.set(0,-1,0),this.system.main.simulationSpace===Xo.Local&&this._gravityDirection.applyQuaternion(this.system.worldQuaternionInverted).normalize()}update(t,i){var f;const s=t[py],r=t[dO];if(r!==0){const p=r*t[AS];PE.copy(this._gravityDirection).multiplyScalar(p),t[AS]+=i*.05,s.add(PE)}t.velocity.copy(s);const o=t.age/t.life;(f=this.system.inheritVelocity)!=null&&f.enabled&&this.system.inheritVelocity.applyCurrent(t.velocity,o,t[gy]);const a=this.system.noise;a.enabled&&a.apply(0,t.position,t.velocity,i,t.age,t.life);const l=this.system.sizeBySpeed;l!=null&&l.enabled&&(t.size=l.evaluate(t.velocity,o,t[gy],t.size));const c=this.system.colorBySpeed;c!=null&&c.enabled&&c.evaluate(t.velocity,t[gy],t.color);const u=this.system.velocityOverLifetime;u.enabled&&u.apply(t,0,t.position,t.velocity,i,t.age,t.life);const d=this.system.limitVelocityOverLifetime;d.enabled&&d.apply(t.position,s,t.velocity,t.size,o,i,1),this.system.worldspace&&t.velocity.multiply(this.system.worldScale)}}const fO=Symbol("colorLerpFactor"),pO=new Si(1,1,1,1);class xie extends _p{constructor(){super(...arguments);h(this,"type","NeedleColor")}initialize(t){}_init(t){const i=this.system.renderer.particleMaterial,s=this.system.main.startColor.evaluate(Math.random());i!=null&&i.color&&(pO.copy(i.color),s.multiply(pO)),s.convertLinearToSRGB(),t.startColor.set(s.r,s.g,s.b,s.alpha),t.color.copy(t.startColor),t[fO]=Math.random()}update(t,i){if(t.age===0&&this._init(t),this.system.colorOverLifetime.enabled){const s=t.age/t.life,r=this.system.colorOverLifetime.color.evaluate(s,t[fO]);t.color.set(r.r,r.g,r.b,r.alpha).multiply(t.startColor)}else t.color.copy(t.startColor)}}class wie{constructor(e){h(this,"system");h(this,"emission");h(this,"autoDestroy");h(this,"startLength");h(this,"emissionBursts");h(this,"onlyUsedByOther");h(this,"behaviors",[]);h(this,"rendererEmitterSettings",{startLength:new _s(220),followLocalOrigin:!1});this.system=e,this.emission=new pie(this.system)}get anim(){return this.system.textureSheetAnimation}get prewarm(){return!1}get material(){return this.system.renderer.getMaterial(this.system.trails.enabled)}get layers(){return this.system.gameObject.layers}update(){this.emission.update()}get looping(){return this.system.main.loop}get duration(){return this.system.duration}get shape(){return this.system.shape}get startLife(){return new fy(this.system.main.startLifetime)}get startSpeed(){return new fy(this.system.main.startSpeed)}get startRotation(){return new fy(this.system.main.startRotation)}get startSize(){return new fy(this.system.main.startSize)}get startColor(){return new K0(new Ke(1,1,1,1))}get emissionOverTime(){return this.emission}get emissionOverDistance(){return new gie(this.system)}get instancingGeometry(){return this.system.renderer.getMesh(this.system.renderer.renderMode).geometry}get renderMode(){if(this.system.trails.enabled===!0)return nt.Trail;switch(this.system.renderer.renderMode){case wa.Billboard:return nt.BillBoard;case wa.Stretch:return nt.StretchedBillBoard;case wa.HorizontalBillboard:return nt.HorizontalBillBoard;case wa.VerticalBillboard:return nt.VerticalBillBoard;case wa.Mesh:return nt.Mesh}return nt.BillBoard}get speedFactor(){var t;let e=this.system.main.simulationSpeed;return((t=this.system.renderer)==null?void 0:t.renderMode)===wa.Stretch&&(e*=this.system.renderer.velocityScale??1),e}get texture(){const e=this.material;if(e&&e.map){const t=e.map;return t.premultiplyAlpha=!1,t.colorSpace=gn,t}return dF(new Si(1,1,1,1),1)}get startTileIndex(){return new fie(this.system)}get uTileCount(){var e;return this.anim.enabled?(e=this.anim)==null?void 0:e.numTilesX:void 0}get vTileCount(){var e;return this.anim.enabled?(e=this.anim)==null?void 0:e.numTilesY:void 0}get renderOrder(){return 1}get blending(){var e;return((e=this.system.renderer.particleMaterial)==null?void 0:e.blending)??Lc}get transparent(){return this.system.renderer.transparent}get worldSpace(){return this.system.main.simulationSpace===Xo.World}}class Sie{constructor(){h(this,"burstIndex",0);h(this,"burstWaveIndex",0);h(this,"time",0);h(this,"waitEmiting",0)}}class Xi extends Te{constructor(){super(...arguments);h(this,"_state");h(this,"colorOverLifetime");h(this,"main");h(this,"emission");h(this,"sizeOverLifetime");h(this,"shape");h(this,"noise");h(this,"trails");h(this,"velocityOverLifetime");h(this,"limitVelocityOverLifetime");h(this,"inheritVelocity");h(this,"colorBySpeed");h(this,"textureSheetAnimation");h(this,"rotationOverLifetime");h(this,"rotationBySpeed");h(this,"sizeBySpeed");h(this,"_cameraScale",1);h(this,"__worldQuaternion",new Se);h(this,"_worldQuaternionInverted",new Se);h(this,"_worldScale",new w);h(this,"_worldPositionFrame",-1);h(this,"_worldPos",new w);h(this,"_renderer");h(this,"_batchSystem");h(this,"_particleSystem");h(this,"_interface");h(this,"_container");h(this,"_time",0);h(this,"_isPlaying",!0);h(this,"_isUsedAsSubsystem",!1);h(this,"_didPreWarm",!1);h(this,"_bursts");h(this,"_subEmitterSystems");h(this,"_lastBatchesCount",-1);h(this,"lastMaterialVersion",-1)}play(t=!1){var i;t&&ne.foreachComponent(this.gameObject,s=>{s instanceof Xi&&s!==this&&s.play(!1)},!0),this._isPlaying=!0,this._particleSystem&&(this._particleSystem.emissionState.time=0,this._particleSystem.emitEnded=!1),(i=this.emission)==null||i.reset()}pause(t=!0){t&&ne.foreachComponent(this.gameObject,i=>{i instanceof Xi&&i!==this&&i.pause(!1)},!0),this._isPlaying=!1}stop(t=!0,i=!1){t&&ne.foreachComponent(this.gameObject,s=>{s instanceof Xi&&s!==this&&s.stop(!1,i)},!0),this._isPlaying=!1,this._time=0,i&&this.reset()}reset(){var t;this._time=0,this._particleSystem&&(this._particleSystem.particleNum=0,this._particleSystem.emissionState.time=0,this._particleSystem.emitEnded=!1,(t=this.emission)==null||t.reset())}emit(t){if(this._particleSystem){this.onUpdate(),t=Math.min(t,this.maxParticles-this.currentParticles),this._state||(this._state=new Sie),this._state.waitEmiting=t,this._state.time=0;const i=this._particleSystem.emitEnded;this._particleSystem.emitEnded=!1,this._particleSystem.emit(this.deltaTime,this._state,this._particleSystem.emitter.matrixWorld),this._particleSystem.emitEnded=i}}get playOnAwake(){return this.main.playOnAwake}set playOnAwake(t){this.main.playOnAwake=t}get renderer(){return this._renderer}get isPlaying(){return this._isPlaying}get currentParticles(){var t;return((t=this._particleSystem)==null?void 0:t.particleNum)??0}get maxParticles(){return this.main.maxParticles}get time(){return this._time}get duration(){return this.main.duration}get deltaTime(){return this.context.time.deltaTime*this.main.simulationSpeed}get scale(){return this.gameObject.scale.x}get cameraScale(){return this._cameraScale}get container(){return this._container}get worldspace(){return this.main.simulationSpace===Xo.World}get localspace(){return this.main.simulationSpace===Xo.Local}get worldQuaternion(){return this.__worldQuaternion}get worldQuaternionInverted(){return this._worldQuaternionInverted}get worldScale(){return this._worldScale}get worldPos(){return this._worldPositionFrame!==this.context.time.frame&&(this._worldPositionFrame=this.context.time.frame,Mt(this.gameObject,this._worldPos)),this._worldPos}get matrixWorld(){return this._container.matrixWorld}get isSubsystem(){return this._isUsedAsSubsystem}set bursts(t){for(let i=0;i<t.length;i++){const s=t[i];if(!(s instanceof G0)){const r=new G0;Ff(r,s),t[i]=r}}this._bursts=t}set subEmitterSystems(t){for(let i=0;i<t.length;i++){const s=t[i];if(!(s instanceof $0)){const r=new $0;Ff(r,s),t[i]=r}}vg&&t.length>0&&console.log("SubEmitters: ",t,this),this._subEmitterSystems=t}onAfterDeserialize(t){if(this._subEmitterSystems&&Array.isArray(this._subEmitterSystems))for(const i of this._subEmitterSystems)i._deserialize(this.context,this.gameObject)}awake(){if(this._renderer=this.gameObject.getComponent(gr),!this.main)throw new Error("Not Supported: ParticleSystem needs a serialized MainModule. Creating new particle systems at runtime is currently not supported.");this._container=new Me,this._container.matrixAutoUpdate=!1,this.context.scene.add(this._container),this._batchSystem=new Fte,this._batchSystem.name=this.gameObject.name,this._container.add(this._batchSystem),this._interface=new wie(this),this._particleSystem=new Mte(this._interface),this._particleSystem.addBehavior(new yie(this)),this._particleSystem.addBehavior(new xie(this)),this._particleSystem.addBehavior(new mie(this)),this._particleSystem.addBehavior(new Aie(this)),this._particleSystem.addBehavior(new _ie(this)),this._particleSystem.addBehavior(new bie(this)),this._batchSystem.addSystem(this._particleSystem);const t=this._particleSystem.emitter;this.context.scene.add(t),vg&&(console.log(this),this.gameObject.add(new Zf(1)))}start(){this.addSubParticleSystems(),this.updateLayers()}onDestroy(){var t,i,s,r;(t=this._container)==null||t.removeFromParent(),(i=this._batchSystem)==null||i.removeFromParent(),(s=this._particleSystem)==null||s.emitter.removeFromParent(),(r=this._particleSystem)==null||r.dispose()}onEnable(){this.main&&(this.inheritVelocity&&(this.inheritVelocity.system=this),this._batchSystem&&(this._batchSystem.visible=!0),this.playOnAwake&&this.play(),this._isPlaying=this.playOnAwake)}onDisable(){this._batchSystem&&(this._batchSystem.visible=!1)}onBeforeRender(){var t;this.main&&(this._didPreWarm===!1&&((t=this.main)==null?void 0:t.prewarm)===!0&&(this._didPreWarm=!0,this.preWarm()),this.onUpdate(),this.onSimulate(this.deltaTime))}preWarm(){var u;if(!((u=this.emission)!=null&&u.enabled)||this.emission.rateOverTime.getMax()<=0)return;const i=1/60,s=this.main.duration,r=this.main.startLifetime.getMax(),o=1e3,a=Math.min(Math.max(s,r)/Math.max(.01,this.main.simulationSpeed),o),l=Math.ceil(a/i),c=Date.now();vg&&console.log(`Particles ${this.name} - Prewarm for ${l} frames (${a} sec). Duration: ${s}, Lifetime: ${r}`);for(let d=0;d<l&&!(this.currentParticles>=this.maxParticles);d++){const f=Date.now()-c;if(f>2e3){console.warn(`Particles ${this.name} - Prewarm took too long. Aborting: ${f}`);break}this.onUpdate(),this.onSimulate(i)}}onSimulate(t){if(this._batchSystem){let i=this.context.time.frameCount%60===0;this._lastBatchesCount!==this._batchSystem.batches.length&&(this._lastBatchesCount=this._batchSystem.batches.length,i=!0),i&&this.updateLayers(),this._batchSystem.update(t)}this._time+=t,this._time>this.duration&&(this._time=0)}updateLayers(){if(this._batchSystem)for(let t=0;t<this._batchSystem.batches.length;t++){const i=this._batchSystem.batches[t];i.layers.disableAll();const s=this.layer;i.layers.mask=1<<s}}onUpdate(){var o,a;const t=this.renderer.getMaterial(this.trails.enabled);if(t&&t.version!=this.lastMaterialVersion&&this._particleSystem&&(this.lastMaterialVersion=t.version,this._particleSystem.texture=this._interface.texture),this._bursts&&(this.emission.bursts=this._bursts,delete this._bursts),!this._isPlaying)return;const i=this.context.mainCamera;if(i){const l=Jo(i);this._cameraScale=l.x}const s=!this.worldspace,r=this.gameObject;if(Gr(r,this.__worldQuaternion),this._worldQuaternionInverted.copy(this.__worldQuaternion).invert(),Jo(this.gameObject,this._worldScale),s&&this._container&&((o=this.gameObject)!=null&&o.parent)){const l=p3(this,PE);this._container.matrix.makeScale(l.x,l.y,l.z),this._container.matrix.makeRotationFromQuaternion(this.__worldQuaternion),this._container.matrix.setPosition(this.worldPos),this._container.matrix.scale(this.gameObject.scale)}this.emission.system=this,this._interface.update(),this.shape.update(this,this.context,this.main.simulationSpace,this.gameObject),this.noise.update(this.context),(a=this.inheritVelocity)==null||a.update(this.context),this.velocityOverLifetime.update(this)}addSubParticleSystems(){var t;if(this._subEmitterSystems&&this._particleSystem)for(const i of this._subEmitterSystems){i.particleSystem&&(i.particleSystem.__internalAwake?i.particleSystem.__internalAwake():si()&&console.warn("SubParticleSystem serialization issue(?)",i.particleSystem,i));const s=(t=i.particleSystem)==null?void 0:t._particleSystem;if(s){i.particleSystem._isUsedAsSubsystem=!0;const r=new F1(this,this._particleSystem,i.particleSystem,s);r.emitterType=i.type,r.emitterProbability=i.emitProbability,this._particleSystem.addBehavior(r)}else vg&&console.warn("Could not add SubParticleSystem",i,this)}}}Ji([x(q_)],Xi.prototype,"colorOverLifetime",void 0);Ji([x(Ds)],Xi.prototype,"main",void 0);Ji([x($l)],Xi.prototype,"emission",void 0);Ji([x(Xu)],Xi.prototype,"sizeOverLifetime",void 0);Ji([x(Gi)],Xi.prototype,"shape",void 0);Ji([x(Ai)],Xi.prototype,"noise",void 0);Ji([x(Yi)],Xi.prototype,"trails",void 0);Ji([x(on)],Xi.prototype,"velocityOverLifetime",void 0);Ji([x(Un)],Xi.prototype,"limitVelocityOverLifetime",void 0);Ji([x(Yu)],Xi.prototype,"inheritVelocity",void 0);Ji([x(fp)],Xi.prototype,"colorBySpeed",void 0);Ji([x(Os)],Xi.prototype,"textureSheetAnimation",void 0);Ji([x(na)],Xi.prototype,"rotationOverLifetime",void 0);Ji([x(Mo)],Xi.prototype,"rotationBySpeed",void 0);Ji([x(vr)],Xi.prototype,"sizeBySpeed",void 0);class $0{constructor(){h(this,"particleSystem");h(this,"emitProbability",1);h(this,"properties");h(this,"type")}_deserialize(e,t){const i=this.particleSystem;if(i instanceof Xi)return;let s="";i&&typeof i.guid=="string"&&(s=i.guid,this.particleSystem=ne.findByGuid(s,t)),vg&&!(this.particleSystem instanceof Xi)&&console.warn("Could not find particle system for sub emitter",s,t,this)}}function p3(n,e){if(e.set(1,1,1),n.gameObject.parent&&n.localspace)switch(n.main.scalingMode){case z0.Local:e=Jo(n.gameObject.parent,e),e.x=1/e.x,e.y=1/e.y,e.z=1/e.z;break;default:if(!n.unsupported_scaling_mode){n.unsupported_scaling_mode=!0;const t="ParticleSystem scale mode "+z0[n.main.scalingMode]+" is not supported";si()&&Rs(t),console.warn(t,n.name,n)}e=Jo(n.gameObject,e);break}return e}new w(1,1,1);new w(0,0,1);class F1{constructor(e,t,i,s){h(this,"system");h(this,"particleSystem");h(this,"subSystem");h(this,"subParticleSystem");h(this,"type","NeedleParticleSubEmitter");h(this,"emitterType");h(this,"emitterProbability");h(this,"q_",new Se);h(this,"v_",new w);h(this,"v2_",new w);h(this,"_emitterMatrix",new Ie);h(this,"_circularBuffer");this.system=e,this.particleSystem=t,this.subSystem=i,this.subParticleSystem=s,this.subParticleSystem&&this.subParticleSystem&&(this.subParticleSystem.onlyUsedByOther=!0);const r=1e3;this._circularBuffer=new Lf(()=>new Ie,r)}clone(){throw new Error("Method not implemented.")}initialize(e){e.emissionState={burstIndex:0,burstWaveIndex:0,time:0,waitEmiting:0},this._emitterMatrix.copy(this.subSystem.matrixWorld).invert().premultiply(this.system.matrixWorld),this._emitterMatrix.setPosition(0,0,0),this.emitterType===Z0.Birth&&this.run(e)}update(e,t){this.run(e)}frameUpdate(e){}toJSON(){}reset(){}run(e){if(this.subSystem.currentParticles>=this.subSystem.main.maxParticles||!this.subParticleSystem||!e.emissionState||this.emitterProbability&&Math.random()>this.emitterProbability)return;const t=this.system.deltaTime;if(this.emitterType===Z0.Death){let s=e.life;if(e[nf]!==void 0&&(s=e[nf]),!(e.age+t*1.2>=s))return;const o=this.subSystem.main.maxParticles-this.subSystem.currentParticles;e.emissionState.waitEmiting=o}const i=new Ie;i.set(1,0,0,e.position.x,0,1,0,e.position.y,0,0,1,e.position.z,0,0,0,1),this.particleSystem.worldSpace||i.multiplyMatrices(this._emitterMatrix,i),this.subParticleSystem.emit(t,e.emissionState,i)}}var Cie=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};class cx extends Zs{constructor(){super(...arguments);h(this,"granularity")}get typeName(){return"PixelationEffect"}onCreateEffect(){const t=new lF;return this.granularity.onValueChanged=i=>{t.granularity=i},t}}Cie([x(Et)],cx.prototype,"granularity",void 0);ta("PixelationEffect",cx);class Qf extends Te{constructor(){super(...arguments);h(this,"_didAssignPlayerColor",!1)}awake(){this.context.connection.beginListen(pi.JoinedRoom,this.tryAssignColor.bind(this))}onEnable(){this._didAssignPlayerColor||this.startCoroutine(this.waitForConnection())}*waitForConnection(){for(;!this.destroyed&&this.enabled&&(yield Tq(.2),!this.tryAssignColor()););}tryAssignColor(){const t=ne.getComponentInParent(this.gameObject,as);return t&&t.connectionId?(this._didAssignPlayerColor=!0,this.assignUserColor(t.connectionId),!0):!1}assignUserColor(t){const i=Qf.hashCode(t),s=Qf.colorFromHashCode(i);if(this.gameObject.type==="Mesh"){const r=this.gameObject;this.assignColor(s,t,r)}else if(this.gameObject.children)for(const r of this.gameObject.children){const o=r;o.material&&o.material.color&&this.assignColor(s,t,o)}}assignColor(t,i,s){let r=s.material;r&&(r._playerMaterial!==i&&(r=r.clone(),r._playerMaterial=i,s.material=r),r.color=t)}static hashCode(t){var i=0,s,r;if(t.length===0)return i;for(s=0;s<t.length;s++)r=t.charCodeAt(s),i=(i<<5)-i+r,i|=0;return i}static colorFromHashCode(t){const i=(t&16711680)>>16,s=(t&65280)>>8,r=t&255;return new _e(i/255,s/255,r/255)}}new rh(-1,1,1,-1,0,1);const g3=new ft;g3.setAttribute("position",new st([-1,3,0,-1,-1,0,3,-1,0],3));g3.setAttribute("uv",new st([0,2,0,0,2,0],2));const kA=new ft;kA.setAttribute("position",new ot(new Float32Array([-1,-1,3,-1,-1,3]),2));kA.setAttribute("uv",new ot(new Float32Array([0,0,2,0,0,2]),2));kA.boundingSphere=new Ys;kA.computeBoundingSphere=function(){};const Eie=new rh;class ig{constructor(e){this._mesh=new ye(kA,e),this._mesh.frustumCulled=!1}render(e){e.render(this._mesh,Eie)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}dispose(){this._mesh.material.dispose(),this._mesh.geometry.dispose()}}const Mie={uniforms:{sceneDiffuse:{value:null},sceneDepth:{value:null},sceneNormal:{value:null},projMat:{value:new Ie},viewMat:{value:new Ie},projViewMat:{value:new Ie},projectionMatrixInv:{value:new Ie},viewMatrixInv:{value:new Ie},cameraPos:{value:new w},resolution:{value:new te},time:{value:0},samples:{value:[]},samplesR:{value:[]},bluenoise:{value:null},distanceFalloff:{value:1},radius:{value:5},near:{value:.1},far:{value:1e3},logDepth:{value:!1},ortho:{value:!1},screenSpaceRadius:{value:!1}},depthWrite:!1,depthTest:!1,vertexShader:`
varying vec2 vUv;
void main() {
  vUv = uv;
  gl_Position = vec4(position, 1);
}`,fragmentShader:`
    #define SAMPLES 16
    #define FSAMPLES 16.0
uniform sampler2D sceneDiffuse;
uniform highp sampler2D sceneNormal;
uniform highp sampler2D sceneDepth;
uniform mat4 projectionMatrixInv;
uniform mat4 viewMatrixInv;
uniform mat4 projMat;
uniform mat4 viewMat;
uniform mat4 projViewMat;
uniform vec3 cameraPos;
uniform vec2 resolution;
uniform float time;
uniform vec3[SAMPLES] samples;
uniform float[SAMPLES] samplesR;
uniform float radius;
uniform float distanceFalloff;
uniform float near;
uniform float far;
uniform bool logDepth;
uniform bool ortho;
uniform bool screenSpaceRadius;
uniform sampler2D bluenoise;
    varying vec2 vUv;
    highp float linearize_depth(highp float d, highp float zNear,highp float zFar)
    {
        return (zFar * zNear) / (zFar - d * (zFar - zNear));
    }
    highp float linearize_depth_ortho(highp float d, highp float nearZ, highp float farZ) {
      return nearZ + (farZ - nearZ) * d;
    }
    highp float linearize_depth_log(highp float d, highp float nearZ,highp float farZ) {
      float depth = pow(2.0, d * log2(farZ + 1.0)) - 1.0;
      float a = farZ / (farZ - nearZ);
      float b = farZ * nearZ / (nearZ - farZ);
      float linDepth = a + b / depth;
      return ortho ? linearize_depth_ortho(
        linDepth,
        nearZ,
        farZ
      ) :linearize_depth(linDepth, nearZ, farZ);
    }

    vec3 getWorldPosLog(vec3 posS) {
      vec2 uv = posS.xy;
      float z = posS.z;
      float nearZ =near;
      float farZ = far;
      float depth = pow(2.0, z * log2(farZ + 1.0)) - 1.0;
      float a = farZ / (farZ - nearZ);
      float b = farZ * nearZ / (nearZ - farZ);
      float linDepth = a + b / depth;
      vec4 clipVec = vec4(uv, linDepth, 1.0) * 2.0 - 1.0;
      vec4 wpos = projectionMatrixInv * clipVec;
      return wpos.xyz / wpos.w;
    }
    vec3 getWorldPos(float depth, vec2 coord) {
      #ifdef LOGDEPTH
        return getWorldPosLog(vec3(coord, depth));
      #endif
      float z = depth * 2.0 - 1.0;
      vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
      vec4 viewSpacePosition = projectionMatrixInv * clipSpacePosition;
      // Perspective division
     vec4 worldSpacePosition = viewSpacePosition;
     worldSpacePosition.xyz /= worldSpacePosition.w;
      return worldSpacePosition.xyz;
  }

  vec3 computeNormal(vec3 worldPos, vec2 vUv) {
    ivec2 p = ivec2(vUv * resolution);
    float c0 = texelFetch(sceneDepth, p, 0).x;
    float l2 = texelFetch(sceneDepth, p - ivec2(2, 0), 0).x;
    float l1 = texelFetch(sceneDepth, p - ivec2(1, 0), 0).x;
    float r1 = texelFetch(sceneDepth, p + ivec2(1, 0), 0).x;
    float r2 = texelFetch(sceneDepth, p + ivec2(2, 0), 0).x;
    float b2 = texelFetch(sceneDepth, p - ivec2(0, 2), 0).x;
    float b1 = texelFetch(sceneDepth, p - ivec2(0, 1), 0).x;
    float t1 = texelFetch(sceneDepth, p + ivec2(0, 1), 0).x;
    float t2 = texelFetch(sceneDepth, p + ivec2(0, 2), 0).x;

    float dl = abs((2.0 * l1 - l2) - c0);
    float dr = abs((2.0 * r1 - r2) - c0);
    float db = abs((2.0 * b1 - b2) - c0);
    float dt = abs((2.0 * t1 - t2) - c0);

    vec3 ce = getWorldPos(c0, vUv).xyz;

    vec3 dpdx = (dl < dr) ? ce - getWorldPos(l1, (vUv - vec2(1.0 / resolution.x, 0.0))).xyz
                          : -ce + getWorldPos(r1, (vUv + vec2(1.0 / resolution.x, 0.0))).xyz;
    vec3 dpdy = (db < dt) ? ce - getWorldPos(b1, (vUv - vec2(0.0, 1.0 / resolution.y))).xyz
                          : -ce + getWorldPos(t1, (vUv + vec2(0.0, 1.0 / resolution.y))).xyz;

    return normalize(cross(dpdx, dpdy));
}

void main() {
      vec4 diffuse = texture2D(sceneDiffuse, vUv);
      float depth = texture2D(sceneDepth, vUv).x;
      if (depth == 1.0) {
        gl_FragColor = vec4(vec3(1.0), 1.0);
        return;
      }
      vec3 worldPos = getWorldPos(depth, vUv);
    //  vec3 normal = texture2D(sceneNormal, vUv).rgb;//computeNormal(worldPos, vUv);
      #ifdef HALFRES
        vec3 normal = texture2D(sceneNormal, vUv).rgb;
      #else
        vec3 normal = computeNormal(worldPos, vUv);
      #endif
      vec4 noise = texture2D(bluenoise, gl_FragCoord.xy / 128.0);
      vec3 randomVec = normalize(noise.rgb * 2.0 - 1.0);
      vec3 tangent = normalize(randomVec - normal * dot(randomVec, normal));
      vec3 bitangent = cross(normal, tangent);
      mat3 tbn = mat3(tangent, bitangent, normal);
      float occluded = 0.0;
      float totalWeight = 0.0;
     /* float radiusScreen = distance(
        worldPos,
        getWorldPos(depth, vUv + 
          vec2(48.0, 0.0) / resolution)
      );/*vUv.x < 0.5 ? radius : min(distance(
        worldPos,
        getWorldPos(depth, vUv + 
          vec2(100.0, 0.0) / resolution)
      ), radius);
      float distanceFalloffScreen = radiusScreen * 0.2;*/
      float radiusToUse = screenSpaceRadius ? distance(
        worldPos,
        getWorldPos(depth, vUv +
          vec2(radius, 0.0) / resolution)
      ) : radius;
      float distanceFalloffToUse =screenSpaceRadius ?
          radiusToUse * distanceFalloff
      : distanceFalloff;
      float bias = (0.1 / near) * fwidth(distance(worldPos, cameraPos)) / radiusToUse;
      for(float i = 0.0; i < FSAMPLES; i++) {
        vec3 sampleDirection = 
        tbn * 
        samples[int(i)];
        ;
        float moveAmt = samplesR[int(mod(i + noise.a * FSAMPLES, FSAMPLES))];
        vec3 samplePos = worldPos + radiusToUse * moveAmt * sampleDirection;
        vec4 offset = projMat * vec4(samplePos, 1.0);
        offset.xyz /= offset.w;
        offset.xyz = offset.xyz * 0.5 + 0.5;
        float sampleDepth = textureLod(sceneDepth, offset.xy, 0.0).x;
        /*float distSample = logDepth ? linearize_depth_log(sampleDepth, near, far) 
         (ortho ?  linearize_depth_ortho(sampleDepth, near, far) : linearize_depth(sampleDepth, near, far));*/
        #ifdef LOGDEPTH
        float distSample = linearize_depth_log(sampleDepth, near, far);
        #else
        float distSample = ortho ? linearize_depth_ortho(sampleDepth, near, far) : linearize_depth(sampleDepth, near, far);
        #endif
        float distWorld = ortho ? linearize_depth_ortho(offset.z, near, far) : linearize_depth(offset.z, near, far);
        float rangeCheck = smoothstep(0.0, 1.0, distanceFalloffToUse / (abs(distSample - distWorld)));
        vec2 diff = gl_FragCoord.xy - ( offset.xy * resolution);
        float weight = dot(sampleDirection, normal);
          occluded += rangeCheck * weight * 
            (distSample + bias
               < distWorld ? 1.0 : 0.0) * (
          (dot(
            diff,
            diff
             
            ) < 1.0 || (sampleDepth == depth) || (
              offset.x < 0.0 || offset.x > 1.0 || offset.y < 0.0 || offset.y > 1.0
            ) ? 0.0 : 1.0)
          );
          totalWeight += weight;
      }
      float occ = clamp(1.0 - occluded / totalWeight, 0.0, 1.0);
      gl_FragColor = vec4(0.5 + 0.5 * normal, occ);
}`},Tie={uniforms:{sceneDiffuse:{value:null},sceneDepth:{value:null},tDiffuse:{value:null},projMat:{value:new Ie},viewMat:{value:new Ie},projectionMatrixInv:{value:new Ie},viewMatrixInv:{value:new Ie},cameraPos:{value:new w},resolution:{value:new te},color:{value:new w(0,0,0)},blueNoise:{value:null},downsampledDepth:{value:null},time:{value:0},intensity:{value:10},renderMode:{value:0},gammaCorrection:{value:!1},logDepth:{value:!1},ortho:{value:!1},near:{value:.1},far:{value:1e3},screenSpaceRadius:{value:!1},radius:{value:0},distanceFalloff:{value:1},fog:{value:!1},fogExp:{value:!1},fogDensity:{value:0},fogNear:{value:1/0},fogFar:{value:1/0},colorMultiply:{value:!0}},depthWrite:!1,depthTest:!1,vertexShader:`
		varying vec2 vUv;
		void main() {
			vUv = uv;
			gl_Position = vec4(position, 1);
		}`,fragmentShader:`
		uniform sampler2D sceneDiffuse;
    uniform highp sampler2D sceneDepth;
    uniform highp sampler2D downsampledDepth;
    uniform sampler2D tDiffuse;
    uniform sampler2D blueNoise;
    uniform vec2 resolution;
    uniform vec3 color;
    uniform mat4 projectionMatrixInv;
    uniform mat4 viewMatrixInv;
    uniform float intensity;
    uniform float renderMode;
    uniform float near;
    uniform float far;
    uniform bool gammaCorrection;
    uniform bool logDepth;
    uniform bool ortho;
    uniform bool screenSpaceRadius;
    uniform bool fog;
    uniform bool fogExp;
    uniform bool colorMultiply;
    uniform float fogDensity;
    uniform float fogNear;
    uniform float fogFar;
    uniform float radius;
    uniform float distanceFalloff;
    uniform vec3 cameraPos;
    varying vec2 vUv;
    highp float linearize_depth(highp float d, highp float zNear,highp float zFar)
    {
        return (zFar * zNear) / (zFar - d * (zFar - zNear));
    }
    highp float linearize_depth_ortho(highp float d, highp float nearZ, highp float farZ) {
      return nearZ + (farZ - nearZ) * d;
    }
    highp float linearize_depth_log(highp float d, highp float nearZ,highp float farZ) {
      float depth = pow(2.0, d * log2(farZ + 1.0)) - 1.0;
      float a = farZ / (farZ - nearZ);
      float b = farZ * nearZ / (nearZ - farZ);
      float linDepth = a + b / depth;
      return ortho ? linearize_depth_ortho(
        linDepth,
        nearZ,
        farZ
      ) :linearize_depth(linDepth, nearZ, farZ);
    }
    vec3 getWorldPosLog(vec3 posS) {
        vec2 uv = posS.xy;
        float z = posS.z;
        float nearZ =near;
        float farZ = far;
        float depth = pow(2.0, z * log2(farZ + 1.0)) - 1.0;
        float a = farZ / (farZ - nearZ);
        float b = farZ * nearZ / (nearZ - farZ);
        float linDepth = a + b / depth;
        vec4 clipVec = vec4(uv, linDepth, 1.0) * 2.0 - 1.0;
        vec4 wpos = projectionMatrixInv * clipVec;
        return wpos.xyz / wpos.w;
      }
      vec3 getWorldPos(float depth, vec2 coord) {
       // if (logDepth) {
        #ifdef LOGDEPTH
          return getWorldPosLog(vec3(coord, depth));
        #endif
      //  }
        float z = depth * 2.0 - 1.0;
        vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
        vec4 viewSpacePosition = projectionMatrixInv * clipSpacePosition;
        // Perspective division
       vec4 worldSpacePosition = viewSpacePosition;
       worldSpacePosition.xyz /= worldSpacePosition.w;
        return worldSpacePosition.xyz;
    }
  
    vec3 computeNormal(vec3 worldPos, vec2 vUv) {
      ivec2 p = ivec2(vUv * resolution);
      float c0 = texelFetch(sceneDepth, p, 0).x;
      float l2 = texelFetch(sceneDepth, p - ivec2(2, 0), 0).x;
      float l1 = texelFetch(sceneDepth, p - ivec2(1, 0), 0).x;
      float r1 = texelFetch(sceneDepth, p + ivec2(1, 0), 0).x;
      float r2 = texelFetch(sceneDepth, p + ivec2(2, 0), 0).x;
      float b2 = texelFetch(sceneDepth, p - ivec2(0, 2), 0).x;
      float b1 = texelFetch(sceneDepth, p - ivec2(0, 1), 0).x;
      float t1 = texelFetch(sceneDepth, p + ivec2(0, 1), 0).x;
      float t2 = texelFetch(sceneDepth, p + ivec2(0, 2), 0).x;
  
      float dl = abs((2.0 * l1 - l2) - c0);
      float dr = abs((2.0 * r1 - r2) - c0);
      float db = abs((2.0 * b1 - b2) - c0);
      float dt = abs((2.0 * t1 - t2) - c0);
  
      vec3 ce = getWorldPos(c0, vUv).xyz;
  
      vec3 dpdx = (dl < dr) ? ce - getWorldPos(l1, (vUv - vec2(1.0 / resolution.x, 0.0))).xyz
                            : -ce + getWorldPos(r1, (vUv + vec2(1.0 / resolution.x, 0.0))).xyz;
      vec3 dpdy = (db < dt) ? ce - getWorldPos(b1, (vUv - vec2(0.0, 1.0 / resolution.y))).xyz
                            : -ce + getWorldPos(t1, (vUv + vec2(0.0, 1.0 / resolution.y))).xyz;
  
      return normalize(cross(dpdx, dpdy));
  }

    #include <common>
    #include <dithering_pars_fragment>
    void main() {
        //vec4 texel = texture2D(tDiffuse, vUv);//vec3(0.0);
        vec4 sceneTexel = texture2D(sceneDiffuse, vUv);
        float depth = texture2D(
            sceneDepth,
            vUv
        ).x;
        #ifdef HALFRES 
        vec4 texel;
        if (depth == 1.0) {
            texel = vec4(0.0, 0.0, 0.0, 1.0);
        } else {
        vec3 worldPos = getWorldPos(depth, vUv);
        vec3 normal = computeNormal(getWorldPos(depth, vUv), vUv);
       // vec4 texel = texture2D(tDiffuse, vUv);
       // Find closest depth;
       float totalWeight = 0.0;
       float radiusToUse = screenSpaceRadius ? distance(
        worldPos,
        getWorldPos(depth, vUv +
          vec2(radius, 0.0) / resolution)
      ) : radius;
      float distanceFalloffToUse =screenSpaceRadius ?
          radiusToUse * distanceFalloff
      : distanceFalloff;
        for(float x = -1.0; x <= 1.0; x++) {
            for(float y = -1.0; y <= 1.0; y++) {
                vec2 offset = vec2(x, y);
                ivec2 p = ivec2(
                    (vUv * resolution * 0.5) + offset
                );
                vec2 pUv = vec2(p) / (resolution * 0.5);
                float sampleDepth = texelFetch(downsampledDepth,p, 0).x;
                vec4 sampleInfo = texelFetch(tDiffuse, p, 0);
                vec3 normalSample = sampleInfo.xyz * 2.0 - 1.0;
                vec3 worldPosSample = getWorldPos(sampleDepth, pUv);
                float tangentPlaneDist = abs(dot(worldPos - worldPosSample, normal));
                float rangeCheck = exp(-1.0 * tangentPlaneDist * (1.0 / distanceFalloffToUse)) * max(dot(normal, normalSample), 0.0);
                float weight = rangeCheck;
                totalWeight += weight;
                texel += sampleInfo * weight;
            }
        }
        if (totalWeight == 0.0) {
            texel = texture2D(tDiffuse, vUv);
        } else {
            texel /= totalWeight;
        }
    }
        #else
        vec4 texel = texture2D(tDiffuse, vUv);
        #endif

        #ifdef LOGDEPTH
        texel.a = clamp(texel.a, 0.0, 1.0);
        if (texel.a == 0.0) {
          texel.a = 1.0;
        }
        #endif
     
        float finalAo = pow(texel.a, intensity);
        float fogFactor;
        float fogDepth = distance(
            cameraPos,
            getWorldPos(depth, vUv)
        );
        if (fog) {
            if (fogExp) {
                fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );
            } else {
                fogFactor = smoothstep( fogNear, fogFar, fogDepth );
            }
        }
        finalAo = mix(finalAo, 1.0, fogFactor);
        vec3 aoApplied = color * mix(vec3(1.0), sceneTexel.rgb, float(colorMultiply));
        if (renderMode == 0.0) {
            gl_FragColor = vec4( mix(sceneTexel.rgb, aoApplied, 1.0 - finalAo), sceneTexel.a);
        } else if (renderMode == 1.0) {
            gl_FragColor = vec4( mix(vec3(1.0), aoApplied, 1.0 - finalAo), sceneTexel.a);
        } else if (renderMode == 2.0) {
            gl_FragColor = vec4( sceneTexel.rgb, sceneTexel.a);
        } else if (renderMode == 3.0) {
            if (vUv.x < 0.5) {
                gl_FragColor = vec4( sceneTexel.rgb, sceneTexel.a);
            } else if (abs(vUv.x - 0.5) < 1.0 / resolution.x) {
                gl_FragColor = vec4(1.0);
            } else {
                gl_FragColor = vec4( mix(sceneTexel.rgb, aoApplied, 1.0 - finalAo), sceneTexel.a);
            }
        } else if (renderMode == 4.0) {
            if (vUv.x < 0.5) {
                gl_FragColor = vec4( sceneTexel.rgb, sceneTexel.a);
            } else if (abs(vUv.x - 0.5) < 1.0 / resolution.x) {
                gl_FragColor = vec4(1.0);
            } else {
                gl_FragColor = vec4( mix(vec3(1.0), aoApplied, 1.0 - finalAo), sceneTexel.a);
            }
        }
        #include <dithering_fragment>
        if (gammaCorrection) {
            gl_FragColor = LinearTosRGB(gl_FragColor);
        }
    }
    `},Iie={uniforms:{sceneDiffuse:{value:null},sceneDepth:{value:null},tDiffuse:{value:null},projMat:{value:new Ie},viewMat:{value:new Ie},projectionMatrixInv:{value:new Ie},viewMatrixInv:{value:new Ie},cameraPos:{value:new w},resolution:{value:new te},time:{value:0},r:{value:5},blueNoise:{value:null},radius:{value:12},worldRadius:{value:5},index:{value:0},poissonDisk:{value:[]},distanceFalloff:{value:1},near:{value:.1},far:{value:1e3},logDepth:{value:!1},screenSpaceRadius:{value:!1}},depthWrite:!1,depthTest:!1,vertexShader:`
		varying vec2 vUv;
		void main() {
			vUv = uv;
			gl_Position = vec4(position, 1.0);
		}`,fragmentShader:`
		uniform sampler2D sceneDiffuse;
    uniform highp sampler2D sceneDepth;
    uniform sampler2D tDiffuse;
    uniform sampler2D blueNoise;
    uniform mat4 projectionMatrixInv;
    uniform mat4 viewMatrixInv;
    uniform vec2 resolution;
    uniform float r;
    uniform float radius;
     uniform float worldRadius;
    uniform float index;
     uniform float near;
     uniform float far;
     uniform float distanceFalloff;
     uniform bool logDepth;
     uniform bool screenSpaceRadius;
    varying vec2 vUv;

    highp float linearize_depth(highp float d, highp float zNear,highp float zFar)
    {
        highp float z_n = 2.0 * d - 1.0;
        return 2.0 * zNear * zFar / (zFar + zNear - z_n * (zFar - zNear));
    }
    highp float linearize_depth_log(highp float d, highp float nearZ,highp float farZ) {
     float depth = pow(2.0, d * log2(farZ + 1.0)) - 1.0;
     float a = farZ / (farZ - nearZ);
     float b = farZ * nearZ / (nearZ - farZ);
     float linDepth = a + b / depth;
     return linearize_depth(linDepth, nearZ, farZ);
   }
   highp float linearize_depth_ortho(highp float d, highp float nearZ, highp float farZ) {
     return nearZ + (farZ - nearZ) * d;
   }
   vec3 getWorldPosLog(vec3 posS) {
     vec2 uv = posS.xy;
     float z = posS.z;
     float nearZ =near;
     float farZ = far;
     float depth = pow(2.0, z * log2(farZ + 1.0)) - 1.0;
     float a = farZ / (farZ - nearZ);
     float b = farZ * nearZ / (nearZ - farZ);
     float linDepth = a + b / depth;
     vec4 clipVec = vec4(uv, linDepth, 1.0) * 2.0 - 1.0;
     vec4 wpos = projectionMatrixInv * clipVec;
     return wpos.xyz / wpos.w;
   }
    vec3 getWorldPos(float depth, vec2 coord) {
     #ifdef LOGDEPTH
          return getWorldPosLog(vec3(coord, depth));
     #endif
        
        float z = depth * 2.0 - 1.0;
        vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
        vec4 viewSpacePosition = projectionMatrixInv * clipSpacePosition;
        // Perspective division
       vec4 worldSpacePosition = viewSpacePosition;
       worldSpacePosition.xyz /= worldSpacePosition.w;
        return worldSpacePosition.xyz;
    }
    #include <common>
    #define NUM_SAMPLES 16
    uniform vec2 poissonDisk[NUM_SAMPLES];
    void main() {
        const float pi = 3.14159;
        vec2 texelSize = vec2(1.0 / resolution.x, 1.0 / resolution.y);
        vec2 uv = vUv;
        vec4 data = texture2D(tDiffuse, vUv);
        float occlusion = data.a;
        float baseOcc = data.a;
        vec3 normal = data.rgb * 2.0 - 1.0;
        float count = 1.0;
        float d = texture2D(sceneDepth, vUv).x;
        if (d == 1.0) {
          gl_FragColor = data;
          return;
        }
        vec3 worldPos = getWorldPos(d, vUv);
        float size = radius;
        float angle;
        if (index == 0.0) {
             angle = texture2D(blueNoise, gl_FragCoord.xy / 128.0).x * PI2;
        } else if (index == 1.0) {
             angle = texture2D(blueNoise, gl_FragCoord.xy / 128.0).y * PI2;
        } else if (index == 2.0) {
             angle = texture2D(blueNoise, gl_FragCoord.xy / 128.0).z * PI2;
        } else {
             angle = texture2D(blueNoise, gl_FragCoord.xy / 128.0).w * PI2;
        }

        mat2 rotationMatrix = mat2(cos(angle), -sin(angle), sin(angle), cos(angle));
        float radiusToUse = screenSpaceRadius ? distance(
          worldPos,
          getWorldPos(d, vUv +
            vec2(worldRadius, 0.0) / resolution)
        ) : worldRadius;
        float distanceFalloffToUse =screenSpaceRadius ?
            radiusToUse * distanceFalloff
        : distanceFalloff;


        for(int i = 0; i < NUM_SAMPLES; i++) {
            vec2 offset = (rotationMatrix * poissonDisk[i]) * texelSize * size;
            vec4 dataSample = texture2D(tDiffuse, uv + offset);
            float occSample = dataSample.a;
            vec3 normalSample = dataSample.rgb * 2.0 - 1.0;
            float dSample = texture2D(sceneDepth, uv + offset).x;
            vec3 worldPosSample = getWorldPos(dSample, uv + offset);
            float tangentPlaneDist = abs(dot(worldPos - worldPosSample, normal));
            float rangeCheck = dSample == 1.0 ? 0.0 :exp(-1.0 * tangentPlaneDist * (1.0 / distanceFalloffToUse)) * max(dot(normal, normalSample), 0.0) * (1.0 - abs(occSample - baseOcc));
            occlusion += occSample * rangeCheck;
            count += rangeCheck;
        }
        if (count > 0.0) {
          occlusion /= count;
        }
        #ifdef LOGDEPTH
          occlusion = clamp(occlusion, 0.0, 1.0);
          if (occlusion == 0.0) {
            occlusion = 1.0;
          }
        #endif
        gl_FragColor = vec4(0.5 + 0.5 * normal, occlusion);
    }
    `},Rie={uniforms:{sceneDepth:{value:null},resolution:{value:new te},near:{value:.1},far:{value:1e3},viewMatrixInv:{value:new Ie},projectionMatrixInv:{value:new Ie},logDepth:{value:!1}},depthWrite:!1,depthTest:!1,vertexShader:`
    varying vec2 vUv;
    void main() {
        vUv = uv;
        gl_Position = vec4(position, 1);
    }`,fragmentShader:`
    uniform highp sampler2D sceneDepth;
    uniform vec2 resolution;
    uniform float near;
    uniform float far;
    uniform bool logDepth;
    uniform mat4 viewMatrixInv;
    uniform mat4 projectionMatrixInv;
    varying vec2 vUv;
    layout(location = 1) out vec4 gNormal;
    vec3 getWorldPosLog(vec3 posS) {
        vec2 uv = posS.xy;
        float z = posS.z;
        float nearZ =near;
        float farZ = far;
        float depth = pow(2.0, z * log2(farZ + 1.0)) - 1.0;
        float a = farZ / (farZ - nearZ);
        float b = farZ * nearZ / (nearZ - farZ);
        float linDepth = a + b / depth;
        vec4 clipVec = vec4(uv, linDepth, 1.0) * 2.0 - 1.0;
        vec4 wpos = projectionMatrixInv * clipVec;
        return wpos.xyz / wpos.w;
      }
      vec3 getWorldPos(float depth, vec2 coord) {
        if (logDepth) {
          return getWorldPosLog(vec3(coord, depth));
        }
        float z = depth * 2.0 - 1.0;
        vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
        vec4 viewSpacePosition = projectionMatrixInv * clipSpacePosition;
        // Perspective division
       vec4 worldSpacePosition = viewSpacePosition;
       worldSpacePosition.xyz /= worldSpacePosition.w;
        return worldSpacePosition.xyz;
    }
  
    vec3 computeNormal(vec3 worldPos, vec2 vUv) {
      ivec2 p = ivec2(vUv * resolution);
      float c0 = texelFetch(sceneDepth, p, 0).x;
      float l2 = texelFetch(sceneDepth, p - ivec2(2, 0), 0).x;
      float l1 = texelFetch(sceneDepth, p - ivec2(1, 0), 0).x;
      float r1 = texelFetch(sceneDepth, p + ivec2(1, 0), 0).x;
      float r2 = texelFetch(sceneDepth, p + ivec2(2, 0), 0).x;
      float b2 = texelFetch(sceneDepth, p - ivec2(0, 2), 0).x;
      float b1 = texelFetch(sceneDepth, p - ivec2(0, 1), 0).x;
      float t1 = texelFetch(sceneDepth, p + ivec2(0, 1), 0).x;
      float t2 = texelFetch(sceneDepth, p + ivec2(0, 2), 0).x;
  
      float dl = abs((2.0 * l1 - l2) - c0);
      float dr = abs((2.0 * r1 - r2) - c0);
      float db = abs((2.0 * b1 - b2) - c0);
      float dt = abs((2.0 * t1 - t2) - c0);
  
      vec3 ce = getWorldPos(c0, vUv).xyz;
  
      vec3 dpdx = (dl < dr) ? ce - getWorldPos(l1, (vUv - vec2(1.0 / resolution.x, 0.0))).xyz
                            : -ce + getWorldPos(r1, (vUv + vec2(1.0 / resolution.x, 0.0))).xyz;
      vec3 dpdy = (db < dt) ? ce - getWorldPos(b1, (vUv - vec2(0.0, 1.0 / resolution.y))).xyz
                            : -ce + getWorldPos(t1, (vUv + vec2(0.0, 1.0 / resolution.y))).xyz;
  
      return normalize(cross(dpdx, dpdy));
  }
    void main() {
        vec2 uv = vUv - vec2(0.5) / resolution;
        vec2 pixelSize = vec2(1.0) / resolution;
        vec2[] uvSamples = vec2[4](
            uv,
            uv + vec2(pixelSize.x, 0.0),
            uv + vec2(0.0, pixelSize.y),
            uv + pixelSize
        );
        float depth00 = texture2D(sceneDepth, uvSamples[0]).r;
        float depth10 = texture2D(sceneDepth, uvSamples[1]).r;
        float depth01 = texture2D(sceneDepth, uvSamples[2]).r;
        float depth11 = texture2D(sceneDepth, uvSamples[3]).r;
        float minDepth = min(min(depth00, depth10), min(depth01, depth11));
        float maxDepth = max(max(depth00, depth10), max(depth01, depth11));
        float targetDepth = minDepth;
        // Checkerboard pattern to avoid artifacts
        if (mod(gl_FragCoord.x + gl_FragCoord.y, 2.0) > 0.5) { 
            targetDepth = maxDepth;
        }
        int chosenIndex = 0;
        float[] samples = float[4](depth00, depth10, depth01, depth11);
        for(int i = 0; i < 4; ++i) {
            if (samples[i] == targetDepth) {
                chosenIndex = i;
                break;
            }
        }
        gl_FragColor = vec4(samples[chosenIndex], 0.0, 0.0, 1.0);
        gNormal = vec4(computeNormal(
            getWorldPos(samples[chosenIndex], uvSamples[chosenIndex]), uvSamples[chosenIndex]
        ), 0.0);
       /* float[] samples = float[4](depth00, depth10, depth01, depth11);
        float c = 0.25 * (depth00 + depth10 + depth01 + depth11);
        float[] distances = float[4](depth00, depth10, depth01, depth11);
        float maxDistance = max(max(distances[0], distances[1]), max(distances[2], distances[3]));

        int remaining[3];
        int rejected[3];
        int i, j, k;

        for(i = 0, j = 0, k = 0; i < 4; ++i) {
            if (distances[i] < maxDistance) {
                remaining[j++] = i;
            } else {
                rejected[k++] = i;
            }
        }
        for(;j < 3;++j) {
            remaining[j] = rejected[--k];
        }
        vec3 s = vec3(
            samples[remaining[0]],
            samples[remaining[1]],
            samples[remaining[2]]
        );
        c = (s.x + s.y + s.z) / 3.0;

        distances[0] = abs(c - s.x);
        distances[1] = abs(c - s.y);
        distances[2] = abs(c - s.z);

        float minDistance = min(min(distances[0], distances[1]), distances[2]);

        for(i = 0; i < 3; ++i) {
            if (distances[i] == minDistance) {
                break;
            }
        }*/
      /*  gl_FragColor = vec4(samples[remaining[i]], 0.0, 0.0, 0.0);
        gNormal = vec4(computeNormal(
            getWorldPos(samples[remaining[i]], uvSamples[remaining[i]]), uvSamples[remaining[i]]
        ), 0.0);*/
    }`};var m3="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";const Pie=Uint8Array.from(atob(m3),n=>n.charCodeAt(0));function A3(n,e,t){if(e.getQueryParameter(n,e.QUERY_RESULT_AVAILABLE)){const r=e.getQueryParameter(n,e.QUERY_RESULT)/1e6;t.lastTime=r}else setTimeout(()=>{A3(n,e,t)},1)}class v3 extends Ps{constructor(e,t,i=512,s=512){super(),this.width=i,this.height=s,this.clear=!0,this.camera=t,this.scene=e,this.autosetGamma=!0,this.configuration=new Proxy({aoSamples:16,aoRadius:5,denoiseSamples:8,denoiseRadius:12,distanceFalloff:1,intensity:5,denoiseIterations:2,renderMode:0,color:new _e(0,0,0),gammaCorrection:!0,logarithmicDepthBuffer:!1,screenSpaceRadius:!1,halfRes:!1,depthAwareUpsampling:!0,colorMultiply:!0},{set:(r,o,a)=>{const l=r[o];return r[o]=a,o==="aoSamples"&&l!==a&&this.configureAOPass(this.configuration.logarithmicDepthBuffer),o==="denoiseSamples"&&l!==a&&this.configureDenoisePass(this.configuration.logarithmicDepthBuffer),o==="halfRes"&&l!==a&&(this.configureAOPass(this.configuration.logarithmicDepthBuffer),this.configureHalfResTargets(),this.configureEffectCompositer(this.configuration.logarithmicDepthBuffer),this.setSize(this.width,this.height)),o==="depthAwareUpsampling"&&l!==a&&this.configureEffectCompositer(this.configuration.logarithmicDepthBuffer),o==="gammaCorrection"&&(this.autosetGamma=!1),!0}}),this.samples=[],this.samplesR=[],this.samplesDenoise=[],this.configureEffectCompositer(this.configuration.logarithmicDepthBuffer),this.configureSampleDependentPasses(),this.configureHalfResTargets(),this.copyQuad=new ig(new Bt({uniforms:{tDiffuse:{value:null}},depthWrite:!1,vertexShader:`
            varying vec2 vUv;
            void main() {
                vUv = uv;
                gl_Position = vec4(position, 1);
            }
            `,fragmentShader:`
            uniform sampler2D tDiffuse;
            varying vec2 vUv;
            void main() {
                gl_FragColor = texture2D(tDiffuse, vUv);
            }
            `})),this.writeTargetInternal=new ni(this.width,this.height,{minFilter:Dt,magFilter:Dt,depthBuffer:!1}),this.readTargetInternal=new ni(this.width,this.height,{minFilter:Dt,magFilter:Dt,depthBuffer:!1}),this.outputTargetInternal=new ni(this.width,this.height,{minFilter:Dt,magFilter:Dt,depthBuffer:!1}),this.bluenoise=new Ao(Pie,128,128),this.bluenoise.colorSpace=ur,this.bluenoise.wrapS=vo,this.bluenoise.wrapT=vo,this.bluenoise.minFilter=Ft,this.bluenoise.magFilter=Ft,this.bluenoise.needsUpdate=!0,this.lastTime=0,this.needsDepthTexture=!0,this.needsSwap=!0,this._r=new te,this._c=new _e}configureHalfResTargets(){this.configuration.halfRes?(this.depthDownsampleTarget=new Mk(this.width/2,this.height/2,2),this.depthDownsampleTarget.texture[0].format=wl,this.depthDownsampleTarget.texture[0].type=sn,this.depthDownsampleTarget.texture[0].minFilter=Ft,this.depthDownsampleTarget.texture[0].magFilter=Ft,this.depthDownsampleTarget.texture[0].depthBuffer=!1,this.depthDownsampleTarget.texture[1].format=Ti,this.depthDownsampleTarget.texture[1].type=xn,this.depthDownsampleTarget.texture[1].minFilter=Ft,this.depthDownsampleTarget.texture[1].magFilter=Ft,this.depthDownsampleTarget.texture[1].depthBuffer=!1,this.depthDownsampleQuad=new ig(new Bt(Rie))):(this.depthDownsampleTarget&&(this.depthDownsampleTarget.dispose(),this.depthDownsampleTarget=null),this.depthDownsampleQuad&&(this.depthDownsampleQuad.dispose(),this.depthDownsampleQuad=null))}configureSampleDependentPasses(){this.configureAOPass(this.configuration.logarithmicDepthBuffer),this.configureDenoisePass(this.configuration.logarithmicDepthBuffer)}configureAOPass(e=!1){this.samples=this.generateHemisphereSamples(this.configuration.aoSamples),this.samplesR=this.generateHemisphereSamplesR(this.configuration.aoSamples);const t={...Mie};t.fragmentShader=t.fragmentShader.replace("16",this.configuration.aoSamples).replace("16.0",this.configuration.aoSamples+".0"),e&&(t.fragmentShader=`#define LOGDEPTH
`+t.fragmentShader),this.configuration.halfRes&&(t.fragmentShader=`#define HALFRES
`+t.fragmentShader),this.effectShaderQuad?(this.effectShaderQuad.material.dispose(),this.effectShaderQuad.material=new Bt(t)):this.effectShaderQuad=new ig(new Bt(t))}configureDenoisePass(e=!1){this.samplesDenoise=this.generateDenoiseSamples(this.configuration.denoiseSamples,11);const t={...Iie};t.fragmentShader=t.fragmentShader.replace("16",this.configuration.denoiseSamples),e&&(t.fragmentShader=`#define LOGDEPTH
`+t.fragmentShader),this.poissonBlurQuad?(this.poissonBlurQuad.material.dispose(),this.poissonBlurQuad.material=new Bt(t)):this.poissonBlurQuad=new ig(new Bt(t))}configureEffectCompositer(e=!1){const t={...Tie};e&&(t.fragmentShader=`#define LOGDEPTH
`+t.fragmentShader),this.configuration.halfRes&&this.configuration.depthAwareUpsampling&&(t.fragmentShader=`#define HALFRES
`+t.fragmentShader),this.effectCompositerQuad?(this.effectCompositerQuad.material.dispose(),this.effectCompositerQuad.material=new Bt(t)):this.effectCompositerQuad=new ig(new Bt(t))}generateHemisphereSamples(e){const t=[];for(let i=0;i<e;i++){const s=2.399963*i,r=Math.sqrt(i+.5)/Math.sqrt(e),o=r*Math.cos(s),a=r*Math.sin(s),l=Math.sqrt(1-(o*o+a*a));t.push(new w(o,a,l))}return t}generateHemisphereSamplesR(e){let t=[];for(let i=0;i<e;i++)t.push((i+1)/e);return t}generateDenoiseSamples(e,t){const i=2*Math.PI*t/e,s=1/e,r=s,o=[];let a=s,l=0;for(let c=0;c<e;c++)o.push(new te(Math.cos(l),Math.sin(l)).multiplyScalar(Math.pow(a,.75))),a+=r,l+=i;return o}setSize(e,t){this.width=e,this.height=t;const i=this.configuration.halfRes?.5:1;this.writeTargetInternal.setSize(e*i,t*i),this.readTargetInternal.setSize(e*i,t*i),this.configuration.halfRes&&this.depthDownsampleTarget.setSize(e*i,t*i),this.outputTargetInternal.setSize(e,t)}setDepthTexture(e){this.depthTexture=e}render(e,t,i){const s=e.xr.enabled;e.xr.enabled=!1,e.capabilities.logarithmicDepthBuffer!==this.configuration.logarithmicDepthBuffer&&(this.configuration.logarithmicDepthBuffer=e.capabilities.logarithmicDepthBuffer,this.configureAOPass(this.configuration.logarithmicDepthBuffer),this.configureDenoisePass(this.configuration.logarithmicDepthBuffer),this.configureEffectCompositer(this.configuration.logarithmicDepthBuffer)),t.texture.type!==this.outputTargetInternal.texture.type&&(this.outputTargetInternal.texture.type=t.texture.type,this.outputTargetInternal.texture.needsUpdate=!0);let r,o,a;this.debugMode&&(r=e.getContext(),o=r.getExtension("EXT_disjoint_timer_query_webgl2"),o===null&&(console.error("EXT_disjoint_timer_query_webgl2 not available, disabling debug mode."),this.debugMode=!1)),this.debugMode&&(a=r.createQuery(),r.beginQuery(o.TIME_ELAPSED_EXT,a)),this.camera.updateMatrixWorld(),this._r.set(this.width,this.height);let l=this.configuration.aoRadius;this.configuration.halfRes&&this.configuration.screenSpaceRadius&&(l*=.5),this.configuration.halfRes&&(e.setRenderTarget(this.depthDownsampleTarget),this.depthDownsampleQuad.material.uniforms.sceneDepth.value=this.depthTexture,this.depthDownsampleQuad.material.uniforms.resolution.value=this._r,this.depthDownsampleQuad.material.uniforms.near.value=this.camera.near,this.depthDownsampleQuad.material.uniforms.far.value=this.camera.far,this.depthDownsampleQuad.material.uniforms.projectionMatrixInv.value=this.camera.projectionMatrixInverse,this.depthDownsampleQuad.material.uniforms.viewMatrixInv.value=this.camera.matrixWorld,this.depthDownsampleQuad.material.uniforms.logDepth.value=this.configuration.logarithmicDepthBuffer,this.depthDownsampleQuad.render(e)),this.effectShaderQuad.material.uniforms.sceneDiffuse.value=t.texture,this.effectShaderQuad.material.uniforms.sceneDepth.value=this.configuration.halfRes?this.depthDownsampleTarget.texture[0]:this.depthTexture,this.effectShaderQuad.material.uniforms.sceneNormal.value=this.configuration.halfRes?this.depthDownsampleTarget.texture[1]:null,this.effectShaderQuad.material.uniforms.projMat.value=this.camera.projectionMatrix,this.effectShaderQuad.material.uniforms.viewMat.value=this.camera.matrixWorldInverse,this.effectShaderQuad.material.uniforms.projViewMat.value=this.camera.projectionMatrix.clone().multiply(this.camera.matrixWorldInverse.clone()),this.effectShaderQuad.material.uniforms.projectionMatrixInv.value=this.camera.projectionMatrixInverse,this.effectShaderQuad.material.uniforms.viewMatrixInv.value=this.camera.matrixWorld,this.effectShaderQuad.material.uniforms.cameraPos.value=this.camera.getWorldPosition(new w),this.effectShaderQuad.material.uniforms.resolution.value=this.configuration.halfRes?this._r.clone().multiplyScalar(.5).floor():this._r,this.effectShaderQuad.material.uniforms.time.value=performance.now()/1e3,this.effectShaderQuad.material.uniforms.samples.value=this.samples,this.effectShaderQuad.material.uniforms.samplesR.value=this.samplesR,this.effectShaderQuad.material.uniforms.bluenoise.value=this.bluenoise,this.effectShaderQuad.material.uniforms.radius.value=l,this.effectShaderQuad.material.uniforms.distanceFalloff.value=this.configuration.distanceFalloff,this.effectShaderQuad.material.uniforms.near.value=this.camera.near,this.effectShaderQuad.material.uniforms.far.value=this.camera.far,this.effectShaderQuad.material.uniforms.logDepth.value=e.capabilities.logarithmicDepthBuffer,this.effectShaderQuad.material.uniforms.ortho.value=this.camera.isOrthographicCamera,this.effectShaderQuad.material.uniforms.screenSpaceRadius.value=this.configuration.screenSpaceRadius,e.setRenderTarget(this.writeTargetInternal),this.effectShaderQuad.render(e);for(let c=0;c<this.configuration.denoiseIterations;c++)[this.writeTargetInternal,this.readTargetInternal]=[this.readTargetInternal,this.writeTargetInternal],this.poissonBlurQuad.material.uniforms.tDiffuse.value=this.readTargetInternal.texture,this.poissonBlurQuad.material.uniforms.sceneDepth.value=this.configuration.halfRes?this.depthDownsampleTarget.texture[0]:this.depthTexture,this.poissonBlurQuad.material.uniforms.projMat.value=this.camera.projectionMatrix,this.poissonBlurQuad.material.uniforms.viewMat.value=this.camera.matrixWorldInverse,this.poissonBlurQuad.material.uniforms.projectionMatrixInv.value=this.camera.projectionMatrixInverse,this.poissonBlurQuad.material.uniforms.viewMatrixInv.value=this.camera.matrixWorld,this.poissonBlurQuad.material.uniforms.cameraPos.value=this.camera.getWorldPosition(new w),this.poissonBlurQuad.material.uniforms.resolution.value=this.configuration.halfRes?this._r.clone().multiplyScalar(.5).floor():this._r,this.poissonBlurQuad.material.uniforms.time.value=performance.now()/1e3,this.poissonBlurQuad.material.uniforms.blueNoise.value=this.bluenoise,this.poissonBlurQuad.material.uniforms.radius.value=this.configuration.denoiseRadius*(this.configuration.halfRes?.5:1),this.poissonBlurQuad.material.uniforms.worldRadius.value=l,this.poissonBlurQuad.material.uniforms.distanceFalloff.value=this.configuration.distanceFalloff,this.poissonBlurQuad.material.uniforms.index.value=c,this.poissonBlurQuad.material.uniforms.poissonDisk.value=this.samplesDenoise,this.poissonBlurQuad.material.uniforms.near.value=this.camera.near,this.poissonBlurQuad.material.uniforms.far.value=this.camera.far,this.poissonBlurQuad.material.uniforms.logDepth.value=e.capabilities.logarithmicDepthBuffer,this.poissonBlurQuad.material.uniforms.screenSpaceRadius.value=this.configuration.screenSpaceRadius,e.setRenderTarget(this.writeTargetInternal),this.poissonBlurQuad.render(e);this.effectCompositerQuad.material.uniforms.sceneDiffuse.value=t.texture,this.effectCompositerQuad.material.uniforms.sceneDepth.value=this.depthTexture,this.effectCompositerQuad.material.uniforms.near.value=this.camera.near,this.effectCompositerQuad.material.uniforms.far.value=this.camera.far,this.effectCompositerQuad.material.uniforms.projectionMatrixInv.value=this.camera.projectionMatrixInverse,this.effectCompositerQuad.material.uniforms.viewMatrixInv.value=this.camera.matrixWorld,this.effectCompositerQuad.material.uniforms.logDepth.value=e.capabilities.logarithmicDepthBuffer,this.effectCompositerQuad.material.uniforms.ortho.value=this.camera.isOrthographicCamera,this.effectCompositerQuad.material.uniforms.downsampledDepth.value=this.configuration.halfRes?this.depthDownsampleTarget.texture[0]:this.depthTexture,this.effectCompositerQuad.material.uniforms.resolution.value=this._r,this.effectCompositerQuad.material.uniforms.blueNoise.value=this.bluenoise,this.effectCompositerQuad.material.uniforms.intensity.value=this.configuration.intensity,this.effectCompositerQuad.material.uniforms.renderMode.value=this.configuration.renderMode,this.effectCompositerQuad.material.uniforms.screenSpaceRadius.value=this.configuration.screenSpaceRadius,this.effectCompositerQuad.material.uniforms.radius.value=l,this.effectCompositerQuad.material.uniforms.distanceFalloff.value=this.configuration.distanceFalloff,this.effectCompositerQuad.material.uniforms.gammaCorrection.value=this.autosetGamma?this.renderToScreen:this.configuration.gammaCorrection,this.effectCompositerQuad.material.uniforms.tDiffuse.value=this.writeTargetInternal.texture,this.effectCompositerQuad.material.uniforms.color.value=this._c.copy(this.configuration.color).convertSRGBToLinear(),this.effectCompositerQuad.material.uniforms.colorMultiply.value=this.configuration.colorMultiply,this.effectCompositerQuad.material.uniforms.cameraPos.value=this.camera.getWorldPosition(new w),this.effectCompositerQuad.material.uniforms.fog.value=!!this.scene.fog,this.scene.fog&&(this.scene.fog.isFog?(this.effectCompositerQuad.material.uniforms.fogExp.value=!1,this.effectCompositerQuad.material.uniforms.fogNear.value=this.scene.fog.near,this.effectCompositerQuad.material.uniforms.fogFar.value=this.scene.fog.far):this.scene.fog.isFogExp2?(this.effectCompositerQuad.material.uniforms.fogExp.value=!0,this.effectCompositerQuad.material.uniforms.fogDensity.value=this.scene.fog.density):console.error(`Unsupported fog type ${this.scene.fog.constructor.name} in SSAOPass.`)),e.setRenderTarget(this.outputTargetInternal),this.effectCompositerQuad.render(e),e.setRenderTarget(this.renderToScreen?null:i),this.copyQuad.material.uniforms.tDiffuse.value=this.outputTargetInternal.texture,this.copyQuad.render(e),this.debugMode&&(r.endQuery(o.TIME_ELAPSED_EXT),A3(a,r,this)),e.xr.enabled=s}enableDebugMode(){this.debugMode=!0}disableDebugMode(){this.debugMode=!1}setDisplayMode(e){this.configuration.renderMode=["Combined","AO","No AO","Split","Split AO"].indexOf(e)}setQualityMode(e){e==="Performance"?(this.configuration.aoSamples=8,this.configuration.denoiseSamples=4,this.configuration.denoiseRadius=12):e==="Low"?(this.configuration.aoSamples=16,this.configuration.denoiseSamples=4,this.configuration.denoiseRadius=12):e==="Medium"?(this.configuration.aoSamples=16,this.configuration.denoiseSamples=8,this.configuration.denoiseRadius=12):e==="High"?(this.configuration.aoSamples=64,this.configuration.denoiseSamples=8,this.configuration.denoiseRadius=6):e==="Ultra"&&(this.configuration.aoSamples=64,this.configuration.denoiseSamples=16,this.configuration.denoiseRadius=6)}}Uint8Array.from(atob(m3),n=>n.charCodeAt(0));const my=re("debugpost"),vS=Symbol("needle:postprocessing-handler"),yS=Symbol("needle:previous-autoclear-state");class U1{constructor(e){h(this,"_composer",null);h(this,"_lastVolumeComponents");h(this,"_effects",[]);h(this,"_isActive",!1);h(this,"context");this.context=e}get isActive(){return this._isActive}get composer(){return this._composer}apply(e){this._isActive=!0,this.onApply(this.context,e)}unapply(){var i;if(this._isActive=!1,this._lastVolumeComponents){for(const s of this._lastVolumeComponents)s.unapply();this._lastVolumeComponents.length=0}const e=this.context;e[vS]===this&&delete e[vS],e.composer===this._composer&&((i=e.composer)==null||i.dispose(),e.composer=null),typeof e.renderer[yS]=="boolean"&&(e.renderer.autoClear=e.renderer[yS])}dispose(){this.unapply();for(const e of this._effects)e.dispose();this._effects.length=0,this._composer=null}onApply(e,t){if(t){e[vS]=this,my&&console.log("refreshing volume profile",t),this._lastVolumeComponents=[...t],this._effects.length=0;for(const i of t)if(i.context=e,i.apply){if(i.active){if(!e.mainCameraComponent){console.error("No camera in scene found or available yet - can not create postprocessing effects");return}const s=i.apply();if(!s)continue;Array.isArray(s)?this._effects.push(...s):this._effects.push(s)}}else i.active&&Rs("Volume component is not a VolumeComponent: "+i.__type);this.applyEffects(e)}}applyEffects(e){const t=this._effects;if(t.length<=0)return;const i=e.mainCameraComponent,s=e.renderer,r=e.scene,o=i.cam;s[yS]=s.autoClear,this._composer||(this._composer=new aT(s,{frameBufferType:xn,stencilBuffer:!0,multisampling:ch()?0:8})),e.composer=this._composer;const a=e.composer;a.setMainCamera(o),a.setRenderer(s),a.setMainScene(r);for(const c of a.passes)c.dispose();a.removeAllPasses();const l=new p_(r,o);l.mainScene=r,a.addPass(l);try{this.orderEffects();const c=[];for(const u of t)if(u instanceof $o)c.push(u);else if(u instanceof Ps){const d=new zP(o,...c);d.mainScene=r,d.name=c.map(f=>f.constructor.name).join(", "),d.enabled=!0,c.length=0,a.addPass(u)}if(c.length>0){const u=new zP(o,...c);u.mainScene=r,u.enabled=!0,a.addPass(u)}}catch(c){console.error("Error while applying postprocessing effects",c),a.removeAllPasses(),a.addPass(l)}my&&console.log("PostProcessing Passes",t,"->",a.passes)}orderEffects(){var t;my&&console.log("Before ordering effects",[...this._effects]);const e=this._effects;e.sort((i,s)=>{const r=gO.indexOf(i.constructor),o=gO.indexOf(s.constructor);return r<0&&o<0?-1:r<0?1:o<0?-1:r-o}),my&&console.log("After ordering effects",[...this._effects]);for(let i=0;i<e.length;i++){const s=e[i];if(((t=s==null?void 0:s.configuration)==null?void 0:t.gammaCorrection)!==void 0){const r=i===e.length-1;s.configuration.gammaCorrection=r}}}}const gO=[nF,rT,hF,v3,oF,lT,cF,uF,aF,rF,sF,lF],Yg=re("debugautosync"),bS=Symbol("syncerId");class Bie{constructor(){h(this,"_syncers",{})}getOrCreateSyncer(e){if(!e.guid)return null;if(this._syncers[e.guid])return this._syncers[e.guid];const t=new Die(e);return t[bS]=e.guid,this._syncers[t[bS]]=t,t}removeSyncer(e){delete this._syncers[e[bS]]}}const N1=new Bie;class Die{constructor(e){h(this,"comp");h(this,"hasChanges",!1);h(this,"changedProperties",{});h(this,"data",{});h(this,"_boundEvent");h(this,"_handleReceivingMethod");h(this,"_isReceiving",!1);h(this,"_isInit",!1);this.comp=e}get networkingKey(){return this.comp.constructor.name}init(e){if(this._isInit)return;this._isInit=!0,this.comp=e,this._boundEvent=this.onHandleSending.bind(this),this.comp.context.post_render_callbacks.push(this._boundEvent),this._handleReceivingMethod=this.onHandleReceiving.bind(this),this.comp.context.connection.beginListen(this.networkingKey,this._handleReceivingMethod);const t=this.comp.context.connection.tryGetState(this.comp.guid);t&&this.onHandleReceiving(t)}destroy(){this._isInit&&(this._boundEvent&&this.comp.context.post_render_callbacks.splice(this.comp.context.post_render_callbacks.indexOf(this._boundEvent),1),this._handleReceivingMethod&&this.comp.context.connection.stopListen(this.networkingKey,this._handleReceivingMethod),this.comp=null,this._isInit=!1)}notifyChanged(e,t){this._isReceiving||(this.hasChanges=!0,this.changedProperties[e]=t)}onHandleSending(){if(!this.hasChanges)return;this.hasChanges=!1;const e=this.comp.context.connection;if(!e||!e.isConnected){for(const t in this.changedProperties)delete this.changedProperties[t];return}for(const t in this.data)delete this.data[t];this.data.guid=this.comp.guid;for(const t in this.changedProperties){const i=this.changedProperties[t];delete this.changedProperties[t],this.data[t]=i}e.send(this.networkingKey,this.data)}onHandleReceiving(e){if(!this._isInit||!this.comp)return;const t=e.guid;if(!(t&&t!==this.comp.guid)){Yg&&console.log("RECEIVED",this.comp.name,this.comp.guid,e);try{this._isReceiving=!0;for(const i in e){if(i==="guid")continue;const s=e[i];this.comp[i]=s,Yg&&console.log("SET",i,s)}}catch(i){console.error(i)}finally{this._isReceiving=!1}}}}function Oie(n,e){let t=e!==n;return!t&&n&&e&&(Array.isArray(n)&&Array.isArray(e)||typeof n=="object"&&typeof e=="object")&&(t=!0),t}const Jg=Symbol("AutoSyncHandler");function kie(n){if(n[Jg])return n[Jg];const e=N1.getOrCreateSyncer(n);return e==null||e.init(n),n[Jg]=e,e}function Lie(n){const e=n[Jg];e&&(N1.removeSyncer(e),e.destroy(),delete n[Jg])}const z1=function(n){return function(e,t){var u;let i="";typeof t=="string"?i=t:i=t.name;let s=null,r;typeof n=="string"?r=e[n]:typeof n=="function"&&(r=n);const o=e,a=o.__internalAwake;if(typeof a!="function"){(Yg||si())&&console.error('@syncField can currently only used on Needle Engine Components, custom object of type "'+((u=e==null?void 0:e.constructor)==null?void 0:u.name)+'" is not supported',e);return}Yg&&console.log(i);const l=Symbol(i);o.__internalAwake=function(){if(this[l]!==void 0)return;this[l]=this[i],s=N1.getOrCreateSyncer(this);const d=Object.getOwnPropertyDescriptor(this,i);if((d==null?void 0:d.set)===void 0){let f=!1;Object.defineProperty(this,i,{set:function(p){var A;const g=this[l];if(this[l]=p,f){si()&&console.warn("Recursive call detected",i);return}f=!0;try{const v=Oie(p,g);Yg&&console.log("SyncField assignment",i,"changed?",v,p),v&&(r==null?void 0:r.call(this,p,g))!==!1&&((A=kie(this))==null||A.notifyChanged(i,p))}finally{f=!1}},get:function(){return this[l]},configurable:!0,enumerable:!0})}s==null||s.init(this),a.call(this)};const c=o.__internalDestroy;o.__internalDestroy=function(){Lie(this),c.call(this)}}};async function G1(n){const{NeedleEngineHTMLElement:e}=await e_(()=>Promise.resolve().then(()=>Fne),void 0,import.meta.url);e.observedAttributes.includes(n)||e.observedAttributes.push(n)}var hx=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const Ra=re("debugskybox");G1("skybox-image");G1("environment-image");function mO(n,e,t,i,s){const r=new ih;r.allowDrop=!1,r.allowNetworking=!1,r.background=t,r.environment=i,ne.addComponent(n.scene,r);const o=a=>{typeof a=="string"&&(Ra&&console.log(s,"CHANGED TO",a),r.setSkybox(a))};return a8(n.domElement,s,o),r.addEventListener("destroy",()=>{Ra&&console.log("Destroyed attribute remote skybox",s),l8(n.domElement,s,o)}),r.setSkybox(e)}en.addContextCreatedCallback(n=>{const e=n.context,t=e.domElement.getAttribute("skybox-image"),i=e.domElement.getAttribute("environment-image"),s=new Array;if(t){Ra&&console.log("Creating remote skybox to load "+t);const r=mO(e,t,!0,!1,"skybox-image");s.push(r)}if(i){Ra&&console.log("Creating remote environment to load "+i);const r=mO(e,i,!1,!0,"environment-image");s.push(r)}return s.length>0?UM(s):Promise.resolve()});function y3(){return globalThis.NEEDLE_ENGINE_SKYBOX_TEXTURES||(globalThis.NEEDLE_ENGINE_SKYBOX_TEXTURES=new Array),globalThis.NEEDLE_ENGINE_SKYBOX_TEXTURES}function Fie(n){const t=y3().find(i=>i.src===n);return t?(Ra&&console.log("Skybox: Found previously loaded texture for "+n),t.texture):null}async function Uie(n){const e=await n;F2(e,!0),Bi(e)}function Nie(n,e){const t=y3();for(;t.length>5;){const i=t.shift();i&&Uie(i.texture)}e.then(i=>F2(i,!1)),t.push({src:n,texture:e})}class ih extends Te{constructor(){super(...arguments);h(this,"url");h(this,"allowDrop",!0);h(this,"background",!0);h(this,"environment",!0);h(this,"allowNetworking",!0);h(this,"_loader");h(this,"_prevUrl");h(this,"_prevLoadedEnvironment");h(this,"_prevEnvironment",null);h(this,"_prevBackground",null);h(this,"dragOverEvent");h(this,"dropEvent")}onEnable(){this.setSkybox(this.url),this.registerDropEvents()}onDisable(){var t;this.context.scene.environment===this._prevLoadedEnvironment&&(this.context.scene.environment=this._prevEnvironment,yi.backgroundShouldBeTransparent(this.context)||(this.context.scene.background=this._prevBackground),this._prevLoadedEnvironment=void 0),this.unregisterDropEvents(),(t=this.context.mainCameraComponent)==null||t.applyClearFlags()}urlChangedSyncField(){this.allowNetworking&&this.setSkybox(this.url)}async setSkybox(t){var r;if(!this.activeAndEnabled||!t)return;if(!(t!=null&&t.endsWith(".hdr"))&&!t.endsWith(".exr")&&!t.endsWith(".jpg")&&!t.endsWith(".png")&&!t.endsWith(".jpeg")&&console.warn("Potentially invalid skybox url",this.url,"on",this.name),Ra&&console.log("Remote skybox url?: "+t),this._prevUrl===t&&this._prevLoadedEnvironment){this.applySkybox();return}else(r=this._prevLoadedEnvironment)==null||r.dispose(),this._prevLoadedEnvironment=void 0;this._prevUrl=t;const i=await this.loadTexture(t);if(!i||!this.enabled)return;this.url=t;const s=t.lastIndexOf("/");i.name=t.substring(s>=0?s+1:0),this._loader instanceof kl&&(i.colorSpace=Je),this._prevLoadedEnvironment=i,this.applySkybox()}async loadTexture(t){var l,c,u,d,f;if(!t)return Promise.resolve(null);const i=Fie(t);if(i){const p=await i;if(((c=(l=p.source)==null?void 0:l.data)==null?void 0:c.length)>0||(f=(d=(u=p.source)==null?void 0:u.data)==null?void 0:d.data)!=null&&f.length)return p}const s=t.endsWith(".exr"),r=t.endsWith(".hdr");s?this._loader instanceof x0||(this._loader=new x0):r?this._loader instanceof WC||(this._loader=new WC):this._loader instanceof kl||(this._loader=new kl),Ra&&console.log("Loading skybox: "+t);const o=this._loader.loadAsync(t);return Nie(t,o),await o}applySkybox(){var i;const t=this._prevLoadedEnvironment;t&&(t.mapping=Rf,t.needsUpdate=!0,this.context.scene.background!==t&&(this._prevBackground=this.context.scene.background),this.context.scene.environment!==t&&(this._prevEnvironment=this.context.scene.environment),Ra&&console.log("Set remote skybox",this.url),this.environment&&(this.context.scene.environment=t),this.background&&!yi.backgroundShouldBeTransparent(this.context)&&(this.context.scene.background=t),((i=this.context.mainCameraComponent)==null?void 0:i.backgroundBlurriness)!==void 0&&(this.context.scene.backgroundBlurriness=this.context.mainCameraComponent.backgroundBlurriness))}registerDropEvents(){this.dragOverEvent||(this.dragOverEvent=t=>{if(this.allowDrop&&t.dataTransfer)for(const i of t.dataTransfer.types)i==="text/uri-list"&&t.preventDefault()},this.dropEvent=t=>{var i,s,r,o;if(this.allowDrop&&(t.preventDefault(),!!t.dataTransfer)){for(const a of t.dataTransfer.types)if(a==="text/uri-list"){const l=t.dataTransfer.getData(a);Ra&&console.log(a,l);let c=(s=(i=new RegExp(/polyhaven.com\/asset_img\/.+?\/(?<name>.+)\.png/).exec(l))==null?void 0:i.groups)==null?void 0:s.name;if(c||(c=(o=(r=new RegExp(/polyhaven\.com\/a\/(?<name>.+)/).exec(l))==null?void 0:r.groups)==null?void 0:o.name),Ra&&console.log(c),c){const u="https://dl.polyhaven.org/file/ph-assets/HDRIs/exr/1k/"+c+"_1k.exr";this.setSkybox(u)}else console.warn("Could not resolve skybox name from dropped url",l)}}},this.context.domElement.addEventListener("dragover",this.dragOverEvent),this.context.domElement.addEventListener("drop",this.dropEvent))}unregisterDropEvents(){this.dragOverEvent&&(this.context.domElement.removeEventListener("dragover",this.dragOverEvent),this.context.domElement.removeEventListener("drop",this.dropEvent))}}hx([z1(ih.prototype.urlChangedSyncField),x(URL)],ih.prototype,"url",void 0);hx([x()],ih.prototype,"allowDrop",void 0);hx([x()],ih.prototype,"background",void 0);hx([x()],ih.prototype,"environment",void 0);var Io=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const Er=re("debugsceneswitcher"),qy="scene";G1(qy);const vc=Promise.resolve(!1);class yr extends Te{constructor(){super(...arguments);h(this,"scenes");h(this,"loadingScene");h(this,"queryParameterName","scene");h(this,"useSceneName",!0);h(this,"clamp",!0);h(this,"useHistory",!0);h(this,"useKeyboard",!0);h(this,"useSwipe",!0);h(this,"useSceneLighting",!0);h(this,"preloadNext",1);h(this,"preloadPrevious",1);h(this,"preloadConcurrent",2);h(this,"_currentIndex",-1);h(this,"_currentScene");h(this,"_engineElementOverserver");h(this,"_preloadScheduler");h(this,"onPopState",async t=>{if(!this.useHistory)return;const i=this.useHistory;try{this.useHistory=!1;let s=!1;if(this.queryParameterName&&(s=await this.tryLoadFromQueryParam()),!s){const r=t==null?void 0:t.state;if(r&&r.startsWith(this.guid)){const o=r.substr(this.guid.length+2);Er&&console.log("PopState",o),await this.trySelectSceneFromValue(o)}}}finally{this.useHistory=i}});h(this,"normalizedSwipeThresholdX",.1);h(this,"_didSwipe",!1);h(this,"onPointerMove",t=>{if(this.useSwipe&&!this._didSwipe&&t.button===0&&t.pointerType==="touch"&&this.context.input.getPointerPressedCount()===1){const i=this.context.input.getPointerPositionDelta(t.button);if(i){const s=i.x/this.context.domWidth;s>=this.normalizedSwipeThresholdX?(this._didSwipe=!0,this.selectPrev()):s<=-this.normalizedSwipeThresholdX&&(this._didSwipe=!0,this.selectNext())}}});h(this,"onPointerUp",t=>{t.button===0&&(this._didSwipe=!1)});h(this,"onKeyDown",t=>{if(!this.useKeyboard||!this.scenes)return;const i=t.key.toLowerCase();if(!i)return;const s=parseInt(i)-1;if(s>=0){this.trySelectSceneFromValue(s);return}switch(i){case"arrowright":case"d":this.selectNext();break;case"arrowleft":case"a":this.selectPrev();break}});h(this,"__lastSwitchScene");h(this,"__lastSwitchScenePromise");h(this,"_lastLoadingScene");h(this,"_loadingScenePromise");h(this,"_isCurrentlyLoading",!1)}get currentIndex(){return this._currentIndex}awake(){Er&&console.log("SceneSwitcher",this)}async start(){if(this._currentIndex===-1&&!await this.tryLoadFromQueryParam()){const t=this.context.domElement.getAttribute(qy);try{(t===null||!await this.trySelectSceneFromValue(t))&&this._currentIndex===-1&&this.select(0)}finally{}}}onEnable(){globalThis.addEventListener("popstate",this.onPopState),this.context.input.addEventListener(ui.KeyDown,this.onKeyDown),this.context.input.addEventListener(ui.PointerMove,this.onPointerMove),this.context.input.addEventListener(ui.PointerUp,this.onPointerUp),this._engineElementOverserver||(this._engineElementOverserver=new MutationObserver(t=>{for(const i of t)if(i.type==="attributes"&&i.attributeName===qy){const s=this.context.domElement.getAttribute(qy);s!==null&&this.trySelectSceneFromValue(s)}})),this._engineElementOverserver.observe(this.context.domElement,{attributes:!0}),this._preloadScheduler||(this._preloadScheduler=new zie(this)),this._preloadScheduler.maxLoadAhead=this.preloadNext,this._preloadScheduler.maxLoadBehind=this.preloadPrevious,this._preloadScheduler.maxConcurrent=this.preloadConcurrent,this._preloadScheduler.begin()}onDisable(){var t;globalThis.removeEventListener("popstate",this.onPopState),this.context.input.removeEventListener(ui.KeyDown,this.onKeyDown),this.context.input.removeEventListener(ui.PointerMove,this.onPointerMove),this.context.input.removeEventListener(ui.PointerUp,this.onPointerUp),(t=this._preloadScheduler)==null||t.stop()}selectNext(){return this.select(this._currentIndex+1)}selectPrev(){return this.select(this._currentIndex-1)}select(t){var s,r,o;if(Er&&console.log("select",t),typeof t=="object"&&console.warn('Switching to "'+t+'" might not work. Please either use an index or a AssetReference (not a scene reference)'),typeof t=="string"){const a=(s=this.scenes)==null?void 0:s.find(l=>l.uri===t);if(!a){const l=wn.getOrCreate(this.sourceId??"",t,this.context);return this.switchScene(l)}if(a)t=(r=this.scenes)==null?void 0:r.indexOf(a);else return vc}if(!((o=this.scenes)!=null&&o.length))return vc;if(t<0){if(this.clamp)return vc;t=this.scenes.length-1}else if(t>=this.scenes.length){if(this.clamp)return vc;t=0}const i=this.scenes[t];return this.switchScene(i)}async switchScene(t){if(!(t instanceof wn)){const s=typeof t;return s==="string"?this.select(t):s==="number"?this.select(t):(console.warn("SceneSwitcher: Can't switch to scene",t,"of type",s),!1)}return this.__lastSwitchScene===t&&this.__lastSwitchScenePromise?this.__lastSwitchScenePromise:(this.__lastSwitchScene=t,this.__lastSwitchScenePromise=this.__internalSwitchScene(t),await this.__lastSwitchScenePromise)}async __internalSwitchScene(t){var s,r;if(this._currentScene){Er&&console.log("UNLOAD",t.uri);const o=this.tryGetSceneEventListener(this._currentScene.asset);if(o!=null&&o.sceneClosing){const a=o.sceneClosing();a instanceof Promise&&await a}this._currentScene.unload()}this._currentScene=void 0;const i=this._currentIndex=((s=this.scenes)==null?void 0:s.indexOf(t))??-1;try{const o=new CustomEvent("loadscene-start",{detail:{scene:t,switcher:this,index:i}});this.dispatchEvent(o),await this.onStartLoading(),await t.loadAssetAsync().catch(console.error),await this.onEndLoading();const a=new CustomEvent("loadscene-finished",{detail:{scene:t,switcher:this,index:i}});if(this.dispatchEvent(a),a.defaultPrevented)return Er&&console.warn("Adding loaded scene prevented:",t,a),!1;if(!t.asset)return Er&&console.warn("Failed loading scene:",t),!1;if(this._currentIndex===i){if(Er&&console.log("ADD",t.uri),this._currentScene=t,ne.add(t.asset,this.gameObject),this.useSceneLighting&&this.context.sceneLighting.enable(t),this.useHistory&&i>=0){let c=i.toString();if(this.useSceneName&&(c=AO(t.uri)),(r=this.queryParameterName)!=null&&r.length)K5(this.queryParameterName,c,this.useHistory);else{const u=history.state,d=this.guid+"::"+i;u!==d&&history.pushState(d,"unused",location.href)}}const l=this.tryGetSceneEventListener(t.asset);if(l!=null&&l.sceneOpened){const c=l.sceneOpened();c instanceof Promise&&await c}return!0}}catch(o){console.error(o)}return!1}preload(t){if(t>=0&&t<this.scenes.length){const i=this.scenes[t];if(i instanceof wn)return i.preload()}return vc}tryLoadFromQueryParam(){var i;if(!((i=this.queryParameterName)!=null&&i.length))return vc;const t=re(this.queryParameterName);return typeof t=="boolean"?vc:this.trySelectSceneFromValue(t)}trySelectSceneFromValue(t){if(typeof t=="string"){const i=parseInt(t);if(i>=0&&i<this.scenes.length)return this.select(i);{const s=t.toLowerCase();for(let r=0;r<this.scenes.length;r++){const o=this.scenes[r];if(o&&AO(o.uri).toLowerCase().includes(s))return this.select(r)}}}else if(typeof t=="number"&&t>=0&&t<this.scenes.length)return this.select(t);return Ar()&&console.warn('Can not find scene: "'+t+'"',this),vc}async onStartLoading(){var t,i;if(this._isCurrentlyLoading=!0,this.loadingScene&&(this._lastLoadingScene!==this.loadingScene&&(this._loadingScenePromise=void 0),this._lastLoadingScene=this.loadingScene,this._loadingScenePromise||(this._loadingScenePromise=(t=this.loadingScene)==null?void 0:t.loadAssetAsync()),await this._loadingScenePromise,this._isCurrentlyLoading&&((i=this.loadingScene)!=null&&i.asset))){Er&&console.log("Add loading scene",this.loadingScene.uri,this.loadingScene.asset);const s=this.loadingScene.asset;ne.add(s,this.gameObject);const r=this.tryGetSceneEventListener(s);if(r!=null&&r.sceneOpened){const o=r.sceneOpened();o instanceof Promise&&await o}}}async onEndLoading(){var t;if(this._isCurrentlyLoading=!1,(t=this.loadingScene)!=null&&t.asset){Er&&console.log("Remove loading scene",this.loadingScene.uri);const i=this.loadingScene.asset,s=this.tryGetSceneEventListener(i);if(typeof(s==null?void 0:s.sceneClosing)=="function"){const r=s.sceneClosing();r instanceof Promise&&await r}ne.remove(i)}}tryGetSceneEventListener(t,i=0){const s=ne.foreachComponent(t,r=>r.sceneClosing?r:null);if(i===0&&!s&&t.children.length)for(const r of t.children){const o=this.tryGetSceneEventListener(r,i+1);if(o)return o}return s}}Io([x(wn)],yr.prototype,"scenes",void 0);Io([x(wn)],yr.prototype,"loadingScene",void 0);Io([x()],yr.prototype,"queryParameterName",void 0);Io([x()],yr.prototype,"useSceneName",void 0);Io([x()],yr.prototype,"clamp",void 0);Io([x()],yr.prototype,"useHistory",void 0);Io([x()],yr.prototype,"useKeyboard",void 0);Io([x()],yr.prototype,"useSwipe",void 0);Io([x()],yr.prototype,"useSceneLighting",void 0);Io([x()],yr.prototype,"preloadNext",void 0);Io([x()],yr.prototype,"preloadPrevious",void 0);Io([x()],yr.prototype,"preloadConcurrent",void 0);function AO(n){const e=n.split("/").pop(),t=e==null?void 0:e.split(".").shift();return t!=null&&t.length?t:n}class zie{constructor(e,t=1,i=1,s=2){h(this,"maxLoadAhead");h(this,"maxLoadBehind");h(this,"maxConcurrent");h(this,"_isRunning",!1);h(this,"_switcher");h(this,"_loadTasks",[]);h(this,"_maxConcurrentLoads",1);this._switcher=e,this.maxLoadAhead=t,this.maxLoadBehind=i,this.maxConcurrent=s}begin(){if(this._isRunning)return;Er&&console.log("Preload begin"),this._isRunning=!0;let e=-1,t,i;const s=this._switcher.scenes,r=setInterval(()=>{if(this.allLoaded()&&(Er&&console.log("All scenes loaded"),this.stop()),!this._isRunning){clearInterval(r);return}if(this.canLoadNewScene()===!1)return;e!==this._switcher.currentIndex&&(e=this._switcher.currentIndex,i=0,t=0);const o=i%2===0;o&&(t+=1),i+=1;const a=o?this.maxLoadAhead:this.maxLoadBehind;if(t>a)return;const l=o?e+t:e-t;if(l<0||l<0||l>=s.length)return;const c=s[l];new Gie(l,c,this._loadTasks)},200)}stop(){this._isRunning=!1}canLoadNewScene(){return this._loadTasks.length<this._maxConcurrentLoads}allLoaded(){if(this._switcher.scenes){for(const e of this._switcher.scenes)if((e==null?void 0:e.isLoaded())===!1)return!1}return!0}}class Gie{constructor(e,t,i){h(this,"index");h(this,"asset");h(this,"tasks");this.index=e,this.asset=t,this.tasks=i,i.push(this),this.awaitLoading()}async awaitLoading(){this.asset&&!this.asset.isLoaded()&&(Er&&console.log("Preload start: "+this.asset.uri,this.index),await this.asset.preload(),Er&&console.log("Preload finished: "+this.asset.uri,this.index));const e=this.tasks.indexOf(this);e>=0&&this.tasks.splice(e,1)}}function Vie(){return new Promise((n,e)=>{const i=()=>{i!=null&&(document.removeEventListener("pointerdown",i),document.removeEventListener("click",i),document.removeEventListener("dragstart",i),document.removeEventListener("touchstart",i),n())};document.addEventListener("pointerdown",i),document.addEventListener("click",i),document.addEventListener("dragstart",i),document.addEventListener("touchstart",i)})}async function Hie(n){await Vie(),n()}var xf;(function(n){n[n.Quad=0]="Quad",n[n.Cube=1]="Cube",n[n.Sphere=2]="Sphere"})(xf||(xf={}));class Qie{static createPrimitive(e,t){let i;switch(e){case xf.Quad:const s=new us(1,1,1,1),r=(t==null?void 0:t.material)??new ai({color:16777215});i=new ye(s,r);break;case xf.Cube:const o=new Ei(1,1,1),a=(t==null?void 0:t.material)??new Yo({color:14540253});i=new ye(o,a);break;case xf.Sphere:const l=new So(.5,16,16),c=(t==null?void 0:t.material)??new Yo({color:14540253});i=new ye(l,c);break}return t!=null&&t.name&&(i.name=t.name),i}}var sa=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const to=re("debugvideo");var Pc;(function(n){n[n.None=0]="None",n[n.AdjustHeight=1]="AdjustHeight",n[n.AdjustWidth=2]="AdjustWidth"})(Pc||(Pc={}));var Zh;(function(n){n[n.VideoClip=0]="VideoClip",n[n.Url=1]="Url"})(Zh||(Zh={}));var Kg;(function(n){n[n.None=0]="None",n[n.AudioSource=1]="AudioSource",n[n.Direct=2]="Direct",n[n.APIOnly=3]="APIOnly"})(Kg||(Kg={}));var Zg;(function(n){n[n.CameraFarPlane=0]="CameraFarPlane",n[n.CameraNearPlane=1]="CameraNearPlane",n[n.RenderTexture=2]="RenderTexture",n[n.MaterialOverride=3]="MaterialOverride"})(Zg||(Zg={}));class Is extends Te{constructor(){super();h(this,"playOnAwake",!0);h(this,"aspectMode",Pc.None);h(this,"clip",null);h(this,"renderMode");h(this,"targetMaterialProperty");h(this,"targetMaterialRenderer");h(this,"targetTexture");h(this,"time",0);h(this,"_playbackSpeed",1);h(this,"_isLooping",!1);h(this,"_muted",!1);h(this,"_audioOutputMode",Kg.Direct);h(this,"playInBackground",!0);h(this,"_crossOrigin","anonymous");h(this,"source",Zh.Url);h(this,"url",null);h(this,"_videoElement",null);h(this,"_videoTexture",null);h(this,"_videoMaterial",null);h(this,"_isPlaying",!1);h(this,"wasPlaying",!1);h(this,"visibilityChanged",t=>{switch(document.visibilityState){case"hidden":this.playInBackground||(this.wasPlaying=this._isPlaying,this.pause());break;case"visible":this.wasPlaying&&!this._isPlaying&&this.play();break}});h(this,"_receivedInput",!1);h(this,"_overlay",null);h(this,"_targetObjects");h(this,"_updateAspectRoutineId",-1);Hie(()=>{this._receivedInput=!0,this.updateVideoElementSettings()}),this._targetObjects=[],re("videoscreenspace")&&window.addEventListener("keydown",t=>{t.key==="f"&&(this.screenspace=!this.screenspace)})}get playbackSpeed(){var t;return((t=this._videoElement)==null?void 0:t.playbackRate)??this._playbackSpeed}set playbackSpeed(t){this._playbackSpeed=t,this._videoElement&&(this._videoElement.playbackRate=t)}get isLooping(){var t;return((t=this._videoElement)==null?void 0:t.loop)??this._isLooping}set isLooping(t){this._isLooping=t,this._videoElement&&(this._videoElement.loop=t)}get currentTime(){var t;return((t=this._videoElement)==null?void 0:t.currentTime)??this.time}set currentTime(t){this._videoElement?this._videoElement.currentTime=t:this.time=t}get isPlaying(){const t=this._videoElement;if(t){if(t.currentTime>0&&!t.paused&&!t.ended&&t.readyState>t.HAVE_CURRENT_DATA)return!0;if(t.srcObject&&t.srcObject.active)return!0}return!1}get crossOrigin(){var t;return((t=this._videoElement)==null?void 0:t.crossOrigin)??this._crossOrigin}set crossOrigin(t){this._crossOrigin=t,this._videoElement&&(t!==null?this._videoElement.setAttribute("crossorigin",t):this._videoElement.removeAttribute("crossorigin"))}get videoMaterial(){return this._videoMaterial}get videoTexture(){return this._videoTexture}get videoElement(){return this._videoElement}get muted(){var t;return((t=this._videoElement)==null?void 0:t.muted)??this._muted}set muted(t){this._muted=t,this._videoElement&&(this._videoElement.muted=t)}set audioOutputMode(t){t!==this._audioOutputMode&&(t===Kg.AudioSource&&si()&&console.warn("VideoAudioOutputMode.AudioSource is not yet implemented"),this._audioOutputMode=t,this.updateVideoElementSettings())}get audioOutputMode(){return this._audioOutputMode}setVideo(t){this.clip=t,this.source=Zh.VideoClip,this._videoElement?(this._videoElement.srcObject=t,this._isPlaying&&this.play(),this.updateAspect()):this.create(!0)}setClipURL(t){this.url!==t&&(this.url=t,this.source=Zh.Url,to&&console.log("set url",t),this._videoElement?(this._videoElement.src=t,this._isPlaying&&(this.stop(),this.play())):this.create(!0))}onEnable(){var t,i;to&&console.log("VideoPlayer.onEnable",this),window.addEventListener("visibilitychange",this.visibilityChanged),this.playOnAwake===!0&&this.create(!0),this.screenspace?(t=this._overlay)==null||t.start():(i=this._overlay)==null||i.stop()}onDisable(){var t;window.removeEventListener("visibilitychange",this.visibilityChanged),(t=this._overlay)==null||t.stop(),this.pause()}onDestroy(){var t;this._videoElement&&((t=this._videoElement.parentElement)==null||t.removeChild(this._videoElement),this._videoElement=null),this._videoTexture&&(this._videoTexture.dispose(),this._videoTexture=null)}play(){var t,i;this._videoElement||this.create(!1),this._videoElement&&(this._isPlaying&&!((t=this._videoElement)!=null&&t.ended)&&!((i=this._videoElement)!=null&&i.paused)||(this._isPlaying=!0,this._receivedInput||(this._videoElement.muted=!0),this.updateVideoElementSettings(),this._videoElement.currentTime=this.time,this._videoElement.play().catch(s=>{var r;console.log(s),to&&console.error("Error playing video",s,"CODE="+s.code,(r=this.videoElement)==null?void 0:r.src,this),setTimeout(()=>{this._isPlaying&&!this.destroyed&&this.activeAndEnabled&&this.play()},1e3)}),to&&console.log("play",this._videoElement,this.time)))}stop(){this._isPlaying=!1,this.time=0,this._videoElement&&(this._videoElement.currentTime=0,this._videoElement.pause(),to&&console.log("STOP",this))}pause(){var t,i;this.time=((t=this._videoElement)==null?void 0:t.currentTime)??0,this._isPlaying=!1,(i=this._videoElement)==null||i.pause(),to&&console.log("PAUSE",this,this.currentTime)}create(t){var s;let i;switch(this.source){case Zh.VideoClip:i=this.clip;break;case Zh.Url:i=this.url,!(i!=null&&i.length)&&typeof this.clip=="string"&&(i=this.clip);break}if(!i){to&&console.warn("No video source set",this);return}this._videoElement||(to&&console.warn("Create VideoElement",this),this._videoElement=this.createVideoElement(),(s=this.context.domElement)==null||s.prepend(this._videoElement),this.updateVideoElementStyles()),typeof i=="string"?(to&&console.log("Set Video src",i),this._videoElement.src=i):(to&&console.log("Set Video srcObject",i),this._videoElement.srcObject=i),this._videoTexture||(this._videoTexture=new Gk(this._videoElement)),this._videoTexture.flipY=!1,this._videoTexture.colorSpace=Je,this.handleBeginPlaying(t),to&&console.log(this,t)}updateAspect(){this.aspectMode!==Pc.None&&this.startCoroutine(this.updateAspectImpl())}get screenspace(){var t;return((t=this._overlay)==null?void 0:t.enabled)??!1}set screenspace(t){var i;if(t){if(!this._videoTexture)return;this._overlay||(this._overlay=new Wie(this.context)),this._overlay.add(this._videoTexture)}else(i=this._overlay)==null||i.remove(this._videoTexture);this._overlay&&(this._overlay.enabled=t)}createVideoElement(){const t=document.createElement("video");return this._crossOrigin&&t.setAttribute("crossorigin",this._crossOrigin),to&&console.log("created video element",t),t}handleBeginPlaying(t){var r,o;if(!this.enabled||!this._videoElement)return;this._targetObjects.length=0;let i=this.gameObject;switch(this.renderMode){case Zg.MaterialOverride:i=(r=this.targetMaterialRenderer)==null?void 0:r.gameObject,i||(i=(o=ne.getComponent(this.gameObject,Ci))==null?void 0:o.gameObject);break;case Zg.RenderTexture:console.error("VideoPlayer renderTexture not implemented yet. Please use material override instead");return}if(!i){console.error("Missing target for video material renderer",this.name,Zg[this.renderMode],this);return}const s=i.material;if(s){this._targetObjects.push(i),s!==this._videoMaterial&&(this._videoMaterial=s.clone(),i.material=this._videoMaterial);const a="map",l=this._videoMaterial;if(!this.targetMaterialProperty)l[a]=this._videoTexture;else switch(this.targetMaterialProperty){default:l[a]=this._videoTexture;break}}else{console.warn("Can not play video, no material found, this might be a multimaterial case which is not supported yet");return}this.updateVideoElementSettings(),this.updateVideoElementStyles(),t&&this.play()}updateVideoElementSettings(){if(!this._videoElement)return;this._videoElement.loop=this._isLooping,this._videoElement.currentTime=this.currentTime,this._videoElement.playbackRate=this._playbackSpeed,this._videoElement.playsInline=!0;let t=!this._receivedInput||this.audioOutputMode===Kg.None;!t&&this._muted&&(t=!0),this._videoElement.muted=t,this.playOnAwake&&(this._videoElement.autoplay=!0)}updateVideoElementStyles(){this._videoElement&&(this._videoElement.style.userSelect="none",this._videoElement.style.visibility="hidden",this._videoElement.style.display="none",this.updateAspect())}*updateAspectImpl(){const t=++this._updateAspectRoutineId,i=void 0,s=this.clip;for(;t===this._updateAspectRoutineId&&this.aspectMode!==Pc.None&&this.clip&&s===this.clip&&this._isPlaying;){if(!s||typeof s=="string")return;let r;for(const o of s.getVideoTracks()){const a=o.getSettings();if(a&&a.width&&a.height){r=a.width/a.height;break}else r=this.context.renderer.domElement.clientWidth/this.context.renderer.domElement.clientHeight}if(r===void 0){for(let o=0;o<10;o++)yield;if(!this.isPlaying)break;continue}if(i===r){yield;continue}for(const o of this._targetObjects){let a=1;if(o.parent){const l=Jo(o.parent);a=l.x/l.y}switch(this.aspectMode){case Pc.AdjustHeight:o.scale.y=1/r*o.scale.x*a;break;case Pc.AdjustWidth:o.scale.x=r*o.scale.y*a;break}}for(let o=0;o<3;o++)yield}}}sa([x()],Is.prototype,"playOnAwake",void 0);sa([x()],Is.prototype,"aspectMode",void 0);sa([x(URL)],Is.prototype,"clip",void 0);sa([x()],Is.prototype,"renderMode",void 0);sa([x()],Is.prototype,"targetMaterialProperty",void 0);sa([x(Ci)],Is.prototype,"targetMaterialRenderer",void 0);sa([x(Rt)],Is.prototype,"targetTexture",void 0);sa([x()],Is.prototype,"time",void 0);sa([x()],Is.prototype,"playbackSpeed",null);sa([x()],Is.prototype,"isLooping",null);sa([x()],Is.prototype,"audioOutputMode",null);class Wie{constructor(e){h(this,"context");h(this,"_videos",[]);h(this,"_screenspaceModeQuad");h(this,"_isInScreenspaceMode",!1);h(this,"_input");this.context=e,this._input=new jie(this)}get enabled(){return this._isInScreenspaceMode}set enabled(e){e?this.start():this.stop()}add(e){this._videos.indexOf(e)===-1&&this._videos.push(e)}remove(e){if(!e)return;const t=this._videos.indexOf(e);t>=0&&this._videos.splice(t,1)}start(){var s;if(this._isInScreenspaceMode||this._videos.length<0)return;const e=this._videos[this._videos.length-1];if(!e)return;if(this._isInScreenspaceMode=!0,!this._screenspaceModeQuad){if(this._screenspaceModeQuad=Qie.createPrimitive(xf.Quad,{material:new qie(e)}),!this._screenspaceModeQuad)return;this._screenspaceModeQuad.geometry.scale(2,2,2)}const t=this._screenspaceModeQuad;this.context.scene.add(t),this.updateScreenspaceMaterialUniforms();const i=t.material;i==null||i.reset(),(s=this._input)==null||s.enable(i)}stop(){var e;this._isInScreenspaceMode=!1,this._screenspaceModeQuad&&((e=this._input)==null||e.disable(),this._screenspaceModeQuad.removeFromParent())}updateScreenspaceMaterialUniforms(){var t;const e=(t=this._screenspaceModeQuad)==null?void 0:t.material;e&&(e.screenAspect=this.context.domElement.clientWidth/this.context.domElement.clientHeight)}}class jie{constructor(e){h(this,"_onResizeScreenFn");h(this,"_onKeyUpFn");h(this,"_onMouseWheelFn");h(this,"context");h(this,"overlay");h(this,"_material");h(this,"_isPinching",!1);h(this,"_lastPinch",0);this.overlay=e,this.context=e.context}enable(e){this._material=e,window.addEventListener("resize",this._onResizeScreenFn=()=>{this.overlay.updateScreenspaceMaterialUniforms()}),window.addEventListener("keyup",this._onKeyUpFn=s=>{s.key==="Escape"&&this.overlay.stop()}),window.addEventListener("wheel",this._onMouseWheelFn=s=>{this.overlay.enabled&&(e.zoom+=s.deltaY*5e-4,s.preventDefault())},{passive:!1});const t=new te;window.addEventListener("mousemove",s=>{if(this.overlay.enabled&&this.context.input.getPointerPressed(0)){const r=new te(s.movementX,s.movementY);r.x/=this.context.domElement.clientWidth,r.y/=this.context.domElement.clientHeight,t.set(r.x,r.y),t.multiplyScalar(e.zoom/-this.context.time.deltaTime*.01),e.offset=e.offset.add(t)}}),window.addEventListener("pointermove",s=>{this.overlay.enabled&&this.context.input.getPointerPressed(0)&&this.context.input.getTouchesPressedCount()===1&&(t.set(s.movementX,s.movementY),t.multiplyScalar(e.zoom*-this.context.time.deltaTime*.05),e.offset=e.offset.add(t))});let i=0;window.addEventListener("touchstart",s=>{if(s.touches.length<2){this.context.time.time-i<.3&&this.overlay.stop(),i=this.context.time.time;return}this._isPinching=!0,this._lastPinch=0}),window.addEventListener("touchmove",s=>{if(!this._isPinching||!this._material)return;const r=s.touches[0],o=s.touches[1],a=r.clientX-o.clientX,l=r.clientY-o.clientY,c=Math.sqrt(a*a+l*l);if(this._lastPinch!==0){const u=c-this._lastPinch;this._material.zoom-=u*.004}this._lastPinch=c}),window.addEventListener("touchend",()=>{this._isPinching=!1})}disable(){this._onResizeScreenFn&&(window.removeEventListener("resize",this._onResizeScreenFn),this._onResizeScreenFn=void 0),this._onKeyUpFn&&(window.removeEventListener("keyup",this._onKeyUpFn),this._onKeyUpFn=void 0),this._onMouseWheelFn&&(window.removeEventListener("wheel",this._onMouseWheelFn),this._onMouseWheelFn=void 0)}}class qie extends Bt{constructor(t){super();h(this,"_offset",new te);this.uniforms={map:{value:t},screenAspect:{value:1},offsetScale:{value:new Ke(0,0,1,1)}},this.vertexShader=`
        uniform sampler2D map;
        uniform float screenAspect;
        uniform vec4 offsetScale;
        varying vec2 vUv;

        void main() {

            gl_Position = vec4( position , 1.0 );
            vUv = uv;
            vUv.y = 1. - vUv.y;

            // fit into screen
            ivec2 res = textureSize(map, 0);
            float videoAspect = float(res.x) / float(res.y);
            float aspect = videoAspect / screenAspect;
            if(aspect >= 1.0) 
            {
                vUv.y = vUv.y * aspect;
                float offset = (1. - aspect) * .5;
                vUv.y = vUv.y + offset;
            }
            else
            {
                vUv.x = vUv.x / aspect;
                float offset = (1. - 1. / aspect) * .5;
                vUv.x = vUv.x + offset;
            }

            vUv.x -= .5;
            vUv.y -= .5;

            vUv.x *= offsetScale.z;
            vUv.y *= offsetScale.z;
            vUv.x += offsetScale.x;
            vUv.y += offsetScale.y;

            vUv.x += .5;
            vUv.y += .5;
        }

        `,this.fragmentShader=`
        uniform sampler2D map;
        varying vec2 vUv;
        void main() {
            if(vUv.x < 0. || vUv.x > 1. || vUv.y < 0. || vUv.y > 1.)
                gl_FragColor = vec4(0., 0., 0., 1.);
            else
            {
                vec4 texcolor = texture2D(map, vUv);
                texcolor = LinearTosRGB(texcolor);
                gl_FragColor = texcolor;
            }
        }
        `}set screenAspect(t){this.uniforms.screenAspect.value=t,this.needsUpdate=!0}set offset(t){const i=this.uniforms.offsetScale.value;i.x=t.x,i.y=t.y,this.uniforms.offsetScale.value=i,this.needsUpdate=!0}get offset(){const t=this.uniforms.offsetScale.value;return this._offset.set(t.x,t.y),this._offset}set zoom(t){const i=this.uniforms.offsetScale.value;t<.001&&(t=.001),i.z=t,this.needsUpdate=!0}get zoom(){return this.uniforms.offsetScale.value.z}reset(){this.offset=this.offset.set(0,0),this.zoom=1,this.needsUpdate=!0}}var ux=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const Lh=re("debugscreensharing");var gl;(function(n){n[n.Screen=0]="Screen",n[n.Camera=1]="Camera",n[n.Canvas=2]="Canvas",n[n.Microphone=3]="Microphone"})(gl||(gl={}));var Sr;(function(n){n[n.Idle=0]="Idle",n[n.Sending=1]="Sending",n[n.Receiving=2]="Receiving"})(Sr||(Sr={}));class xp extends Te{constructor(){super(...arguments);h(this,"allowStartOnClick",!0);h(this,"autoConnect",!1);h(this,"_videoPlayer");h(this,"_audioSource");h(this,"device",gl.Screen);h(this,"_net");h(this,"_requestOpen",!1);h(this,"_currentStream",null);h(this,"_currentMode",Sr.Idle);h(this,"onJoinedRoom",async()=>{await Tu(1e3),this.autoConnect&&!this.isSending&&!this.isReceiving&&this.context.connection.isInRoom&&this.share()});h(this,"_activeShareRequest",null);h(this,"onReceiveStream",t=>{var i;((i=t.stream)==null?void 0:i.active)===!0&&this.setStream(t.stream,Sr.Receiving)});h(this,"onCallEnded",t=>{Lh&&console.log("CALL ENDED",this.isReceiving,this==null?void 0:this.screenspace),this.isReceiving&&(this.screenspace=!1)})}onPointerEnter(){this.allowStartOnClick&&this.context.input.setCursorPointer()}onPointerExit(){this.allowStartOnClick&&this.context.input.setCursorNormal()}onPointerClick(t){var i;if(this.allowStartOnClick&&!(t&&t.pointerId!==0)){if(this.isReceiving&&((i=this.videoPlayer)!=null&&i.isPlaying)){this.videoPlayer&&(this.videoPlayer.screenspace=!this.videoPlayer.screenspace);return}if(this.isSending){this.close();return}this.share()}}set videoPlayer(t){this._videoPlayer&&(this.isSending||this.isReceiving)&&this._videoPlayer.stop(),this._videoPlayer=t,this._videoPlayer&&this._currentStream&&(this.isSending||this.isReceiving)&&this._videoPlayer.setVideo(this._currentStream)}get videoPlayer(){return this._videoPlayer}get screenspace(){var t;return((t=this.videoPlayer)==null?void 0:t.screenspace)??!1}set screenspace(t){this.videoPlayer&&(this.videoPlayer.screenspace=t)}get currentScream(){return this._currentStream}get currentMode(){return this._currentMode}get isSending(){var t;return((t=this._currentStream)==null?void 0:t.active)&&this._currentMode===Sr.Sending}get isReceiving(){if(this._currentMode===Sr.Receiving){if(!this._currentStream||this._currentStream.active===!1)return!1;const t=this._currentStream.getTracks();for(const i of t)if(i.readyState==="live")return!0}return!1}get requiresVideoPlayer(){return this.device!==gl.Microphone}awake(){Lh&&console.log("Screensharing",this.name,this),Ni.registerWaitForAllowAudio(()=>{this._videoPlayer&&this._currentStream&&this._currentMode===Sr.Receiving&&(this._videoPlayer.playInBackground=!0,this._videoPlayer.setVideo(this._currentStream))});const t=Vg.getOrCreate(this.context,this.guid);this._net=new k_(this.context,t)}onEnable(){var t,i,s;(t=this._net)==null||t.enable(),(i=this._net)==null||i.addEventListener(tn.StreamReceived,this.onReceiveStream),(s=this._net)==null||s.addEventListener(tn.StreamEnded,this.onCallEnded),this.context.connection.beginListen(pi.JoinedRoom,this.onJoinedRoom),this.autoConnect&&Tu(1e3).then(()=>{this.enabled&&this.autoConnect&&!this.isReceiving&&!this.isSending&&this.context.connection.isInRoom&&this.share()})}onDisable(){var t,i,s;(t=this._net)==null||t.removeEventListener(tn.StreamReceived,this.onReceiveStream),(i=this._net)==null||i.removeEventListener(tn.StreamEnded,this.onCallEnded),this.context.connection.stopListen(pi.JoinedRoom,this.onJoinedRoom),(s=this._net)==null||s.disable(),this.close()}_ensureVideoPlayer(){const t=new Is;t.aspectMode=Pc.AdjustWidth,ne.addComponent(this.gameObject,t),this._videoPlayer=t}async share(t){return this._activeShareRequest?this._activeShareRequest:(this._activeShareRequest=this.internalShare(t),this._activeShareRequest.then(()=>{this._activeShareRequest=null}))}async internalShare(t){if(this.context.connection.isInRoom===!1){console.warn("Can not start screensharing: requires network connection");return}if(t!=null&&t.device&&(this.device=t.device),!this.videoPlayer&&this.requiresVideoPlayer&&(this._videoPlayer||(this._videoPlayer=ne.getComponent(this.gameObject,Is)??void 0),this.videoPlayer||this._ensureVideoPlayer(),!this.videoPlayer)){console.warn("Can not share video without a videoPlayer assigned");return}this._requestOpen=!0;try{const i=(t==null?void 0:t.constraints)??{echoCancellation:!0,autoGainControl:!1},s={video:i,audio:i},r=s.video;switch(r!==void 0&&typeof r!="boolean"&&(r.width||(r.width={max:1920}),r.height||(r.height={max:1920}),r.aspectRatio||(r.aspectRatio={ideal:1.7777777778}),r.frameRate||(r.frameRate={ideal:24}),r.facingMode||(r.facingMode={ideal:"user"})),this.device){case gl.Camera:this.tryShareUserCamera(s,t);break;case gl.Screen:{if(!navigator.mediaDevices.getDisplayMedia){console.error("No getDisplayMedia support");return}const l=await navigator.mediaDevices.getDisplayMedia(s);this._requestOpen?this.setStream(l,Sr.Sending):kc(l)}break;case gl.Canvas:const o=0,a=this.context.renderer.domElement.captureStream(o);this.setStream(a,Sr.Sending);break;case gl.Microphone:{if(!navigator.mediaDevices.getUserMedia){console.error("No getDisplayMedia support");return}s.video=!1;const l=await navigator.mediaDevices.getUserMedia(s);this._requestOpen?this.setStream(l,Sr.Sending):kc(l)}break}}catch(i){if(i.name==="NotAllowedError"){console.log("Selection cancelled"),this._requestOpen=!1;return}console.error("Error opening video",i)}}close(){var t;this._requestOpen=!1,this._currentStream&&(Lh&&console.warn("Close current stream / disposing resources, stream was active?",this._currentStream.active),(t=this._net)==null||t.stopSendingStream(this._currentStream),kc(this._currentStream),this._currentMode=Sr.Idle,this._currentStream=null)}setStream(t,i){var o,a,l;if(t===this._currentStream||(this.close(),!t))return;this._currentStream=t,this._requestOpen=!0,this._currentMode=i;const s=this.device!==gl.Microphone,r=i===Sr.Sending;s?(this._videoPlayer||this._ensureVideoPlayer(),this._videoPlayer?this._videoPlayer.setVideo(t):console.error("No video player assigned for video stream")):(this._audioSource||(this._audioSource=new Ni,this._audioSource.spatialBlend=0,this._audioSource.volume=1,this.gameObject.addComponent(this._audioSource)),r||(console.log("PLAY",t.getAudioTracks()),this._audioSource.volume=1,(o=this._audioSource)==null||o.play(t))),r&&((a=this._net)==null||a.startSendingStream(t)),r&&(this._videoPlayer&&(this._videoPlayer.muted=!0),(l=this._audioSource)==null||l.stop());for(const c of t.getTracks())c.addEventListener("ended",()=>{Lh&&console.log("Track ended",c),this.close()}),Lh&&c.kind==="video"&&console.log(r?"Video ":"Video ",c.getSettings())}async tryShareUserCamera(t,i){var r;const s=(await navigator.mediaDevices.enumerateDevices()).filter(o=>o.kind==="videoinput");Lh&&console.log("Request camera",s);for(const o of s)try{if(!this._requestOpen)break;if(o.kind!=="videoinput")continue;const a=o.deviceId;if((i==null?void 0:i.deviceId)!==void 0&&a!==i.deviceId||((r=i==null?void 0:i.deviceFilter)==null?void 0:r.call(this,o))===!1)continue;t.video!==!1&&((typeof t.video>"u"||typeof t.video=="boolean")&&(t.video={}),t.video.deviceId=a);const c=await navigator.mediaDevices.getUserMedia(t);this._requestOpen?this.setStream(c,Sr.Sending):kc(c),Lh&&console.log("Selected camera",o);break}catch(a){if(a.message==="Failed to allocate videosource"||a.message==="Could not start video source"){Rs("Failed to start video: Try another camera (Code "+a.code+")"),console.warn(a);continue}else console.error("Failed to get user media",a.message,a.code,a)}}}ux([x()],xp.prototype,"allowStartOnClick",void 0);ux([x()],xp.prototype,"autoConnect",void 0);ux([x(Is)],xp.prototype,"videoPlayer",null);ux([x()],xp.prototype,"device",void 0);var LA=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};class vh extends Zs{constructor(){super(...arguments);h(this,"intensity");h(this,"falloff");h(this,"samples");h(this,"color");h(this,"luminanceInfluence");h(this,"_ssao")}get typeName(){return"ScreenSpaceAmbientOcclusion"}onBeforeRender(){if(this._ssao&&this.context.mainCamera instanceof qt){const t=this.context.mainCamera.far-this.context.mainCamera.near;this._ssao.ssaoMaterial.worldDistanceFalloff=t*.01,this._ssao.ssaoMaterial.worldDistanceThreshold=this.context.mainCamera.far}}onCreateEffect(){const t=this.context.mainCamera,i=new nF(this.context.scene,t),s=new rT({normalBuffer:i.texture,resolutionScale:.5}),r=this._ssao=new hF(t,i.texture,{normalDepthBuffer:s.texture,worldDistanceThreshold:1,worldDistanceFalloff:1,worldProximityThreshold:.1,worldProximityFalloff:2,intensity:1,blendFunction:Ot.MULTIPLY,luminanceInfluence:.5});this.intensity.onValueChanged=a=>{r.intensity=a},this.falloff.onValueChanged=a=>{r.ssaoMaterial.radius=a*.1},this.samples.onValueChanged=a=>{r.samples=a},this.color.onValueChanged=a=>{r.color||(r.color=new _e),r.color.copy(a)},this.luminanceInfluence.onValueChanged=a=>{r.luminanceInfluence=a};const o=new Array;return o.push(i),o.push(s),o.push(r),o}}LA([x(Et)],vh.prototype,"intensity",void 0);LA([x(Et)],vh.prototype,"falloff",void 0);LA([x(Et)],vh.prototype,"samples",void 0);LA([x(Et)],vh.prototype,"color",void 0);LA([x(Et)],vh.prototype,"luminanceInfluence",void 0);ta("ScreenSpaceAmbientOcclusion",vh);var Zu=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r},$g;(function(n){n[n.Performance=0]="Performance",n[n.Low=1]="Low",n[n.Medium=2]="Medium",n[n.High=3]="High",n[n.Ultra=4]="Ultra"})($g||($g={}));class Ja extends Zs{constructor(){super(...arguments);h(this,"gammaCorrection",!0);h(this,"intensity");h(this,"falloff");h(this,"aoRadius");h(this,"screenspaceRadius",!1);h(this,"color");h(this,"quality",$g.Medium);h(this,"_ssao")}get typeName(){return"ScreenSpaceAmbientOcclusionN8"}onValidate(){this._ssao&&(this._ssao.setQualityMode($g[this.quality]),this._ssao.configuration.gammaCorrection=this.gammaCorrection,this._ssao.configuration.screenSpaceRadius=this.screenspaceRadius)}onCreateEffect(){const t=this.context.mainCamera,i=this._ssao=new v3(this.context.scene,t,this.context.domWidth,this.context.domHeight),s=$g[this.quality];i.setQualityMode(s),i.configuration.gammaCorrection=this.gammaCorrection,i.configuration.screenSpaceRadius=this.screenspaceRadius,this.intensity.onValueChanged=o=>{i.configuration.intensity=o},this.falloff.onValueChanged=o=>{i.configuration.distanceFalloff=o},this.aoRadius.onValueChanged=o=>{i.configuration.aoRadius=o},this.color.onValueChanged=o=>{i.color||(i.color=new _e),i.configuration.color.copy(o)};const r=new Array;return r.push(i),r}}Zu([Bs(),x()],Ja.prototype,"gammaCorrection",void 0);Zu([x(Et)],Ja.prototype,"intensity",void 0);Zu([x(Et)],Ja.prototype,"falloff",void 0);Zu([x(Et)],Ja.prototype,"aoRadius",void 0);Zu([Bs(),x()],Ja.prototype,"screenspaceRadius",void 0);Zu([x(Et)],Ja.prototype,"color",void 0);Zu([Bs(),x()],Ja.prototype,"quality",void 0);ta("ScreenSpaceAmbientOcclusionN8",Ja);var b3=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r},sf;(function(n){n[n.ShadowMask=0]="ShadowMask",n[n.Additive=1]="Additive",n[n.Occluder=2]="Occluder"})(sf||(sf={}));class dx extends Te{constructor(){super(...arguments);h(this,"mode",sf.ShadowMask);h(this,"shadowColor",new Si(0,0,0,1))}awake(){switch(this.mode){case sf.ShadowMask:this.applyShadowMaterial();break;case sf.Additive:this.applyLightBlendMaterial();break;case sf.Occluder:this.applyOccluderMaterial();break}}applyLightBlendMaterial(){const t=ne.getComponent(this.gameObject,Ci);if(t){const i=t.sharedMaterial;i.blending=Mf,this.applyMaterialOptions(i),i.onBeforeCompile=s=>{s.fragmentShader=s.fragmentShader.replace("vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;",`vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
                // diffuse-only lighting with overdrive to somewhat compensate
                // for the loss of indirect lighting and to make it more visible.
                vec3 direct = reflectedLight.directSpecular * 6.6;
                float max = max(direct.r, max(direct.g, direct.b));
                
                // early out - we're simply returning direct lighting and some alpha based on it so it can 
                // be blended onto the scene.
                gl_FragColor = vec4(direct, max);
                return;
                `)}}}applyShadowMaterial(){var i;const t=ne.getComponent(this.gameObject,Ci);if(t)if(((i=t.sharedMaterial)==null?void 0:i.type)!=="ShadowMaterial"){const s=new Wb;s.color=this.shadowColor,s.opacity=this.shadowColor.alpha,this.applyMaterialOptions(s),t.sharedMaterial=s}else{const s=t.sharedMaterial;s.color=this.shadowColor,s.opacity=this.shadowColor.alpha,this.applyMaterialOptions(s)}}applyOccluderMaterial(){const t=ne.getComponent(this.gameObject,Ci);if(t){const i=t.sharedMaterial;i.depthWrite=!0,i.stencilWrite=!0,i.colorWrite=!1,this.gameObject.renderOrder=-100}}applyMaterialOptions(t){t&&(t.depthWrite=!1,t.stencilWrite=!1)}}b3([x()],dx.prototype,"mode",void 0);b3([x(Si)],dx.prototype,"shadowColor",void 0);var fx=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const lI=class extends Te{constructor(){super(...arguments);h(this,"target",null);h(this,"followFactor",.1);h(this,"rotateFactor",.1);h(this,"positionAxes",Jd.All);h(this,"flipForward",!1);h(this,"_firstUpdate",!0)}onBeforeRender(){this.updateNow(!1)}updateNow(t){if(!(!this.target||this.target===this.gameObject)){if(this.followFactor>0){const i=Mt(this.target),s=this._firstUpdate||t?1:tt.clamp01(this.context.time.deltaTime*this.followFactor),r=this.worldPosition;this.positionAxes&Jd.X&&(r.x=tt.lerp(r.x,i.x,s)),this.positionAxes&Jd.Y&&(r.y=tt.lerp(r.y,i.y,s)),this.positionAxes&Jd.Z&&(r.z=tt.lerp(r.z,i.z,s)),this.worldPosition=r}if(this.rotateFactor>0){const i=Gr(this.target);this.flipForward&&i.premultiply(lI._invertForward);const s=this._firstUpdate||t?1:tt.clamp01(this.context.time.deltaTime*this.rotateFactor);this.worldQuaternion=this.worldQuaternion.slerp(i,s)}this._firstUpdate=!1}}};let za=lI;h(za,"_invertForward",new Se().setFromAxisAngle(new w(0,1,0),Math.PI));fx([x(Me)],za.prototype,"target",void 0);fx([x()],za.prototype,"followFactor",void 0);fx([x()],za.prototype,"rotateFactor",void 0);fx([x()],za.prototype,"positionAxes",void 0);class Xie extends ye{constructor(e){const t=new Yie(e),i=new us(t.image.width*.001,t.image.height*.001),s=new ai({map:t,toneMapped:!1,transparent:!0});super(i,s);function r(o){s.map.dispatchDOMEvent(o)}this.addEventListener("mousedown",r),this.addEventListener("mousemove",r),this.addEventListener("mouseup",r),this.addEventListener("click",r),this.dispose=function(){i.dispose(),s.dispose(),s.map.dispose(),BE.delete(e),this.removeEventListener("mousedown",r),this.removeEventListener("mousemove",r),this.removeEventListener("mouseup",r),this.removeEventListener("click",r)}}}class Yie extends Hk{constructor(e){super(vO(e)),this.dom=e,this.anisotropy=16,this.colorSpace=Je,this.minFilter=Dt,this.magFilter=Dt;const t=new MutationObserver(()=>{this.scheduleUpdate||(this.scheduleUpdate=setTimeout(()=>this.update(),16))}),i={attributes:!0,childList:!0,subtree:!0,characterData:!0};t.observe(e,i),this.observer=t}dispatchDOMEvent(e){e.data&&Jie(this.dom,e.type,e.data.x,e.data.y)}update(){this.image=vO(this.dom),this.needsUpdate=!0,this.scheduleUpdate=null}dispose(){this.observer&&this.observer.disconnect(),this.scheduleUpdate=clearTimeout(this.scheduleUpdate),super.dispose()}}const BE=new WeakMap;function vO(n){const e=document.createRange(),t=new _e;function i(f){const p=[];let g=!1;function A(){if(g&&(g=!1,f.restore()),p.length===0)return;let v=-1/0,m=-1/0,b=1/0,y=1/0;for(let _=0;_<p.length;_++){const E=p[_];v=Math.max(v,E.x),m=Math.max(m,E.y),b=Math.min(b,E.x+E.width),y=Math.min(y,E.y+E.height)}f.save(),f.beginPath(),f.rect(v,m,b-v,y-m),f.clip(),g=!0}return{add:function(v){p.push(v),A()},remove:function(){p.pop(),A()}}}function s(f,p,g,A){A!==""&&(f.textTransform==="uppercase"&&(A=A.toUpperCase()),u.font=f.fontWeight+" "+f.fontSize+" "+f.fontFamily,u.textBaseline="top",u.fillStyle=f.color,u.fillText(A,p,g+parseFloat(f.fontSize)*.1))}function r(f,p,g,A,v){g<2*v&&(v=g/2),A<2*v&&(v=A/2),u.beginPath(),u.moveTo(f+v,p),u.arcTo(f+g,p,f+g,p+A,v),u.arcTo(f+g,p+A,f,p+A,v),u.arcTo(f,p+A,f,p,v),u.arcTo(f,p,f+g,p,v),u.closePath()}function o(f,p,g,A,v,m){const b=f[p+"Width"],y=f[p+"Style"],_=f[p+"Color"];b!=="0px"&&y!=="none"&&_!=="transparent"&&_!=="rgba(0, 0, 0, 0)"&&(u.strokeStyle=_,u.lineWidth=parseFloat(b),u.beginPath(),u.moveTo(g,A),u.lineTo(g+v,A+m),u.stroke())}function a(f,p){let g=0,A=0,v=0,m=0;if(f.nodeType===Node.TEXT_NODE){e.selectNode(f);const y=e.getBoundingClientRect();g=y.left-l.left-.5,A=y.top-l.top-.5,v=y.width,m=y.height,s(p,g,A,f.nodeValue.trim())}else{if(f.nodeType===Node.COMMENT_NODE)return;if(f instanceof HTMLCanvasElement){if(f.style.display==="none")return;u.save();const y=window.devicePixelRatio;u.scale(1/y,1/y),u.drawImage(f,0,0),u.restore()}else if(f instanceof HTMLImageElement){if(f.style.display==="none")return;const y=f.getBoundingClientRect();g=y.left-l.left-.5,A=y.top-l.top-.5,v=y.width,m=y.height,u.drawImage(f,g,A,v,m)}else{if(f.style.display==="none")return;const y=f.getBoundingClientRect();g=y.left-l.left-.5,A=y.top-l.top-.5,v=y.width,m=y.height,p=window.getComputedStyle(f),r(g,A,v,m,parseFloat(p.borderRadius));const _=p.backgroundColor;_!=="transparent"&&_!=="rgba(0, 0, 0, 0)"&&(u.fillStyle=_,u.fill());const E=["borderTop","borderLeft","borderBottom","borderRight"];let M=!0,I=null;for(const R of E){if(I!==null&&(M=p[R+"Width"]===p[I+"Width"]&&p[R+"Color"]===p[I+"Color"]&&p[R+"Style"]===p[I+"Style"]),M===!1)break;I=R}if(M===!0){const R=parseFloat(p.borderTopWidth);p.borderTopWidth!=="0px"&&p.borderTopStyle!=="none"&&p.borderTopColor!=="transparent"&&p.borderTopColor!=="rgba(0, 0, 0, 0)"&&(u.strokeStyle=p.borderTopColor,u.lineWidth=R,u.stroke())}else o(p,"borderTop",g,A,v,0),o(p,"borderLeft",g,A,0,m),o(p,"borderBottom",g,A+m,v,0),o(p,"borderRight",g+v,A,0,m);if(f instanceof HTMLInputElement){let R=p.accentColor;(R===void 0||R==="auto")&&(R=p.color),t.set(R);const T=Math.sqrt(.299*t.r**2+.587*t.g**2+.114*t.b**2)<.5?"white":"#111111";if(f.type==="radio"&&(r(g,A,v,m,m),u.fillStyle="white",u.strokeStyle=R,u.lineWidth=1,u.fill(),u.stroke(),f.checked&&(r(g+2,A+2,v-4,m-4,m),u.fillStyle=R,u.strokeStyle=T,u.lineWidth=2,u.fill(),u.stroke())),f.type==="checkbox"&&(r(g,A,v,m,2),u.fillStyle=f.checked?R:"white",u.strokeStyle=f.checked?T:R,u.lineWidth=1,u.stroke(),u.fill(),f.checked)){const O=u.textAlign;u.textAlign="center";const J={color:T,fontFamily:p.fontFamily,fontSize:m+"px",fontWeight:"bold"};s(J,g+v/2,A,""),u.textAlign=O}if(f.type==="range"){const[O,J,V]=["min","max","value"].map(Y=>parseFloat(f[Y])),H=(V-O)/(J-O)*(v-m);r(g,A+m/4,v,m/2,m/4),u.fillStyle=T,u.strokeStyle=R,u.lineWidth=1,u.fill(),u.stroke(),r(g,A+m/4,H+m/2,m/2,m/4),u.fillStyle=R,u.fill(),r(g+H,A,m,m,m/2),u.fillStyle=R,u.fill()}(f.type==="color"||f.type==="text"||f.type==="number")&&(d.add({x:g,y:A,width:v,height:m}),s(p,g+parseInt(p.paddingLeft),A+parseInt(p.paddingTop),f.value),d.remove())}}}const b=p.overflow==="auto"||p.overflow==="hidden";b&&d.add({x:g,y:A,width:v,height:m});for(let y=0;y<f.childNodes.length;y++)a(f.childNodes[y],p);b&&d.remove()}const l=n.getBoundingClientRect();let c=BE.get(n);c===void 0&&(c=document.createElement("canvas"),c.width=l.width,c.height=l.height,BE.set(n,c));const u=c.getContext("2d"),d=new i(u);return a(n),c}function Jie(n,e,t,i){const s={clientX:t*n.offsetWidth+n.offsetLeft,clientY:i*n.offsetHeight+n.offsetTop,view:n.ownerDocument.defaultView};window.dispatchEvent(new MouseEvent(e,s));const r=n.getBoundingClientRect();t=t*r.width+r.left,i=i*r.height+r.top;function o(a){if(a.nodeType!==Node.TEXT_NODE&&a.nodeType!==Node.COMMENT_NODE){const l=a.getBoundingClientRect();if(t>l.left&&t<l.right&&i>l.top&&i<l.bottom&&(a.dispatchEvent(new MouseEvent(e,s)),a instanceof HTMLInputElement&&a.type==="range"&&(e==="mousedown"||e==="click"))){const[c,u]=["min","max"].map(g=>parseFloat(a[g])),d=l.width,p=(t-l.x)/d;a.value=c+(u-c)*p,a.dispatchEvent(new InputEvent("input",{bubbles:!0}))}for(let c=0;c<a.childNodes.length;c++)o(a.childNodes[c])}}o(n)}const Xy=new te,Od={type:"",data:Xy};class Kie extends ar{constructor(e,t){super();const i=this,s=new Uu,r=new Ie,o=e.domElement;function a(f){f.stopPropagation();const p=e.domElement.getBoundingClientRect();Xy.x=(f.clientX-p.left)/p.width*2-1,Xy.y=-(f.clientY-p.top)/p.height*2+1,s.setFromCamera(Xy,t);const g=s.intersectObjects(i.children,!1);if(g.length>0){const A=g[0],v=A.object,m=A.uv;Od.type=f.type,Od.data.set(m.x,1-m.y),v.dispatchEvent(Od)}}o.addEventListener("pointerdown",a),o.addEventListener("pointerup",a),o.addEventListener("pointermove",a),o.addEventListener("mousedown",a),o.addEventListener("mouseup",a),o.addEventListener("mousemove",a),o.addEventListener("click",a);const l={move:"mousemove",select:"click",selectstart:"mousedown",selectend:"mouseup"};function c(f){const p=f.target;r.identity().extractRotation(p.matrixWorld),s.ray.origin.setFromMatrixPosition(p.matrixWorld),s.ray.direction.set(0,0,-1).applyMatrix4(r);const g=s.intersectObjects(i.children,!1);if(g.length>0){const A=g[0],v=A.object,m=A.uv;Od.type=l[f.type],Od.data.set(m.x,1-m.y),v.dispatchEvent(Od)}}const u=e.xr.getController(0);u.addEventListener("move",c),u.addEventListener("select",c),u.addEventListener("selectstart",c),u.addEventListener("selectend",c);const d=e.xr.getController(1);d.addEventListener("move",c),d.addEventListener("select",c),d.addEventListener("selectstart",c),d.addEventListener("selectend",c)}}class _3 extends Te{constructor(){super(...arguments);h(this,"id",null);h(this,"keepAspect",!1)}start(){if(!this.id||!this.context.mainCamera)return;const t=document.getElementById(this.id);if(!t){console.warn('Could not find element with id "'+this.id+'"');return}t.style.display="block",t.style.visibility="hidden";const i=new Kie(this.context.renderer,this.context.mainCamera);this.gameObject.add(i);const s=new Xie(t);i.add(s),s.visible=!1,console.log(s);const r=s.material;r.transparent=!0,setTimeout(()=>{s.visible=!0;const o=zM(this.gameObject).clone();GM(this.gameObject,0,0,0),this.gameObject.updateMatrixWorld();const a=new Bn;a.setFromObject(i),this.setWorldRotation(o.x,o.y,o.z);const l=a.max.x-a.min.x,c=a.max.y-a.min.y;if(this.keepAspect){const d=l/c;l>c?s.scale.set(1/l,1/c/d,1):s.scale.set(1/l*d,1/c,1)}else s.scale.set(1/l,1/c,1);const u=this.gameObject.scale;s.scale.multiply(u)},1)}}var FA=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const em=re("debugspatialtrigger"),yO=new Ss,bO=new Ss;function Zie(n,e){return yO.mask=n,bO.mask=e,yO.test(bO)}class zl extends Te{constructor(){super(...arguments);h(this,"triggerMask",0);h(this,"onEnter");h(this,"onStay");h(this,"onExit");h(this,"currentIntersected",[]);h(this,"lastIntersected",[])}start(){em&&console.log(this.name,this.triggerMask,this)}update(){this.currentIntersected.length=0;for(const t of xu.triggers)Zie(t.triggerMask,this.triggerMask)&&t.test(this.gameObject)&&this.currentIntersected.push(t);for(let t=this.lastIntersected.length-1;t>=0;t--){const i=this.lastIntersected[t];this.currentIntersected.indexOf(i)<0&&(this.onExitTrigger(i),this.lastIntersected.splice(t,1))}for(const t of this.currentIntersected)this.lastIntersected.indexOf(t)<0&&this.onEnterTrigger(t),this.onStayTrigger(t);this.lastIntersected.length=0,this.lastIntersected.push(...this.currentIntersected)}onEnterTrigger(t){var i;em&&console.log("ENTER TRIGGER",this.name,t.name,this,t),t.raiseOnEnterEvent(this),(i=this.onEnter)==null||i.invoke(this,t)}onExitTrigger(t){var i;em&&console.log("EXIT TRIGGER",this.name,t.name,this,t),t.raiseOnExitEvent(this),(i=this.onExit)==null||i.invoke(this,t)}onStayTrigger(t){var i;t.raiseOnStayEvent(this),(i=this.onStay)==null||i.invoke(this,t)}}FA([x()],zl.prototype,"triggerMask",void 0);FA([x(qn)],zl.prototype,"onEnter",void 0);FA([x(qn)],zl.prototype,"onStay",void 0);FA([x(qn)],zl.prototype,"onExit",void 0);const cm=class extends Te{constructor(){super(...arguments);h(this,"triggerMask");h(this,"boxHelper")}start(){em&&console.log(this.name,this.triggerMask,this)}onEnable(){var t;cm.triggers.push(this),this.boxHelper||(this.boxHelper=ne.addNewComponent(this.gameObject,zo),(t=this.boxHelper)==null||t.showHelper(null,em))}onDisable(){cm.triggers.splice(cm.triggers.indexOf(this),1)}test(t){return this.boxHelper?this.boxHelper.isInBox(t)??!1:!1}raiseOnEnterEvent(t){ne.foreachComponent(this.gameObject,i=>{i!==t&&i instanceof zl&&i.onEnterTrigger(this)},!1)}raiseOnStayEvent(t){ne.foreachComponent(this.gameObject,i=>{i!==t&&i instanceof zl&&i.onStayTrigger(this)},!1)}raiseOnExitEvent(t){ne.foreachComponent(this.gameObject,i=>{i!==t&&i instanceof zl&&i.onExitTrigger(this)},!1)}};let xu=cm;h(xu,"triggers",[]);FA([x()],xu.prototype,"triggerMask",void 0);var $ie=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r},Wf;(function(n){n[n.FirstPerson=0]="FirstPerson",n[n.ThirdPerson=1]="ThirdPerson"})(Wf||(Wf={}));const Br=re("debugspectator");class V1 extends Te{constructor(){super(...arguments);h(this,"cam",null);h(this,"useKeys",!0);h(this,"_mode",Wf.FirstPerson);h(this,"orbit",null);h(this,"_handler");h(this,"eventSub_WebXRRequestStartEvent",null);h(this,"eventSub_WebXRStartEvent",null);h(this,"eventSub_WebXREndEvent",null);h(this,"_debug");h(this,"_networking")}get mode(){return this._mode}set mode(t){this._mode=t}get isSpectating(){var t;return((t=this._handler)==null?void 0:t.currentTarget)!==void 0}isSpectatingUser(t){var i;return((i=this.target)==null?void 0:i.userId)===t}isFollowedBy(t){var i;return(i=this.followers)==null?void 0:i.includes(t)}get followers(){return this._networking.followers}stopSpectating(){if(this.context.isInXR){this.followSelf();return}this.target=void 0}get localId(){return this.context.connection.connectionId??"local"}set target(t){var i;if(this._handler){const s=(i=this._handler.currentTarget)==null?void 0:i.userId,r=this.context.players.getPlayerView(this.localId);t===void 0||this.context.isInXR===!1&&(r==null?void 0:r.currentObject)===t.currentObject?this._handler.currentTarget!==void 0&&(this._handler.disable(),ne.setActive(this.gameObject,!1),this.orbit&&(this.orbit.enabled=!0),this._networking.onSpectatedObjectChanged(t,s)):this._handler.currentTarget!==t&&(this._handler.set(t),ne.setActive(this.gameObject,!0),this.orbit&&(this.orbit.enabled=!1),this._networking.onSpectatedObjectChanged(t,s))}}get target(){var t;return(t=this._handler)==null?void 0:t.currentTarget}requestAllFollowMe(){this._networking.onRequestFollowMe()}get isSpectatingSelf(){var t,i;return this.isSpectating&&((t=this.target)==null?void 0:t.currentObject)===((i=this.context.players.getPlayerView(this.localId))==null?void 0:i.currentObject)}awake(){if(this._debug=new ine(this.context,this),this._networking=new rne(this.context,this),this._networking.awake(),ne.setActive(this.gameObject,!1),this.cam=ne.getComponent(this.gameObject,yi),!this.cam){console.warn("SpectatorCamera: Spectator camera needs camera component on the same object.",this);return}!this._handler&&this.cam&&(this._handler=new ene(this.context,this.cam,this)),this.eventSub_WebXRRequestStartEvent=this.onXRSessionRequestStart.bind(this),this.eventSub_WebXRStartEvent=this.onXRSessionStart.bind(this),this.eventSub_WebXREndEvent=this.onXRSessionEnded.bind(this),vt.addEventListener(ii.RequestVRSession,this.eventSub_WebXRRequestStartEvent),vt.addEventListener(ii.XRStarted,this.eventSub_WebXRStartEvent),vt.addEventListener(ii.XRStopped,this.eventSub_WebXREndEvent),this.orbit=ne.getComponent(this.context.mainCamera,rn)}onDestroy(){var t,i;this.stopSpectating(),vt.removeEventListener(ii.RequestVRSession,this.eventSub_WebXRStartEvent),vt.removeEventListener(ii.XRStarted,this.eventSub_WebXRStartEvent),vt.removeEventListener(ii.XRStopped,this.eventSub_WebXREndEvent),(t=this._handler)==null||t.destroy(),(i=this._networking)==null||i.destroy()}isSupportedPlatform(){const t=window.navigator.userAgent,i=/Windows|MacOS/.test(t),s=/Windows NT/.test(t)&&/Edg/.test(t)&&!/Win64/.test(t);return i&&!s}onXRSessionRequestStart(t){this.isSupportedPlatform()&&ne.setActive(this.gameObject,!0)}onXRSessionStart(t){this.isSupportedPlatform()&&(Br&&console.log(this.context.mainCamera),this.context.mainCamera&&this.followSelf())}onXRSessionEnded(t){var i,s;this.context.removeCamera(this.cam),ne.setActive(this.gameObject,!1),this.orbit&&(this.orbit.enabled=!0),(i=this._handler)==null||i.set(void 0),(s=this._handler)==null||s.disable(),this.isSpectatingSelf&&this.stopSpectating()}followSelf(){this.target=this.context.players.getPlayerView(this.context.connection.connectionId),this.target||(this.context.players.setPlayerView(this.localId,this.context.mainCamera,jo.Headset),this.target=this.context.players.getPlayerView(this.localId)),Br&&console.log("Follow self",this.target)}onAfterRender(){var c,u,d;if(!this.cam)return;const t=this.context.renderer,i=t.xr.enabled;if(!t.xr.isPresenting&&!((c=this._handler)!=null&&c.currentTarget))return;(u=this._handler)==null||u.update(this._mode);const s=t.getRenderTarget();let r=null;if(!s){if(!t.state.bindFramebuffer||!t.state.bindXRFramebuffer)return;r=t._framebuffer,t.state.bindXRFramebuffer(null)}this.setAvatarFlagsBeforeRender();const o=this.context.mainCameraComponent;if(o){const f=o.backgroundColor;f&&t.setClearColor(f,f.alpha),this.cam.backgroundColor=f,this.cam.clearFlags=o.clearFlags,this.cam.nearClipPlane=o.nearClipPlane,this.cam.farClipPlane=o.farClipPlane}else t.setClearColor(new _e(1,1,1));t.setRenderTarget(null),t.xr.enabled=!1;const a=(d=this.cam)==null?void 0:d.cam;this.context.updateAspect(a);const l=t.xr.isPresenting;t.xr.isPresenting=!1,t.setSize(this.context.domWidth,this.context.domHeight),t.render(this.context.scene,a),t.xr.isPresenting=l,t.xr.enabled=i,s?t.setRenderTarget(s):t.state.bindXRFramebuffer(r),this.resetAvatarFlags()}setAvatarFlagsBeforeRender(){const t=this._mode===Wf.FirstPerson;for(const i of as.instances)if(i.avatar&&"isLocalAvatar"in i.avatar){let s=Wi.All;this.isSpectatingSelf&&(s=t&&i.avatar.isLocalAvatar?Wi.FirstPerson:Wi.ThirdPerson);const r=i.avatar.flags;if(!r)continue;for(const o of r)o.UpdateVisible(s)}}resetAvatarFlags(){var t;for(const i of as.instances)if(i.avatar&&"flags"in i.avatar){const s=i.avatar.flags;if(!s)continue;for(const r of s)(t=i.avatar)!=null&&t.isLocalAvatar?r.UpdateVisible(Wi.FirstPerson):r.UpdateVisible(Wi.ThirdPerson)}}}$ie([x()],V1.prototype,"useKeys",void 0);class ene{constructor(e,t,i){h(this,"context");h(this,"cam");h(this,"spectator");h(this,"follow");h(this,"target");h(this,"view");h(this,"currentObject");this.context=e,this.cam=t,this.spectator=i}get currentTarget(){return this.view}set(e){const t=e==null?void 0:e.currentObject;if(!t){this.spectator.stopSpectating();return}t!==this.currentObject&&(this.currentObject=t,this.view=e,this.follow||(this.follow=ne.addNewComponent(this.cam.gameObject,za)),this.target||(this.target=new Me),t.add(this.target),this.follow.enabled=!0,this.follow.target=this.target,Br&&console.log("FOLLOW",t),this.context.isInXR?this.context.removeCamera(this.cam):this.context.setCurrentCamera(this.cam))}disable(){Br&&console.log("STOP FOLLOW",this.currentObject),this.view=void 0,this.currentObject=void 0,this.context.removeCamera(this.cam),this.follow&&(this.follow.enabled=!1)}destroy(){var e;(e=this.target)==null||e.removeFromParent(),this.follow&&ne.destroy(this.follow)}update(e){var s,r,o,a,l,c;if(((s=this.currentTarget)==null?void 0:s.isConnected)===!1||((r=this.currentTarget)==null?void 0:r.removed)===!0){Br&&console.log("Target disconnected or timeout",this.currentTarget),this.spectator.stopSpectating();return}this.currentTarget&&((o=this.currentTarget)==null?void 0:o.currentObject)!==this.currentObject&&(Br&&console.log("Target changed",this.currentObject,"to",this.currentTarget.currentObject),this.set(this.currentTarget));const t=this.context.mainCamera;t&&(this.cam.cam.near!==t.near||this.cam.cam.far!==t.far)&&(this.cam.cam.near=t.near,this.cam.cam.far=t.far,this.cam.cam.updateProjectionMatrix());const i=(a=this.follow)==null?void 0:a.target;if(!(!i||!this.follow)){switch(e){case Wf.FirstPerson:((l=this.view)==null?void 0:l.viewDevice)!==jo.Browser?(this.follow.followFactor=5,this.follow.rotateFactor=5):(this.follow.followFactor=50,this.follow.rotateFactor=50),i.position.set(0,0,0);break;case Wf.ThirdPerson:this.follow.followFactor=3,this.follow.rotateFactor=2,i.position.set(0,.5,1.5);break}this.follow.flipForward=!1,((c=this.view)==null?void 0:c.viewDevice)!==jo.Browser?i.quaternion.copy(tne):i.quaternion.identity()}}}const tne=new Se().setFromAxisAngle(new w(0,1,0),Math.PI);class ine{constructor(e,t){h(this,"context");h(this,"spectator");this.context=e,this.spectator=t,console.log("Click other avatars or cameras to follow them. Press ESC to exit spectator mode."),this.context.domElement.addEventListener("keydown",s=>{if(!this.spectator.useKeys)return;s.key==="Escape"&&this.spectator.stopSpectating()});let i=0;this.context.input.addEventListener(ui.PointerDown,s=>{i=this.context.time.time}),this.context.input.addEventListener(ui.PointerUp,s=>{const r=this.context.time.time-i;r>1?this.spectator.stopSpectating():this.context.input.getPointerClicked(0)&&r<.3&&this.trySelectObject()})}trySelectObject(){const e=new Ko;e.setMask(16777215);const t=this.context.physics.raycast(e);if(Br&&console.log(...t),t!=null&&t.length)for(const i of t){if(i.distance<.2)continue;const s=i.object,r=ne.getComponentInParent(s,as),o=r==null?void 0:r.connectionId;if(o){const a=this.context.players.getPlayerView(o);this.spectator.target=a,Br&&console.log("spectate",o,r);break}}}}class nne{constructor(e,t,i){h(this,"guid");h(this,"dontSave",!0);h(this,"targetUserId");h(this,"stoppedFollowing");this.guid=e,this.targetUserId=t,this.stoppedFollowing=i}}class sne{constructor(e,t){h(this,"guid");h(this,"userId");this.guid=e.guid,this.userId=t}}class rne{constructor(e,t){h(this,"followers",[]);h(this,"context");h(this,"spectator");h(this,"_followerEventMethod");h(this,"_requestFollowMethod");h(this,"_joinedRoomMethod");h(this,"_lastRequestFollowUser");h(this,"_enforceFollowInterval");this.context=e,this.spectator=t,this._followerEventMethod=this.onFollowerEvent.bind(this),this._requestFollowMethod=this.onRequestFollowEvent.bind(this),this._joinedRoomMethod=this.onUserJoinedRoom.bind(this)}awake(){this.context.connection.beginListen("spectator-follower-changed",this._followerEventMethod),this.context.connection.beginListen("spectator-request-follow",this._requestFollowMethod),this.context.connection.beginListen(pi.JoinedRoom,this._joinedRoomMethod),this.context.domElement.addEventListener("keydown",e=>{this.spectator.useKeys&&(e.key==="f"?this.onRequestFollowMe():e.key==="Escape"&&this.onRequestFollowMe(!0))})}destroy(){this.context.connection.stopListen("spectator-follower-changed",this._followerEventMethod),this.context.connection.stopListen("spectator-request-follow",this._requestFollowMethod),this.context.connection.stopListen(pi.JoinedRoom,this._joinedRoomMethod)}onSpectatedObjectChanged(e,t){if(Br&&console.log(this.context.connection.connectionId,"onSpectatedObjectChanged",e,t),this.context.connection.connectionId){const i=(e==null?void 0:e.userId)===void 0,s=i?t:e==null?void 0:e.userId,r=new nne(this.context.connection.connectionId,s,i);this.context.connection.send("spectator-follower-changed",r)}}onRequestFollowMe(e=!1){if(Br&&console.log("Request follow",this.context.connection.connectionId),this.context.connection.connectionId){this.spectator.stopSpectating();const t=e?void 0:this.context.connection.connectionId,i=new sne(this.spectator,t);this.context.connection.send("spectator-request-follow",i)}}onUserJoinedRoom(){re("followme")&&this.onRequestFollowMe()}onFollowerEvent(e){const t=e.targetUserId,i=e.guid;if(Br&&console.log(e),t===this.context.connection.connectionId)if(e.stoppedFollowing){const s=this.followers.indexOf(i);s!==-1&&(this.followers.splice(s,1),this.removeDisconnectedFollowers(),console.log(i,"unfollows you",this.followers.length))}else this.followers.includes(i)||(this.followers.push(i),this.removeDisconnectedFollowers(),console.log(i,"follows you",this.followers.length))}removeDisconnectedFollowers(){for(let e=this.followers.length-1;e>=0;e--){const t=this.followers[e];this.context.connection.userIsInRoom(t)===!1&&this.followers.splice(e,1)}}onRequestFollowEvent(e){if(this._lastRequestFollowUser=e,e.userId===this.context.connection.connectionId)this.spectator.stopSpectating();else if(e.userId===void 0)this.spectator.stopSpectating();else{const t=this.context.players.getPlayerView(e.userId);if(t)this.spectator.target=t;else return Br&&console.warn("Could not find view",e.userId),this.enforceFollow(),!1}return!0}enforceFollow(){this._enforceFollowInterval||(this._enforceFollowInterval=setInterval(()=>{this._lastRequestFollowUser===void 0||this._lastRequestFollowUser.userId&&this.spectator.isFollowedBy(this._lastRequestFollowUser.userId)?(clearInterval(this._enforceFollowInterval),this._enforceFollowInterval=void 0):(Br&&console.log("REQUEST FOLLOW AGAIN",this._lastRequestFollowUser.userId),this.onRequestFollowEvent(this._lastRequestFollowUser))},1e3))}}var er=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const eb=re("debugspriterenderer"),one=re("wireframe"),db=class{static getOrCreateGeometry(e){if(e._geometry)return e._geometry;if(e.guid&&db.cache[e.guid])return eb&&console.log("Take cached geometry for sprite",e.guid),db.cache[e.guid];const t=new ft;e._geometry=t;const i=new Float32Array(e.triangles.length*3),s=new Float32Array(e.triangles.length*2);for(let r=0;r<e.triangles.length;r+=1){const o=e.triangles[r];i[r*3]=-e.vertices[o].x,i[r*3+1]=e.vertices[o].y,i[r*3+2]=0;const a=e.uv[o];s[r*2]=a.x,s[r*2+1]=1-a.y}return t.setAttribute("position",new ot(i,3)),t.setAttribute("uv",new ot(s,2)),e.guid&&(this.cache[e.guid]=t),eb&&console.log("Built sprite geometry",e,t),t}};let tm=db;h(tm,"cache",{});var tb;(function(n){n[n.Simple=0]="Simple",n[n.Sliced=1]="Sliced",n[n.Tiled=2]="Tiled"})(tb||(tb={}));class yh{constructor(){h(this,"guid");h(this,"texture");h(this,"triangles");h(this,"uv");h(this,"vertices");h(this,"_geometry")}}er([x()],yh.prototype,"guid",void 0);er([x(Rt)],yh.prototype,"texture",void 0);er([hA()],yh.prototype,"triangles",void 0);er([hA()],yh.prototype,"uv",void 0);er([hA()],yh.prototype,"vertices",void 0);const _S=Symbol("spriteOwner");class px{constructor(){h(this,"sprites")}}er([x(yh)],px.prototype,"sprites",void 0);class UA{constructor(){h(this,"spriteSheet");h(this,"index",0)}update(){if(!this.spriteSheet)return;const e=this.index;if(e<0||e>=this.spriteSheet.sprites.length)return;const t=this.spriteSheet.sprites[e],i=t==null?void 0:t.texture;i&&(i.colorSpace=Je,i.minFilter==Ft&&i.magFilter==Ft&&(i.anisotropy=1),i.needsUpdate=!0)}}er([x(px)],UA.prototype,"spriteSheet",void 0);er([x()],UA.prototype,"index",void 0);class tc extends Te{constructor(){super(...arguments);h(this,"drawMode",tb.Simple);h(this,"size",{x:1,y:1});h(this,"color");h(this,"sharedMaterial");h(this,"_spriteSheet");h(this,"_currentSprite");h(this,"transparent",!0);h(this,"cutoutThreshold",0);h(this,"castShadows",!1)}get sprite(){return this._spriteSheet}set sprite(t){if(t!==this._spriteSheet)if(typeof t=="number"){const i=Math.floor(t);i===t&&(this.spriteIndex=i);return}else this._spriteSheet=t,this.updateSprite()}set spriteIndex(t){this._spriteSheet&&(this._spriteSheet.index=t,this.updateSprite())}get spriteIndex(){var t;return((t=this._spriteSheet)==null?void 0:t.index)??0}get spriteFrames(){var t,i;return((i=(t=this._spriteSheet)==null?void 0:t.spriteSheet)==null?void 0:i.sprites.length)??0}awake(){this._currentSprite=void 0,eb&&console.log("Awake",this.name,this,this.sprite)}start(){this._currentSprite?this.gameObject&&this.gameObject.add(this._currentSprite):this.updateSprite()}updateSprite(){var i,s,r;if(!this.__didAwake||!((s=(i=this.sprite)==null?void 0:i.spriteSheet)!=null&&s.sprites))return;const t=this.sprite.spriteSheet.sprites[this.spriteIndex];if(!t){eb&&console.warn("Sprite not found",this.spriteIndex,this.sprite.spriteSheet.sprites);return}if(this._currentSprite)this._currentSprite.geometry=tm.getOrCreateGeometry(t),this._currentSprite.material.map=t.texture;else{const o=new ai({color:16777215,side:wi});if(!o)return;if(one&&(o.wireframe=!0),this.color&&(o.color||(o.color=new _e),o.color.copy(this.color),o.opacity=this.color.alpha),o.transparent=!0,t.texture&&!o.wireframe){let a=t.texture;a[_S]!==void 0&&a[_S]!==this&&this.spriteFrames>1&&(a=t.texture=a.clone()),a[_S]=this,o.map=a}this.sharedMaterial=o,this._currentSprite=new ye(tm.getOrCreateGeometry(t),o)}this._currentSprite.parent!==this.gameObject&&(this.drawMode===tb.Tiled&&this._currentSprite.scale.set(this.size.x,this.size.y,1),this.gameObject&&this.gameObject.add(this._currentSprite)),this._currentSprite&&this._currentSprite.layers.set(this.layer),this.sharedMaterial&&(this.sharedMaterial.alphaTest=this.cutoutThreshold,this.sharedMaterial.transparent=this.transparent),this._currentSprite.castShadow=this.castShadows,(r=this._spriteSheet)==null||r.update()}}er([x()],tc.prototype,"drawMode",void 0);er([x(Si)],tc.prototype,"color",void 0);er([x(Pt)],tc.prototype,"sharedMaterial",void 0);er([x(UA)],tc.prototype,"sprite",null);er([x()],tc.prototype,"transparent",void 0);er([x()],tc.prototype,"cutoutThreshold",void 0);er([x()],tc.prototype,"castShadows",void 0);class Sa{constructor(){h(this,"bb",null);h(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsSyncedCameraModel(e,t){return(t||new Sa).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsSyncedCameraModel(e,t){return e.setPosition(e.position()+t_),(t||new Sa).__init(e.readInt32(e.position())+e.position(),e)}userId(e){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}guid(e){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__string(this.bb_pos+t,e):null}dontSave(){const e=this.bb.__offset(this.bb_pos,8);return e?!!this.bb.readInt8(this.bb_pos+e):!1}pos(e){const t=this.bb.__offset(this.bb_pos,10);return t?(e||new zr).__init(this.bb_pos+t,this.bb):null}rot(e){const t=this.bb.__offset(this.bb_pos,12);return t?(e||new zr).__init(this.bb_pos+t,this.bb):null}static startSyncedCameraModel(e){e.startObject(5)}static addUserId(e,t){e.addFieldOffset(0,t,0)}static addGuid(e,t){e.addFieldOffset(1,t,0)}static addDontSave(e,t){e.addFieldInt8(2,+t,0)}static addPos(e,t){e.addFieldStruct(3,t,0)}static addRot(e,t){e.addFieldStruct(4,t,0)}static endSyncedCameraModel(e){return e.endObject()}static finishSyncedCameraModelBuffer(e,t){e.finish(t)}static finishSizePrefixedSyncedCameraModelBuffer(e,t){e.finish(t,void 0,!0)}}var ane=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const ib="SCAM";VM(ib,Sa.getRootAsSyncedCameraModel);const xr=new $f;class lne{constructor(e,t){h(this,"userId");h(this,"guid");this.guid=t,this.userId=e}send(e,t){if(e){xr.clear();const i=xr.createString(this.guid),s=xr.createString(this.userId);Sa.startSyncedCameraModel(xr),Sa.addGuid(xr,i),Sa.addUserId(xr,s);const r=Mt(e),o=zM(e);Sa.addPos(xr,zr.createVec3(xr,r.x,r.y,r.z)),Sa.addRot(xr,zr.createVec3(xr,o.x,o.y,o.z));const a=Sa.endSyncedCameraModel(xr);xr.finish(a,ib),t.sendBinary(xr.asUint8Array())}}}const fb=class extends Te{constructor(){super(...arguments);h(this,"cameraPrefab",null);h(this,"_lastWorldPosition");h(this,"_lastWorldQuaternion");h(this,"_model",null);h(this,"_needsUpdate",!0);h(this,"_lastUpdateTime",0);h(this,"remoteCams",{});h(this,"userToCamMap",{});h(this,"_camTimeoutInSeconds",10);h(this,"_receiveCallback",null)}getCameraObject(t){const i=this.userToCamMap[t];return i?this.remoteCams[i].obj:null}async awake(){this._lastWorldPosition=this.worldPosition.clone(),this._lastWorldQuaternion=this.worldQuaternion.clone(),this.cameraPrefab&&("uri"in this.cameraPrefab&&(this.cameraPrefab=await this.cameraPrefab.instantiate(this.gameObject)),this.cameraPrefab&&"isObject3D"in this.cameraPrefab&&(this.cameraPrefab.visible=!1))}onEnable(){this._receiveCallback=this.context.connection.beginListenBinary(ib,this.onReceivedRemoteCameraInfoBin.bind(this))}onDisable(){this.context.connection.stopListenBinary(ib,this._receiveCallback)}update(){for(const r in this.remoteCams){const o=this.remoteCams[r],a=this.context.time.realtimeSinceStartup-o.lastUpdate;if(!o||a>this._camTimeoutInSeconds){si()&&console.log("Remote cam timeout",r),o!=null&&o.obj&&ne.destroy(o.obj),delete this.remoteCams[r],o&&delete this.userToCamMap[o.userId],fb.instances.push(o),this.context.players.removePlayerView(o.userId,jo.Browser);continue}}if(vt.IsInWebXR)return;const t=this.context.mainCamera;if(t===null){this.enabled=!1;return}if(!this.context.connection.isConnected||this.context.connection.connectionId===null)return;this._model===null&&(this._model=new lne(this.context.connection.connectionId,this.context.connection.connectionId+"_camera"));const i=Mt(t),s=Gr(t);(i.distanceTo(this._lastWorldPosition)>.001||s.angleTo(this._lastWorldQuaternion)>.01)&&(this._needsUpdate=!0),this._lastWorldPosition.copy(i),this._lastWorldQuaternion.copy(s),!((!this._needsUpdate||this.context.time.frameCount%2!==0)&&!(this.context.time.realtimeSinceStartup-this._lastUpdateTime>this._camTimeoutInSeconds*.5))&&(this._lastUpdateTime=this.context.time.realtimeSinceStartup,this._needsUpdate=!1,this._model.send(t,this.context.connection),this.context.isInXR||this.context.players.setPlayerView(this.context.connection.connectionId,t,jo.Browser))}onReceivedRemoteCameraInfoBin(t){const i=t.guid();if(!i)return;const s=t.userId();if(!s||!this.context.connection.userIsInRoom(s)||!this.cameraPrefab)return;let r=this.remoteCams[i];if(!r)if("isObject3D"in this.cameraPrefab){const c=new Hl;c.context=this.context;const u=ne.instantiate(this.cameraPrefab,c);r=this.remoteCams[i]={obj:u,lastUpdate:this.context.time.realtimeSinceStartup,userId:s},r.obj.visible=!0,this.gameObject.add(u),this.userToCamMap[s]=i,fb.instances.push(r);const d=ne.getOrAddComponent(u,as);d.connectionId=s,d.avatar=u}else return;const o=r.obj;this.context.players.setPlayerView(s,o,jo.Browser),r.lastUpdate=this.context.time.realtimeSinceStartup,Fr.markDirty(o);const a=t.pos();a&&c0(o,a.x(),a.y(),a.z());const l=t.rot();l&&GM(o,l.x(),l.y(),l.z())}};let wf=fb;h(wf,"instances",[]);ane([x([Me,wn])],wf.prototype,"cameraPrefab",void 0);var NA=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const xS="view",wS=re("debugsyncedroom");class $u extends Te{constructor(){super(...arguments);h(this,"roomName");h(this,"urlParameterName","room");h(this,"joinRandomRoom",!0);h(this,"requireRoomParameter",!1);h(this,"autoRejoin",!0);h(this,"_roomPrefix");h(this,"_lastPingTime",0);h(this,"_lastRoomTime",-1)}get RoomPrefix(){return this._roomPrefix}awake(){wS&&console.log("Room",this.roomName,this.urlParameterName,this.joinRandomRoom,this.requireRoomParameter,this.autoRejoin),this._roomPrefix===void 0&&(this._roomPrefix=this.roomName,this.roomName="")}onEnable(){const t=re(xS);if(t&&typeof t=="string"&&t.length>0){console.log("Join as viewer"),this.context.connection.joinRoom(t,!0);return}(this.joinRandomRoom||re(this.urlParameterName))&&this.tryJoinRoom()}onDisable(){this.roomName&&this.roomName.length>0&&this.context.connection.leaveRoom(this.roomName)}tryJoinRandomRoom(){this.setRandomRoomUrlParameter(),this.tryJoinRoom()}tryJoinRoom(t=0){t===void 0&&(t=0);let i=!1;if(this.urlParameterName){const s=re(this.urlParameterName);if(s&&typeof s=="string"||s==="number"){i=!0;const r=t8(s);this.roomName=r}else if(this.joinRandomRoom&&(console.log("No room name found in url, generating random one"),this.setRandomRoomUrlParameter(),t<1))return this.tryJoinRoom(t+1)}else this.joinRandomRoom&&(this.roomName===null||this.roomName===void 0||this.roomName.length<=0)&&(console.log("generate room name"),this.roomName=this.generateRoomName());return this.requireRoomParameter&&!i?(wS&&console.log('No required room parameter "'+this.urlParameterName+'" in url - will not connect to networking backend.'),!1):(this.context.connection.isConnected||this.context.connection.connect(),wS&&console.log("Join "+this.roomName),this._roomPrefix&&(this.roomName=this._roomPrefix+this.roomName),this.context.connection.joinRoom(this.roomName),!0)}update(){this.context.connection.isConnected&&(this.context.time.time-this._lastPingTime>3&&(this._lastPingTime=this.context.time.time,this.context.connection.sendPing()),this.context.connection.isInRoom&&(this._lastRoomTime=this.context.time.time)),this._lastRoomTime>0&&this.context.time.time-this._lastRoomTime>.3&&(this._lastRoomTime=-1,this.autoRejoin?(console.log("Disconnected from networking backend - attempt reconnecting now"),this.tryJoinRoom()):console.warn("You are not connected to a room anymore (possibly because the tab was inactive for too long and the server kicked you)"))}get currentRoomName(){const t=re(xS);return t||re(this.urlParameterName)}setRandomRoomUrlParameter(){const t=LM(),i=this.generateRoomName();re(this.urlParameterName)?t.set(this.urlParameterName,i):t.append(this.urlParameterName,i),bL(i,t)}generateRoomName(){return e8()+"_"+$5(100,999)}getViewOnlyUrl(){if(this.context.connection.isConnected&&this.context.connection.currentRoomViewId){const t=window.location.search,i=new URLSearchParams(t);return i.has(this.urlParameterName)&&i.delete(this.urlParameterName),i.set(xS,this.context.connection.currentRoomViewId),window.location.origin+window.location.pathname+"?"+i.toString()}return null}}NA([x()],$u.prototype,"roomName",void 0);NA([x()],$u.prototype,"urlParameterName",void 0);NA([x()],$u.prototype,"joinRandomRoom",void 0);NA([x()],$u.prototype,"requireRoomParameter",void 0);NA([x()],$u.prototype,"autoRejoin",void 0);function cne(){const n=re("testwindowcount")||0;n&&n>0&&hne(n)}function hne(n){if(re("testwindow"))return null;const e=new URL(window.location.href);a0(e.searchParams,UN,1),a0(e.searchParams,"testwindow",1);const t=e.toString(),i=[];window.onbeforeunload=()=>{for(const l of i)l.close()};const s=.05,r=128;let o=0,a=0;for(let l=0;l<n;l++){o*r+r*.01>=window.innerWidth&&(a+=1,o=0);const c=o*(r*(1+s))+window.screenLeft,u=a*(r*(1+s))+window.screenTop+90+60*a;o+=1;const d=window.open(t,"test window "+l,`popup=yes width=${r} height=${r} top=${u} left=${c}`);if(!d){console.warn("Failed to open window");continue}i.push(d),d.onload=()=>{d.onbeforeunload=()=>{for(let f=0;f<i.length;f++){const p=i[f];p!==d&&p.close()}i.length=0}}}return i}class x3 extends Te{awake(){cne()}}class w3 extends Te{constructor(){super(...arguments);h(this,"transformsPerFrame",10);h(this,"interval",0);h(this,"useFlatbuffers",!0);h(this,"builder",null);h(this,"models",null)}awake(){if(this.useFlatbuffers)this.context.connection.beginListenBinary(Om,t=>{});else{this.models=[];for(let t=0;t<this.transformsPerFrame;t++)this.models.push(new S3(this.context.connection.connectionId+"_simulatedTransform_"+t,this))}}update(){if(this.context.connection.isConnected){if(this.useFlatbuffers){if(!this.context.connection.connectionId||this.context.time.frameCount%this.interval!==0)return;this.builder===null&&(this.builder=new $f(1024));const t=this.builder;for(let i=0;i<this.transformsPerFrame;i++){t.clear();const s=hU(this.context.connection.connectionId,this);this.context.connection.sendBinary(s)}}else if(this.models)for(let t=0;t<this.models.length;t++){const i=this.models[t];i.dontSave=!0,i.update(this,null),this.context.connection.send("TestSimulateUserData-"+t,i)}}}}class S3{constructor(e,t){h(this,"guid");h(this,"fast",!1);h(this,"position");h(this,"rotation");h(this,"velocity");h(this,"dontSave");this.guid=e,this.position={x:0,y:0,z:0},this.rotation={x:0,y:0,z:0,w:0},this.update(t,null)}isValid(){return this.fast!==void 0||this.position!==void 0||this.rotation!==void 0||this.velocity!==void 0}update(e,t){const i=e.worldPosition;this.position.x=i.x,this.position.y=i.y,this.position.z=i.z;const s=e.worldQuaternion;if(this.rotation.x=s.x,this.rotation.y=s.y,this.rotation.z=s.z,this.rotation.w=s.w,this.fast=!1,t){const r=t.getVelocity();this.velocity===void 0&&(this.velocity={x:0,y:0,z:0}),this.velocity.x=r.x,this.velocity.y=r.y,this.velocity.z=r.z}}}h(S3,"temp",new w);var wp=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};class ic extends Zs{constructor(){super(...arguments);h(this,"offset");h(this,"rotation");h(this,"focusArea");h(this,"feather");h(this,"kernelSize");h(this,"resolutionScale")}get typeName(){return"TiltShiftEffect"}init(){this.offset.defaultValue=0,this.rotation.defaultValue=0,this.focusArea.defaultValue=.4,this.feather.defaultValue=.3,this.kernelSize.defaultValue=Ql.MEDIUM,this.resolutionScale.defaultValue=1/window.devicePixelRatio}onCreateEffect(){console.log(this);const t=new U6({kernelSize:Ql.VERY_LARGE});return this.offset.onValueChanged=i=>t.offset=i,this.rotation.onValueChanged=i=>t.rotation=i,this.focusArea.onValueChanged=i=>t.focusArea=i,this.feather.onValueChanged=i=>t.feather=i,this.kernelSize.onValueChanged=i=>t.blurPass.kernelSize=i,this.resolutionScale.onValueChanged=i=>t.resolution.scale=i/window.devicePixelRatio,t}}wp([x(Et)],ic.prototype,"offset",void 0);wp([x(Et)],ic.prototype,"rotation",void 0);wp([x(Et)],ic.prototype,"focusArea",void 0);wp([x(Et)],ic.prototype,"feather",void 0);wp([x(Et)],ic.prototype,"kernelSize",void 0);wp([x(Et)],ic.prototype,"resolutionScale",void 0);ta("TiltShiftEffect",ic);var une=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r},im;(function(n){n[n.None=0]="None",n[n.Neutral=1]="Neutral",n[n.ACES=2]="ACES"})(im||(im={}));class gx extends Zs{constructor(){super(...arguments);h(this,"mode")}get typeName(){return"ToneMapping"}get isToneMapping(){return!0}init(){this.mode.defaultValue=Qs}apply(){this.mode.onValueChanged=this._apply.bind(this),this._apply(this.mode.value)}unapply(){this.context.renderer.toneMapping=Qs}_apply(t){switch(t){case im.None:this.context.renderer.toneMapping=dm;break;case im.Neutral:this.context.renderer.toneMapping=zE;break;case im.ACES:this.context.renderer.toneMapping=GE;break}}}une([x(Et)],gx.prototype,"mode",void 0);ta("Tonemapping",gx);const Fh=new Uu,or=new w,yc=new w,Ui=new Se,_O={X:new w(1,0,0),Y:new w(0,1,0),Z:new w(0,0,1)},SS={type:"change"},xO={type:"mouseDown"},wO={type:"mouseUp",mode:null},SO={type:"objectChange"};class dne extends Me{constructor(e,t){super(),t===void 0&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),t=document),this.isTransformControls=!0,this.visible=!1,this.domElement=t,this.domElement.style.touchAction="none";const i=new vne;this._gizmo=i,this.add(i);const s=new yne;this._plane=s,this.add(s);const r=this;function o(b,y){let _=y;Object.defineProperty(r,b,{get:function(){return _!==void 0?_:y},set:function(E){_!==E&&(_=E,s[b]=E,i[b]=E,r.dispatchEvent({type:b+"-changed",value:E}),r.dispatchEvent(SS))}}),r[b]=y,s[b]=y,i[b]=y}o("camera",e),o("object",void 0),o("enabled",!0),o("axis",null),o("mode","translate"),o("translationSnap",null),o("rotationSnap",null),o("scaleSnap",null),o("space","world"),o("size",1),o("dragging",!1),o("showX",!0),o("showY",!0),o("showZ",!0);const a=new w,l=new w,c=new Se,u=new Se,d=new w,f=new Se,p=new w,g=new w,A=new w,v=0,m=new w;o("worldPosition",a),o("worldPositionStart",l),o("worldQuaternion",c),o("worldQuaternionStart",u),o("cameraPosition",d),o("cameraQuaternion",f),o("pointStart",p),o("pointEnd",g),o("rotationAxis",A),o("rotationAngle",v),o("eye",m),this._offset=new w,this._startNorm=new w,this._endNorm=new w,this._cameraScale=new w,this._parentPosition=new w,this._parentQuaternion=new Se,this._parentQuaternionInv=new Se,this._parentScale=new w,this._worldScaleStart=new w,this._worldQuaternionInv=new Se,this._worldScale=new w,this._positionStart=new w,this._quaternionStart=new Se,this._scaleStart=new w,this._getPointer=fne.bind(this),this._onPointerDown=gne.bind(this),this._onPointerHover=pne.bind(this),this._onPointerMove=mne.bind(this),this._onPointerUp=Ane.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye).negate():this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(e){if(this.object===void 0||this.dragging===!0)return;Fh.setFromCamera(e,this.camera);const t=CS(this._gizmo.picker[this.mode],Fh);t?this.axis=t.object.name:this.axis=null}pointerDown(e){if(!(this.object===void 0||this.dragging===!0||e.button!==0)&&this.axis!==null){Fh.setFromCamera(e,this.camera);const t=CS(this._plane,Fh,!0);t&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)),this.dragging=!0,xO.mode=this.mode,this.dispatchEvent(xO)}}pointerMove(e){const t=this.axis,i=this.mode,s=this.object;let r=this.space;if(i==="scale"?r="local":(t==="E"||t==="XYZE"||t==="XYZ")&&(r="world"),s===void 0||t===null||this.dragging===!1||e.button!==-1)return;Fh.setFromCamera(e,this.camera);const o=CS(this._plane,Fh,!0);if(o){if(this.pointEnd.copy(o.point).sub(this.worldPositionStart),i==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),r==="local"&&t!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),t.indexOf("X")===-1&&(this._offset.x=0),t.indexOf("Y")===-1&&(this._offset.y=0),t.indexOf("Z")===-1&&(this._offset.z=0),r==="local"&&t!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),s.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(r==="local"&&(s.position.applyQuaternion(Ui.copy(this._quaternionStart).invert()),t.search("X")!==-1&&(s.position.x=Math.round(s.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(s.position.y=Math.round(s.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(s.position.z=Math.round(s.position.z/this.translationSnap)*this.translationSnap),s.position.applyQuaternion(this._quaternionStart)),r==="world"&&(s.parent&&s.position.add(or.setFromMatrixPosition(s.parent.matrixWorld)),t.search("X")!==-1&&(s.position.x=Math.round(s.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(s.position.y=Math.round(s.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(s.position.z=Math.round(s.position.z/this.translationSnap)*this.translationSnap),s.parent&&s.position.sub(or.setFromMatrixPosition(s.parent.matrixWorld))));else if(i==="scale"){if(t.search("XYZ")!==-1){let a=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(a*=-1),yc.set(a,a,a)}else or.copy(this.pointStart),yc.copy(this.pointEnd),or.applyQuaternion(this._worldQuaternionInv),yc.applyQuaternion(this._worldQuaternionInv),yc.divide(or),t.search("X")===-1&&(yc.x=1),t.search("Y")===-1&&(yc.y=1),t.search("Z")===-1&&(yc.z=1);s.scale.copy(this._scaleStart).multiply(yc),this.scaleSnap&&(t.search("X")!==-1&&(s.scale.x=Math.round(s.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Y")!==-1&&(s.scale.y=Math.round(s.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Z")!==-1&&(s.scale.z=Math.round(s.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(i==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const a=20/this.worldPosition.distanceTo(or.setFromMatrixPosition(this.camera.matrixWorld));t==="E"?(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1):t==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(or.copy(this.rotationAxis).cross(this.eye))*a):(t==="X"||t==="Y"||t==="Z")&&(this.rotationAxis.copy(_O[t]),or.copy(_O[t]),r==="local"&&or.applyQuaternion(this.worldQuaternion),this.rotationAngle=this._offset.dot(or.cross(this.eye).normalize())*a),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),r==="local"&&t!=="E"&&t!=="XYZE"?(s.quaternion.copy(this._quaternionStart),s.quaternion.multiply(Ui.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),s.quaternion.copy(Ui.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),s.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(SS),this.dispatchEvent(SO)}}pointerUp(e){e.button===0&&(this.dragging&&this.axis!==null&&(wO.mode=this.mode,this.dispatchEvent(wO)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}attach(e){return this.object=e,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(SS),this.dispatchEvent(SO),this.pointStart.copy(this.pointEnd))}getRaycaster(){return Fh}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}}function fne(n){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:n.button};{const e=this.domElement.getBoundingClientRect();return{x:(n.clientX-e.left)/e.width*2-1,y:-(n.clientY-e.top)/e.height*2+1,button:n.button}}}function pne(n){if(this.enabled)switch(n.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(n));break}}function gne(n){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(n.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(n)),this.pointerDown(this._getPointer(n)))}function mne(n){this.enabled&&this.pointerMove(this._getPointer(n))}function Ane(n){this.enabled&&(this.domElement.releasePointerCapture(n.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(n)))}function CS(n,e,t){const i=e.intersectObject(n,!0);for(let s=0;s<i.length;s++)if(i[s].object.visible||t)return i[s];return!1}const Ay=new pn,xi=new w(0,1,0),CO=new w(0,0,0),EO=new Ie,vy=new Se,Yy=new Se,la=new w,MO=new Ie,yg=new w(1,0,0),Vh=new w(0,1,0),bg=new w(0,0,1),yy=new w,ng=new w,sg=new w;class vne extends Me{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new ai({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),t=new Sn({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),i=e.clone();i.opacity=.15;const s=t.clone();s.opacity=.5;const r=e.clone();r.color.setHex(16711680);const o=e.clone();o.color.setHex(65280);const a=e.clone();a.color.setHex(255);const l=e.clone();l.color.setHex(16711680),l.opacity=.5;const c=e.clone();c.color.setHex(65280),c.opacity=.5;const u=e.clone();u.color.setHex(255),u.opacity=.5;const d=e.clone();d.opacity=.25;const f=e.clone();f.color.setHex(16776960),f.opacity=.25,e.clone().color.setHex(16776960);const g=e.clone();g.color.setHex(7895160);const A=new cn(0,.04,.1,12);A.translate(0,.05,0);const v=new Ei(.08,.08,.08);v.translate(0,.04,0);const m=new ft;m.setAttribute("position",new st([0,0,0,1,0,0],3));const b=new cn(.0075,.0075,.5,3);b.translate(0,.25,0);function y(Y,N){const L=new bl(Y,.0075,3,64,N*Math.PI*2);return L.rotateY(Math.PI/2),L.rotateX(Math.PI/2),L}function _(){const Y=new ft;return Y.setAttribute("position",new st([0,0,0,1,1,1],3)),Y}const E={X:[[new ye(A,r),[.5,0,0],[0,0,-Math.PI/2]],[new ye(A,r),[-.5,0,0],[0,0,Math.PI/2]],[new ye(b,r),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new ye(A,o),[0,.5,0]],[new ye(A,o),[0,-.5,0],[Math.PI,0,0]],[new ye(b,o)]],Z:[[new ye(A,a),[0,0,.5],[Math.PI/2,0,0]],[new ye(A,a),[0,0,-.5],[-Math.PI/2,0,0]],[new ye(b,a),null,[Math.PI/2,0,0]]],XYZ:[[new ye(new Cl(.1,0),d.clone()),[0,0,0]]],XY:[[new ye(new Ei(.15,.15,.01),u.clone()),[.15,.15,0]]],YZ:[[new ye(new Ei(.15,.15,.01),l.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new ye(new Ei(.15,.15,.01),c.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},M={X:[[new ye(new cn(.2,0,.6,4),i),[.3,0,0],[0,0,-Math.PI/2]],[new ye(new cn(.2,0,.6,4),i),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new ye(new cn(.2,0,.6,4),i),[0,.3,0]],[new ye(new cn(.2,0,.6,4),i),[0,-.3,0],[0,0,Math.PI]]],Z:[[new ye(new cn(.2,0,.6,4),i),[0,0,.3],[Math.PI/2,0,0]],[new ye(new cn(.2,0,.6,4),i),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new ye(new Cl(.2,0),i)]],XY:[[new ye(new Ei(.2,.2,.01),i),[.15,.15,0]]],YZ:[[new ye(new Ei(.2,.2,.01),i),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new ye(new Ei(.2,.2,.01),i),[.15,0,.15],[-Math.PI/2,0,0]]]},I={START:[[new ye(new Cl(.01,2),s),null,null,null,"helper"]],END:[[new ye(new Cl(.01,2),s),null,null,null,"helper"]],DELTA:[[new dn(_(),s),null,null,null,"helper"]],X:[[new dn(m,s.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new dn(m,s.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new dn(m,s.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},R={XYZE:[[new ye(y(.5,1),g),null,[0,Math.PI/2,0]]],X:[[new ye(y(.5,.5),r)]],Y:[[new ye(y(.5,.5),o),null,[0,0,-Math.PI/2]]],Z:[[new ye(y(.5,.5),a),null,[0,Math.PI/2,0]]],E:[[new ye(y(.75,1),f),null,[0,Math.PI/2,0]]]},C={AXIS:[[new dn(m,s.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},T={XYZE:[[new ye(new So(.25,10,8),i)]],X:[[new ye(new bl(.5,.1,4,24),i),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new ye(new bl(.5,.1,4,24),i),[0,0,0],[Math.PI/2,0,0]]],Z:[[new ye(new bl(.5,.1,4,24),i),[0,0,0],[0,0,-Math.PI/2]]],E:[[new ye(new bl(.75,.1,2,24),i)]]},O={X:[[new ye(v,r),[.5,0,0],[0,0,-Math.PI/2]],[new ye(b,r),[0,0,0],[0,0,-Math.PI/2]],[new ye(v,r),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new ye(v,o),[0,.5,0]],[new ye(b,o)],[new ye(v,o),[0,-.5,0],[0,0,Math.PI]]],Z:[[new ye(v,a),[0,0,.5],[Math.PI/2,0,0]],[new ye(b,a),[0,0,0],[Math.PI/2,0,0]],[new ye(v,a),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new ye(new Ei(.15,.15,.01),u),[.15,.15,0]]],YZ:[[new ye(new Ei(.15,.15,.01),l),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new ye(new Ei(.15,.15,.01),c),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new ye(new Ei(.1,.1,.1),d.clone())]]},J={X:[[new ye(new cn(.2,0,.6,4),i),[.3,0,0],[0,0,-Math.PI/2]],[new ye(new cn(.2,0,.6,4),i),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new ye(new cn(.2,0,.6,4),i),[0,.3,0]],[new ye(new cn(.2,0,.6,4),i),[0,-.3,0],[0,0,Math.PI]]],Z:[[new ye(new cn(.2,0,.6,4),i),[0,0,.3],[Math.PI/2,0,0]],[new ye(new cn(.2,0,.6,4),i),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new ye(new Ei(.2,.2,.01),i),[.15,.15,0]]],YZ:[[new ye(new Ei(.2,.2,.01),i),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new ye(new Ei(.2,.2,.01),i),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new ye(new Ei(.2,.2,.2),i),[0,0,0]]]},V={X:[[new dn(m,s.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new dn(m,s.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new dn(m,s.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function H(Y){const N=new Me;for(const L in Y)for(let G=Y[L].length;G--;){const ee=Y[L][G][0].clone(),$=Y[L][G][1],j=Y[L][G][2],ie=Y[L][G][3],Ae=Y[L][G][4];ee.name=L,ee.tag=Ae,$&&ee.position.set($[0],$[1],$[2]),j&&ee.rotation.set(j[0],j[1],j[2]),ie&&ee.scale.set(ie[0],ie[1],ie[2]),ee.updateMatrix();const ge=ee.geometry.clone();ge.applyMatrix4(ee.matrix),ee.geometry=ge,ee.renderOrder=1/0,ee.position.set(0,0,0),ee.rotation.set(0,0,0),ee.scale.set(1,1,1),N.add(ee)}return N}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=H(E)),this.add(this.gizmo.rotate=H(R)),this.add(this.gizmo.scale=H(O)),this.add(this.picker.translate=H(M)),this.add(this.picker.rotate=H(T)),this.add(this.picker.scale=H(J)),this.add(this.helper.translate=H(I)),this.add(this.helper.rotate=H(C)),this.add(this.helper.scale=H(V)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const i=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:Yy;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let s=[];s=s.concat(this.picker[this.mode].children),s=s.concat(this.gizmo[this.mode].children),s=s.concat(this.helper[this.mode].children);for(let r=0;r<s.length;r++){const o=s[r];o.visible=!0,o.rotation.set(0,0,0),o.position.copy(this.worldPosition);let a;if(this.camera.isOrthographicCamera?a=(this.camera.top-this.camera.bottom)/this.camera.zoom:a=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),o.scale.set(1,1,1).multiplyScalar(a*this.size/4),o.tag==="helper"){o.visible=!1,o.name==="AXIS"?(o.visible=!!this.axis,this.axis==="X"&&(Ui.setFromEuler(Ay.set(0,0,0)),o.quaternion.copy(i).multiply(Ui),Math.abs(xi.copy(yg).applyQuaternion(i).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="Y"&&(Ui.setFromEuler(Ay.set(0,0,Math.PI/2)),o.quaternion.copy(i).multiply(Ui),Math.abs(xi.copy(Vh).applyQuaternion(i).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="Z"&&(Ui.setFromEuler(Ay.set(0,Math.PI/2,0)),o.quaternion.copy(i).multiply(Ui),Math.abs(xi.copy(bg).applyQuaternion(i).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="XYZE"&&(Ui.setFromEuler(Ay.set(0,Math.PI/2,0)),xi.copy(this.rotationAxis),o.quaternion.setFromRotationMatrix(EO.lookAt(CO,xi,Vh)),o.quaternion.multiply(Ui),o.visible=this.dragging),this.axis==="E"&&(o.visible=!1)):o.name==="START"?(o.position.copy(this.worldPositionStart),o.visible=this.dragging):o.name==="END"?(o.position.copy(this.worldPosition),o.visible=this.dragging):o.name==="DELTA"?(o.position.copy(this.worldPositionStart),o.quaternion.copy(this.worldQuaternionStart),or.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),or.applyQuaternion(this.worldQuaternionStart.clone().invert()),o.scale.copy(or),o.visible=this.dragging):(o.quaternion.copy(i),this.dragging?o.position.copy(this.worldPositionStart):o.position.copy(this.worldPosition),this.axis&&(o.visible=this.axis.search(o.name)!==-1));continue}o.quaternion.copy(i),this.mode==="translate"||this.mode==="scale"?(o.name==="X"&&Math.abs(xi.copy(yg).applyQuaternion(i).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="Y"&&Math.abs(xi.copy(Vh).applyQuaternion(i).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="Z"&&Math.abs(xi.copy(bg).applyQuaternion(i).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="XY"&&Math.abs(xi.copy(bg).applyQuaternion(i).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="YZ"&&Math.abs(xi.copy(yg).applyQuaternion(i).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="XZ"&&Math.abs(xi.copy(Vh).applyQuaternion(i).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1)):this.mode==="rotate"&&(vy.copy(i),xi.copy(this.eye).applyQuaternion(Ui.copy(i).invert()),o.name.search("E")!==-1&&o.quaternion.setFromRotationMatrix(EO.lookAt(this.eye,CO,Vh)),o.name==="X"&&(Ui.setFromAxisAngle(yg,Math.atan2(-xi.y,xi.z)),Ui.multiplyQuaternions(vy,Ui),o.quaternion.copy(Ui)),o.name==="Y"&&(Ui.setFromAxisAngle(Vh,Math.atan2(xi.x,xi.z)),Ui.multiplyQuaternions(vy,Ui),o.quaternion.copy(Ui)),o.name==="Z"&&(Ui.setFromAxisAngle(bg,Math.atan2(xi.y,xi.x)),Ui.multiplyQuaternions(vy,Ui),o.quaternion.copy(Ui))),o.visible=o.visible&&(o.name.indexOf("X")===-1||this.showX),o.visible=o.visible&&(o.name.indexOf("Y")===-1||this.showY),o.visible=o.visible&&(o.name.indexOf("Z")===-1||this.showZ),o.visible=o.visible&&(o.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),o.material._color=o.material._color||o.material.color.clone(),o.material._opacity=o.material._opacity||o.material.opacity,o.material.color.copy(o.material._color),o.material.opacity=o.material._opacity,this.enabled&&this.axis&&(o.name===this.axis||this.axis.split("").some(function(l){return o.name===l}))&&(o.material.color.setHex(16776960),o.material.opacity=1)}super.updateMatrixWorld(e)}}class yne extends ye{constructor(){super(new us(1e5,1e5,2,2),new ai({visible:!1,wireframe:!0,side:wi,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let t=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(t="local"),yy.copy(yg).applyQuaternion(t==="local"?this.worldQuaternion:Yy),ng.copy(Vh).applyQuaternion(t==="local"?this.worldQuaternion:Yy),sg.copy(bg).applyQuaternion(t==="local"?this.worldQuaternion:Yy),xi.copy(ng),this.mode){case"translate":case"scale":switch(this.axis){case"X":xi.copy(this.eye).cross(yy),la.copy(yy).cross(xi);break;case"Y":xi.copy(this.eye).cross(ng),la.copy(ng).cross(xi);break;case"Z":xi.copy(this.eye).cross(sg),la.copy(sg).cross(xi);break;case"XY":la.copy(sg);break;case"YZ":la.copy(yy);break;case"XZ":xi.copy(sg),la.copy(ng);break;case"XYZ":case"E":la.set(0,0,0);break}break;case"rotate":default:la.set(0,0,0)}la.length()===0?this.quaternion.copy(this.cameraQuaternion):(MO.lookAt(or.set(0,0,0),la,xi),this.quaternion.setFromRotationMatrix(MO)),super.updateMatrixWorld(e)}}var mx=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};class Sp extends Te{constructor(){super(...arguments);h(this,"isGizmo",!1);h(this,"translationSnap",1);h(this,"rotationSnapAngle",15);h(this,"scaleSnap",.25);h(this,"control");h(this,"orbit");h(this,"changeEventListener");h(this,"windowKeyDownListener");h(this,"windowKeyUpListener")}onEnable(){var t;this.isGizmo&&!oA||this.context.mainCamera&&(this.control||(this.control=new dne(this.context.mainCamera,this.context.domElement),this.control.visible=!0,this.control.enabled=!0,this.control.getRaycaster().layers.set(2),this.control.size=1,this.control.traverse(i=>{const s=i;if(s.layers.set(2),s){const r=s.material;r&&(r.opacity=.3)}}),this.orbit=ne.getComponentInParent(this.context.mainCamera,rn)??void 0),this.control&&(this.context.scene.add(this.control),this.control.attach(this.gameObject),this.changeEventListener=this.onControlChangedEvent.bind(this),(t=this.control)==null||t.addEventListener("dragging-changed",this.changeEventListener),this.addWindowEvents()))}onDisable(){var t,i;(t=this.control)==null||t.removeFromParent(),this.changeEventListener&&((i=this.control)==null||i.removeEventListener("dragging-changed",this.changeEventListener)),this.removeWindowEvents()}enableSnapping(){this.control&&(this.control.setTranslationSnap(this.translationSnap),this.control.setRotationSnap(cs.degToRad(this.rotationSnapAngle)),this.control.setScaleSnap(this.scaleSnap))}disableSnapping(){this.control&&(this.control.setTranslationSnap(null),this.control.setRotationSnap(null),this.control.setScaleSnap(null))}onControlChangedEvent(t){const i=this.orbit;if(i&&(i.enabled=!t.value),t.value){const s=ne.getComponentInParent(this.gameObject,Bu);s&&s.requestOwnership()}}addWindowEvents(){const t=this.control;t&&(this.windowKeyDownListener||(this.windowKeyDownListener=i=>{if(this.enabled)switch(i.keyCode){case 81:t.setSpace(t.space==="local"?"world":"local");break;case 16:this.enableSnapping();break;case 87:t.setMode("translate");break;case 69:t.setMode("rotate");break;case 82:t.setMode("scale");break;case 187:case 107:t.setSize(t.size+.1);break;case 189:case 109:t.setSize(Math.max(t.size-.1,.1));break;case 88:t.showX=!t.showX;break;case 89:t.showY=!t.showY;break;case 90:t.showZ=!t.showZ;break;case 32:t.enabled=!t.enabled;break}}),this.windowKeyUpListener||(this.windowKeyUpListener=i=>{if(this.enabled)switch(i.keyCode){case 16:this.disableSnapping();break}}),window.addEventListener("keydown",this.windowKeyDownListener),window.addEventListener("keyup",this.windowKeyUpListener))}removeWindowEvents(){window.removeEventListener("keydown",this.windowKeyDownListener),window.removeEventListener("keyup",this.windowKeyUpListener)}}mx([x()],Sp.prototype,"isGizmo",void 0);mx([x()],Sp.prototype,"translationSnap",void 0);mx([x()],Sp.prototype,"rotationSnapAngle",void 0);mx([x()],Sp.prototype,"scaleSnap",void 0);var H1=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};class Cp extends Zs{constructor(){super(...arguments);h(this,"color");h(this,"intensity");h(this,"center")}get typeName(){return"Vignette"}init(){this.color.defaultValue={r:0,g:0,b:0,a:1},this.intensity.defaultValue=0,this.center.defaultValue={x:.5,y:.5}}onCreateEffect(){const t=new uF;return this.intensity.onValueChanged=i=>{t.offset=i,this.updateDarkness(t)},this.color.onValueChanged=i=>{this.updateDarkness(t)},t}updateDarkness(t){const i=this.intensity.value;t.darkness=i}}H1([x(Et)],Cp.prototype,"color",void 0);H1([x(Et)],Cp.prototype,"intensity",void 0);H1([x(Et)],Cp.prototype,"center",void 0);ta("Vignette",Cp);var bne=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const ES=re("debugpost");class Q1 extends Te{constructor(){super(...arguments);h(this,"sharedProfile");h(this,"_postprocessing");h(this,"_effects",[]);h(this,"_lastApplyTime");h(this,"_rapidApplyCount",0);h(this,"_isDirty",!1);h(this,"_modificationQueue");h(this,"_recreateId",-1)}markDirty(){this._isDirty=!0}awake(){var t;(t=this.sharedProfile)==null||t.init(),ES&&(console.log(this),console.log("Press P to toggle post processing"),window.addEventListener("keydown",i=>{i.key==="p"&&(console.log("Toggle volume: "+this.name,!this.enabled),this.enabled=!this.enabled)}))}onDisable(){var t;(t=this._postprocessing)==null||t.unapply()}onBeforeRender(){if(!this.context.isInXR){if(this.context.composer&&!(this.context.composer instanceof aT))return;this.context.mainCamera&&(!this._postprocessing||!this._postprocessing.isActive||this._isDirty)&&this.apply(),this.context.composer&&(this.context.composer.setRenderer(this.context.renderer),this.context.composer.setMainScene(this.context.scene),this.context.mainCamera&&this.context.composer.setMainCamera(this.context.mainCamera))}}onDestroy(){var t;(t=this._postprocessing)==null||t.dispose()}apply(){var i,s;ES&&console.log("Apply PostProcessing",this,(i=this.context.mainCamera)==null?void 0:i.name),si()&&(this._lastApplyTime!==void 0&&Date.now()-this._lastApplyTime<100&&(this._rapidApplyCount++,this._rapidApplyCount===5&&console.warn("Detected rapid post processing modifications - this might be a bug",this)),this._lastApplyTime=Date.now()),this._isDirty=!1,this.unapply(),this._effects.length=0,(s=this.sharedProfile)!=null&&s.components&&this._effects.push(...this.sharedProfile.components);const t=this.gameObject.getComponentsInChildren(Zs);if(ES&&(t!=null&&t.length)&&console.log("Additional",t),t)for(const r of t)r.active&&this._effects.push(r);this._effects.length>0&&(this._postprocessing||(this._postprocessing=new U1(this.context)),this._postprocessing.apply(this._effects),this._applyPostQueue())}unapply(){var t;(t=this._postprocessing)==null||t.unapply()}_applyPostQueue(){if(this._modificationQueue){for(const t of this._modificationQueue.values())this.onEditorModification(t);this._modificationQueue.clear()}}onEditorModification(t){var i,s;if(t.propertyName.startsWith("postprocessing.")){if(!this._postprocessing)return this._modificationQueue||(this._modificationQueue=new Map),this._modificationQueue.set(t.propertyName,t),!0;if(!((i=this._effects)!=null&&i.length))return;const r=t.propertyName.split(".");if(r.length===3||r.length===4){const o=r[1],a=r[2];for(const l of this._effects)if(((s=l.typeName)==null?void 0:s.toLowerCase())===o.toLowerCase()){if(a==="active"){l.active=t.value,this.scheduleRecreate();return}if(!by.has(o)){const c=new Array;by.set(o,c);const u=Object.keys(l);for(const d of u)l[d]instanceof Et&&c.push(d)}if(by.has(o)){const c=a.toLowerCase(),u=by.get(o);for(const d of u)if(d.toLowerCase()===c){const f=l[d];f instanceof Et&&(r.length===4&&r[3]==="active"?(f.overrideState=t.value,this.scheduleRecreate()):f&&f.value!==void 0&&(f.value=t.value));return}}console.warn("Unknown modification",a);return}}return!0}return!1}scheduleRecreate(){const t=++this._recreateId;setTimeout(()=>{t===this._recreateId&&(this.onDisable(),this.onEnable())},200)}}bne([hA(D_)],Q1.prototype,"sharedProfile",void 0);const by=new Map;var _ne=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};class W1 extends Te{constructor(){super(...arguments);h(this,"backgroundTint",new Si(1,1,1,1));h(this,"_preRender");h(this,"backgroundPlane");h(this,"threeTexture");h(this,"forceTextureInitialization",function(){const t=new ai,i=new us,s=new mr;s.add(new ye(i,t));const r=new qt;return function(a,l){t.map=l,a.render(s,r)}}())}awake(){vt.OptionalFeatures_AR.push("camera-access")}get background(){return this.backgroundPlane}onEnable(){this._preRender=this.preRender.bind(this),this.context.pre_render_callbacks.push(this._preRender),this.backgroundPlane&&(this.gameObject.add(this.backgroundPlane),this.backgroundPlane.visible=!1)}onDisable(){this.context.pre_render_callbacks=this.context.pre_render_callbacks.filter(t=>t!==this._preRender),this.backgroundPlane&&this.gameObject.remove(this.backgroundPlane)}preRender(){if(!this||!this.gameObject)return;const i=this.context.renderer.xr.getFrame();i&&(!this.threeTexture&&this.context.renderer&&(this.threeTexture=new Rt,this.forceTextureInitialization(this.context.renderer,this.threeTexture)),this.backgroundPlane===void 0&&(this.backgroundPlane=wne(this.backgroundTint),this.gameObject.add(this.backgroundPlane)),this.updateFromFrame(i))}onBeforeRender(t){this.updateFromFrame(t)}updateFromFrame(t){if(!t)return;const i=t.getViewerPose(this.context.renderer.xr.getReferenceSpace());if(i){for(const s of i.views)if("camera"in s&&s.camera){let o=this.context.renderer.xr.getBinding();if(o||(o=new XRWebGLBinding(t.session,this.context.renderer.getContext())),o){let a=null;if("getCameraImage"in o){a=o.getCameraImage(s.camera);const l=this.context.renderer.properties.get(this.threeTexture);l.__webglTexture=a,this.backgroundPlane&&(this.backgroundPlane.setTexture(this.threeTexture),this.backgroundPlane.visible=!0)}}}}}}_ne([x()],W1.prototype,"backgroundTint",void 0);const xne=`
uniform sampler2D t2D;

varying vec2 vUv;

void main() {

    vec4 texColor = texture2D( t2D, vUv );
    texColor.w = 1.0;

    // inline sRGB decode
    texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );

    gl_FragColor = texColor * <backgroundTint>;

    #include <tonemapping_fragment>
    #include <encodings_fragment>

}
`;function wne(n){const e="vec4("+n.r.toFixed(3)+","+n.g.toFixed(3)+","+n.b.toFixed(3)+","+n.a.toFixed(3)+")";console.log(e);const t=new ye(new us(2,2),new Bt({name:"BackgroundMaterial",uniforms:Sb.clone(Rr.background.uniforms),vertexShader:Rr.background.vertexShader,fragmentShader:xne.replace("<backgroundTint>",e),side:wi,depthTest:!1,depthWrite:!1,fog:!1}));return t.geometry.deleteAttribute("normal"),Object.defineProperty(t.material,"map",{get:function(){return this.threeTexture}}),t.renderOrder=-1e4,t.layers.disableAll(),t.layers.enable(2),t.frustumCulled=!1,t.setTexture=function(i){t.material.uniforms.t2D.value=i},t}var Ep=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const TO=re("debugimagetracking"),hm=class{constructor(e,t,i,s,r,o){h(this,"measuredSize");h(this,"state");h(this,"_position");h(this,"_rotation");h(this,"_trackingComponent");h(this,"_trackedImage");h(this,"_bitmap");h(this,"_pose");this._trackingComponent=e,this._trackedImage=t,this._bitmap=i,this.measuredSize=s,this.state=r,this._pose=o}get url(){return this._trackedImage.image??""}get widthInMeters(){return this._trackedImage.widthInMeters??void 0}get bitmap(){return this._bitmap}get model(){return this._trackedImage}getPosition(e){return this.ensureTransformData(),e.copy(this._position),e}getQuaternion(e){return this.ensureTransformData(),e.copy(this._rotation),e}applyToObject(e,t=void 0){this.ensureTransformData();const i=e.position.distanceToSquared(this._position)>.05||e.quaternion.angleTo(this._rotation)>.05;t===void 0||t>=1||i?(e.position.copy(this._position),e.quaternion.copy(this._rotation)):(t=Math.max(0,Math.min(1,t)),e.position.lerp(this._position,t),e.quaternion.slerp(this._rotation,t)),e.quaternion.multiply(hm.y180)}ensureTransformData(){if(!this._position){this._position=hm._positionBuffer.get(),this._rotation=hm._rotationBuffer.get();const e=this._pose.transform;this._position.set(e.position.x,e.position.y,e.position.z),this._rotation.set(e.orientation.x,e.orientation.y,e.orientation.z,e.orientation.w)}}};let Bc=hm;h(Bc,"y180",new Se().setFromAxisAngle(new w(0,1,0),Math.PI)),h(Bc,"_positionBuffer",new Lf(()=>new w,20)),h(Bc,"_rotationBuffer",new Lf(()=>new Se,20));class bh{constructor(){h(this,"image");h(this,"widthInMeters");h(this,"object");h(this,"createObjectInstance",!1);h(this,"imageDoesNotMove",!1)}}Ep([x(URL)],bh.prototype,"image",void 0);Ep([x()],bh.prototype,"widthInMeters",void 0);Ep([x(wn)],bh.prototype,"object",void 0);Ep([x()],bh.prototype,"createObjectInstance",void 0);Ep([x()],bh.prototype,"imageDoesNotMove",void 0);class Sne{constructor(e,t,i){h(this,"filename");h(this,"widthInMeters");h(this,"imageData");this.filename=e,this.imageData=t,this.widthInMeters=i}get extensionName(){return"image-tracking"}onAfterHierarchy(e,t){t.beginBlock('def Preliminary_ReferenceImage "AnchoringReferenceImage"'),t.appendLine("uniform asset image = @tracker/"+this.filename+"@"),t.appendLine("uniform double physicalWidth = "+(this.widthInMeters*100).toFixed(8)),t.closeBlock()}onAfterSerialize(e){e.files["tracker/"+this.filename]=this.imageData}}const df=class extends Te{constructor(){super(...arguments);h(this,"trackedImages");h(this,"trackedImageIndexMap",new Map);h(this,"xr",null);h(this,"onModifyAROptions",t=>{var r;if(!this.trackedImages)return;const i=t.detail,s=i.optionalFeatures||[];s.includes("image-tracking")||s.push("image-tracking"),i.optionalFeatures=s,i.trackedImages=[];for(const o of this.trackedImages)if((r=o.image)!=null&&r.length&&o.widthInMeters>0){const a=df._imageElements.get(o.image);a&&(this.trackedImageIndexMap.set(i.trackedImages.length,o),i.trackedImages.push({image:a,widthInMeters:o.widthInMeters}))}});h(this,"imageToObjectMap",new Map);h(this,"onImageTrackingUpdate",t=>{const i=t.detail;for(const[s,r]of this.imageToObjectMap){if(!r.object||!s)continue;let o=!1;for(const a of i)if(a.model===s){o=!0;break}o||ne.setActive(r.object,!1)}for(const s of i){const r=s.model;if(!r.object)continue;let o=this.imageToObjectMap.get(r);if(o===void 0)o={object:null,frames:0},this.imageToObjectMap.set(r,o),r.object.loadAssetAsync().then(a=>{r.createObjectInstance&&(a=ne.instantiate(a)),a&&(o.object=a,this.xr&&this.xr.Rig.add(a),s.applyToObject(a),a.activeSelf||ne.setActive(a,!0))});else{if(o.frames++,r.imageDoesNotMove&&o.frames>10||!o.object)continue;this.xr&&this.xr.Rig.add(o.object),s.applyToObject(o.object),o.object.activeSelf||ne.setActive(o.object,!0)}}});h(this,"onXRStarted",t=>{for(const i of this.imageToObjectMap.values())i.frames=0});h(this,"onXRUpdate",t=>{const i=t.frame;if(i){if(i.session&&!("getImageTrackingResults"in i)){Rs('Image tracking is currently not supported on this device. On Chrome for Android, you can enable the <a href="chrome://flags/#webxr-incubations">chrome://flags/#webxr-incubations</a> flag.');return}if(i.session&&typeof i.getImageTrackingResults=="function"){const s=i.getImageTrackingResults();if(s.length){const r=this.context.renderer.xr.getReferenceSpace();if(r){const o=[];for(const a of s){const l=a.index,c=this.trackedImageIndexMap.get(l);if(c){const u=i.getPose(a.imageSpace,r),d=a.trackingState,f=new Bc(this,c,a.image,a.measuredSize,d,u);o.push(f)}else TO&&console.warn("No tracked image for index",l)}if(o.length>0)try{this.dispatchEvent(new CustomEvent("image-tracking",{detail:o}))}catch(a){console.error(a)}}}}}})}awake(){if(TO&&console.log(this),!!this.trackedImages){for(const t of this.trackedImages)if(t.image&&!df._imageElements.has(t.image)){const i=t.image;df._imageElements.set(i,null);const s=document.createElement("img");s.src=i,s.addEventListener("load",async()=>{const r=await createImageBitmap(s);df._imageElements.set(i,r);const o=await tU(r);if(o){const l=await(await new Promise(u=>o.toBlob(u,"image/png",1))).arrayBuffer(),c=ne.findObjectOfType(To);c&&this.trackedImages&&(c.extensions.push(new Sne("marker.png",new Uint8Array(l),this.trackedImages[0].widthInMeters)),c.anchoringType="image")}})}}}onEnable(){this.xr=ne.findObjectOfType(vt),vt.addEventListener(ii.ModifyAROptions,this.onModifyAROptions),vt.addEventListener(ii.XRStarted,this.onXRStarted),vt.addEventListener(ii.XRUpdate,this.onXRUpdate),this.addEventListener("image-tracking",this.onImageTrackingUpdate)}onDisable(){vt.removeEventListener(ii.ModifyAROptions,this.onModifyAROptions),vt.removeEventListener(ii.XRStarted,this.onXRStarted),vt.removeEventListener(ii.XRUpdate,this.onXRUpdate),this.removeEventListener("image-tracking",this.onImageTrackingUpdate)}};let Sf=df;h(Sf,"_imageElements",new Map);Ep([x(bh)],Sf.prototype,"trackedImages",void 0);var Ax=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const IO=re("debugplanetracking");class Mp extends Te{constructor(){super(...arguments);h(this,"dataTemplate");h(this,"initiateRoomCaptureIfNoData",!0);h(this,"usePlaneData",!0);h(this,"useMeshData",!0);h(this,"onModifyAROptions",t=>{const i=t.detail,s=i.optionalFeatures||[];this.usePlaneData&&!s.includes("plane-detection")&&s.push("plane-detection"),this.useMeshData&&!s.includes("mesh-detection")&&s.push("mesh-detection"),i.optionalFeatures=s});h(this,"onXRUpdate",t=>{if(!t.rig)return;const i=t.frame;if(!this.context.renderer.xr.getReferenceSpace())return;const o=i.detectedPlanes,a=i.detectedMeshes,l=o!==void 0&&o.size>0,c=a!==void 0&&a.size>0;this.initiateRoomCaptureIfNoData&&(!l&&!c&&this.firstTimeNoPlanesDetected<-10&&(this.firstTimeNoPlanesDetected=Date.now()),(l||c)&&(this.firstTimeNoPlanesDetected=-1),this.firstTimeNoPlanesDetected>0&&Date.now()-this.firstTimeNoPlanesDetected>2500&&"initiateRoomCapture"in i.session&&(i.session.initiateRoomCapture(),this.firstTimeNoPlanesDetected=-1)),o!==void 0&&this.processFrameData(t.rig,t.frame,o,this._allPlanes),a!==void 0&&this.processFrameData(t.rig,t.frame,a,this._allMeshes)});h(this,"_dataId",1);h(this,"_allPlanes",new Map);h(this,"_allMeshes",new Map);h(this,"firstTimeNoPlanesDetected",-100)}get trackedPlanes(){return this._allPlanes.values()}get trackedMeshes(){return this._allMeshes.values()}onEnable(){vt.addEventListener(ii.XRUpdate,this.onXRUpdate),vt.addEventListener(ii.ModifyAROptions,this.onModifyAROptions)}onDisable(){vt.removeEventListener(ii.XRUpdate,this.onXRUpdate),vt.removeEventListener(ii.ModifyAROptions,this.onModifyAROptions)}processFrameData(t,i,s,r){const a=this.context.renderer.xr.getReferenceSpace();if(a){for(const l of r.keys())if(!s.has(l)){const c=r.get(l);r.delete(l),IO&&console.log("Plane no longer tracked, id="+c.id),c.mesh&&(t==null||t.remove(c.mesh));const u=new CustomEvent("plane-tracking",{detail:{type:"plane-removed",context:c}});this.dispatchEvent(u)}for(const l of s){const c="planeSpace"in l?l.planeSpace:"meshSpace"in l?l.meshSpace:void 0;if(!c)continue;const u=i.getPose(c,a);let d;const f=p=>{if(p){if(p instanceof Array){for(const g of p)f(g);return}p.name.includes("Occlu")&&(p.colorWrite=!1,p.depthWrite=!0,p.transparent=!1,p.polygonOffset=!0,p.polygonOffsetFactor=1,p.polygonOffsetUnits=.1,p._renderOrder=-1e3)}};if(r.has(l)){const p=r.get(l);if(d=p.mesh,p.timestamp<l.lastChangedTime){if(p.timestamp=l.lastChangedTime,p.mesh){const A=this.createGeometry(l);if(p.mesh instanceof ye)p.mesh.geometry.dispose(),p.mesh.geometry=A,f(p.mesh.material);else if(p.mesh instanceof ar)for(const v of p.mesh.children)v instanceof ye&&(v.geometry.dispose(),v.geometry=A,f(v.material));p.collider&&(p.collider.sharedMesh=p.mesh,p.collider.convex=!0,p.collider.onDisable(),p.collider.onEnable())}const g=new CustomEvent("plane-tracking",{detail:{type:"plane-updated",context:p}});this.dispatchEvent(g)}}else if(this.dataTemplate||(this.dataTemplate=new ye),this.dataTemplate){const p=ne.instantiate(this.dataTemplate);if(d=p,p instanceof ye)Bi(p.geometry),p.geometry=this.createGeometry(l),f(p.material);else if(p instanceof ar)for(const v of p.children)v instanceof ye&&(Bi(v.geometry),v.geometry=this.createGeometry(l),f(v.material));const g=p.getComponent(z_);g&&(g.sharedMesh=p,g.convex=!0,g.onDisable(),g.onEnable()),p.matrixAutoUpdate=!1,p.matrixWorldNeedsUpdate=!0,t.add(p);const A={id:this._dataId++,xrData:l,timestamp:l.lastChangedTime,mesh:p,collider:g};r.set(l,A),IO&&console.log("New plane detected, id="+A.id);try{const v=new CustomEvent("plane-tracking",{detail:{type:"plane-added",context:A}});this.dispatchEvent(v)}catch(v){console.error(v)}}d&&(u?(d.visible=!0,d.matrix.fromArray(u.transform.matrix)):d.visible=!1)}}}createGeometry(t){return"polygon"in t?this.createPlaneGeometry(t.polygon):"vertices"in t&&"indices"in t?this.createMeshGeometry(t.vertices,t.indices):new ft}createMeshGeometry(t,i){const s=new ft;s.setIndex(new ot(i,1)),s.setAttribute("position",new ot(t,3));const r=Array();for(let o=0;o<t.length;o+=3)r.push(t[o],t[o+2]);return s.setAttribute("uv",new ot(new Float32Array(r),2)),s.computeVertexNormals(),s}createPlaneGeometry(t){const i=new ft,s=[],r=[];t.forEach(p=>{s.push(p.x,p.y,p.z),r.push(p.x,p.z)});const o=new w(s[0],s[1],s[2]),a=new w(s[3],s[4],s[5]),l=new w(s[6],s[7],s[8]),c=new w,u=new w;c.subVectors(a,o),u.subVectors(l,o),c.cross(u),c.normalize();const d=[];for(let p=0;p<s.length/3;p++)d.push(c.x,c.y,c.z);const f=[];for(let p=2;p<t.length;++p)f.push(0,p-1,p);return i.setAttribute("position",new ot(new Float32Array(s),3)),i.setAttribute("uv",new ot(new Float32Array(r),2)),i.setAttribute("normal",new ot(new Float32Array(d),3)),i.setIndex(f),i}}Ax([x(Me)],Mp.prototype,"dataTemplate",void 0);Ax([x()],Mp.prototype,"initiateRoomCaptureIfNoData",void 0);Ax([x()],Mp.prototype,"usePlaneData",void 0);Ax([x()],Mp.prototype,"useMeshData",void 0);var Mc;(function(n){n.StartOrUpdate="xr-grab-visual-start-or-update",n.End="xr-grab-visual-end"})(Mc||(Mc={}));class j1{constructor(){h(this,"guid");h(this,"dontSave",!0);h(this,"userId");h(this,"point",{x:0,y:0,z:0});h(this,"source",{x:0,y:0,z:0});h(this,"target")}update(e,t,i,s=void 0){this.userId=e.connection.connectionId,this.point.x=t.x,this.point.y=t.y,this.point.z=t.z,this.source.x=i.x,this.source.y=i.y,this.source.z=i.z,this.target=s}}class C3 extends Te{constructor(){super(...arguments);h(this,"prefab",null);h(this,"_grabModels",[]);h(this,"_grabModelsUpdateTime",[]);h(this,"_addOrUpdateSub",null);h(this,"_endSub",null);h(this,"_freeSub",null);h(this,"_instances",{});h(this,"temp",new w)}awake(){this.prefab&&(this.prefab.visible=!1)}onEnable(){this._addOrUpdateSub=this.context.connection.beginListen(Mc.StartOrUpdate,this.onRemoteGrabStartOrUpdate.bind(this)),this._endSub=this.context.connection.beginListen(Mc.End,this.onRemoteGrabEnd.bind(this)),this._freeSub=Wo.AddEventListener(F0.WillFree,this.onAttachedObjectFree.bind(this))}onDisable(){this.context.connection.stopListen(Mc.StartOrUpdate,this._addOrUpdateSub),this.context.connection.stopListen(Mc.End,this._endSub),Wo.RemoveEventListener(F0.WillFree,this._freeSub)}addOrUpdateGrab(t){this.context.connection.send(Mc.StartOrUpdate,t,Tr.Queued)}endGrab(t){this.context.connection.send(Mc.End,t,Tr.Queued)}onRemoteGrabStartOrUpdate(t){if(!this.prefab)return;const i=this._instances[t.guid];if(!i){const s=ne.instantiate(this.prefab);if(s.visible=!0,this._instances[t.guid]={instance:s,model:t},t.userId){const r=ne.getComponentsInChildren(s,Qf);if((r==null?void 0:r.length)>0)for(const o of r)o.assignUserColor(t.userId)}return}i.model=t}onRemoteGrabEnd(t){if(!t)return;const i=t.guid;this._instances[i]&&(ne.destroy(this._instances[i].instance),delete this._instances[i])}onAttachedObjectFree(t){if(this._grabModels.length<=0)return;const i=this._grabModels[0];this.updateModel(i,t),this.endGrab(i)}onBeforeRender(){if(this.updateRendering(),!!this.prefab&&(this.prefab.visible=!1,this.context.time.frameCount%10===0))for(let t=0;t<Wo.Current.length;t++){const i=Wo.Current[t];if(!i.controller||!i.selected)continue;this._grabModels.length<=t&&(this._grabModels.push(new j1),this._grabModelsUpdateTime.push(0)),this._grabModelsUpdateTime[t]=this.context.time.time;const s=this._grabModels[t];this.updateModel(s,i),this.addOrUpdateGrab(s)}}updateModel(t,i){if(!i.controller||!i.selected)return;t.guid=i.grabUUID;const s=i.selected.guid;t.update(this.context,i.grabPoint,i.controller.worldPosition,s)}updateRendering(){const t=this.context.time.deltaTime/.5;for(const i in this._instances){const{instance:s,model:r}=this._instances[i];if(!s||!r)continue;const{point:o}=r,a=Mt(s);this.temp.set(o.x,o.y,o.z),a.lerp(this.temp,t),On(s,a)}}}class E3{}const Cne=Object.freeze(Object.defineProperty({__proto__:null,ActionBuilder:di,ActionCollection:oU,ActionModel:po,AlignmentConstraint:A_,Animation:xo,AnimationCurve:fh,AnimationExtension:_T,AnimationTrackHandler:i1,Animator:Xs,AnimatorController:Pu,Antialiasing:O_,AttachedObject:Wo,AudioExtension:s1,AudioListener:Af,AudioSource:Ni,AudioTrackHandler:vf,AvatarBlink_Simple:lp,AvatarEyeLook_Rotation:Wc,AvatarLoader:wT,AvatarMarker:as,AvatarModel:xT,Avatar_Brain_LookAt:I0,Avatar_MouthShapes:L_,Avatar_MustacheShake:zN,Avatar_POI:pr,AxesHelper:_A,BaseUIComponent:Va,BasicIKConstraint:GN,BehaviorExtension:a1,BehaviorModel:Cs,Behaviour:Te,Bloom:cp,BoxCollider:N_,BoxGizmo:hp,BoxHelperComponent:zo,Button:gh,CallInfo:Pm,Camera:yi,Canvas:Yn,CanvasGroup:ku,CapsuleCollider:Ou,ChangeMaterialOnClick:Pl,ChangeTransformOnClick:up,CharacterController:dp,CharacterControllerInput:Ah,ChromaticAberration:W_,Collider:Kl,ColorAdjustments:ju,ColorBySpeedModule:fp,ColorOverLifetimeModule:q_,Component:Gu,ControlTrackHandler:n1,CustomBranding:Ju,Deletable:KN,DeleteBox:A1,DepthOfField:Xa,DeviceFlag:v1,DocumentExtension:ZN,DragControls:Bl,DropListener:Y_,Duplicatable:gp,EmissionModule:$l,EmphasizeOnClick:EA,EventList:qn,EventListEvent:AT,EventSystem:hr,EventTrigger:w1,FieldWithDefault:JF,FixedJoint:t3,FlyControls:i3,Fog:IA,GltfExport:Ia,GltfExportBox:r3,Gradient:qu,Graphic:Ul,GraphicRaycaster:ON,GridHelper:RA,GridLayoutGroup:XN,GroundProjectedEnv:mp,GroupActionModel:cu,HideOnStart:YN,HingeJoint:K_,HorizontalLayoutGroup:qN,Image:SA,InheritVelocityModule:Yu,InputField:Go,Interactable:dA,LODGroup:ex,LODModel:Ap,Light:jr,LimitVelocityOverLifetimeModule:Un,LogStats:o3,LookAt:Nl,LookAtConstraint:y_,MainModule:Ds,MaskableGraphic:G_,MeshCollider:z_,MeshRenderer:vT,MinMaxCurve:ct,MinMaxGradient:ls,NestedGltf:I1,Networking:ql,NoiseModule:Ai,ObjectRaycaster:th,OffsetConstraint:vp,OpenURL:BA,OrbitControls:rn,Outline:wA,Padding:Wu,ParticleBurst:G0,ParticleSubEmitter:F1,ParticleSystem:Xi,ParticleSystemRenderer:gr,PixelationEffect:cx,PlayAnimationOnClick:Na,PlayAudioOnClick:MA,PlayableDirector:Qc,PlayerColor:Qf,PointerEventData:Oc,PostProcessingHandler:U1,PreliminaryAction:TA,PreliminaryTrigger:H_,RGBAColor:Si,RawImage:u1,Raycaster:yA,Rect:HN,RectTransform:Ts,ReflectionProbe:Tl,RegisteredAnimationInfo:bT,RemoteSkybox:ih,Renderer:Ci,RendererLightmap:S0,Rigidbody:bi,RotationBySpeedModule:Mo,RotationOverLifetimeModule:na,SceneSwitcher:yr,ScreenCapture:xp,ScreenSpaceAmbientOcclusion:vh,ScreenSpaceAmbientOcclusionN8:Ja,SetActiveOnClick:CA,ShadowCatcher:dx,ShapeModule:Gi,SignalAsset:P_,SignalReceiver:Hc,SignalReceiverEvent:bA,SignalTrackHandler:N0,Size:VN,SizeBySpeedModule:vr,SizeOverLifetimeModule:Xu,SkinnedMeshRenderer:KF,SmoothFollow:za,SpatialHtml:_3,SpatialTrigger:xu,SpatialTriggerReceiver:zl,SpectatorCamera:V1,SphereCollider:U_,Sprite:yh,SpriteData:UA,SpriteRenderer:tc,SpriteSheet:px,SubEmitterSystem:$0,SyncedCamera:wf,SyncedRoom:$u,SyncedTransform:Bu,TapGestureTrigger:JN,TeleportTarget:t1,TestRunner:x3,TestSimulateUserData:w3,Text:$s,TextBuilder:g1,TextExtension:X_,TextureSheetAnimationModule:Os,TiltShiftEffect:ic,ToneMapping:gx,TrailModule:Yi,TransformData:bu,TransformGizmo:Sp,TriggerBuilder:Nr,TriggerModel:Vc,UIRaycastUtils:Vm,UIRootComponent:T_,USDZExporter:To,USDZText:du,USDZUIExtension:m1,UsageMarker:fA,VRUserState:Ta,VariantAction:rU,VelocityOverLifetimeModule:on,VerticalLayoutGroup:jN,VideoPlayer:Is,Vignette:Cp,VisibilityAction:Q_,Voip:Hu,Volume:Q1,VolumeParameter:Et,VolumeProfile:D_,WebAR:bf,WebARCameraBackground:W1,WebARSessionRoot:Ha,WebXR:vt,WebXRAvatar:Il,WebXRController:un,WebXRImageTracking:Sf,WebXRImageTrackingModel:bh,WebXRPlaneTracking:Mp,WebXRSync:W0,WebXRTrackedImage:Bc,XRFlag:os,XRGrabModel:j1,XRGrabRendering:C3,XRRig:H0,XRState:cr,__Ignore:E3},Symbol.toStringTag,{value:"Module"}));var q1=globalThis&&globalThis.__decorate||function(n,e,t,i){var s=arguments.length,r=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(r=(s<3?o(r):s>3?o(e,t,r):o(e,t))||r);return s>3&&r&&Object.defineProperty(e,t,r),r};const Jy=re("debugplayersync");class X1 extends Te{constructor(){super(...arguments);h(this,"asset");h(this,"onPlayerSpawned");h(this,"onJoinedRoom",async t=>{var s,r,o;Jy&&console.log("PlayerSync.onUserJoined",t);const i=await((s=this.asset)==null?void 0:s.instantiateSynced({parent:this.gameObject},!0));if(i){const a=ne.getComponent(i,Vo);a?(a.owner=this.context.connection.connectionId,(r=this.onPlayerSpawned)==null||r.invoke(i)):(console.error("<strong>Failed finding PlayerState on "+((o=this.asset)==null?void 0:o.uri)+"</strong>: please make sure the asset has a PlayerState component!"),ne.destroySynced(i))}else console.warn("PlayerSync: failed instantiating asset!")})}awake(){this.watchTabVisible()}onEnable(){this.context.connection.beginListen(pi.RoomStateSent,this.onJoinedRoom)}onDisable(){this.context.connection.stopListen(pi.RoomStateSent,this.onJoinedRoom)}watchTabVisible(){window.addEventListener("visibilitychange",t=>{if(document.visibilityState==="visible")for(let i=Vo.all.length-1;i>=0;i--){const s=Vo.all[i];(!s.owner||!this.context.connection.userIsInRoom(s.owner))&&s.doDestroy()}})}}q1([x(wn)],X1.prototype,"asset",void 0);q1([x(qn)],X1.prototype,"onPlayerSpawned",void 0);var nb;(function(n){n.OwnerChanged="ownerChanged"})(nb||(nb={}));const Vn=class extends Te{constructor(){super(...arguments);h(this,"onOwnerChangeEvent",new qn);h(this,"onFirstOwnerChangeEvent",new qn);h(this,"hasOwner",!1);h(this,"owner")}static get all(){return Vn._all}static get local(){return Vn._local}static isLocalPlayer(t){if(t instanceof Me){const i=ne.getComponentInParent(t,Vn);return(i==null?void 0:i.isLocalPlayer)??!1}else if(t instanceof Gu){const i=ne.getComponentInParent(t.gameObject,Vn);return(i==null?void 0:i.isLocalPlayer)??!1}return!1}static addEventListener(t,i){return this._callbacks[t]||(this._callbacks[t]=[]),this._callbacks[t].push(i),i}static removeEventListener(t,i){if(!this._callbacks[t])return;const s=this._callbacks[t].indexOf(i);s>=0&&this._callbacks[t].splice(s,1)}static dispatchEvent(t,i){if(this._callbacks[t])for(const s of this._callbacks[t])s(i)}get isLocalPlayer(){return this.owner===this.context.connection.connectionId}onOwnerChange(t,i){var a,l;Jy&&console.log("PlayerSync.onOwnerChange",this,"newOwner",t,"oldOwner",i);const s=Vn._local.indexOf(this);s>=0&&Vn._local.splice(s,1);const r={playerState:this,oldValue:i,newValue:t};if(this.hasOwner||(this.hasOwner=!0,(a=this.onFirstOwnerChangeEvent)==null||a.invoke(r)),(l=this.onOwnerChangeEvent)==null||l.invoke(r),this.owner===this.context.connection.connectionId){Vn._local.push(this);const c=new CustomEvent("local-owner-changed",{detail:r});this.dispatchEvent(c),Vn.dispatchEvent(nb.OwnerChanged,c)}const o=new CustomEvent("owner-changed",{detail:r});this.dispatchEvent(o),Vn.dispatchEvent(nb.OwnerChanged,o)}awake(){Vn.all.push(this),Jy&&console.log("Registered new PlayerState",this,Vn.all.length-1,Vn.all),this.context.connection.beginListen(pi.UserLeftRoom,t=>{if(t.userId===this.owner){this.doDestroy();return}})}start(){if(this.owner&&!this.context.connection.userIsInRoom(this.owner)){this.doDestroy();return}}doDestroy(){Jy&&console.log("PlayerSync.doDestroy  syncDestroy",this),YM(this.gameObject,this.context.connection)}onDestroy(){if(Vn.all.splice(Vn.all.indexOf(this),1),this.isLocalPlayer){const t=Vn._local.indexOf(this);t>=0&&Vn._local.splice(t,1)}}};let Vo=Vn;h(Vo,"_all",[]),h(Vo,"_local",[]),h(Vo,"_callbacks",{});q1([z1(Vo.prototype.onOwnerChange)],Vo.prototype,"owner",void 0);class Ene extends Te{constructor(){super(...arguments);h(this,"toggleKey","KeyP")}update(){this.context.input.isKeyDown(this.toggleKey)&&this.context.domElement.classList.toggle("presentation-mode")}}q.add("__Ignore",E3);q.add("ActionBuilder",di);q.add("ActionCollection",oU);q.add("ActionModel",po);q.add("AlignmentConstraint",A_);q.add("Animation",xo);q.add("AnimationCurve",fh);q.add("AnimationExtension",_T);q.add("AnimationTrackHandler",i1);q.add("Animator",Xs);q.add("AnimatorController",Pu);q.add("Antialiasing",O_);q.add("AttachedObject",Wo);q.add("AudioExtension",s1);q.add("AudioListener",Af);q.add("AudioSource",Ni);q.add("AudioTrackHandler",vf);q.add("Avatar_Brain_LookAt",I0);q.add("Avatar_MouthShapes",L_);q.add("Avatar_MustacheShake",zN);q.add("Avatar_POI",pr);q.add("AvatarBlink_Simple",lp);q.add("AvatarEyeLook_Rotation",Wc);q.add("AvatarLoader",wT);q.add("AvatarMarker",as);q.add("AvatarModel",xT);q.add("AxesHelper",_A);q.add("BaseUIComponent",Va);q.add("BasicIKConstraint",GN);q.add("BehaviorExtension",a1);q.add("BehaviorModel",Cs);q.add("Behaviour",Te);q.add("Bloom",cp);q.add("BoxCollider",N_);q.add("BoxGizmo",hp);q.add("BoxHelperComponent",zo);q.add("Button",gh);q.add("CallInfo",Pm);q.add("Camera",yi);q.add("Canvas",Yn);q.add("CanvasGroup",ku);q.add("CapsuleCollider",Ou);q.add("ChangeMaterialOnClick",Pl);q.add("ChangeTransformOnClick",up);q.add("CharacterController",dp);q.add("CharacterControllerInput",Ah);q.add("ChromaticAberration",W_);q.add("Collider",Kl);q.add("ColorAdjustments",ju);q.add("ColorBySpeedModule",fp);q.add("ColorOverLifetimeModule",q_);q.add("Component",Gu);q.add("ControlTrackHandler",n1);q.add("CustomBranding",Ju);q.add("Deletable",KN);q.add("DeleteBox",A1);q.add("DepthOfField",Xa);q.add("DeviceFlag",v1);q.add("DocumentExtension",ZN);q.add("DragControls",Bl);q.add("DropListener",Y_);q.add("Duplicatable",gp);q.add("EmissionModule",$l);q.add("EmphasizeOnClick",EA);q.add("EventList",qn);q.add("EventListEvent",AT);q.add("EventSystem",hr);q.add("EventTrigger",w1);q.add("FieldWithDefault",JF);q.add("FixedJoint",t3);q.add("FlyControls",i3);q.add("Fog",IA);q.add("GltfExport",Ia);q.add("GltfExportBox",r3);q.add("Gradient",qu);q.add("Graphic",Ul);q.add("GraphicRaycaster",ON);q.add("GridHelper",RA);q.add("GridLayoutGroup",XN);q.add("GroundProjectedEnv",mp);q.add("GroupActionModel",cu);q.add("HideOnStart",YN);q.add("HingeJoint",K_);q.add("HorizontalLayoutGroup",qN);q.add("Image",SA);q.add("InheritVelocityModule",Yu);q.add("InputField",Go);q.add("Interactable",dA);q.add("Light",jr);q.add("LimitVelocityOverLifetimeModule",Un);q.add("LODGroup",ex);q.add("LODModel",Ap);q.add("LogStats",o3);q.add("LookAt",Nl);q.add("LookAtConstraint",y_);q.add("MainModule",Ds);q.add("MaskableGraphic",G_);q.add("MeshCollider",z_);q.add("MeshRenderer",vT);q.add("MinMaxCurve",ct);q.add("MinMaxGradient",ls);q.add("NestedGltf",I1);q.add("Networking",ql);q.add("NoiseModule",Ai);q.add("ObjectRaycaster",th);q.add("OffsetConstraint",vp);q.add("OpenURL",BA);q.add("OrbitControls",rn);q.add("Outline",wA);q.add("Padding",Wu);q.add("ParticleBurst",G0);q.add("ParticleSubEmitter",F1);q.add("ParticleSystem",Xi);q.add("ParticleSystemRenderer",gr);q.add("PixelationEffect",cx);q.add("PlayableDirector",Qc);q.add("PlayAnimationOnClick",Na);q.add("PlayAudioOnClick",MA);q.add("PlayerColor",Qf);q.add("PlayerState",Vo);q.add("PlayerSync",X1);q.add("PointerEventData",Oc);q.add("PostProcessingHandler",U1);q.add("PreliminaryAction",TA);q.add("PreliminaryTrigger",H_);q.add("PresentationMode",Ene);q.add("RawImage",u1);q.add("Raycaster",yA);q.add("Rect",HN);q.add("RectTransform",Ts);q.add("ReflectionProbe",Tl);q.add("RegisteredAnimationInfo",bT);q.add("RemoteSkybox",ih);q.add("Renderer",Ci);q.add("RendererLightmap",S0);q.add("RGBAColor",Si);q.add("Rigidbody",bi);q.add("RotationBySpeedModule",Mo);q.add("RotationOverLifetimeModule",na);q.add("SceneSwitcher",yr);q.add("ScreenCapture",xp);q.add("ScreenSpaceAmbientOcclusion",vh);q.add("ScreenSpaceAmbientOcclusionN8",Ja);q.add("SetActiveOnClick",CA);q.add("ShadowCatcher",dx);q.add("ShapeModule",Gi);q.add("SignalAsset",P_);q.add("SignalReceiver",Hc);q.add("SignalReceiverEvent",bA);q.add("SignalTrackHandler",N0);q.add("Size",VN);q.add("SizeBySpeedModule",vr);q.add("SizeOverLifetimeModule",Xu);q.add("SkinnedMeshRenderer",KF);q.add("SmoothFollow",za);q.add("SpatialHtml",_3);q.add("SpatialTrigger",xu);q.add("SpatialTriggerReceiver",zl);q.add("SpectatorCamera",V1);q.add("SphereCollider",U_);q.add("Sprite",yh);q.add("SpriteData",UA);q.add("SpriteRenderer",tc);q.add("SpriteSheet",px);q.add("SubEmitterSystem",$0);q.add("SyncedCamera",wf);q.add("SyncedRoom",$u);q.add("SyncedTransform",Bu);q.add("TapGestureTrigger",JN);q.add("TeleportTarget",t1);q.add("TestRunner",x3);q.add("TestSimulateUserData",w3);q.add("Text",$s);q.add("TextBuilder",g1);q.add("TextExtension",X_);q.add("TextureSheetAnimationModule",Os);q.add("TiltShiftEffect",ic);q.add("ToneMapping",gx);q.add("TrailModule",Yi);q.add("TransformData",bu);q.add("TransformGizmo",Sp);q.add("TriggerBuilder",Nr);q.add("TriggerModel",Vc);q.add("UIRaycastUtils",Vm);q.add("UIRootComponent",T_);q.add("UsageMarker",fA);q.add("USDZExporter",To);q.add("USDZText",du);q.add("USDZUIExtension",m1);q.add("VariantAction",rU);q.add("VelocityOverLifetimeModule",on);q.add("VerticalLayoutGroup",jN);q.add("VideoPlayer",Is);q.add("Vignette",Cp);q.add("VisibilityAction",Q_);q.add("Voip",Hu);q.add("Volume",Q1);q.add("VolumeParameter",Et);q.add("VolumeProfile",D_);q.add("VRUserState",Ta);q.add("WebAR",bf);q.add("WebARCameraBackground",W1);q.add("WebARSessionRoot",Ha);q.add("WebXR",vt);q.add("WebXRAvatar",Il);q.add("WebXRController",un);q.add("WebXRImageTracking",Sf);q.add("WebXRImageTrackingModel",bh);q.add("WebXRPlaneTracking",Mp);q.add("WebXRSync",W0);q.add("WebXRTrackedImage",Bc);q.add("XRFlag",os);q.add("XRGrabModel",j1);q.add("XRGrabRendering",C3);q.add("XRRig",H0);q.add("XRState",cr);const M3=ws,Mne=re("debugtypestore");Mne&&console.log(q);function Tne(n,e){const i=Aj(n,e);return i!==void 0?i:null}const Ine=new mj,MS=Symbol("deserialize-queue");async function Rne(n,e,t,i=null,s){if(!t)return;let r=i;typeof r=="number"&&(r=new Ws(i));const o=e.indexOf("?");e=o===-1?e:e.substring(0,o);const a=new R2(t.scene);a.gltfId=e,a.context=n,a.gltf=t,a.nodeToObject=s==null?void 0:s.nodeToObjectMap,a.implementationInformation=Ine;let l=n[MS];if(l||(l=n[MS]=[]),t.scenes)for(const c of t.scenes)await OE(a,c,l);if(t.children)for(const c of t.children)await OE(a,c,l);n.new_scripts_pre_setup_callbacks.push(()=>{const c=n[MS];if(c){for(const u of c)Pne(u,a);c.length=0}if(r){const u={},d=[];DE(t,r,u,d);for(const f of t.scenes)DE(f,r,u,d);for(const f of d)f.resolveGuids(u)}})}function DE(n,e,t,i){if(e===null||!n)return;const s=n.guid;if(n.guid=e.generateUUID(),s&&s!=="invalid"&&(t[s]=n.guid),n&&n.userData&&n.userData.components)for(const r of n.userData.components){if(r===null)continue;const o=r.guid;r.guid=e.generateUUID(),o&&o!=="invalid"&&(t[o]=r.guid),r.resolveGuids&&i.push(r)}if(n.children)for(const r of n.children)DE(r,e,t,i)}const rg=[];async function OE(n,e,t,i){if(!e)return;const s=e.userData;if(s){const r=s.builtin_components;if(r&&r.length>0)for(const o of r)try{if(o===null)continue;const a=q.get(o.name);if(a!=null){const l=new a;l.sourceId=n.gltfId,Ff(l,o,n.implementationInformation),"guid"in o&&(l[Iy]=o.guid),zu(e,l,!1),t.push({instance:l,compData:o,obj:e}),l.isCamera&&n.context&&n.context.mainCamera===null&&l.tag==="MainCamera"&&n.context.setCurrentCamera(l)}else M3&&console.debug("unknown component: "+o.name),rg.includes(o.name)||rg.push(o.name)}catch(a){console.error(o.name+" - "+a.message,a)}if(rg.length>0){const o=rg.join(", ");console.warn("unknown components: "+o),rg.length=0,Ar()&&bn(`<strong>Unknown components in scene</strong>:

${o}

This could mean you forgot to add a npmdef to your ExportInfo
<a href="https://engine.needle.tools/docs/project_structure.html#creating-and-installing-a-npmdef" target="_blank">documentation</a>`,jn.Warn)}}if(e.children)for(const r of e.children)await OE(n,r,t)}function Pne(n,e){const{instance:t,compData:i,obj:s}=n;e.object=s,e.target=t,PC(t,i,e),M3&&console.debug("add "+i.name,i,t)}class T3{createBuiltinComponents(e,t,i,s,r){return Rne(e,t,i,s,r)}writeBuiltinComponentData(e,t){return Tne(e,t)}parseSync(e,t,i,s){return Bne(e,t,i,s)}loadSync(e,t,i,s,r){return D3(e,t,i,s,r)}}bF(T3);const I3=re("printGltf")||re("printgltf"),R3=re("downloadgltf");var jc;(function(n){n[n.BeforeLoad=0]="BeforeLoad",n[n.AfterLoaded=1]="AfterLoaded",n[n.FinishedSetup=10]="FinishedSetup"})(jc||(jc={}));class Cf{constructor(e,t,i,s){h(this,"context");h(this,"loader");h(this,"path");h(this,"gltf");this.context=e,this.path=t,this.loader=i,this.gltf=s}}const RO={};function Ef(n,e){if(RO[n])for(const t of RO[n])t(e)}async function P3(n,e,t,i,s){I3&&console.warn("glTF",e,t),e.includes("?")&&(e=e.split("?")[0]),await Ga().createBuiltinComponents(n,e,t,i,s)}async function B3(n,e){const t=new sp;return await tY(t,e,n),t}async function Bne(n,e,t,i){typeof t!="string"&&console.warn("Parse gltf binary without path, this might lead to errors in resolving extensions. Please provide the source path of the gltf/glb file",t,typeof t),I3&&console.log("Parse glTF",t);const s=await B3(t,n),r=WF(s);return new Promise((o,a)=>{try{let l=t.split("?")[0].trimEnd();if(l.endsWith(".glb")||l.endsWith(".gltf")){const c=l.split("/");c.pop(),l=c.join("/"),l.endsWith("/")||(l+="/")}s.resourcePath=l,cA(s,n),Ef(jc.BeforeLoad,new Cf(n,t,s)),s.parse(e,"",async c=>{Ef(jc.AfterLoaded,new Cf(n,t,s,c)),await P3(n,t,c,i,r),Ef(jc.FinishedSetup,new Cf(n,t,s,c)),X2(c.scene,n),o(c),R3&&O3(e)},c=>{console.error("failed loading "+t,c),o(void 0)})}catch(l){console.error(l),a(l)}})}async function D3(n,e,t,i,s){Dne(e);const r=await B3(e,n),o=WF(r);return new Promise((a,l)=>{try{cA(r,n),Ef(jc.BeforeLoad,new Cf(n,e,r)),r.load(e,async c=>{Ef(jc.AfterLoaded,new Cf(n,e,r,c)),await P3(n,t,c,i,o),Ef(jc.FinishedSetup,new Cf(n,e,r,c)),X2(c.scene,n),a(c),R3&&O3(e)},c=>{s==null||s.call(r,c)},c=>{console.error("failed loading "+e,c),a(void 0)})}catch(c){console.error(c),l(c)}})}function Dne(n){if(new URL(n,window.location.href).href.startsWith("file://")){const t=`Hi - it looks like you are trying to load a local file which will not work. You need to use a webserver to serve your files.
Please refer to the documentation on <a href="https://fwd.needle.tools/needle-engine/docs/local-server">https://docs.needle.tools</a> or ask for help in our <a href="https://discord.needle.tools">discord community</a>`;bn(t),console.warn(t)}}function O3(n){if(typeof n=="string"){const e=document.createElement("a");e.href=n,e.download=n.split("/").pop(),e.click()}else{const e=new Blob([n],{type:"application/octet-stream"}),t=window.URL.createObjectURL(e),i=document.createElement("a");i.href=t,i.download="download.glb",i.click()}}bF(T3);const es=re("debugwebcomponent"),PO="needle-engine",k3="vr",L3="desktop",One=[MF,k3,L3],og="ar-session-active",ag="desktop-session-active",kne=["hash","src","camera-controls","loadstart","progress","loadfinished","dracoDecoderPath","dracoDecoderType","ktx2DecoderPath"];class F3 extends HTMLElement{constructor(){super();h(this,"gameObject",ne);h(this,"GameObject",ne);h(this,"_context");h(this,"_overlay_ar");h(this,"_loadingProgress01",0);h(this,"_loadingView");h(this,"_previousSrc",null);h(this,"_didFullyLoad",!1);h(this,"_loadId",0);h(this,"_lastSourceFiles",null);h(this,"onReady",()=>{var t;return(t=this._loadingView)==null?void 0:t.onLoadingFinished()});h(this,"onError",()=>{var t;return(t=this._loadingView)==null?void 0:t.setMessage("Loading failed!")});h(this,"_previouslyRegisteredMap",new Map);this._overlay_ar=new kq,this.addEventListener("ready",this.onReady),this.attachShadow({mode:"open"});const t=document.createElement("template");t.innerHTML=`<style>
@import url('https://fonts.googleapis.com/css2?family=Roboto:wght@300&display=swap');

    :host {
        position: absolute;
        display: block;
        width: max(600px, 100%);
        height: max(300px, 100%);
        font-family: 'Roboto', sans-serif;
    }
    @media (max-width: 600px) {
        :host {
            width: 100%;
        }
    }
    @media (max-height: 300px) {
        :host {
            height: 100%;
        }
    }
    :host canvas {   
        position: absolute;
        user-select: none;
        /** allow touch panning but no pinch zoom **/
        /** but this doesnt work yet: 
         * touch-action: pan-x, pan-y;
         **/
    }
    :host .content {
        position: absolute;
        width: 100%;
        height: 100%;
        visibility: visible;
        z-index: 500; /* < must be less than the webxr buttons element */
        pointer-events: none;
    }
    :host .overlay-content {
        position: absolute;
        user-select: auto;
        pointer-events: all;
    }
    :host slot[name="quit-ar"]:hover {
        cursor: pointer;
    }
    :host .quit-ar-button {
        position: absolute;
        top: 40px;
        right: 20px;
        z-index: 9999;
    }
</style>
<canvas></canvas>
<div class="content">
    <slot class="overlay-content"></slot>
</div>
`,this.shadowRoot&&this.shadowRoot.appendChild(t.content.cloneNode(!0)),this._context=new Lt({domElement:this}),this.addEventListener("error",this.onError)}static get observedAttributes(){return kne}get loadingProgress01(){return this._loadingProgress01}get loadingFinished(){return this.loadingProgress01>.999}get cameraControls(){const t=this.getAttribute("camera-controls");return!(t===null||t==="False"||t==="false"||t==="0")}getContext(){return new Promise((t,i)=>{if(this._context&&this.loadingFinished)t(this._context);else{const s=()=>{this.removeEventListener("loadfinished",s),this._context&&this.loadingFinished&&t(this._context)};this.addEventListener("loadfinished",s)}})}get context(){return this._context}get Context(){return this._context}async connectedCallback(){if(es&&console.log("<needle-engine> connected"),this.onSetupDesktop(),!this.getAttribute("src")){const i=globalThis["needle:codegen_files"];i&&(es&&console.log('globalThis["needle:codegen_files"]',i),this.setAttribute("src",i))}const t=this._loadId;setTimeout(()=>{this.isConnected!==!1&&t===this._loadId&&this.onLoad()},1),Ml!=null&&Ml.length&&this.setAttribute("version",Ml)}disconnectedCallback(){var i;this._didFullyLoad=!1;const t=this.getAttribute("keep-alive");es&&console.warn("<needle-engine> disconnected, keep-alive:",t),(t===void 0||t!=="true")&&(console.warn("<needle-engine> dispose!"),(i=this._context)==null||i.dispose(),this._context=null,this._lastSourceFiles=null,this._loadId+=1)}attributeChangedCallback(t,i,s){switch(es&&console.log("attributeChangedCallback",t,i,s),t){case"src":es&&console.warn("src changed to type:",typeof s,', from "',i,'" to "',s,'"'),this.onLoad();break;case"hash":this._context&&(this._context.hash=s);break;case"loadstart":case"progress":case"loadfinished":typeof s=="string"&&s.length>0&&(es&&console.log(t+" attribute changed",s),this.registerEventFromAttribute(t,s));break;case"dracoDecoderPath":es&&console.log("dracoDecoderPath",s),pB(s);break;case"dracoDecoderType":s==="wasm"||s==="js"?(es&&console.log("dracoDecoderType",s),gB(s)):console.error("Invalid dracoDecoderType",s,"expected js or wasm");break;case"ktx2DecoderPath":es&&console.log("ktx2DecoderPath",s),mB(s);break}}async onLoad(){var f,p;if(!this.isConnected)return;if(this._context||(es&&console.warn("Create new context"),this._context=new Lt({domElement:this})),!this._context){console.error("Needle Engine: Context not initialized");return}const t=this.getSourceFiles();if(t==null||t.length<=0)es&&console.warn("Clear scene",t),this._context.clear();else if(!this.checkIfSourceHasChanged(t,this._lastSourceFiles))return;this._lastSourceFiles=t;const i=++this._loadId,s=this.getAttribute("alias");this.classList.add("loading");const r=Nf();this.ensureLoadStartIsRegistered();let o=this.dispatchEvent(new CustomEvent("loadstart",{detail:{context:this._context,alias:s},cancelable:!0}));if(r){const g=this.getAttribute("hide-loading-overlay");g!=null&&g!=="0"&&(o=!1)}o===!1&&!r&&(si()||(o=!0),console.warn("Needle Engine: You need a commercial license to override the default loading view. Visit https://needle.tools/pricing"),si()&&Rs('You need a <a target="_blank" href="https://needle.tools/pricing">commercial license</a> to override the default loading view. This will not work in production.')),!this._loadingView&&o&&(this._loadingView=new Uy(this)),o&&(this._didFullyLoad!==!0?(f=this._loadingView)==null||f.onLoadingBegin("begin load"):setTimeout(()=>{this._loadingView&&this._loadingProgress01<.3&&this._loadId===i&&this._loadingView.onLoadingBegin("begin load")},300)),es&&console.warn("--------------",i,"Needle Engine: Begin loading",s??"",t),this.onBeforeBeginLoading();const a=[],l={context:this._context,name:"",progress:{},index:0,count:t.length,totalProgress01:this._loadingProgress01},c=new CustomEvent("progress",{detail:l}),u={files:t,onLoadingProgress:g=>{var A;g.name=Lne(g.name),o&&((A=this._loadingView)==null||A.onLoadingUpdate(g)),l.name=g.name,l.progress=g.progress,this._loadingProgress01=PF(g),l.totalProgress01=this._loadingProgress01,this.dispatchEvent(c)},onLoadingFinished:(g,A,v)=>{v&&a.push({src:A,file:v})}},d=this.getAttribute("hash");d!=null&&(this._context.hash=d),this._context.alias=s,await this._context.create(u),this._loadId===i&&(es&&console.warn("--------------",i,"Needle Engine: finished loading",s??"",t),this._loadingProgress01=1,o&&((p=this._loadingView)==null||p.onLoadingUpdate(1,"creating scene")),this._didFullyLoad=!0,this.classList.remove("loading"),this.classList.add("loading-finished"),this.dispatchEvent(new CustomEvent("loadfinished",{detail:{context:this._context,src:s,loadedFiles:a}})))}internalSetLoadingMessage(t){var i;(i=this._loadingView)==null||i.setMessage(t)}getSourceFiles(){const t=this.getAttribute("src");if(!t)return[];let i;Array.isArray(t)?i=t:t.startsWith("[")&&t.endsWith("]")?i=JSON.parse(t):t.includes(",")?i=t.split(","):i=[t];for(let s=i.length-1;s>=0;s--){const r=i[s];(r==="null"||r==="undefined"||(r==null?void 0:r.length)<=0)&&i.splice(s,1)}return i}checkIfSourceHasChanged(t,i){if((t==null?void 0:t.length)!==(i==null?void 0:i.length)||t==null&&i!==null||t!==null&&i==null)return!0;if(t!==null&&i!==null){for(let s=0;s<(t==null?void 0:t.length);s++)if(t[s]!==i[s])return!0}return!1}ensureLoadStartIsRegistered(){const t=this.getAttribute("loadstart");t&&this.registerEventFromAttribute("loadstart",t)}registerEventFromAttribute(t,i){const s=this._previouslyRegisteredMap.get(t);if(s&&(this._previouslyRegisteredMap.delete(t),this.removeEventListener(t,s)),typeof i=="string"&&i.length>0)try{const r=(0,eval)(i);typeof r=="function"&&(this._previouslyRegisteredMap.set(t,r),this.addEventListener(t,o=>r==null?void 0:r.call(globalThis,this._context,o)))}catch(r){console.error("Error registering event "+t+'="'+i+`" failed with the following error:
`,r)}}getAROverlayContainer(){return this._overlay_ar.createOverlayContainer(this)}getVROverlayContainer(){for(let t=0;t<this.children.length;t++){const i=this.children[t];if(i.classList.contains("vr"))return i}return null}onEnterAR(t,i){var s;this.onSetupAR(),this._overlay_ar.onBegin(this._context,i,t),this.dispatchEvent(new CustomEvent("enter-ar",{detail:{session:t,context:this._context,htmlContainer:(s=this._overlay_ar)==null?void 0:s.ARContainer}}))}onExitAR(t){var i;this._overlay_ar.onEnd(this._context),this.onSetupDesktop(),this.dispatchEvent(new CustomEvent("exit-ar",{detail:{session:t,context:this._context,htmlContainer:(i=this._overlay_ar)==null?void 0:i.ARContainer}}))}onEnterVR(t){this.onSetupVR(),this.dispatchEvent(new CustomEvent("enter-vr",{detail:{session:t,context:this._context}}))}onExitVR(t){this.onSetupDesktop(),this.dispatchEvent(new CustomEvent("exit-vr",{detail:{session:t,context:this._context}}))}onSetupAR(){this.classList.add(og),this.classList.remove(ag);const t=this.getAROverlayContainer();es&&console.warn("onSetupAR:",t),t&&(t.classList.add(og),t.classList.remove(ag)),this.foreachHtmlElement(i=>this.setupElementsForMode(i,MF))}onSetupVR(){this.classList.remove(og),this.classList.remove(ag),this.foreachHtmlElement(t=>this.setupElementsForMode(t,k3))}onSetupDesktop(){this.classList.remove(og),this.classList.add(ag);const t=this.getAROverlayContainer();t&&(t.classList.remove(og),t.classList.add(ag)),this.foreachHtmlElement(i=>this.setupElementsForMode(i,L3))}setupElementsForMode(t,i,s=null){var o,a;if(t===((a=(o=this._context)==null?void 0:o.renderer)==null?void 0:a.domElement)||t.id==="VRButton"||t.id==="ARButton")return;if(t.classList.contains(i))t.style.visibility="visible",t.style.display==="none"&&(t.style.display="block");else for(const l of One)t.classList.contains(l)&&(t.style.visibility="hidden",t.style.display="none")}foreachHtmlElement(t){for(let i=0;i<this.children.length;i++){const s=this.children[i];s.style&&t(s)}}onBeforeBeginLoading(){const t=this.getAttribute("dracoDecoderPath");t&&(es&&console.log("using custom draco decoder path",t),pB(t));const i=this.getAttribute("dracoDecoderType");i&&(es&&console.log("using custom draco decoder type",i),gB(i));const s=this.getAttribute("ktx2DecoderPath");s&&(es&&console.log("using custom ktx2 decoder path",s),mB(s))}}typeof window<"u"&&!window.customElements.get(PO)&&window.customElements.define(PO,F3);function Lne(n){const e=n.split("/");let t=e[e.length-1];const i=t.indexOf("?");return i>0&&(t=t.substring(0,i)),decodeURIComponent(t)}const Fne=Object.freeze(Object.defineProperty({__proto__:null,NeedleEngineHTMLElement:F3},Symbol.toStringTag,{value:"Module"}));re("debughotreload");const Une=re("debugphysics");re("debugcolliderplacement");re("debugcollisions");re("showcolliders");globalThis.false=globalThis.false!==void 0?globalThis.false:!0;Une&&console.log("Use Rapier",!1,globalThis.false);Object.defineProperty(qt.prototype,"fov",{get:function(){return this._fov},set:function(n){const e=n!==this._fov;this._fov=n,e&&this.view!==void 0&&this.updateProjectionMatrix()}});Object.defineProperty(qt.prototype,"near",{get:function(){return this._near},set:function(n){const e=n!==this._near;this._near=n,e&&this.view!==void 0&&this.updateProjectionMatrix()}});Object.defineProperty(qt.prototype,"far",{get:function(){return this._far},set:function(n){const e=n!==this._far;this._far=n,e&&this.view!==void 0&&this.updateProjectionMatrix()}});const sb=re("debugmissingcamera");en.registerCallback(Qn.MissingCamera,n=>{var r,o;sb&&console.warn("Creating missing camera");const e=n.context.scene,t=new Me;t.name="Default Fallback Camera",e.add(t);const i=new yi;i.sourceId=((o=(r=n.files)==null?void 0:r[0])==null?void 0:o.src)??"unknown",n.context.lightmaps.tryGetSkybox(i.sourceId)?i.clearFlags=1:i.clearFlags=2,i.backgroundColor=new Si(.5,.5,.5,1),i.fieldOfView=35,i.backgroundBlurriness=.2;const s=zu(t,i,!0);return t.position.x=0,t.position.y=1,t.position.z=2,U3(n.context,s),s});en.registerCallback(Qn.ContextCreated,n=>{if(!n.context.mainCamera){sb&&console.log("Will not auto-fit because a default camera exists");return}const e=n.context.domElement;if((e==null?void 0:e.cameraControls)===!0){const t=I$(n.context.mainCamera);if((t==null?void 0:t.isCameraController)===!0){sb&&console.log("Will not auto-fit because a camera controller exists");return}U3(n.context)}});function U3(n,e){e=e??n.mainCameraComponent;const t=e==null?void 0:e.gameObject;if(sb&&console.log("Creating default camera controls",e==null?void 0:e.name),t){const i=KM(t,rn);i.sourceId=(e==null?void 0:e.sourceId)??"unknown";const s=n.domElement.getAttribute("auto-rotate");i.autoRotate=s!==void 0&&(s===""||s==="true"),i.autoRotateSpeed=.5;const r=n,o=()=>{r.pre_render_callbacks.splice(r.pre_render_callbacks.indexOf(o),1),i.fitCamera()};r.pre_render_callbacks.push(o)}else console.warn("Missing camera object, can not add orbit controls")}f8();const Y1={Context:Lt,glTF:{loadFromURL:D3}};globalThis.Needle!==void 0&&console.warn("Needle Engine is already imported");globalThis.Needle=Y1;function N3(n){for(const e in n)Y1[e]=n[e]}N3(Lq);N3(Cne);for(const n of Object.getOwnPropertyNames(ne))switch(n){case"prototype":case"constructor":case"length":case"name":continue;default:Y1[n]=ne[n];break}globalThis.THREE?console.warn("Threejs is already imported"):globalThis.THREE=J5;var Nne=Object.defineProperty,zne=Object.getOwnPropertyDescriptor,Tp=(n,e,t,i)=>{for(var s=i>1?void 0:i?zne(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&Nne(e,t,s),s};const z3=class extends Te{constructor(){super(...arguments),this.loopSelection=!0,this.autoInitialize=!0,this.bindToParent=!1,this.currentIndex=0,this.selectionCount=0}awake(){var n;if(super.awake(),this.bindToParent){const e=(n=this.gameObject.parent)==null?void 0:n.getComponentInParent(z3);e&&(e.onShowUnityEvent.addEventListener(()=>this.onShow()),e.onHideUnityEvent.addEventListener(()=>this.onHide()))}}start(){this.autoInitialize&&this.onShow()}next(){this.setIndex(this.currentIndex+1)}previous(){this.setIndex(this.currentIndex-1)}setIndex(n){n<0&&(n=this.selectionCount-1),this.currentIndex=n%this.selectionCount,this.applyState()}turnonThePlant(){console.log("i am here")}applyState(){}onShow(){var n;(n=this.onShowUnityEvent)==null||n.invoke()}onHide(){var n;(n=this.onHideUnityEvent)==null||n.invoke()}onIndexChanged(){this.applyState()}};let js=z3;Tp([x()],js.prototype,"loopSelection",2);Tp([x()],js.prototype,"autoInitialize",2);Tp([x()],js.prototype,"bindToParent",2);Tp([x(qn)],js.prototype,"onShowUnityEvent",2);Tp([x(qn)],js.prototype,"onHideUnityEvent",2);Tp([z1(js.prototype.onIndexChanged)],js.prototype,"currentIndex",2);class Gne extends js{awake(){this.autoInitialize=!1,super.awake()}}var Vne=Object.defineProperty,Hne=Object.getOwnPropertyDescriptor,G3=(n,e,t,i)=>{for(var s=i>1?void 0:i?Hne(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&Vne(e,t,s),s};class J1 extends Te{start(){this.updateLabel()}next(){var e;(e=this.configurator)==null||e.next(),this.updateLabel()}previous(){var e;(e=this.configurator)==null||e.previous(),this.updateLabel()}updateLabel(){this.stateLabel&&(this.configurator?this.stateLabel.text=`${this.configurator.currentIndex+1} / ${this.configurator.selectionCount}`:this.stateLabel.text="error")}}G3([x(js)],J1.prototype,"configurator",2);G3([x($s)],J1.prototype,"stateLabel",2);var Qne=Object.defineProperty,Wne=Object.getOwnPropertyDescriptor,K1=(n,e,t,i)=>{for(var s=i>1?void 0:i?Wne(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&Qne(e,t,s),s};class vx extends js{constructor(){super(...arguments),this.materialIndex=0,this.materials=[]}awake(){super.awake(),this.selectionCount=this.materials.length}onShow(){this.applyState()}onHide(){}applyState(){if(this.renderer==null)return;const e=this.materials[this.currentIndex];this.renderer.sharedMaterials.length>this.materialIndex?this.renderer.sharedMaterials[this.materialIndex]=e:console.error(`MaterialConfigurator (${this.name}): material index out of bounds (${this.materialIndex}) - ${this.renderer.sharedMaterials.length}`)}}K1([x(Ci)],vx.prototype,"renderer",2);K1([x()],vx.prototype,"materialIndex",2);K1([x()],vx.prototype,"materials",2);var jne=Object.defineProperty,qne=Object.getOwnPropertyDescriptor,Xne=(n,e,t,i)=>{for(var s=i>1?void 0:i?qne(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&jne(e,t,s),s};class V3 extends js{constructor(){super(...arguments),this.autoDetectChildren=!0,this.objects=[]}awake(){super.awake(),this.autoDetectChildren&&this.gameObject.children.forEach(e=>{const t=e==null?void 0:e.getComponent(js);t&&this.objects.push(t)}),this.selectionCount=this.objects.length}onShow(){this.applyState(),super.onShow()}onHide(){super.onHide()}applyState(){var t;let e=null;for(let i=0;i<this.objects.length;i++){const s=this.objects[i];i==this.currentIndex?e=s:s.gameObject.activeSelf&&(ne.setActive(s.gameObject,!1),(t=s.gameObject.getComponent(js))==null||t.onHide())}e&&(ne.setActive(e.gameObject,!0),e.onShow())}}Xne([x()],V3.prototype,"autoDetectChildren",2);var Yne=Object.defineProperty,Jne=Object.getOwnPropertyDescriptor,Kne=(n,e,t,i)=>{for(var s=i>1?void 0:i?Jne(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&Yne(e,t,s),s};class H3 extends js{constructor(){super(...arguments),this.tempVec1=new w,this.tempVec2=new w}awake(){super.awake(),this.autoInitialize=!1,this.onShowUnityEvent.addEventListener(()=>{this.syncPosition()})}syncPosition(){const e=this.target;e&&(this.gameObject.getWorldPosition(this.tempVec1),e.getWorldPosition(this.tempVec2),e.position.add(this.tempVec1.sub(this.tempVec2)))}}Kne([x(Me)],H3.prototype,"target",2);q.add("ConfigurationElement",Gne);q.add("Configurator",js);q.add("ConfiguratorControls",J1);q.add("MaterialConfigurator",vx);q.add("ObjectConfigurator",V3);q.add("SyncConfiguratorTransform",H3);var Zne=Object.defineProperty,$ne=Object.getOwnPropertyDescriptor,Q3=(n,e,t,i)=>{for(var s=i>1?void 0:i?$ne(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&Zne(e,t,s),s};class Z1 extends Te{constructor(){super(...arguments);h(this,"myGameObject");h(this,"status")}start(){for(const t of this.gameObject.children)t.visible=!1;this.gameObject.children[0].visible=!0}update(){}next(){}}Q3([x(Me)],Z1.prototype,"myGameObject",2);Q3([x(Ci)],Z1.prototype,"status",2);q.add("myScript",Z1);const $1=new Array;globalThis["needle:codegen_files"]=$1;$1.push("assets/myScene.glb?v=1699369434519");document.addEventListener("DOMContentLoaded",()=>{const n=document.querySelector("needle-engine");n&&n.getAttribute("src")===null&&(n.setAttribute("hash","1699369434519"),n.setAttribute("src",JSON.stringify($1)))});console.log("Made with  by  Needle - https://needle.tools  Version 3.20.1");export{fr as A,wM as C,Jc as I,Eu as N,kt as P,Vl as Q,Yf as S,Kc as V,Su as a,fse as c,i_ as g};
